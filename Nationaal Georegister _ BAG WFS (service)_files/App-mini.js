Ext.namespace("Ext.ux.form");
Ext.ux.form.TwinTriggerComboBox=function(config){Ext.ux.form.TwinTriggerComboBox.superclass.constructor.apply(this,arguments)
};
Ext.extend(Ext.ux.form.TwinTriggerComboBox,Ext.form.ComboBox,{trigger1Class:"x-form-clear-trigger",trigger2Class:"",trigger3Class:"x-form-trigger3-trigger",hideTrigger1:true,tooltipType:"qtip",initComponent:function(){Ext.ux.form.TwinTriggerComboBox.superclass.initComponent.call(this);
this.addEvents({clear:true,trigger3:true});
this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger2Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.trigger3Class}]}
},getTrigger:function(index){return this.triggers[index]
},initTrigger:function(){var ts=this.trigger.select(".x-form-trigger",true);
var triggerField=this;
ts.each(function(t,all,index){t.hide=function(){var w=triggerField.wrap.getWidth();
this.dom.style.display="none";
triggerField.el.setWidth(w-triggerField.trigger.getWidth())
};
t.show=function(){var w=triggerField.wrap.getWidth();
this.dom.style.display="";
triggerField.el.setWidth(w-triggerField.trigger.getWidth())
};
var triggerIndex="Trigger"+(index+1);
if(this["hide"+triggerIndex]){t.dom.style.display="none"
}t.on("click",this["on"+triggerIndex+"Click"],this,{preventDefault:true});
t.addClassOnOver("x-form-trigger-over");
t.addClassOnClick("x-form-trigger-click")
},this);
this.triggers=ts.elements;
if(this.trigger3TipConfig){var config={target:this.getTrigger(2)};
for(var i in this.helpTipConfig){config[i]=this.helpTipConfig[i]
}var tip=new Ext.ToolTip(config)
}if(this.trigger3TipConfig){if(typeof this.trigger3TipConfig=="object"){Ext.QuickTips.register(Ext.apply({target:this.getTrigger(2)},this.trigger3TipConfig))
}else{this.getTrigger(2).dom[this.tooltipType]=this.trigger3TipConfig
}}},onTrigger1Click:function(){this.clearValue();
this.triggerBlur.defer(50,this)
},onTrigger2Click:function(){this.onTriggerClick()
},onTrigger3Click:function(){this.fireEvent("trigger3Click",this)
},onSelect:function(record,index){Ext.ux.form.TwinTriggerComboBox.superclass.onSelect.apply(this,[record,index]);
this.triggers[0].show()
},clearValue:function(){Ext.ux.form.TwinTriggerComboBox.superclass.clearValue.call(this);
this.triggers[0].hide();
this.fireEvent("clear",this)
},insert:function(index,data){this.reset();
var rec=new this.store.recordType(data);
rec.id=rec.data.id;
this.store.insert(index,rec);
this.setValue(rec.data.id);
this.fireEvent("select",this,rec,index)
}});
Ext.reg("twintriggercombo",Ext.ux.form.TwinTriggerComboBox);
Ext.ns("Ext.ux");
Ext.ux.RatingItem=Ext.extend(Ext.Component,{starWidth:16,resetValue:"",defaultConfig:{defaultSelected:-1,nbStars:5,split:1,selected:-1,showTitles:true,cls:"",disabled:false},constructor:function(element,config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
Ext.ux.RatingItem.superclass.constructor.call(this);
this.addEvents("change","reset");
if(element==undefined){element=document.createElement("div");
element.className=this.itemCls;
this.text="";
for(var i=0;
i<(this.nbStars*this.split);
i++){this.text+='<input type="radio" name="rating'+this.id+'" value="'+(i+1)/this.split+'" '+((i+1)/this.split==this.defaultSelected?' checked="true"':"")+"/>"
}element.innerHTML=this.text
}this.el=Ext.get(element);
this.init()
},onRender:function(){Ext.ux.RatingItem.superclass.onRender.apply(this,arguments)
},init:function(){var disabled=this.disabled;
this.values=[];
this.titles=[];
this.stars=[];
this.container=this.el.createChild({cls:"ux-rating-container ux-rating-clearfix"+this.cls});
if(this.canReset){this.resetEl=this.container.createChild({cls:"ux-rating-reset",cn:[{tag:"a",title:this.showTitles?(this.resetTitle||"Reset your vote"):"",html:"Reset"}]});
this.resetEl.visibilityMode=Ext.Element.DISPLAY;
this.resetEl.hover(function(){Ext.fly(this).addClass("ux-rating-reset-hover")
},function(){Ext.fly(this).removeClass("ux-rating-reset-hover")
});
this.resetEl.on("click",this.reset,this)
}this.radioBoxes=this.el.select("input[type=radio]");
this.radioBoxes.each(this.initStar,this);
this.input=this.container.createChild({tag:"input",type:"hidden",name:this.name,value:this.values[this.defaultSelected]||this.resetValue});
this.radioBoxes.remove();
this.select(this.defaultSelected===undefined?false:this.defaultSelected);
if(disabled){this.disable()
}else{this.enable()
}},initStar:function(item,all,i){var sw=Math.floor(this.starWidth/this.split);
if(i==0){this.name=item.dom.name;
this.disabled=item.dom.disabled
}this.values[i]=item.dom.value;
this.titles[i]=item.dom.title;
if(item.dom.checked){this.defaultSelected=i
}var star=this.container.createChild({cls:"ux-rating-star"});
var starLink=star.createChild({tag:"a",html:this.values[i],title:this.showTitles?this.titles[i]:""});
if(this.split){var odd=(i%this.split);
star.setWidth(sw);
starLink.setStyle("margin-left","-"+(odd*sw)+"px")
}this.stars.push(star.dom)
},onStarClick:function(ev,t){if(!this.disabled){this.select(this.stars.indexOf(t))
}},onStarOver:function(ev,t){if(!this.disabled){this.fillTo(this.stars.indexOf(t),true)
}},onStarOut:function(ev,t){if(!this.disabled){this.fillTo(this.selected,false)
}},reset:function(ev,t){this.select(-1)
},select:function(index){if(index===false||index===-1){this.value=this.resetValue;
this.title="";
this.input.dom.value="";
if(this.canReset){this.resetEl.setOpacity(0.5)
}this.fillNone();
if(this.selected!==-1){this.fireEvent("change",this,this.values[index],this.stars[index])
}this.selected=-1
}else{if(index!==this.selected){this.selected=index;
this.value=this.values[index];
this.title=this.titles[index];
this.input.dom.value=this.value;
if(this.canReset){this.resetEl.setOpacity(0.99)
}this.fillTo(index,false);
this.fireEvent("change",this,this.values[index],this.stars[index])
}}},fillTo:function(index,hover){if(index!=-1){var addClass=hover?"ux-rating-star-hover":"ux-rating-star-on";
var removeClass=hover?"ux-rating-star-on":"ux-rating-star-hover";
Ext.each(this.stars.slice(0,index+1),function(){Ext.fly(this).removeClass(removeClass).addClass(addClass)
});
Ext.each(this.stars.slice(index+1),function(){Ext.fly(this).removeClass([removeClass,addClass])
})
}else{this.fillNone()
}},fillNone:function(){this.container.select(".ux-rating-star").removeClass(["ux-rating-star-hover","ux-rating-star-on"])
},enable:function(){if(this.canReset){this.resetEl.show()
}this.input.dom.disabled=null;
this.disabled=false;
this.container.removeClass("ux-rating-disabled");
this.container.on({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"})
},disable:function(){if(this.canReset){this.resetEl.hide()
}this.input.dom.disabled=true;
this.disabled=true;
this.container.addClass("ux-rating-disabled");
this.container.un({click:this.onStarClick,mouseover:this.onStarOver,mouseout:this.onStarOut,scope:this,delegate:"div.ux-rating-star"})
},getValue:function(){return this.values[this.selected]||this.resetValue
},destroy:function(){this.disable();
this.container.remove();
this.radioBoxes.appendTo(this.el);
if(this.selected!==-1){this.radioBoxes.elements[this.selected].checked=true
}}});
Ext.reg("ratingitem",Ext.ux.RatingItem);
Ext.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.form.FileUploadField.superclass.initComponent.call(this);
this.addEvents("fileselected")
},onRender:function(ct,position){Ext.form.FileUploadField.superclass.onRender.call(this,ct,position);
this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});
this.el.addClass("x-form-file-text");
this.el.dom.removeAttribute("name");
this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});
var btnCfg=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});
this.button=new Ext.Button(Ext.apply(btnCfg,{renderTo:this.wrap,cls:"x-form-file-btn"+(btnCfg.iconCls?" x-btn-icon":"")}));
if(this.buttonOnly){this.el.hide();
this.wrap.setWidth(this.button.getEl().getWidth())
}this.fileInput.on("change",function(){var v=this.fileInput.dom.value;
this.setValue(v);
this.fireEvent("fileselected",this,v)
},this)
},getFileInputId:function(){return this.id+"-file"
},onResize:function(w,h){Ext.form.FileUploadField.superclass.onResize.call(this,w,h);
this.wrap.setWidth(w);
if(!this.buttonOnly){var w=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;
this.el.setWidth(w)
}},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap
},getPositionEl:function(){return this.wrap
},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])
}});
Ext.reg("fileuploadfield",Ext.form.FileUploadField);
Ext.ns("Ext.ux.form");
Ext.ux.form.DateTime=Ext.extend(Ext.form.Field,{dateValidator:null,defaultAutoCreate:{tag:"input",type:"hidden"},dtSeparator:" ",hiddenFormat:"Y-m-d H:i:s",otherToNow:true,timePosition:"right",timeValidator:null,timeWidth:100,dateFormat:"m/d/y",dateAltFormats:Ext.form.DateField.prototype.altFormats,timeFormat:"g:i A",timeAltFormats:Ext.form.TimeField.prototype.altFormats,initComponent:function(){Ext.ux.form.DateTime.superclass.initComponent.call(this);
var dateConfig=Ext.apply({},{id:this.id+"-date",format:this.dateFormat||Ext.form.DateField.prototype.format,altFormats:this.dateAltFormats||Ext.form.DateField.prototype.altFormats,width:this.timeWidth,selectOnFocus:this.selectOnFocus,validator:this.dateValidator,beforeBlur:function(){},listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.dateConfig);
this.df=new Ext.form.DateField(dateConfig);
this.df.ownerCt=this;
delete (this.dateFormat);
delete (this.dateAltFormats);
var timeConfig=Ext.apply({},{id:this.id+"-time",format:this.timeFormat||Ext.form.TimeField.prototype.format,altFormats:this.timeAltFormats||Ext.form.TimeField.prototype.altFormats,width:this.timeWidth,selectOnFocus:this.selectOnFocus,validator:this.timeValidator,listeners:{blur:{scope:this,fn:this.onBlur},focus:{scope:this,fn:this.onFocus}}},this.timeConfig);
this.tf=new Ext.form.TimeField(timeConfig);
this.tf.ownerCt=this;
delete (this.timeFormat);
delete (this.timeAltFormats);
this.relayEvents(this.df,["focus","specialkey","invalid","valid"]);
this.relayEvents(this.tf,["focus","specialkey","invalid","valid"]);
this.on("specialkey",this.onSpecialKey,this)
},onRender:function(ct,position){if(this.isRendered){return
}Ext.ux.form.DateTime.superclass.onRender.call(this,ct,position);
var t;
if("below"===this.timePosition||"bellow"===this.timePosition){t=Ext.DomHelper.append(ct,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-bottom:1px",cls:"ux-datetime-date"}]},{tag:"tr",children:[{tag:"td",cls:"ux-datetime-time"}]}]},true)
}else{t=Ext.DomHelper.append(ct,{tag:"table",style:"border-collapse:collapse",children:[{tag:"tr",children:[{tag:"td",style:"padding-right:4px",cls:"ux-datetime-date"},{tag:"td",cls:"ux-datetime-time"}]}]},true)
}this.tableEl=t;
this.wrap=t.wrap({cls:"x-form-field-wrap"});
this.wrap.on("mousedown",this.onMouseDown,this,{delay:10});
this.df.render(t.child("td.ux-datetime-date"));
this.tf.render(t.child("td.ux-datetime-time"));
this.df.el.swallowEvent(["keydown","keypress"]);
this.tf.el.swallowEvent(["keydown","keypress"]);
if("side"===this.msgTarget){var elp=this.el.findParent(".x-form-element",10,true);
if(elp){this.errorIcon=elp.createChild({cls:"x-form-invalid-icon"})
}var o={errorIcon:this.errorIcon,msgTarget:"side",alignErrorIcon:this.alignErrorIcon.createDelegate(this)};
Ext.apply(this.df,o);
Ext.apply(this.tf,o)
}this.el.dom.name=this.hiddenName||this.name||this.id;
this.df.el.dom.removeAttribute("name");
this.tf.el.dom.removeAttribute("name");
this.isRendered=true;
this.updateHidden()
},adjustSize:Ext.BoxComponent.prototype.adjustSize,alignErrorIcon:function(){this.errorIcon.alignTo(this.tableEl,"tl-tr",[2,0])
},initDateValue:function(){this.dateValue=this.otherToNow?new Date():new Date(1970,0,1,0,0,0)
},clearInvalid:function(){this.df.clearInvalid();
this.tf.clearInvalid()
},markInvalid:function(msg){this.df.markInvalid(msg);
this.tf.markInvalid(msg)
},beforeDestroy:function(){if(this.isRendered){this.wrap.removeAllListeners();
this.wrap.remove();
this.tableEl.remove();
this.df.destroy();
this.tf.destroy()
}},disable:function(){if(this.isRendered){this.df.disabled=this.disabled;
this.df.onDisable();
this.tf.onDisable()
}this.disabled=true;
this.df.disabled=true;
this.tf.disabled=true;
this.fireEvent("disable",this);
return this
},enable:function(){if(this.rendered){this.df.onEnable();
this.tf.onEnable()
}this.disabled=false;
this.df.disabled=false;
this.tf.disabled=false;
this.fireEvent("enable",this);
return this
},focus:function(){this.df.focus()
},getPositionEl:function(){return this.wrap
},getResizeEl:function(){return this.wrap
},getValue:function(){return this.dateValue?new Date(this.dateValue):""
},isValid:function(){return this.df.isValid()&&this.tf.isValid()
},isVisible:function(){return this.df.rendered&&this.df.getActionEl().isVisible()
},onBlur:function(f){if(this.wrapClick){f.focus();
this.wrapClick=false
}if(f===this.df){this.updateDate()
}else{this.updateTime()
}this.updateHidden();
this.validate();
(function(){if(!this.df.hasFocus&&!this.tf.hasFocus){var v=this.getValue();
if(String(v)!==String(this.startValue)){this.fireEvent("change",this,v,this.startValue)
}this.hasFocus=false;
this.fireEvent("blur",this)
}}).defer(100,this)
},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;
this.startValue=this.getValue();
this.fireEvent("focus",this)
}},onMouseDown:function(e){if(!this.disabled){this.wrapClick="td"===e.target.nodeName.toLowerCase()
}},onSpecialKey:function(t,e){var key=e.getKey();
if(key===e.TAB){if(t===this.df&&!e.shiftKey){e.stopEvent();
this.tf.focus()
}if(t===this.tf&&e.shiftKey){e.stopEvent();
this.df.focus()
}this.updateValue()
}if(key===e.ENTER){this.updateValue()
}},reset:function(){this.df.setValue(this.originalValue);
this.tf.setValue(this.originalValue)
},setDate:function(date){this.df.setValue(date)
},setTime:function(date){this.tf.setValue(date)
},setSize:function(w,h){if(!w){return
}if("below"===this.timePosition){this.df.setSize(w,h);
this.tf.setSize(w,h);
if(Ext.isIE){this.df.el.up("td").setWidth(w);
this.tf.el.up("td").setWidth(w)
}}else{this.df.setSize(w-this.timeWidth-4,h);
this.tf.setSize(this.timeWidth,h);
if(Ext.isIE){this.df.el.up("td").setWidth(w-this.timeWidth-4);
this.tf.el.up("td").setWidth(this.timeWidth)
}}},setValue:function(val){var newDateVal=val;
if(!val&&true===this.emptyToNow){this.setValue(new Date());
return
}else{if(!val){this.setDate("");
this.setTime("");
this.updateValue();
return
}}if("number"===typeof val){newDateVal=new Date(newDateVal)
}else{if("string"===typeof val&&this.hiddenFormat){newDateVal=Date.parseDate(newDateVal,this.hiddenFormat)
}}val=val?val:new Date(1970,0,1,0,0,0);
var da;
if(newDateVal&&newDateVal instanceof Date){this.setDate(newDateVal);
this.setTime(newDateVal);
this.dateValue=new Date(Ext.isIE&&newDateVal.getTime?newDateVal.getTime():val)
}else{da=val.split(this.dtSeparator);
var d=Date.parseDate(da[0],this.df.format),af=this.df.altFormats,afa=this.df.altFormatsArray;
if(!d&&af){afa=afa||af.split("|");
for(var i=0,len=afa.length;
i<len&&!d;
i++){d=Date.parseDate(da[0],afa[i])
}}var t;
if(d&&da[1]){if(da[2]){da[1]+=da[2]
}da[1]=da[1];
t=Date.parseDate(da[1],this.tf.format);
var af=this.tf.altFormats,afa=this.tf.altFormatsArray;
if(!t&&af){afa=afa||af.split("|");
for(var i=0,len=afa.length;
i<len&&!t;
i++){t=Date.parseDate(da[1],afa[i])
}}}if(d&&t){this.setDate(da[0]);
this.setTime(da[1])
}else{this.setDate("");
Ext.form.DateField.superclass.setValue.call(this.df,val)
}}this.updateValue()
},setVisible:function(visible){if(visible){this.df.show();
this.tf.show()
}else{this.df.hide();
this.tf.hide()
}return this
},show:function(){return this.setVisible(true)
},hide:function(){return this.setVisible(false)
},updateDate:function(){var d=this.df.getValue();
if(d){var t=this.tf.getValue();
if(this.df.formatDate(this.df.parseDate(d))!==this.df.getRawValue()){this.dateValue=this.df.getRawValue()
}if(!(this.dateValue instanceof Date)&&t){if(d instanceof Date){this.dateValue=d
}else{this.initDateValue()
}if(!(t instanceof Date)){t=Date.parseDate(t,this.tf.format)
}this.dateValue.setHours(t.getHours());
this.dateValue.setMinutes(t.getMinutes());
this.dateValue.setSeconds(t.getSeconds());
this.setDate(this.dateValue);
this.setTime(this.dateValue)
}if((this.dateValue instanceof Date)){this.dateValue.setMonth(0);
this.dateValue.setFullYear(d.getFullYear());
this.dateValue.setMonth(d.getMonth(),d.getDate())
}}else{this.dateValue="";
this.setTime("")
}},updateTime:function(){var t=this.tf.getValue();
if(t&&t!==null&&t.trim()!=""&&!(this.dateValue instanceof Date)&&t){this.updateDate()
}if(t&&!(t instanceof Date)){t=Date.parseDate(t,this.tf.format)
}if(t&&!this.df.getValue()){this.initDateValue();
this.setDate(this.dateValue)
}if(this.dateValue instanceof Date){if(t){this.dateValue.setHours(t.getHours());
this.dateValue.setMinutes(t.getMinutes());
this.dateValue.setSeconds(t.getSeconds())
}else{this.dateValue.setHours(0);
this.dateValue.setMinutes(0);
this.dateValue.setSeconds(0)
}}},updateHidden:function(){if(this.isRendered){var value=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";
if((this.dateValue instanceof Date)&&this.df.getRawValue()!==null&&this.tf.getRawValue()!==null&&this.df.getRawValue().trim()!==""&&this.tf.getRawValue().trim()!==""){var value=this.dateValue instanceof Date?this.dateValue.format(this.hiddenFormat):"";
this.el.dom.value=value
}else{this.el.dom.value=this.df.getRawValue().trim();
if(this.el.dom.value!==null&&this.el.dom.value!==""&&this.tf.getValue()!==null&&this.tf.getValue().trim()!==""){this.el.dom.value+=this.dtSeparator+this.tf.getValue().trim()
}}}},updateValue:function(){this.updateDate();
this.updateTime();
this.updateHidden();
return
},validate:function(){return this.df.validate()&&this.tf.validate()
},renderer:function(field){var format=field.editor.dateFormat||Ext.ux.form.DateTime.prototype.dateFormat;
format+=" "+(field.editor.timeFormat||Ext.ux.form.DateTime.prototype.timeFormat);
var renderer=function(val){var retval=Ext.util.Format.date(val,format);
return retval
};
return renderer
}});
Ext.reg("xdatetime",Ext.ux.form.DateTime);
Ext.ns("Ext.ux.grid");
Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(config){Ext.apply(this,config);
this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});
Ext.ux.grid.RowExpander.superclass.constructor.call(this);
if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)
}this.tpl.compile()
}this.state={};
this.bodyContent={}
},getRowClass:function(record,rowIndex,p,ds){p.cols=p.cols-1;
var content=this.bodyContent[record.id];
if(!content&&!this.lazyRender){content=this.getBodyContent(record,rowIndex)
}if(content){p.body=content
}return this.state[record.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"
},init:function(grid){this.grid=grid;
var view=grid.getView();
view.getRowClass=this.getRowClass.createDelegate(this);
view.enableRowBody=true;
grid.on("render",this.onRender,this);
grid.on("destroy",this.onDestroy,this)
},onRender:function(){var grid=this.grid;
var mainBody=grid.getView().mainBody;
mainBody.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});
if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})
}if(this.expandOnDblClick){grid.on("rowdblclick",this.onRowDblClick,this)
}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();
delete this.keyNav
}var mainBody=this.grid.getView().mainBody;
if(mainBody){mainBody.un("mousedown",this.onMouseDown,this)
}},onRowDblClick:function(grid,rowIdx,e){this.toggleRow(rowIdx)
},onEnter:function(e){var g=this.grid;
var sm=g.getSelectionModel();
var sels=sm.getSelections();
for(var i=0,len=sels.length;
i<len;
i++){var rowIdx=g.getStore().indexOf(sels[i]);
this.toggleRow(rowIdx)
}},getBodyContent:function(record,index){if(!this.enableCaching){return this.tpl.apply(record.data)
}var content=this.bodyContent[record.id];
if(!content){content=this.tpl.apply(record.data);
this.bodyContent[record.id]=content
}return content
},onMouseDown:function(e,t){e.stopEvent();
var row=e.getTarget(".x-grid3-row");
this.toggleRow(row)
},renderer:function(v,p,record){p.cellAttr='rowspan="2"';
return'<div class="x-grid3-row-expander">&#160;</div>'
},beforeExpand:function(record,body,rowIndex){if(this.fireEvent("beforeexpand",this,record,body,rowIndex)!==false){if(this.tpl&&this.lazyRender){body.innerHTML=this.getBodyContent(record,rowIndex)
}return true
}else{return false
}},toggleRow:function(row){if(typeof row=="number"){row=this.grid.view.getRow(row)
}this[Ext.fly(row).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](row)
},expandRow:function(row){if(typeof row=="number"){row=this.grid.view.getRow(row)
}var record=this.grid.store.getAt(row.rowIndex);
var body=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",row);
if(this.beforeExpand(record,body,row.rowIndex)){this.state[record.id]=true;
Ext.fly(row).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");
this.fireEvent("expand",this,record,body,row.rowIndex)
}},collapseRow:function(row){if(typeof row=="number"){row=this.grid.view.getRow(row)
}var record=this.grid.store.getAt(row.rowIndex);
var body=Ext.fly(row).child("tr:nth(1) div.x-grid3-row-body",true);
if(this.fireEvent("beforecollapse",this,record,body,row.rowIndex)!==false){this.state[record.id]=false;
Ext.fly(row).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");
this.fireEvent("collapse",this,record,body,row.rowIndex)
}}});
Ext.preg("rowexpander",Ext.ux.grid.RowExpander);
Ext.grid.RowExpander=Ext.ux.grid.RowExpander;
Array.prototype.contains=function(element){return this.indexOf(element)!==-1
};
Ext.namespace("Ext.ux");
Ext.ux.DDView=function(config){if(!config.itemSelector){var tpl=config.tpl;
if(this.classRe.test(tpl)){config.tpl=tpl.replace(this.classRe,"class=$1x-combo-list-item $2$1")
}else{config.tpl=tpl.replace(this.tagRe,'$1 class="x-combo-list-item" $2')
}config.itemSelector=".x-combo-list-item"
}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(config,{border:false}))
};
Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,msgTarget:"qtip",afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);
if(this.dragGroup){this.setDraggable(this.dragGroup.split(","))
}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","))
}if(this.deletable){this.setDeletable()
}this.isDirtyFlag=false;
this.addEvents("drop")
},validate:function(){return true
},destroy:function(){this.purgeListeners();
this.getEl().removeAllListeners();
this.getEl().remove();
if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy()
}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy()
}}},getName:function(){return this.name
},setValue:function(v){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store"
}var data={};
data[this.store.reader.meta.root]=v?[].concat(v):[];
this.store.proxy=new Ext.data.MemoryProxy(data);
this.store.load()
},getValue:function(){var result="(";
this.store.each(function(rec){result+=rec.id+","
});
return result.substr(0,result.length-1)+")"
},getIds:function(){var i=0,result=new Array(this.store.getCount());
this.store.each(function(rec){result[i++]=rec.id
});
return result
},isDirty:function(){return this.isDirtyFlag
},getTargetFromEvent:function(e){var target=e.getTarget();
while((target!==null)&&(target.parentNode!=this.el.dom)){target=target.parentNode
}if(!target){target=this.el.dom.lastChild||this.el.dom
}return target
},getDragData:function(e){var target=this.findItemFromChild(e.getTarget());
if(target){if(!this.isSelected(target)){delete this.ignoreNextClick;
this.onItemClick(target,this.indexOf(target),e);
this.ignoreNextClick=true
}var dragData={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&e.ctrlKey)};
if(this.getSelectionCount()==1){var i=this.getSelectedIndexes()[0];
var n=this.getNode(i);
dragData.viewNodes.push(dragData.ddel=n);
dragData.records.push(this.store.getAt(i));
dragData.repairXY=Ext.fly(n).getXY()
}else{dragData.ddel=document.createElement("div");
dragData.ddel.className="multi-proxy";
this.collectSelection(dragData)
}return dragData
}return false
},getRepairXY:function(e){return this.dragData.repairXY
},collectSelection:function(data){data.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();
if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(i){var n=this.getNode(i);
var dragNode=n.cloneNode(true);
dragNode.id=Ext.id();
data.ddel.appendChild(dragNode);
data.records.push(this.store.getAt(i));
data.viewNodes.push(n)
},this)
}else{var i=0;
this.store.each(function(rec){if(this.isSelected(i)){var n=this.getNode(i);
var dragNode=n.cloneNode(true);
dragNode.id=Ext.id();
data.ddel.appendChild(dragNode);
data.records.push(this.store.getAt(i));
data.viewNodes.push(n)
}i++
},this)
}},setDraggable:function(ddGroup){if(ddGroup instanceof Array){Ext.each(ddGroup,this.setDraggable,this);
return
}if(this.dragZone){this.dragZone.addToGroup(ddGroup)
}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:ddGroup});
if(!this.multiSelect){this.singleSelect=true
}this.dragZone.getDragData=this.getDragData.createDelegate(this);
this.dragZone.getRepairXY=this.getRepairXY;
this.dragZone.onEndDrag=this.onEndDrag
}},setDroppable:function(ddGroup){if(ddGroup instanceof Array){Ext.each(ddGroup,this.setDroppable,this);
return
}if(this.dropZone){this.dropZone.addToGroup(ddGroup)
}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:ddGroup});
this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);
this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);
this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);
this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);
this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this)
}},getDropPoint:function(e,n,dd){if(n==this.el.dom){return"above"
}var t=Ext.lib.Dom.getY(n),b=t+n.offsetHeight;
var c=t+(b-t)/2;
var y=Ext.lib.Event.getPageY(e);
if(y<=c){return"above"
}else{return"below"
}},isValidDropPoint:function(pt,n,data){if(!data.viewNodes||(data.viewNodes.length!=1)){return true
}var d=data.viewNodes[0];
if(d==n){return false
}if((pt=="below")&&(n.nextSibling==d)){return false
}if((pt=="above")&&(n.previousSibling==d)){return false
}return true
},onNodeEnter:function(n,dd,e,data){if(this.highlightColor&&(data.sourceView!=this)){this.el.highlight(this.highlightColor)
}return false
},onNodeOver:function(n,dd,e,data){var dragElClass=this.dropNotAllowed;
var pt=this.getDropPoint(e,n,dd);
if(this.isValidDropPoint(pt,n,data)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below"
}if(pt){var targetElClass;
if(pt=="above"){dragElClass=n.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";
targetElClass="x-view-drag-insert-above"
}else{dragElClass=n.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";
targetElClass="x-view-drag-insert-below"
}if(this.lastInsertClass!=targetElClass){Ext.fly(n).replaceClass(this.lastInsertClass,targetElClass);
this.lastInsertClass=targetElClass
}}}return dragElClass
},onNodeOut:function(n,dd,e,data){this.removeDropIndicators(n)
},onNodeDrop:function(n,dd,e,data){if(this.fireEvent("drop",this,n,dd,e,data)===false){return false
}var pt=this.getDropPoint(e,n,dd);
var insertAt=(this.appendOnly||(n==this.el.dom))?this.store.getCount():n.viewIndex;
if(pt=="below"){insertAt++
}if(data.sourceView==this){if(pt=="below"){if(data.viewNodes[0]==n){data.viewNodes.shift()
}}else{if(data.viewNodes[data.viewNodes.length-1]==n){data.viewNodes.pop()
}}if(!data.viewNodes.length){return false
}if(insertAt>this.store.indexOf(data.records[0])){insertAt--
}}if(data.node instanceof Ext.tree.TreeNode){var r=data.node.getOwnerTree().recordFromNode(data.node);
if(r){data.records=[r]
}}if(!data.records){alert("Programming problem. Drag data contained no Records");
return false
}for(var i=0;
i<data.records.length;
i++){var r=data.records[i];
var dup=this.store.getById(r.id);
if(dup&&(dd!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(dup))).frame("red",1);
return true
}var x=new Ext.data.Record();
r.id=x.id;
delete x
}if(data.copy){this.store.insert(insertAt++,r.copy())
}else{if(data.sourceView){data.sourceView.isDirtyFlag=true;
data.sourceView.store.remove(r)
}if(!this.allowTrash){this.store.insert(insertAt++,r)
}}if(this.sortField){this.store.sort(this.sortField,this.sortDir)
}this.isDirtyFlag=true
}this.dragZone.cachedTarget=null;
return true
},onEndDrag:function(data,e){var d=Ext.get(this.dragData.ddel);
if(d&&d.hasClass("multi-proxy")){d.remove()
}},removeDropIndicators:function(n){if(n){Ext.fly(n).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);
this.lastInsertClass="_noclass"
}},setDeletable:function(imageUrl){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true
}var c=this.getContextMenu();
this.contextMenu.on("itemclick",function(item){switch(item.id){case"delete":this.remove(this.getSelectedIndexes());
break
}},this);
this.contextMenu.add({icon:imageUrl||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")})
},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});
this.el.on("contextmenu",this.showContextMenu,this)
}return this.contextMenu
},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this)
}},showContextMenu:function(e,item){item=this.findItemFromChild(e.getTarget());
if(item){e.stopEvent();
this.select(this.getNode(item),this.multiSelect&&e.ctrlKey,true);
this.contextMenu.showAt(e.getXY())
}},remove:function(selectedIndices){selectedIndices=[].concat(selectedIndices);
for(var i=0;
i<selectedIndices.length;
i++){var rec=this.store.getAt(selectedIndices[i]);
this.store.remove(rec)
}},onDblClick:function(e){var item=this.findItemFromChild(e.getTarget());
if(item){if(this.fireEvent("dblclick",this,this.indexOf(item),item,e)===false){return false
}if(this.dragGroup){var targets=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);
while(targets.contains(this.dropZone)){targets.remove(this.dropZone)
}if((targets.length==1)&&(targets[0].owningView)){this.dragZone.cachedTarget=null;
var el=Ext.get(targets[0].getEl());
var box=el.getBox(true);
targets[0].onNodeDrop(el.dom,{target:el.dom,xy:[box.x,box.y+box.height-1]},null,this.getDragData(e))
}}}},onItemClick:function(item,index,e){if(this.ignoreNextClick){delete this.ignoreNextClick;
return
}if(this.fireEvent("beforeclick",this,index,item,e)===false){return false
}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&e.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),index),false)
}else{if(this.isSelected(item)&&e.ctrlKey){this.deselect(item)
}else{this.deselect(item);
this.select(item,this.multiSelect&&e.ctrlKey);
this.lastSelection=item
}}e.preventDefault()
}return true
}});
Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{store:null,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",copy:false,allowDup:false,allowTrash:false,legend:null,focusClass:undefined,delimiter:",",view:null,dragGroup:null,dropGroup:null,tbar:null,appendOnly:false,sortField:null,sortDir:"ASC",defaultAutoCreate:{tag:"div"},tpl:null,initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);
this.addEvents({dblclick:true,click:true,change:true,drop:true})
},onRender:function(ct,position){var fs,cls,tpl;
Ext.ux.Multiselect.superclass.onRender.call(this,ct,position);
cls="ux-mselect";
fs=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:1px;",tbar:this.tbar});
if(!this.legend){fs.el.down("."+fs.headerCls).remove()
}fs.body.addClass(cls);
if(!this.tpl){tpl='<tpl for="."><div class="'+cls+"-item";
if(Ext.isIE||Ext.isIE7){tpl+='" unselectable=on'
}else{tpl+=' x-unselectable"'
}tpl+=">{"+this.displayField+"}</div></tpl>";
this.tpl=tpl
}if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data})
}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:cls+"-selected",tpl:this.tpl,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+cls+"-item",isFormField:false,applyTo:fs.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});
fs.add(this.view);
this.view.on("click",this.onViewClick,this);
this.view.on("beforeClick",this.onViewBeforeClick,this);
this.view.on("dblclick",this.onViewDblClick,this);
this.view.on("drop",function(ddView,n,dd,e,data){return this.fireEvent("drop",ddView,n,dd,e,data)
},this);
this.hiddenName=this.name;
var hiddenTag={tag:"input",type:"hidden",value:"",name:this.name};
if(this.isFormField){this.hiddenField=this.el.createChild(hiddenTag)
}else{this.hiddenField=Ext.get(document.body).createChild(hiddenTag)
}fs.doLayout()
},initValue:Ext.emptyFn,onViewClick:function(vw,index,node,e){var arrayIndex=this.preClickSelections.indexOf(index);
if(arrayIndex!=-1){this.preClickSelections.splice(arrayIndex,1);
this.view.clearSelections(true);
this.view.select(this.preClickSelections)
}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);
this.hiddenField.dom.value=this.getValue();
this.fireEvent("click",this,e);
this.validate()
},onViewBeforeClick:function(vw,index,node,e){this.preClickSelections=this.view.getSelectedIndexes();
if(this.disabled){return false
}},onViewDblClick:function(vw,index,node,e){return this.fireEvent("dblclick",vw,index,node,e)
},getValue:function(valueField){var returnArray=[];
var selectionsArray=this.view.getSelectedIndexes();
if(selectionsArray.length==0){return""
}for(var i=0;
i<selectionsArray.length;
i++){returnArray.push(this.store.getAt(selectionsArray[i]).get(((valueField!=null)?valueField:this.valueField)))
}return returnArray.join(this.delimiter)
},setValue:function(values){var index;
var selections=[];
this.view.clearSelections();
this.hiddenField.dom.value="";
if(!values||(values=="")){return
}if(!(values instanceof Array)){values=values.split(this.delimiter)
}for(var i=0;
i<values.length;
i++){index=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+values[i]+"$","i")).itemAt(0));
selections.push(index)
}this.view.select(selections);
this.hiddenField.dom.value=this.getValue();
this.validate()
},selectAll:function(){var selections=[];
for(var i=0;
i<this.view.store.getCount();
i++){selections.push(i)
}this.view.select(selections);
this.hiddenField.dom.value=this.getValue();
this.validate()
},reset:function(){this.setValue("")
},getRawValue:function(valueField){var tmp=this.getValue(valueField);
if(tmp.length){tmp=tmp.split(this.delimiter)
}else{tmp=[]
}return tmp
},setRawValue:function(values){setValue(values)
},validateValue:function(value){if(value.length<1){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(this.blankText);
return false
}}if(value.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));
return false
}if(value.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));
return false
}return true
}});
Ext.reg("multiselect",Ext.ux.Multiselect);
Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,fromAllowDup:false,toAllowDup:false,fromAllowTrash:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},fromTpl:null,toTpl:null,initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);
this.addEvents({rowdblclick:true,change:true})
},onRender:function(ct,position){Ext.ux.ItemSelector.superclass.onRender.call(this,ct,position);
this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.fromAllowDup,copy:this.fromAllowDup,allowTrash:this.fromAllowTrash,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.fromTpl});
this.fromMultiselect.on("dblclick",this.onRowDblClick,this);
if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})
}this.toStore.on("add",this.valueChanged,this);
this.toStore.on("remove",this.valueChanged,this);
this.toStore.on("load",this.valueChanged,this);
this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.toAllowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.fromSortField,sortDir:this.fromSortDir,tpl:this.toTpl});
this.toMultiselect.on("dblclick",this.onRowDblClick,this);
var p=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});
p.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);
var icons=new Ext.Panel({header:false});
p.add(icons);
p.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);
p.render(this.el);
icons.el.down("."+icons.bwrapCls).remove();
if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"
}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");
this.iconDown=this.imagePath+(this.iconDown||"down2.gif");
this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");
this.iconRight=this.imagePath+(this.iconRight||"right2.gif");
this.iconTop=this.imagePath+(this.iconTop||"top2.gif");
this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");
var el=icons.getEl();
if(!this.toSortField){this.toTopIcon=el.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"});
this.upIcon=el.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"})
}this.addIcon=el.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"});
this.removeIcon=el.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"});
if(!this.toSortField){this.downIcon=el.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});
el.createChild({tag:"br"});
this.toBottomIcon=el.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})
}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);
this.upIcon.on("click",this.up,this);
this.downIcon.on("click",this.down,this);
this.toBottomIcon.on("click",this.toBottom,this)
}this.addIcon.on("click",this.fromTo,this);
this.removeIcon.on("click",this.toFrom,this)
}if((!this.drawUpIcon||this.hideNavIcons)&&this.upIcon){this.upIcon.dom.style.display="none"
}if((!this.drawDownIcon||this.hideNavIcons)&&this.downIcon){this.downIcon.dom.style.display="none"
}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"
}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"
}if((!this.drawTopIcon||this.hideNavIcons)&&this.toTopIcon){this.toTopIcon.dom.style.display="none"
}if((!this.drawBotIcon||this.hideNavIcons)&&this.toBottomIcon){this.toBottomIcon.dom.style.display="none"
}var tb=p.body.first();
this.el.setWidth(p.body.first().getWidth());
p.body.removeClass();
this.hiddenName=this.name;
var hiddenTag={tag:"input",type:"hidden",value:"",name:this.name};
this.hiddenField=this.el.createChild(hiddenTag);
this.valueChanged(this.toStore)
},initValue:Ext.emptyFn,toTop:function(){var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
var records=[];
if(selectionsArray.length>0){selectionsArray.sort();
for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
records.push(record)
}selectionsArray=[];
for(var i=records.length-1;
i>-1;
i--){record=records[i];
this.toMultiselect.view.store.remove(record);
this.toMultiselect.view.store.insert(0,record);
selectionsArray.push(((records.length-1)-i))
}}this.toMultiselect.view.refresh();
this.toMultiselect.view.select(selectionsArray)
},toBottom:function(){var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
var records=[];
if(selectionsArray.length>0){selectionsArray.sort();
for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
records.push(record)
}selectionsArray=[];
for(var i=0;
i<records.length;
i++){record=records[i];
this.toMultiselect.view.store.remove(record);
this.toMultiselect.view.store.add(record);
selectionsArray.push((this.toMultiselect.view.store.getCount())-(records.length-i))
}}this.toMultiselect.view.refresh();
this.toMultiselect.view.select(selectionsArray)
},up:function(){var record=null;
var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
selectionsArray.sort();
var newSelectionsArray=[];
if(selectionsArray.length>0){for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
if((selectionsArray[i]-1)>=0){this.toMultiselect.view.store.remove(record);
this.toMultiselect.view.store.insert(selectionsArray[i]-1,record);
newSelectionsArray.push(selectionsArray[i]-1)
}}this.toMultiselect.view.refresh();
this.toMultiselect.view.select(newSelectionsArray)
}},down:function(){var record=null;
var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
selectionsArray.sort();
selectionsArray.reverse();
var newSelectionsArray=[];
if(selectionsArray.length>0){for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
if((selectionsArray[i]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(record);
this.toMultiselect.view.store.insert(selectionsArray[i]+1,record);
newSelectionsArray.push(selectionsArray[i]+1)
}}this.toMultiselect.view.refresh();
this.toMultiselect.view.select(newSelectionsArray)
}},fromTo:function(){var selectionsArray=this.fromMultiselect.view.getSelectedIndexes();
var records=[];
if(selectionsArray.length>0){for(var i=0;
i<selectionsArray.length;
i++){record=this.fromMultiselect.view.store.getAt(selectionsArray[i]);
records.push(record)
}if(!this.toAllowDup){selectionsArray=[]
}for(var i=0;
i<records.length;
i++){record=records[i];
if(this.toAllowDup){var x=new Ext.data.Record();
record.id=x.id;
delete x;
this.toMultiselect.view.store.add(record)
}else{if(this.fromAllowTrash){this.fromMultiselect.view.store.remove(record)
}this.toMultiselect.view.store.add(record);
selectionsArray.push((this.toMultiselect.view.store.getCount()-1))
}}}this.toMultiselect.view.refresh();
this.fromMultiselect.view.refresh();
if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)
}if(this.toAllowDup){this.fromMultiselect.view.select(selectionsArray)
}else{this.toMultiselect.view.select(selectionsArray)
}},toFrom:function(){var selectionsArray=this.toMultiselect.view.getSelectedIndexes();
var records=[];
if(selectionsArray.length>0){for(var i=0;
i<selectionsArray.length;
i++){record=this.toMultiselect.view.store.getAt(selectionsArray[i]);
records.push(record)
}selectionsArray=[];
for(var i=0;
i<records.length;
i++){record=records[i];
this.toMultiselect.view.store.remove(record);
if(!this.fromAllowDup){this.fromMultiselect.view.store.add(record);
selectionsArray.push((this.fromMultiselect.view.store.getCount()-1))
}}}this.fromMultiselect.view.refresh();
this.toMultiselect.view.refresh();
if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)
}this.fromMultiselect.view.select(selectionsArray)
},valueChanged:function(store){var record=null;
var values=[];
for(var i=0;
i<store.getCount();
i++){record=store.getAt(i);
values.push(record.get(this.valueField))
}this.hiddenField.dom.value=values.join(this.delimiter);
this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)
},getValue:function(){return this.hiddenField.dom.value
},onRowDblClick:function(vw,index,node,e){return this.fireEvent("rowdblclick",vw,index,node,e)
},reset:function(){range=this.toMultiselect.store.getRange();
this.toMultiselect.store.removeAll();
if(!this.fromAllowDup){this.fromMultiselect.store.add(range);
this.fromMultiselect.store.sort(this.displayField,"ASC")
}this.valueChanged(this.toMultiselect.store)
}});
Ext.reg("itemselector",Ext.ux.ItemSelector);
Ext.ns("Ext.ux");
Ext.ux.Lightbox=(function(){var els={},images=[],activeImage,initialized=false,selectors=[];
return{overlayOpacity:0.85,animate:true,resizeSpeed:8,borderSize:10,labelImage:"Image",labelOf:"of",init:function(){this.resizeDuration=this.animate?((11-this.resizeSpeed)*0.15):0;
this.overlayDuration=this.animate?0.2:0;
if(!initialized){Ext.apply(this,Ext.util.Observable.prototype);
Ext.util.Observable.constructor.call(this);
this.addEvents("open","close");
this.initMarkup();
this.initEvents();
initialized=true
}},initMarkup:function(){els.shim=Ext.DomHelper.append(document.body,{tag:"iframe",id:"ux-lightbox-shim"},true);
els.overlay=Ext.DomHelper.append(document.body,{id:"ux-lightbox-overlay"},true);
var lightboxTpl=new Ext.Template(this.getTemplate());
els.lightbox=lightboxTpl.append(document.body,{},true);
var ids=["outerImageContainer","imageContainer","image","hoverNav","navPrev","navNext","loading","loadingLink","outerDataContainer","dataContainer","data","details","caption","imageNumber","bottomNav","navClose"];
Ext.each(ids,function(id){els[id]=Ext.get("ux-lightbox-"+id)
});
Ext.each([els.overlay,els.lightbox,els.shim],function(el){el.setVisibilityMode(Ext.Element.DISPLAY);
el.hide()
});
var size=(this.animate?250:1)+"px";
els.outerImageContainer.setStyle({width:size,height:size})
},getTemplate:function(){return['<div id="ux-lightbox">','<div id="ux-lightbox-outerImageContainer">','<div id="ux-lightbox-imageContainer">','<img id="ux-lightbox-image">','<div id="ux-lightbox-hoverNav">','<a href="#" id="ux-lightbox-navPrev"></a>','<a href="#" id="ux-lightbox-navNext"></a>',"</div>",'<div id="ux-lightbox-loading">','<a id="ux-lightbox-loadingLink"></a>',"</div>","</div>","</div>",'<div id="ux-lightbox-outerDataContainer">','<div id="ux-lightbox-dataContainer">','<div id="ux-lightbox-data">','<div id="ux-lightbox-details">','<span id="ux-lightbox-caption"></span>','<span id="ux-lightbox-imageNumber"></span>',"</div>",'<div id="ux-lightbox-bottomNav">','<a href="#" id="ux-lightbox-navClose"></a>',"</div>","</div>","</div>","</div>","</div>"]
},initEvents:function(){var close=function(ev){ev.preventDefault();
this.close()
};
els.overlay.on("click",close,this);
els.loadingLink.on("click",close,this);
els.navClose.on("click",close,this);
els.lightbox.on("click",function(ev){if(ev.getTarget().id=="ux-lightbox"){this.close()
}},this);
els.navPrev.on("click",function(ev){ev.preventDefault();
this.setImage(activeImage-1)
},this);
els.navNext.on("click",function(ev){ev.preventDefault();
this.setImage(activeImage+1)
},this)
},register:function(sel,group){if(selectors.indexOf(sel)===-1){selectors.push(sel);
Ext.fly(document).on("click",function(ev){var target=ev.getTarget(sel);
if(target){ev.preventDefault();
this.open(target,sel,group)
}},this)
}},open:function(image,sel,group){group=group||false;
this.setViewSize();
els.overlay.fadeIn({duration:this.overlayDuration,endOpacity:this.overlayOpacity,callback:function(){images=[];
var index=0;
if(!group){images.push([image.href,image.title])
}else{var setItems=Ext.query(sel);
Ext.each(setItems,function(item){if(item.href){images.push([item.href,item.title])
}});
while(images[index][0]!=image.href){index++
}}var pageScroll=Ext.fly(document).getScroll();
var lightboxTop=pageScroll.top+(Ext.lib.Dom.getViewportHeight()/10);
var lightboxLeft=pageScroll.left;
els.lightbox.setStyle({top:lightboxTop+"px",left:lightboxLeft+"px"}).show();
this.setImage(index);
this.fireEvent("open",images[index])
},scope:this})
},setViewSize:function(){var viewSize=this.getViewSize(),documentSize=this.getDocumentSize();
els.overlay.setStyle({width:documentSize[0]+"px",height:documentSize[1]+"px"});
els.shim.setStyle({width:viewSize[0]+"px",height:viewSize[1]+"px"}).show()
},setImage:function(index){activeImage=index;
this.disableKeyNav();
if(this.animate){els.loading.show()
}els.image.hide();
els.hoverNav.hide();
els.navPrev.hide();
els.navNext.hide();
els.dataContainer.setOpacity(0.0001);
els.imageNumber.hide();
var preload=new Image();
preload.onload=(function(){els.image.dom.src=images[activeImage][0];
this.resizeImage(preload.width,preload.height)
}).createDelegate(this);
preload.src=images[activeImage][0]
},resizeImage:function(w,h){var wCur=els.outerImageContainer.getWidth();
var hCur=els.outerImageContainer.getHeight();
var wNew=(w+this.borderSize*2);
var hNew=(h+this.borderSize*2);
var wDiff=wCur-wNew;
var hDiff=hCur-hNew;
var afterResize=function(){els.hoverNav.setWidth(els.imageContainer.getWidth()+"px");
els.navPrev.setHeight(h+"px");
els.navNext.setHeight(h+"px");
els.outerDataContainer.setWidth(wNew+"px");
this.showImage()
};
if(hDiff!=0||wDiff!=0){els.outerImageContainer.shift({height:hNew,width:wNew,duration:this.resizeDuration,scope:this,callback:afterResize,delay:50})
}else{afterResize.call(this)
}},showImage:function(){els.loading.hide();
els.image.fadeIn({duration:this.resizeDuration,scope:this,callback:function(){this.updateDetails()
}});
this.preloadImages()
},updateDetails:function(){var detailsWidth=els.data.getWidth(true)-els.navClose.getWidth()-10;
els.details.setWidth((detailsWidth>0?detailsWidth:0)+"px");
els.caption.update(images[activeImage][1]);
els.caption.show();
if(images.length>1){els.imageNumber.update(this.labelImage+" "+(activeImage+1)+" "+this.labelOf+"  "+images.length);
els.imageNumber.show()
}els.dataContainer.fadeIn({duration:this.resizeDuration/2,scope:this,callback:function(){var documentSize=this.getDocumentSize();
els.overlay.setHeight(documentSize[1]+"px");
this.updateNav()
}})
},updateNav:function(){this.enableKeyNav();
els.hoverNav.show();
if(activeImage>0){els.navPrev.show()
}if(activeImage<(images.length-1)){els.navNext.show()
}},enableKeyNav:function(){Ext.fly(document).on("keydown",this.keyNavAction,this)
},disableKeyNav:function(){Ext.fly(document).un("keydown",this.keyNavAction,this)
},keyNavAction:function(ev){var keyCode=ev.getKey();
if(keyCode==88||keyCode==67||keyCode==27){this.close()
}else{if(keyCode==80||keyCode==37){if(activeImage!=0){this.setImage(activeImage-1)
}}else{if(keyCode==78||keyCode==39){if(activeImage!=(images.length-1)){this.setImage(activeImage+1)
}}}}},preloadImages:function(){var next,prev;
if(images.length>activeImage+1){next=new Image();
next.src=images[activeImage+1][0]
}if(activeImage>0){prev=new Image();
prev.src=images[activeImage-1][0]
}},close:function(){this.disableKeyNav();
els.lightbox.hide();
els.overlay.fadeOut({duration:this.overlayDuration});
els.shim.hide();
this.fireEvent("close",activeImage)
},getViewSize:function(){return[Ext.lib.Dom.getViewWidth(),Ext.lib.Dom.getViewHeight()]
},getDocumentSize:function(){return[Ext.lib.Dom.getDocumentWidth(),Ext.lib.Dom.getDocumentHeight()]
}}
})();
Ext.onReady(Ext.ux.Lightbox.init,Ext.ux.Lightbox);
Ext.namespace("Ext.ux.form");
Ext.ux.form.SuperBoxSelect=function(config){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,config);
this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear")
};
Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{addNewDataOnBlur:false,allowAddNewData:false,allowQueryAll:true,backspaceDeletesLastItem:true,classField:null,clearBtnCls:"",clearLastQueryOnEscape:false,clearOnEscape:false,displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",fixFocusOnTabSelect:true,forceFormValue:true,forceSameValueQuery:false,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:true,pinList:true,preventDuplicates:true,queryFilterRe:"",queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:true,renderFieldBtns:true,stackItems:false,styleField:null,supressClearValueRemoveEvents:false,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(false),usedRecords:new Ext.util.MixedCollection(false),addedRecords:[],remoteLookup:[],hideTrigger:true,grow:false,resizable:false,multiSelectMode:false,preRenderValue:null,filteredQueryData:""});
if(this.queryFilterRe){if(Ext.isString(this.queryFilterRe)){this.queryFilterRe=new RegExp(this.queryFilterRe)
}}if(this.transform){this.doTransform()
}if(this.forceFormValue){this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this})
}Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this);
if(this.mode==="remote"&&this.store){this.store.on("load",this.onStoreLoad,this)
}},onRender:function(ct,position){var h=this.hiddenName;
this.hiddenName=null;
Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,ct,position);
this.hiddenName=h;
this.manageNameAttribute();
var extraClass=(this.stackItems===true)?"x-superboxselect-stacked":"";
if(this.renderFieldBtns){extraClass+=" x-superboxselect-display-btns"
}this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field");
this.wrapEl=this.el.wrap({tag:"ul"});
this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+extraClass});
this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"});
if(this.renderFieldBtns){this.setupFieldButtons().manageClearBtn()
}this.setupFormInterception()
},doTransform:function(){var s=Ext.getDom(this.transform),transformValues=[];
if(!this.store){this.mode="local";
var d=[],opts=s.options;
for(var i=0,len=opts.length;
i<len;
i++){var o=opts[i],oe=Ext.get(o),value=oe.getAttributeNS(null,"value")||"",cls=oe.getAttributeNS(null,"className")||"",style=oe.getAttributeNS(null,"style")||"";
if(o.selected){transformValues.push(value)
}d.push([value,o.text,cls,typeof(style)==="string"?style:style.cssText])
}this.store=new Ext.data.SimpleStore({id:0,fields:["value","text","cls","style"],data:d});
Ext.apply(this,{valueField:"value",displayField:"text",classField:"cls",styleField:"style"})
}if(transformValues.length){this.value=transformValues.join(",")
}},setupFieldButtons:function(){this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"});
this.buttonClear=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-clear "+this.clearBtnCls});
if(this.allowQueryAll){this.buttonExpand=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-expand "+this.expandBtnCls})
}this.initButtonEvents();
return this
},initButtonEvents:function(){this.buttonClear.addClassOnOver("x-superboxselect-btn-over").on("click",function(e){e.stopEvent();
if(this.disabled){return
}this.clearValue();
this.el.focus()
},this);
if(this.allowQueryAll){this.buttonExpand.addClassOnOver("x-superboxselect-btn-over").on("click",function(e){e.stopEvent();
if(this.disabled){return
}if(this.isExpanded()){this.multiSelectMode=false
}else{if(this.pinList){this.multiSelectMode=true
}}this.onTriggerClick()
},this)
}},removeButtonEvents:function(){this.buttonClear.removeAllListeners();
if(this.allowQueryAll){this.buttonExpand.removeAllListeners()
}return this
},clearCurrentFocus:function(){if(this.currentFocus){this.currentFocus.onLnkBlur();
this.currentFocus=null
}return this
},initEvents:function(){var el=this.el;
el.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});
this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this});
this.wrapEl.on("click",this.onWrapClick,this);
this.outerWrapEl.on("click",this.onWrapClick,this);
this.inputEl.focus=function(){el.focus()
};
Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this);
Ext.apply(this.keyNav,{tab:function(e){if(this.fixFocusOnTabSelect&&this.isExpanded()){e.stopEvent();
el.blur();
this.onViewClick(false);
this.focus(false,10);
return true
}this.onViewClick(false);
if(el.dom.value!==""){this.setRawValue("")
}return true
},down:function(e){if(!this.isExpanded()&&!this.currentFocus){if(this.allowQueryAll){this.onTriggerClick()
}}else{this.inKeyMode=true;
this.selectNext()
}},enter:function(){}})
},onClick:function(){this.clearCurrentFocus();
this.collapse();
this.autoSize()
},beforeBlur:function(){if(this.allowAddNewData&&this.addNewDataOnBlur){var v=this.el.dom.value;
if(v!==""){this.fireNewItemEvent(v)
}}Ext.form.ComboBox.superclass.beforeBlur.call(this)
},onFocus:function(){this.outerWrapEl.addClass(this.focusClass);
Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this)
},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass);
this.clearCurrentFocus();
if(this.el.dom.value!==""){this.applyEmptyText();
this.autoSize()
}Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this)
},onCollapse:function(){this.view.clearSelections();
this.multiSelectMode=false
},onWrapClick:function(e){e.stopEvent();
this.collapse();
this.el.focus();
this.clearCurrentFocus()
},markInvalid:function(msg){var elp,t;
if(!this.rendered||this.preventMark){return
}this.outerWrapEl.addClass(this.invalidClass);
msg=msg||this.invalidText;
switch(this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:msg,qclass:"x-form-invalid-tip"});
Ext.apply(this.wrapEl.dom,{qtip:msg,qclass:"x-form-invalid-tip"});
if(Ext.QuickTips){Ext.QuickTips.enable()
}break;
case"title":this.el.dom.title=msg;
this.wrapEl.dom.title=msg;
this.outerWrapEl.dom.title=msg;
break;
case"under":if(!this.errorEl){elp=this.getErrorCt();
if(!elp){this.el.dom.title=msg;
break
}this.errorEl=elp.createChild({cls:"x-form-invalid-msg"});
this.errorEl.setWidth(elp.getWidth(true)-20)
}this.errorEl.update(msg);
Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);
break;
case"side":if(!this.errorIcon){elp=this.getErrorCt();
if(!elp){this.el.dom.title=msg;
break
}this.errorIcon=elp.createChild({cls:"x-form-invalid-icon"})
}this.alignErrorIcon();
Ext.apply(this.errorIcon.dom,{qtip:msg,qclass:"x-form-invalid-tip"});
this.errorIcon.show();
this.on("resize",this.alignErrorIcon,this);
break;
default:t=Ext.getDom(this.msgTarget);
t.innerHTML=msg;
t.style.display=this.msgDisplay;
break
}this.fireEvent("invalid",this,msg)
},clearInvalid:function(){if(!this.rendered||this.preventMark){return
}this.outerWrapEl.removeClass(this.invalidClass);
switch(this.msgTarget){case"qtip":this.el.dom.qtip="";
this.wrapEl.dom.qtip="";
break;
case"title":this.el.dom.title="";
this.wrapEl.dom.title="";
this.outerWrapEl.dom.title="";
break;
case"under":if(this.errorEl){Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this)
}break;
case"side":if(this.errorIcon){this.errorIcon.dom.qtip="";
this.errorIcon.hide();
this.un("resize",this.alignErrorIcon,this)
}break;
default:var t=Ext.getDom(this.msgTarget);
t.innerHTML="";
t.style.display="none";
break
}this.fireEvent("valid",this)
},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3])
}},expand:function(){if(this.isExpanded()||!this.hasFocus){return
}if(this.bufferSize){this.doResize(this.bufferSize);
delete this.bufferSize
}this.list.alignTo(this.outerWrapEl,this.listAlign).show();
this.innerList.setOverflow("auto");
this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});
this.fireEvent("expand",this)
},restrictHeight:function(){var inner=this.innerList.dom,st=inner.scrollTop,list=this.list;
inner.style.height="";
var pad=list.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,h=Math.max(inner.clientHeight,inner.offsetHeight,inner.scrollHeight),ha=this.getPosition()[1]-Ext.getBody().getScroll().top,hb=Ext.lib.Dom.getViewHeight()-ha-this.getSize().height,space=Math.max(ha,hb,this.minHeight||0)-list.shadowOffset-pad-5;
h=Math.min(h,space,this.maxHeight);
this.innerList.setHeight(h);
list.beginUpdate();
list.setHeight(h+pad);
list.alignTo(this.outerWrapEl,this.listAlign);
list.endUpdate();
if(this.multiSelectMode){inner.scrollTop=st
}},validateValue:function(val){if(this.items.getCount()===0){if(this.allowBlank){this.clearInvalid();
return true
}else{this.markInvalid(this.blankText);
return false
}}this.clearInvalid();
return true
},manageNameAttribute:function(){if(this.items.getCount()===0&&this.forceFormValue){this.el.dom.setAttribute("name",this.hiddenName||this.name)
}else{this.el.dom.removeAttribute("name")
}},setupFormInterception:function(){var form;
this.findParentBy(function(p){if(p.getForm){form=p.getForm()
}});
if(form){var formGet=form.getValues;
form.getValues=function(asString){this.el.dom.disabled=true;
var oldVal=this.el.dom.value;
this.setRawValue("");
var vals=formGet.call(form);
this.el.dom.disabled=false;
this.setRawValue(oldVal);
if(this.forceFormValue&&this.items.getCount()===0){vals[this.name]=""
}return asString?Ext.urlEncode(vals):vals
}.createDelegate(this)
}},onResize:function(w,h,rw,rh){var reduce=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;
if(this.wrapEl){this._width=w;
this.outerWrapEl.setWidth(w-reduce);
if(this.renderFieldBtns){reduce+=(this.buttonWrap.getWidth()+20);
this.wrapEl.setWidth(w-reduce)
}}Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,w,h,rw,rh);
this.autoSize()
},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this);
this.items.each(function(item){item.enable()
});
if(this.renderFieldBtns){this.initButtonEvents()
}},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this);
this.items.each(function(item){item.disable()
});
if(this.renderFieldBtns){this.removeButtonEvents()
}},clearValue:function(supressRemoveEvent){Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this);
this.preventMultipleRemoveEvents=supressRemoveEvent||this.supressClearValueRemoveEvents||false;
this.removeAllItems();
this.preventMultipleRemoveEvents=false;
this.fireEvent("clear",this);
return this
},fireNewItemEvent:function(val){this.view.clearSelections();
this.collapse();
this.setRawValue("");
if(this.queryFilterRe){val=val.replace(this.queryFilterRe,"");
if(!val){return
}}this.fireEvent("newitem",this,val,this.filteredQueryData)
},onKeyUp:function(e){if(this.editable!==false&&(!e.isSpecialKey()||e.getKey()===e.BACKSPACE)&&this.itemDelimiterKey.indexOf!==e.getKey()&&(!e.hasModifier()||e.shiftKey)){this.lastKey=e.getKey();
this.dqTask.delay(this.queryDelay)
}},onKeyDownHandler:function(e,t){var toDestroy,nextFocus,idx;
if(e.getKey()===e.ESC){if(!this.isExpanded()){if(this.el.dom.value!=""&&(this.clearOnEscape||this.clearLastQueryOnEscape)){if(this.clearOnEscape){this.el.dom.value=""
}if(this.clearLastQueryOnEscape){this.lastQuery=""
}e.stopEvent()
}}}if((e.getKey()===e.DELETE||e.getKey()===e.SPACE)&&this.currentFocus){e.stopEvent();
toDestroy=this.currentFocus;
this.on("expand",function(){this.collapse()
},this,{single:true});
idx=this.items.indexOfKey(this.currentFocus.key);
this.clearCurrentFocus();
if(idx<(this.items.getCount()-1)){nextFocus=this.items.itemAt(idx+1)
}toDestroy.preDestroy(true);
if(nextFocus){(function(){nextFocus.onLnkFocus();
this.currentFocus=nextFocus
}).defer(200,this)
}return true
}var val=this.el.dom.value,it,ctrl=e.ctrlKey;
if(this.itemDelimiterKey===e.getKey()){e.stopEvent();
if(val!==""){if(ctrl||!this.isExpanded()){this.fireNewItemEvent(val)
}else{this.onViewClick();
if(this.unsetDelayCheck){this.delayedCheck=true;
this.unsetDelayCheck.defer(10,this)
}}}else{if(!this.isExpanded()){return
}this.onViewClick();
if(this.unsetDelayCheck){this.delayedCheck=true;
this.unsetDelayCheck.defer(10,this)
}}return true
}if(val!==""){this.autoSize();
return
}if(e.getKey()===e.HOME){e.stopEvent();
if(this.items.getCount()>0){this.collapse();
it=this.items.get(0);
it.el.focus()
}return true
}if(e.getKey()===e.BACKSPACE){e.stopEvent();
if(this.currentFocus){toDestroy=this.currentFocus;
this.on("expand",function(){this.collapse()
},this,{single:true});
idx=this.items.indexOfKey(toDestroy.key);
this.clearCurrentFocus();
if(idx<(this.items.getCount()-1)){nextFocus=this.items.itemAt(idx+1)
}toDestroy.preDestroy(true);
if(nextFocus){(function(){nextFocus.onLnkFocus();
this.currentFocus=nextFocus
}).defer(200,this)
}return
}else{it=this.items.get(this.items.getCount()-1);
if(it){if(this.backspaceDeletesLastItem){this.on("expand",function(){this.collapse()
},this,{single:true});
it.preDestroy(true)
}else{if(this.navigateItemsWithTab){it.onElClick()
}else{this.on("expand",function(){this.collapse();
this.currentFocus=it;
this.currentFocus.onLnkFocus.defer(20,this.currentFocus)
},this,{single:true})
}}}return true
}}if(!e.isNavKeyPress()){this.multiSelectMode=false;
this.clearCurrentFocus();
return
}if(e.getKey()===e.LEFT||(e.getKey()===e.UP&&!this.isExpanded())){e.stopEvent();
this.collapse();
it=this.items.get(this.items.getCount()-1);
if(this.navigateItemsWithTab){if(it){it.focus()
}}else{if(this.currentFocus){idx=this.items.indexOfKey(this.currentFocus.key);
this.clearCurrentFocus();
if(idx!==0){this.currentFocus=this.items.itemAt(idx-1);
this.currentFocus.onLnkFocus()
}}else{this.currentFocus=it;
if(it){it.onLnkFocus()
}}}return true
}if(e.getKey()===e.DOWN){if(this.currentFocus){this.collapse();
e.stopEvent();
idx=this.items.indexOfKey(this.currentFocus.key);
if(idx==(this.items.getCount()-1)){this.clearCurrentFocus.defer(10,this)
}else{this.clearCurrentFocus();
this.currentFocus=this.items.itemAt(idx+1);
if(this.currentFocus){this.currentFocus.onLnkFocus()
}}return true
}}if(e.getKey()===e.RIGHT){this.collapse();
it=this.items.itemAt(0);
if(this.navigateItemsWithTab){if(it){it.focus()
}}else{if(this.currentFocus){idx=this.items.indexOfKey(this.currentFocus.key);
this.clearCurrentFocus();
if(idx<(this.items.getCount()-1)){this.currentFocus=this.items.itemAt(idx+1);
if(this.currentFocus){this.currentFocus.onLnkFocus()
}}}else{this.currentFocus=it;
if(it){it.onLnkFocus()
}}}}},onKeyUpBuffered:function(e){if(!e.isNavKeyPress()){this.autoSize()
}},reset:function(){this.killItems();
Ext.ux.form.SuperBoxSelect.superclass.reset.call(this);
this.addedRecords=[];
this.autoSize().setRawValue("")
},applyEmptyText:function(){this.setRawValue("");
if(this.items.getCount()>0){this.el.removeClass(this.emptyClass);
this.setRawValue("");
return this
}if(this.rendered&&this.emptyText&&this.getRawValue().length<1){this.setRawValue(this.emptyText);
this.el.addClass(this.emptyClass)
}return this
},removeAllItems:function(){this.items.each(function(item){item.preDestroy(true)
},this);
this.manageClearBtn();
return this
},killItems:function(){this.items.each(function(item){item.kill()
},this);
this.resetStore();
this.items.clear();
this.manageClearBtn();
return this
},resetStore:function(){this.store.clearFilter();
if(!this.removeValuesFromStore){return this
}this.usedRecords.each(function(rec){this.store.add(rec)
},this);
this.usedRecords.clear();
if(!this.store.remoteSort){this.store.sort(this.displayField,"ASC")
}return this
},sortStore:function(){var ss=this.store.getSortState();
if(ss&&ss.field){this.store.sort(ss.field,ss.direction)
}return this
},getCaption:function(dataObject){if(typeof this.displayFieldTpl==="string"){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl)
}var caption,recordData=dataObject instanceof Ext.data.Record?dataObject.data:dataObject;
if(this.displayFieldTpl){caption=this.displayFieldTpl.apply(recordData)
}else{if(this.displayField){caption=recordData[this.displayField]
}}return caption
},addRecord:function(record){var display=record.data[this.displayField],caption=this.getCaption(record),val=record.data[this.valueField],cls=this.classField?record.data[this.classField]:"",style=this.styleField?record.data[this.styleField]:"";
if(this.removeValuesFromStore){this.usedRecords.add(val,record);
this.store.remove(record)
}this.addItemBox(val,display,caption,cls,style);
this.fireEvent("additem",this,val,record)
},createRecord:function(recordData){if(!this.recordConstructor){var recordFields=[{name:this.valueField},{name:this.displayField}];
if(this.classField){recordFields.push({name:this.classField})
}if(this.styleField){recordFields.push({name:this.styleField})
}this.recordConstructor=Ext.data.Record.create(recordFields)
}return new this.recordConstructor(recordData)
},addItems:function(newItemObjects){if(Ext.isArray(newItemObjects)){Ext.each(newItemObjects,function(item){this.addItem(item)
},this)
}else{this.addItem(newItemObjects)
}},addNewItem:function(newItemObject){this.addItem(newItemObject,true)
},addItem:function(newItemObject,forcedAdd){var val=newItemObject[this.valueField];
if(this.disabled){return false
}if(this.preventDuplicates&&this.hasValue(val)){return
}var record=this.findRecord(this.valueField,val);
if(record){this.addRecord(record);
return
}else{if(!this.allowAddNewData){return
}}if(this.mode==="remote"){this.remoteLookup.push(newItemObject);
this.doQuery(val,false,false,forcedAdd);
return
}var rec=this.createRecord(newItemObject);
this.store.add(rec);
this.addRecord(rec);
return true
},addItemBox:function(itemVal,itemDisplay,itemCaption,itemClass,itemStyle){var hConfig,parseStyle=function(s){var ret="";
switch(typeof s){case"function":ret=s.call();
break;
case"object":for(var p in s){ret+=p+":"+s[p]+";"
}break;
case"string":ret=s+";"
}return ret
},itemKey=Ext.id(null,"sbx-item"),box=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+itemClass,style:parseStyle(this.extraItemStyle)+" "+itemStyle,caption:itemCaption,display:itemDisplay,value:itemVal,key:itemKey,listeners:{remove:function(item){if(this.fireEvent("beforeremoveitem",this,item.value)===false){return false
}this.items.removeKey(item.key);
if(this.removeValuesFromStore){if(this.usedRecords.containsKey(item.value)){this.store.add(this.usedRecords.get(item.value));
this.usedRecords.removeKey(item.value);
this.sortStore();
if(this.view){this.view.render()
}}}if(!this.preventMultipleRemoveEvents){this.fireEvent.defer(250,this,["removeitem",this,item.value,this.findInStore(item.value)])
}},destroy:function(){this.collapse();
this.autoSize().manageClearBtn().validateValue()
},scope:this}});
box.render();
hConfig={tag:"input",type:"hidden",value:itemVal,name:(this.hiddenName||this.name)};
if(this.disabled){Ext.apply(hConfig,{disabled:"disabled"})
}box.hidden=this.el.insertSibling(hConfig,"before");
this.items.add(itemKey,box);
this.applyEmptyText().autoSize().manageClearBtn().validateValue()
},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered){return this
}var cls="x-superboxselect-btn-hide";
if(this.items.getCount()===0){this.buttonClear.addClass(cls)
}else{this.buttonClear.removeClass(cls)
}return this
},findInStore:function(val){var index=this.store.find(this.valueField,val);
if(index>-1){return this.store.getAt(index)
}return false
},getSelectedRecords:function(){var ret=[];
if(this.removeValuesFromStore){ret=this.usedRecords.getRange()
}else{var vals=[];
this.items.each(function(item){vals.push(item.value)
});
Ext.each(vals,function(val){ret.push(this.findInStore(val))
},this)
}return ret
},findSelectedItem:function(el){var ret;
this.items.each(function(item){if(item.el.dom===el){ret=item;
return false
}});
return ret
},findSelectedRecord:function(el){var ret,item=this.findSelectedItem(el);
if(item){ret=this.findSelectedRecordByValue(item.value)
}return ret
},findSelectedRecordByValue:function(val){var ret;
if(this.removeValuesFromStore){this.usedRecords.each(function(rec){if(rec.get(this.valueField)==val){ret=rec;
return false
}},this)
}else{ret=this.findInStore(val)
}return ret
},getValue:function(){var ret=[];
this.items.each(function(item){ret.push(item.value)
});
return ret.join(this.valueDelimiter)
},getCount:function(){return this.items.getCount()
},getValueEx:function(){var ret=[];
this.items.each(function(item){var newItem={};
newItem[this.valueField]=item.value;
newItem[this.displayField]=item.display;
if(this.classField){newItem[this.classField]=item.cls||""
}if(this.styleField){newItem[this.styleField]=item.style||""
}ret.push(newItem)
},this);
return ret
},initValue:function(){if(Ext.isObject(this.value)||Ext.isArray(this.value)){this.setValueEx(this.value);
this.originalValue=this.getValue()
}else{Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this)
}if(this.mode==="remote"){this.setOriginal=true
}},addValue:function(value,forceCreate){if(Ext.isEmpty(value)){return
}var values=value;
if(!Ext.isArray(value)){value=""+value;
values=value.split(this.valueDelimiter)
}Ext.each(values,function(val){var record=this.findRecord(this.valueField,val);
if(record){this.addRecord(record)
}else{if(forceCreate){var data={id:val};
data[this.displayField]=val;
record=new Ext.data.Record(data,val);
this.store.add([record]);
this.addRecord(record)
}else{if(this.mode==="remote"){this.doQuery(val,true,true,false)
}}}},this)
},setValue:function(value,forceCreate){if(!this.rendered){this.value=value;
return
}this.removeAllItems().resetStore();
this.remoteLookup=[];
this.addValue(value,forceCreate)
},setValueEx:function(data){if(!this.rendered){this.value=data;
return
}this.removeAllItems().resetStore();
if(!Ext.isArray(data)){data=[data]
}this.remoteLookup=[];
if(this.allowAddNewData&&this.mode==="remote"){Ext.each(data,function(d){var r=this.findRecord(this.valueField,d[this.valueField])||this.createRecord(d);
this.addRecord(r)
},this);
return
}Ext.each(data,function(item){this.addItem(item)
},this)
},hasValue:function(val){var has=false;
this.items.each(function(item){if(item.value==val){has=true;
return false
}},this);
return has
},onSelect:function(record,index){if(this.fireEvent("beforeselect",this,record,index)!==false){var val=record.data[this.valueField];
if(this.preventDuplicates&&this.hasValue(val)){return
}this.setRawValue("");
this.lastSelectionText="";
if(this.fireEvent("beforeadditem",this,val,record,this.filteredQueryData)!==false){this.addRecord(record)
}if(this.store.getCount()===0||!this.multiSelectMode){this.collapse()
}else{this.restrictHeight()
}}},onDestroy:function(){this.items.purgeListeners();
this.killItems();
if(this.allowQueryAll){Ext.destroy(this.buttonExpand)
}if(this.renderFieldBtns){Ext.destroy(this.buttonClear,this.buttonWrap)
}Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl);
Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this)
},autoSize:function(){if(!this.rendered){return this
}if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el)
}var el=this.el,v=el.dom.value,d=document.createElement("div");
if(v===""&&this.emptyText&&this.items.getCount()<1){v=this.emptyText
}d.appendChild(document.createTextNode(v));
v=d.innerHTML;
d=null;
v+="&#160;";
var w=Math.max(this.metrics.getWidth(v)+24,24);
if(typeof this._width!="undefined"){w=Math.min(this._width,w)
}this.el.setWidth(w);
if(Ext.isIE){this.el.dom.style.top="0"
}this.fireEvent("autosize",this,w);
return this
},shouldQuery:function(q){if(this.lastQuery){var m=q.match("^"+this.lastQuery);
if(!m||this.store.getCount()){return true
}else{return(m[0]!==this.lastQuery)
}}return true
},doQuery:function(q,forceAll,valuesQuery,forcedAdd,sync){q=Ext.isEmpty(q)?"":q;
if(this.queryFilterRe){this.filteredQueryData="";
var m=q.match(this.queryFilterRe);
if(m&&m.length){this.filteredQueryData=m[0]
}q=q.replace(this.queryFilterRe,"");
if(!q&&m){return
}}var qe={query:q,forceAll:forceAll,combo:this,cancel:false};
if(this.fireEvent("beforequery",qe)===false||qe.cancel){return false
}q=qe.query;
forceAll=qe.forceAll;
if(forceAll===true||(q.length>=this.minChars)||valuesQuery&&!Ext.isEmpty(q)){if(forcedAdd||this.forceSameValueQuery||this.shouldQuery(q)){this.lastQuery=q;
if(this.mode=="local"){this.selectedIndex=-1;
if(forceAll){this.store.clearFilter()
}else{this.store.filter(this.displayField,q)
}this.onLoad()
}else{this.store.baseParams[this.queryParam]=q;
this.store.baseParams[this.queryValuesIndicator]=valuesQuery;
this.store.load({params:this.getParams(q)});
if(!forcedAdd){this.expand()
}}}else{this.selectedIndex=-1;
this.onLoad()
}}},onStoreLoad:function(store,records,options){var q=options.params[this.queryParam]||store.baseParams[this.queryParam]||"",isValuesQuery=options.params[this.queryValuesIndicator]||store.baseParams[this.queryValuesIndicator];
if(this.removeValuesFromStore){this.store.each(function(record){if(this.usedRecords.containsKey(record.get(this.valueField))){this.store.remove(record)
}},this)
}if(isValuesQuery){var params=q.split(this.queryValuesDelimiter);
Ext.each(params,function(p){this.remoteLookup.remove(p);
var rec=this.findRecord(this.valueField,p);
if(rec){this.addRecord(rec)
}},this);
if(this.setOriginal){this.setOriginal=false;
this.originalValue=this.getValue()
}}if(q!==""&&this.allowAddNewData){Ext.each(this.remoteLookup,function(r){if(typeof r==="object"&&r[this.valueField]===q){this.remoteLookup.remove(r);
if(records.length&&records[0].get(this.valueField)===q){this.addRecord(records[0]);
return
}var rec=this.createRecord(r);
this.store.add(rec);
this.addRecord(rec);
this.addedRecords.push(rec);
(function(){if(this.isExpanded()){this.collapse()
}}).defer(10,this);
return
}},this)
}var toAdd=[];
if(q===""){Ext.each(this.addedRecords,function(rec){if(this.preventDuplicates&&this.usedRecords.containsKey(rec.get(this.valueField))){return
}toAdd.push(rec)
},this)
}else{var re=new RegExp(Ext.escapeRe(q)+".*","i");
Ext.each(this.addedRecords,function(rec){if(this.preventDuplicates&&this.usedRecords.containsKey(rec.get(this.valueField))){return
}if(re.test(rec.get(this.displayField))){toAdd.push(rec)
}},this)
}this.store.add(toAdd);
this.sortStore();
if(this.store.getCount()===0&&this.isExpanded()){this.collapse()
}}});
Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect);
Ext.ux.form.SuperBoxSelectItem=function(config){Ext.apply(this,config);
Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this)
};
Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this)
},onElClick:function(e){var o=this.owner;
o.clearCurrentFocus().collapse();
if(o.navigateItemsWithTab){this.focus()
}else{o.el.dom.focus();
var that=this;
(function(){this.onLnkFocus();
o.currentFocus=this
}).defer(10,this)
}},onLnkClick:function(e){if(e){e.stopEvent()
}this.preDestroy();
if(!this.owner.navigateItemsWithTab){this.owner.el.focus()
}},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus");
this.owner.outerWrapEl.addClass("x-form-focus")
},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus");
this.owner.outerWrapEl.removeClass("x-form-focus")
},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:true});
this.el.addClassOnOver("x-superboxselect-item x-superboxselect-item-hover")
},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this})
},enableAllListeners:function(){this.enableElListeners();
this.enableLnkListeners()
},disableAllListeners:function(){this.el.removeAllListeners();
this.lnk.un("click",this.onLnkClick,this);
this.lnk.un("focus",this.onLnkFocus,this);
this.lnk.un("blur",this.onLnkBlur,this)
},onRender:function(ct,position){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,ct,position);
var el=this.el;
if(el){el.remove()
}this.el=el=ct.createChild({tag:"li"},ct.last());
el.addClass("x-superboxselect-item");
var btnEl=this.owner.navigateItemsWithTab?(Ext.isSafari?"button":"a"):"span";
var itemKey=this.key;
Ext.apply(el,{focus:function(){var c=this.down(btnEl+".x-superboxselect-item-close");
if(c){c.focus()
}},preDestroy:function(){this.preDestroy()
}.createDelegate(this)});
this.enableElListeners();
el.update(this.caption);
var cfg={tag:btnEl,"class":"x-superboxselect-item-close",tabIndex:this.owner.navigateItemsWithTab?"0":"-1"};
if(btnEl==="a"){cfg.href="#"
}this.lnk=el.createChild(cfg);
if(!this.disabled){this.enableLnkListeners()
}else{this.disableAllListeners()
}this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});
this.setupKeyMap()
},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right")
},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left")
},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var l=this.owner.items.get(0).el.focus();
if(l){l.el.focus()
}},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus()
},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]);
this.keyMap.stopEvent=true
},moveFocus:function(dir){var el=this.el[dir=="left"?"prev":"next"]()||this.owner.el;
el.focus.defer(100,el)
},preDestroy:function(supressEffect){if(this.fireEvent("remove",this)===false){return
}var actionDestroy=function(){if(this.owner.navigateItemsWithTab){this.moveFocus("right")
}this.hidden.remove();
this.hidden=null;
this.destroy()
};
if(supressEffect){actionDestroy.call(this)
}else{this.el.hide({duration:0.2,callback:actionDestroy,scope:this})
}return this
},kill:function(){this.hidden.remove();
this.hidden=null;
this.purgeListeners();
this.destroy()
},onDisable:function(){if(this.hidden){this.hidden.dom.setAttribute("disabled","disabled")
}this.keyMap.disable();
Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this)
},onEnable:function(){if(this.hidden){this.hidden.dom.removeAttribute("disabled")
}this.keyMap.enable();
Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this)
},onDestroy:function(){Ext.destroy(this.lnk,this.el);
Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this)
}});
Proj4js={defaultDatum:"WGS84",transform:function(source,dest,point){if(!source.readyToUse||!dest.readyToUse){this.reportError("Proj4js initialization for "+source.srsCode+" not yet complete");
return point
}if((source.srsProjNumber=="900913"&&dest.datumCode!="WGS84")||(dest.srsProjNumber=="900913"&&source.datumCode!="WGS84")){var wgs84=Proj4js.WGS84;
this.transform(source,wgs84,point);
source=wgs84
}if(source.projName=="longlat"){point.x*=Proj4js.common.D2R;
point.y*=Proj4js.common.D2R
}else{if(source.to_meter){point.x*=source.to_meter;
point.y*=source.to_meter
}source.inverse(point)
}if(source.from_greenwich){point.x+=source.from_greenwich
}point=this.datum_transform(source.datum,dest.datum,point);
if(dest.from_greenwich){point.x-=dest.from_greenwich
}if(dest.projName=="longlat"){point.x*=Proj4js.common.R2D;
point.y*=Proj4js.common.R2D
}else{dest.forward(point);
if(dest.to_meter){point.x/=dest.to_meter;
point.y/=dest.to_meter
}}return point
},datum_transform:function(source,dest,point){if(source.compare_datums(dest)){return point
}if(source.datum_type==Proj4js.common.PJD_NODATUM||dest.datum_type==Proj4js.common.PJD_NODATUM){return point
}if(source.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")
}if(dest.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")
}if(source.es!=dest.es||source.a!=dest.a||source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM||dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM){source.geodetic_to_geocentric(point);
if(source.datum_type==Proj4js.common.PJD_3PARAM||source.datum_type==Proj4js.common.PJD_7PARAM){source.geocentric_to_wgs84(point)
}if(dest.datum_type==Proj4js.common.PJD_3PARAM||dest.datum_type==Proj4js.common.PJD_7PARAM){dest.geocentric_from_wgs84(point)
}dest.geocentric_to_geodetic(point)
}if(dest.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented yet.")
}return point
},reportError:function(msg){},extend:function(destination,source){destination=destination||{};
if(source){for(var property in source){var value=source[property];
if(value!==undefined){destination[property]=value
}}}return destination
},Class:function(){var Class=function(){this.initialize.apply(this,arguments)
};
var extended={};
var parent;
for(var i=0;
i<arguments.length;
++i){if(typeof arguments[i]=="function"){parent=arguments[i].prototype
}else{parent=arguments[i]
}Proj4js.extend(extended,parent)
}Class.prototype=extended;
return Class
},bind:function(func,object){var args=Array.prototype.slice.apply(arguments,[2]);
return function(){var newArgs=args.concat(Array.prototype.slice.apply(arguments,[0]));
return func.apply(object,newArgs)
}
},scriptName:"proj4js.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath){return this.libPath
}var scriptName=this.scriptName;
var scriptNameLen=scriptName.length;
var scripts=document.getElementsByTagName("script");
for(var i=0;
i<scripts.length;
i++){var src=scripts[i].getAttribute("src");
if(src){var index=src.lastIndexOf(scriptName);
if((index>-1)&&(index+scriptNameLen==src.length)){this.libPath=src.slice(0,-scriptNameLen);
break
}}}return this.libPath||""
},loadScript:function(url,onload,onfail,loadCheck){var script=document.createElement("script");
script.defer=false;
script.type="text/javascript";
script.id=url;
script.src=url;
script.onload=onload;
script.onerror=onfail;
script.loadCheck=loadCheck;
if(/MSIE/.test(navigator.userAgent)){script.onreadystatechange=this.checkReadyState
}document.getElementsByTagName("head")[0].appendChild(script)
},checkReadyState:function(){if(this.readyState=="loaded"){if(!this.loadCheck()){this.onerror()
}else{this.onload()
}}}};
Proj4js.Proj=Proj4js.Class({readyToUse:false,title:null,projName:null,units:null,datum:null,initialize:function(srsCode){this.srsCodeInput=srsCode;
if(srsCode.indexOf("urn:")==0){var urn=srsCode.split(":");
if((urn[1]=="ogc"||urn[1]=="x-ogc")&&(urn[2]=="def")&&(urn[3]=="crs")&&urn.length==7){srsCode=urn[4]+":"+urn[6]
}}else{if(srsCode.indexOf("http://")==0){var url=srsCode.split("#");
if(url[0].match(/epsg.org/)){srsCode="EPSG:"+url[1]
}else{if(url[0].match(/RIG.xml/)){srsCode="IGNF:"+url[1]
}}}}this.srsCode=srsCode.toUpperCase();
if(this.srsCode.indexOf("EPSG")==0){this.srsCode=this.srsCode;
this.srsAuth="epsg";
this.srsProjNumber=this.srsCode.substring(5)
}else{if(this.srsCode.indexOf("IGNF")==0){this.srsCode=this.srsCode;
this.srsAuth="IGNF";
this.srsProjNumber=this.srsCode.substring(5)
}else{if(this.srsCode.indexOf("CRS")==0){this.srsCode=this.srsCode;
this.srsAuth="CRS";
this.srsProjNumber=this.srsCode.substring(4)
}else{this.srsAuth="";
this.srsProjNumber=this.srsCode
}}}this.loadProjDefinition()
},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode]){this.defsLoaded();
return
}var url=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";
Proj4js.loadScript(url,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))
},loadFromService:function(){var url=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js";
Proj4js.loadScript(url,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))
},defsLoaded:function(){this.parseDefs();
this.loadProjCode(this.projName)
},checkDefsLoaded:function(){if(Proj4js.defs[this.srsCode]){return true
}else{return false
}},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);
Proj4js.extend(Proj4js.defs[this.srsCode],Proj4js.defs.WGS84);
this.defsLoaded()
},loadProjCode:function(projName){if(Proj4js.Proj[projName]){this.initTransforms();
return
}var url=Proj4js.getScriptLocation()+"projCode/"+projName+".js";
Proj4js.loadScript(url,Proj4js.bind(this.loadProjCodeSuccess,this,projName),Proj4js.bind(this.loadProjCodeFailure,this,projName),Proj4js.bind(this.checkCodeLoaded,this,projName))
},loadProjCodeSuccess:function(projName){if(Proj4js.Proj[projName].dependsOn){this.loadProjCode(Proj4js.Proj[projName].dependsOn)
}else{this.initTransforms()
}},loadProjCodeFailure:function(projName){Proj4js.reportError("failed to find projection file for: "+projName)
},checkCodeLoaded:function(projName){if(Proj4js.Proj[projName]){return true
}else{return false
}},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);
this.init();
this.readyToUse=true
},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];
var paramName,paramVal;
var paramArray=this.defData.split("+");
for(var prop=0;
prop<paramArray.length;
prop++){var property=paramArray[prop].split("=");
paramName=property[0].toLowerCase();
paramVal=property[1];
switch(paramName.replace(/\s/gi,"")){case"":break;
case"title":this.title=paramVal;
break;
case"proj":this.projName=paramVal.replace(/\s/gi,"");
break;
case"units":this.units=paramVal.replace(/\s/gi,"");
break;
case"datum":this.datumCode=paramVal.replace(/\s/gi,"");
break;
case"nadgrids":this.nagrids=paramVal.replace(/\s/gi,"");
break;
case"ellps":this.ellps=paramVal.replace(/\s/gi,"");
break;
case"a":this.a=parseFloat(paramVal);
break;
case"b":this.b=parseFloat(paramVal);
break;
case"rf":this.rf=parseFloat(paramVal);
break;
case"lat_0":this.lat0=paramVal*Proj4js.common.D2R;
break;
case"lat_1":this.lat1=paramVal*Proj4js.common.D2R;
break;
case"lat_2":this.lat2=paramVal*Proj4js.common.D2R;
break;
case"lat_ts":this.lat_ts=paramVal*Proj4js.common.D2R;
break;
case"lon_0":this.long0=paramVal*Proj4js.common.D2R;
break;
case"alpha":this.alpha=parseFloat(paramVal)*Proj4js.common.D2R;
break;
case"lonc":this.longc=paramVal*Proj4js.common.D2R;
break;
case"x_0":this.x0=parseFloat(paramVal);
break;
case"y_0":this.y0=parseFloat(paramVal);
break;
case"k_0":this.k0=parseFloat(paramVal);
break;
case"k":this.k0=parseFloat(paramVal);
break;
case"R_A":this.R=true;
break;
case"zone":this.zone=parseInt(paramVal);
break;
case"south":this.utmSouth=true;
break;
case"towgs84":this.datum_params=paramVal.split(",");
break;
case"to_meter":this.to_meter=parseFloat(paramVal);
break;
case"from_greenwich":this.from_greenwich=paramVal*Proj4js.common.D2R;
break;
case"pm":paramVal=paramVal.replace(/\s/gi,"");
this.from_greenwich=Proj4js.PrimeMeridian[paramVal]?Proj4js.PrimeMeridian[paramVal]:parseFloat(paramVal);
this.from_greenwich*=Proj4js.common.D2R;
break;
case"no_defs":break;
default:}}this.deriveConstants()
},deriveConstants:function(){if(this.nagrids=="@null"){this.datumCode="none"
}if(this.datumCode&&this.datumCode!="none"){var datumDef=Proj4js.Datum[this.datumCode];
if(datumDef){this.datum_params=datumDef.towgs84.split(",");
this.ellps=datumDef.ellipse;
this.datumName=datumDef.datumName?datumDef.datumName:this.datumCode
}}if(!this.a){var ellipse=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;
Proj4js.extend(this,ellipse)
}if(this.rf&&!this.b){this.b=(1-1/this.rf)*this.a
}if(Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=true;
this.b=this.a
}this.a2=this.a*this.a;
this.b2=this.b*this.b;
this.es=(this.a2-this.b2)/this.a2;
this.e=Math.sqrt(this.es);
if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.RA4+this.es*Proj4js.RA6));
this.a2=this.a*this.a;
this.b2=this.b*this.b;
this.es=0
}this.ep2=(this.a2-this.b2)/this.b2;
if(!this.k0){this.k0=1
}this.datum=new Proj4js.datum(this)
}});
Proj4js.Proj.longlat={init:function(){},forward:function(pt){return pt
},inverse:function(pt){return pt
}};
Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:900913":"+title= Google Mercator EPSG:900913 +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};
Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:900913"];
Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:0.7853981633974483,R2D:57.29577951308232,D2R:0.017453292519943295,SEC_TO_RAD:0.00000484813681109536,EPSLN:1e-10,MAX_ITER:20,COS_67P5:0.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:0.16666666666666666,RA4:0.04722222222222222,RA6:0.022156084656084655,RV4:0.06944444444444445,RV6:0.04243827160493827,msfnz:function(eccent,sinphi,cosphi){var con=eccent*sinphi;
return cosphi/(Math.sqrt(1-con*con))
},tsfnz:function(eccent,phi,sinphi){var con=eccent*sinphi;
var com=0.5*eccent;
con=Math.pow(((1-con)/(1+con)),com);
return(Math.tan(0.5*(this.HALF_PI-phi))/con)
},phi2z:function(eccent,ts){var eccnth=0.5*eccent;
var con,dphi;
var phi=this.HALF_PI-2*Math.atan(ts);
for(i=0;
i<=15;
i++){con=eccent*Math.sin(phi);
dphi=this.HALF_PI-2*Math.atan(ts*(Math.pow(((1-con)/(1+con)),eccnth)))-phi;
phi+=dphi;
if(Math.abs(dphi)<=1e-10){return phi
}}alert("phi2z has NoConvergence");
return(-9999)
},qsfnz:function(eccent,sinphi,cosphi){var con;
if(eccent>1e-7){con=eccent*sinphi;
return((1-eccent*eccent)*(sinphi/(1-con*con)-(0.5/eccent)*Math.log((1-con)/(1+con))))
}else{return(2*sinphi)
}},asinz:function(x){if(Math.abs(x)>1){x=(x>1)?1:-1
}return Math.asin(x)
},e0fn:function(x){return(1-0.25*x*(1+x/16*(3+1.25*x)))
},e1fn:function(x){return(0.375*x*(1+0.25*x*(1+0.46875*x)))
},e2fn:function(x){return(0.05859375*x*x*(1+0.75*x))
},e3fn:function(x){return(x*x*x*(35/3072))
},mlfn:function(e0,e1,e2,e3,phi){return(e0*phi-e1*Math.sin(2*phi)+e2*Math.sin(4*phi)-e3*Math.sin(6*phi))
},srat:function(esinp,exp){return(Math.pow((1-esinp)/(1+esinp),exp))
},sign:function(x){if(x<0){return(-1)
}else{return(1)
}},adjust_lon:function(x){x=(Math.abs(x)<this.PI)?x:(x-(this.sign(x)*this.TWO_PI));
return x
},adjust_lat:function(x){x=(Math.abs(x)<this.HALF_PI)?x:(x-(this.sign(x)*this.PI));
return x
},latiso:function(eccent,phi,sinphi){if(Math.abs(phi)>this.HALF_PI){return +Number.NaN
}if(phi==this.HALF_PI){return Number.POSITIVE_INFINITY
}if(phi==-1*this.HALF_PI){return -1*Number.POSITIVE_INFINITY
}var con=eccent*sinphi;
return Math.log(Math.tan((this.HALF_PI+phi)/2))+eccent*Math.log((1-con)/(1+con))/2
},fL:function(x,L){return 2*Math.atan(x*Math.exp(L))-this.HALF_PI
},invlatiso:function(eccent,ts){var phi=this.fL(1,ts);
var Iphi=0;
var con=0;
do{Iphi=phi;
con=eccent*Math.sin(Iphi);
phi=this.fL(Math.exp(eccent*Math.log((1+con)/(1-con))/2),ts)
}while(Math.abs(phi-Iphi)>1e-12);
return phi
},sinh:function(x){var r=Math.exp(x);
r=(r-1/r)/2;
return r
},cosh:function(x){var r=Math.exp(x);
r=(r+1/r)/2;
return r
},tanh:function(x){var r=Math.exp(x);
r=(r-1/r)/(r+1/r);
return r
},asinh:function(x){var s=(x>=0?1:-1);
return s*(Math.log(Math.abs(x)+Math.sqrt(x*x+1)))
},acosh:function(x){return 2*Math.log(Math.sqrt((x+1)/2)+Math.sqrt((x-1)/2))
},atanh:function(x){return Math.log((x-1)/(x+1))/2
},gN:function(a,e,sinphi){var temp=e*sinphi;
return a/Math.sqrt(1-temp*temp)
}};
Proj4js.datum=Proj4js.Class({initialize:function(proj){this.datum_type=Proj4js.common.PJD_WGS84;
if(proj.datumCode&&proj.datumCode=="none"){this.datum_type=Proj4js.common.PJD_NODATUM
}if(proj&&proj.datum_params){for(var i=0;
i<proj.datum_params.length;
i++){proj.datum_params[i]=parseFloat(proj.datum_params[i])
}if(proj.datum_params[0]!=0||proj.datum_params[1]!=0||proj.datum_params[2]!=0){this.datum_type=Proj4js.common.PJD_3PARAM
}if(proj.datum_params.length>3){if(proj.datum_params[3]!=0||proj.datum_params[4]!=0||proj.datum_params[5]!=0||proj.datum_params[6]!=0){this.datum_type=Proj4js.common.PJD_7PARAM;
proj.datum_params[3]*=Proj4js.common.SEC_TO_RAD;
proj.datum_params[4]*=Proj4js.common.SEC_TO_RAD;
proj.datum_params[5]*=Proj4js.common.SEC_TO_RAD;
proj.datum_params[6]=(proj.datum_params[6]/1000000)+1
}}}if(proj){this.a=proj.a;
this.b=proj.b;
this.es=proj.es;
this.ep2=proj.ep2;
this.datum_params=proj.datum_params
}},compare_datums:function(dest){if(this.datum_type!=dest.datum_type){return false
}else{if(this.a!=dest.a||Math.abs(this.es-dest.es)>5e-11){return false
}else{if(this.datum_type==Proj4js.common.PJD_3PARAM){return(this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2])
}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){return(this.datum_params[0]==dest.datum_params[0]&&this.datum_params[1]==dest.datum_params[1]&&this.datum_params[2]==dest.datum_params[2]&&this.datum_params[3]==dest.datum_params[3]&&this.datum_params[4]==dest.datum_params[4]&&this.datum_params[5]==dest.datum_params[5]&&this.datum_params[6]==dest.datum_params[6])
}else{if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT){return strcmp(pj_param(this.params,"snadgrids").s,pj_param(dest.params,"snadgrids").s)==0
}else{return true
}}}}}},geodetic_to_geocentric:function(p){var Longitude=p.x;
var Latitude=p.y;
var Height=p.z?p.z:0;
var X;
var Y;
var Z;
var Error_Code=0;
var Rn;
var Sin_Lat;
var Sin2_Lat;
var Cos_Lat;
if(Latitude<-Proj4js.common.HALF_PI&&Latitude>-1.001*Proj4js.common.HALF_PI){Latitude=-Proj4js.common.HALF_PI
}else{if(Latitude>Proj4js.common.HALF_PI&&Latitude<1.001*Proj4js.common.HALF_PI){Latitude=Proj4js.common.HALF_PI
}else{if((Latitude<-Proj4js.common.HALF_PI)||(Latitude>Proj4js.common.HALF_PI)){Proj4js.reportError("geocent:lat out of range:"+Latitude);
return null
}}}if(Longitude>Proj4js.common.PI){Longitude-=(2*Proj4js.common.PI)
}Sin_Lat=Math.sin(Latitude);
Cos_Lat=Math.cos(Latitude);
Sin2_Lat=Sin_Lat*Sin_Lat;
Rn=this.a/(Math.sqrt(1-this.es*Sin2_Lat));
X=(Rn+Height)*Cos_Lat*Math.cos(Longitude);
Y=(Rn+Height)*Cos_Lat*Math.sin(Longitude);
Z=((Rn*(1-this.es))+Height)*Sin_Lat;
p.x=X;
p.y=Y;
p.z=Z;
return Error_Code
},geocentric_to_geodetic:function(p){var genau=1e-12;
var genau2=(genau*genau);
var maxiter=30;
var P;
var RR;
var CT;
var ST;
var RX;
var RK;
var RN;
var CPHI0;
var SPHI0;
var CPHI;
var SPHI;
var SDPHI;
var At_Pole;
var iter;
var X=p.x;
var Y=p.y;
var Z=p.z?p.z:0;
var Longitude;
var Latitude;
var Height;
At_Pole=false;
P=Math.sqrt(X*X+Y*Y);
RR=Math.sqrt(X*X+Y*Y+Z*Z);
if(P/this.a<genau){At_Pole=true;
Longitude=0;
if(RR/this.a<genau){Latitude=Proj4js.common.HALF_PI;
Height=-this.b;
return
}}else{Longitude=Math.atan2(Y,X)
}CT=Z/RR;
ST=P/RR;
RX=1/Math.sqrt(1-this.es*(2-this.es)*ST*ST);
CPHI0=ST*(1-this.es)*RX;
SPHI0=CT*RX;
iter=0;
do{iter++;
RN=this.a/Math.sqrt(1-this.es*SPHI0*SPHI0);
Height=P*CPHI0+Z*SPHI0-RN*(1-this.es*SPHI0*SPHI0);
RK=this.es*RN/(RN+Height);
RX=1/Math.sqrt(1-RK*(2-RK)*ST*ST);
CPHI=ST*(1-RK)*RX;
SPHI=CT*RX;
SDPHI=SPHI*CPHI0-CPHI*SPHI0;
CPHI0=CPHI;
SPHI0=SPHI
}while(SDPHI*SDPHI>genau2&&iter<maxiter);
Latitude=Math.atan(SPHI/Math.abs(CPHI));
p.x=Longitude;
p.y=Latitude;
p.z=Height;
return p
},geocentric_to_geodetic_noniter:function(p){var X=p.x;
var Y=p.y;
var Z=p.z?p.z:0;
var Longitude;
var Latitude;
var Height;
var W;
var W2;
var T0;
var T1;
var S0;
var S1;
var Sin_B0;
var Sin3_B0;
var Cos_B0;
var Sin_p1;
var Cos_p1;
var Rn;
var Sum;
var At_Pole;
X=parseFloat(X);
Y=parseFloat(Y);
Z=parseFloat(Z);
At_Pole=false;
if(X!=0){Longitude=Math.atan2(Y,X)
}else{if(Y>0){Longitude=Proj4js.common.HALF_PI
}else{if(Y<0){Longitude=-Proj4js.common.HALF_PI
}else{At_Pole=true;
Longitude=0;
if(Z>0){Latitude=Proj4js.common.HALF_PI
}else{if(Z<0){Latitude=-Proj4js.common.HALF_PI
}else{Latitude=Proj4js.common.HALF_PI;
Height=-this.b;
return
}}}}}W2=X*X+Y*Y;
W=Math.sqrt(W2);
T0=Z*Proj4js.common.AD_C;
S0=Math.sqrt(T0*T0+W2);
Sin_B0=T0/S0;
Cos_B0=W/S0;
Sin3_B0=Sin_B0*Sin_B0*Sin_B0;
T1=Z+this.b*this.ep2*Sin3_B0;
Sum=W-this.a*this.es*Cos_B0*Cos_B0*Cos_B0;
S1=Math.sqrt(T1*T1+Sum*Sum);
Sin_p1=T1/S1;
Cos_p1=Sum/S1;
Rn=this.a/Math.sqrt(1-this.es*Sin_p1*Sin_p1);
if(Cos_p1>=Proj4js.common.COS_67P5){Height=W/Cos_p1-Rn
}else{if(Cos_p1<=-Proj4js.common.COS_67P5){Height=W/-Cos_p1-Rn
}else{Height=Z/Sin_p1+Rn*(this.es-1)
}}if(At_Pole==false){Latitude=Math.atan(Sin_p1/Cos_p1)
}p.x=Longitude;
p.y=Latitude;
p.z=Height;
return p
},geocentric_to_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM){p.x+=this.datum_params[0];
p.y+=this.datum_params[1];
p.z+=this.datum_params[2]
}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var Dx_BF=this.datum_params[0];
var Dy_BF=this.datum_params[1];
var Dz_BF=this.datum_params[2];
var Rx_BF=this.datum_params[3];
var Ry_BF=this.datum_params[4];
var Rz_BF=this.datum_params[5];
var M_BF=this.datum_params[6];
var x_out=M_BF*(p.x-Rz_BF*p.y+Ry_BF*p.z)+Dx_BF;
var y_out=M_BF*(Rz_BF*p.x+p.y-Rx_BF*p.z)+Dy_BF;
var z_out=M_BF*(-Ry_BF*p.x+Rx_BF*p.y+p.z)+Dz_BF;
p.x=x_out;
p.y=y_out;
p.z=z_out
}}},geocentric_from_wgs84:function(p){if(this.datum_type==Proj4js.common.PJD_3PARAM){p.x-=this.datum_params[0];
p.y-=this.datum_params[1];
p.z-=this.datum_params[2]
}else{if(this.datum_type==Proj4js.common.PJD_7PARAM){var Dx_BF=this.datum_params[0];
var Dy_BF=this.datum_params[1];
var Dz_BF=this.datum_params[2];
var Rx_BF=this.datum_params[3];
var Ry_BF=this.datum_params[4];
var Rz_BF=this.datum_params[5];
var M_BF=this.datum_params[6];
var x_tmp=(p.x-Dx_BF)/M_BF;
var y_tmp=(p.y-Dy_BF)/M_BF;
var z_tmp=(p.z-Dz_BF)/M_BF;
p.x=x_tmp+Rz_BF*y_tmp-Ry_BF*z_tmp;
p.y=-Rz_BF*x_tmp+y_tmp+Rx_BF*z_tmp;
p.z=Ry_BF*x_tmp-Rx_BF*y_tmp+z_tmp
}}}});
Proj4js.Point=Proj4js.Class({initialize:function(x,y,z){if(typeof x=="object"){this.x=x[0];
this.y=x[1];
this.z=x[2]||0
}else{if(typeof x=="string"){var coords=x.split(",");
this.x=parseFloat(coords[0]);
this.y=parseFloat(coords[1]);
this.z=parseFloat(coords[2])||0
}else{this.x=x;
this.y=y;
this.z=z||0
}}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)
},toString:function(){return("x="+this.x+",y="+this.y)
},toShortString:function(){return(this.x+", "+this.y)
}});
Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};
Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};
Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};
Proj4js.WGS84=new Proj4js.Proj("WGS84");
Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;
Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("aeaInitEqualLatitudes");
return
}this.temp=this.b/this.a;
this.es=1-Math.pow(this.temp,2);
this.e3=Math.sqrt(this.es);
this.sin_po=Math.sin(this.lat1);
this.cos_po=Math.cos(this.lat1);
this.t1=this.sin_po;
this.con=this.sin_po;
this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);
this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);
this.sin_po=Math.sin(this.lat2);
this.cos_po=Math.cos(this.lat2);
this.t2=this.sin_po;
this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);
this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);
this.sin_po=Math.sin(this.lat0);
this.cos_po=Math.cos(this.lat0);
this.t3=this.sin_po;
this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);
if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1)
}else{this.ns0=this.con
}this.c=this.ms1*this.ms1+this.ns0*this.qs1;
this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0
},forward:function(p){var lon=p.x;
var lat=p.y;
this.sin_phi=Math.sin(lat);
this.cos_phi=Math.cos(lat);
var qs=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi);
var rh1=this.a*Math.sqrt(this.c-this.ns0*qs)/this.ns0;
var theta=this.ns0*Proj4js.common.adjust_lon(lon-this.long0);
var x=rh1*Math.sin(theta)+this.x0;
var y=this.rh-rh1*Math.cos(theta)+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){var rh1,qs,con,theta,lon,lat;
p.x-=this.x0;
p.y=this.rh-p.y+this.y0;
if(this.ns0>=0){rh1=Math.sqrt(p.x*p.x+p.y*p.y);
con=1
}else{rh1=-Math.sqrt(p.x*p.x+p.y*p.y);
con=-1
}theta=0;
if(rh1!=0){theta=Math.atan2(con*p.x,con*p.y)
}con=rh1*this.ns0/this.a;
qs=(this.c-con*con)/this.ns0;
if(this.e3>=1e-10){con=1-0.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;
if(Math.abs(Math.abs(con)-Math.abs(qs))>1e-10){lat=this.phi1z(this.e3,qs)
}else{if(qs>=0){lat=0.5*PI
}else{lat=-0.5*PI
}}}else{lat=this.phi1z(e3,qs)
}lon=Proj4js.common.adjust_lon(theta/this.ns0+this.long0);
p.x=lon;
p.y=lat;
return p
},phi1z:function(eccent,qs){var con,com,dphi;
var phi=Proj4js.common.asinz(0.5*qs);
if(eccent<Proj4js.common.EPSLN){return phi
}var eccnts=eccent*eccent;
for(var i=1;
i<=25;
i++){sinphi=Math.sin(phi);
cosphi=Math.cos(phi);
con=eccent*sinphi;
com=1-con*con;
dphi=0.5*com*com/cosphi*(qs/(1-eccnts)-sinphi/com+0.5/eccent*Math.log((1-con)/(1+con)));
phi=phi+dphi;
if(Math.abs(dphi)<=1e-7){return phi
}}Proj4js.reportError("aea:phi1z:Convergence error");
return null
}};
Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);
if(!this.rc){Proj4js.reportError("sterea:init:E_ERROR_0");
return
}this.sinc0=Math.sin(this.phic0);
this.cosc0=Math.cos(this.phic0);
this.R2=2*this.rc;
if(!this.title){this.title="Oblique Stereographic Alternative"
}},forward:function(p){p.x=Proj4js.common.adjust_lon(p.x-this.long0);
Proj4js.Proj.gauss.forward.apply(this,[p]);
sinc=Math.sin(p.y);
cosc=Math.cos(p.y);
cosl=Math.cos(p.x);
k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl);
p.x=k*cosc*Math.sin(p.x);
p.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl);
p.x=this.a*p.x+this.x0;
p.y=this.a*p.y+this.y0;
return p
},inverse:function(p){var lon,lat;
p.x=(p.x-this.x0)/this.a;
p.y=(p.y-this.y0)/this.a;
p.x/=this.k0;
p.y/=this.k0;
if((rho=Math.sqrt(p.x*p.x+p.y*p.y))){c=2*Math.atan2(rho,this.R2);
sinc=Math.sin(c);
cosc=Math.cos(c);
lat=Math.asin(cosc*this.sinc0+p.y*sinc*this.cosc0/rho);
lon=Math.atan2(p.x*sinc,rho*this.cosc0*cosc-p.y*this.sinc0*sinc)
}else{lat=this.phic0;
lon=0
}p.x=lon;
p.y=lat;
Proj4js.Proj.gauss.inverse.apply(this,[p]);
p.x=Proj4js.common.adjust_lon(p.x+this.long0);
return p
}};
Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);
this.e1=Proj4js.common.e1fn(this.es);
this.e2=Proj4js.common.e2fn(this.es);
this.e3=Proj4js.common.e3fn(this.es);
this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)
},forward:function(p){var lon=p.x;
var lat=p.y;
var delta_lon=Proj4js.common.adjust_lon(lon-this.long0);
var con;
var x,y;
var sin_phi=Math.sin(lat);
var cos_phi=Math.cos(lat);
if(this.sphere){var b=cos_phi*Math.sin(delta_lon);
if((Math.abs(Math.abs(b)-1))<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");
return(93)
}else{x=0.5*this.a*this.k0*Math.log((1+b)/(1-b));
con=Math.acos(cos_phi*Math.cos(delta_lon)/Math.sqrt(1-b*b));
if(lat<0){con=-con
}y=this.a*this.k0*(con-this.lat0)
}}else{var al=cos_phi*delta_lon;
var als=Math.pow(al,2);
var c=this.ep2*Math.pow(cos_phi,2);
var tq=Math.tan(lat);
var t=Math.pow(tq,2);
con=1-this.es*Math.pow(sin_phi,2);
var n=this.a/Math.sqrt(con);
var ml=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);
x=this.k0*n*al*(1+als/6*(1-t+c+als/20*(5-18*t+Math.pow(t,2)+72*c-58*this.ep2)))+this.x0;
y=this.k0*(ml-this.ml0+n*tq*(als*(0.5+als/24*(5-t+9*c+4*Math.pow(c,2)+als/30*(61-58*t+Math.pow(t,2)+600*c-330*this.ep2)))))+this.y0
}p.x=x;
p.y=y;
return p
},inverse:function(p){var con,phi;
var delta_phi;
var i;
var max_iter=6;
var lat,lon;
if(this.sphere){var f=Math.exp(p.x/(this.a*this.k0));
var g=0.5*(f-1/f);
var temp=this.lat0+p.y/(this.a*this.k0);
var h=Math.cos(temp);
con=Math.sqrt((1-h*h)/(1+g*g));
lat=Math.asinz(con);
if(temp<0){lat=-lat
}if((g==0)&&(h==0)){lon=this.long0
}else{lon=Proj4js.common.adjust_lon(Math.atan2(g,h)+this.long0)
}}else{var x=p.x-this.x0;
var y=p.y-this.y0;
con=(this.ml0+y/this.k0)/this.a;
phi=con;
for(i=0;
;
i++){delta_phi=((con+this.e1*Math.sin(2*phi)-this.e2*Math.sin(4*phi)+this.e3*Math.sin(6*phi))/this.e0)-phi;
phi+=delta_phi;
if(Math.abs(delta_phi)<=Proj4js.common.EPSLN){break
}if(i>=max_iter){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");
return(95)
}}if(Math.abs(phi)<Proj4js.common.HALF_PI){var sin_phi=Math.sin(phi);
var cos_phi=Math.cos(phi);
var tan_phi=Math.tan(phi);
var c=this.ep2*Math.pow(cos_phi,2);
var cs=Math.pow(c,2);
var t=Math.pow(tan_phi,2);
var ts=Math.pow(t,2);
con=1-this.es*Math.pow(sin_phi,2);
var n=this.a/Math.sqrt(con);
var r=n*(1-this.es)/con;
var d=x/(n*this.k0);
var ds=Math.pow(d,2);
lat=phi-(n*tan_phi*ds/r)*(0.5-ds/24*(5+3*t+10*c-4*cs-9*this.ep2-ds/30*(61+90*t+298*c+45*ts-252*this.ep2-3*cs)));
lon=Proj4js.common.adjust_lon(this.long0+(d*(1-ds/6*(1+2*t+c-ds/20*(5-2*c+28*t-3*cs+8*this.ep2+24*ts)))/cos_phi))
}else{lat=Proj4js.common.HALF_PI*Proj4js.common.sign(y);
lon=this.long0
}}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.equi={init:function(){if(!this.x0){this.x0=0
}if(!this.y0){this.y0=0
}if(!this.lat0){this.lat0=0
}if(!this.long0){this.long0=0
}},forward:function(p){var lon=p.x;
var lat=p.y;
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var x=this.x0+this.a*dlon*Math.cos(this.lat0);
var y=this.y0+this.a*lat;
this.t1=x;
this.t2=Math.cos(this.lat0);
p.x=x;
p.y=y;
return p
},inverse:function(p){p.x-=this.x0;
p.y-=this.y0;
var lat=p.y/this.a;
if(Math.abs(lat)>Proj4js.common.HALF_PI){Proj4js.reportError("equi:Inv:DataError")
}var lon=Proj4js.common.adjust_lon(this.long0+p.x/(this.a*Math.cos(this.lat0)));
p.x=lon;
p.y=lat
}};
Proj4js.Proj.merc={init:function(){if(this.lat_ts){if(this.sphere){this.k0=Math.cos(this.lat_ts)
}else{this.k0=Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts))
}}},forward:function(p){var lon=p.x;
var lat=p.y;
if(lat*Proj4js.common.R2D>90&&lat*Proj4js.common.R2D<-90&&lon*Proj4js.common.R2D>180&&lon*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+lon+" : "+lat);
return null
}var x,y;
if(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");
return null
}else{if(this.sphere){x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0);
y=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+0.5*lat))
}else{var sinphi=Math.sin(lat);
var ts=Proj4js.common.tsfnz(this.e,lat,sinphi);
x=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(lon-this.long0);
y=this.y0-this.a*this.k0*Math.log(ts)
}p.x=x;
p.y=y;
return p
}},inverse:function(p){var x=p.x-this.x0;
var y=p.y-this.y0;
var lon,lat;
if(this.sphere){lat=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-y/this.a*this.k0))
}else{var ts=Math.exp(-y/(this.a*this.k0));
lat=Proj4js.common.phi2z(this.e,ts);
if(lat==-9999){Proj4js.reportError("merc:inverse: lat = -9999");
return null
}}lon=Proj4js.common.adjust_lon(this.long0+x/(this.a*this.k0));
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.sinu={init:function(){this.R=6370997
},forward:function(p){var x,y,delta_lon;
var lon=p.x;
var lat=p.y;
delta_lon=Proj4js.common.adjust_lon(lon-this.long0);
x=this.R*delta_lon*Math.cos(lat)+this.x0;
y=this.R*lat+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){var lat,temp,lon;
p.x-=this.x0;
p.y-=this.y0;
lat=p.y/this.R;
if(Math.abs(lat)>Proj4js.common.HALF_PI){Proj4js.reportError("sinu:Inv:DataError")
}temp=Math.abs(lat)-Proj4js.common.HALF_PI;
if(Math.abs(temp)>Proj4js.common.EPSLN){temp=this.long0+p.x/(this.R*Math.cos(lat));
lon=Proj4js.common.adjust_lon(temp)
}else{lon=this.long0
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.eqdc={init:function(){if(!this.mode){this.mode=0
}this.temp=this.b/this.a;
this.es=1-Math.pow(this.temp,2);
this.e=Math.sqrt(this.es);
this.e0=Proj4js.common.e0fn(this.es);
this.e1=Proj4js.common.e1fn(this.es);
this.e2=Proj4js.common.e2fn(this.es);
this.e3=Proj4js.common.e3fn(this.es);
this.sinphi=Math.sin(this.lat1);
this.cosphi=Math.cos(this.lat1);
this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);
this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);
if(this.mode!=0){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("eqdc:Init:EqualLatitudes")
}this.sinphi=Math.sin(this.lat2);
this.cosphi=Math.cos(this.lat2);
this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);
this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);
if(Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN){this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)
}else{this.ns=this.sinphi
}}else{this.ns=this.sinphi
}this.g=this.ml1+this.ms1/this.ns;
this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);
this.rh=this.a*(this.g-this.ml0)
},forward:function(p){var lon=p.x;
var lat=p.y;
var ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);
var rh1=this.a*(this.g-ml);
var theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0);
var x=this.x0+rh1*Math.sin(theta);
var y=this.y0+this.rh-rh1*Math.cos(theta);
p.x=x;
p.y=y;
return p
},inverse:function(p){p.x-=this.x0;
p.y=this.rh-p.y+this.y0;
var con,rh1;
if(this.ns>=0){var rh1=Math.sqrt(p.x*p.x+p.y*p.y);
var con=1
}else{rh1=-Math.sqrt(p.x*p.x+p.y*p.y);
con=-1
}var theta=0;
if(rh1!=0){theta=Math.atan2(con*p.x,con*p.y)
}var ml=this.g-rh1/this.a;
var lat=this.phi3z(this.ml,this.e0,this.e1,this.e2,this.e3);
var lon=Proj4js.common.adjust_lon(this.long0+theta/this.ns);
p.x=lon;
p.y=lat;
return p
},phi3z:function(ml,e0,e1,e2,e3){var phi;
var dphi;
phi=ml;
for(var i=0;
i<15;
i++){dphi=(ml+e1*Math.sin(2*phi)-e2*Math.sin(4*phi)+e3*Math.sin(6*phi))/e0-phi;
phi+=dphi;
if(Math.abs(dphi)<=1e-10){return phi
}}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");
return null
}};
function phi4z(eccent,e0,e1,e2,e3,a,b,c,phi){var sinphi,sin2ph,tanph,ml,mlp,con1,con2,con3,dphi,i;
phi=a;
for(i=1;
i<=15;
i++){sinphi=Math.sin(phi);
tanphi=Math.tan(phi);
c=tanphi*Math.sqrt(1-eccent*sinphi*sinphi);
sin2ph=Math.sin(2*phi);
ml=e0*phi-e1*sin2ph+e2*Math.sin(4*phi)-e3*Math.sin(6*phi);
mlp=e0-2*e1*Math.cos(2*phi)+4*e2*Math.cos(4*phi)-6*e3*Math.cos(6*phi);
con1=2*ml+c*(ml*ml+b)-2*a*(c*ml+1);
con2=eccent*sin2ph*(ml*ml+b-2*a*ml)/(2*c);
con3=2*(a-ml)*(c*mlp-2/sin2ph)-2*mlp;
dphi=con1/(con2+con3);
phi+=dphi;
if(Math.abs(dphi)<=1e-10){return(phi)
}}Proj4js.reportError("phi4z: No convergence");
return null
}function e4fn(x){var con,com;
con=1+x;
com=1-x;
return(Math.sqrt((Math.pow(con,con))*(Math.pow(com,com))))
}Proj4js.Proj.poly={init:function(){var temp;
if(this.lat0=0){this.lat0=90
}this.temp=this.b/this.a;
this.es=1-Math.pow(this.temp,2);
this.e=Math.sqrt(this.es);
this.e0=Proj4js.common.e0fn(this.es);
this.e1=Proj4js.common.e1fn(this.es);
this.e2=Proj4js.common.e2fn(this.es);
this.e3=Proj4js.common.e3fn(this.es);
this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)
},forward:function(p){var sinphi,cosphi;
var al;
var c;
var con,ml;
var ms;
var x,y;
var lon=p.x;
var lat=p.y;
con=Proj4js.common.adjust_lon(lon-this.long0);
if(Math.abs(lat)<=1e-7){x=this.x0+this.a*con;
y=this.y0-this.a*this.ml0
}else{sinphi=Math.sin(lat);
cosphi=Math.cos(lat);
ml=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,lat);
ms=Proj4js.common.msfnz(this.e,sinphi,cosphi);
con=sinphi;
x=this.x0+this.a*ms*Math.sin(con)/sinphi;
y=this.y0+this.a*(ml-this.ml0+ms*(1-Math.cos(con))/sinphi)
}p.x=x;
p.y=y;
return p
},inverse:function(p){var sin_phi,cos_phi;
var al;
var b;
var c;
var con,ml;
var iflg;
var lon,lat;
p.x-=this.x0;
p.y-=this.y0;
al=this.ml0+p.y/this.a;
iflg=0;
if(Math.abs(al)<=1e-7){lon=p.x/this.a+this.long0;
lat=0
}else{b=al*al+(p.x/this.a)*(p.x/this.a);
iflg=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,b,c,lat);
if(iflg!=1){return(iflg)
}lon=Proj4js.common.adjust_lon((asinz(p.x*c/this.a)/Math.sin(lat))+this.long0)
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";
Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;
Proj4js.Proj.gstmerc={init:function(){var temp=this.b/this.a;
this.e=Math.sqrt(1-temp*temp);
this.lc=this.long0;
this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));
var sinz=Math.sin(this.lat0);
var pc=Math.asin(sinz/this.rs);
var sinzpc=Math.sin(pc);
this.cp=Proj4js.common.latiso(0,pc,sinzpc)-this.rs*Proj4js.common.latiso(this.e,this.lat0,sinz);
this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*sinz*sinz);
this.xs=this.x0;
this.ys=this.y0-this.n2*pc;
if(!this.title){this.title="Gauss Schreiber transverse mercator"
}},forward:function(p){var lon=p.x;
var lat=p.y;
var L=this.rs*(lon-this.lc);
var Ls=this.cp+(this.rs*Proj4js.common.latiso(this.e,lat,Math.sin(lat)));
var lat1=Math.asin(Math.sin(L)/Proj4js.common.cosh(Ls));
var Ls1=Proj4js.common.latiso(0,lat1,Math.sin(lat1));
p.x=this.xs+(this.n2*Ls1);
p.y=this.ys+(this.n2*Math.atan(Proj4js.common.sinh(Ls)/Math.cos(L)));
return p
},inverse:function(p){var x=p.x;
var y=p.y;
var L=Math.atan(Proj4js.common.sinh((x-this.xs)/this.n2)/Math.cos((y-this.ys)/this.n2));
var lat1=Math.asin(Math.sin((y-this.ys)/this.n2)/Proj4js.common.cosh((x-this.xs)/this.n2));
var LC=Proj4js.common.latiso(0,lat1,Math.sin(lat1));
p.x=this.lc+L/this.rs;
p.y=Proj4js.common.invlatiso(this.e,(LC-this.cp)/this.rs);
return p
}};
Proj4js.Proj.ortho={init:function(def){this.sin_p14=Math.sin(this.lat0);
this.cos_p14=Math.cos(this.lat0)
},forward:function(p){var sinphi,cosphi;
var dlon;
var coslon;
var ksp;
var g;
var lon=p.x;
var lat=p.y;
dlon=Proj4js.common.adjust_lon(lon-this.long0);
sinphi=Math.sin(lat);
cosphi=Math.cos(lat);
coslon=Math.cos(dlon);
g=this.sin_p14*sinphi+this.cos_p14*cosphi*coslon;
ksp=1;
if((g>0)||(Math.abs(g)<=Proj4js.common.EPSLN)){var x=this.a*ksp*cosphi*Math.sin(dlon);
var y=this.y0+this.a*ksp*(this.cos_p14*sinphi-this.sin_p14*cosphi*coslon)
}else{Proj4js.reportError("orthoFwdPointError")
}p.x=x;
p.y=y;
return p
},inverse:function(p){var rh;
var z;
var sinz,cosz;
var temp;
var con;
var lon,lat;
p.x-=this.x0;
p.y-=this.y0;
rh=Math.sqrt(p.x*p.x+p.y*p.y);
if(rh>this.a+1e-7){Proj4js.reportError("orthoInvDataError")
}z=Proj4js.common.asinz(rh/this.a);
sinz=Math.sin(z);
cosi=Math.cos(z);
lon=this.long0;
if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.lat0
}lat=Proj4js.common.asinz(cosz*this.sin_p14+(y*sinz*this.cos_p14)/rh);
con=Math.abs(lat0)-Proj4js.common.HALF_PI;
if(Math.abs(con)<=Proj4js.common.EPSLN){if(this.lat0>=0){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y))
}else{lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y))
}}con=cosz-this.sin_p14*Math.sin(lat);
if((Math.abs(con)>=Proj4js.common.EPSLN)||(Math.abs(x)>=Proj4js.common.EPSLN)){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2((p.x*sinz*this.cos_p14),(con*rh)))
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.somerc={init:function(){var phy0=this.lat0;
this.lambda0=this.long0;
var sinPhy0=Math.sin(phy0);
var semiMajorAxis=this.a;
var invF=this.rf;
var flattening=1/invF;
var e2=2*flattening-Math.pow(flattening,2);
var e=this.e=Math.sqrt(e2);
this.R=semiMajorAxis*Math.sqrt(1-e2)/(1-e2*Math.pow(sinPhy0,2));
this.alpha=Math.sqrt(1+e2/(1-e2)*Math.pow(Math.cos(phy0),4));
this.b0=Math.asin(sinPhy0/this.alpha);
this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+phy0/2))+this.alpha*e/2*Math.log((1+e*sinPhy0)/(1-e*sinPhy0))
},forward:function(p){var Sa1=Math.log(Math.tan(Math.PI/4-p.y/2));
var Sa2=this.e/2*Math.log((1+this.e*Math.sin(p.y))/(1-this.e*Math.sin(p.y)));
var S=-this.alpha*(Sa1+Sa2)+this.K;
var b=2*(Math.atan(Math.exp(S))-Math.PI/4);
var I=this.alpha*(p.x-this.lambda0);
var rotI=Math.atan(Math.sin(I)/(Math.sin(this.b0)*Math.tan(b)+Math.cos(this.b0)*Math.cos(I)));
var rotB=Math.asin(Math.cos(this.b0)*Math.sin(b)-Math.sin(this.b0)*Math.cos(b)*Math.cos(I));
p.y=this.R/2*Math.log((1+Math.sin(rotB))/(1-Math.sin(rotB)))+this.y0;
p.x=this.R*rotI+this.x0;
return p
},inverse:function(p){var Y=p.x-this.x0;
var X=p.y-this.y0;
var rotI=Y/this.R;
var rotB=2*(Math.atan(Math.exp(X/this.R))-Math.PI/4);
var b=Math.asin(Math.cos(this.b0)*Math.sin(rotB)+Math.sin(this.b0)*Math.cos(rotB)*Math.cos(rotI));
var I=Math.atan(Math.sin(rotI)/(Math.cos(this.b0)*Math.cos(rotI)-Math.sin(this.b0)*Math.tan(rotB)));
var lambda=this.lambda0+I/this.alpha;
var S=0;
var phy=b;
var prevPhy=-1000;
var iteration=0;
while(Math.abs(phy-prevPhy)>1e-7){if(++iteration>20){Proj4js.reportError("omercFwdInfinity");
return
}S=1/this.alpha*(Math.log(Math.tan(Math.PI/4+b/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(phy))/2));
prevPhy=phy;
phy=2*Math.atan(Math.exp(S))-Math.PI/2
}p.x=lambda;
p.y=phy;
return p
}};
Proj4js.Proj.stere={ssfn_:function(phit,sinphi,eccen){sinphi*=eccen;
return(Math.tan(0.5*(Proj4js.common.HALF_PI+phit))*Math.pow((1-sinphi)/(1+sinphi),0.5*eccen))
},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;
var t=Math.abs(this.lat0);
if((Math.abs(t)-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.mode=this.lat0<0?this.S_POLE:this.N_POLE
}else{this.mode=t>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT
}this.phits=Math.abs(this.phits);
if(this.es){var X;
switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN){this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e))
}else{t=Math.sin(this.phits);
this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,t);
t*=this.e;
this.akm1/=Math.sqrt(1-t*t)
}break;
case this.EQUIT:this.akm1=2*this.k0;
break;
case this.OBLIQ:t=Math.sin(this.lat0);
X=2*Math.atan(this.ssfn_(this.lat0,t,this.e))-Proj4js.common.HALF_PI;
t*=this.e;
this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-t*t);
this.sinX1=Math.sin(X);
this.cosX1=Math.cos(X);
break
}}else{switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);
this.cosph0=Math.cos(this.lat0);
case this.EQUIT:this.akm1=2*this.k0;
break;
case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-0.5*this.phits):2*this.k0;
break
}}},forward:function(p){var lon=p.x;
var lat=p.y;
var x,y;
if(this.sphere){var sinphi,cosphi,coslam,sinlam;
sinphi=Math.sin(lat);
cosphi=Math.cos(lat);
coslam=Math.cos(lon);
sinlam=Math.sin(lon);
switch(this.mode){case this.EQUIT:y=1+cosphi*coslam;
if(y<=Proj4js.common.EPSLN){F_ERROR
}y=this.akm1/y;
x=y*cosphi*sinlam;
y*=sinphi;
break;
case this.OBLIQ:y=1+this.sinph0*sinphi+this.cosph0*cosphi*coslam;
if(y<=Proj4js.common.EPSLN){F_ERROR
}y=this.akm1/y;
x=y*cosphi*sinlam;
y*=this.cosph0*sinphi-this.sinph0*cosphi*coslam;
break;
case this.N_POLE:coslam=-coslam;
lat=-lat;
case this.S_POLE:if(Math.abs(lat-Proj4js.common.HALF_PI)<this.TOL){F_ERROR
}y=this.akm1*Math.tan(Proj4js.common.FORTPI+0.5*lat);
x=sinlam*y;
y*=coslam;
break
}}else{coslam=Math.cos(lon);
sinlam=Math.sin(lon);
sinphi=Math.sin(lat);
if(this.mode==this.OBLIQ||this.mode==this.EQUIT){X=2*Math.atan(this.ssfn_(lat,sinphi,this.e));
sinX=Math.sin(X-Proj4js.common.HALF_PI);
cosX=Math.cos(X)
}switch(this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*coslam));
y=A*(this.cosX1*sinX-this.sinX1*cosX*coslam);
x=A*cosX;
break;
case this.EQUIT:A=2*this.akm1/(1+cosX*coslam);
y=A*sinX;
x=A*cosX;
break;
case this.S_POLE:lat=-lat;
coslam=-coslam;
sinphi=-sinphi;
case this.N_POLE:x=this.akm1*Proj4js.common.tsfnz(this.e,lat,sinphi);
y=-x*coslam;
break
}x=x*sinlam
}p.x=x*this.a+this.x0;
p.y=y*this.a+this.y0;
return p
},inverse:function(p){var x=(p.x-this.x0)/this.a;
var y=(p.y-this.y0)/this.a;
var lon,lat;
var cosphi,sinphi,tp=0,phi_l=0,rho,halfe=0,pi2=0;
var i;
if(this.sphere){var c,rh,sinc,cosc;
rh=Math.sqrt(x*x+y*y);
c=2*Math.atan(rh/this.akm1);
sinc=Math.sin(c);
cosc=Math.cos(c);
lon=0;
switch(this.mode){case this.EQUIT:if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=0
}else{lat=Math.asin(y*sinc/rh)
}if(cosc!=0||x!=0){lon=Math.atan2(x*sinc,cosc*rh)
}break;
case this.OBLIQ:if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.phi0
}else{lat=Math.asin(cosc*sinph0+y*sinc*cosph0/rh)
}c=cosc-sinph0*Math.sin(lat);
if(c!=0||x!=0){lon=Math.atan2(x*sinc*cosph0,c*rh)
}break;
case this.N_POLE:y=-y;
case this.S_POLE:if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.phi0
}else{lat=Math.asin(this.mode==this.S_POLE?-cosc:cosc)
}lon=(x==0&&y==0)?0:Math.atan2(x,y);
break
}}else{rho=Math.sqrt(x*x+y*y);
switch(this.mode){case this.OBLIQ:case this.EQUIT:tp=2*Math.atan2(rho*this.cosX1,this.akm1);
cosphi=Math.cos(tp);
sinphi=Math.sin(tp);
if(rho==0){phi_l=Math.asin(cosphi*this.sinX1)
}else{phi_l=Math.asin(cosphi*this.sinX1+(y*sinphi*this.cosX1/rho))
}tp=Math.tan(0.5*(Proj4js.common.HALF_PI+phi_l));
x*=sinphi;
y=rho*this.cosX1*cosphi-y*this.sinX1*sinphi;
pi2=Proj4js.common.HALF_PI;
halfe=0.5*this.e;
break;
case this.N_POLE:y=-y;
case this.S_POLE:tp=-rho/this.akm1;
phi_l=Proj4js.common.HALF_PI-2*Math.atan(tp);
pi2=-Proj4js.common.HALF_PI;
halfe=-0.5*this.e;
break
}for(i=this.NITER;
i--;
phi_l=lat){sinphi=this.e*Math.sin(phi_l);
lat=2*Math.atan(tp*Math.pow((1+sinphi)/(1-sinphi),halfe))-pi2;
if(Math.abs(phi_l-lat)<this.CONV){if(this.mode==this.S_POLE){lat=-lat
}lon=(x==0&&y==0)?0:Math.atan2(x,y);
p.x=lon;
p.y=lat;
return p
}}}}};
Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array();
this.A[1]=+0.6399175073;
this.A[2]=-0.1358797613;
this.A[3]=+0.063294409;
this.A[4]=-0.02526853;
this.A[5]=+0.0117879;
this.A[6]=-0.0055161;
this.A[7]=+0.0026906;
this.A[8]=-0.001333;
this.A[9]=+0.00067;
this.A[10]=-0.00034;
this.B_re=new Array();
this.B_im=new Array();
this.B_re[1]=+0.7557853228;
this.B_im[1]=0;
this.B_re[2]=+0.249204646;
this.B_im[2]=+0.003371507;
this.B_re[3]=-0.001541739;
this.B_im[3]=+0.04105856;
this.B_re[4]=-0.10162907;
this.B_im[4]=+0.01727609;
this.B_re[5]=-0.26623489;
this.B_im[5]=-0.36249218;
this.B_re[6]=-0.6870983;
this.B_im[6]=-1.1651967;
this.C_re=new Array();
this.C_im=new Array();
this.C_re[1]=+1.3231270439;
this.C_im[1]=0;
this.C_re[2]=-0.577245789;
this.C_im[2]=-0.007809598;
this.C_re[3]=+0.508307513;
this.C_im[3]=-0.112208952;
this.C_re[4]=-0.15094762;
this.C_im[4]=+0.18200602;
this.C_re[5]=+1.01418179;
this.C_im[5]=+1.64497696;
this.C_re[6]=+1.9660549;
this.C_im[6]=+2.5127645;
this.D=new Array();
this.D[1]=+1.5627014243;
this.D[2]=+0.5185406398;
this.D[3]=-0.03333098;
this.D[4]=-0.1052906;
this.D[5]=-0.0368594;
this.D[6]=+0.007317;
this.D[7]=+0.0122;
this.D[8]=+0.00394;
this.D[9]=-0.0013
},forward:function(p){var lon=p.x;
var lat=p.y;
var delta_lat=lat-this.lat0;
var delta_lon=lon-this.long0;
var d_phi=delta_lat/Proj4js.common.SEC_TO_RAD*0.00001;
var d_lambda=delta_lon;
var d_phi_n=1;
var d_psi=0;
for(n=1;
n<=10;
n++){d_phi_n=d_phi_n*d_phi;
d_psi=d_psi+this.A[n]*d_phi_n
}var th_re=d_psi;
var th_im=d_lambda;
var th_n_re=1;
var th_n_im=0;
var th_n_re1;
var th_n_im1;
var z_re=0;
var z_im=0;
for(n=1;
n<=6;
n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;
th_n_im1=th_n_im*th_re+th_n_re*th_im;
th_n_re=th_n_re1;
th_n_im=th_n_im1;
z_re=z_re+this.B_re[n]*th_n_re-this.B_im[n]*th_n_im;
z_im=z_im+this.B_im[n]*th_n_re+this.B_re[n]*th_n_im
}x=(z_im*this.a)+this.x0;
y=(z_re*this.a)+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){var x=p.x;
var y=p.y;
var delta_x=x-this.x0;
var delta_y=y-this.y0;
var z_re=delta_y/this.a;
var z_im=delta_x/this.a;
var z_n_re=1;
var z_n_im=0;
var z_n_re1;
var z_n_im1;
var th_re=0;
var th_im=0;
for(n=1;
n<=6;
n++){z_n_re1=z_n_re*z_re-z_n_im*z_im;
z_n_im1=z_n_im*z_re+z_n_re*z_im;
z_n_re=z_n_re1;
z_n_im=z_n_im1;
th_re=th_re+this.C_re[n]*z_n_re-this.C_im[n]*z_n_im;
th_im=th_im+this.C_im[n]*z_n_re+this.C_re[n]*z_n_im
}for(i=0;
i<this.iterations;
i++){var th_n_re=th_re;
var th_n_im=th_im;
var th_n_re1;
var th_n_im1;
var num_re=z_re;
var num_im=z_im;
for(n=2;
n<=6;
n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;
th_n_im1=th_n_im*th_re+th_n_re*th_im;
th_n_re=th_n_re1;
th_n_im=th_n_im1;
num_re=num_re+(n-1)*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im);
num_im=num_im+(n-1)*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im)
}th_n_re=1;
th_n_im=0;
var den_re=this.B_re[1];
var den_im=this.B_im[1];
for(n=2;
n<=6;
n++){th_n_re1=th_n_re*th_re-th_n_im*th_im;
th_n_im1=th_n_im*th_re+th_n_re*th_im;
th_n_re=th_n_re1;
th_n_im=th_n_im1;
den_re=den_re+n*(this.B_re[n]*th_n_re-this.B_im[n]*th_n_im);
den_im=den_im+n*(this.B_im[n]*th_n_re+this.B_re[n]*th_n_im)
}var den2=den_re*den_re+den_im*den_im;
th_re=(num_re*den_re+num_im*den_im)/den2;
th_im=(num_im*den_re-num_re*den_im)/den2
}var d_psi=th_re;
var d_lambda=th_im;
var d_psi_n=1;
var d_phi=0;
for(n=1;
n<=9;
n++){d_psi_n=d_psi_n*d_psi;
d_phi=d_phi+this.D[n]*d_psi_n
}var lat=this.lat0+(d_phi*Proj4js.common.SEC_TO_RAD*100000);
var lon=this.long0+d_lambda;
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.mill={init:function(){},forward:function(p){var lon=p.x;
var lat=p.y;
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var x=this.x0+this.a*dlon;
var y=this.y0+this.a*Math.log(Math.tan((Proj4js.common.PI/4)+(lat/2.5)))*1.25;
p.x=x;
p.y=y;
return p
},inverse:function(p){p.x-=this.x0;
p.y-=this.y0;
var lon=Proj4js.common.adjust_lon(this.long0+p.x/this.a);
var lat=2.5*(Math.atan(Math.exp(0.8*p.y/this.a))-Proj4js.common.PI/4);
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(!this.zone){Proj4js.reportError("utm:init: zone must be specified for UTM");
return
}this.lat0=0;
this.long0=((6*Math.abs(this.zone))-183)*Proj4js.common.D2R;
this.x0=500000;
this.y0=this.utmSouth?10000000:0;
this.k0=0.9996;
Proj4js.Proj.tmerc.init.apply(this);
this.forward=Proj4js.Proj.tmerc.forward;
this.inverse=Proj4js.Proj.tmerc.inverse
}};
var GEOCENT_LAT_ERROR=1;
var COS_67P5=0.3826834323650898;
var AD_C=1.0026;
function cs_geodetic_to_geocentric(cs,p){var Longitude=p.x;
var Latitude=p.y;
var Height=p.z;
var X;
var Y;
var Z;
var Error_Code=0;
var Rn;
var Sin_Lat;
var Sin2_Lat;
var Cos_Lat;
if(Latitude<-HALF_PI&&Latitude>-1.001*HALF_PI){Latitude=-HALF_PI
}else{if(Latitude>HALF_PI&&Latitude<1.001*HALF_PI){Latitude=HALF_PI
}else{if((Latitude<-HALF_PI)||(Latitude>HALF_PI)){Error_Code|=GEOCENT_LAT_ERROR
}}}if(!Error_Code){if(Longitude>PI){Longitude-=(2*PI)
}Sin_Lat=Math.sin(Latitude);
Cos_Lat=Math.cos(Latitude);
Sin2_Lat=Sin_Lat*Sin_Lat;
Rn=cs.a/(Math.sqrt(1-cs.es*Sin2_Lat));
X=(Rn+Height)*Cos_Lat*Math.cos(Longitude);
Y=(Rn+Height)*Cos_Lat*Math.sin(Longitude);
Z=((Rn*(1-cs.es))+Height)*Sin_Lat
}p.x=X;
p.y=Y;
p.z=Z;
return Error_Code
}function cs_geocentric_to_geodetic(cs,p){var X=p.x;
var Y=p.y;
var Z=p.z;
var Longitude;
var Latitude;
var Height;
var W;
var W2;
var T0;
var T1;
var S0;
var S1;
var Sin_B0;
var Sin3_B0;
var Cos_B0;
var Sin_p1;
var Cos_p1;
var Rn;
var Sum;
var At_Pole;
X=parseFloat(X);
Y=parseFloat(Y);
Z=parseFloat(Z);
At_Pole=false;
if(X!=0){Longitude=Math.atan2(Y,X)
}else{if(Y>0){Longitude=HALF_PI
}else{if(Y<0){Longitude=-HALF_PI
}else{At_Pole=true;
Longitude=0;
if(Z>0){Latitude=HALF_PI
}else{if(Z<0){Latitude=-HALF_PI
}else{Latitude=HALF_PI;
Height=-cs.b;
return
}}}}}W2=X*X+Y*Y;
W=Math.sqrt(W2);
T0=Z*AD_C;
S0=Math.sqrt(T0*T0+W2);
Sin_B0=T0/S0;
Cos_B0=W/S0;
Sin3_B0=Sin_B0*Sin_B0*Sin_B0;
T1=Z+cs.b*cs.ep2*Sin3_B0;
Sum=W-cs.a*cs.es*Cos_B0*Cos_B0*Cos_B0;
S1=Math.sqrt(T1*T1+Sum*Sum);
Sin_p1=T1/S1;
Cos_p1=Sum/S1;
Rn=cs.a/Math.sqrt(1-cs.es*Sin_p1*Sin_p1);
if(Cos_p1>=COS_67P5){Height=W/Cos_p1-Rn
}else{if(Cos_p1<=-COS_67P5){Height=W/-Cos_p1-Rn
}else{Height=Z/Sin_p1+Rn*(cs.es-1)
}}if(At_Pole==false){Latitude=Math.atan(Sin_p1/Cos_p1)
}p.x=Longitude;
p.y=Latitude;
p.z=Height;
return 0
}function cs_geocentric_to_wgs84(defn,p){if(defn.datum_type==PJD_3PARAM){p.x+=defn.datum_params[0];
p.y+=defn.datum_params[1];
p.z+=defn.datum_params[2]
}else{var Dx_BF=defn.datum_params[0];
var Dy_BF=defn.datum_params[1];
var Dz_BF=defn.datum_params[2];
var Rx_BF=defn.datum_params[3];
var Ry_BF=defn.datum_params[4];
var Rz_BF=defn.datum_params[5];
var M_BF=defn.datum_params[6];
var x_out=M_BF*(p.x-Rz_BF*p.y+Ry_BF*p.z)+Dx_BF;
var y_out=M_BF*(Rz_BF*p.x+p.y-Rx_BF*p.z)+Dy_BF;
var z_out=M_BF*(-Ry_BF*p.x+Rx_BF*p.y+p.z)+Dz_BF;
p.x=x_out;
p.y=y_out;
p.z=z_out
}}function cs_geocentric_from_wgs84(defn,p){if(defn.datum_type==PJD_3PARAM){p.x-=defn.datum_params[0];
p.y-=defn.datum_params[1];
p.z-=defn.datum_params[2]
}else{var Dx_BF=defn.datum_params[0];
var Dy_BF=defn.datum_params[1];
var Dz_BF=defn.datum_params[2];
var Rx_BF=defn.datum_params[3];
var Ry_BF=defn.datum_params[4];
var Rz_BF=defn.datum_params[5];
var M_BF=defn.datum_params[6];
var x_tmp=(p.x-Dx_BF)/M_BF;
var y_tmp=(p.y-Dy_BF)/M_BF;
var z_tmp=(p.z-Dz_BF)/M_BF;
p.x=x_tmp+Rz_BF*y_tmp-Ry_BF*z_tmp;
p.y=-Rz_BF*x_tmp+y_tmp+Rx_BF*z_tmp;
p.z=Ry_BF*x_tmp-Rx_BF*y_tmp+z_tmp
}}Proj4js.Proj.vandg={init:function(){this.R=6370997
},forward:function(p){var lon=p.x;
var lat=p.y;
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var x,y;
if(Math.abs(lat)<=Proj4js.common.EPSLN){x=this.x0+this.R*dlon;
y=this.y0
}var theta=Proj4js.common.asinz(2*Math.abs(lat/Proj4js.common.PI));
if((Math.abs(dlon)<=Proj4js.common.EPSLN)||(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)){x=this.x0;
if(lat>=0){y=this.y0+Proj4js.common.PI*this.R*Math.tan(0.5*theta)
}else{y=this.y0+Proj4js.common.PI*this.R*-Math.tan(0.5*theta)
}}var al=0.5*Math.abs((Proj4js.common.PI/dlon)-(dlon/Proj4js.common.PI));
var asq=al*al;
var sinth=Math.sin(theta);
var costh=Math.cos(theta);
var g=costh/(sinth+costh-1);
var gsq=g*g;
var m=g*(2/sinth-1);
var msq=m*m;
var con=Proj4js.common.PI*this.R*(al*(g-msq)+Math.sqrt(asq*(g-msq)*(g-msq)-(msq+asq)*(gsq-msq)))/(msq+asq);
if(dlon<0){con=-con
}x=this.x0+con;
con=Math.abs(con/(Proj4js.common.PI*this.R));
if(lat>=0){y=this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-con*con-2*al*con)
}else{y=this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-con*con-2*al*con)
}p.x=x;
p.y=y;
return p
},inverse:function(p){var dlon;
var xx,yy,xys,c1,c2,c3;
var al,asq;
var a1;
var m1;
var con;
var th1;
var d;
p.x-=this.x0;
p.y-=this.y0;
con=Proj4js.common.PI*this.R;
xx=p.x/con;
yy=p.y/con;
xys=xx*xx+yy*yy;
c1=-Math.abs(yy)*(1+xys);
c2=c1-2*yy*yy+xx*xx;
c3=-2*c1+1+2*yy*yy+xys*xys;
d=yy*yy/c3+(2*c2*c2*c2/c3/c3/c3-9*c1*c2/c3/c3)/27;
a1=(c1-c2*c2/3/c3)/c3;
m1=2*Math.sqrt(-a1/3);
con=((3*d)/a1)/m1;
if(Math.abs(con)>1){if(con>=0){con=1
}else{con=-1
}}th1=Math.acos(con)/3;
if(p.y>=0){lat=(-m1*Math.cos(th1+Proj4js.common.PI/3)-c2/3/c3)*Proj4js.common.PI
}else{lat=-(-m1*Math.cos(th1+PI/3)-c2/3/c3)*Proj4js.common.PI
}if(Math.abs(xx)<Proj4js.common.EPSLN){lon=this.long0
}lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(xys-1+Math.sqrt(1+2*(xx*xx-yy*yy)+xys*xys))/2/xx);
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.eqc={init:function(){if(!this.x0){this.x0=0
}if(!this.y0){this.y0=0
}if(!this.lat0){this.lat0=0
}if(!this.long0){this.long0=0
}if(!this.lat_ts){this.lat_ts=0
}if(!this.title){this.title="Equidistant Cylindrical (Plate Carre)"
}this.rc=Math.cos(this.lat_ts)
},forward:function(p){var lon=p.x;
var lat=p.y;
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var dlat=Proj4js.common.adjust_lat(lat-this.lat0);
p.x=this.x0+(this.a*dlon*this.rc);
p.y=this.y0+(this.a*dlat);
return p
},inverse:function(p){var x=p.x;
var y=p.y;
p.x=Proj4js.common.adjust_lon(this.long0+((x-this.x0)/(this.a*this.rc)));
p.y=Proj4js.common.adjust_lat(this.lat0+((y-this.y0)/(this.a)));
return p
}};
Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0);
cphi=Math.cos(this.lat0);
cphi*=cphi;
this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi);
this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es));
this.phic0=Math.asin(sphi/this.C);
this.ratexp=0.5*this.C*this.e;
this.K=Math.tan(0.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(0.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))
},forward:function(p){var lon=p.x;
var lat=p.y;
p.y=2*Math.atan(this.K*Math.pow(Math.tan(0.5*lat+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(lat),this.ratexp))-Proj4js.common.HALF_PI;
p.x=this.C*lon;
return p
},inverse:function(p){var DEL_TOL=1e-14;
var lon=p.x/this.C;
var lat=p.y;
num=Math.pow(Math.tan(0.5*lat+Proj4js.common.FORTPI)/this.K,1/this.C);
for(var i=Proj4js.common.MAX_ITER;
i>0;
--i){lat=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(p.y),-0.5*this.e))-Proj4js.common.HALF_PI;
if(Math.abs(lat-p.y)<DEL_TOL){break
}p.y=lat
}if(!i){Proj4js.reportError("gauss:inverse:convergence failed");
return null
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.omerc={init:function(){if(!this.mode){this.mode=0
}if(!this.lon1){this.lon1=0;
this.mode=1
}if(!this.lon2){this.lon2=0
}if(!this.lat2){this.lat2=0
}var temp=this.b/this.a;
var es=1-Math.pow(temp,2);
var e=Math.sqrt(es);
this.sin_p20=Math.sin(this.lat0);
this.cos_p20=Math.cos(this.lat0);
this.con=1-this.es*this.sin_p20*this.sin_p20;
this.com=Math.sqrt(1-es);
this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-es));
this.al=this.a*this.bl*this.k0*this.com/this.con;
if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;
this.d=1;
this.el=1
}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);
this.con=Math.sqrt(this.con);
this.d=this.bl*this.com/(this.cos_p20*this.con);
if((this.d*this.d-1)>0){if(this.lat0>=0){this.f=this.d+Math.sqrt(this.d*this.d-1)
}else{this.f=this.d-Math.sqrt(this.d*this.d-1)
}}else{this.f=this.d
}this.el=this.f*Math.pow(this.ts,this.bl)
}if(this.mode!=0){this.g=0.5*(this.f-1/this.f);
this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);
this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;
this.con=Math.abs(this.lat0);
if((this.con>Proj4js.common.EPSLN)&&(Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN)){this.singam=Math.sin(this.gama);
this.cosgam=Math.cos(this.gama);
this.sinaz=Math.sin(this.alpha);
this.cosaz=Math.cos(this.alpha);
if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)
}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)
}}else{Proj4js.reportError("omerc:Init:DataError")
}}else{this.sinphi=Math.sin(this.at1);
this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);
this.sinphi=Math.sin(this.lat2);
this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);
this.h=Math.pow(this.ts1,this.bl);
this.l=Math.pow(this.ts2,this.bl);
this.f=this.el/this.h;
this.g=0.5*(this.f-1/this.f);
this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);
this.p=(this.l-this.h)/(this.l+this.h);
this.dlon=this.lon1-this.lon2;
if(this.dlon<-Proj4js.common.PI){this.lon2=this.lon2-2*Proj4js.common.PI
}if(this.dlon>Proj4js.common.PI){this.lon2=this.lon2+2*Proj4js.common.PI
}this.dlon=this.lon1-this.lon2;
this.longc=0.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(0.5*this.bl*this.dlon)/this.p)/this.bl;
this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);
this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);
this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));
if(Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError")
}else{this.con=Math.abs(this.lat1)
}if((this.con<=Proj4js.common.EPSLN)||(Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN)){Proj4js.reportError("omercInitDataError")
}else{if(Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("omercInitDataError")
}}this.singam=Math.sin(this.gam);
this.cosgam=Math.cos(this.gam);
this.sinaz=Math.sin(this.alpha);
this.cosaz=Math.cos(this.alpha);
if(this.lat0>=0){this.u=(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)
}else{this.u=-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)
}}},forward:function(p){var theta;
var sin_phi,cos_phi;
var b;
var c,t,tq;
var con,n,ml;
var q,us,vl;
var ul,vs;
var s;
var dlon;
var ts1;
var lon=p.x;
var lat=p.y;
sin_phi=Math.sin(lat);
dlon=Proj4js.common.adjust_lon(lon-this.longc);
vl=Math.sin(this.bl*dlon);
if(Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){ts1=Proj4js.common.tsfnz(this.e,lat,sin_phi);
q=this.el/(Math.pow(ts1,this.bl));
s=0.5*(q-1/q);
t=0.5*(q+1/q);
ul=(s*this.singam-vl*this.cosgam)/t;
con=Math.cos(this.bl*dlon);
if(Math.abs(con)<1e-7){us=this.al*this.bl*dlon
}else{us=this.al*Math.atan((s*this.cosgam+vl*this.singam)/con)/this.bl;
if(con<0){us=us+Proj4js.common.PI*this.al/this.bl
}}}else{if(lat>=0){ul=this.singam
}else{ul=-this.singam
}us=this.al*lat/this.bl
}if(Math.abs(Math.abs(ul)-1)<=Proj4js.common.EPSLN){Proj4js.reportError("omercFwdInfinity")
}vs=0.5*this.al*Math.log((1-ul)/(1+ul))/this.bl;
us=us-this.u;
var x=this.x0+vs*this.cosaz+us*this.sinaz;
var y=this.y0+us*this.cosaz-vs*this.sinaz;
p.x=x;
p.y=y;
return p
},inverse:function(p){var delta_lon;
var theta;
var delta_theta;
var sin_phi,cos_phi;
var b;
var c,t,tq;
var con,n,ml;
var vs,us,q,s,ts1;
var vl,ul,bs;
var dlon;
var flag;
p.x-=this.x0;
p.y-=this.y0;
flag=0;
vs=p.x*this.cosaz-p.y*this.sinaz;
us=p.y*this.cosaz+p.x*this.sinaz;
us=us+this.u;
q=Math.exp(-this.bl*vs/this.al);
s=0.5*(q-1/q);
t=0.5*(q+1/q);
vl=Math.sin(this.bl*us/this.al);
ul=(vl*this.cosgam+s*this.singam)/t;
if(Math.abs(Math.abs(ul)-1)<=Proj4js.common.EPSLN){lon=this.longc;
if(ul>=0){lat=Proj4js.common.HALF_PI
}else{lat=-Proj4js.common.HALF_PI
}}else{con=1/this.bl;
ts1=Math.pow((this.el/Math.sqrt((1+ul)/(1-ul))),con);
lat=Proj4js.common.phi2z(this.e,ts1);
theta=this.longc-Math.atan2((s*this.cosgam-vl*this.singam),con)/this.bl;
lon=Proj4js.common.adjust_lon(theta)
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.lcc={init:function(){if(!this.lat2){this.lat2=this.lat0
}if(!this.k0){this.k0=1
}if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN){Proj4js.reportError("lcc:init: Equal Latitudes");
return
}var temp=this.b/this.a;
this.e=Math.sqrt(1-temp*temp);
var sin1=Math.sin(this.lat1);
var cos1=Math.cos(this.lat1);
var ms1=Proj4js.common.msfnz(this.e,sin1,cos1);
var ts1=Proj4js.common.tsfnz(this.e,this.lat1,sin1);
var sin2=Math.sin(this.lat2);
var cos2=Math.cos(this.lat2);
var ms2=Proj4js.common.msfnz(this.e,sin2,cos2);
var ts2=Proj4js.common.tsfnz(this.e,this.lat2,sin2);
var ts0=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));
if(Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN){this.ns=Math.log(ms1/ms2)/Math.log(ts1/ts2)
}else{this.ns=sin1
}this.f0=ms1/(this.ns*Math.pow(ts1,this.ns));
this.rh=this.a*this.f0*Math.pow(ts0,this.ns);
if(!this.title){this.title="Lambert Conformal Conic"
}},forward:function(p){var lon=p.x;
var lat=p.y;
if(lat<=90&&lat>=-90&&lon<=180&&lon>=-180){}else{Proj4js.reportError("lcc:forward: llInputOutOfRange: "+lon+" : "+lat);
return null
}var con=Math.abs(Math.abs(lat)-Proj4js.common.HALF_PI);
var ts;
if(con>Proj4js.common.EPSLN){ts=Proj4js.common.tsfnz(this.e,lat,Math.sin(lat));
rh1=this.a*this.f0*Math.pow(ts,this.ns)
}else{con=lat*this.ns;
if(con<=0){Proj4js.reportError("lcc:forward: No Projection");
return null
}rh1=0
}var theta=this.ns*Proj4js.common.adjust_lon(lon-this.long0);
p.x=this.k0*(rh1*Math.sin(theta))+this.x0;
p.y=this.k0*(this.rh-rh1*Math.cos(theta))+this.y0;
return p
},inverse:function(p){var rh1,con,ts;
var lat,lon;
x=(p.x-this.x0)/this.k0;
y=(this.rh-(p.y-this.y0)/this.k0);
if(this.ns>0){rh1=Math.sqrt(x*x+y*y);
con=1
}else{rh1=-Math.sqrt(x*x+y*y);
con=-1
}var theta=0;
if(rh1!=0){theta=Math.atan2((con*x),(con*y))
}if((rh1!=0)||(this.ns>0)){con=1/this.ns;
ts=Math.pow((rh1/(this.a*this.f0)),con);
lat=Proj4js.common.phi2z(this.e,ts);
if(lat==-9999){return null
}}else{lat=-Proj4js.common.HALF_PI
}lon=Proj4js.common.adjust_lon(theta/this.ns+this.long0);
p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.laea={init:function(){this.sin_lat_o=Math.sin(this.lat0);
this.cos_lat_o=Math.cos(this.lat0)
},forward:function(p){var lon=p.x;
var lat=p.y;
var delta_lon=Proj4js.common.adjust_lon(lon-this.long0);
var sin_lat=Math.sin(lat);
var cos_lat=Math.cos(lat);
var sin_delta_lon=Math.sin(delta_lon);
var cos_delta_lon=Math.cos(delta_lon);
var g=this.sin_lat_o*sin_lat+this.cos_lat_o*cos_lat*cos_delta_lon;
if(g==-1){Proj4js.reportError("laea:fwd:Point projects to a circle of radius "+2*R);
return null
}var ksp=this.a*Math.sqrt(2/(1+g));
var x=ksp*cos_lat*sin_delta_lon+this.x0;
var y=ksp*(this.cos_lat_o*sin_lat-this.sin_lat_o*cos_lat*cos_delta_lon)+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){p.x-=this.x0;
p.y-=this.y0;
var Rh=Math.sqrt(p.x*p.x+p.y*p.y);
var temp=Rh/(2*this.a);
if(temp>1){Proj4js.reportError("laea:Inv:DataError");
return null
}var z=2*Proj4js.common.asinz(temp);
var sin_z=Math.sin(z);
var cos_z=Math.cos(z);
var lon=this.long0;
if(Math.abs(Rh)>Proj4js.common.EPSLN){var lat=Proj4js.common.asinz(this.sin_lat_o*cos_z+this.cos_lat_o*sin_z*p.y/Rh);
var temp=Math.abs(this.lat0)-Proj4js.common.HALF_PI;
if(Math.abs(temp)>Proj4js.common.EPSLN){temp=cos_z-this.sin_lat_o*Math.sin(lat);
if(temp!=0){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x*sin_z*this.cos_lat_o,temp*Rh))
}}else{if(this.lat0<0){lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y))
}else{lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y))
}}}else{lat=this.lat0
}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);
this.cos_p12=Math.cos(this.lat0)
},forward:function(p){var lon=p.x;
var lat=p.y;
var ksp;
var sinphi=Math.sin(p.y);
var cosphi=Math.cos(p.y);
var dlon=Proj4js.common.adjust_lon(lon-this.long0);
var coslon=Math.cos(dlon);
var g=this.sin_p12*sinphi+this.cos_p12*cosphi*coslon;
if(Math.abs(Math.abs(g)-1)<Proj4js.common.EPSLN){ksp=1;
if(g<0){Proj4js.reportError("aeqd:Fwd:PointError");
return
}}else{var z=Math.acos(g);
ksp=z/Math.sin(z)
}p.x=this.x0+this.a*ksp*cosphi*Math.sin(dlon);
p.y=this.y0+this.a*ksp*(this.cos_p12*sinphi-this.sin_p12*cosphi*coslon);
return p
},inverse:function(p){p.x-=this.x0;
p.y-=this.y0;
var rh=Math.sqrt(p.x*p.x+p.y*p.y);
if(rh>(2*Proj4js.common.HALF_PI*this.a)){Proj4js.reportError("aeqdInvDataError");
return
}var z=rh/this.a;
var sinz=Math.sin(z);
var cosz=Math.cos(z);
var lon=this.long0;
var lat;
if(Math.abs(rh)<=Proj4js.common.EPSLN){lat=this.lat0
}else{lat=Proj4js.common.asinz(cosz*this.sin_p12+(p.y*sinz*this.cos_p12)/rh);
var con=Math.abs(this.lat0)-Proj4js.common.HALF_PI;
if(Math.abs(con)<=Proj4js.common.EPSLN){if(lat0>=0){lon=Proj4js.common.adjust_lon(this.long0+Math.atan2(p.x,-p.y))
}else{lon=Proj4js.common.adjust_lon(this.long0-Math.atan2(-p.x,p.y))
}}else{con=cosz-this.sin_p12*Math.sin(lat);
if((Math.abs(con)<Proj4js.common.EPSLN)&&(Math.abs(p.x)<Proj4js.common.EPSLN)){}else{var temp=Math.atan2((p.x*sinz*this.cos_p12),(con*rh));
lon=Proj4js.common.adjust_lon(this.long0+Math.atan2((p.x*sinz*this.cos_p12),(con*rh)))
}}}p.x=lon;
p.y=lat;
return p
}};
Proj4js.Proj.moll={init:function(){},forward:function(p){var lon=p.x;
var lat=p.y;
var delta_lon=Proj4js.common.adjust_lon(lon-this.long0);
var theta=lat;
var con=Proj4js.common.PI*Math.sin(lat);
for(var i=0;
;
i++){var delta_theta=-(theta+Math.sin(theta)-con)/(1+Math.cos(theta));
theta+=delta_theta;
if(Math.abs(delta_theta)<Proj4js.common.EPSLN){break
}if(i>=50){Proj4js.reportError("moll:Fwd:IterationError")
}}theta/=2;
if(Proj4js.common.PI/2-Math.abs(lat)<Proj4js.common.EPSLN){delta_lon=0
}var x=0.900316316158*this.a*delta_lon*Math.cos(theta)+this.x0;
var y=1.4142135623731*this.a*Math.sin(theta)+this.y0;
p.x=x;
p.y=y;
return p
},inverse:function(p){var theta;
var arg;
p.x-=this.x0;
var arg=p.y/(1.4142135623731*this.a);
if(Math.abs(arg)>0.999999999999){arg=0.999999999999
}var theta=Math.asin(arg);
var lon=Proj4js.common.adjust_lon(this.long0+(p.x/(0.900316316158*this.a*Math.cos(theta))));
if(lon<(-Proj4js.common.PI)){lon=-Proj4js.common.PI
}if(lon>Proj4js.common.PI){lon=Proj4js.common.PI
}arg=(2*theta+Math.sin(2*theta))/Proj4js.common.PI;
if(Math.abs(arg)>1){arg=1
}var lat=Math.asin(arg);
p.x=lon;
p.y=lat;
return p
}};
var OpenLayers={VERSION_NUMBER:"Release 2.12",singleFile:true,_getScriptLocation:(function(){var r=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),s=document.getElementsByTagName("script"),src,m,l="";
for(var i=0,len=s.length;
i<len;
i++){src=s[i].getAttribute("src");
if(src){m=src.match(r);
if(m){l=m[1];
break
}}}return(function(){return l
})
})(),ImgPath:""};
(function(){var singleFile=(typeof OpenLayers=="object"&&OpenLayers.singleFile);
var scriptName=(!singleFile)?"lib/OpenLayers.js":"OpenLayers.js";
var jsFiles=window.OpenLayers;
window.OpenLayers={_getScriptLocation:(function(){var r=new RegExp("(^|(.*?\\/))("+scriptName+")(\\?|$)"),s=document.getElementsByTagName("script"),src,m,l="";
for(var i=0,len=s.length;
i<len;
i++){src=s[i].getAttribute("src");
if(src){m=src.match(r);
if(m){l=m[1];
break
}}}return(function(){return l
})
})(),ImgPath:""};
if(!singleFile){if(!jsFiles){jsFiles=["OpenLayers/BaseTypes/Class.js","OpenLayers/Util.js","OpenLayers/Animation.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Date.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","OpenLayers/Kinetic.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Events.js","OpenLayers/Events/buttonclick.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/Image/IFrame.js","OpenLayers/Tile/UTFGrid.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/Google/v3.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/ArcGIS93Rest.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMTS.js","OpenLayers/Layer/ArcIMS.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/XYZ.js","OpenLayers/Layer/UTFGrid.js","OpenLayers/Layer/OSM.js","OpenLayers/Layer/Bing.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Layer/Zoomify.js","OpenLayers/Layer/ArcGISCache.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/Pinch.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/CacheRead.js","OpenLayers/Control/CacheWrite.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/PinchZoom.js","OpenLayers/Control/TouchNavigation.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/Snapping.js","OpenLayers/Control/Split.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Control/WMSGetFeatureInfo.js","OpenLayers/Control/WMTSGetFeatureInfo.js","OpenLayers/Control/Graticule.js","OpenLayers/Control/TransformFeature.js","OpenLayers/Control/UTFGrid.js","OpenLayers/Control/SLDSelect.js","OpenLayers/Control/Zoom.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Layer/PointGrid.js","OpenLayers/Layer/Vector/RootContainer.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Filter.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Strategy/Save.js","OpenLayers/Strategy/Refresh.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Filter/Function.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/WFS.js","OpenLayers/Protocol/WFS/v1.js","OpenLayers/Protocol/WFS/v1_0_0.js","OpenLayers/Protocol/WFS/v1_1_0.js","OpenLayers/Protocol/CSW.js","OpenLayers/Protocol/CSW/v2_0_2.js","OpenLayers/Protocol/Script.js","OpenLayers/Protocol/SOS.js","OpenLayers/Protocol/SOS/v1_0_0.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Style.js","OpenLayers/Style2.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Format.js","OpenLayers/Format/QueryStringFilter.js","OpenLayers/Format/XML.js","OpenLayers/Format/XML/VersionedOGC.js","OpenLayers/Format/Context.js","OpenLayers/Format/ArcXML.js","OpenLayers/Format/ArcXML/Features.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/Atom.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/OWSCommon.js","OpenLayers/Format/OWSCommon/v1.js","OpenLayers/Format/OWSCommon/v1_0_0.js","OpenLayers/Format/OWSCommon/v1_1_0.js","OpenLayers/Format/WFSCapabilities.js","OpenLayers/Format/WFSCapabilities/v1.js","OpenLayers/Format/WFSCapabilities/v1_0_0.js","OpenLayers/Format/WFSCapabilities/v1_1_0.js","OpenLayers/Format/WFSDescribeFeatureType.js","OpenLayers/Format/WMSDescribeLayer.js","OpenLayers/Format/WMSDescribeLayer/v1_1.js","OpenLayers/Format/WKT.js","OpenLayers/Format/CQL.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Filter/v1_1_0.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/SLD/v1_0_0_GeoServer.js","OpenLayers/Format/OWSCommon.js","OpenLayers/Format/OWSCommon/v1.js","OpenLayers/Format/OWSCommon/v1_0_0.js","OpenLayers/Format/OWSCommon/v1_1_0.js","OpenLayers/Format/CSWGetDomain.js","OpenLayers/Format/CSWGetDomain/v2_0_2.js","OpenLayers/Format/CSWGetRecords.js","OpenLayers/Format/CSWGetRecords/v2_0_2.js","OpenLayers/Format/WFST.js","OpenLayers/Format/WFST/v1.js","OpenLayers/Format/WFST/v1_0_0.js","OpenLayers/Format/WFST/v1_1_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Format/WCSGetCoverage.js","OpenLayers/Format/WMSCapabilities.js","OpenLayers/Format/WMSCapabilities/v1.js","OpenLayers/Format/WMSCapabilities/v1_1.js","OpenLayers/Format/WMSCapabilities/v1_1_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1.js","OpenLayers/Format/WMSCapabilities/v1_3.js","OpenLayers/Format/WMSCapabilities/v1_3_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1_WMSC.js","OpenLayers/Format/WMSGetFeatureInfo.js","OpenLayers/Format/SOSCapabilities.js","OpenLayers/Format/SOSCapabilities/v1_0_0.js","OpenLayers/Format/SOSGetFeatureOfInterest.js","OpenLayers/Format/SOSGetObservation.js","OpenLayers/Format/OWSContext.js","OpenLayers/Format/OWSContext/v0_3_1.js","OpenLayers/Format/WMTSCapabilities.js","OpenLayers/Format/WMTSCapabilities/v1_0_0.js","OpenLayers/Format/WPSCapabilities.js","OpenLayers/Format/WPSCapabilities/v1_0_0.js","OpenLayers/Format/WPSDescribeProcess.js","OpenLayers/Format/WPSExecute.js","OpenLayers/Format/XLS.js","OpenLayers/Format/XLS/v1.js","OpenLayers/Format/XLS/v1_1_0.js","OpenLayers/Format/OGCExceptionReport.js","OpenLayers/Control/GetFeature.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Control/Geolocate.js","OpenLayers/Symbolizer.js","OpenLayers/Symbolizer/Point.js","OpenLayers/Symbolizer/Line.js","OpenLayers/Symbolizer/Polygon.js","OpenLayers/Symbolizer/Text.js","OpenLayers/Symbolizer/Raster.js","OpenLayers/Lang.js","OpenLayers/Lang/ca.js","OpenLayers/Lang/en.js","OpenLayers/Lang/es.js","OpenLayers/Lang/fr.js","OpenLayers/Lang/nl.js","OpenLayers/Lang/de.js","OpenLayers/Lang/pl.js","OpenLayers/Spherical.js"]
}var scriptTags=new Array(jsFiles.length);
var host=OpenLayers._getScriptLocation()+"lib/";
for(var i=0,len=jsFiles.length;
i<len;
i++){scriptTags[i]="<script src='"+host+jsFiles[i]+"'><\/script>"
}if(scriptTags.length>0){document.write(scriptTags.join(""))
}}})();
OpenLayers.VERSION_NUMBER="Release 2.12";
OpenLayers.Class=function(){var len=arguments.length;
var P=arguments[0];
var F=arguments[len-1];
var C=typeof F.initialize=="function"?F.initialize:function(){P.prototype.initialize.apply(this,arguments)
};
if(len>1){var newArgs=[C,P].concat(Array.prototype.slice.call(arguments).slice(1,len-1),F);
OpenLayers.inherit.apply(null,newArgs)
}else{C.prototype=F
}return C
};
OpenLayers.inherit=function(C,P){var F=function(){};
F.prototype=P.prototype;
C.prototype=new F;
var i,l,o;
for(i=2,l=arguments.length;
i<l;
i++){o=arguments[i];
if(typeof o==="function"){o=o.prototype
}OpenLayers.Util.extend(C.prototype,o)
}};
OpenLayers.Util=OpenLayers.Util||{};
OpenLayers.Util.extend=function(destination,source){destination=destination||{};
if(source){for(var property in source){var value=source[property];
if(value!==undefined){destination[property]=value
}}var sourceIsEvt=typeof window.Event=="function"&&source instanceof window.Event;
if(!sourceIsEvt&&source.hasOwnProperty&&source.hasOwnProperty("toString")){destination.toString=source.toString
}}return destination
};
OpenLayers.Util=OpenLayers.Util||{};
OpenLayers.Util.getElement=function(){var elements=[];
for(var i=0,len=arguments.length;
i<len;
i++){var element=arguments[i];
if(typeof element=="string"){element=document.getElementById(element)
}if(arguments.length==1){return element
}elements.push(element)
}return elements
};
OpenLayers.Util.isElement=function(o){return !!(o&&o.nodeType===1)
};
OpenLayers.Util.isArray=function(a){return(Object.prototype.toString.call(a)==="[object Array]")
};
if(typeof window.$==="undefined"){window.$=OpenLayers.Util.getElement
}OpenLayers.Util.removeItem=function(array,item){for(var i=array.length-1;
i>=0;
i--){if(array[i]==item){array.splice(i,1)
}}return array
};
OpenLayers.Util.indexOf=function(array,obj){if(typeof array.indexOf=="function"){return array.indexOf(obj)
}else{for(var i=0,len=array.length;
i<len;
i++){if(array[i]==obj){return i
}}return -1
}};
OpenLayers.Util.modifyDOMElement=function(element,id,px,sz,position,border,overflow,opacity){if(id){element.id=id
}if(px){element.style.left=px.x+"px";
element.style.top=px.y+"px"
}if(sz){element.style.width=sz.w+"px";
element.style.height=sz.h+"px"
}if(position){element.style.position=position
}if(border){element.style.border=border
}if(overflow){element.style.overflow=overflow
}if(parseFloat(opacity)>=0&&parseFloat(opacity)<1){element.style.filter="alpha(opacity="+(opacity*100)+")";
element.style.opacity=opacity
}else{if(parseFloat(opacity)==1){element.style.filter="";
element.style.opacity=""
}}};
OpenLayers.Util.createDiv=function(id,px,sz,imgURL,position,border,overflow,opacity){var dom=document.createElement("div");
if(imgURL){dom.style.backgroundImage="url("+imgURL+")"
}if(!id){id=OpenLayers.Util.createUniqueID("OpenLayersDiv")
}if(!position){position="absolute"
}OpenLayers.Util.modifyDOMElement(dom,id,px,sz,position,border,overflow,opacity);
return dom
};
OpenLayers.Util.createImage=function(id,px,sz,imgURL,position,border,opacity,delayDisplay){var image=document.createElement("img");
if(!id){id=OpenLayers.Util.createUniqueID("OpenLayersDiv")
}if(!position){position="relative"
}OpenLayers.Util.modifyDOMElement(image,id,px,sz,position,border,null,opacity);
if(delayDisplay){image.style.display="none";
function display(){image.style.display="";
OpenLayers.Event.stopObservingElement(image)
}OpenLayers.Event.observe(image,"load",display);
OpenLayers.Event.observe(image,"error",display)
}image.style.alt=id;
image.galleryImg="no";
if(imgURL){image.src=imgURL
}return image
};
OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;
OpenLayers.Util.alphaHackNeeded=null;
OpenLayers.Util.alphaHack=function(){if(OpenLayers.Util.alphaHackNeeded==null){var arVersion=navigator.appVersion.split("MSIE");
var version=parseFloat(arVersion[1]);
var filter=false;
try{filter=!!(document.body.filters)
}catch(e){}OpenLayers.Util.alphaHackNeeded=(filter&&(version>=5.5)&&(version<7))
}return OpenLayers.Util.alphaHackNeeded
};
OpenLayers.Util.modifyAlphaImageDiv=function(div,id,px,sz,imgURL,position,border,sizing,opacity){OpenLayers.Util.modifyDOMElement(div,id,px,sz,position,null,null,opacity);
var img=div.childNodes[0];
if(imgURL){img.src=imgURL
}OpenLayers.Util.modifyDOMElement(img,div.id+"_innerImage",null,sz,"relative",border);
if(OpenLayers.Util.alphaHack()){if(div.style.display!="none"){div.style.display="inline-block"
}if(sizing==null){sizing="scale"
}div.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', sizingMethod='"+sizing+"')";
if(parseFloat(div.style.opacity)>=0&&parseFloat(div.style.opacity)<1){div.style.filter+=" alpha(opacity="+div.style.opacity*100+")"
}img.style.filter="alpha(opacity=0)"
}};
OpenLayers.Util.createAlphaImageDiv=function(id,px,sz,imgURL,position,border,sizing,opacity,delayDisplay){var div=OpenLayers.Util.createDiv();
var img=OpenLayers.Util.createImage(null,null,null,null,null,null,null,delayDisplay);
img.className="olAlphaImg";
div.appendChild(img);
OpenLayers.Util.modifyAlphaImageDiv(div,id,px,sz,imgURL,position,border,sizing,opacity);
return div
};
OpenLayers.Util.upperCaseObject=function(object){var uObject={};
for(var key in object){uObject[key.toUpperCase()]=object[key]
}return uObject
};
OpenLayers.Util.applyDefaults=function(to,from){to=to||{};
var fromIsEvt=typeof window.Event=="function"&&from instanceof window.Event;
for(var key in from){if(to[key]===undefined||(!fromIsEvt&&from.hasOwnProperty&&from.hasOwnProperty(key)&&!to.hasOwnProperty(key))){to[key]=from[key]
}}if(!fromIsEvt&&from&&from.hasOwnProperty&&from.hasOwnProperty("toString")&&!to.hasOwnProperty("toString")){to.toString=from.toString
}return to
};
OpenLayers.Util.getParameterString=function(params){var paramsArray=[];
for(var key in params){var value=params[key];
if((value!=null)&&(typeof value!="function")){var encodedValue;
if(typeof value=="object"&&value.constructor==Array){var encodedItemArray=[];
var item;
for(var itemIndex=0,len=value.length;
itemIndex<len;
itemIndex++){item=value[itemIndex];
encodedItemArray.push(encodeURIComponent((item===null||item===undefined)?"":item))
}encodedValue=encodedItemArray.join(",")
}else{encodedValue=encodeURIComponent(value)
}paramsArray.push(encodeURIComponent(key)+"="+encodedValue)
}}return paramsArray.join("&")
};
OpenLayers.Util.urlAppend=function(url,paramStr){var newUrl=url;
if(paramStr){var parts=(url+" ").split(/[?&]/);
newUrl+=(parts.pop()===" "?paramStr:parts.length?"&"+paramStr:"?"+paramStr)
}return newUrl
};
OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||(OpenLayers._getScriptLocation()+"img/")
};
OpenLayers.Util.getImageLocation=function(image){return OpenLayers.Util.getImagesLocation()+image
};
OpenLayers.Util.Try=function(){var returnValue=null;
for(var i=0,len=arguments.length;
i<len;
i++){var lambda=arguments[i];
try{returnValue=lambda();
break
}catch(e){}}return returnValue
};
OpenLayers.Util.getXmlNodeValue=function(node){var val=null;
OpenLayers.Util.Try(function(){val=node.text;
if(!val){val=node.textContent
}if(!val){val=node.firstChild.nodeValue
}},function(){val=node.textContent
});
return val
};
OpenLayers.Util.mouseLeft=function(evt,div){var target=(evt.relatedTarget)?evt.relatedTarget:evt.toElement;
while(target!=div&&target!=null){target=target.parentNode
}return(target!=div)
};
OpenLayers.Util.DEFAULT_PRECISION=14;
OpenLayers.Util.toFloat=function(number,precision){if(precision==null){precision=OpenLayers.Util.DEFAULT_PRECISION
}if(typeof number!=="number"){number=parseFloat(number)
}return precision===0?number:parseFloat(number.toPrecision(precision))
};
OpenLayers.Util.rad=function(x){return x*Math.PI/180
};
OpenLayers.Util.deg=function(x){return x*180/Math.PI
};
OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};
OpenLayers.Util.distVincenty=function(p1,p2){var ct=OpenLayers.Util.VincentyConstants;
var a=ct.a,b=ct.b,f=ct.f;
var L=OpenLayers.Util.rad(p2.lon-p1.lon);
var U1=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p1.lat)));
var U2=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(p2.lat)));
var sinU1=Math.sin(U1),cosU1=Math.cos(U1);
var sinU2=Math.sin(U2),cosU2=Math.cos(U2);
var lambda=L,lambdaP=2*Math.PI;
var iterLimit=20;
while(Math.abs(lambda-lambdaP)>1e-12&&--iterLimit>0){var sinLambda=Math.sin(lambda),cosLambda=Math.cos(lambda);
var sinSigma=Math.sqrt((cosU2*sinLambda)*(cosU2*sinLambda)+(cosU1*sinU2-sinU1*cosU2*cosLambda)*(cosU1*sinU2-sinU1*cosU2*cosLambda));
if(sinSigma==0){return 0
}var cosSigma=sinU1*sinU2+cosU1*cosU2*cosLambda;
var sigma=Math.atan2(sinSigma,cosSigma);
var alpha=Math.asin(cosU1*cosU2*sinLambda/sinSigma);
var cosSqAlpha=Math.cos(alpha)*Math.cos(alpha);
var cos2SigmaM=cosSigma-2*sinU1*sinU2/cosSqAlpha;
var C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha));
lambdaP=lambda;
lambda=L+(1-C)*f*Math.sin(alpha)*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)))
}if(iterLimit==0){return NaN
}var uSq=cosSqAlpha*(a*a-b*b)/(b*b);
var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));
var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));
var deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM)));
var s=b*A*(sigma-deltaSigma);
var d=s.toFixed(3)/1000;
return d
};
OpenLayers.Util.destinationVincenty=function(lonlat,brng,dist){var u=OpenLayers.Util;
var ct=u.VincentyConstants;
var a=ct.a,b=ct.b,f=ct.f;
var lon1=lonlat.lon;
var lat1=lonlat.lat;
var s=dist;
var alpha1=u.rad(brng);
var sinAlpha1=Math.sin(alpha1);
var cosAlpha1=Math.cos(alpha1);
var tanU1=(1-f)*Math.tan(u.rad(lat1));
var cosU1=1/Math.sqrt((1+tanU1*tanU1)),sinU1=tanU1*cosU1;
var sigma1=Math.atan2(tanU1,cosAlpha1);
var sinAlpha=cosU1*sinAlpha1;
var cosSqAlpha=1-sinAlpha*sinAlpha;
var uSq=cosSqAlpha*(a*a-b*b)/(b*b);
var A=1+uSq/16384*(4096+uSq*(-768+uSq*(320-175*uSq)));
var B=uSq/1024*(256+uSq*(-128+uSq*(74-47*uSq)));
var sigma=s/(b*A),sigmaP=2*Math.PI;
while(Math.abs(sigma-sigmaP)>1e-12){var cos2SigmaM=Math.cos(2*sigma1+sigma);
var sinSigma=Math.sin(sigma);
var cosSigma=Math.cos(sigma);
var deltaSigma=B*sinSigma*(cos2SigmaM+B/4*(cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)-B/6*cos2SigmaM*(-3+4*sinSigma*sinSigma)*(-3+4*cos2SigmaM*cos2SigmaM)));
sigmaP=sigma;
sigma=s/(b*A)+deltaSigma
}var tmp=sinU1*sinSigma-cosU1*cosSigma*cosAlpha1;
var lat2=Math.atan2(sinU1*cosSigma+cosU1*sinSigma*cosAlpha1,(1-f)*Math.sqrt(sinAlpha*sinAlpha+tmp*tmp));
var lambda=Math.atan2(sinSigma*sinAlpha1,cosU1*cosSigma-sinU1*sinSigma*cosAlpha1);
var C=f/16*cosSqAlpha*(4+f*(4-3*cosSqAlpha));
var L=lambda-(1-C)*f*sinAlpha*(sigma+C*sinSigma*(cos2SigmaM+C*cosSigma*(-1+2*cos2SigmaM*cos2SigmaM)));
var revAz=Math.atan2(sinAlpha,-tmp);
return new OpenLayers.LonLat(lon1+u.deg(L),u.deg(lat2))
};
OpenLayers.Util.getParameters=function(url){url=(url===null||url===undefined)?window.location.href:url;
var paramsString="";
if(OpenLayers.String.contains(url,"?")){var start=url.indexOf("?")+1;
var end=OpenLayers.String.contains(url,"#")?url.indexOf("#"):url.length;
paramsString=url.substring(start,end)
}var parameters={};
var pairs=paramsString.split(/[&;]/);
for(var i=0,len=pairs.length;
i<len;
++i){var keyValue=pairs[i].split("=");
if(keyValue[0]){var key=keyValue[0];
try{key=decodeURIComponent(key)
}catch(err){key=unescape(key)
}var value=(keyValue[1]||"").replace(/\+/g," ");
try{value=decodeURIComponent(value)
}catch(err){value=unescape(value)
}value=value.split(",");
if(value.length==1){value=value[0]
}parameters[key]=value
}}return parameters
};
OpenLayers.Util.lastSeqID=0;
OpenLayers.Util.createUniqueID=function(prefix){if(prefix==null){prefix="id_"
}OpenLayers.Util.lastSeqID+=1;
return prefix+OpenLayers.Util.lastSeqID
};
OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};
OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;
OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;
OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;
OpenLayers.METERS_PER_INCH=0.0254000508001016;
OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:0.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:0.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:0.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:0.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:0.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:0.0254/OpenLayers.METERS_PER_INCH,MicroInch:0.0000254/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:0.01/OpenLayers.METERS_PER_INCH,Kilometer:1000/OpenLayers.METERS_PER_INCH,Yard:0.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:0.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:0.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:0.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:0.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:0.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:0.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:0.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:0.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:0.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:0.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:0.1/OpenLayers.METERS_PER_INCH,Millimeter:0.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:0.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:0.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:0.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:0.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:0.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:0.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:0.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:0.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":50000/OpenLayers.METERS_PER_INCH,"150kilometers":150000/OpenLayers.METERS_PER_INCH});
OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1000,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:OpenLayers.INCHES_PER_UNIT.Meter*100,km:OpenLayers.INCHES_PER_UNIT.Meter*1000,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});
OpenLayers.DOTS_PER_INCH=72;
OpenLayers.Util.normalizeScale=function(scale){var normScale=(scale>1)?(1/scale):scale;
return normScale
};
OpenLayers.Util.getResolutionFromScale=function(scale,units){var resolution;
if(scale){if(units==null){units="degrees"
}var normScale=OpenLayers.Util.normalizeScale(scale);
resolution=1/(normScale*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH)
}return resolution
};
OpenLayers.Util.getScaleFromResolution=function(resolution,units){if(units==null){units="degrees"
}var scale=resolution*OpenLayers.INCHES_PER_UNIT[units]*OpenLayers.DOTS_PER_INCH;
return scale
};
OpenLayers.Util.pagePosition=function(forElement){var pos=[0,0];
var viewportElement=OpenLayers.Util.getViewportElement();
if(!forElement||forElement==window||forElement==viewportElement){return pos
}var BUGGY_GECKO_BOX_OBJECT=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&OpenLayers.Element.getStyle(forElement,"position")=="absolute"&&(forElement.style.top==""||forElement.style.left=="");
var parent=null;
var box;
if(forElement.getBoundingClientRect){box=forElement.getBoundingClientRect();
var scrollTop=viewportElement.scrollTop;
var scrollLeft=viewportElement.scrollLeft;
pos[0]=box.left+scrollLeft;
pos[1]=box.top+scrollTop
}else{if(document.getBoxObjectFor&&!BUGGY_GECKO_BOX_OBJECT){box=document.getBoxObjectFor(forElement);
var vpBox=document.getBoxObjectFor(viewportElement);
pos[0]=box.screenX-vpBox.screenX;
pos[1]=box.screenY-vpBox.screenY
}else{pos[0]=forElement.offsetLeft;
pos[1]=forElement.offsetTop;
parent=forElement.offsetParent;
if(parent!=forElement){while(parent){pos[0]+=parent.offsetLeft;
pos[1]+=parent.offsetTop;
parent=parent.offsetParent
}}var browser=OpenLayers.BROWSER_NAME;
if(browser=="opera"||(browser=="safari"&&OpenLayers.Element.getStyle(forElement,"position")=="absolute")){pos[1]-=document.body.offsetTop
}parent=forElement.offsetParent;
while(parent&&parent!=document.body){pos[0]-=parent.scrollLeft;
if(browser!="opera"||parent.tagName!="TR"){pos[1]-=parent.scrollTop
}parent=parent.offsetParent
}}}return pos
};
OpenLayers.Util.getViewportElement=function(){var viewportElement=arguments.callee.viewportElement;
if(viewportElement==undefined){viewportElement=(OpenLayers.BROWSER_NAME=="msie"&&document.compatMode!="CSS1Compat")?document.body:document.documentElement;
arguments.callee.viewportElement=viewportElement
}return viewportElement
};
OpenLayers.Util.isEquivalentUrl=function(url1,url2,options){options=options||{};
OpenLayers.Util.applyDefaults(options,{ignoreCase:true,ignorePort80:true,ignoreHash:true});
var urlObj1=OpenLayers.Util.createUrlObject(url1,options);
var urlObj2=OpenLayers.Util.createUrlObject(url2,options);
for(var key in urlObj1){if(key!=="args"){if(urlObj1[key]!=urlObj2[key]){return false
}}}for(var key in urlObj1.args){if(urlObj1.args[key]!=urlObj2.args[key]){return false
}delete urlObj2.args[key]
}for(var key in urlObj2.args){return false
}return true
};
OpenLayers.Util.createUrlObject=function(url,options){options=options||{};
if(!(/^\w+:\/\//).test(url)){var loc=window.location;
var port=loc.port?":"+loc.port:"";
var fullUrl=loc.protocol+"//"+loc.host.split(":").shift()+port;
if(url.indexOf("/")===0){url=fullUrl+url
}else{var parts=loc.pathname.split("/");
parts.pop();
url=fullUrl+parts.join("/")+"/"+url
}}if(options.ignoreCase){url=url.toLowerCase()
}var a=document.createElement("a");
a.href=url;
var urlObject={};
urlObject.host=a.host.split(":").shift();
urlObject.protocol=a.protocol;
if(options.ignorePort80){urlObject.port=(a.port=="80"||a.port=="0")?"":a.port
}else{urlObject.port=(a.port==""||a.port=="0")?"80":a.port
}urlObject.hash=(options.ignoreHash||a.hash==="#")?"":a.hash;
var queryString=a.search;
if(!queryString){var qMark=url.indexOf("?");
queryString=(qMark!=-1)?url.substr(qMark):""
}urlObject.args=OpenLayers.Util.getParameters(queryString);
urlObject.pathname=(a.pathname.charAt(0)=="/")?a.pathname:"/"+a.pathname;
return urlObject
};
OpenLayers.Util.removeTail=function(url){var head=null;
var qMark=url.indexOf("?");
var hashMark=url.indexOf("#");
if(qMark==-1){head=(hashMark!=-1)?url.substr(0,hashMark):url
}else{head=(hashMark!=-1)?url.substr(0,Math.min(qMark,hashMark)):url.substr(0,qMark)
}return head
};
OpenLayers.IS_GECKO=(function(){var ua=navigator.userAgent.toLowerCase();
return ua.indexOf("webkit")==-1&&ua.indexOf("gecko")!=-1
})();
OpenLayers.CANVAS_SUPPORTED=(function(){var elem=document.createElement("canvas");
return !!(elem.getContext&&elem.getContext("2d"))
})();
OpenLayers.BROWSER_NAME=(function(){var name="";
var ua=navigator.userAgent.toLowerCase();
if(ua.indexOf("opera")!=-1){name="opera"
}else{if(ua.indexOf("msie")!=-1){name="msie"
}else{if(ua.indexOf("safari")!=-1){name="safari"
}else{if(ua.indexOf("mozilla")!=-1){if(ua.indexOf("firefox")!=-1){name="firefox"
}else{name="mozilla"
}}}}}return name
})();
OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME
};
OpenLayers.Util.getRenderedDimensions=function(contentHTML,size,options){var w,h;
var container=document.createElement("div");
container.style.visibility="hidden";
var containerElement=(options&&options.containerElement)?options.containerElement:document.body;
var parentHasPositionAbsolute=false;
var superContainer=null;
var parent=containerElement;
while(parent&&parent.tagName.toLowerCase()!="body"){var parentPosition=OpenLayers.Element.getStyle(parent,"position");
if(parentPosition=="absolute"){parentHasPositionAbsolute=true;
break
}else{if(parentPosition&&parentPosition!="static"){break
}}parent=parent.parentNode
}if(parentHasPositionAbsolute&&(containerElement.clientHeight===0||containerElement.clientWidth===0)){superContainer=document.createElement("div");
superContainer.style.visibility="hidden";
superContainer.style.position="absolute";
superContainer.style.overflow="visible";
superContainer.style.width=document.body.clientWidth+"px";
superContainer.style.height=document.body.clientHeight+"px";
superContainer.appendChild(container)
}container.style.position="absolute";
if(size){if(size.w){w=size.w;
container.style.width=w+"px"
}else{if(size.h){h=size.h;
container.style.height=h+"px"
}}}if(options&&options.displayClass){container.className=options.displayClass
}var content=document.createElement("div");
content.innerHTML=contentHTML;
content.style.overflow="visible";
if(content.childNodes){for(var i=0,l=content.childNodes.length;
i<l;
i++){if(!content.childNodes[i].style){continue
}content.childNodes[i].style.overflow="visible"
}}container.appendChild(content);
if(superContainer){containerElement.appendChild(superContainer)
}else{containerElement.appendChild(container)
}if(!w){w=parseInt(content.scrollWidth);
container.style.width=w+"px"
}if(!h){h=parseInt(content.scrollHeight)
}container.removeChild(content);
if(superContainer){superContainer.removeChild(container);
containerElement.removeChild(superContainer)
}else{containerElement.removeChild(container)
}return new OpenLayers.Size(w,h)
};
OpenLayers.Util.getScrollbarWidth=function(){var scrollbarWidth=OpenLayers.Util._scrollbarWidth;
if(scrollbarWidth==null){var scr=null;
var inn=null;
var wNoScroll=0;
var wScroll=0;
scr=document.createElement("div");
scr.style.position="absolute";
scr.style.top="-1000px";
scr.style.left="-1000px";
scr.style.width="100px";
scr.style.height="50px";
scr.style.overflow="hidden";
inn=document.createElement("div");
inn.style.width="100%";
inn.style.height="200px";
scr.appendChild(inn);
document.body.appendChild(scr);
wNoScroll=inn.offsetWidth;
scr.style.overflow="scroll";
wScroll=inn.offsetWidth;
document.body.removeChild(document.body.lastChild);
OpenLayers.Util._scrollbarWidth=(wNoScroll-wScroll);
scrollbarWidth=OpenLayers.Util._scrollbarWidth
}return scrollbarWidth
};
OpenLayers.Util.getFormattedLonLat=function(coordinate,axis,dmsOption){if(!dmsOption){dmsOption="dms"
}coordinate=(coordinate+540)%360-180;
var abscoordinate=Math.abs(coordinate);
var coordinatedegrees=Math.floor(abscoordinate);
var coordinateminutes=(abscoordinate-coordinatedegrees)/(1/60);
var tempcoordinateminutes=coordinateminutes;
coordinateminutes=Math.floor(coordinateminutes);
var coordinateseconds=(tempcoordinateminutes-coordinateminutes)/(1/60);
coordinateseconds=Math.round(coordinateseconds*10);
coordinateseconds/=10;
if(coordinateseconds>=60){coordinateseconds-=60;
coordinateminutes+=1;
if(coordinateminutes>=60){coordinateminutes-=60;
coordinatedegrees+=1
}}if(coordinatedegrees<10){coordinatedegrees="0"+coordinatedegrees
}var str=coordinatedegrees+"\u00B0";
if(dmsOption.indexOf("dm")>=0){if(coordinateminutes<10){coordinateminutes="0"+coordinateminutes
}str+=coordinateminutes+"'";
if(dmsOption.indexOf("dms")>=0){if(coordinateseconds<10){coordinateseconds="0"+coordinateseconds
}str+=coordinateseconds+'"'
}}if(axis=="lon"){str+=coordinate<0?OpenLayers.i18n("W"):OpenLayers.i18n("E")
}else{str+=coordinate<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")
}return str
};
OpenLayers.Animation=(function(window){var isNative=!!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame);
var requestFrame=(function(){var request=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(callback,16)
};
return function(callback,element){request.apply(window,[callback,element])
}
})();
var counter=0;
var loops={};
function start(callback,duration,element){duration=duration>0?duration:Number.POSITIVE_INFINITY;
var id=++counter;
var start=+new Date;
loops[id]=function(){if(loops[id]&&+new Date-start<=duration){callback();
if(loops[id]){requestFrame(loops[id],element)
}}else{delete loops[id]
}};
requestFrame(loops[id],element);
return id
}function stop(id){delete loops[id]
}return{isNative:isNative,requestFrame:requestFrame,start:start,stop:stop}
})(window);
OpenLayers.String={startsWith:function(str,sub){return(str.indexOf(sub)==0)
},contains:function(str,sub){return(str.indexOf(sub)!=-1)
},trim:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")
},camelize:function(str){var oStringList=str.split("-");
var camelizedString=oStringList[0];
for(var i=1,len=oStringList.length;
i<len;
i++){var s=oStringList[i];
camelizedString+=s.charAt(0).toUpperCase()+s.substring(1)
}return camelizedString
},format:function(template,context,args){if(!context){context=window
}var replacer=function(str,match){var replacement;
var subs=match.split(/\.+/);
for(var i=0;
i<subs.length;
i++){if(i==0){replacement=context
}replacement=replacement[subs[i]]
}if(typeof replacement=="function"){replacement=args?replacement.apply(null,args):replacement()
}if(typeof replacement=="undefined"){return"undefined"
}else{return replacement
}};
return template.replace(OpenLayers.String.tokenRegEx,replacer)
},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(value){return OpenLayers.String.numberRegEx.test(value)
},numericIf:function(value){return OpenLayers.String.isNumeric(value)?parseFloat(value):value
}};
OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(num,sig){var fig=0;
if(sig>0){fig=parseFloat(num.toPrecision(sig))
}return fig
},format:function(num,dec,tsep,dsep){dec=(typeof dec!="undefined")?dec:0;
tsep=(typeof tsep!="undefined")?tsep:OpenLayers.Number.thousandsSeparator;
dsep=(typeof dsep!="undefined")?dsep:OpenLayers.Number.decimalSeparator;
if(dec!=null){num=parseFloat(num.toFixed(dec))
}var parts=num.toString().split(".");
if(parts.length==1&&dec==null){dec=0
}var integer=parts[0];
if(tsep){var thousands=/(-?[0-9]+)([0-9]{3})/;
while(thousands.test(integer)){integer=integer.replace(thousands,"$1"+tsep+"$2")
}}var str;
if(dec==0){str=integer
}else{var rem=parts.length>1?parts[1]:"0";
if(dec!=null){rem=rem+new Array(dec-rem.length+1).join("0")
}str=integer+dsep+rem
}return str
}};
OpenLayers.Function={bind:function(func,object){var args=Array.prototype.slice.apply(arguments,[2]);
return function(){var newArgs=args.concat(Array.prototype.slice.apply(arguments,[0]));
return func.apply(object,newArgs)
}
},bindAsEventListener:function(func,object){return function(event){return func.call(object,event||window.event)
}
},False:function(){return false
},True:function(){return true
},Void:function(){}};
OpenLayers.Array={filter:function(array,callback,caller){var selected=[];
if(Array.prototype.filter){selected=array.filter(callback,caller)
}else{var len=array.length;
if(typeof callback!="function"){throw new TypeError()
}for(var i=0;
i<len;
i++){if(i in array){var val=array[i];
if(callback.call(caller,val,i,array)){selected.push(val)
}}}}return selected
}};
OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(left,bottom,right,top){if(OpenLayers.Util.isArray(left)){top=left[3];
right=left[2];
bottom=left[1];
left=left[0]
}if(left!=null){this.left=OpenLayers.Util.toFloat(left)
}if(bottom!=null){this.bottom=OpenLayers.Util.toFloat(bottom)
}if(right!=null){this.right=OpenLayers.Util.toFloat(right)
}if(top!=null){this.top=OpenLayers.Util.toFloat(top)
}},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)
},equals:function(bounds){var equals=false;
if(bounds!=null){equals=((this.left==bounds.left)&&(this.right==bounds.right)&&(this.top==bounds.top)&&(this.bottom==bounds.bottom))
}return equals
},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")
},toArray:function(reverseAxisOrder){if(reverseAxisOrder===true){return[this.bottom,this.left,this.top,this.right]
}else{return[this.left,this.bottom,this.right,this.top]
}},toBBOX:function(decimal,reverseAxisOrder){if(decimal==null){decimal=6
}var mult=Math.pow(10,decimal);
var xmin=Math.round(this.left*mult)/mult;
var ymin=Math.round(this.bottom*mult)/mult;
var xmax=Math.round(this.right*mult)/mult;
var ymax=Math.round(this.top*mult)/mult;
if(reverseAxisOrder===true){return ymin+","+xmin+","+ymax+","+xmax
}else{return xmin+","+ymin+","+xmax+","+ymax
}},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])
},getWidth:function(){return(this.right-this.left)
},getHeight:function(){return(this.top-this.bottom)
},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())
},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)
},getCenterLonLat:function(){if(!this.centerLonLat){this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)
}return this.centerLonLat
},scale:function(ratio,origin){if(origin==null){origin=this.getCenterLonLat()
}var origx,origy;
if(origin.CLASS_NAME=="OpenLayers.LonLat"){origx=origin.lon;
origy=origin.lat
}else{origx=origin.x;
origy=origin.y
}var left=(this.left-origx)*ratio+origx;
var bottom=(this.bottom-origy)*ratio+origy;
var right=(this.right-origx)*ratio+origx;
var top=(this.top-origy)*ratio+origy;
return new OpenLayers.Bounds(left,bottom,right,top)
},add:function(x,y){if((x==null)||(y==null)){throw new TypeError("Bounds.add cannot receive null values")
}return new OpenLayers.Bounds(this.left+x,this.bottom+y,this.right+x,this.top+y)
},extend:function(object){var bounds=null;
if(object){switch(object.CLASS_NAME){case"OpenLayers.LonLat":bounds=new OpenLayers.Bounds(object.lon,object.lat,object.lon,object.lat);
break;
case"OpenLayers.Geometry.Point":bounds=new OpenLayers.Bounds(object.x,object.y,object.x,object.y);
break;
case"OpenLayers.Bounds":bounds=object;
break
}if(bounds){this.centerLonLat=null;
if((this.left==null)||(bounds.left<this.left)){this.left=bounds.left
}if((this.bottom==null)||(bounds.bottom<this.bottom)){this.bottom=bounds.bottom
}if((this.right==null)||(bounds.right>this.right)){this.right=bounds.right
}if((this.top==null)||(bounds.top>this.top)){this.top=bounds.top
}}}},containsLonLat:function(ll,options){if(typeof options==="boolean"){options={inclusive:options}
}options=options||{};
var contains=this.contains(ll.lon,ll.lat,options.inclusive),worldBounds=options.worldBounds;
if(worldBounds&&!contains){var worldWidth=worldBounds.getWidth();
var worldCenterX=(worldBounds.left+worldBounds.right)/2;
var worldsAway=Math.round((ll.lon-worldCenterX)/worldWidth);
contains=this.containsLonLat({lon:ll.lon-worldsAway*worldWidth,lat:ll.lat},{inclusive:options.inclusive})
}return contains
},containsPixel:function(px,inclusive){return this.contains(px.x,px.y,inclusive)
},contains:function(x,y,inclusive){if(inclusive==null){inclusive=true
}if(x==null||y==null){return false
}x=OpenLayers.Util.toFloat(x);
y=OpenLayers.Util.toFloat(y);
var contains=false;
if(inclusive){contains=((x>=this.left)&&(x<=this.right)&&(y>=this.bottom)&&(y<=this.top))
}else{contains=((x>this.left)&&(x<this.right)&&(y>this.bottom)&&(y<this.top))
}return contains
},intersectsBounds:function(bounds,options){if(typeof options==="boolean"){options={inclusive:options}
}options=options||{};
if(options.worldBounds){var self=this.wrapDateLine(options.worldBounds);
bounds=bounds.wrapDateLine(options.worldBounds)
}else{self=this
}if(options.inclusive==null){options.inclusive=true
}var intersects=false;
var mightTouch=(self.left==bounds.right||self.right==bounds.left||self.top==bounds.bottom||self.bottom==bounds.top);
if(options.inclusive||!mightTouch){var inBottom=(((bounds.bottom>=self.bottom)&&(bounds.bottom<=self.top))||((self.bottom>=bounds.bottom)&&(self.bottom<=bounds.top)));
var inTop=(((bounds.top>=self.bottom)&&(bounds.top<=self.top))||((self.top>bounds.bottom)&&(self.top<bounds.top)));
var inLeft=(((bounds.left>=self.left)&&(bounds.left<=self.right))||((self.left>=bounds.left)&&(self.left<=bounds.right)));
var inRight=(((bounds.right>=self.left)&&(bounds.right<=self.right))||((self.right>=bounds.left)&&(self.right<=bounds.right)));
intersects=((inBottom||inTop)&&(inLeft||inRight))
}if(options.worldBounds&&!intersects){var world=options.worldBounds;
var width=world.getWidth();
var selfCrosses=!world.containsBounds(self);
var boundsCrosses=!world.containsBounds(bounds);
if(selfCrosses&&!boundsCrosses){bounds=bounds.add(-width,0);
intersects=self.intersectsBounds(bounds,{inclusive:options.inclusive})
}else{if(boundsCrosses&&!selfCrosses){self=self.add(-width,0);
intersects=bounds.intersectsBounds(self,{inclusive:options.inclusive})
}}}return intersects
},containsBounds:function(bounds,partial,inclusive){if(partial==null){partial=false
}if(inclusive==null){inclusive=true
}var bottomLeft=this.contains(bounds.left,bounds.bottom,inclusive);
var bottomRight=this.contains(bounds.right,bounds.bottom,inclusive);
var topLeft=this.contains(bounds.left,bounds.top,inclusive);
var topRight=this.contains(bounds.right,bounds.top,inclusive);
return(partial)?(bottomLeft||bottomRight||topLeft||topRight):(bottomLeft&&bottomRight&&topLeft&&topRight)
},determineQuadrant:function(lonlat){var quadrant="";
var center=this.getCenterLonLat();
quadrant+=(lonlat.lat<center.lat)?"b":"t";
quadrant+=(lonlat.lon<center.lon)?"l":"r";
return quadrant
},transform:function(source,dest){this.centerLonLat=null;
var ll=OpenLayers.Projection.transform({x:this.left,y:this.bottom},source,dest);
var lr=OpenLayers.Projection.transform({x:this.right,y:this.bottom},source,dest);
var ul=OpenLayers.Projection.transform({x:this.left,y:this.top},source,dest);
var ur=OpenLayers.Projection.transform({x:this.right,y:this.top},source,dest);
this.left=Math.min(ll.x,ul.x);
this.bottom=Math.min(ll.y,lr.y);
this.right=Math.max(lr.x,ur.x);
this.top=Math.max(ul.y,ur.y);
return this
},wrapDateLine:function(maxExtent,options){options=options||{};
var leftTolerance=options.leftTolerance||0;
var rightTolerance=options.rightTolerance||0;
var newBounds=this.clone();
if(maxExtent){var width=maxExtent.getWidth();
while(newBounds.left<maxExtent.left&&newBounds.right-rightTolerance<=maxExtent.left){newBounds=newBounds.add(width,0)
}while(newBounds.left+leftTolerance>=maxExtent.right&&newBounds.right>maxExtent.right){newBounds=newBounds.add(-width,0)
}var newLeft=newBounds.left+leftTolerance;
if(newLeft<maxExtent.right&&newLeft>maxExtent.left&&newBounds.right-rightTolerance>maxExtent.right){newBounds=newBounds.add(-width,0)
}}return newBounds
},CLASS_NAME:"OpenLayers.Bounds"});
OpenLayers.Bounds.fromString=function(str,reverseAxisOrder){var bounds=str.split(",");
return OpenLayers.Bounds.fromArray(bounds,reverseAxisOrder)
};
OpenLayers.Bounds.fromArray=function(bbox,reverseAxisOrder){return reverseAxisOrder===true?new OpenLayers.Bounds(bbox[1],bbox[0],bbox[3],bbox[2]):new OpenLayers.Bounds(bbox[0],bbox[1],bbox[2],bbox[3])
};
OpenLayers.Bounds.fromSize=function(size){return new OpenLayers.Bounds(0,size.h,size.w,0)
};
OpenLayers.Bounds.oppositeQuadrant=function(quadrant){var opp="";
opp+=(quadrant.charAt(0)=="t")?"b":"t";
opp+=(quadrant.charAt(1)=="l")?"r":"l";
return opp
};
OpenLayers.Date={toISOString:(function(){if("toISOString" in Date.prototype){return function(date){return date.toISOString()
}
}else{function pad(num,len){var str=num+"";
while(str.length<len){str="0"+str
}return str
}return function(date){var str;
if(isNaN(date.getTime())){str="Invalid Date"
}else{str=date.getUTCFullYear()+"-"+pad(date.getUTCMonth()+1,2)+"-"+pad(date.getUTCDate(),2)+"T"+pad(date.getUTCHours(),2)+":"+pad(date.getUTCMinutes(),2)+":"+pad(date.getUTCSeconds(),2)+"."+pad(date.getUTCMilliseconds(),3)+"Z"
}return str
}
}})(),parse:function(str){var date;
var match=str.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/);
if(match&&(match[1]||match[7])){var year=parseInt(match[1],10)||0;
var month=(parseInt(match[2],10)-1)||0;
var day=parseInt(match[3],10)||1;
date=new Date(Date.UTC(year,month,day));
var type=match[7];
if(type){var hours=parseInt(match[4],10);
var minutes=parseInt(match[5],10);
var secFrac=parseFloat(match[6]);
var seconds=secFrac|0;
var milliseconds=Math.round(1000*(secFrac-seconds));
date.setUTCHours(hours,minutes,seconds,milliseconds);
if(type!=="Z"){var hoursOffset=parseInt(type,10);
var minutesOffset=parseInt(match[8],10)||0;
var offset=-1000*(60*(hoursOffset*60)+minutesOffset*60);
date=new Date(date.getTime()+offset)
}}}else{date=new Date("invalid")
}return date
}};
OpenLayers.Element={visible:function(element){return OpenLayers.Util.getElement(element).style.display!="none"
},toggle:function(){for(var i=0,len=arguments.length;
i<len;
i++){var element=OpenLayers.Util.getElement(arguments[i]);
var display=OpenLayers.Element.visible(element)?"none":"";
element.style.display=display
}},remove:function(element){element=OpenLayers.Util.getElement(element);
element.parentNode.removeChild(element)
},getHeight:function(element){element=OpenLayers.Util.getElement(element);
return element.offsetHeight
},hasClass:function(element,name){var names=element.className;
return(!!names&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(names))
},addClass:function(element,name){if(!OpenLayers.Element.hasClass(element,name)){element.className+=(element.className?" ":"")+name
}return element
},removeClass:function(element,name){var names=element.className;
if(names){element.className=OpenLayers.String.trim(names.replace(new RegExp("(^|\\s+)"+name+"(\\s+|$)")," "))
}return element
},toggleClass:function(element,name){if(OpenLayers.Element.hasClass(element,name)){OpenLayers.Element.removeClass(element,name)
}else{OpenLayers.Element.addClass(element,name)
}return element
},getStyle:function(element,style){element=OpenLayers.Util.getElement(element);
var value=null;
if(element&&element.style){value=element.style[OpenLayers.String.camelize(style)];
if(!value){if(document.defaultView&&document.defaultView.getComputedStyle){var css=document.defaultView.getComputedStyle(element,null);
value=css?css.getPropertyValue(style):null
}else{if(element.currentStyle){value=element.currentStyle[OpenLayers.String.camelize(style)]
}}}var positions=["left","top","right","bottom"];
if(window.opera&&(OpenLayers.Util.indexOf(positions,style)!=-1)&&(OpenLayers.Element.getStyle(element,"position")=="static")){value="auto"
}}return value=="auto"?null:value
}};
OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(lon,lat){if(OpenLayers.Util.isArray(lon)){lat=lon[1];
lon=lon[0]
}this.lon=OpenLayers.Util.toFloat(lon);
this.lat=OpenLayers.Util.toFloat(lat)
},toString:function(){return("lon="+this.lon+",lat="+this.lat)
},toShortString:function(){return(this.lon+", "+this.lat)
},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)
},add:function(lon,lat){if((lon==null)||(lat==null)){throw new TypeError("LonLat.add cannot receive null values")
}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(lon),this.lat+OpenLayers.Util.toFloat(lat))
},equals:function(ll){var equals=false;
if(ll!=null){equals=((this.lon==ll.lon&&this.lat==ll.lat)||(isNaN(this.lon)&&isNaN(this.lat)&&isNaN(ll.lon)&&isNaN(ll.lat)))
}return equals
},transform:function(source,dest){var point=OpenLayers.Projection.transform({x:this.lon,y:this.lat},source,dest);
this.lon=point.x;
this.lat=point.y;
return this
},wrapDateLine:function(maxExtent){var newLonLat=this.clone();
if(maxExtent){while(newLonLat.lon<maxExtent.left){newLonLat.lon+=maxExtent.getWidth()
}while(newLonLat.lon>maxExtent.right){newLonLat.lon-=maxExtent.getWidth()
}}return newLonLat
},CLASS_NAME:"OpenLayers.LonLat"});
OpenLayers.LonLat.fromString=function(str){var pair=str.split(",");
return new OpenLayers.LonLat(pair[0],pair[1])
};
OpenLayers.LonLat.fromArray=function(arr){var gotArr=OpenLayers.Util.isArray(arr),lon=gotArr&&arr[0],lat=gotArr&&arr[1];
return new OpenLayers.LonLat(lon,lat)
};
OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(x,y){this.x=parseFloat(x);
this.y=parseFloat(y)
},toString:function(){return("x="+this.x+",y="+this.y)
},clone:function(){return new OpenLayers.Pixel(this.x,this.y)
},equals:function(px){var equals=false;
if(px!=null){equals=((this.x==px.x&&this.y==px.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(px.x)&&isNaN(px.y)))
}return equals
},distanceTo:function(px){return Math.sqrt(Math.pow(this.x-px.x,2)+Math.pow(this.y-px.y,2))
},add:function(x,y){if((x==null)||(y==null)){throw new TypeError("Pixel.add cannot receive null values")
}return new OpenLayers.Pixel(this.x+x,this.y+y)
},offset:function(px){var newPx=this.clone();
if(px){newPx=this.add(px.x,px.y)
}return newPx
},CLASS_NAME:"OpenLayers.Pixel"});
OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(w,h){this.w=parseFloat(w);
this.h=parseFloat(h)
},toString:function(){return("w="+this.w+",h="+this.h)
},clone:function(){return new OpenLayers.Size(this.w,this.h)
},equals:function(sz){var equals=false;
if(sz!=null){equals=((this.w==sz.w&&this.h==sz.h)||(isNaN(this.w)&&isNaN(this.h)&&isNaN(sz.w)&&isNaN(sz.h)))
}return equals
},CLASS_NAME:"OpenLayers.Size"});
OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(error){alert(error)
},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};
(function(){var scripts=document.getElementsByTagName("script");
for(var i=0,len=scripts.length;
i<len;
++i){if(scripts[i].src.indexOf("firebug.js")!=-1){if(console){OpenLayers.Util.extend(OpenLayers.Console,console);
break
}}}})();
OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,animationId:null,playing:false,initialize:function(easing){this.easing=(easing)?easing:OpenLayers.Easing.Expo.easeOut
},start:function(begin,finish,duration,options){this.playing=true;
this.begin=begin;
this.finish=finish;
this.duration=duration;
this.callbacks=options.callbacks;
this.time=0;
OpenLayers.Animation.stop(this.animationId);
this.animationId=null;
if(this.callbacks&&this.callbacks.start){this.callbacks.start.call(this,this.begin)
}this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))
},stop:function(){if(!this.playing){return
}if(this.callbacks&&this.callbacks.done){this.callbacks.done.call(this,this.finish)
}OpenLayers.Animation.stop(this.animationId);
this.animationId=null;
this.playing=false
},play:function(){var value={};
for(var i in this.begin){var b=this.begin[i];
var f=this.finish[i];
if(b==null||f==null||isNaN(b)||isNaN(f)){throw new TypeError("invalid value for Tween")
}var c=f-b;
value[i]=this.easing.apply(this,[this.time,b,c,this.duration])
}this.time++;
if(this.callbacks&&this.callbacks.eachStep){this.callbacks.eachStep.call(this,value)
}if(this.time>this.duration){this.stop()
}},CLASS_NAME:"OpenLayers.Tween"});
OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};
OpenLayers.Easing.Linear={easeIn:function(t,b,c,d){return c*t/d+b
},easeOut:function(t,b,c,d){return c*t/d+b
},easeInOut:function(t,b,c,d){return c*t/d+b
},CLASS_NAME:"OpenLayers.Easing.Linear"};
OpenLayers.Easing.Expo={easeIn:function(t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b
},easeOut:function(t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b
},easeInOut:function(t,b,c,d){if(t==0){return b
}if(t==d){return b+c
}if((t/=d/2)<1){return c/2*Math.pow(2,10*(t-1))+b
}return c/2*(-Math.pow(2,-10*--t)+2)+b
},CLASS_NAME:"OpenLayers.Easing.Expo"};
OpenLayers.Easing.Quad={easeIn:function(t,b,c,d){return c*(t/=d)*t+b
},easeOut:function(t,b,c,d){return -c*(t/=d)*(t-2)+b
},easeInOut:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b
}return -c/2*((--t)*(t-2)-1)+b
},CLASS_NAME:"OpenLayers.Easing.Quad"};
OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:0.0035,nbPoints:100,delay:200,points:undefined,timerId:undefined,initialize:function(options){OpenLayers.Util.extend(this,options)
},begin:function(){OpenLayers.Animation.stop(this.timerId);
this.timerId=undefined;
this.points=[]
},update:function(xy){this.points.unshift({xy:xy,tick:new Date().getTime()});
if(this.points.length>this.nbPoints){this.points.pop()
}},end:function(xy){var last,now=new Date().getTime();
for(var i=0,l=this.points.length,point;
i<l;
i++){point=this.points[i];
if(now-point.tick>this.delay){break
}last=point
}if(!last){return
}var time=new Date().getTime()-last.tick;
var dist=Math.sqrt(Math.pow(xy.x-last.xy.x,2)+Math.pow(xy.y-last.xy.y,2));
var speed=dist/time;
if(speed==0||speed<this.threshold){return
}var theta=Math.asin((xy.y-last.xy.y)/dist);
if(last.xy.x<=xy.x){theta=Math.PI-theta
}return{speed:speed,theta:theta}
},move:function(info,callback){var v0=info.speed;
var fx=Math.cos(info.theta);
var fy=-Math.sin(info.theta);
var initialTime=new Date().getTime();
var lastX=0;
var lastY=0;
var timerCallback=function(){if(this.timerId==null){return
}var t=new Date().getTime()-initialTime;
var p=(-this.deceleration*Math.pow(t,2))/2+v0*t;
var x=p*fx;
var y=p*fy;
var args={};
args.end=false;
var v=-this.deceleration*t+v0;
if(v<=0){OpenLayers.Animation.stop(this.timerId);
this.timerId=null;
args.end=true
}args.x=x-lastX;
args.y=y-lastY;
lastX=x;
lastY=y;
callback(args.x,args.y,args.end)
};
this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(timerCallback,this))
},CLASS_NAME:"OpenLayers.Kinetic"});
OpenLayers.Console.warn("OpenLayers.Rico is deprecated");
OpenLayers.Rico=OpenLayers.Rico||{};
OpenLayers.Rico.Corner={round:function(e,options){e=OpenLayers.Util.getElement(e);
this._setOptions(options);
var color=this.options.color;
if(this.options.color=="fromElement"){color=this._background(e)
}var bgColor=this.options.bgColor;
if(this.options.bgColor=="fromParent"){bgColor=this._background(e.offsetParent)
}this._roundCornersImpl(e,color,bgColor)
},changeColor:function(theDiv,newColor){theDiv.style.backgroundColor=newColor;
var spanElements=theDiv.parentNode.getElementsByTagName("span");
for(var currIdx=0;
currIdx<spanElements.length;
currIdx++){spanElements[currIdx].style.backgroundColor=newColor
}},changeOpacity:function(theDiv,newOpacity){var mozillaOpacity=newOpacity;
var ieOpacity="alpha(opacity="+newOpacity*100+")";
theDiv.style.opacity=mozillaOpacity;
theDiv.style.filter=ieOpacity;
var spanElements=theDiv.parentNode.getElementsByTagName("span");
for(var currIdx=0;
currIdx<spanElements.length;
currIdx++){spanElements[currIdx].style.opacity=mozillaOpacity;
spanElements[currIdx].style.filter=ieOpacity
}},reRound:function(theDiv,options){var topRico=theDiv.parentNode.childNodes[0];
var bottomRico=theDiv.parentNode.childNodes[2];
theDiv.parentNode.removeChild(topRico);
theDiv.parentNode.removeChild(bottomRico);
this.round(theDiv.parentNode,options)
},_roundCornersImpl:function(e,color,bgColor){if(this.options.border){this._renderBorder(e,bgColor)
}if(this._isTopRounded()){this._roundTopCorners(e,color,bgColor)
}if(this._isBottomRounded()){this._roundBottomCorners(e,color,bgColor)
}},_renderBorder:function(el,bgColor){var borderValue="1px solid "+this._borderColor(bgColor);
var borderL="border-left: "+borderValue;
var borderR="border-right: "+borderValue;
var style="style='"+borderL+";"+borderR+"'";
el.innerHTML="<div "+style+">"+el.innerHTML+"</div>"
},_roundTopCorners:function(el,color,bgColor){var corner=this._createCorner(bgColor);
for(var i=0;
i<this.options.numSlices;
i++){corner.appendChild(this._createCornerSlice(color,bgColor,i,"top"))
}el.style.paddingTop=0;
el.insertBefore(corner,el.firstChild)
},_roundBottomCorners:function(el,color,bgColor){var corner=this._createCorner(bgColor);
for(var i=(this.options.numSlices-1);
i>=0;
i--){corner.appendChild(this._createCornerSlice(color,bgColor,i,"bottom"))
}el.style.paddingBottom=0;
el.appendChild(corner)
},_createCorner:function(bgColor){var corner=document.createElement("div");
corner.style.backgroundColor=(this._isTransparent()?"transparent":bgColor);
return corner
},_createCornerSlice:function(color,bgColor,n,position){var slice=document.createElement("span");
var inStyle=slice.style;
inStyle.backgroundColor=color;
inStyle.display="block";
inStyle.height="1px";
inStyle.overflow="hidden";
inStyle.fontSize="1px";
var borderColor=this._borderColor(color,bgColor);
if(this.options.border&&n==0){inStyle.borderTopStyle="solid";
inStyle.borderTopWidth="1px";
inStyle.borderLeftWidth="0px";
inStyle.borderRightWidth="0px";
inStyle.borderBottomWidth="0px";
inStyle.height="0px";
inStyle.borderColor=borderColor
}else{if(borderColor){inStyle.borderColor=borderColor;
inStyle.borderStyle="solid";
inStyle.borderWidth="0px 1px"
}}if(!this.options.compact&&(n==(this.options.numSlices-1))){inStyle.height="2px"
}this._setMargin(slice,n,position);
this._setBorder(slice,n,position);
return slice
},_setOptions:function(options){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:true,border:false,compact:false};
OpenLayers.Util.extend(this.options,options||{});
this.options.numSlices=this.options.compact?2:4;
if(this._isTransparent()){this.options.blend=false
}},_whichSideTop:function(){if(this._hasString(this.options.corners,"all","top")){return""
}if(this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0){return""
}if(this.options.corners.indexOf("tl")>=0){return"left"
}else{if(this.options.corners.indexOf("tr")>=0){return"right"
}}return""
},_whichSideBottom:function(){if(this._hasString(this.options.corners,"all","bottom")){return""
}if(this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0){return""
}if(this.options.corners.indexOf("bl")>=0){return"left"
}else{if(this.options.corners.indexOf("br")>=0){return"right"
}}return""
},_borderColor:function(color,bgColor){if(color=="transparent"){return bgColor
}else{if(this.options.border){return this.options.border
}else{if(this.options.blend){return this._blend(bgColor,color)
}else{return""
}}}},_setMargin:function(el,n,corners){var marginSize=this._marginSize(n);
var whichSide=corners=="top"?this._whichSideTop():this._whichSideBottom();
if(whichSide=="left"){el.style.marginLeft=marginSize+"px";
el.style.marginRight="0px"
}else{if(whichSide=="right"){el.style.marginRight=marginSize+"px";
el.style.marginLeft="0px"
}else{el.style.marginLeft=marginSize+"px";
el.style.marginRight=marginSize+"px"
}}},_setBorder:function(el,n,corners){var borderSize=this._borderSize(n);
var whichSide=corners=="top"?this._whichSideTop():this._whichSideBottom();
if(whichSide=="left"){el.style.borderLeftWidth=borderSize+"px";
el.style.borderRightWidth="0px"
}else{if(whichSide=="right"){el.style.borderRightWidth=borderSize+"px";
el.style.borderLeftWidth="0px"
}else{el.style.borderLeftWidth=borderSize+"px";
el.style.borderRightWidth=borderSize+"px"
}}if(this.options.border!=false){el.style.borderLeftWidth=borderSize+"px";
el.style.borderRightWidth=borderSize+"px"
}},_marginSize:function(n){if(this._isTransparent()){return 0
}var marginSizes=[5,3,2,1];
var blendedMarginSizes=[3,2,1,0];
var compactMarginSizes=[2,1];
var smBlendedMarginSizes=[1,0];
if(this.options.compact&&this.options.blend){return smBlendedMarginSizes[n]
}else{if(this.options.compact){return compactMarginSizes[n]
}else{if(this.options.blend){return blendedMarginSizes[n]
}else{return marginSizes[n]
}}}},_borderSize:function(n){var transparentBorderSizes=[5,3,2,1];
var blendedBorderSizes=[2,1,1,1];
var compactBorderSizes=[1,0];
var actualBorderSizes=[0,2,0,0];
if(this.options.compact&&(this.options.blend||this._isTransparent())){return 1
}else{if(this.options.compact){return compactBorderSizes[n]
}else{if(this.options.blend){return blendedBorderSizes[n]
}else{if(this.options.border){return actualBorderSizes[n]
}else{if(this._isTransparent()){return transparentBorderSizes[n]
}}}}}return 0
},_hasString:function(str){for(var i=1;
i<arguments.length;
i++){if(str.indexOf(arguments[i])>=0){return true
}}return false
},_blend:function(c1,c2){var cc1=OpenLayers.Rico.Color.createFromHex(c1);
cc1.blend(OpenLayers.Rico.Color.createFromHex(c2));
return cc1
},_background:function(el){try{return OpenLayers.Rico.Color.createColorFromBackground(el).asHex()
}catch(err){return"#ffffff"
}},_isTransparent:function(){return this.options.color=="transparent"
},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")
},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")
},_hasSingleTextChild:function(el){return el.childNodes.length==1&&el.childNodes[0].nodeType==3
}};
OpenLayers.Console.warn("OpenLayers.Rico is deprecated");
OpenLayers.Rico=OpenLayers.Rico||{};
OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(red,green,blue){this.rgb={r:red,g:green,b:blue}
},setRed:function(r){this.rgb.r=r
},setGreen:function(g){this.rgb.g=g
},setBlue:function(b){this.rgb.b=b
},setHue:function(h){var hsb=this.asHSB();
hsb.h=h;
this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)
},setSaturation:function(s){var hsb=this.asHSB();
hsb.s=s;
this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)
},setBrightness:function(b){var hsb=this.asHSB();
hsb.b=b;
this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,hsb.b)
},darken:function(percent){var hsb=this.asHSB();
this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.max(hsb.b-percent,0))
},brighten:function(percent){var hsb=this.asHSB();
this.rgb=OpenLayers.Rico.Color.HSBtoRGB(hsb.h,hsb.s,Math.min(hsb.b+percent,1))
},blend:function(other){this.rgb.r=Math.floor((this.rgb.r+other.rgb.r)/2);
this.rgb.g=Math.floor((this.rgb.g+other.rgb.g)/2);
this.rgb.b=Math.floor((this.rgb.b+other.rgb.b)/2)
},isBright:function(){var hsb=this.asHSB();
return this.asHSB().b>0.5
},isDark:function(){return !this.isBright()
},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"
},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()
},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)
},toString:function(){return this.asHex()
}});
OpenLayers.Rico.Color.createFromHex=function(hexCode){if(hexCode.length==4){var shortHexCode=hexCode;
var hexCode="#";
for(var i=1;
i<4;
i++){hexCode+=(shortHexCode.charAt(i)+shortHexCode.charAt(i))
}}if(hexCode.indexOf("#")==0){hexCode=hexCode.substring(1)
}var red=hexCode.substring(0,2);
var green=hexCode.substring(2,4);
var blue=hexCode.substring(4,6);
return new OpenLayers.Rico.Color(parseInt(red,16),parseInt(green,16),parseInt(blue,16))
};
OpenLayers.Rico.Color.createColorFromBackground=function(elem){var actualColor=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(elem),"backgroundColor");
if(actualColor=="transparent"&&elem.parentNode){return OpenLayers.Rico.Color.createColorFromBackground(elem.parentNode)
}if(actualColor==null){return new OpenLayers.Rico.Color(255,255,255)
}if(actualColor.indexOf("rgb(")==0){var colors=actualColor.substring(4,actualColor.length-1);
var colorArray=colors.split(",");
return new OpenLayers.Rico.Color(parseInt(colorArray[0]),parseInt(colorArray[1]),parseInt(colorArray[2]))
}else{if(actualColor.indexOf("#")==0){return OpenLayers.Rico.Color.createFromHex(actualColor)
}else{return new OpenLayers.Rico.Color(255,255,255)
}}};
OpenLayers.Rico.Color.HSBtoRGB=function(hue,saturation,brightness){var red=0;
var green=0;
var blue=0;
if(saturation==0){red=parseInt(brightness*255+0.5);
green=red;
blue=red
}else{var h=(hue-Math.floor(hue))*6;
var f=h-Math.floor(h);
var p=brightness*(1-saturation);
var q=brightness*(1-saturation*f);
var t=brightness*(1-(saturation*(1-f)));
switch(parseInt(h)){case 0:red=(brightness*255+0.5);
green=(t*255+0.5);
blue=(p*255+0.5);
break;
case 1:red=(q*255+0.5);
green=(brightness*255+0.5);
blue=(p*255+0.5);
break;
case 2:red=(p*255+0.5);
green=(brightness*255+0.5);
blue=(t*255+0.5);
break;
case 3:red=(p*255+0.5);
green=(q*255+0.5);
blue=(brightness*255+0.5);
break;
case 4:red=(t*255+0.5);
green=(p*255+0.5);
blue=(brightness*255+0.5);
break;
case 5:red=(brightness*255+0.5);
green=(p*255+0.5);
blue=(q*255+0.5);
break
}}return{r:parseInt(red),g:parseInt(green),b:parseInt(blue)}
};
OpenLayers.Rico.Color.RGBtoHSB=function(r,g,b){var hue;
var saturation;
var brightness;
var cmax=(r>g)?r:g;
if(b>cmax){cmax=b
}var cmin=(r<g)?r:g;
if(b<cmin){cmin=b
}brightness=cmax/255;
if(cmax!=0){saturation=(cmax-cmin)/cmax
}else{saturation=0
}if(saturation==0){hue=0
}else{var redc=(cmax-r)/(cmax-cmin);
var greenc=(cmax-g)/(cmax-cmin);
var bluec=(cmax-b)/(cmax-cmin);
if(r==cmax){hue=bluec-greenc
}else{if(g==cmax){hue=2+redc-bluec
}else{hue=4+greenc-redc
}}hue=hue/6;
if(hue<0){hue=hue+1
}}return{h:hue,s:saturation,b:brightness}
};
OpenLayers.Event={observers:false,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(event){return event.target||event.srcElement
},isSingleTouch:function(event){return event.touches&&event.touches.length==1
},isMultiTouch:function(event){return event.touches&&event.touches.length>1
},isLeftClick:function(event){return(((event.which)&&(event.which==1))||((event.button)&&(event.button==1)))
},isRightClick:function(event){return(((event.which)&&(event.which==3))||((event.button)&&(event.button==2)))
},stop:function(event,allowDefault){if(!allowDefault){if(event.preventDefault){event.preventDefault()
}else{event.returnValue=false
}}if(event.stopPropagation){event.stopPropagation()
}else{event.cancelBubble=true
}},findElement:function(event,tagName){var element=OpenLayers.Event.element(event);
while(element.parentNode&&(!element.tagName||(element.tagName.toUpperCase()!=tagName.toUpperCase()))){element=element.parentNode
}return element
},observe:function(elementParam,name,observer,useCapture){var element=OpenLayers.Util.getElement(elementParam);
useCapture=useCapture||false;
if(name=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.attachEvent)){name="keydown"
}if(!this.observers){this.observers={}
}if(!element._eventCacheID){var idPrefix="eventCacheID_";
if(element.id){idPrefix=element.id+"_"+idPrefix
}element._eventCacheID=OpenLayers.Util.createUniqueID(idPrefix)
}var cacheID=element._eventCacheID;
if(!this.observers[cacheID]){this.observers[cacheID]=[]
}this.observers[cacheID].push({element:element,name:name,observer:observer,useCapture:useCapture});
if(element.addEventListener){element.addEventListener(name,observer,useCapture)
}else{if(element.attachEvent){element.attachEvent("on"+name,observer)
}}},stopObservingElement:function(elementParam){var element=OpenLayers.Util.getElement(elementParam);
var cacheID=element._eventCacheID;
this._removeElementObservers(OpenLayers.Event.observers[cacheID])
},_removeElementObservers:function(elementObservers){if(elementObservers){for(var i=elementObservers.length-1;
i>=0;
i--){var entry=elementObservers[i];
var args=new Array(entry.element,entry.name,entry.observer,entry.useCapture);
var removed=OpenLayers.Event.stopObserving.apply(this,args)
}}},stopObserving:function(elementParam,name,observer,useCapture){useCapture=useCapture||false;
var element=OpenLayers.Util.getElement(elementParam);
var cacheID=element._eventCacheID;
if(name=="keypress"){if(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||element.detachEvent){name="keydown"
}}var foundEntry=false;
var elementObservers=OpenLayers.Event.observers[cacheID];
if(elementObservers){var i=0;
while(!foundEntry&&i<elementObservers.length){var cacheEntry=elementObservers[i];
if((cacheEntry.name==name)&&(cacheEntry.observer==observer)&&(cacheEntry.useCapture==useCapture)){elementObservers.splice(i,1);
if(elementObservers.length==0){delete OpenLayers.Event.observers[cacheID]
}foundEntry=true;
break
}i++
}}if(foundEntry){if(element.removeEventListener){element.removeEventListener(name,observer,useCapture)
}else{if(element&&element.detachEvent){element.detachEvent("on"+name,observer)
}}}return foundEntry
},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var cacheID in OpenLayers.Event.observers){var elementObservers=OpenLayers.Event.observers[cacheID];
OpenLayers.Event._removeElementObservers.apply(this,[elementObservers])
}OpenLayers.Event.observers=false
}},CLASS_NAME:"OpenLayers.Event"};
OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,false);
OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:false,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(object,element,eventTypes,fallThrough,options){OpenLayers.Util.extend(this,options);
this.object=object;
this.fallThrough=fallThrough;
this.listeners={};
this.extensions={};
this.extensionCount={};
if(element!=null){this.attachToElement(element)
}},destroy:function(){for(var e in this.extensions){if(typeof this.extensions[e]!=="boolean"){this.extensions[e].destroy()
}}this.extensions=null;
if(this.element){OpenLayers.Event.stopObservingElement(this.element);
if(this.element.hasScrollEvent){OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)
}}this.element=null;
this.listeners=null;
this.object=null;
this.fallThrough=null;
this.eventHandler=null
},addEventType:function(eventName){},attachToElement:function(element){if(this.element){OpenLayers.Event.stopObservingElement(this.element)
}else{this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);
this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)
}this.element=element;
for(var i=0,len=this.BROWSER_EVENTS.length;
i<len;
i++){OpenLayers.Event.observe(element,this.BROWSER_EVENTS[i],this.eventHandler)
}OpenLayers.Event.observe(element,"dragstart",OpenLayers.Event.stop)
},on:function(object){for(var type in object){if(type!="scope"&&object.hasOwnProperty(type)){this.register(type,object.scope,object[type])
}}},register:function(type,obj,func,priority){if(type in OpenLayers.Events&&!this.extensions[type]){this.extensions[type]=new OpenLayers.Events[type](this)
}if(func!=null){if(obj==null){obj=this.object
}var listeners=this.listeners[type];
if(!listeners){listeners=[];
this.listeners[type]=listeners;
this.extensionCount[type]=0
}var listener={obj:obj,func:func};
if(priority){listeners.splice(this.extensionCount[type],0,listener);
if(typeof priority==="object"&&priority.extension){this.extensionCount[type]++
}}else{listeners.push(listener)
}}},registerPriority:function(type,obj,func){this.register(type,obj,func,true)
},un:function(object){for(var type in object){if(type!="scope"&&object.hasOwnProperty(type)){this.unregister(type,object.scope,object[type])
}}},unregister:function(type,obj,func){if(obj==null){obj=this.object
}var listeners=this.listeners[type];
if(listeners!=null){for(var i=0,len=listeners.length;
i<len;
i++){if(listeners[i].obj==obj&&listeners[i].func==func){listeners.splice(i,1);
break
}}}},remove:function(type){if(this.listeners[type]!=null){this.listeners[type]=[]
}},triggerEvent:function(type,evt){var listeners=this.listeners[type];
if(!listeners||listeners.length==0){return undefined
}if(evt==null){evt={}
}evt.object=this.object;
evt.element=this.element;
if(!evt.type){evt.type=type
}listeners=listeners.slice();
var continueChain;
for(var i=0,len=listeners.length;
i<len;
i++){var callback=listeners[i];
continueChain=callback.func.apply(callback.obj,[evt]);
if((continueChain!=undefined)&&(continueChain==false)){break
}}if(!this.fallThrough){OpenLayers.Event.stop(evt,true)
}return continueChain
},handleBrowserEvent:function(evt){var type=evt.type,listeners=this.listeners[type];
if(!listeners||listeners.length==0){return
}var touches=evt.touches;
if(touches&&touches[0]){var x=0;
var y=0;
var num=touches.length;
var touch;
for(var i=0;
i<num;
++i){touch=touches[i];
x+=touch.clientX;
y+=touch.clientY
}evt.clientX=x/num;
evt.clientY=y/num
}if(this.includeXY){evt.xy=this.getMousePosition(evt)
}this.triggerEvent(type,evt)
},clearMouseCache:function(){this.element.scrolls=null;
this.element.lefttop=null;
var body=document.body;
if(body&&!((body.scrollTop!=0||body.scrollLeft!=0)&&navigator.userAgent.match(/iPhone/i))){this.element.offsets=null
}},getMousePosition:function(evt){if(!this.includeXY){this.clearMouseCache()
}else{if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);
this.element.hasScrollEvent=true
}}if(!this.element.scrolls){var viewportElement=OpenLayers.Util.getViewportElement();
this.element.scrolls=[viewportElement.scrollLeft,viewportElement.scrollTop]
}if(!this.element.lefttop){this.element.lefttop=[(document.documentElement.clientLeft||0),(document.documentElement.clientTop||0)]
}if(!this.element.offsets){this.element.offsets=OpenLayers.Util.pagePosition(this.element)
}return new OpenLayers.Pixel((evt.clientX+this.element.scrolls[0])-this.element.offsets[0]-this.element.lefttop[0],(evt.clientY+this.element.scrolls[1])-this.element.offsets[1]-this.element.lefttop[1])
},CLASS_NAME:"OpenLayers.Events"});
OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(target){this.target=target;
for(var i=this.events.length-1;
i>=0;
--i){this.target.register(this.events[i],this,this.buttonClick,{extension:true})
}},destroy:function(){for(var i=this.events.length-1;
i>=0;
--i){this.target.unregister(this.events[i],this,this.buttonClick)
}delete this.target
},getPressedButton:function(element){var depth=3,button;
do{if(OpenLayers.Element.hasClass(element,"olButton")){button=element;
break
}element=element.parentNode
}while(--depth>0&&element);
return button
},buttonClick:function(evt){var propagate=true,element=OpenLayers.Event.element(evt);
if(element&&(OpenLayers.Event.isLeftClick(evt)||!~evt.type.indexOf("mouse"))){var button=this.getPressedButton(element);
if(button){if(evt.type==="keydown"){switch(evt.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:button});
OpenLayers.Event.stop(evt);
propagate=false;
break
}}else{if(this.startEvt){if(this.completeRegEx.test(evt.type)){var pos=OpenLayers.Util.pagePosition(button);
this.target.triggerEvent("buttonclick",{buttonElement:button,buttonXY:{x:this.startEvt.clientX-pos[0],y:this.startEvt.clientY-pos[1]}})
}if(this.cancelRegEx.test(evt.type)){delete this.startEvt
}OpenLayers.Event.stop(evt);
propagate=false
}}if(this.startRegEx.test(evt.type)){this.startEvt=evt;
OpenLayers.Event.stop(evt);
propagate=false
}}else{delete this.startEvt
}}return propagate
}});
OpenLayers.ProxyHost="";
OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:true,user:undefined,password:undefined,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(url,proxy){var sameOrigin=url.indexOf("http")!==0;
var urlParts=!sameOrigin&&url.match(this.URL_SPLIT_REGEX);
if(urlParts){var location=window.location;
sameOrigin=urlParts[1]==location.protocol&&urlParts[3]==location.hostname;
var uPort=urlParts[4],lPort=location.port;
if(uPort!=80&&uPort!=""||lPort!="80"&&lPort!=""){sameOrigin=sameOrigin&&uPort==lPort
}}if(!sameOrigin){if(proxy){if(typeof proxy=="function"){url=proxy(url)
}else{url=proxy+encodeURIComponent(url)
}}else{OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:url})
}}return url
},issue:function(config){var defaultConfig=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});
config=OpenLayers.Util.applyDefaults(config,defaultConfig);
var customRequestedWithHeader=false,headerKey;
for(headerKey in config.headers){if(config.headers.hasOwnProperty(headerKey)){if(headerKey.toLowerCase()==="x-requested-with"){customRequestedWithHeader=true
}}}if(customRequestedWithHeader===false){config.headers["X-Requested-With"]="XMLHttpRequest"
}var request=new OpenLayers.Request.XMLHttpRequest();
var url=OpenLayers.Util.urlAppend(config.url,OpenLayers.Util.getParameterString(config.params||{}));
url=OpenLayers.Request.makeSameOrigin(url,config.proxy);
request.open(config.method,url,config.async,config.user,config.password);
for(var header in config.headers){request.setRequestHeader(header,config.headers[header])
}var events=this.events;
var self=this;
request.onreadystatechange=function(){if(request.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var proceed=events.triggerEvent("complete",{request:request,config:config,requestUrl:url});
if(proceed!==false){self.runCallbacks({request:request,config:config,requestUrl:url})
}}};
if(config.async===false){request.send(config.data)
}else{window.setTimeout(function(){if(request.readyState!==0){request.send(config.data)
}},0)
}return request
},runCallbacks:function(options){var request=options.request;
var config=options.config;
var complete=(config.scope)?OpenLayers.Function.bind(config.callback,config.scope):config.callback;
var success;
if(config.success){success=(config.scope)?OpenLayers.Function.bind(config.success,config.scope):config.success
}var failure;
if(config.failure){failure=(config.scope)?OpenLayers.Function.bind(config.failure,config.scope):config.failure
}if(OpenLayers.Util.createUrlObject(config.url).protocol=="file:"&&request.responseText){request.status=200
}complete(request);
if(!request.status||(request.status>=200&&request.status<300)){this.events.triggerEvent("success",options);
if(success){success(request)
}}if(request.status&&(request.status<200||request.status>=300)){this.events.triggerEvent("failure",options);
if(failure){failure(request)
}}},GET:function(config){config=OpenLayers.Util.extend(config,{method:"GET"});
return OpenLayers.Request.issue(config)
},POST:function(config){config=OpenLayers.Util.extend(config,{method:"POST"});
config.headers=config.headers?config.headers:{};
if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(config.headers))){config.headers["Content-Type"]="application/xml"
}return OpenLayers.Request.issue(config)
},PUT:function(config){config=OpenLayers.Util.extend(config,{method:"PUT"});
config.headers=config.headers?config.headers:{};
if(!("CONTENT-TYPE" in OpenLayers.Util.upperCaseObject(config.headers))){config.headers["Content-Type"]="application/xml"
}return OpenLayers.Request.issue(config)
},DELETE:function(config){config=OpenLayers.Util.extend(config,{method:"DELETE"});
return OpenLayers.Request.issue(config)
},HEAD:function(config){config=OpenLayers.Util.extend(config,{method:"HEAD"});
return OpenLayers.Request.issue(config)
},OPTIONS:function(config){config=OpenLayers.Util.extend(config,{method:"OPTIONS"});
return OpenLayers.Request.issue(config)
}};
(function(){var oXMLHttpRequest=window.XMLHttpRequest;
var bGecko=!!window.controllers,bIE=window.document.all&&!window.opera,bIE7=bIE&&window.navigator.userAgent.match(/MSIE 7.0/);
function fXMLHttpRequest(){this._object=oXMLHttpRequest&&!bIE7?new oXMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");
this._listeners=[]
}function cXMLHttpRequest(){return new fXMLHttpRequest
}cXMLHttpRequest.prototype=fXMLHttpRequest.prototype;
if(bGecko&&oXMLHttpRequest.wrapped){cXMLHttpRequest.wrapped=oXMLHttpRequest.wrapped
}cXMLHttpRequest.UNSENT=0;
cXMLHttpRequest.OPENED=1;
cXMLHttpRequest.HEADERS_RECEIVED=2;
cXMLHttpRequest.LOADING=3;
cXMLHttpRequest.DONE=4;
cXMLHttpRequest.prototype.readyState=cXMLHttpRequest.UNSENT;
cXMLHttpRequest.prototype.responseText="";
cXMLHttpRequest.prototype.responseXML=null;
cXMLHttpRequest.prototype.status=0;
cXMLHttpRequest.prototype.statusText="";
cXMLHttpRequest.prototype.priority="NORMAL";
cXMLHttpRequest.prototype.onreadystatechange=null;
cXMLHttpRequest.onreadystatechange=null;
cXMLHttpRequest.onopen=null;
cXMLHttpRequest.onsend=null;
cXMLHttpRequest.onabort=null;
cXMLHttpRequest.prototype.open=function(sMethod,sUrl,bAsync,sUser,sPassword){delete this._headers;
if(arguments.length<3){bAsync=true
}this._async=bAsync;
var oRequest=this,nState=this.readyState,fOnUnload;
if(bIE&&bAsync){fOnUnload=function(){if(nState!=cXMLHttpRequest.DONE){fCleanTransport(oRequest);
oRequest.abort()
}};
window.attachEvent("onunload",fOnUnload)
}if(cXMLHttpRequest.onopen){cXMLHttpRequest.onopen.apply(this,arguments)
}if(arguments.length>4){this._object.open(sMethod,sUrl,bAsync,sUser,sPassword)
}else{if(arguments.length>3){this._object.open(sMethod,sUrl,bAsync,sUser)
}else{this._object.open(sMethod,sUrl,bAsync)
}}this.readyState=cXMLHttpRequest.OPENED;
fReadyStateChange(this);
this._object.onreadystatechange=function(){if(bGecko&&!bAsync){return
}oRequest.readyState=oRequest._object.readyState;
fSynchronizeValues(oRequest);
if(oRequest._aborted){oRequest.readyState=cXMLHttpRequest.UNSENT;
return
}if(oRequest.readyState==cXMLHttpRequest.DONE){delete oRequest._data;
fCleanTransport(oRequest);
if(bIE&&bAsync){window.detachEvent("onunload",fOnUnload)
}}if(nState!=oRequest.readyState){fReadyStateChange(oRequest)
}nState=oRequest.readyState
}
};
function fXMLHttpRequest_send(oRequest){oRequest._object.send(oRequest._data);
if(bGecko&&!oRequest._async){oRequest.readyState=cXMLHttpRequest.OPENED;
fSynchronizeValues(oRequest);
while(oRequest.readyState<cXMLHttpRequest.DONE){oRequest.readyState++;
fReadyStateChange(oRequest);
if(oRequest._aborted){return
}}}}cXMLHttpRequest.prototype.send=function(vData){if(cXMLHttpRequest.onsend){cXMLHttpRequest.onsend.apply(this,arguments)
}if(!arguments.length){vData=null
}if(vData&&vData.nodeType){vData=window.XMLSerializer?new window.XMLSerializer().serializeToString(vData):vData.xml;
if(!this._headers["Content-Type"]){this._object.setRequestHeader("Content-Type","application/xml")
}}this._data=vData;
fXMLHttpRequest_send(this)
};
cXMLHttpRequest.prototype.abort=function(){if(cXMLHttpRequest.onabort){cXMLHttpRequest.onabort.apply(this,arguments)
}if(this.readyState>cXMLHttpRequest.UNSENT){this._aborted=true
}this._object.abort();
fCleanTransport(this);
this.readyState=cXMLHttpRequest.UNSENT;
delete this._data
};
cXMLHttpRequest.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()
};
cXMLHttpRequest.prototype.getResponseHeader=function(sName){return this._object.getResponseHeader(sName)
};
cXMLHttpRequest.prototype.setRequestHeader=function(sName,sValue){if(!this._headers){this._headers={}
}this._headers[sName]=sValue;
return this._object.setRequestHeader(sName,sValue)
};
cXMLHttpRequest.prototype.addEventListener=function(sName,fHandler,bUseCapture){for(var nIndex=0,oListener;
oListener=this._listeners[nIndex];
nIndex++){if(oListener[0]==sName&&oListener[1]==fHandler&&oListener[2]==bUseCapture){return
}}this._listeners.push([sName,fHandler,bUseCapture])
};
cXMLHttpRequest.prototype.removeEventListener=function(sName,fHandler,bUseCapture){for(var nIndex=0,oListener;
oListener=this._listeners[nIndex];
nIndex++){if(oListener[0]==sName&&oListener[1]==fHandler&&oListener[2]==bUseCapture){break
}}if(oListener){this._listeners.splice(nIndex,1)
}};
cXMLHttpRequest.prototype.dispatchEvent=function(oEvent){var oEventPseudo={type:oEvent.type,target:this,currentTarget:this,eventPhase:2,bubbles:oEvent.bubbles,cancelable:oEvent.cancelable,timeStamp:oEvent.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};
if(oEventPseudo.type=="readystatechange"&&this.onreadystatechange){(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[oEventPseudo])
}for(var nIndex=0,oListener;
oListener=this._listeners[nIndex];
nIndex++){if(oListener[0]==oEventPseudo.type&&!oListener[2]){(oListener[1].handleEvent||oListener[1]).apply(this,[oEventPseudo])
}}};
cXMLHttpRequest.prototype.toString=function(){return"[object XMLHttpRequest]"
};
cXMLHttpRequest.toString=function(){return"[XMLHttpRequest]"
};
function fReadyStateChange(oRequest){if(cXMLHttpRequest.onreadystatechange){cXMLHttpRequest.onreadystatechange.apply(oRequest)
}oRequest.dispatchEvent({type:"readystatechange",bubbles:false,cancelable:false,timeStamp:new Date+0})
}function fGetDocument(oRequest){var oDocument=oRequest.responseXML,sResponse=oRequest.responseText;
if(bIE&&sResponse&&oDocument&&!oDocument.documentElement&&oRequest.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){oDocument=new window.ActiveXObject("Microsoft.XMLDOM");
oDocument.async=false;
oDocument.validateOnParse=false;
oDocument.loadXML(sResponse)
}if(oDocument){if((bIE&&oDocument.parseError!=0)||!oDocument.documentElement||(oDocument.documentElement&&oDocument.documentElement.tagName=="parsererror")){return null
}}return oDocument
}function fSynchronizeValues(oRequest){try{oRequest.responseText=oRequest._object.responseText
}catch(e){}try{oRequest.responseXML=fGetDocument(oRequest._object)
}catch(e){}try{oRequest.status=oRequest._object.status
}catch(e){}try{oRequest.statusText=oRequest._object.statusText
}catch(e){}}function fCleanTransport(oRequest){oRequest._object.onreadystatechange=new window.Function
}if(!window.Function.prototype.apply){window.Function.prototype.apply=function(oRequest,oArguments){if(!oArguments){oArguments=[]
}oRequest.__func=this;
oRequest.__func(oArguments[0],oArguments[1],oArguments[2],oArguments[3],oArguments[4]);
delete oRequest.__func
}
}OpenLayers.Request.XMLHttpRequest=cXMLHttpRequest
})();
OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(projCode,options){OpenLayers.Util.extend(this,options);
this.projCode=projCode;
if(window.Proj4js){this.proj=new Proj4js.Proj(projCode)
}},getCode:function(){return this.proj?this.proj.srsCode:this.projCode
},getUnits:function(){return this.proj?this.proj.units:null
},toString:function(){return this.getCode()
},equals:function(projection){var p=projection,equals=false;
if(p){if(!(p instanceof OpenLayers.Projection)){p=new OpenLayers.Projection(p)
}if(window.Proj4js&&this.proj.defData&&p.proj.defData){equals=this.proj.defData.replace(this.titleRegEx,"")==p.proj.defData.replace(this.titleRegEx,"")
}else{if(p.getCode){var source=this.getCode(),target=p.getCode();
equals=source==target||!!OpenLayers.Projection.transforms[source]&&OpenLayers.Projection.transforms[source][target]===OpenLayers.Projection.nullTransform
}}}return equals
},destroy:function(){delete this.proj;
delete this.projCode
},CLASS_NAME:"OpenLayers.Projection"});
OpenLayers.Projection.transforms={};
OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:true},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};
OpenLayers.Projection.addTransform=function(from,to,method){if(method===OpenLayers.Projection.nullTransform){var defaults=OpenLayers.Projection.defaults[from];
if(defaults&&!OpenLayers.Projection.defaults[to]){OpenLayers.Projection.defaults[to]=defaults
}}if(!OpenLayers.Projection.transforms[from]){OpenLayers.Projection.transforms[from]={}
}OpenLayers.Projection.transforms[from][to]=method
};
OpenLayers.Projection.transform=function(point,source,dest){if(source&&dest){if(!(source instanceof OpenLayers.Projection)){source=new OpenLayers.Projection(source)
}if(!(dest instanceof OpenLayers.Projection)){dest=new OpenLayers.Projection(dest)
}if(source.proj&&dest.proj){point=Proj4js.transform(source.proj,dest.proj,point)
}else{var sourceCode=source.getCode();
var destCode=dest.getCode();
var transforms=OpenLayers.Projection.transforms;
if(transforms[sourceCode]&&transforms[sourceCode][destCode]){transforms[sourceCode][destCode](point)
}}}return point
};
OpenLayers.Projection.nullTransform=function(point){return point
};
(function(){var pole=20037508.34;
function inverseMercator(xy){xy.x=180*xy.x/pole;
xy.y=180/Math.PI*(2*Math.atan(Math.exp((xy.y/pole)*Math.PI))-Math.PI/2);
return xy
}function forwardMercator(xy){xy.x=xy.x*pole/180;
xy.y=Math.log(Math.tan((90+xy.y)*Math.PI/360))/Math.PI*pole;
return xy
}function map(base,codes){var add=OpenLayers.Projection.addTransform;
var same=OpenLayers.Projection.nullTransform;
var i,len,code,other,j;
for(i=0,len=codes.length;
i<len;
++i){code=codes[i];
add(base,code,forwardMercator);
add(code,base,inverseMercator);
for(j=i+1;
j<len;
++j){other=codes[j];
add(code,other,same);
add(other,code,same)
}}}var mercator=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],geographic=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"],i;
for(i=mercator.length-1;
i>=0;
--i){map(mercator[i],geographic)
}for(i=geographic.length-1;
i>=0;
--i){map(geographic[i],mercator)
}})();
OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1000},id:null,fractionalZoom:false,events:null,allOverlays:false,div:null,dragging:false,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:true,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(div,options){if(arguments.length===1&&typeof div==="object"){options=div;
div=options&&options.div
}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);
this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);
this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";
this.options=OpenLayers.Util.extend({},options);
OpenLayers.Util.extend(this,options);
var projCode=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;
OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[projCode]);
if(this.maxExtent&&!(this.maxExtent instanceof OpenLayers.Bounds)){this.maxExtent=new OpenLayers.Bounds(this.maxExtent)
}if(this.minExtent&&!(this.minExtent instanceof OpenLayers.Bounds)){this.minExtent=new OpenLayers.Bounds(this.minExtent)
}if(this.restrictedExtent&&!(this.restrictedExtent instanceof OpenLayers.Bounds)){this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)
}if(this.center&&!(this.center instanceof OpenLayers.LonLat)){this.center=new OpenLayers.LonLat(this.center)
}this.layers=[];
this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");
this.div=OpenLayers.Util.getElement(div);
if(!this.div){this.div=document.createElement("div");
this.div.style.height="1px";
this.div.style.width="1px"
}OpenLayers.Element.addClass(this.div,"olMap");
var id=this.id+"_OpenLayers_ViewPort";
this.viewPortDiv=OpenLayers.Util.createDiv(id,null,null,null,"relative",null,"hidden");
this.viewPortDiv.style.width="100%";
this.viewPortDiv.style.height="100%";
this.viewPortDiv.className="olMapViewport";
this.div.appendChild(this.viewPortDiv);
this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:true});
id=this.id+"_OpenLayers_Container";
this.layerContainerDiv=OpenLayers.Util.createDiv(id);
this.layerContainerDiv.style.width="100px";
this.layerContainerDiv.style.height="100px";
this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;
this.viewPortDiv.appendChild(this.layerContainerDiv);
this.updateSize();
if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)
}if(parseFloat(navigator.appVersion.split("MSIE")[1])<9){this.events.register("resize",this,this.updateSize)
}else{this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);
OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)
}if(this.theme){var addNode=true;
var nodes=document.getElementsByTagName("link");
for(var i=0,len=nodes.length;
i<len;
++i){if(OpenLayers.Util.isEquivalentUrl(nodes.item(i).href,this.theme)){addNode=false;
break
}}if(addNode){var cssNode=document.createElement("link");
cssNode.setAttribute("rel","stylesheet");
cssNode.setAttribute("type","text/css");
cssNode.setAttribute("href",this.theme);
document.getElementsByTagName("head")[0].appendChild(cssNode)
}}if(this.controls==null){this.controls=[];
if(OpenLayers.Control!=null){if(OpenLayers.Control.Navigation){this.controls.push(new OpenLayers.Control.Navigation())
}else{if(OpenLayers.Control.TouchNavigation){this.controls.push(new OpenLayers.Control.TouchNavigation())
}}if(OpenLayers.Control.Zoom){this.controls.push(new OpenLayers.Control.Zoom())
}else{if(OpenLayers.Control.PanZoom){this.controls.push(new OpenLayers.Control.PanZoom())
}}if(OpenLayers.Control.ArgParser){this.controls.push(new OpenLayers.Control.ArgParser())
}if(OpenLayers.Control.Attribution){this.controls.push(new OpenLayers.Control.Attribution())
}}}for(var i=0,len=this.controls.length;
i<len;
i++){this.addControlToMap(this.controls[i])
}this.popups=[];
this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);
OpenLayers.Event.observe(window,"unload",this.unloadDestroy);
if(options&&options.layers){delete this.center;
this.addLayers(options.layers);
if(options.center&&!this.getCenter()){this.setCenter(options.center,options.zoom)
}}},getViewport:function(){return this.viewPortDiv
},render:function(div){this.div=OpenLayers.Util.getElement(div);
OpenLayers.Element.addClass(this.div,"olMap");
this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);
this.div.appendChild(this.viewPortDiv);
this.updateSize()
},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy){return false
}if(this.panTween){this.panTween.stop();
this.panTween=null
}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);
this.unloadDestroy=null;
if(this.updateSizeDestroy){OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy)
}else{this.events.unregister("resize",this,this.updateSize)
}this.paddingForPopups=null;
if(this.controls!=null){for(var i=this.controls.length-1;
i>=0;
--i){this.controls[i].destroy()
}this.controls=null
}if(this.layers!=null){for(var i=this.layers.length-1;
i>=0;
--i){this.layers[i].destroy(false)
}this.layers=null
}if(this.viewPortDiv){this.div.removeChild(this.viewPortDiv)
}this.viewPortDiv=null;
if(this.eventListeners){this.events.un(this.eventListeners);
this.eventListeners=null
}this.events.destroy();
this.events=null;
this.options=null
},setOptions:function(options){var updatePxExtent=this.minPx&&options.restrictedExtent!=this.restrictedExtent;
OpenLayers.Util.extend(this,options);
updatePxExtent&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:true})
},getTileSize:function(){return this.tileSize
},getBy:function(array,property,match){var test=(typeof match.test=="function");
var found=OpenLayers.Array.filter(this[array],function(item){return item[property]==match||(test&&match.test(item[property]))
});
return found
},getLayersBy:function(property,match){return this.getBy("layers",property,match)
},getLayersByName:function(match){return this.getLayersBy("name",match)
},getLayersByClass:function(match){return this.getLayersBy("CLASS_NAME",match)
},getControlsBy:function(property,match){return this.getBy("controls",property,match)
},getControlsByClass:function(match){return this.getControlsBy("CLASS_NAME",match)
},getLayer:function(id){var foundLayer=null;
for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.layers[i];
if(layer.id==id){foundLayer=layer;
break
}}return foundLayer
},setLayerZIndex:function(layer,zIdx){layer.setZIndex(this.Z_INDEX_BASE[layer.isBaseLayer?"BaseLayer":"Overlay"]+zIdx*5)
},resetLayersZIndex:function(){for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.layers[i];
this.setLayerZIndex(layer,i)
}},addLayer:function(layer){for(var i=0,len=this.layers.length;
i<len;
i++){if(this.layers[i]==layer){return false
}}if(this.events.triggerEvent("preaddlayer",{layer:layer})===false){return false
}if(this.allOverlays){layer.isBaseLayer=false
}layer.div.className="olLayerDiv";
layer.div.style.overflow="";
this.setLayerZIndex(layer,this.layers.length);
if(layer.isFixed){this.viewPortDiv.appendChild(layer.div)
}else{this.layerContainerDiv.appendChild(layer.div)
}this.layers.push(layer);
layer.setMap(this);
if(layer.isBaseLayer||(this.allOverlays&&!this.baseLayer)){if(this.baseLayer==null){this.setBaseLayer(layer)
}else{layer.setVisibility(false)
}}else{layer.redraw()
}this.events.triggerEvent("addlayer",{layer:layer});
layer.events.triggerEvent("added",{map:this,layer:layer});
layer.afterAdd();
return true
},addLayers:function(layers){for(var i=0,len=layers.length;
i<len;
i++){this.addLayer(layers[i])
}},removeLayer:function(layer,setNewBaseLayer){if(this.events.triggerEvent("preremovelayer",{layer:layer})===false){return
}if(setNewBaseLayer==null){setNewBaseLayer=true
}if(layer.isFixed){this.viewPortDiv.removeChild(layer.div)
}else{this.layerContainerDiv.removeChild(layer.div)
}OpenLayers.Util.removeItem(this.layers,layer);
layer.removeMap(this);
layer.map=null;
if(this.baseLayer==layer){this.baseLayer=null;
if(setNewBaseLayer){for(var i=0,len=this.layers.length;
i<len;
i++){var iLayer=this.layers[i];
if(iLayer.isBaseLayer||this.allOverlays){this.setBaseLayer(iLayer);
break
}}}}this.resetLayersZIndex();
this.events.triggerEvent("removelayer",{layer:layer});
layer.events.triggerEvent("removed",{map:this,layer:layer})
},getNumLayers:function(){return this.layers.length
},getLayerIndex:function(layer){return OpenLayers.Util.indexOf(this.layers,layer)
},setLayerIndex:function(layer,idx){var base=this.getLayerIndex(layer);
if(idx<0){idx=0
}else{if(idx>this.layers.length){idx=this.layers.length
}}if(base!=idx){this.layers.splice(base,1);
this.layers.splice(idx,0,layer);
for(var i=0,len=this.layers.length;
i<len;
i++){this.setLayerZIndex(this.layers[i],i)
}this.events.triggerEvent("changelayer",{layer:layer,property:"order"});
if(this.allOverlays){if(idx===0){this.setBaseLayer(layer)
}else{if(this.baseLayer!==this.layers[0]){this.setBaseLayer(this.layers[0])
}}}}},raiseLayer:function(layer,delta){var idx=this.getLayerIndex(layer)+delta;
this.setLayerIndex(layer,idx)
},setBaseLayer:function(newBaseLayer){if(newBaseLayer!=this.baseLayer){if(OpenLayers.Util.indexOf(this.layers,newBaseLayer)!=-1){var center=this.getCachedCenter();
var newResolution=OpenLayers.Util.getResolutionFromScale(this.getScale(),newBaseLayer.units);
if(this.baseLayer!=null&&!this.allOverlays){this.baseLayer.setVisibility(false)
}this.baseLayer=newBaseLayer;
if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(true);
if(this.baseLayer.inRange===false){this.baseLayer.redraw()
}}if(center!=null){var newZoom=this.getZoomForResolution(newResolution||this.resolution,true);
this.setCenter(center,newZoom,false,true)
}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})
}}},addControl:function(control,px){this.controls.push(control);
this.addControlToMap(control,px)
},addControls:function(controls,pixels){var pxs=(arguments.length===1)?[]:pixels;
for(var i=0,len=controls.length;
i<len;
i++){var ctrl=controls[i];
var px=(pxs[i])?pxs[i]:null;
this.addControl(ctrl,px)
}},addControlToMap:function(control,px){control.outsideViewport=(control.div!=null);
if(this.displayProjection&&!control.displayProjection){control.displayProjection=this.displayProjection
}control.setMap(this);
var div=control.draw(px);
if(div){if(!control.outsideViewport){div.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;
this.viewPortDiv.appendChild(div)
}}if(control.autoActivate){control.activate()
}},getControl:function(id){var returnControl=null;
for(var i=0,len=this.controls.length;
i<len;
i++){var control=this.controls[i];
if(control.id==id){returnControl=control;
break
}}return returnControl
},removeControl:function(control){if((control)&&(control==this.getControl(control.id))){if(control.div&&(control.div.parentNode==this.viewPortDiv)){this.viewPortDiv.removeChild(control.div)
}OpenLayers.Util.removeItem(this.controls,control)
}},addPopup:function(popup,exclusive){if(exclusive){for(var i=this.popups.length-1;
i>=0;
--i){this.removePopup(this.popups[i])
}}popup.map=this;
this.popups.push(popup);
var popupDiv=popup.draw();
if(popupDiv){popupDiv.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;
this.layerContainerDiv.appendChild(popupDiv)
}},removePopup:function(popup){OpenLayers.Util.removeItem(this.popups,popup);
if(popup.div){try{this.layerContainerDiv.removeChild(popup.div)
}catch(e){}}popup.map=null
},getSize:function(){var size=null;
if(this.size!=null){size=this.size.clone()
}return size
},updateSize:function(){var newSize=this.getCurrentSize();
if(newSize&&!isNaN(newSize.h)&&!isNaN(newSize.w)){this.events.clearMouseCache();
var oldSize=this.getSize();
if(oldSize==null){this.size=oldSize=newSize
}if(!newSize.equals(oldSize)){this.size=newSize;
for(var i=0,len=this.layers.length;
i<len;
i++){this.layers[i].onMapResize()
}var center=this.getCachedCenter();
if(this.baseLayer!=null&&center!=null){var zoom=this.getZoom();
this.zoom=null;
this.setCenter(center,zoom)
}}}},getCurrentSize:function(){var size=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);
if(size.w==0&&size.h==0||isNaN(size.w)&&isNaN(size.h)){size.w=this.div.offsetWidth;
size.h=this.div.offsetHeight
}if(size.w==0&&size.h==0||isNaN(size.w)&&isNaN(size.h)){size.w=parseInt(this.div.style.width);
size.h=parseInt(this.div.style.height)
}return size
},calculateBounds:function(center,resolution){var extent=null;
if(center==null){center=this.getCachedCenter()
}if(resolution==null){resolution=this.getResolution()
}if((center!=null)&&(resolution!=null)){var halfWDeg=(this.size.w*resolution)/2;
var halfHDeg=(this.size.h*resolution)/2;
extent=new OpenLayers.Bounds(center.lon-halfWDeg,center.lat-halfHDeg,center.lon+halfWDeg,center.lat+halfHDeg)
}return extent
},getCenter:function(){var center=null;
var cachedCenter=this.getCachedCenter();
if(cachedCenter){center=cachedCenter.clone()
}return center
},getCachedCenter:function(){if(!this.center&&this.size){this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})
}return this.center
},getZoom:function(){return this.zoom
},pan:function(dx,dy,options){options=OpenLayers.Util.applyDefaults(options,{animate:true,dragging:false});
if(options.dragging){if(dx!=0||dy!=0){this.moveByPx(dx,dy)
}}else{var centerPx=this.getViewPortPxFromLonLat(this.getCachedCenter());
var newCenterPx=centerPx.add(dx,dy);
if(this.dragging||!newCenterPx.equals(centerPx)){var newCenterLonLat=this.getLonLatFromViewPortPx(newCenterPx);
if(options.animate){this.panTo(newCenterLonLat)
}else{this.moveTo(newCenterLonLat);
if(this.dragging){this.dragging=false;
this.events.triggerEvent("moveend")
}}}}},panTo:function(lonlat){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(lonlat)){if(!this.panTween){this.panTween=new OpenLayers.Tween(this.panMethod)
}var center=this.getCachedCenter();
if(lonlat.equals(center)){return
}var from=this.getPixelFromLonLat(center);
var to=this.getPixelFromLonLat(lonlat);
var vector={x:to.x-from.x,y:to.y-from.y};
var last={x:0,y:0};
this.panTween.start({x:0,y:0},vector,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(px){var x=px.x-last.x,y=px.y-last.y;
this.moveByPx(x,y);
last.x=Math.round(px.x);
last.y=Math.round(px.y)
},this),done:OpenLayers.Function.bind(function(px){this.moveTo(lonlat);
this.dragging=false;
this.events.triggerEvent("moveend")
},this)}})
}else{this.setCenter(lonlat)
}},setCenter:function(lonlat,zoom,dragging,forceZoomChange){this.panTween&&this.panTween.stop();
this.moveTo(lonlat,zoom,{dragging:dragging,forceZoomChange:forceZoomChange})
},moveByPx:function(dx,dy){var hw=this.size.w/2;
var hh=this.size.h/2;
var x=hw+dx;
var y=hh+dy;
var wrapDateLine=this.baseLayer.wrapDateLine;
var xRestriction=0;
var yRestriction=0;
if(this.restrictedExtent){xRestriction=hw;
yRestriction=hh;
wrapDateLine=false
}dx=wrapDateLine||x<=this.maxPx.x-xRestriction&&x>=this.minPx.x+xRestriction?Math.round(dx):0;
dy=y<=this.maxPx.y-yRestriction&&y>=this.minPx.y+yRestriction?Math.round(dy):0;
if(dx||dy){if(!this.dragging){this.dragging=true;
this.events.triggerEvent("movestart")
}this.center=null;
if(dx){this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-dx+"px";
this.minPx.x-=dx;
this.maxPx.x-=dx
}if(dy){this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-dy+"px";
this.minPx.y-=dy;
this.maxPx.y-=dy
}var layer,i,len;
for(i=0,len=this.layers.length;
i<len;
++i){layer=this.layers[i];
if(layer.visibility&&(layer===this.baseLayer||layer.inRange)){layer.moveByPx(dx,dy);
layer.events.triggerEvent("move")
}}this.events.triggerEvent("move")
}},adjustZoom:function(zoom){var resolution,resolutions=this.baseLayer.resolutions,maxResolution=this.getMaxExtent().getWidth()/this.size.w;
if(this.getResolutionForZoom(zoom)>maxResolution){for(var i=zoom|0,ii=resolutions.length;
i<ii;
++i){if(resolutions[i]<=maxResolution){zoom=i;
break
}}}return zoom
},moveTo:function(lonlat,zoom,options){if(lonlat!=null&&!(lonlat instanceof OpenLayers.LonLat)){lonlat=new OpenLayers.LonLat(lonlat)
}if(!options){options={}
}if(zoom!=null){zoom=parseFloat(zoom);
if(!this.fractionalZoom){zoom=Math.round(zoom)
}}if(this.baseLayer.wrapDateLine){var requestedZoom=zoom;
zoom=this.adjustZoom(zoom);
if(zoom!==requestedZoom){lonlat=this.getCenter()
}}var dragging=options.dragging||this.dragging;
var forceZoomChange=options.forceZoomChange;
if(!this.getCachedCenter()&&!this.isValidLonLat(lonlat)){lonlat=this.maxExtent.getCenterLonLat();
this.center=lonlat.clone()
}if(this.restrictedExtent!=null){if(lonlat==null){lonlat=this.center
}if(zoom==null){zoom=this.getZoom()
}var resolution=this.getResolutionForZoom(zoom);
var extent=this.calculateBounds(lonlat,resolution);
if(!this.restrictedExtent.containsBounds(extent)){var maxCenter=this.restrictedExtent.getCenterLonLat();
if(extent.getWidth()>this.restrictedExtent.getWidth()){lonlat=new OpenLayers.LonLat(maxCenter.lon,lonlat.lat)
}else{if(extent.left<this.restrictedExtent.left){lonlat=lonlat.add(this.restrictedExtent.left-extent.left,0)
}else{if(extent.right>this.restrictedExtent.right){lonlat=lonlat.add(this.restrictedExtent.right-extent.right,0)
}}}if(extent.getHeight()>this.restrictedExtent.getHeight()){lonlat=new OpenLayers.LonLat(lonlat.lon,maxCenter.lat)
}else{if(extent.bottom<this.restrictedExtent.bottom){lonlat=lonlat.add(0,this.restrictedExtent.bottom-extent.bottom)
}else{if(extent.top>this.restrictedExtent.top){lonlat=lonlat.add(0,this.restrictedExtent.top-extent.top)
}}}}}var zoomChanged=forceZoomChange||((this.isValidZoomLevel(zoom))&&(zoom!=this.getZoom()));
var centerChanged=(this.isValidLonLat(lonlat))&&(!lonlat.equals(this.center));
if(zoomChanged||centerChanged||dragging){dragging||this.events.triggerEvent("movestart");
if(centerChanged){if(!zoomChanged&&this.center){this.centerLayerContainer(lonlat)
}this.center=lonlat.clone()
}var res=zoomChanged?this.getResolutionForZoom(zoom):this.getResolution();
if(zoomChanged||this.layerContainerOrigin==null){this.layerContainerOrigin=this.getCachedCenter();
this.layerContainerDiv.style.left="0px";
this.layerContainerDiv.style.top="0px";
var maxExtent=this.getMaxExtent({restricted:true});
var maxExtentCenter=maxExtent.getCenterLonLat();
var lonDelta=this.center.lon-maxExtentCenter.lon;
var latDelta=maxExtentCenter.lat-this.center.lat;
var extentWidth=Math.round(maxExtent.getWidth()/res);
var extentHeight=Math.round(maxExtent.getHeight()/res);
this.minPx={x:(this.size.w-extentWidth)/2-lonDelta/res,y:(this.size.h-extentHeight)/2-latDelta/res};
this.maxPx={x:this.minPx.x+Math.round(maxExtent.getWidth()/res),y:this.minPx.y+Math.round(maxExtent.getHeight()/res)}
}if(zoomChanged){this.zoom=zoom;
this.resolution=res
}var bounds=this.getExtent();
if(this.baseLayer.visibility){this.baseLayer.moveTo(bounds,zoomChanged,options.dragging);
options.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:zoomChanged})
}bounds=this.baseLayer.getExtent();
for(var i=this.layers.length-1;
i>=0;
--i){var layer=this.layers[i];
if(layer!==this.baseLayer&&!layer.isBaseLayer){var inRange=layer.calculateInRange();
if(layer.inRange!=inRange){layer.inRange=inRange;
if(!inRange){layer.display(false)
}this.events.triggerEvent("changelayer",{layer:layer,property:"visibility"})
}if(inRange&&layer.visibility){layer.moveTo(bounds,zoomChanged,options.dragging);
options.dragging||layer.events.triggerEvent("moveend",{zoomChanged:zoomChanged})
}}}this.events.triggerEvent("move");
dragging||this.events.triggerEvent("moveend");
if(zoomChanged){for(var i=0,len=this.popups.length;
i<len;
i++){this.popups[i].updatePosition()
}this.events.triggerEvent("zoomend")
}}},centerLayerContainer:function(lonlat){var originPx=this.getViewPortPxFromLonLat(this.layerContainerOrigin);
var newPx=this.getViewPortPxFromLonLat(lonlat);
if((originPx!=null)&&(newPx!=null)){var oldLeft=parseInt(this.layerContainerDiv.style.left);
var oldTop=parseInt(this.layerContainerDiv.style.top);
var newLeft=Math.round(originPx.x-newPx.x);
var newTop=Math.round(originPx.y-newPx.y);
this.layerContainerDiv.style.left=newLeft+"px";
this.layerContainerDiv.style.top=newTop+"px";
var dx=oldLeft-newLeft;
var dy=oldTop-newTop;
this.minPx.x-=dx;
this.maxPx.x-=dx;
this.minPx.y-=dy;
this.maxPx.y-=dy
}},isValidZoomLevel:function(zoomLevel){return((zoomLevel!=null)&&(zoomLevel>=0)&&(zoomLevel<this.getNumZoomLevels()))
},isValidLonLat:function(lonlat){var valid=false;
if(lonlat!=null){var maxExtent=this.getMaxExtent();
var worldBounds=this.baseLayer.wrapDateLine&&maxExtent;
valid=maxExtent.containsLonLat(lonlat,{worldBounds:worldBounds})
}return valid
},getProjection:function(){var projection=this.getProjectionObject();
return projection?projection.getCode():null
},getProjectionObject:function(){var projection=null;
if(this.baseLayer!=null){projection=this.baseLayer.projection
}return projection
},getMaxResolution:function(){var maxResolution=null;
if(this.baseLayer!=null){maxResolution=this.baseLayer.maxResolution
}return maxResolution
},getMaxExtent:function(options){var maxExtent=null;
if(options&&options.restricted&&this.restrictedExtent){maxExtent=this.restrictedExtent
}else{if(this.baseLayer!=null){maxExtent=this.baseLayer.maxExtent
}}return maxExtent
},getNumZoomLevels:function(){var numZoomLevels=null;
if(this.baseLayer!=null){numZoomLevels=this.baseLayer.numZoomLevels
}return numZoomLevels
},getExtent:function(){var extent=null;
if(this.baseLayer!=null){extent=this.baseLayer.getExtent()
}return extent
},getResolution:function(){var resolution=null;
if(this.baseLayer!=null){resolution=this.baseLayer.getResolution()
}else{if(this.allOverlays===true&&this.layers.length>0){resolution=this.layers[0].getResolution()
}}return resolution
},getUnits:function(){var units=null;
if(this.baseLayer!=null){units=this.baseLayer.units
}return units
},getScale:function(){var scale=null;
if(this.baseLayer!=null){var res=this.getResolution();
var units=this.baseLayer.units;
scale=OpenLayers.Util.getScaleFromResolution(res,units)
}return scale
},getZoomForExtent:function(bounds,closest){var zoom=null;
if(this.baseLayer!=null){zoom=this.baseLayer.getZoomForExtent(bounds,closest)
}return zoom
},getResolutionForZoom:function(zoom){var resolution=null;
if(this.baseLayer){resolution=this.baseLayer.getResolutionForZoom(zoom)
}return resolution
},getZoomForResolution:function(resolution,closest){var zoom=null;
if(this.baseLayer!=null){zoom=this.baseLayer.getZoomForResolution(resolution,closest)
}return zoom
},zoomTo:function(zoom){if(this.isValidZoomLevel(zoom)){this.setCenter(null,zoom)
}},zoomIn:function(){this.zoomTo(this.getZoom()+1)
},zoomOut:function(){this.zoomTo(this.getZoom()-1)
},zoomToExtent:function(bounds,closest){if(!(bounds instanceof OpenLayers.Bounds)){bounds=new OpenLayers.Bounds(bounds)
}var center=bounds.getCenterLonLat();
if(this.baseLayer.wrapDateLine){var maxExtent=this.getMaxExtent();
bounds=bounds.clone();
while(bounds.right<bounds.left){bounds.right+=maxExtent.getWidth()
}center=bounds.getCenterLonLat().wrapDateLine(maxExtent)
}this.setCenter(center,this.getZoomForExtent(bounds,closest))
},zoomToMaxExtent:function(options){var restricted=(options)?options.restricted:true;
var maxExtent=this.getMaxExtent({restricted:restricted});
this.zoomToExtent(maxExtent)
},zoomToScale:function(scale,closest){var res=OpenLayers.Util.getResolutionFromScale(scale,this.baseLayer.units);
var halfWDeg=(this.size.w*res)/2;
var halfHDeg=(this.size.h*res)/2;
var center=this.getCachedCenter();
var extent=new OpenLayers.Bounds(center.lon-halfWDeg,center.lat-halfHDeg,center.lon+halfWDeg,center.lat+halfHDeg);
this.zoomToExtent(extent,closest)
},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null;
if(this.baseLayer!=null){lonlat=this.baseLayer.getLonLatFromViewPortPx(viewPortPx)
}return lonlat
},getViewPortPxFromLonLat:function(lonlat){var px=null;
if(this.baseLayer!=null){px=this.baseLayer.getViewPortPxFromLonLat(lonlat)
}return px
},getLonLatFromPixel:function(px){return this.getLonLatFromViewPortPx(px)
},getPixelFromLonLat:function(lonlat){var px=this.getViewPortPxFromLonLat(lonlat);
px.x=Math.round(px.x);
px.y=Math.round(px.y);
return px
},getGeodesicPixelSize:function(px){var lonlat=px?this.getLonLatFromPixel(px):(this.getCachedCenter()||new OpenLayers.LonLat(0,0));
var res=this.getResolution();
var left=lonlat.add(-res/2,0);
var right=lonlat.add(res/2,0);
var bottom=lonlat.add(0,-res/2);
var top=lonlat.add(0,res/2);
var dest=new OpenLayers.Projection("EPSG:4326");
var source=this.getProjectionObject()||dest;
if(!source.equals(dest)){left.transform(source,dest);
right.transform(source,dest);
bottom.transform(source,dest);
top.transform(source,dest)
}return new OpenLayers.Size(OpenLayers.Util.distVincenty(left,right),OpenLayers.Util.distVincenty(bottom,top))
},getViewPortPxFromLayerPx:function(layerPx){var viewPortPx=null;
if(layerPx!=null){var dX=parseInt(this.layerContainerDiv.style.left);
var dY=parseInt(this.layerContainerDiv.style.top);
viewPortPx=layerPx.add(dX,dY)
}return viewPortPx
},getLayerPxFromViewPortPx:function(viewPortPx){var layerPx=null;
if(viewPortPx!=null){var dX=-parseInt(this.layerContainerDiv.style.left);
var dY=-parseInt(this.layerContainerDiv.style.top);
layerPx=viewPortPx.add(dX,dY);
if(isNaN(layerPx.x)||isNaN(layerPx.y)){layerPx=null
}}return layerPx
},getLonLatFromLayerPx:function(px){px=this.getViewPortPxFromLayerPx(px);
return this.getLonLatFromViewPortPx(px)
},getLayerPxFromLonLat:function(lonlat){var px=this.getPixelFromLonLat(lonlat);
return this.getLayerPxFromViewPortPx(px)
},CLASS_NAME:"OpenLayers.Map"});
OpenLayers.Map.TILE_WIDTH=256;
OpenLayers.Map.TILE_HEIGHT=256;
OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:false,alpha:false,displayInLayerSwitcher:true,visibility:true,attribution:null,inRange:false,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:false,wrapDateLine:false,metadata:null,initialize:function(name,options){this.metadata={};
this.addOptions(options);
this.name=name;
if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");
this.div=OpenLayers.Util.createDiv(this.id);
this.div.style.width="100%";
this.div.style.height="100%";
this.div.dir="ltr";
this.events=new OpenLayers.Events(this,this.div);
if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)
}}},destroy:function(setNewBaseLayer){if(setNewBaseLayer==null){setNewBaseLayer=true
}if(this.map!=null){this.map.removeLayer(this,setNewBaseLayer)
}this.projection=null;
this.map=null;
this.name=null;
this.div=null;
this.options=null;
if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)
}this.events.destroy()
}this.eventListeners=null;
this.events=null
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer(this.name,this.getOptions())
}OpenLayers.Util.applyDefaults(obj,this);
obj.map=null;
return obj
},getOptions:function(){var options={};
for(var o in this.options){options[o]=this[o]
}return options
},setName:function(newName){if(newName!=this.name){this.name=newName;
if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})
}}},addOptions:function(newOptions,reinitialize){if(this.options==null){this.options={}
}if(newOptions){if(typeof newOptions.projection=="string"){newOptions.projection=new OpenLayers.Projection(newOptions.projection)
}if(newOptions.projection){OpenLayers.Util.applyDefaults(newOptions,OpenLayers.Projection.defaults[newOptions.projection.getCode()])
}if(newOptions.maxExtent&&!(newOptions.maxExtent instanceof OpenLayers.Bounds)){newOptions.maxExtent=new OpenLayers.Bounds(newOptions.maxExtent)
}if(newOptions.minExtent&&!(newOptions.minExtent instanceof OpenLayers.Bounds)){newOptions.minExtent=new OpenLayers.Bounds(newOptions.minExtent)
}}OpenLayers.Util.extend(this.options,newOptions);
OpenLayers.Util.extend(this,newOptions);
if(this.projection&&this.projection.getUnits()){this.units=this.projection.getUnits()
}if(this.map){var resolution=this.map.getResolution();
var properties=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);
for(var o in newOptions){if(newOptions.hasOwnProperty(o)&&OpenLayers.Util.indexOf(properties,o)>=0){this.initResolutions();
if(reinitialize&&this.map.baseLayer===this){this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(resolution),false,true);
this.map.events.triggerEvent("changebaselayer",{layer:this})
}break
}}}},onMapResize:function(){},redraw:function(){var redrawn=false;
if(this.map){this.inRange=this.calculateInRange();
var extent=this.getExtent();
if(extent&&this.inRange&&this.visibility){var zoomChanged=true;
this.moveTo(extent,zoomChanged,false);
this.events.triggerEvent("moveend",{zoomChanged:zoomChanged});
redrawn=true
}}return redrawn
},moveTo:function(bounds,zoomChanged,dragging){var display=this.visibility;
if(!this.isBaseLayer){display=display&&this.inRange
}this.display(display)
},moveByPx:function(dx,dy){},setMap:function(map){if(this.map==null){this.map=map;
this.maxExtent=this.maxExtent||this.map.maxExtent;
this.minExtent=this.minExtent||this.map.minExtent;
this.projection=this.projection||this.map.projection;
if(typeof this.projection=="string"){this.projection=new OpenLayers.Projection(this.projection)
}this.units=this.projection.getUnits()||this.units||this.map.units;
this.initResolutions();
if(!this.isBaseLayer){this.inRange=this.calculateInRange();
var show=((this.visibility)&&(this.inRange));
this.div.style.display=show?"":"none"
}this.setTileSize()
}},afterAdd:function(){},removeMap:function(map){},getImageSize:function(bounds){return(this.imageSize||this.tileSize)
},setTileSize:function(size){var tileSize=(size)?size:((this.tileSize)?this.tileSize:this.map.getTileSize());
this.tileSize=tileSize;
if(this.gutter){this.imageSize=new OpenLayers.Size(tileSize.w+(2*this.gutter),tileSize.h+(2*this.gutter))
}},getVisibility:function(){return this.visibility
},setVisibility:function(visibility){if(visibility!=this.visibility){this.visibility=visibility;
this.display(visibility);
this.redraw();
if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"})
}this.events.triggerEvent("visibilitychanged")
}},display:function(display){if(display!=(this.div.style.display!="none")){this.div.style.display=(display&&this.calculateInRange())?"block":"none"
}},calculateInRange:function(){var inRange=false;
if(this.alwaysInRange){inRange=true
}else{if(this.map){var resolution=this.map.getResolution();
inRange=((resolution>=this.minResolution)&&(resolution<=this.maxResolution))
}}return inRange
},setIsBaseLayer:function(isBaseLayer){if(isBaseLayer!=this.isBaseLayer){this.isBaseLayer=isBaseLayer;
if(this.map!=null){this.map.events.triggerEvent("changebaselayer",{layer:this})
}}},initResolutions:function(){var i,len,p;
var props={},alwaysInRange=true;
for(i=0,len=this.RESOLUTION_PROPERTIES.length;
i<len;
i++){p=this.RESOLUTION_PROPERTIES[i];
props[p]=this.options[p];
if(alwaysInRange&&this.options[p]){alwaysInRange=false
}}if(this.alwaysInRange==null){this.alwaysInRange=alwaysInRange
}if(props.resolutions==null){props.resolutions=this.resolutionsFromScales(props.scales)
}if(props.resolutions==null){props.resolutions=this.calculateResolutions(props)
}if(props.resolutions==null){for(i=0,len=this.RESOLUTION_PROPERTIES.length;
i<len;
i++){p=this.RESOLUTION_PROPERTIES[i];
props[p]=this.options[p]!=null?this.options[p]:this.map[p]
}if(props.resolutions==null){props.resolutions=this.resolutionsFromScales(props.scales)
}if(props.resolutions==null){props.resolutions=this.calculateResolutions(props)
}}var maxResolution;
if(this.options.maxResolution&&this.options.maxResolution!=="auto"){maxResolution=this.options.maxResolution
}if(this.options.minScale){maxResolution=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units)
}var minResolution;
if(this.options.minResolution&&this.options.minResolution!=="auto"){minResolution=this.options.minResolution
}if(this.options.maxScale){minResolution=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)
}if(props.resolutions){props.resolutions.sort(function(a,b){return(b-a)
});
if(!maxResolution){maxResolution=props.resolutions[0]
}if(!minResolution){var lastIdx=props.resolutions.length-1;
minResolution=props.resolutions[lastIdx]
}}this.resolutions=props.resolutions;
if(this.resolutions){len=this.resolutions.length;
this.scales=new Array(len);
for(i=0;
i<len;
i++){this.scales[i]=OpenLayers.Util.getScaleFromResolution(this.resolutions[i],this.units)
}this.numZoomLevels=len
}this.minResolution=minResolution;
if(minResolution){this.maxScale=OpenLayers.Util.getScaleFromResolution(minResolution,this.units)
}this.maxResolution=maxResolution;
if(maxResolution){this.minScale=OpenLayers.Util.getScaleFromResolution(maxResolution,this.units)
}},resolutionsFromScales:function(scales){if(scales==null){return
}var resolutions,i,len;
len=scales.length;
resolutions=new Array(len);
for(i=0;
i<len;
i++){resolutions[i]=OpenLayers.Util.getResolutionFromScale(scales[i],this.units)
}return resolutions
},calculateResolutions:function(props){var viewSize,wRes,hRes;
var maxResolution=props.maxResolution;
if(props.minScale!=null){maxResolution=OpenLayers.Util.getResolutionFromScale(props.minScale,this.units)
}else{if(maxResolution=="auto"&&this.maxExtent!=null){viewSize=this.map.getSize();
wRes=this.maxExtent.getWidth()/viewSize.w;
hRes=this.maxExtent.getHeight()/viewSize.h;
maxResolution=Math.max(wRes,hRes)
}}var minResolution=props.minResolution;
if(props.maxScale!=null){minResolution=OpenLayers.Util.getResolutionFromScale(props.maxScale,this.units)
}else{if(props.minResolution=="auto"&&this.minExtent!=null){viewSize=this.map.getSize();
wRes=this.minExtent.getWidth()/viewSize.w;
hRes=this.minExtent.getHeight()/viewSize.h;
minResolution=Math.max(wRes,hRes)
}}if(typeof maxResolution!=="number"&&typeof minResolution!=="number"&&this.maxExtent!=null){var tileSize=this.map.getTileSize();
maxResolution=Math.max(this.maxExtent.getWidth()/tileSize.w,this.maxExtent.getHeight()/tileSize.h)
}var maxZoomLevel=props.maxZoomLevel;
var numZoomLevels=props.numZoomLevels;
if(typeof minResolution==="number"&&typeof maxResolution==="number"&&numZoomLevels===undefined){var ratio=maxResolution/minResolution;
numZoomLevels=Math.floor(Math.log(ratio)/Math.log(2))+1
}else{if(numZoomLevels===undefined&&maxZoomLevel!=null){numZoomLevels=maxZoomLevel+1
}}if(typeof numZoomLevels!=="number"||numZoomLevels<=0||(typeof maxResolution!=="number"&&typeof minResolution!=="number")){return
}var resolutions=new Array(numZoomLevels);
var base=2;
if(typeof minResolution=="number"&&typeof maxResolution=="number"){base=Math.pow((maxResolution/minResolution),(1/(numZoomLevels-1)))
}var i;
if(typeof maxResolution==="number"){for(i=0;
i<numZoomLevels;
i++){resolutions[i]=maxResolution/Math.pow(base,i)
}}else{for(i=0;
i<numZoomLevels;
i++){resolutions[numZoomLevels-1-i]=minResolution*Math.pow(base,i)
}}return resolutions
},getResolution:function(){var zoom=this.map.getZoom();
return this.getResolutionForZoom(zoom)
},getExtent:function(){return this.map.calculateBounds()
},getZoomForExtent:function(extent,closest){var viewSize=this.map.getSize();
var idealResolution=Math.max(extent.getWidth()/viewSize.w,extent.getHeight()/viewSize.h);
return this.getZoomForResolution(idealResolution,closest)
},getDataExtent:function(){},getResolutionForZoom:function(zoom){zoom=Math.max(0,Math.min(zoom,this.resolutions.length-1));
var resolution;
if(this.map.fractionalZoom){var low=Math.floor(zoom);
var high=Math.ceil(zoom);
resolution=this.resolutions[low]-((zoom-low)*(this.resolutions[low]-this.resolutions[high]))
}else{resolution=this.resolutions[Math.round(zoom)]
}return resolution
},getZoomForResolution:function(resolution,closest){var zoom,i,len;
if(this.map.fractionalZoom){var lowZoom=0;
var highZoom=this.resolutions.length-1;
var highRes=this.resolutions[lowZoom];
var lowRes=this.resolutions[highZoom];
var res;
for(i=0,len=this.resolutions.length;
i<len;
++i){res=this.resolutions[i];
if(res>=resolution){highRes=res;
lowZoom=i
}if(res<=resolution){lowRes=res;
highZoom=i;
break
}}var dRes=highRes-lowRes;
if(dRes>0){zoom=lowZoom+((highRes-resolution)/dRes)
}else{zoom=lowZoom
}}else{var diff;
var minDiff=Number.POSITIVE_INFINITY;
for(i=0,len=this.resolutions.length;
i<len;
i++){if(closest){diff=Math.abs(this.resolutions[i]-resolution);
if(diff>minDiff){break
}minDiff=diff
}else{if(this.resolutions[i]<resolution){break
}}}zoom=Math.max(0,i-1)
}return zoom
},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null;
var map=this.map;
if(viewPortPx!=null&&map.minPx){var res=map.getResolution();
var maxExtent=map.getMaxExtent({restricted:true});
var lon=(viewPortPx.x-map.minPx.x)*res+maxExtent.left;
var lat=(map.minPx.y-viewPortPx.y)*res+maxExtent.top;
lonlat=new OpenLayers.LonLat(lon,lat);
if(this.wrapDateLine){lonlat=lonlat.wrapDateLine(this.maxExtent)
}}return lonlat
},getViewPortPxFromLonLat:function(lonlat,resolution){var px=null;
if(lonlat!=null){resolution=resolution||this.map.getResolution();
var extent=this.map.calculateBounds(null,resolution);
px=new OpenLayers.Pixel((1/resolution*(lonlat.lon-extent.left)),(1/resolution*(extent.top-lonlat.lat)))
}return px
},setOpacity:function(opacity){if(opacity!=this.opacity){this.opacity=opacity;
var childNodes=this.div.childNodes;
for(var i=0,len=childNodes.length;
i<len;
++i){var element=childNodes[i].firstChild||childNodes[i];
var lastChild=childNodes[i].lastChild;
if(lastChild&&lastChild.nodeName.toLowerCase()==="iframe"){element=lastChild.parentNode
}OpenLayers.Util.modifyDOMElement(element,null,null,null,null,null,null,opacity)
}if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})
}}},getZIndex:function(){return this.div.style.zIndex
},setZIndex:function(zIndex){this.div.style.zIndex=zIndex
},adjustBounds:function(bounds){if(this.gutter){var mapGutter=this.gutter*this.map.getResolution();
bounds=new OpenLayers.Bounds(bounds.left-mapGutter,bounds.bottom-mapGutter,bounds.right+mapGutter,bounds.top+mapGutter)
}if(this.wrapDateLine){var wrappingOptions={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};
bounds=bounds.wrapDateLine(this.maxExtent,wrappingOptions)
}return bounds
},CLASS_NAME:"OpenLayers.Layer"});
OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(url,size,offset,calculateOffset){this.url=url;
this.size=size||{w:20,h:20};
this.offset=offset||{x:-(this.size.w/2),y:-(this.size.h/2)};
this.calculateOffset=calculateOffset;
var id=OpenLayers.Util.createUniqueID("OL_Icon_");
this.imageDiv=OpenLayers.Util.createAlphaImageDiv(id)
},destroy:function(){this.erase();
OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);
this.imageDiv.innerHTML="";
this.imageDiv=null
},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)
},setSize:function(size){if(size!=null){this.size=size
}this.draw()
},setUrl:function(url){if(url!=null){this.url=url
}this.draw()
},draw:function(px){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");
this.moveTo(px);
return this.imageDiv
},erase:function(){if(this.imageDiv!=null&&this.imageDiv.parentNode!=null){OpenLayers.Element.remove(this.imageDiv)
}},setOpacity:function(opacity){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,opacity)
},moveTo:function(px){if(px!=null){this.px=px
}if(this.imageDiv!=null){if(this.px==null){this.display(false)
}else{if(this.calculateOffset){this.offset=this.calculateOffset(this.size)
}OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})
}}},display:function(display){this.imageDiv.style.display=(display)?"":"none"
},isDrawn:function(){var isDrawn=(this.imageDiv&&this.imageDiv.parentNode&&(this.imageDiv.parentNode.nodeType!=11));
return isDrawn
},CLASS_NAME:"OpenLayers.Icon"});
OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(lonlat,icon){this.lonlat=lonlat;
var newIcon=(icon)?icon:OpenLayers.Marker.defaultIcon();
if(this.icon==null){this.icon=newIcon
}else{this.icon.url=newIcon.url;
this.icon.size=newIcon.size;
this.icon.offset=newIcon.offset;
this.icon.calculateOffset=newIcon.calculateOffset
}this.events=new OpenLayers.Events(this,this.icon.imageDiv)
},destroy:function(){this.erase();
this.map=null;
this.events.destroy();
this.events=null;
if(this.icon!=null){this.icon.destroy();
this.icon=null
}},draw:function(px){return this.icon.draw(px)
},erase:function(){if(this.icon!=null){this.icon.erase()
}},moveTo:function(px){if((px!=null)&&(this.icon!=null)){this.icon.moveTo(px)
}this.lonlat=this.map.getLonLatFromLayerPx(px)
},isDrawn:function(){var isDrawn=(this.icon&&this.icon.isDrawn());
return isDrawn
},onScreen:function(){var onScreen=false;
if(this.map){var screenBounds=this.map.getExtent();
onScreen=screenBounds.containsLonLat(this.lonlat)
}return onScreen
},inflate:function(inflate){if(this.icon){this.icon.setSize({w:this.icon.size.w*inflate,h:this.icon.size.h*inflate})
}},setOpacity:function(opacity){this.icon.setOpacity(opacity)
},setUrl:function(url){this.icon.setUrl(url)
},display:function(display){this.icon.display(display)
},CLASS_NAME:"OpenLayers.Marker"});
OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})
};
OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(bounds,borderColor,borderWidth){this.bounds=bounds;
this.div=OpenLayers.Util.createDiv();
this.div.style.overflow="hidden";
this.events=new OpenLayers.Events(this,this.div);
this.setBorder(borderColor,borderWidth)
},destroy:function(){this.bounds=null;
this.div=null;
OpenLayers.Marker.prototype.destroy.apply(this,arguments)
},setBorder:function(color,width){if(!color){color="red"
}if(!width){width=2
}this.div.style.border=width+"px solid "+color
},draw:function(px,sz){OpenLayers.Util.modifyDOMElement(this.div,null,px,sz);
return this.div
},onScreen:function(){var onScreen=false;
if(this.map){var screenBounds=this.map.getExtent();
onScreen=screenBounds.containsBounds(this.bounds,true,true)
}return onScreen
},display:function(display){this.div.style.display=(display)?"":"none"
},CLASS_NAME:"OpenLayers.Marker.Box"});
OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:false,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:false,fixPadding:function(){if(typeof this.padding=="number"){this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding)
}},panMapIfOutOfView:false,keepInMap:false,closeOnMove:false,map:null,initialize:function(id,lonlat,contentSize,contentHTML,closeBox,closeBoxCallback){if(id==null){id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
}this.id=id;
this.lonlat=lonlat;
this.contentSize=(contentSize!=null)?contentSize:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);
if(contentHTML!=null){this.contentHTML=contentHTML
}this.backgroundColor=OpenLayers.Popup.COLOR;
this.opacity=OpenLayers.Popup.OPACITY;
this.border=OpenLayers.Popup.BORDER;
this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");
this.div.className=this.displayClass;
var groupDivId=this.id+"_GroupDiv";
this.groupDiv=OpenLayers.Util.createDiv(groupDivId,null,null,null,"relative",null,"hidden");
var id=this.div.id+"_contentDiv";
this.contentDiv=OpenLayers.Util.createDiv(id,null,this.contentSize.clone(),null,"relative");
this.contentDiv.className=this.contentDisplayClass;
this.groupDiv.appendChild(this.contentDiv);
this.div.appendChild(this.groupDiv);
if(closeBox){this.addCloseBox(closeBoxCallback)
}this.registerEvents()
},destroy:function(){this.id=null;
this.lonlat=null;
this.size=null;
this.contentHTML=null;
this.backgroundColor=null;
this.opacity=null;
this.border=null;
if(this.closeOnMove&&this.map){this.map.events.unregister("movestart",this,this.hide)
}this.events.destroy();
this.events=null;
if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);
this.groupDiv.removeChild(this.closeDiv)
}this.closeDiv=null;
this.div.removeChild(this.groupDiv);
this.groupDiv=null;
if(this.map!=null){this.map.removePopup(this)
}this.map=null;
this.div=null;
this.autoSize=null;
this.minSize=null;
this.maxSize=null;
this.padding=null;
this.panMapIfOutOfView=null
},draw:function(px){if(px==null){if((this.lonlat!=null)&&(this.map!=null)){px=this.map.getLayerPxFromLonLat(this.lonlat)
}}if(this.closeOnMove){this.map.events.register("movestart",this,this.hide)
}if(!this.disableFirefoxOverflowHack&&OpenLayers.BROWSER_NAME=="firefox"){this.map.events.register("movestart",this,function(){var style=document.defaultView.getComputedStyle(this.contentDiv,null);
var currentOverflow=style.getPropertyValue("overflow");
if(currentOverflow!="hidden"){this.contentDiv._oldOverflow=currentOverflow;
this.contentDiv.style.overflow="hidden"
}});
this.map.events.register("moveend",this,function(){var oldOverflow=this.contentDiv._oldOverflow;
if(oldOverflow){this.contentDiv.style.overflow=oldOverflow;
this.contentDiv._oldOverflow=null
}})
}this.moveTo(px);
if(!this.autoSize&&!this.size){this.setSize(this.contentSize)
}this.setBackgroundColor();
this.setOpacity();
this.setBorder();
this.setContentHTML();
if(this.panMapIfOutOfView){this.panIntoView()
}return this.div
},updatePosition:function(){if((this.lonlat)&&(this.map)){var px=this.map.getLayerPxFromLonLat(this.lonlat);
if(px){this.moveTo(px)
}}},moveTo:function(px){if((px!=null)&&(this.div!=null)){this.div.style.left=px.x+"px";
this.div.style.top=px.y+"px"
}},visible:function(){return OpenLayers.Element.visible(this.div)
},toggle:function(){if(this.visible()){this.hide()
}else{this.show()
}},show:function(){this.div.style.display="";
if(this.panMapIfOutOfView){this.panIntoView()
}},hide:function(){this.div.style.display="none"
},setSize:function(contentSize){this.size=contentSize.clone();
var contentDivPadding=this.getContentDivPadding();
var wPadding=contentDivPadding.left+contentDivPadding.right;
var hPadding=contentDivPadding.top+contentDivPadding.bottom;
this.fixPadding();
wPadding+=this.padding.left+this.padding.right;
hPadding+=this.padding.top+this.padding.bottom;
if(this.closeDiv){var closeDivWidth=parseInt(this.closeDiv.style.width);
wPadding+=closeDivWidth+contentDivPadding.right
}this.size.w+=wPadding;
this.size.h+=hPadding;
if(OpenLayers.BROWSER_NAME=="msie"){this.contentSize.w+=contentDivPadding.left+contentDivPadding.right;
this.contentSize.h+=contentDivPadding.bottom+contentDivPadding.top
}if(this.div!=null){this.div.style.width=this.size.w+"px";
this.div.style.height=this.size.h+"px"
}if(this.contentDiv!=null){this.contentDiv.style.width=contentSize.w+"px";
this.contentDiv.style.height=contentSize.h+"px"
}},updateSize:function(){var preparedHTML="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>";
var containerElement=(this.map)?this.map.div:document.body;
var realSize=OpenLayers.Util.getRenderedDimensions(preparedHTML,null,{displayClass:this.displayClass,containerElement:containerElement});
var safeSize=this.getSafeContentSize(realSize);
var newSize=null;
if(safeSize.equals(realSize)){newSize=realSize
}else{var fixedSize={w:(safeSize.w<realSize.w)?safeSize.w:null,h:(safeSize.h<realSize.h)?safeSize.h:null};
if(fixedSize.w&&fixedSize.h){newSize=safeSize
}else{var clippedSize=OpenLayers.Util.getRenderedDimensions(preparedHTML,fixedSize,{displayClass:this.contentDisplayClass,containerElement:containerElement});
var currentOverflow=OpenLayers.Element.getStyle(this.contentDiv,"overflow");
if((currentOverflow!="hidden")&&(clippedSize.equals(safeSize))){var scrollBar=OpenLayers.Util.getScrollbarWidth();
if(fixedSize.w){clippedSize.h+=scrollBar
}else{clippedSize.w+=scrollBar
}}newSize=this.getSafeContentSize(clippedSize)
}}this.setSize(newSize)
},setBackgroundColor:function(color){if(color!=undefined){this.backgroundColor=color
}if(this.div!=null){this.div.style.backgroundColor=this.backgroundColor
}},setOpacity:function(opacity){if(opacity!=undefined){this.opacity=opacity
}if(this.div!=null){this.div.style.opacity=this.opacity;
this.div.style.filter="alpha(opacity="+this.opacity*100+")"
}},setBorder:function(border){if(border!=undefined){this.border=border
}if(this.div!=null){this.div.style.border=this.border
}},setContentHTML:function(contentHTML){if(contentHTML!=null){this.contentHTML=contentHTML
}if((this.contentDiv!=null)&&(this.contentHTML!=null)&&(this.contentHTML!=this.contentDiv.innerHTML)){this.contentDiv.innerHTML=this.contentHTML;
if(this.autoSize){this.registerImageListeners();
this.updateSize()
}}},registerImageListeners:function(){var onImgLoad=function(){if(this.popup.id===null){return
}this.popup.updateSize();
if(this.popup.visible()&&this.popup.panMapIfOutOfView){this.popup.panIntoView()
}OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad)
};
var images=this.contentDiv.getElementsByTagName("img");
for(var i=0,len=images.length;
i<len;
i++){var img=images[i];
if(img.width==0||img.height==0){var context={popup:this,img:img};
img._onImgLoad=OpenLayers.Function.bind(onImgLoad,context);
OpenLayers.Event.observe(img,"load",img._onImgLoad)
}}},getSafeContentSize:function(size){var safeContentSize=size.clone();
var contentDivPadding=this.getContentDivPadding();
var wPadding=contentDivPadding.left+contentDivPadding.right;
var hPadding=contentDivPadding.top+contentDivPadding.bottom;
this.fixPadding();
wPadding+=this.padding.left+this.padding.right;
hPadding+=this.padding.top+this.padding.bottom;
if(this.closeDiv){var closeDivWidth=parseInt(this.closeDiv.style.width);
wPadding+=closeDivWidth+contentDivPadding.right
}if(this.minSize){safeContentSize.w=Math.max(safeContentSize.w,(this.minSize.w-wPadding));
safeContentSize.h=Math.max(safeContentSize.h,(this.minSize.h-hPadding))
}if(this.maxSize){safeContentSize.w=Math.min(safeContentSize.w,(this.maxSize.w-wPadding));
safeContentSize.h=Math.min(safeContentSize.h,(this.maxSize.h-hPadding))
}if(this.map&&this.map.size){var extraX=0,extraY=0;
if(this.keepInMap&&!this.panMapIfOutOfView){var px=this.map.getPixelFromLonLat(this.lonlat);
switch(this.relativePosition){case"tr":extraX=px.x;
extraY=this.map.size.h-px.y;
break;
case"tl":extraX=this.map.size.w-px.x;
extraY=this.map.size.h-px.y;
break;
case"bl":extraX=this.map.size.w-px.x;
extraY=px.y;
break;
case"br":extraX=px.x;
extraY=px.y;
break;
default:extraX=px.x;
extraY=this.map.size.h-px.y;
break
}}var maxY=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-hPadding-extraY;
var maxX=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-wPadding-extraX;
safeContentSize.w=Math.min(safeContentSize.w,maxX);
safeContentSize.h=Math.min(safeContentSize.h,maxY)
}return safeContentSize
},getContentDivPadding:function(){var contentDivPadding=this._contentDivPadding;
if(!contentDivPadding){if(this.div.parentNode==null){this.div.style.display="none";
document.body.appendChild(this.div)
}contentDivPadding=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));
this._contentDivPadding=contentDivPadding;
if(this.div.parentNode==document.body){document.body.removeChild(this.div);
this.div.style.display=""
}}return contentDivPadding
},addCloseBox:function(callback){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17});
this.closeDiv.className="olPopupCloseBox";
var contentDivPadding=this.getContentDivPadding();
this.closeDiv.style.right=contentDivPadding.right+"px";
this.closeDiv.style.top=contentDivPadding.top+"px";
this.groupDiv.appendChild(this.closeDiv);
var closePopup=callback||function(e){this.hide();
OpenLayers.Event.stop(e)
};
OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(closePopup,this));
OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(closePopup,this))
},panIntoView:function(){var mapSize=this.map.getSize();
var origTL=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top)));
var newTL=origTL.clone();
if(origTL.x<this.map.paddingForPopups.left){newTL.x=this.map.paddingForPopups.left
}else{if((origTL.x+this.size.w)>(mapSize.w-this.map.paddingForPopups.right)){newTL.x=mapSize.w-this.map.paddingForPopups.right-this.size.w
}}if(origTL.y<this.map.paddingForPopups.top){newTL.y=this.map.paddingForPopups.top
}else{if((origTL.y+this.size.h)>(mapSize.h-this.map.paddingForPopups.bottom)){newTL.y=mapSize.h-this.map.paddingForPopups.bottom-this.size.h
}}var dx=origTL.x-newTL.x;
var dy=origTL.y-newTL.y;
this.map.pan(dx,dy)
},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,true);
function onTouchstart(evt){OpenLayers.Event.stop(evt,true)
}this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:onTouchstart,scope:this})
},onmousedown:function(evt){this.mousedown=true;
OpenLayers.Event.stop(evt,true)
},onmousemove:function(evt){if(this.mousedown){OpenLayers.Event.stop(evt,true)
}},onmouseup:function(evt){if(this.mousedown){this.mousedown=false;
OpenLayers.Event.stop(evt,true)
}},onclick:function(evt){OpenLayers.Event.stop(evt,true)
},onmouseout:function(evt){this.mousedown=false
},ondblclick:function(evt){OpenLayers.Event.stop(evt,true)
},CLASS_NAME:"OpenLayers.Popup"});
OpenLayers.Popup.WIDTH=200;
OpenLayers.Popup.HEIGHT=200;
OpenLayers.Popup.COLOR="white";
OpenLayers.Popup.OPACITY=1;
OpenLayers.Popup.BORDER="0px";
OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:false,initialize:function(layer,position,bounds,url,size,options){this.layer=layer;
this.position=position.clone();
this.setBounds(bounds);
this.url=url;
if(size){this.size=size.clone()
}this.id=OpenLayers.Util.createUniqueID("Tile_");
OpenLayers.Util.extend(this,options);
this.events=new OpenLayers.Events(this);
if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)
}},unload:function(){if(this.isLoading){this.isLoading=false;
this.events.triggerEvent("unload")
}},destroy:function(){this.layer=null;
this.bounds=null;
this.size=null;
this.position=null;
if(this.eventListeners){this.events.un(this.eventListeners)
}this.events.destroy();
this.eventListeners=null;
this.events=null
},draw:function(deferred){if(!deferred){this.clear()
}var draw=this.shouldDraw();
if(draw&&!deferred){draw=this.events.triggerEvent("beforedraw")!==false
}return draw
},shouldDraw:function(){var withinMaxExtent=false,maxExtent=this.layer.maxExtent;
if(maxExtent){var map=this.layer.map;
var worldBounds=map.baseLayer.wrapDateLine&&map.getMaxExtent();
if(this.bounds.intersectsBounds(maxExtent,{inclusive:false,worldBounds:worldBounds})){withinMaxExtent=true
}}return withinMaxExtent||this.layer.displayOutsideMaxExtent
},setBounds:function(bounds){bounds=bounds.clone();
if(this.layer.map.baseLayer.wrapDateLine){var worldExtent=this.layer.map.getMaxExtent(),tolerance=this.layer.map.getResolution();
bounds=bounds.wrapDateLine(worldExtent,{leftTolerance:tolerance,rightTolerance:tolerance})
}this.bounds=bounds
},moveTo:function(bounds,position,redraw){if(redraw==null){redraw=true
}this.setBounds(bounds);
this.position=position.clone();
if(redraw){this.draw()
}},clear:function(draw){},CLASS_NAME:"OpenLayers.Tile"});
OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(layer,position,bounds,url,size,options){OpenLayers.Tile.prototype.initialize.apply(this,arguments);
this.url=url;
this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();
if(this.maxGetUrlLength!=null||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div");
this.frame.style.position="absolute";
this.frame.style.overflow="hidden"
}if(this.maxGetUrlLength!=null){OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)
}},destroy:function(){if(this.imgDiv){this.clear();
this.imgDiv=null;
this.frame=null
}this.asyncRequestId=null;
OpenLayers.Tile.prototype.destroy.apply(this,arguments)
},draw:function(){var drawn=OpenLayers.Tile.prototype.draw.apply(this,arguments);
if(drawn){if(this.layer!=this.layer.map.baseLayer&&this.layer.reproject){this.bounds=this.getBoundsFromBaseLayer(this.position)
}if(this.isLoading){this._loadEvent="reload"
}else{this.isLoading=true;
this._loadEvent="loadstart"
}this.positionTile();
this.renderTile()
}else{this.unload()
}return drawn
},renderTile:function(){this.layer.div.appendChild(this.getTile());
if(this.layer.async){var id=this.asyncRequestId=(this.asyncRequestId||0)+1;
this.layer.getURLasync(this.bounds,function(url){if(id==this.asyncRequestId){this.url=url;
this.initImage()
}},this)
}else{this.url=this.layer.getURL(this.bounds);
this.initImage()
}},positionTile:function(){var style=this.getTile().style,size=this.frame?this.size:this.layer.getImageSize(this.bounds);
style.left=this.position.x+"%";
style.top=this.position.y+"%";
style.width=size.w+"%";
style.height=size.h+"%"
},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);
var img=this.imgDiv;
if(img){OpenLayers.Event.stopObservingElement(img);
var tile=this.getTile();
if(tile.parentNode===this.layer.div){this.layer.div.removeChild(tile)
}this.setImgSrc();
if(this.layerAlphaHack===true){img.style.filter=""
}OpenLayers.Element.removeClass(img,"olImageLoadError")
}this.canvasContext=null
},getImage:function(){if(!this.imgDiv){this.imgDiv=document.createElement("img");
this.imgDiv.className="olTileImage";
this.imgDiv.galleryImg="no";
var style=this.imgDiv.style;
if(this.frame){var left=0,top=0;
if(this.layer.gutter){left=this.layer.gutter/this.layer.tileSize.w*100;
top=this.layer.gutter/this.layer.tileSize.h*100
}style.left=-left+"%";
style.top=-top+"%";
style.width=(2*left+100)+"%";
style.height=(2*top+100)+"%"
}style.visibility="hidden";
style.opacity=0;
if(this.layer.opacity<1){style.filter="alpha(opacity="+(this.layer.opacity*100)+")"
}style.position="absolute";
if(this.layerAlphaHack){style.paddingTop=style.height;
style.height="0";
style.width="100%"
}if(this.frame){this.frame.appendChild(this.imgDiv)
}}return this.imgDiv
},initImage:function(){this.events.triggerEvent(this._loadEvent);
var img=this.getImage();
if(this.url&&img.getAttribute("src")==this.url){this.onImageLoad()
}else{var load=OpenLayers.Function.bind(function(){OpenLayers.Event.stopObservingElement(img);
OpenLayers.Event.observe(img,"load",OpenLayers.Function.bind(this.onImageLoad,this));
OpenLayers.Event.observe(img,"error",OpenLayers.Function.bind(this.onImageError,this));
this.imageReloadAttempts=0;
this.setImgSrc(this.url)
},this);
if(img.getAttribute("src")==this.blankImageUrl){load()
}else{OpenLayers.Event.observe(img,"load",load);
OpenLayers.Event.observe(img,"error",load);
if(this.crossOriginKeyword){img.removeAttribute("crossorigin")
}img.src=this.blankImageUrl
}}},setImgSrc:function(url){var img=this.imgDiv;
img.style.visibility="hidden";
img.style.opacity=0;
if(url){if(this.crossOriginKeyword){if(url.substr(0,5)!=="data:"){img.setAttribute("crossorigin",this.crossOriginKeyword)
}else{img.removeAttribute("crossorigin")
}}img.src=url
}},getTile:function(){return this.frame?this.frame:this.getImage()
},createBackBuffer:function(){if(!this.imgDiv||this.isLoading){return
}var backBuffer;
if(this.frame){backBuffer=this.frame.cloneNode(false);
backBuffer.appendChild(this.imgDiv)
}else{backBuffer=this.imgDiv
}this.imgDiv=null;
return backBuffer
},onImageLoad:function(){var img=this.imgDiv;
OpenLayers.Event.stopObservingElement(img);
img.style.visibility="inherit";
img.style.opacity=this.layer.opacity;
this.isLoading=false;
this.canvasContext=null;
this.events.triggerEvent("loadend");
if(parseFloat(navigator.appVersion.split("MSIE")[1])<7&&this.layer&&this.layer.div){var span=document.createElement("span");
span.style.display="none";
var layerDiv=this.layer.div;
layerDiv.appendChild(span);
window.setTimeout(function(){span.parentNode===layerDiv&&span.parentNode.removeChild(span)
},0)
}if(this.layerAlphaHack===true){img.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+img.src+"', sizingMethod='scale')"
}},onImageError:function(){var img=this.imgDiv;
if(img.src!=null){this.imageReloadAttempts++;
if(this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){this.setImgSrc(this.layer.getURL(this.bounds))
}else{OpenLayers.Element.addClass(img,"olImageLoadError");
this.events.triggerEvent("loaderror");
this.onImageLoad()
}}},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var canvas=document.createElement("canvas");
canvas.width=this.size.w;
canvas.height=this.size.h;
this.canvasContext=canvas.getContext("2d");
this.canvasContext.drawImage(this.imgDiv,0,0)
}return this.canvasContext
}},CLASS_NAME:"OpenLayers.Tile.Image"});
OpenLayers.Tile.Image.IFrame={useIFrame:null,draw:function(){var draw=OpenLayers.Tile.Image.prototype.shouldDraw.call(this);
if(draw){var url=this.layer.getURL(this.bounds);
var usedIFrame=this.useIFrame;
this.useIFrame=this.maxGetUrlLength!==null&&!this.layer.async&&url.length>this.maxGetUrlLength;
var fromIFrame=usedIFrame&&!this.useIFrame;
var toIFrame=!usedIFrame&&this.useIFrame;
if(fromIFrame||toIFrame){if(this.imgDiv&&this.imgDiv.parentNode===this.frame){this.frame.removeChild(this.imgDiv)
}this.imgDiv=null;
if(fromIFrame){this.blankImageUrl=this._blankImageUrl;
this.frame.removeChild(this.frame.firstChild)
}else{this._blankImageUrl=this.blankImageUrl;
this.blankImageUrl="about:blank"
}}}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)
},getImage:function(){if(this.useIFrame===true){if(!this.frame.childNodes.length){var eventPane=document.createElement("div"),style=eventPane.style;
style.position="absolute";
style.width="100%";
style.height="100%";
style.zIndex=1;
style.backgroundImage="url("+this._blankImageUrl+")";
this.frame.appendChild(eventPane)
}var id=this.id+"_iFrame",iframe;
if(parseFloat(navigator.appVersion.split("MSIE")[1])<9){iframe=document.createElement('<iframe name="'+id+'">');
iframe.style.backgroundColor="#FFFFFF";
iframe.style.filter="chroma(color=#FFFFFF)"
}else{iframe=document.createElement("iframe");
iframe.style.backgroundColor="transparent";
iframe.name=id
}iframe.scrolling="no";
iframe.marginWidth="0px";
iframe.marginHeight="0px";
iframe.frameBorder="0";
iframe.style.position="absolute";
iframe.style.width="100%";
iframe.style.height="100%";
if(this.layer.opacity<1){OpenLayers.Util.modifyDOMElement(iframe,null,null,null,null,null,null,this.layer.opacity)
}this.frame.appendChild(iframe);
this.imgDiv=iframe;
return iframe
}else{return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)
}},createRequestForm:function(){var form=document.createElement("form");
form.method="POST";
var cacheId=this.layer.params._OLSALT;
cacheId=(cacheId?cacheId+"_":"")+this.bounds.toBBOX();
form.action=OpenLayers.Util.urlAppend(this.layer.url,cacheId);
form.target=this.id+"_iFrame";
var imageSize=this.layer.getImageSize(),params=OpenLayers.Util.getParameters(this.url),field;
for(var par in params){field=document.createElement("input");
field.type="hidden";
field.name=par;
field.value=params[par];
form.appendChild(field)
}return form
},setImgSrc:function(url){if(this.useIFrame===true){if(url){var form=this.createRequestForm();
this.frame.appendChild(form);
form.submit();
this.frame.removeChild(form)
}else{if(this.imgDiv.parentNode===this.frame){this.frame.removeChild(this.imgDiv);
this.imgDiv=null
}}}else{OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)
}},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments);
if(this.useIFrame===true){this.imgDiv.style.opacity=1;
this.frame.style.opacity=this.layer.opacity
}},createBackBuffer:function(){var backBuffer;
if(this.useIFrame===false){backBuffer=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)
}return backBuffer
}};
OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear();
OpenLayers.Tile.prototype.destroy.apply(this,arguments)
},draw:function(){var drawn=OpenLayers.Tile.prototype.draw.apply(this,arguments);
if(drawn){if(this.isLoading){this.abortLoading();
this.events.triggerEvent("reload")
}else{this.isLoading=true;
this.events.triggerEvent("loadstart")
}this.url=this.layer.getURL(this.bounds);
if(this.layer.useJSONP){var ols=new OpenLayers.Protocol.Script({url:this.url,callback:function(response){this.isLoading=false;
this.events.triggerEvent("loadend");
this.json=response.data
},scope:this});
ols.read();
this.request=ols
}else{this.request=OpenLayers.Request.GET({url:this.url,callback:function(response){this.isLoading=false;
this.events.triggerEvent("loadend");
if(response.status===200){this.parseData(response.responseText)
}},scope:this})
}}else{this.unload()
}return drawn
},abortLoading:function(){if(this.request){this.request.abort();
delete this.request
}this.isLoading=false
},getFeatureInfo:function(i,j){var info=null;
if(this.json){var id=this.getFeatureId(i,j);
if(id!==null){info={id:id,data:this.json.data[id]}
}}return info
},getFeatureId:function(i,j){var id=null;
if(this.json){var resolution=this.utfgridResolution;
var row=Math.floor(j/resolution);
var col=Math.floor(i/resolution);
var charCode=this.json.grid[row].charCodeAt(col);
var index=this.indexFromCharCode(charCode);
var keys=this.json.keys;
if(!isNaN(index)&&(index in keys)){id=keys[index]
}}return id
},indexFromCharCode:function(charCode){if(charCode>=93){charCode--
}if(charCode>=35){charCode--
}return charCode-32
},parseData:function(str){if(!this.format){this.format=new OpenLayers.Format.JSON()
}this.json=this.format.read(str)
},clear:function(){this.json=null
},CLASS_NAME:"OpenLayers.Tile.UTFGrid"});
OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:true,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(name,url,extent,size,options){this.url=url;
this.extent=extent;
this.maxExtent=extent;
this.size=size;
OpenLayers.Layer.prototype.initialize.apply(this,[name,options]);
this.aspectRatio=(this.extent.getHeight()/this.size.h)/(this.extent.getWidth()/this.size.w)
},destroy:function(){if(this.tile){this.removeTileMonitoringHooks(this.tile);
this.tile.destroy();
this.tile=null
}OpenLayers.Layer.prototype.destroy.apply(this,arguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())
}obj=OpenLayers.Layer.prototype.clone.apply(this,[obj]);
return obj
},setMap:function(map){if(this.options.maxResolution==null){this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w
}OpenLayers.Layer.prototype.setMap.apply(this,arguments)
},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);
var firstRendering=(this.tile==null);
if(zoomChanged||firstRendering){this.setTileSize();
var ulPx=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});
if(firstRendering){this.tile=new OpenLayers.Tile.Image(this,ulPx,this.extent,null,this.tileSize);
this.addTileMonitoringHooks(this.tile)
}else{this.tile.size=this.tileSize.clone();
this.tile.position=ulPx.clone()
}this.tile.draw()
}},setTileSize:function(){var tileWidth=this.extent.getWidth()/this.map.getResolution();
var tileHeight=this.extent.getHeight()/this.map.getResolution();
this.tileSize=new OpenLayers.Size(tileWidth,tileHeight)
},addTileMonitoringHooks:function(tile){tile.onLoadStart=function(){this.events.triggerEvent("loadstart")
};
tile.events.register("loadstart",this,tile.onLoadStart);
tile.onLoadEnd=function(){this.events.triggerEvent("loadend")
};
tile.events.register("loadend",this,tile.onLoadEnd);
tile.events.register("unload",this,tile.onLoadEnd)
},removeTileMonitoringHooks:function(tile){tile.unload();
tile.events.un({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,scope:this})
},setUrl:function(newUrl){this.url=newUrl;
this.tile.draw()
},getURL:function(bounds){return this.url
},CLASS_NAME:"OpenLayers.Layer.Image"});
OpenLayers.Layer.SphericalMercator={getExtent:function(){var extent=null;
if(this.sphericalMercator){extent=this.map.calculateBounds()
}else{extent=OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)
}return extent
},getLonLatFromViewPortPx:function(viewPortPx){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)
},getViewPortPxFromLonLat:function(lonlat){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)
},initMercatorParameters:function(){this.RESOLUTIONS=[];
var maxResolution=156543.03390625;
for(var zoom=0;
zoom<=this.MAX_ZOOM_LEVEL;
++zoom){this.RESOLUTIONS[zoom]=maxResolution/Math.pow(2,zoom)
}this.units="m";
this.projection=this.projection||"EPSG:900913"
},forwardMercator:(function(){var gg=new OpenLayers.Projection("EPSG:4326");
var sm=new OpenLayers.Projection("EPSG:900913");
return function(lon,lat){var point=OpenLayers.Projection.transform({x:lon,y:lat},gg,sm);
return new OpenLayers.LonLat(point.x,point.y)
}
})(),inverseMercator:(function(){var gg=new OpenLayers.Projection("EPSG:4326");
var sm=new OpenLayers.Projection("EPSG:900913");
return function(x,y){var point=OpenLayers.Projection.transform({x:x,y:y},sm,gg);
return new OpenLayers.LonLat(point.x,point.y)
}
})()};
OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:true,isBaseLayer:true,isFixed:true,pane:null,mapObject:null,initialize:function(name,options){OpenLayers.Layer.prototype.initialize.apply(this,arguments);
if(this.pane==null){this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane")
}},destroy:function(){this.mapObject=null;
this.pane=null;
OpenLayers.Layer.prototype.destroy.apply(this,arguments)
},setMap:function(map){OpenLayers.Layer.prototype.setMap.apply(this,arguments);
this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1;
this.pane.style.display=this.div.style.display;
this.pane.style.width="100%";
this.pane.style.height="100%";
if(OpenLayers.BROWSER_NAME=="msie"){this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")"
}if(this.isFixed){this.map.viewPortDiv.appendChild(this.pane)
}else{this.map.layerContainerDiv.appendChild(this.pane)
}this.loadMapObject();
if(this.mapObject==null){this.loadWarningMessage()
}},removeMap:function(map){if(this.pane&&this.pane.parentNode){this.pane.parentNode.removeChild(this.pane)
}OpenLayers.Layer.prototype.removeMap.apply(this,arguments)
},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";
var viewSize=this.map.getSize();
var msgW=Math.min(viewSize.w,300);
var msgH=Math.min(viewSize.h,200);
var size=new OpenLayers.Size(msgW,msgH);
var centerPx=new OpenLayers.Pixel(viewSize.w/2,viewSize.h/2);
var topLeft=centerPx.add(-size.w/2,-size.h/2);
var div=OpenLayers.Util.createDiv(this.name+"_warning",topLeft,size,null,null,null,"auto");
div.style.padding="7px";
div.style.backgroundColor="yellow";
div.innerHTML=this.getWarningHTML();
this.div.appendChild(div)
},getWarningHTML:function(){return""
},display:function(display){OpenLayers.Layer.prototype.display.apply(this,arguments);
this.pane.style.display=this.div.style.display
},setZIndex:function(zIndex){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments);
this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1
},moveByPx:function(dx,dy){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments);
if(this.dragPanMapObject){this.dragPanMapObject(dx,-dy)
}else{this.moveTo(this.map.getCachedCenter())
}},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);
if(this.mapObject!=null){var newCenter=this.map.getCenter();
var newZoom=this.map.getZoom();
if(newCenter!=null){var moOldCenter=this.getMapObjectCenter();
var oldCenter=this.getOLLonLatFromMapObjectLonLat(moOldCenter);
var moOldZoom=this.getMapObjectZoom();
var oldZoom=this.getOLZoomFromMapObjectZoom(moOldZoom);
if(!(newCenter.equals(oldCenter))||newZoom!=oldZoom){if(!zoomChanged&&oldCenter&&this.dragPanMapObject&&this.smoothDragPan){var oldPx=this.map.getViewPortPxFromLonLat(oldCenter);
var newPx=this.map.getViewPortPxFromLonLat(newCenter);
this.dragPanMapObject(newPx.x-oldPx.x,oldPx.y-newPx.y)
}else{var center=this.getMapObjectLonLatFromOLLonLat(newCenter);
var zoom=this.getMapObjectZoomFromOLZoom(newZoom);
this.setMapObjectCenter(center,zoom,dragging)
}}}}},getLonLatFromViewPortPx:function(viewPortPx){var lonlat=null;
if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var moPixel=this.getMapObjectPixelFromOLPixel(viewPortPx);
var moLonLat=this.getMapObjectLonLatFromMapObjectPixel(moPixel);
lonlat=this.getOLLonLatFromMapObjectLonLat(moLonLat)
}return lonlat
},getViewPortPxFromLonLat:function(lonlat){var viewPortPx=null;
if((this.mapObject!=null)&&(this.getMapObjectCenter()!=null)){var moLonLat=this.getMapObjectLonLatFromOLLonLat(lonlat);
var moPixel=this.getMapObjectPixelFromMapObjectLonLat(moLonLat);
viewPortPx=this.getOLPixelFromMapObjectPixel(moPixel)
}return viewPortPx
},getOLLonLatFromMapObjectLonLat:function(moLonLat){var olLonLat=null;
if(moLonLat!=null){var lon=this.getLongitudeFromMapObjectLonLat(moLonLat);
var lat=this.getLatitudeFromMapObjectLonLat(moLonLat);
olLonLat=new OpenLayers.LonLat(lon,lat)
}return olLonLat
},getMapObjectLonLatFromOLLonLat:function(olLonLat){var moLatLng=null;
if(olLonLat!=null){moLatLng=this.getMapObjectLonLatFromLonLat(olLonLat.lon,olLonLat.lat)
}return moLatLng
},getOLPixelFromMapObjectPixel:function(moPixel){var olPixel=null;
if(moPixel!=null){var x=this.getXFromMapObjectPixel(moPixel);
var y=this.getYFromMapObjectPixel(moPixel);
olPixel=new OpenLayers.Pixel(x,y)
}return olPixel
},getMapObjectPixelFromOLPixel:function(olPixel){var moPixel=null;
if(olPixel!=null){moPixel=this.getMapObjectPixelFromXY(olPixel.x,olPixel.y)
}return moPixel
},CLASS_NAME:"OpenLayers.Layer.EventPane"});
OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){var props=["minZoomLevel","maxZoomLevel","numZoomLevels"];
for(var i=0,len=props.length;
i<len;
i++){var property=props[i];
this[property]=(this.options[property]!=null)?this.options[property]:this.map[property]
}if((this.minZoomLevel==null)||(this.minZoomLevel<this.MIN_ZOOM_LEVEL)){this.minZoomLevel=this.MIN_ZOOM_LEVEL
}var desiredZoomLevels;
var limitZoomLevels=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;
if(((this.options.numZoomLevels==null)&&(this.options.maxZoomLevel!=null))||((this.numZoomLevels==null)&&(this.maxZoomLevel!=null))){desiredZoomLevels=this.maxZoomLevel-this.minZoomLevel+1
}else{desiredZoomLevels=this.numZoomLevels
}if(desiredZoomLevels!=null){this.numZoomLevels=Math.min(desiredZoomLevels,limitZoomLevels)
}else{this.numZoomLevels=limitZoomLevels
}this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1;
if(this.RESOLUTIONS!=null){var resolutionsIndex=0;
this.resolutions=[];
for(var i=this.minZoomLevel;
i<=this.maxZoomLevel;
i++){this.resolutions[resolutionsIndex++]=this.RESOLUTIONS[i]
}this.maxResolution=this.resolutions[0];
this.minResolution=this.resolutions[this.resolutions.length-1]
}},getResolution:function(){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getResolution.apply(this,arguments)
}else{var resolution=null;
var viewSize=this.map.getSize();
var extent=this.getExtent();
if((viewSize!=null)&&(extent!=null)){resolution=Math.max(extent.getWidth()/viewSize.w,extent.getHeight()/viewSize.h)
}return resolution
}},getExtent:function(){var size=this.map.getSize();
var tl=this.getLonLatFromViewPortPx({x:0,y:0});
var br=this.getLonLatFromViewPortPx({x:size.w,y:size.h});
if((tl!=null)&&(br!=null)){return new OpenLayers.Bounds(tl.lon,br.lat,br.lon,tl.lat)
}else{return null
}},getZoomForResolution:function(resolution){if(this.resolutions!=null){return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments)
}else{var extent=OpenLayers.Layer.prototype.getExtent.apply(this,[]);
return this.getZoomForExtent(extent)
}},getOLZoomFromMapObjectZoom:function(moZoom){var zoom=null;
if(moZoom!=null){zoom=moZoom-this.minZoomLevel;
if(this.map.baseLayer!==this){zoom=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(zoom))
}}return zoom
},getMapObjectZoomFromOLZoom:function(olZoom){var zoom=null;
if(olZoom!=null){zoom=olZoom+this.minZoomLevel;
if(this.map.baseLayer!==this){zoom=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(zoom))
}}return zoom
},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"});
OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,0.703125,0.3515625,0.17578125,0.087890625,0.0439453125,0.02197265625,0.010986328125,0.0054931640625,0.00274658203125,0.001373291015625,0.0006866455078125,0.00034332275390625,0.000171661376953125,0.0000858306884765625,0.00004291534423828125,0.00002145767211914062,0.00001072883605957031,0.00000536441802978515,0.00000268220901489257,0.000001341104507446289,6.705522537231445e-7],type:null,wrapDateLine:true,sphericalMercator:false,version:null,initialize:function(name,options){options=options||{};
if(!options.version){options.version=typeof GMap2==="function"?"2":"3"
}var mixin=OpenLayers.Layer.Google["v"+options.version.replace(/\./g,"_")];
if(mixin){OpenLayers.Util.applyDefaults(options,mixin)
}else{throw"Unsupported Google Maps API version: "+options.version
}OpenLayers.Util.applyDefaults(options,mixin.DEFAULTS);
if(options.maxExtent){options.maxExtent=options.maxExtent.clone()
}OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[name,options]);
OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[name,options]);
if(this.sphericalMercator){OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator);
this.initMercatorParameters()
}},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())
},setVisibility:function(visible){var opacity=this.opacity==null?1:this.opacity;
OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments);
this.setOpacity(opacity)
},display:function(visible){if(!this._dragging){this.setGMapVisibility(visible)
}OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)
},moveTo:function(bounds,zoomChanged,dragging){this._dragging=dragging;
OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments);
delete this._dragging
},setOpacity:function(opacity){if(opacity!==this.opacity){if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})
}this.opacity=opacity
}if(this.getVisibility()){var container=this.getMapContainer();
OpenLayers.Util.modifyDOMElement(container,null,null,null,null,null,null,opacity)
}},destroy:function(){if(this.map){this.setGMapVisibility(false);
var cache=OpenLayers.Layer.Google.cache[this.map.id];
if(cache&&cache.count<=1){this.removeGMapElements()
}}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)
},removeGMapElements:function(){var cache=OpenLayers.Layer.Google.cache[this.map.id];
if(cache){var container=this.mapObject&&this.getMapContainer();
if(container&&container.parentNode){container.parentNode.removeChild(container)
}var termsOfUse=cache.termsOfUse;
if(termsOfUse&&termsOfUse.parentNode){termsOfUse.parentNode.removeChild(termsOfUse)
}var poweredBy=cache.poweredBy;
if(poweredBy&&poweredBy.parentNode){poweredBy.parentNode.removeChild(poweredBy)
}}},removeMap:function(map){if(this.visibility&&this.mapObject){this.setGMapVisibility(false)
}var cache=OpenLayers.Layer.Google.cache[map.id];
if(cache){if(cache.count<=1){this.removeGMapElements();
delete OpenLayers.Layer.Google.cache[map.id]
}else{--cache.count
}}delete this.termsOfUse;
delete this.poweredBy;
delete this.mapObject;
delete this.dragObject;
OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)
},getOLBoundsFromMapObjectBounds:function(moBounds){var olBounds=null;
if(moBounds!=null){var sw=moBounds.getSouthWest();
var ne=moBounds.getNorthEast();
if(this.sphericalMercator){sw=this.forwardMercator(sw.lng(),sw.lat());
ne=this.forwardMercator(ne.lng(),ne.lat())
}else{sw=new OpenLayers.LonLat(sw.lng(),sw.lat());
ne=new OpenLayers.LonLat(ne.lng(),ne.lat())
}olBounds=new OpenLayers.Bounds(sw.lon,sw.lat,ne.lon,ne.lat)
}return olBounds
},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")
},getMapObjectCenter:function(){return this.mapObject.getCenter()
},getMapObjectZoom:function(){return this.mapObject.getZoom()
},getLongitudeFromMapObjectLonLat:function(moLonLat){return this.sphericalMercator?this.forwardMercator(moLonLat.lng(),moLonLat.lat()).lon:moLonLat.lng()
},getLatitudeFromMapObjectLonLat:function(moLonLat){var lat=this.sphericalMercator?this.forwardMercator(moLonLat.lng(),moLonLat.lat()).lat:moLonLat.lat();
return lat
},getXFromMapObjectPixel:function(moPixel){return moPixel.x
},getYFromMapObjectPixel:function(moPixel){return moPixel.y
},CLASS_NAME:"OpenLayers.Layer.Google"});
OpenLayers.Layer.Google.cache={};
OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){if(!this.type){this.type=G_NORMAL_MAP
}var mapObject,termsOfUse,poweredBy;
var cache=OpenLayers.Layer.Google.cache[this.map.id];
if(cache){mapObject=cache.mapObject;
termsOfUse=cache.termsOfUse;
poweredBy=cache.poweredBy;
++cache.count
}else{var container=this.map.viewPortDiv;
var div=document.createElement("div");
div.id=this.map.id+"_GMap2Container";
div.style.position="absolute";
div.style.width="100%";
div.style.height="100%";
container.appendChild(div);
try{mapObject=new GMap2(div);
termsOfUse=div.lastChild;
container.appendChild(termsOfUse);
termsOfUse.style.zIndex="1100";
termsOfUse.style.right="";
termsOfUse.style.bottom="";
termsOfUse.className="olLayerGoogleCopyright";
poweredBy=div.lastChild;
container.appendChild(poweredBy);
poweredBy.style.zIndex="1100";
poweredBy.style.right="";
poweredBy.style.bottom="";
poweredBy.className="olLayerGooglePoweredBy gmnoprint"
}catch(e){throw (e)
}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:mapObject,termsOfUse:termsOfUse,poweredBy:poweredBy,count:1}
}this.mapObject=mapObject;
this.termsOfUse=termsOfUse;
this.poweredBy=poweredBy;
if(OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)===-1){this.mapObject.addMapType(this.type)
}if(typeof mapObject.getDragObject=="function"){this.dragObject=mapObject.getDragObject()
}else{this.dragPanMapObject=null
}if(this.isBaseLayer===false){this.setGMapVisibility(this.div.style.display!=="none")
}},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded()){this.mapObject.checkResize()
}else{if(!this._resized){var layer=this;
var handle=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(handle);
delete layer._resized;
layer.mapObject.checkResize();
layer.moveTo(layer.map.getCenter(),layer.map.getZoom())
})
}this._resized=true
}},setGMapVisibility:function(visible){var cache=OpenLayers.Layer.Google.cache[this.map.id];
if(cache){var container=this.mapObject.getContainer();
if(visible===true){this.mapObject.setMapType(this.type);
container.style.display="";
this.termsOfUse.style.left="";
this.termsOfUse.style.display="";
this.poweredBy.style.display="";
cache.displayed=this.id
}else{if(cache.displayed===this.id){delete cache.displayed
}if(!cache.displayed){container.style.display="none";
this.termsOfUse.style.display="none";
this.termsOfUse.style.left="-9999px";
this.poweredBy.style.display="none"
}}}},getMapContainer:function(){return this.mapObject.getContainer()
},getMapObjectBoundsFromOLBounds:function(olBounds){var moBounds=null;
if(olBounds!=null){var sw=this.sphericalMercator?this.inverseMercator(olBounds.bottom,olBounds.left):new OpenLayers.LonLat(olBounds.bottom,olBounds.left);
var ne=this.sphericalMercator?this.inverseMercator(olBounds.top,olBounds.right):new OpenLayers.LonLat(olBounds.top,olBounds.right);
moBounds=new GLatLngBounds(new GLatLng(sw.lat,sw.lon),new GLatLng(ne.lat,ne.lon))
}return moBounds
},setMapObjectCenter:function(center,zoom){this.mapObject.setCenter(center,zoom)
},dragPanMapObject:function(dX,dY){this.dragObject.moveBy(new GSize(-dX,dY))
},getMapObjectLonLatFromMapObjectPixel:function(moPixel){return this.mapObject.fromContainerPixelToLatLng(moPixel)
},getMapObjectPixelFromMapObjectLonLat:function(moLonLat){return this.mapObject.fromLatLngToContainerPixel(moLonLat)
},getMapObjectZoomFromMapObjectBounds:function(moBounds){return this.mapObject.getBoundsZoomLevel(moBounds)
},getMapObjectLonLatFromLonLat:function(lon,lat){var gLatLng;
if(this.sphericalMercator){var lonlat=this.inverseMercator(lon,lat);
gLatLng=new GLatLng(lonlat.lat,lonlat.lon)
}else{gLatLng=new GLatLng(lat,lon)
}return gLatLng
},getMapObjectPixelFromXY:function(x,y){return new GPoint(x,y)
}};
OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:true,projection:"EPSG:900913"},animationEnabled:true,loadMapObject:function(){if(!this.type){this.type=google.maps.MapTypeId.ROADMAP
}var mapObject;
var cache=OpenLayers.Layer.Google.cache[this.map.id];
if(cache){mapObject=cache.mapObject;
++cache.count
}else{var container=this.map.viewPortDiv;
var div=document.createElement("div");
div.id=this.map.id+"_GMapContainer";
div.style.position="absolute";
div.style.width="100%";
div.style.height="100%";
container.appendChild(div);
var center=this.map.getCenter();
mapObject=new google.maps.Map(div,{center:center?new google.maps.LatLng(center.lat,center.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:true,keyboardShortcuts:false,draggable:false,disableDoubleClickZoom:true,scrollwheel:false,streetViewControl:false});
cache={mapObject:mapObject,count:1};
OpenLayers.Layer.Google.cache[this.map.id]=cache;
this.repositionListener=google.maps.event.addListenerOnce(mapObject,"center_changed",OpenLayers.Function.bind(this.repositionMapElements,this))
}this.mapObject=mapObject;
this.setGMapVisibility(this.visibility)
},repositionMapElements:function(){google.maps.event.trigger(this.mapObject,"resize");
var div=this.mapObject.getDiv().firstChild;
if(!div||div.childNodes.length<3){this.repositionTimer=window.setTimeout(OpenLayers.Function.bind(this.repositionMapElements,this),250);
return false
}var cache=OpenLayers.Layer.Google.cache[this.map.id];
var container=this.map.viewPortDiv;
for(var i=div.children.length-1;
i>=0;
--i){if(div.children[i].style.zIndex==1000001){var termsOfUse=div.children[i];
container.appendChild(termsOfUse);
termsOfUse.style.zIndex="1100";
termsOfUse.style.bottom="";
termsOfUse.className="olLayerGoogleCopyright olLayerGoogleV3";
termsOfUse.style.display="";
cache.termsOfUse=termsOfUse
}if(div.children[i].style.zIndex==1000000){var poweredBy=div.children[i];
container.appendChild(poweredBy);
poweredBy.style.zIndex="1100";
poweredBy.style.bottom="";
poweredBy.className="olLayerGooglePoweredBy olLayerGoogleV3 gmnoprint";
poweredBy.style.display="";
cache.poweredBy=poweredBy
}if(div.children[i].style.zIndex==10000002){container.appendChild(div.children[i])
}}this.setGMapVisibility(this.visibility)
},onMapResize:function(){if(this.visibility){google.maps.event.trigger(this.mapObject,"resize")
}else{var cache=OpenLayers.Layer.Google.cache[this.map.id];
if(!cache.resized){var layer=this;
google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){google.maps.event.trigger(layer.mapObject,"resize");
layer.moveTo(layer.map.getCenter(),layer.map.getZoom());
delete cache.resized
})
}cache.resized=true
}},setGMapVisibility:function(visible){var cache=OpenLayers.Layer.Google.cache[this.map.id];
if(cache){var type=this.type;
var layers=this.map.layers;
var layer;
for(var i=layers.length-1;
i>=0;
--i){layer=layers[i];
if(layer instanceof OpenLayers.Layer.Google&&layer.visibility===true&&layer.inRange===true){type=layer.type;
visible=true;
break
}}var container=this.mapObject.getDiv();
if(visible===true){this.mapObject.setMapTypeId(type);
container.style.left="";
if(cache.termsOfUse&&cache.termsOfUse.style){cache.termsOfUse.style.left="";
cache.termsOfUse.style.display="";
cache.poweredBy.style.display=""
}cache.displayed=this.id
}else{delete cache.displayed;
container.style.left="-9999px";
if(cache.termsOfUse&&cache.termsOfUse.style){cache.termsOfUse.style.display="none";
cache.termsOfUse.style.left="-9999px";
cache.poweredBy.style.display="none"
}}}},getMapContainer:function(){return this.mapObject.getDiv()
},getMapObjectBoundsFromOLBounds:function(olBounds){var moBounds=null;
if(olBounds!=null){var sw=this.sphericalMercator?this.inverseMercator(olBounds.bottom,olBounds.left):new OpenLayers.LonLat(olBounds.bottom,olBounds.left);
var ne=this.sphericalMercator?this.inverseMercator(olBounds.top,olBounds.right):new OpenLayers.LonLat(olBounds.top,olBounds.right);
moBounds=new google.maps.LatLngBounds(new google.maps.LatLng(sw.lat,sw.lon),new google.maps.LatLng(ne.lat,ne.lon))
}return moBounds
},getMapObjectLonLatFromMapObjectPixel:function(moPixel){var size=this.map.getSize();
var lon=this.getLongitudeFromMapObjectLonLat(this.mapObject.center);
var lat=this.getLatitudeFromMapObjectLonLat(this.mapObject.center);
var res=this.map.getResolution();
var delta_x=moPixel.x-(size.w/2);
var delta_y=moPixel.y-(size.h/2);
var lonlat=new OpenLayers.LonLat(lon+delta_x*res,lat-delta_y*res);
if(this.wrapDateLine){lonlat=lonlat.wrapDateLine(this.maxExtent)
}return this.getMapObjectLonLatFromLonLat(lonlat.lon,lonlat.lat)
},getMapObjectPixelFromMapObjectLonLat:function(moLonLat){var lon=this.getLongitudeFromMapObjectLonLat(moLonLat);
var lat=this.getLatitudeFromMapObjectLonLat(moLonLat);
var res=this.map.getResolution();
var extent=this.map.getExtent();
return this.getMapObjectPixelFromXY((1/res*(lon-extent.left)),(1/res*(extent.top-lat)))
},setMapObjectCenter:function(center,zoom){if(this.animationEnabled===false&&zoom!=this.mapObject.zoom){var mapContainer=this.getMapContainer();
google.maps.event.addListenerOnce(this.mapObject,"idle",function(){mapContainer.style.visibility=""
});
mapContainer.style.visibility="hidden"
}this.mapObject.setOptions({center:center,zoom:zoom})
},getMapObjectZoomFromMapObjectBounds:function(moBounds){return this.mapObject.getBoundsZoomLevel(moBounds)
},getMapObjectLonLatFromLonLat:function(lon,lat){var gLatLng;
if(this.sphericalMercator){var lonlat=this.inverseMercator(lon,lat);
gLatLng=new google.maps.LatLng(lonlat.lat,lonlat.lon)
}else{gLatLng=new google.maps.LatLng(lat,lon)
}return gLatLng
},getMapObjectPixelFromXY:function(x,y){return new google.maps.Point(x,y)
},destroy:function(){if(this.repositionListener){google.maps.event.removeListener(this.repositionListener)
}if(this.repositionTimer){window.clearTimeout(this.repositionTimer)
}OpenLayers.Layer.Google.prototype.destroy.apply(this,arguments)
}};
OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:false,initialize:function(name,url,params,options){OpenLayers.Layer.prototype.initialize.apply(this,[name,options]);
this.url=url;
if(!this.params){this.params=OpenLayers.Util.extend({},params)
}},destroy:function(){this.url=null;
this.params=null;
OpenLayers.Layer.prototype.destroy.apply(this,arguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.prototype.clone.apply(this,[obj]);
return obj
},setUrl:function(newUrl){this.url=newUrl
},mergeNewParams:function(newParams){this.params=OpenLayers.Util.extend(this.params,newParams);
var ret=this.redraw();
if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"params"})
}return ret
},redraw:function(force){if(force){return this.mergeNewParams({_olSalt:Math.random()})
}else{return OpenLayers.Layer.prototype.redraw.apply(this,[])
}},selectUrl:function(paramString,urls){var product=1;
for(var i=0,len=paramString.length;
i<len;
i++){product*=paramString.charCodeAt(i)*this.URL_HASH_FACTOR;
product-=Math.floor(product)
}return urls[Math.floor(product*urls.length)]
},getFullRequestString:function(newParams,altUrl){var url=altUrl||this.url;
var allParams=OpenLayers.Util.extend({},this.params);
allParams=OpenLayers.Util.extend(allParams,newParams);
var paramsString=OpenLayers.Util.getParameterString(allParams);
if(OpenLayers.Util.isArray(url)){url=this.selectUrl(paramsString,url)
}var urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));
for(var key in allParams){if(key.toUpperCase() in urlParams){delete allParams[key]
}}paramsString=OpenLayers.Util.getParameterString(allParams);
return OpenLayers.Util.urlAppend(url,paramsString)
},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});
OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:false,ratio:1.5,buffer:0,transitionEffect:null,numLoadingTiles:0,tileLoadingDelay:85,serverResolutions:null,moveTimerId:null,deferMoveGriddedTiles:null,tileQueueId:null,tileQueue:null,loading:false,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,initialize:function(name,url,params,options){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);
this.grid=[];
this.tileQueue=[];
if(this.removeBackBufferDelay===null){this.removeBackBufferDelay=this.singleTile?0:2500
}if(this.className===null){this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid"
}if(!OpenLayers.Animation.isNative){this.deferMoveGriddedTiles=OpenLayers.Function.bind(function(){this.moveGriddedTiles(true);
this.moveTimerId=null
},this)
}},setMap:function(map){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,map);
OpenLayers.Element.addClass(this.div,this.className)
},removeMap:function(map){if(this.moveTimerId!==null){window.clearTimeout(this.moveTimerId);
this.moveTimerId=null
}this.clearTileQueue();
if(this.backBufferTimerId!==null){window.clearTimeout(this.backBufferTimerId);
this.backBufferTimerId=null
}},destroy:function(){this.removeBackBuffer();
this.clearGrid();
this.grid=null;
this.tileSize=null;
OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)
},clearGrid:function(){this.clearTileQueue();
if(this.grid){for(var iRow=0,len=this.grid.length;
iRow<len;
iRow++){var row=this.grid[iRow];
for(var iCol=0,clen=row.length;
iCol<clen;
iCol++){var tile=row[iCol];
this.destroyTile(tile)
}}this.grid=[];
this.gridResolution=null
}},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[obj]);
if(this.tileSize!=null){obj.tileSize=this.tileSize.clone()
}obj.grid=[];
obj.gridResolution=null;
obj.backBuffer=null;
obj.backBufferTimerId=null;
obj.tileQueue=[];
obj.tileQueueId=null;
obj.loading=false;
obj.moveTimerId=null;
return obj
},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);
bounds=bounds||this.map.getExtent();
if(bounds!=null){var forceReTile=!this.grid.length||zoomChanged;
var tilesBounds=this.getTilesBounds();
var resolution=this.map.getResolution();
var serverResolution=this.getServerResolution(resolution);
if(this.singleTile){if(forceReTile||(!dragging&&!tilesBounds.containsBounds(bounds))){if(zoomChanged&&this.transitionEffect!=="resize"){this.removeBackBuffer()
}if(!zoomChanged||this.transitionEffect==="resize"){this.applyBackBuffer(serverResolution)
}this.initSingleTile(bounds)
}}else{forceReTile=forceReTile||!tilesBounds.intersectsBounds(bounds,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()});
if(resolution!==serverResolution){bounds=this.map.calculateBounds(null,serverResolution);
if(forceReTile){var scale=serverResolution/resolution;
this.transformDiv(scale)
}}else{this.div.style.width="100%";
this.div.style.height="100%";
this.div.style.left="0%";
this.div.style.top="0%"
}if(forceReTile){if(zoomChanged&&this.transitionEffect==="resize"){this.applyBackBuffer(serverResolution)
}this.initGriddedTiles(bounds)
}else{this.moveGriddedTiles()
}}}},getTileData:function(loc){var data=null,x=loc.lon,y=loc.lat,numRows=this.grid.length;
if(this.map&&numRows){var res=this.map.getResolution(),tileWidth=this.tileSize.w,tileHeight=this.tileSize.h,bounds=this.grid[0][0].bounds,left=bounds.left,top=bounds.top;
if(x<left){if(this.map.baseLayer.wrapDateLine){var worldWidth=this.map.getMaxExtent().getWidth();
var worldsAway=Math.ceil((left-x)/worldWidth);
x+=worldWidth*worldsAway
}}var dtx=(x-left)/(res*tileWidth);
var dty=(top-y)/(res*tileHeight);
var col=Math.floor(dtx);
var row=Math.floor(dty);
if(row>=0&&row<numRows){var tile=this.grid[row][col];
if(tile){data={tile:tile,i:Math.floor((dtx-col)*tileWidth),j:Math.floor((dty-row)*tileHeight)}
}}}return data
},queueTileDraw:function(evt){var tile=evt.object;
if(!~OpenLayers.Util.indexOf(this.tileQueue,tile)){this.tileQueue.push(tile)
}if(!this.tileQueueId){this.tileQueueId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.drawTileFromQueue,this),null,this.div)
}return false
},drawTileFromQueue:function(){if(this.tileQueue.length===0){this.clearTileQueue()
}else{this.tileQueue.shift().draw(true)
}},clearTileQueue:function(){OpenLayers.Animation.stop(this.tileQueueId);
this.tileQueueId=null;
this.tileQueue=[]
},destroyTile:function(tile){this.removeTileMonitoringHooks(tile);
tile.destroy()
},getServerResolution:function(resolution){resolution=resolution||this.map.getResolution();
if(this.serverResolutions&&OpenLayers.Util.indexOf(this.serverResolutions,resolution)===-1){var i,serverResolution;
for(i=this.serverResolutions.length-1;
i>=0;
i--){serverResolution=this.serverResolutions[i];
if(serverResolution>resolution){resolution=serverResolution;
break
}}if(i===-1){throw"no appropriate resolution in serverResolutions"
}}return resolution
},getServerZoom:function(){var resolution=this.getServerResolution();
return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,resolution):this.map.getZoomForResolution(resolution)+(this.zoomOffset||0)
},transformDiv:function(scale){this.div.style.width=100*scale+"%";
this.div.style.height=100*scale+"%";
var size=this.map.getSize();
var lcX=parseInt(this.map.layerContainerDiv.style.left,10);
var lcY=parseInt(this.map.layerContainerDiv.style.top,10);
var x=(lcX-(size.w/2))*(scale-1);
var y=(lcY-(size.h/2))*(scale-1);
this.div.style.left=x+"%";
this.div.style.top=y+"%"
},getResolutionScale:function(){return parseInt(this.div.style.width,10)/100
},applyBackBuffer:function(resolution){if(this.backBufferTimerId!==null){this.removeBackBuffer()
}var backBuffer=this.backBuffer;
if(!backBuffer){backBuffer=this.createBackBuffer();
if(!backBuffer){return
}this.div.insertBefore(backBuffer,this.div.firstChild);
this.backBuffer=backBuffer;
var topLeftTileBounds=this.grid[0][0].bounds;
this.backBufferLonLat={lon:topLeftTileBounds.left,lat:topLeftTileBounds.top};
this.backBufferResolution=this.gridResolution
}var style=backBuffer.style;
var ratio=this.backBufferResolution/resolution;
style.width=100*ratio+"%";
style.height=100*ratio+"%";
var position=this.getViewPortPxFromLonLat(this.backBufferLonLat,resolution);
var leftOffset=parseInt(this.map.layerContainerDiv.style.left,10);
var topOffset=parseInt(this.map.layerContainerDiv.style.top,10);
backBuffer.style.left=Math.round(position.x-leftOffset)+"%";
backBuffer.style.top=Math.round(position.y-topOffset)+"%"
},createBackBuffer:function(){var backBuffer;
if(this.grid.length>0){backBuffer=document.createElement("div");
backBuffer.id=this.div.id+"_bb";
backBuffer.className="olBackBuffer";
backBuffer.style.position="absolute";
backBuffer.style.width="100%";
backBuffer.style.height="100%";
for(var i=0,lenI=this.grid.length;
i<lenI;
i++){for(var j=0,lenJ=this.grid[i].length;
j<lenJ;
j++){var tile=this.grid[i][j].createBackBuffer();
if(!tile){continue
}tile.style.top=(i*this.tileSize.h)+"%";
tile.style.left=(j*this.tileSize.w)+"%";
backBuffer.appendChild(tile)
}}}return backBuffer
},removeBackBuffer:function(){if(this.backBuffer){this.div.removeChild(this.backBuffer);
this.backBuffer=null;
this.backBufferResolution=null;
if(this.backBufferTimerId!==null){window.clearTimeout(this.backBufferTimerId);
this.backBufferTimerId=null
}}},moveByPx:function(dx,dy){if(!this.singleTile){this.moveGriddedTiles()
}},setTileSize:function(size){if(this.singleTile){size=this.map.getSize();
size.h=parseInt(size.h*this.ratio);
size.w=parseInt(size.w*this.ratio)
}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[size])
},getTilesBounds:function(){var bounds=null;
var length=this.grid.length;
if(length){var bottomLeftTileBounds=this.grid[length-1][0].bounds,width=this.grid[0].length*bottomLeftTileBounds.getWidth(),height=this.grid.length*bottomLeftTileBounds.getHeight();
bounds=new OpenLayers.Bounds(bottomLeftTileBounds.left,bottomLeftTileBounds.bottom,bottomLeftTileBounds.left+width,bottomLeftTileBounds.bottom+height)
}return bounds
},initSingleTile:function(bounds){this.clearTileQueue();
var center=bounds.getCenterLonLat();
var tileWidth=bounds.getWidth()*this.ratio;
var tileHeight=bounds.getHeight()*this.ratio;
var tileBounds=new OpenLayers.Bounds(center.lon-(tileWidth/2),center.lat-(tileHeight/2),center.lon+(tileWidth/2),center.lat+(tileHeight/2));
var px=this.map.getLayerPxFromLonLat({lon:tileBounds.left,lat:tileBounds.top});
if(!this.grid.length){this.grid[0]=[]
}var tile=this.grid[0][0];
if(!tile){tile=this.addTile(tileBounds,px);
this.addTileMonitoringHooks(tile);
tile.draw();
this.grid[0][0]=tile
}else{tile.moveTo(tileBounds,px)
}this.removeExcessTiles(1,1);
this.gridResolution=this.getServerResolution()
},calculateGridLayout:function(bounds,origin,resolution){var tilelon=resolution*this.tileSize.w;
var tilelat=resolution*this.tileSize.h;
var offsetlon=bounds.left-origin.lon;
var tilecol=Math.floor(offsetlon/tilelon)-this.buffer;
var tilecolremain=offsetlon/tilelon-tilecol;
var tileoffsetx=-tilecolremain*this.tileSize.w;
var tileoffsetlon=origin.lon+tilecol*tilelon;
var offsetlat=bounds.top-(origin.lat+tilelat);
var tilerow=Math.ceil(offsetlat/tilelat)+this.buffer;
var tilerowremain=tilerow-offsetlat/tilelat;
var tileoffsety=-tilerowremain*this.tileSize.h;
var tileoffsetlat=origin.lat+tilerow*tilelat;
return{tilelon:tilelon,tilelat:tilelat,tileoffsetlon:tileoffsetlon,tileoffsetlat:tileoffsetlat,tileoffsetx:tileoffsetx,tileoffsety:tileoffsety}
},getTileOrigin:function(){var origin=this.tileOrigin;
if(!origin){var extent=this.getMaxExtent();
var edges=({tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]})[this.tileOriginCorner];
origin=new OpenLayers.LonLat(extent[edges[0]],extent[edges[1]])
}return origin
},initGriddedTiles:function(bounds){this.clearTileQueue();
var viewSize=this.map.getSize();
var minRows=Math.ceil(viewSize.h/this.tileSize.h)+Math.max(1,2*this.buffer);
var minCols=Math.ceil(viewSize.w/this.tileSize.w)+Math.max(1,2*this.buffer);
var origin=this.getTileOrigin();
var resolution=this.getServerResolution();
var tileLayout=this.calculateGridLayout(bounds,origin,resolution);
var tileoffsetx=Math.round(tileLayout.tileoffsetx);
var tileoffsety=Math.round(tileLayout.tileoffsety);
var tileoffsetlon=tileLayout.tileoffsetlon;
var tileoffsetlat=tileLayout.tileoffsetlat;
var tilelon=tileLayout.tilelon;
var tilelat=tileLayout.tilelat;
var startX=tileoffsetx;
var startLon=tileoffsetlon;
var rowidx=0;
var layerContainerDivLeft=parseInt(this.map.layerContainerDiv.style.left);
var layerContainerDivTop=parseInt(this.map.layerContainerDiv.style.top);
var tileData=[],center=this.map.getCenter();
do{var row=this.grid[rowidx++];
if(!row){row=[];
this.grid.push(row)
}tileoffsetlon=startLon;
tileoffsetx=startX;
var colidx=0;
do{var tileBounds=new OpenLayers.Bounds(tileoffsetlon,tileoffsetlat,tileoffsetlon+tilelon,tileoffsetlat+tilelat);
var x=tileoffsetx;
x-=layerContainerDivLeft;
var y=tileoffsety;
y-=layerContainerDivTop;
var px=new OpenLayers.Pixel(x,y);
var tile=row[colidx++];
if(!tile){tile=this.addTile(tileBounds,px);
this.addTileMonitoringHooks(tile);
row.push(tile)
}else{tile.moveTo(tileBounds,px,false)
}var tileCenter=tileBounds.getCenterLonLat();
tileData.push({tile:tile,distance:Math.pow(tileCenter.lon-center.lon,2)+Math.pow(tileCenter.lat-center.lat,2)});
tileoffsetlon+=tilelon;
tileoffsetx+=this.tileSize.w
}while((tileoffsetlon<=bounds.right+tilelon*this.buffer)||colidx<minCols);
tileoffsetlat-=tilelat;
tileoffsety+=this.tileSize.h
}while((tileoffsetlat>=bounds.bottom-tilelat*this.buffer)||rowidx<minRows);
this.removeExcessTiles(rowidx,colidx);
this.gridResolution=this.getServerResolution();
tileData.sort(function(a,b){return a.distance-b.distance
});
for(var i=0,ii=tileData.length;
i<ii;
++i){tileData[i].tile.draw()
}},getMaxExtent:function(){return this.maxExtent
},addTile:function(bounds,position){var tile=new this.tileClass(this,position,bounds,null,this.tileSize,this.tileOptions);
tile.events.register("beforedraw",this,this.queueTileDraw);
return tile
},addTileMonitoringHooks:function(tile){tile.onLoadStart=function(){if(this.loading===false){this.loading=true;
this.events.triggerEvent("loadstart")
}this.events.triggerEvent("tileloadstart",{tile:tile});
this.numLoadingTiles++
};
tile.onLoadEnd=function(){this.numLoadingTiles--;
this.events.triggerEvent("tileloaded",{tile:tile});
if(this.tileQueue.length===0&&this.numLoadingTiles===0){this.loading=false;
this.events.triggerEvent("loadend");
if(this.backBuffer){this.backBufferTimerId=window.setTimeout(OpenLayers.Function.bind(this.removeBackBuffer,this),this.removeBackBufferDelay)
}}};
tile.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:tile})
};
tile.events.on({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,loaderror:tile.onLoadError,scope:this})
},removeTileMonitoringHooks:function(tile){tile.unload();
tile.events.un({loadstart:tile.onLoadStart,loadend:tile.onLoadEnd,unload:tile.onLoadEnd,loaderror:tile.onLoadError,scope:this})
},moveGriddedTiles:function(deferred){if(!deferred&&!OpenLayers.Animation.isNative){if(this.moveTimerId!=null){window.clearTimeout(this.moveTimerId)
}this.moveTimerId=window.setTimeout(this.deferMoveGriddedTiles,this.tileLoadingDelay);
return
}var buffer=this.buffer||1;
var scale=this.getResolutionScale();
while(true){var tlViewPort={x:(this.grid[0][0].position.x*scale)+parseInt(this.div.style.left,10)+parseInt(this.map.layerContainerDiv.style.left),y:(this.grid[0][0].position.y*scale)+parseInt(this.div.style.top,10)+parseInt(this.map.layerContainerDiv.style.top)};
var tileSize={w:this.tileSize.w*scale,h:this.tileSize.h*scale};
if(tlViewPort.x>-tileSize.w*(buffer-1)){this.shiftColumn(true)
}else{if(tlViewPort.x<-tileSize.w*buffer){this.shiftColumn(false)
}else{if(tlViewPort.y>-tileSize.h*(buffer-1)){this.shiftRow(true)
}else{if(tlViewPort.y<-tileSize.h*buffer){this.shiftRow(false)
}else{break
}}}}}},shiftRow:function(prepend){var modelRowIndex=(prepend)?0:(this.grid.length-1);
var grid=this.grid;
var modelRow=grid[modelRowIndex];
var resolution=this.getServerResolution();
var deltaY=(prepend)?-this.tileSize.h:this.tileSize.h;
var deltaLat=resolution*-deltaY;
var row=(prepend)?grid.pop():grid.shift();
for(var i=0,len=modelRow.length;
i<len;
i++){var modelTile=modelRow[i];
var bounds=modelTile.bounds.clone();
var position=modelTile.position.clone();
bounds.bottom=bounds.bottom+deltaLat;
bounds.top=bounds.top+deltaLat;
position.y=position.y+deltaY;
row[i].moveTo(bounds,position)
}if(prepend){grid.unshift(row)
}else{grid.push(row)
}},shiftColumn:function(prepend){var deltaX=(prepend)?-this.tileSize.w:this.tileSize.w;
var resolution=this.getServerResolution();
var deltaLon=resolution*deltaX;
for(var i=0,len=this.grid.length;
i<len;
i++){var row=this.grid[i];
var modelTileIndex=(prepend)?0:(row.length-1);
var modelTile=row[modelTileIndex];
var bounds=modelTile.bounds.clone();
var position=modelTile.position.clone();
bounds.left=bounds.left+deltaLon;
bounds.right=bounds.right+deltaLon;
position.x=position.x+deltaX;
var tile=prepend?this.grid[i].pop():this.grid[i].shift();
tile.moveTo(bounds,position);
if(prepend){row.unshift(tile)
}else{row.push(tile)
}}},removeExcessTiles:function(rows,columns){var i,l;
while(this.grid.length>rows){var row=this.grid.pop();
for(i=0,l=row.length;
i<l;
i++){var tile=row[i];
this.destroyTile(tile)
}}for(i=0,l=this.grid.length;
i<l;
i++){while(this.grid[i].length>columns){var row=this.grid[i];
var tile=row.pop();
this.destroyTile(tile)
}}},onMapResize:function(){if(this.singleTile){this.clearGrid();
this.setTileSize()
}},getTileBounds:function(viewPortPx){var maxExtent=this.maxExtent;
var resolution=this.getResolution();
var tileMapWidth=resolution*this.tileSize.w;
var tileMapHeight=resolution*this.tileSize.h;
var mapPoint=this.getLonLatFromViewPortPx(viewPortPx);
var tileLeft=maxExtent.left+(tileMapWidth*Math.floor((mapPoint.lon-maxExtent.left)/tileMapWidth));
var tileBottom=maxExtent.bottom+(tileMapHeight*Math.floor((mapPoint.lat-maxExtent.bottom)/tileMapHeight));
return new OpenLayers.Bounds(tileLeft,tileBottom,tileLeft+tileMapWidth,tileBottom+tileMapHeight)
},CLASS_NAME:"OpenLayers.Layer.Grid"});
OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,useHttpTile:false,singleTile:false,useOverlay:false,useAsyncOverlay:true,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(name,url,params,options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);
if(options==null||options.isBaseLayer==null){this.isBaseLayer=((this.transparent!="true")&&(this.transparent!=true))
}if(options&&options.useOverlay!=null){this.useOverlay=options.useOverlay
}if(this.singleTile){if(this.useOverlay){OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS);
if(!this.useAsyncOverlay){this.params.version="1.0.0"
}}else{OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS)
}}else{if(this.useHttpTile){OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS)
}else{OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS)
}this.setTileSize(this.defaultSize)
}},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getURL:function(bounds){var url;
var center=bounds.getCenterLonLat();
var mapSize=this.map.getSize();
if(this.singleTile){var params={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:mapSize.h*this.ratio,setdisplaywidth:mapSize.w*this.ratio,setviewcenterx:center.lon,setviewcentery:center.lat,setviewscale:this.map.getScale()};
if(this.useOverlay&&!this.useAsyncOverlay){var getVisParams={};
getVisParams=OpenLayers.Util.extend(getVisParams,params);
getVisParams.operation="GETVISIBLEMAPEXTENT";
getVisParams.version="1.0.0";
getVisParams.session=this.params.session;
getVisParams.mapName=this.params.mapName;
getVisParams.format="text/xml";
url=this.getFullRequestString(getVisParams);
OpenLayers.Request.GET({url:url,async:false})
}url=this.getFullRequestString(params)
}else{var currentRes=this.map.getResolution();
var colidx=Math.floor((bounds.left-this.maxExtent.left)/currentRes);
colidx=Math.round(colidx/this.tileSize.w);
var rowidx=Math.floor((this.maxExtent.top-bounds.top)/currentRes);
rowidx=Math.round(rowidx/this.tileSize.h);
if(this.useHttpTile){url=this.getImageFilePath({tilecol:colidx,tilerow:rowidx,scaleindex:this.resolutions.length-this.map.zoom-1})
}else{url=this.getFullRequestString({tilecol:colidx,tilerow:rowidx,scaleindex:this.resolutions.length-this.map.zoom-1})
}}return url
},getFullRequestString:function(newParams,altUrl){var url=(altUrl==null)?this.url:altUrl;
if(typeof url=="object"){url=url[Math.floor(Math.random()*url.length)]
}var requestString=url;
var allParams=OpenLayers.Util.extend({},this.params);
allParams=OpenLayers.Util.extend(allParams,newParams);
var urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));
for(var key in allParams){if(key.toUpperCase() in urlParams){delete allParams[key]
}}var paramsString=OpenLayers.Util.getParameterString(allParams);
paramsString=paramsString.replace(/,/g,"+");
if(paramsString!=""){var lastServerChar=url.charAt(url.length-1);
if((lastServerChar=="&")||(lastServerChar=="?")){requestString+=paramsString
}else{if(url.indexOf("?")==-1){requestString+="?"+paramsString
}else{requestString+="&"+paramsString
}}}return requestString
},getImageFilePath:function(newParams,altUrl){var url=(altUrl==null)?this.url:altUrl;
if(typeof url=="object"){url=url[Math.floor(Math.random()*url.length)]
}var requestString=url;
var tileRowGroup="";
var tileColGroup="";
if(newParams.tilerow<0){tileRowGroup="-"
}if(newParams.tilerow==0){tileRowGroup+="0"
}else{tileRowGroup+=Math.floor(Math.abs(newParams.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder
}if(newParams.tilecol<0){tileColGroup="-"
}if(newParams.tilecol==0){tileColGroup+="0"
}else{tileColGroup+=Math.floor(Math.abs(newParams.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder
}var tilePath="/S"+Math.floor(newParams.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+tileRowGroup+"/C"+tileColGroup+"/"+(newParams.tilerow%this.params.tileRowsPerFolder)+"_"+(newParams.tilecol%this.params.tileColumnsPerFolder)+"."+this.params.format;
if(this.params.querystring){tilePath+="?"+this.params.querystring
}requestString+=tilePath;
return requestString
},calculateGridLayout:function(bounds,origin,resolution){var tilelon=resolution*this.tileSize.w;
var tilelat=resolution*this.tileSize.h;
var offsetlon=bounds.left-origin.lon;
var tilecol=Math.floor(offsetlon/tilelon)-this.buffer;
var tilecolremain=offsetlon/tilelon-tilecol;
var tileoffsetx=-tilecolremain*this.tileSize.w;
var tileoffsetlon=origin.lon+tilecol*tilelon;
var offsetlat=origin.lat-bounds.top+tilelat;
var tilerow=Math.floor(offsetlat/tilelat)-this.buffer;
var tilerowremain=tilerow-offsetlat/tilelat;
var tileoffsety=tilerowremain*this.tileSize.h;
var tileoffsetlat=origin.lat-tilelat*tilerow;
return{tilelon:tilelon,tilelat:tilelat,tileoffsetlon:tileoffsetlon,tileoffsetlat:tileoffsetlat,tileoffsetx:tileoffsetx,tileoffsety:tileoffsety}
},CLASS_NAME:"OpenLayers.Layer.MapGuide"});
OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(name,url,params,options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);
this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS);
if(options==null||options.isBaseLayer==null){this.isBaseLayer=((this.params.transparent!="true")&&(this.params.transparent!=true))
}},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var extent=[bounds.left,bounds.bottom,bounds.right,bounds.top];
var imageSize=this.getImageSize();
var url=this.getFullRequestString({mapext:extent,imgext:extent,map_size:[imageSize.w,imageSize.h],imgx:imageSize.w/2,imgy:imageSize.h/2,imgxy:[imageSize.w,imageSize.h]});
return url
},getFullRequestString:function(newParams,altUrl){var url=(altUrl==null)?this.url:altUrl;
var allParams=OpenLayers.Util.extend({},this.params);
allParams=OpenLayers.Util.extend(allParams,newParams);
var paramsString=OpenLayers.Util.getParameterString(allParams);
if(OpenLayers.Util.isArray(url)){url=this.selectUrl(paramsString,url)
}var urlParams=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(url));
for(var key in allParams){if(key.toUpperCase() in urlParams){delete allParams[key]
}}paramsString=OpenLayers.Util.getParameterString(allParams);
var requestString=url;
paramsString=paramsString.replace(/,/g,"+");
if(paramsString!=""){var lastServerChar=url.charAt(url.length-1);
if((lastServerChar=="&")||(lastServerChar=="?")){requestString+=paramsString
}else{if(url.indexOf("?")==-1){requestString+="?"+paramsString
}else{requestString+="&"+paramsString
}}}return requestString
},CLASS_NAME:"OpenLayers.Layer.MapServer"});
OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(name,url,params,options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments);
this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var mapRes=this.map.getResolution();
var scale=Math.round((this.map.getScale()*10000))/10000;
var pX=Math.round(bounds.left/mapRes);
var pY=-Math.round(bounds.top/mapRes);
return this.getFullRequestString({t:pY,l:pX,s:scale})
},calculateGridLayout:function(bounds,origin,resolution){var tilelon=resolution*this.tileSize.w;
var tilelat=resolution*this.tileSize.h;
var offsetlon=bounds.left;
var tilecol=Math.floor(offsetlon/tilelon)-this.buffer;
var tilecolremain=offsetlon/tilelon-tilecol;
var tileoffsetx=-tilecolremain*this.tileSize.w;
var tileoffsetlon=tilecol*tilelon;
var offsetlat=bounds.top;
var tilerow=Math.ceil(offsetlat/tilelat)+this.buffer;
var tilerowremain=tilerow-offsetlat/tilelat;
var tileoffsety=-(tilerowremain+1)*this.tileSize.h;
var tileoffsetlat=tilerow*tilelat;
return{tilelon:tilelon,tilelat:tilelat,tileoffsetlon:tileoffsetlon,tileoffsetlat:tileoffsetlat,tileoffsetx:tileoffsetx,tileoffsety:tileoffsety}
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
if(this.tileSize!=null){obj.tileSize=this.tileSize.clone()
}obj.grid=[];
return obj
},getTileBounds:function(viewPortPx){var resolution=this.getResolution();
var tileMapWidth=resolution*this.tileSize.w;
var tileMapHeight=resolution*this.tileSize.h;
var mapPoint=this.getLonLatFromViewPortPx(viewPortPx);
var tileLeft=tileMapWidth*Math.floor(mapPoint.lon/tileMapWidth);
var tileBottom=tileMapHeight*Math.floor(mapPoint.lat/tileMapHeight);
return new OpenLayers.Bounds(tileLeft,tileBottom,tileLeft+tileMapWidth,tileBottom+tileMapHeight)
},CLASS_NAME:"OpenLayers.Layer.KaMap"});
OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(name,url,params,options){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments);
this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var mapRes=this.map.getResolution();
var scale=Math.round((this.map.getScale()*10000))/10000;
var pX=Math.round(bounds.left/mapRes);
var pY=-Math.round(bounds.top/mapRes);
var metaX=Math.floor(pX/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w;
var metaY=Math.floor(pY/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h;
var components=["/",this.params.map,"/",scale,"/",this.params.g.replace(/\s/g,"_"),"/def/t",metaY,"/l",metaX,"/t",pY,"l",pX,".",this.extension];
var url=this.url;
if(OpenLayers.Util.isArray(url)){url=this.selectUrl(components.join(""),url)
}return url+components.join("")
},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});
OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,markers:null,drawn:false,initialize:function(name,options){OpenLayers.Layer.prototype.initialize.apply(this,arguments);
this.markers=[]
},destroy:function(){this.clearMarkers();
this.markers=null;
OpenLayers.Layer.prototype.destroy.apply(this,arguments)
},setOpacity:function(opacity){if(opacity!=this.opacity){this.opacity=opacity;
for(var i=0,len=this.markers.length;
i<len;
i++){this.markers[i].setOpacity(this.opacity)
}}},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);
if(zoomChanged||!this.drawn){for(var i=0,len=this.markers.length;
i<len;
i++){this.drawMarker(this.markers[i])
}this.drawn=true
}},addMarker:function(marker){this.markers.push(marker);
if(this.opacity<1){marker.setOpacity(this.opacity)
}if(this.map&&this.map.getExtent()){marker.map=this.map;
this.drawMarker(marker)
}},removeMarker:function(marker){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,marker);
marker.erase()
}},clearMarkers:function(){if(this.markers!=null){while(this.markers.length>0){this.removeMarker(this.markers[0])
}}},drawMarker:function(marker){var px=this.map.getLayerPxFromLonLat(marker.lonlat);
if(px==null){marker.display(false)
}else{if(!marker.isDrawn()){var markerImg=marker.draw(px);
this.div.appendChild(markerImg)
}else{if(marker.icon){marker.icon.moveTo(px)
}}}},getDataExtent:function(){var maxExtent=null;
if(this.markers&&(this.markers.length>0)){var maxExtent=new OpenLayers.Bounds();
for(var i=0,len=this.markers.length;
i<len;
i++){var marker=this.markers[i];
maxExtent.extend(marker.lonlat)
}}return maxExtent
},CLASS_NAME:"OpenLayers.Layer.Markers"});
OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(name,options){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments);
this.features=[]
},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);
this.clearFeatures();
this.features=null
},loadText:function(){if(!this.loaded){if(this.location!=null){var onFail=function(e){this.events.triggerEvent("loadend")
};
this.events.triggerEvent("loadstart");
OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:onFail,scope:this});
this.loaded=true
}}},moveTo:function(bounds,zoomChanged,minor){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);
if(this.visibility&&!this.loaded){this.loadText()
}},parseData:function(ajaxRequest){var text=ajaxRequest.responseText;
var options={};
OpenLayers.Util.extend(options,this.formatOptions);
if(this.map&&!this.projection.equals(this.map.getProjectionObject())){options.externalProjection=this.projection;
options.internalProjection=this.map.getProjectionObject()
}var parser=new OpenLayers.Format.Text(options);
var features=parser.read(text);
for(var i=0,len=features.length;
i<len;
i++){var data={};
var feature=features[i];
var location;
var iconSize,iconOffset;
location=new OpenLayers.LonLat(feature.geometry.x,feature.geometry.y);
if(feature.style.graphicWidth&&feature.style.graphicHeight){iconSize=new OpenLayers.Size(feature.style.graphicWidth,feature.style.graphicHeight)
}if(feature.style.graphicXOffset!==undefined&&feature.style.graphicYOffset!==undefined){iconOffset=new OpenLayers.Pixel(feature.style.graphicXOffset,feature.style.graphicYOffset)
}if(feature.style.externalGraphic!=null){data.icon=new OpenLayers.Icon(feature.style.externalGraphic,iconSize,iconOffset)
}else{data.icon=OpenLayers.Marker.defaultIcon();
if(iconSize!=null){data.icon.setSize(iconSize)
}}if((feature.attributes.title!=null)&&(feature.attributes.description!=null)){data.popupContentHTML="<h2>"+feature.attributes.title+"</h2><p>"+feature.attributes.description+"</p>"
}data.overflow=feature.attributes.overflow||"auto";
var markerFeature=new OpenLayers.Feature(this,location,data);
this.features.push(markerFeature);
var marker=markerFeature.createMarker();
if((feature.attributes.title!=null)&&(feature.attributes.description!=null)){marker.events.register("click",markerFeature,this.markerClick)
}this.addMarker(marker)
}this.events.triggerEvent("loadend")
},markerClick:function(evt){var sameMarkerClicked=(this==this.layer.selectedFeature);
this.layer.selectedFeature=(!sameMarkerClicked)?this:null;
for(var i=0,len=this.layer.map.popups.length;
i<len;
i++){this.layer.map.removePopup(this.layer.map.popups[i])
}if(!sameMarkerClicked){this.layer.map.addPopup(this.createPopup())
}OpenLayers.Event.stop(evt)
},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var feature=this.features[0];
OpenLayers.Util.removeItem(this.features,feature);
feature.destroy()
}}},CLASS_NAME:"OpenLayers.Layer.Text"});
OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:true,lzd:null,zoomLevels:null,initialize:function(name,url,lzd,zoomLevels,params,options){this.lzd=lzd;
this.zoomLevels=zoomLevels;
var newArguments=[];
newArguments.push(name,url,params,options);
OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments);
this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)
},getZoom:function(){var zoom=this.map.getZoom();
var extent=this.map.getMaxExtent();
zoom=zoom-Math.log(this.maxResolution/(this.lzd/512))/Math.log(2);
return zoom
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var zoom=this.getZoom();
var extent=this.map.getMaxExtent();
var deg=this.lzd/Math.pow(2,this.getZoom());
var x=Math.floor((bounds.left-extent.left)/deg);
var y=Math.floor((bounds.bottom-extent.bottom)/deg);
if(this.map.getResolution()<=(this.lzd/512)&&this.getZoom()<=this.zoomLevels){return this.getFullRequestString({L:zoom,X:x,Y:y})
}else{return OpenLayers.Util.getImageLocation("blank.gif")
}},CLASS_NAME:"OpenLayers.Layer.WorldWind"});
OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:true,initialize:function(name,url,params,options){var newArguments=[];
params=OpenLayers.Util.upperCaseObject(params);
newArguments.push(name,url,params,options);
OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments);
OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));
if(this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((options==null)||(!options.isBaseLayer)){this.isBaseLayer=false
}if(this.params.FORMAT=="jpg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"
}}},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var projWords=this.projection.getCode().split(":");
var srid=projWords[projWords.length-1];
var imageSize=this.getImageSize();
var newParams={BBOX:bounds.toBBOX(),SIZE:imageSize.w+","+imageSize.h,F:"image",BBOXSR:srid,IMAGESR:srid};
if(this.layerDefs){var layerDefStrList=[];
var layerID;
for(layerID in this.layerDefs){if(this.layerDefs.hasOwnProperty(layerID)){if(this.layerDefs[layerID]){layerDefStrList.push(layerID);
layerDefStrList.push(":");
layerDefStrList.push(this.layerDefs[layerID]);
layerDefStrList.push(";")
}}}if(layerDefStrList.length>0){newParams.LAYERDEFS=layerDefStrList.join("")
}}var requestString=this.getFullRequestString(newParams);
return requestString
},setLayerFilter:function(id,queryDef){if(!this.layerDefs){this.layerDefs={}
}if(queryDef){this.layerDefs[id]=queryDef
}else{delete this.layerDefs[id]
}},clearLayerFilter:function(id){if(id){delete this.layerDefs[id]
}else{delete this.layerDefs
}},mergeNewParams:function(newParams){var upperParams=OpenLayers.Util.upperCaseObject(newParams);
var newArguments=[upperParams];
return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,newArguments)
},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"});
OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:true,encodeBBOX:false,noMagic:false,yx:{},initialize:function(name,url,params,options){var newArguments=[];
params=OpenLayers.Util.upperCaseObject(params);
if(parseFloat(params.VERSION)>=1.3&&!params.EXCEPTIONS){params.EXCEPTIONS="INIMAGE"
}newArguments.push(name,url,params,options);
OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments);
OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));
if(!this.noMagic&&this.params.TRANSPARENT&&this.params.TRANSPARENT.toString().toLowerCase()=="true"){if((options==null)||(!options.isBaseLayer)){this.isBaseLayer=false
}if(this.params.FORMAT=="image/jpeg"){this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"
}}},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},reverseAxisOrder:function(){var projCode=this.projection.getCode();
return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[projCode]||(OpenLayers.Projection.defaults[projCode]&&OpenLayers.Projection.defaults[projCode].yx))
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var imageSize=this.getImageSize();
var newParams={};
var reverseAxisOrder=this.reverseAxisOrder();
newParams.BBOX=this.encodeBBOX?bounds.toBBOX(null,reverseAxisOrder):bounds.toArray(reverseAxisOrder);
newParams.WIDTH=imageSize.w;
newParams.HEIGHT=imageSize.h;
var requestString=this.getFullRequestString(newParams);
return requestString
},mergeNewParams:function(newParams){var upperParams=OpenLayers.Util.upperCaseObject(newParams);
var newArguments=[upperParams];
return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,newArguments)
},getFullRequestString:function(newParams,altUrl){var mapProjection=this.map.getProjectionObject();
var projectionCode=this.projection&&this.projection.equals(mapProjection)?this.projection.getCode():mapProjection.getCode();
var value=(projectionCode=="none")?null:projectionCode;
if(parseFloat(this.params.VERSION)>=1.3){this.params.CRS=value
}else{this.params.SRS=value
}if(typeof this.params.TRANSPARENT=="boolean"){newParams.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"
}return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Layer.WMS"});
OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(config){var required={url:true,layer:true,style:true,matrixSet:true};
for(var prop in required){if(!(prop in config)){throw new Error("Missing property '"+prop+"' in layer configuration.")
}}config.params=OpenLayers.Util.upperCaseObject(config.params);
var args=[config.name,config.url,config.params,config];
OpenLayers.Layer.Grid.prototype.initialize.apply(this,args);
if(!this.formatSuffix){this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()
}if(this.matrixIds){var len=this.matrixIds.length;
if(len&&typeof this.matrixIds[0]==="string"){var ids=this.matrixIds;
this.matrixIds=new Array(len);
for(var i=0;
i<len;
++i){this.matrixIds[i]={identifier:ids[i]}
}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);
this.updateMatrixProperties()
},updateMatrixProperties:function(){this.matrix=this.getMatrix();
if(this.matrix){if(this.matrix.topLeftCorner){this.tileOrigin=this.matrix.topLeftCorner
}if(this.matrix.tileWidth&&this.matrix.tileHeight){this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)
}if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)
}if(!this.tileFullExtent){this.tileFullExtent=this.maxExtent
}}},moveTo:function(bounds,zoomChanged,dragging){if(zoomChanged||!this.matrix){this.updateMatrixProperties()
}return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.WMTS(this.options)
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getIdentifier:function(){return this.getServerZoom()
},getMatrix:function(){var matrix;
if(!this.matrixIds||this.matrixIds.length===0){matrix={identifier:this.getIdentifier()}
}else{if("scaleDenominator" in this.matrixIds[0]){var denom=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/0.00028;
var diff=Number.POSITIVE_INFINITY;
var delta;
for(var i=0,ii=this.matrixIds.length;
i<ii;
++i){delta=Math.abs(1-(this.matrixIds[i].scaleDenominator/denom));
if(delta<diff){diff=delta;
matrix=this.matrixIds[i]
}}}else{matrix=this.matrixIds[this.getIdentifier()]
}}return matrix
},getTileInfo:function(loc){var res=this.getServerResolution();
var fx=(loc.lon-this.tileOrigin.lon)/(res*this.tileSize.w);
var fy=(this.tileOrigin.lat-loc.lat)/(res*this.tileSize.h);
var col=Math.floor(fx);
var row=Math.floor(fy);
return{col:col,row:row,i:Math.floor((fx-col)*this.tileSize.w),j:Math.floor((fy-row)*this.tileSize.h)}
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var url="";
if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(bounds)){var center=bounds.getCenterLonLat();
var info=this.getTileInfo(center);
var matrixId=this.matrix.identifier;
var dimensions=this.dimensions,params;
if(this.requestEncoding.toUpperCase()==="REST"){params=this.params;
if(typeof this.url==="string"&&this.url.indexOf("{")!==-1){var template=this.url.replace(/\{/g,"${");
var context={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:info.row,TileCol:info.col};
if(dimensions){var dimension,i;
for(i=dimensions.length-1;
i>=0;
--i){dimension=dimensions[i];
context[dimension]=params[dimension.toUpperCase()]
}}url=OpenLayers.String.format(template,context)
}else{var path=this.version+"/"+this.layer+"/"+this.style+"/";
if(dimensions){for(var i=0;
i<dimensions.length;
i++){if(params[dimensions[i]]){path=path+params[dimensions[i]]+"/"
}}}path=path+this.matrixSet+"/"+this.matrix.identifier+"/"+info.row+"/"+info.col+"."+this.formatSuffix;
if(OpenLayers.Util.isArray(this.url)){url=this.selectUrl(path,this.url)
}else{url=this.url
}if(!url.match(/\/$/)){url=url+"/"
}url=url+path
}}else{if(this.requestEncoding.toUpperCase()==="KVP"){params={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:info.row,TILECOL:info.col,FORMAT:this.format};
url=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[params])
}}}return url
},mergeNewParams:function(newParams){if(this.requestEncoding.toUpperCase()==="KVP"){return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(newParams)])
}},CLASS_NAME:"OpenLayers.Layer.WMTS"});
OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:true,name:"ArcIMS",isBaseLayer:true,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:true,async:true,name:"ArcIMS"},initialize:function(name,url,options){this.tileSize=new OpenLayers.Size(512,512);
this.params=OpenLayers.Util.applyDefaults({ServiceName:options.serviceName},this.DEFAULT_PARAMS);
this.options=OpenLayers.Util.applyDefaults(options,this.DEFAULT_OPTIONS);
OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,this.params,options]);
if(this.transparent){if(!this.isBaseLayer){this.isBaseLayer=false
}if(this.format=="image/jpeg"){this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"
}}if(this.options.layers===null){this.options.layers=[]
}},getURL:function(bounds){var url="";
bounds=this.adjustBounds(bounds);
var axlReq=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:bounds.toArray(),tileSize:this.tileSize}));
var req=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:axlReq.write(),async:false});
if(req!=null){var doc=req.responseXML;
if(!doc||!doc.documentElement){doc=req.responseText
}var axlResp=new OpenLayers.Format.ArcXML();
var arcxml=axlResp.read(doc);
url=this.getUrlOrImage(arcxml.image.output)
}return url
},getURLasync:function(bounds,callback,scope){bounds=this.adjustBounds(bounds);
var axlReq=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:bounds.toArray(),tileSize:this.tileSize}));
OpenLayers.Request.POST({url:this.getFullRequestString(),async:true,data:axlReq.write(),callback:function(req){var doc=req.responseXML;
if(!doc||!doc.documentElement){doc=req.responseText
}var axlResp=new OpenLayers.Format.ArcXML();
var arcxml=axlResp.read(doc);
callback.call(scope,this.getUrlOrImage(arcxml.image.output))
},scope:this})
},getUrlOrImage:function(output){var ret="";
if(output.url){ret=output.url
}else{if(output.data){ret="data:image/"+output.type+";base64,"+output.data
}}return ret
},setLayerQuery:function(id,querydef){for(var lyr=0;
lyr<this.options.layers.length;
lyr++){if(id==this.options.layers[lyr].id){this.options.layers[lyr].query=querydef;
return
}}this.options.layers.push({id:id,visible:true,query:querydef})
},getFeatureInfo:function(geometry,layer,options){var buffer=options.buffer||1;
var callback=options.callback||function(){};
var scope=options.scope||window;
var requestOptions={};
OpenLayers.Util.extend(requestOptions,this.options);
requestOptions.requesttype="feature";
if(geometry instanceof OpenLayers.LonLat){requestOptions.polygon=null;
requestOptions.envelope=[geometry.lon-buffer,geometry.lat-buffer,geometry.lon+buffer,geometry.lat+buffer]
}else{if(geometry instanceof OpenLayers.Geometry.Polygon){requestOptions.envelope=null;
requestOptions.polygon=geometry
}}var arcxml=new OpenLayers.Format.ArcXML(requestOptions);
OpenLayers.Util.extend(arcxml.request.get_feature,options);
arcxml.request.get_feature.layer=layer.id;
if(typeof layer.query.accuracy=="number"){arcxml.request.get_feature.query.accuracy=layer.query.accuracy
}else{var mapCenter=this.map.getCenter();
var viewPx=this.map.getViewPortPxFromLonLat(mapCenter);
viewPx.x++;
var mapOffCenter=this.map.getLonLatFromPixel(viewPx);
arcxml.request.get_feature.query.accuracy=mapOffCenter.lon-mapCenter.lon
}arcxml.request.get_feature.query.where=layer.query.where;
arcxml.request.get_feature.query.spatialfilter.relation="area_intersection";
OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:arcxml.write(),callback:function(request){var response=arcxml.parseResponse(request.responseText);
if(!arcxml.iserror()){callback.call(scope,response.features)
}else{callback.call(scope,null)
}}})
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},CLASS_NAME:"OpenLayers.Layer.ArcIMS"});
OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:true,initialize:function(name,location,options){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[name,options]);
this.location=location;
this.features=[]
},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments);
this.clearFeatures();
this.features=null
},loadRSS:function(){if(!this.loaded){this.events.triggerEvent("loadstart");
OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this});
this.loaded=true
}},moveTo:function(bounds,zoomChanged,minor){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments);
if(this.visibility&&!this.loaded){this.loadRSS()
}},parseData:function(ajaxRequest){var doc=ajaxRequest.responseXML;
if(!doc||!doc.documentElement){doc=OpenLayers.Format.XML.prototype.read(ajaxRequest.responseText)
}if(this.useFeedTitle){var name=null;
try{name=doc.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue
}catch(e){name=doc.getElementsByTagName("title")[0].firstChild.nodeValue
}if(name){this.setName(name)
}}var options={};
OpenLayers.Util.extend(options,this.formatOptions);
if(this.map&&!this.projection.equals(this.map.getProjectionObject())){options.externalProjection=this.projection;
options.internalProjection=this.map.getProjectionObject()
}var format=new OpenLayers.Format.GeoRSS(options);
var features=format.read(doc);
for(var i=0,len=features.length;
i<len;
i++){var data={};
var feature=features[i];
if(!feature.geometry){continue
}var title=feature.attributes.title?feature.attributes.title:"Untitled";
var description=feature.attributes.description?feature.attributes.description:"No description.";
var link=feature.attributes.link?feature.attributes.link:"";
var location=feature.geometry.getBounds().getCenterLonLat();
data.icon=this.icon==null?OpenLayers.Marker.defaultIcon():this.icon.clone();
data.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120);
if(title||description){data.title=title;
data.description=description;
var contentHTML='<div class="olLayerGeoRSSClose">[x]</div>';
contentHTML+='<div class="olLayerGeoRSSTitle">';
if(link){contentHTML+='<a class="link" href="'+link+'" target="_blank">'
}contentHTML+=title;
if(link){contentHTML+="</a>"
}contentHTML+="</div>";
contentHTML+='<div style="" class="olLayerGeoRSSDescription">';
contentHTML+=description;
contentHTML+="</div>";
data.popupContentHTML=contentHTML
}var feature=new OpenLayers.Feature(this,location,data);
this.features.push(feature);
var marker=feature.createMarker();
marker.events.register("click",feature,this.markerClick);
this.addMarker(marker)
}this.events.triggerEvent("loadend")
},markerClick:function(evt){var sameMarkerClicked=(this==this.layer.selectedFeature);
this.layer.selectedFeature=(!sameMarkerClicked)?this:null;
for(var i=0,len=this.layer.map.popups.length;
i<len;
i++){this.layer.map.removePopup(this.layer.map.popups[i])
}if(!sameMarkerClicked){var popup=this.createPopup();
OpenLayers.Event.observe(popup.div,"click",OpenLayers.Function.bind(function(){for(var i=0,len=this.layer.map.popups.length;
i<len;
i++){this.layer.map.removePopup(this.layer.map.popups[i])
}},this));
this.layer.map.addPopup(popup)
}OpenLayers.Event.stop(evt)
},clearFeatures:function(){if(this.features!=null){while(this.features.length>0){var feature=this.features[0];
OpenLayers.Util.removeItem(this.features,feature);
feature.destroy()
}}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"});
OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(marker){var topleft=this.map.getLayerPxFromLonLat({lon:marker.bounds.left,lat:marker.bounds.top});
var botright=this.map.getLayerPxFromLonLat({lon:marker.bounds.right,lat:marker.bounds.bottom});
if(botright==null||topleft==null){marker.display(false)
}else{var markerDiv=marker.draw(topleft,{w:Math.max(1,botright.x-topleft.x),h:Math.max(1,botright.y-topleft.y)});
if(!marker.drawn){this.div.appendChild(markerDiv);
marker.drawn=true
}}},removeMarker:function(marker){OpenLayers.Util.removeItem(this.markers,marker);
if((marker.div!=null)&&(marker.div.parentNode==this.div)){this.div.removeChild(marker.div)
}},CLASS_NAME:"OpenLayers.Layer.Boxes"});
OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,sphericalMercator:false,zoomOffset:0,serverResolutions:null,initialize:function(name,url,options){if(options&&options.sphericalMercator||this.sphericalMercator){options=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},options)
}OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name||this.name,url||this.url,{},options])
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getURL:function(bounds){var xyz=this.getXYZ(bounds);
var url=this.url;
if(OpenLayers.Util.isArray(url)){var s=""+xyz.x+xyz.y+xyz.z;
url=this.selectUrl(s,url)
}return OpenLayers.String.format(url,xyz)
},getXYZ:function(bounds){var res=this.getServerResolution();
var x=Math.round((bounds.left-this.maxExtent.left)/(res*this.tileSize.w));
var y=Math.round((this.maxExtent.top-bounds.top)/(res*this.tileSize.h));
var z=this.getServerZoom();
if(this.wrapDateLine){var limit=Math.pow(2,z);
x=((x%limit)+limit)%limit
}return{x:x,y:y,z:z}
},setMap:function(map){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);
if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom)
}},CLASS_NAME:"OpenLayers.Layer.XYZ"});
OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:false,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:false,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(options){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[options.name,options.url,{},options]);
this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.UTFGrid(this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getFeatureInfo:function(location){var info=null;
var tileInfo=this.getTileData(location);
if(tileInfo.tile){info=tileInfo.tile.getFeatureInfo(tileInfo.i,tileInfo.j)
}return info
},getFeatureId:function(location){var id=null;
var info=this.getTileData(location);
if(info.tile){id=info.tile.getFeatureId(info.i,info.j)
}return id
},CLASS_NAME:"OpenLayers.Layer.UTFGrid"});
OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:true,wrapDateLine:true,tileOptions:null,initialize:function(name,url,options){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);
this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())
}obj=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj]);
return obj
},CLASS_NAME:"OpenLayers.Layer.OSM"});
OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135,0.29858214169740677,0.14929107084870338,0.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,initialize:function(options){options=OpenLayers.Util.applyDefaults({sphericalMercator:true},options);
var name=options.name||"Bing "+(options.type||this.type);
var newArgs=[name,null,options];
OpenLayers.Layer.XYZ.prototype.initialize.apply(this,newArgs);
this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions);
this.loadMetadata()
},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_");
window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);
var params=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams);
var url="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(params);
var script=document.createElement("script");
script.type="text/javascript";
script.src=url;
script.id=this._callbackId;
document.getElementsByTagName("head")[0].appendChild(script)
},initLayer:function(){var res=this.metadata.resourceSets[0].resources[0];
var url=res.imageUrl.replace("{quadkey}","${quadkey}");
url=url.replace("{culture}",this.culture);
this.url=[];
for(var i=0;
i<res.imageUrlSubdomains.length;
++i){this.url.push(url.replace("{subdomain}",res.imageUrlSubdomains[i]))
}this.addOptions({maxResolution:Math.min(this.serverResolutions[res.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(res.zoomMax+1-res.zoomMin,this.numZoomLevels)},true)
},getURL:function(bounds){if(!this.url){return
}var xyz=this.getXYZ(bounds),x=xyz.x,y=xyz.y,z=xyz.z;
var quadDigits=[];
for(var i=z;
i>0;
--i){var digit="0";
var mask=1<<(i-1);
if((x&mask)!=0){digit++
}if((y&mask)!=0){digit++;
digit++
}quadDigits.push(digit)
}var quadKey=quadDigits.join("");
var url=this.selectUrl(""+x+y+z,this.url);
return OpenLayers.String.format(url,{quadkey:quadKey})
},updateAttribution:function(){var metadata=this.metadata;
if(!metadata.resourceSets||!this.map||!this.map.center){return
}var res=metadata.resourceSets[0].resources[0];
var extent=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"));
var providers=res.imageryProviders,zoom=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),copyrights="",provider,i,ii,j,jj,bbox,coverage;
for(i=0,ii=providers.length;
i<ii;
++i){provider=providers[i];
for(j=0,jj=provider.coverageAreas.length;
j<jj;
++j){coverage=provider.coverageAreas[j];
bbox=OpenLayers.Bounds.fromArray(coverage.bbox,true);
if(extent.intersectsBounds(bbox)&&zoom<=coverage.zoomMax&&zoom>=coverage.zoomMin){copyrights+=provider.attribution+" "
}}}this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:metadata.brandLogoUri,copyrights:copyrights});
this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})
},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments);
this.updateAttribution();
this.map.events.register("moveend",this,this.updateAttribution)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.Bing(this.options)
}obj=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj]);
return obj
},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution);
OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Layer.Bing"});
OpenLayers.Layer.Bing.processMetadata=function(metadata){this.metadata=metadata;
this.initLayer();
var script=document.getElementById(this._callbackId);
script.parentNode.removeChild(script);
window[this._callbackId]=undefined;
delete this._callbackId
};
OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:true,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(name,url,options){var newArguments=[];
newArguments.push(name,url,{},options);
OpenLayers.Layer.Grid.prototype.initialize.apply(this,newArguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var res=this.getServerResolution();
var x=Math.round((bounds.left-this.tileOrigin.lon)/(res*this.tileSize.w));
var y=Math.round((bounds.bottom-this.tileOrigin.lat)/(res*this.tileSize.h));
var z=this.getServerZoom();
var path=this.serviceVersion+"/"+this.layername+"/"+z+"/"+x+"/"+y+"."+this.type;
var url=this.url;
if(OpenLayers.Util.isArray(url)){url=this.selectUrl(path,url)
}return url+path
},setMap:function(map){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);
if(!this.tileOrigin){this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom)
}},CLASS_NAME:"OpenLayers.Layer.TMS"});
OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:true,format:"image/png",serverResolutions:null,initialize:function(name,url,layername,options){this.layername=layername;
OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,{},options]);
this.extension=this.format.split("/")[1].toLowerCase();
this.extension=(this.extension=="jpg")?"jpeg":this.extension
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getURL:function(bounds){var res=this.getServerResolution();
var bbox=this.maxExtent;
var size=this.tileSize;
var tileX=Math.round((bounds.left-bbox.left)/(res*size.w));
var tileY=Math.round((bounds.bottom-bbox.bottom)/(res*size.h));
var tileZ=this.serverResolutions!=null?OpenLayers.Util.indexOf(this.serverResolutions,res):this.map.getZoom();
function zeroPad(number,length){number=String(number);
var zeros=[];
for(var i=0;
i<length;
++i){zeros.push("0")
}return zeros.join("").substring(0,length-number.length)+number
}var components=[this.layername,zeroPad(tileZ,2),zeroPad(parseInt(tileX/1000000),3),zeroPad((parseInt(tileX/1000)%1000),3),zeroPad((parseInt(tileX)%1000),3),zeroPad(parseInt(tileY/1000000),3),zeroPad((parseInt(tileY/1000)%1000),3),zeroPad((parseInt(tileY)%1000),3)+"."+this.extension];
var path=components.join("/");
var url=this.url;
if(OpenLayers.Util.isArray(url)){url=this.selectUrl(path,url)
}url=(url.charAt(url.length-1)=="/")?url:url+"/";
return url+path
},CLASS_NAME:"OpenLayers.Layer.TileCache"});
OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:true,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(name,url,size,options){this.initializeZoomify(size);
OpenLayers.Layer.Grid.prototype.initialize.apply(this,[name,url,size,{},options])
},initializeZoomify:function(size){var imageSize=size.clone();
var tiles=new OpenLayers.Size(Math.ceil(imageSize.w/this.standardTileSize),Math.ceil(imageSize.h/this.standardTileSize));
this.tierSizeInTiles=[tiles];
this.tierImageSize=[imageSize];
while(imageSize.w>this.standardTileSize||imageSize.h>this.standardTileSize){imageSize=new OpenLayers.Size(Math.floor(imageSize.w/2),Math.floor(imageSize.h/2));
tiles=new OpenLayers.Size(Math.ceil(imageSize.w/this.standardTileSize),Math.ceil(imageSize.h/this.standardTileSize));
this.tierSizeInTiles.push(tiles);
this.tierImageSize.push(imageSize)
}this.tierSizeInTiles.reverse();
this.tierImageSize.reverse();
this.numberOfTiers=this.tierSizeInTiles.length;
this.tileCountUpToTier=[0];
for(var i=1;
i<this.numberOfTiers;
i++){this.tileCountUpToTier.push(this.tierSizeInTiles[i-1].w*this.tierSizeInTiles[i-1].h+this.tileCountUpToTier[i-1])
}},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments);
this.tileCountUpToTier.length=0;
this.tierSizeInTiles.length=0;
this.tierImageSize.length=0
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)
}obj=OpenLayers.Layer.Grid.prototype.clone.apply(this,[obj]);
return obj
},getURL:function(bounds){bounds=this.adjustBounds(bounds);
var res=this.map.getResolution();
var x=Math.round((bounds.left-this.tileOrigin.lon)/(res*this.tileSize.w));
var y=Math.round((this.tileOrigin.lat-bounds.top)/(res*this.tileSize.h));
var z=this.map.getZoom();
var tileIndex=x+y*this.tierSizeInTiles[z].w+this.tileCountUpToTier[z];
var path="TileGroup"+Math.floor((tileIndex)/256)+"/"+z+"-"+x+"-"+y+".jpg";
var url=this.url;
if(OpenLayers.Util.isArray(url)){url=this.selectUrl(path,url)
}return url+path
},getImageSize:function(){if(arguments.length>0){var bounds=this.adjustBounds(arguments[0]);
var res=this.map.getResolution();
var x=Math.round((bounds.left-this.tileOrigin.lon)/(res*this.tileSize.w));
var y=Math.round((this.tileOrigin.lat-bounds.top)/(res*this.tileSize.h));
var z=this.map.getZoom();
var w=this.standardTileSize;
var h=this.standardTileSize;
if(x==this.tierSizeInTiles[z].w-1){var w=this.tierImageSize[z].w%this.standardTileSize
}if(y==this.tierSizeInTiles[z].h-1){var h=this.tierImageSize[z].h%this.standardTileSize
}return(new OpenLayers.Size(w,h))
}else{return this.tileSize
}},setMap:function(map){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments);
this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)
},calculateGridLayout:function(bounds,origin,resolution){var tilelon=resolution*this.tileSize.w;
var tilelat=resolution*this.tileSize.h;
var offsetlon=bounds.left-origin.lon;
var tilecol=Math.floor(offsetlon/tilelon)-this.buffer;
var tilecolremain=offsetlon/tilelon-tilecol;
var tileoffsetx=-tilecolremain*this.tileSize.w;
var tileoffsetlon=origin.lon+tilecol*tilelon;
var offsetlat=origin.lat-bounds.top+tilelat;
var tilerow=Math.floor(offsetlat/tilelat)-this.buffer;
var tilerowremain=tilerow-offsetlat/tilelat;
var tileoffsety=tilerowremain*this.tileSize.h;
var tileoffsetlat=origin.lat-tilelat*tilerow;
return{tilelon:tilelon,tilelat:tilelat,tileoffsetlon:tileoffsetlon,tileoffsetlat:tileoffsetlat,tileoffsetx:tileoffsetx,tileoffsety:tileoffsety}
},CLASS_NAME:"OpenLayers.Layer.Zoomify"});
OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:true,type:"png",useScales:false,overrideDPI:false,initialize:function(name,url,options){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments);
if(this.resolutions){this.serverResolutions=this.resolutions;
this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])
}if(this.layerInfo){var info=this.layerInfo;
var startingTileExtent=new OpenLayers.Bounds(info.fullExtent.xmin,info.fullExtent.ymin,info.fullExtent.xmax,info.fullExtent.ymax);
this.projection="EPSG:"+info.spatialReference.wkid;
this.sphericalMercator=(info.spatialReference.wkid==102100);
this.units=(info.units=="esriFeet")?"ft":"m";
if(!!info.tileInfo){this.tileSize=new OpenLayers.Size(info.tileInfo.width||info.tileInfo.cols,info.tileInfo.height||info.tileInfo.rows);
this.tileOrigin=new OpenLayers.LonLat(info.tileInfo.origin.x,info.tileInfo.origin.y);
var upperLeft=new OpenLayers.Geometry.Point(startingTileExtent.left,startingTileExtent.top);
var bottomRight=new OpenLayers.Geometry.Point(startingTileExtent.right,startingTileExtent.bottom);
if(this.useScales){this.scales=[]
}else{this.resolutions=[]
}this.lods=[];
for(var key in info.tileInfo.lods){if(info.tileInfo.lods.hasOwnProperty(key)){var lod=info.tileInfo.lods[key];
if(this.useScales){this.scales.push(lod.scale)
}else{this.resolutions.push(lod.resolution)
}var start=this.getContainingTileCoords(upperLeft,lod.resolution);
lod.startTileCol=start.x;
lod.startTileRow=start.y;
var end=this.getContainingTileCoords(bottomRight,lod.resolution);
lod.endTileCol=end.x;
lod.endTileRow=end.y;
this.lods.push(lod)
}}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]);
this.serverResolutions=this.resolutions;
if(this.overrideDPI&&info.tileInfo.dpi){OpenLayers.DOTS_PER_INCH=info.tileInfo.dpi
}}}},getContainingTileCoords:function(point,res){return new OpenLayers.Pixel(Math.max(Math.floor((point.x-this.tileOrigin.lon)/(this.tileSize.w*res)),0),Math.max(Math.floor((this.tileOrigin.lat-point.y)/(this.tileSize.h*res)),0))
},calculateMaxExtentWithLOD:function(lod){var numTileCols=(lod.endTileCol-lod.startTileCol)+1;
var numTileRows=(lod.endTileRow-lod.startTileRow)+1;
var minX=this.tileOrigin.lon+(lod.startTileCol*this.tileSize.w*lod.resolution);
var maxX=minX+(numTileCols*this.tileSize.w*lod.resolution);
var maxY=this.tileOrigin.lat-(lod.startTileRow*this.tileSize.h*lod.resolution);
var minY=maxY-(numTileRows*this.tileSize.h*lod.resolution);
return new OpenLayers.Bounds(minX,minY,maxX,maxY)
},calculateMaxExtentWithExtent:function(extent,res){var upperLeft=new OpenLayers.Geometry.Point(extent.left,extent.top);
var bottomRight=new OpenLayers.Geometry.Point(extent.right,extent.bottom);
var start=this.getContainingTileCoords(upperLeft,res);
var end=this.getContainingTileCoords(bottomRight,res);
var lod={resolution:res,startTileCol:start.x,startTileRow:start.y,endTileCol:end.x,endTileRow:end.y};
return this.calculateMaxExtentWithLOD(lod)
},getUpperLeftTileCoord:function(res){var upperLeft=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);
return this.getContainingTileCoords(upperLeft,res)
},getLowerRightTileCoord:function(res){var bottomRight=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);
return this.getContainingTileCoords(bottomRight,res)
},getMaxExtentForResolution:function(res){var start=this.getUpperLeftTileCoord(res);
var end=this.getLowerRightTileCoord(res);
var numTileCols=(end.x-start.x)+1;
var numTileRows=(end.y-start.y)+1;
var minX=this.tileOrigin.lon+(start.x*this.tileSize.w*res);
var maxX=minX+(numTileCols*this.tileSize.w*res);
var maxY=this.tileOrigin.lat-(start.y*this.tileSize.h*res);
var minY=maxY-(numTileRows*this.tileSize.h*res);
return new OpenLayers.Bounds(minX,minY,maxX,maxY)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)
}return OpenLayers.Layer.XYZ.prototype.clone.apply(this,[obj])
},getMaxExtent:function(){var resolution=this.map.getResolution();
return this.maxExtent=this.getMaxExtentForResolution(resolution)
},getTileOrigin:function(){var extent=this.getMaxExtent();
return new OpenLayers.LonLat(extent.left,extent.bottom)
},getURL:function(bounds){var res=this.getResolution();
var originTileX=(this.tileOrigin.lon+(res*this.tileSize.w/2));
var originTileY=(this.tileOrigin.lat-(res*this.tileSize.h/2));
var center=bounds.getCenterLonLat();
var point={x:center.lon,y:center.lat};
var x=(Math.round(Math.abs((center.lon-originTileX)/(res*this.tileSize.w))));
var y=(Math.round(Math.abs((originTileY-center.lat)/(res*this.tileSize.h))));
var z=this.map.getZoom();
if(this.lods){var lod=this.lods[this.map.getZoom()];
if((x<lod.startTileCol||x>lod.endTileCol)||(y<lod.startTileRow||y>lod.endTileRow)){return null
}}else{var start=this.getUpperLeftTileCoord(res);
var end=this.getLowerRightTileCoord(res);
if((x<start.x||x>=end.x)||(y<start.y||y>=end.y)){return null
}}var url=this.url;
var s=""+x+y+z;
if(OpenLayers.Util.isArray(url)){url=this.selectUrl(s,url)
}if(this.useArcGISServer){url=url+"/tile/${z}/${y}/${x}"
}else{x="C"+this.zeroPad(x,8,16);
y="R"+this.zeroPad(y,8,16);
z="L"+this.zeroPad(z,2,16);
url=url+"/${z}/${y}/${x}."+this.type
}url=OpenLayers.String.format(url,{x:x,y:y,z:z});
return OpenLayers.Util.urlAppend(url,OpenLayers.Util.getParameterString(this.params))
},zeroPad:function(num,len,radix){var str=num.toString(radix||10);
while(str.length<len){str="0"+str
}return str
},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"});
OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:true,anchor:null,initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){var newArguments=[id,lonlat,contentSize,contentHTML,closeBox,closeBoxCallback];
OpenLayers.Popup.prototype.initialize.apply(this,newArguments);
this.anchor=(anchor!=null)?anchor:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}
},destroy:function(){this.anchor=null;
this.relativePosition=null;
OpenLayers.Popup.prototype.destroy.apply(this,arguments)
},show:function(){this.updatePosition();
OpenLayers.Popup.prototype.show.apply(this,arguments)
},moveTo:function(px){var oldRelativePosition=this.relativePosition;
this.relativePosition=this.calculateRelativePosition(px);
var newPx=this.calculateNewPx(px);
var newArguments=new Array(newPx);
OpenLayers.Popup.prototype.moveTo.apply(this,newArguments);
if(this.relativePosition!=oldRelativePosition){this.updateRelativePosition()
}},setSize:function(contentSize){OpenLayers.Popup.prototype.setSize.apply(this,arguments);
if((this.lonlat)&&(this.map)){var px=this.map.getLayerPxFromLonLat(this.lonlat);
this.moveTo(px)
}},calculateRelativePosition:function(px){var lonlat=this.map.getLonLatFromLayerPx(px);
var extent=this.map.getExtent();
var quadrant=extent.determineQuadrant(lonlat);
return OpenLayers.Bounds.oppositeQuadrant(quadrant)
},updateRelativePosition:function(){},calculateNewPx:function(px){var newPx=px.offset(this.anchor.offset);
var size=this.size||this.contentSize;
var top=(this.relativePosition.charAt(0)=="t");
newPx.y+=(top)?-size.h:this.anchor.size.h;
var left=(this.relativePosition.charAt(1)=="l");
newPx.x+=(left)?-size.w:this.anchor.size.w;
return newPx
},CLASS_NAME:"OpenLayers.Popup.Anchored"});
OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:false,initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){OpenLayers.Console.warn("AnchoredBubble is deprecated");
this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE);
OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)
},draw:function(px){OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments);
this.setContentHTML();
this.setBackgroundColor();
this.setOpacity();
return this.div
},updateRelativePosition:function(){this.setRicoCorners()
},setSize:function(contentSize){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);
this.setRicoCorners()
},setBackgroundColor:function(color){if(color!=undefined){this.backgroundColor=color
}if(this.div!=null){if(this.contentDiv!=null){this.div.style.background="transparent";
OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor)
}}},setOpacity:function(opacity){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,opacity);
if(this.div!=null){if(this.groupDiv!=null){OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)
}}},setBorder:function(border){this.border=0
},setRicoCorners:function(){var corners=this.getCornersToRound(this.relativePosition);
var options={corners:corners,color:this.backgroundColor,bgColor:"transparent",blend:false};
if(!this.rounded){OpenLayers.Rico.Corner.round(this.div,options);
this.rounded=true
}else{OpenLayers.Rico.Corner.reRound(this.groupDiv,options);
this.setBackgroundColor();
this.setOpacity()
}},getCornersToRound:function(){var corners=["tl","tr","bl","br"];
var corner=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);
OpenLayers.Util.removeItem(corners,corner);
return corners.join(" ")
},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"});
OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5;
OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:false,positionBlocks:null,blocks:null,fixedRelativePosition:false,initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);
if(this.fixedRelativePosition){this.updateRelativePosition();
this.calculateRelativePosition=function(px){return this.relativePosition
}
}this.contentDiv.style.position="absolute";
this.contentDiv.style.zIndex=1;
if(closeBox){this.closeDiv.style.zIndex=1
}this.groupDiv.style.position="absolute";
this.groupDiv.style.top="0px";
this.groupDiv.style.left="0px";
this.groupDiv.style.height="100%";
this.groupDiv.style.width="100%"
},destroy:function(){this.imageSrc=null;
this.imageSize=null;
this.isAlphaImage=null;
this.fixedRelativePosition=false;
this.positionBlocks=null;
for(var i=0;
i<this.blocks.length;
i++){var block=this.blocks[i];
if(block.image){block.div.removeChild(block.image)
}block.image=null;
if(block.div){this.groupDiv.removeChild(block.div)
}block.div=null
}this.blocks=null;
OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)
},setBackgroundColor:function(color){},setBorder:function(){},setOpacity:function(opacity){},setSize:function(contentSize){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);
this.updateBlocks()
},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;
if(this.closeDiv){var contentDivPadding=this.getContentDivPadding();
this.closeDiv.style.right=contentDivPadding.right+this.padding.right+"px";
this.closeDiv.style.top=contentDivPadding.top+this.padding.top+"px"
}this.updateBlocks()
},calculateNewPx:function(px){var newPx=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);
newPx=newPx.offset(this.positionBlocks[this.relativePosition].offset);
return newPx
},createBlocks:function(){this.blocks=[];
var firstPosition=null;
for(var key in this.positionBlocks){firstPosition=key;
break
}var position=this.positionBlocks[firstPosition];
for(var i=0;
i<position.blocks.length;
i++){var block={};
this.blocks.push(block);
var divId=this.id+"_FrameDecorationDiv_"+i;
block.div=OpenLayers.Util.createDiv(divId,null,null,null,"absolute",null,"hidden",null);
var imgId=this.id+"_FrameDecorationImg_"+i;
var imageCreator=(this.isAlphaImage)?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;
block.image=imageCreator(imgId,null,this.imageSize,this.imageSrc,"absolute",null,null,null);
block.div.appendChild(block.image);
this.groupDiv.appendChild(block.div)
}},updateBlocks:function(){if(!this.blocks){this.createBlocks()
}if(this.size&&this.relativePosition){var position=this.positionBlocks[this.relativePosition];
for(var i=0;
i<position.blocks.length;
i++){var positionBlock=position.blocks[i];
var block=this.blocks[i];
var l=positionBlock.anchor.left;
var b=positionBlock.anchor.bottom;
var r=positionBlock.anchor.right;
var t=positionBlock.anchor.top;
var w=(isNaN(positionBlock.size.w))?this.size.w-(r+l):positionBlock.size.w;
var h=(isNaN(positionBlock.size.h))?this.size.h-(b+t):positionBlock.size.h;
block.div.style.width=(w<0?0:w)+"px";
block.div.style.height=(h<0?0:h)+"px";
block.div.style.left=(l!=null)?l+"px":"";
block.div.style.bottom=(b!=null)?b+"px":"";
block.div.style.right=(r!=null)?r+"px":"";
block.div.style.top=(t!=null)?t+"px":"";
block.image.style.left=positionBlock.position.x+"px";
block.image.style.top=positionBlock.position.y+"px"
}this.contentDiv.style.left=this.padding.left+"px";
this.contentDiv.style.top=this.padding.top+"px"
}},CLASS_NAME:"OpenLayers.Popup.Framed"});
OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:true,panMapIfOutOfView:true,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:false,fixedRelativePosition:false,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(id,lonlat,contentSize,contentHTML,anchor,closeBox,closeBoxCallback){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");
OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);
this.contentDiv.className=this.contentDisplayClass
},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});
OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(layer,lonlat,data){this.layer=layer;
this.lonlat=lonlat;
this.data=(data!=null)?data:{};
this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){if((this.layer!=null)&&(this.layer.map!=null)){if(this.popup!=null){this.layer.map.removePopup(this.popup)
}}if(this.layer!=null&&this.marker!=null){this.layer.removeMarker(this.marker)
}this.layer=null;
this.id=null;
this.lonlat=null;
this.data=null;
if(this.marker!=null){this.destroyMarker(this.marker);
this.marker=null
}if(this.popup!=null){this.destroyPopup(this.popup);
this.popup=null
}},onScreen:function(){var onScreen=false;
if((this.layer!=null)&&(this.layer.map!=null)){var screenBounds=this.layer.map.getExtent();
onScreen=screenBounds.containsLonLat(this.lonlat)
}return onScreen
},createMarker:function(){if(this.lonlat!=null){this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)
}return this.marker
},destroyMarker:function(){this.marker.destroy()
},createPopup:function(closeBox){if(this.lonlat!=null){if(!this.popup){var anchor=(this.marker)?this.marker.icon:null;
var popupClass=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;
this.popup=new popupClass(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,anchor,closeBox)
}if(this.data.overflow!=null){this.popup.contentDiv.style.overflow=this.data.overflow
}this.popup.feature=this
}return this.popup
},destroyPopup:function(){if(this.popup){this.popup.feature=null;
this.popup.destroy();
this.popup=null
}},CLASS_NAME:"OpenLayers.Feature"});
OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};
OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(geometry,attributes,style){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,attributes]);
this.lonlat=null;
this.geometry=geometry?geometry:null;
this.state=null;
this.attributes={};
if(attributes){this.attributes=OpenLayers.Util.extend(this.attributes,attributes)
}this.style=style?style:null
},destroy:function(){if(this.layer){this.layer.removeFeatures(this);
this.layer=null
}this.geometry=null;
this.modified=null;
OpenLayers.Feature.prototype.destroy.apply(this,arguments)
},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)
},onScreen:function(boundsOnly){var onScreen=false;
if(this.layer&&this.layer.map){var screenBounds=this.layer.map.getExtent();
if(boundsOnly){var featureBounds=this.geometry.getBounds();
onScreen=screenBounds.intersectsBounds(featureBounds)
}else{var screenPoly=screenBounds.toGeometry();
onScreen=screenPoly.intersects(this.geometry)
}}return onScreen
},getVisibility:function(){return !(this.style&&this.style.display=="none"||!this.layer||this.layer&&this.layer.styleMap&&this.layer.styleMap.createSymbolizer(this,this.renderIntent).display=="none"||this.layer&&!this.layer.getVisibility())
},createMarker:function(){return null
},destroyMarker:function(){},createPopup:function(){return null
},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=false;
if(this.geometry){atPoint=this.geometry.atPoint(lonlat,toleranceLon,toleranceLat)
}return atPoint
},destroyPopup:function(){},move:function(location){if(!this.layer||!this.geometry.move){return undefined
}var pixel;
if(location.CLASS_NAME=="OpenLayers.LonLat"){pixel=this.layer.getViewPortPxFromLonLat(location)
}else{pixel=location
}var lastPixel=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat());
var res=this.layer.map.getResolution();
this.geometry.move(res*(pixel.x-lastPixel.x),res*(lastPixel.y-pixel.y));
this.layer.drawFeature(this);
return lastPixel
},toState:function(state){if(state==OpenLayers.State.UPDATE){switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=state;
break;
case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:break
}}else{if(state==OpenLayers.State.INSERT){switch(this.state){case OpenLayers.State.UNKNOWN:break;
default:this.state=state;
break
}}else{if(state==OpenLayers.State.DELETE){switch(this.state){case OpenLayers.State.INSERT:break;
case OpenLayers.State.DELETE:break;
case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=state;
break
}}else{if(state==OpenLayers.State.UNKNOWN){this.state=state
}}}}},CLASS_NAME:"OpenLayers.Feature.Vector"});
OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:0.4,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:0.2,hoverFillColor:"white",hoverFillOpacity:0.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:0.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};
OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:false,evt:null,initialize:function(control,callbacks,options){OpenLayers.Util.extend(this,options);
this.control=control;
this.callbacks=callbacks;
var map=this.map||control.map;
if(map){this.setMap(map)
}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},setMap:function(map){this.map=map
},checkModifiers:function(evt){if(this.keyMask==null){return true
}var keyModifiers=(evt.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(evt.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(evt.altKey?OpenLayers.Handler.MOD_ALT:0);
return(keyModifiers==this.keyMask)
},activate:function(){if(this.active){return false
}var events=OpenLayers.Events.prototype.BROWSER_EVENTS;
for(var i=0,len=events.length;
i<len;
i++){if(this[events[i]]){this.register(events[i],this[events[i]])
}}this.active=true;
return true
},deactivate:function(){if(!this.active){return false
}var events=OpenLayers.Events.prototype.BROWSER_EVENTS;
for(var i=0,len=events.length;
i<len;
i++){if(this[events[i]]){this.unregister(events[i],this[events[i]])
}}this.active=false;
return true
},callback:function(name,args){if(name&&this.callbacks[name]){this.callbacks[name].apply(this.control,args)
}},register:function(name,method){this.map.events.registerPriority(name,this,method);
this.map.events.registerPriority(name,this,this.setEvent)
},unregister:function(name,method){this.map.events.unregister(name,this,method);
this.map.events.unregister(name,this,this.setEvent)
},setEvent:function(evt){this.evt=evt;
return true
},destroy:function(){this.deactivate();
this.control=this.map=null
},CLASS_NAME:"OpenLayers.Handler"});
OpenLayers.Handler.MOD_NONE=0;
OpenLayers.Handler.MOD_SHIFT=1;
OpenLayers.Handler.MOD_CTRL=2;
OpenLayers.Handler.MOD_ALT=4;
OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:true,"double":false,pixelTolerance:0,dblclickTolerance:13,stopSingle:false,stopDouble:false,timerId:null,touch:false,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(evt){if(!this.touch){this.unregisterMouseListeners();
this.touch=true
}this.down=this.getEventInfo(evt);
this.last=this.getEventInfo(evt);
return true
},touchmove:function(evt){this.last=this.getEventInfo(evt);
return true
},touchend:function(evt){if(this.down){evt.xy=this.last.xy;
evt.lastTouches=this.last.touches;
this.handleSingle(evt);
this.down=null
}return true
},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})
},mousedown:function(evt){this.down=this.getEventInfo(evt);
this.last=this.getEventInfo(evt);
return true
},mouseup:function(evt){var propagate=true;
if(this.checkModifiers(evt)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(evt)){propagate=this.rightclick(evt)
}return propagate
},rightclick:function(evt){if(this.passesTolerance(evt)){if(this.rightclickTimerId!=null){this.clearTimer();
this.callback("dblrightclick",[evt]);
return !this.stopDouble
}else{var clickEvent=this["double"]?OpenLayers.Util.extend({},evt):this.callback("rightclick",[evt]);
var delayedRightCall=OpenLayers.Function.bind(this.delayedRightCall,this,clickEvent);
this.rightclickTimerId=window.setTimeout(delayedRightCall,this.delay)
}}return !this.stopSingle
},delayedRightCall:function(evt){this.rightclickTimerId=null;
if(evt){this.callback("rightclick",[evt])
}},click:function(evt){if(!this.last){this.last=this.getEventInfo(evt)
}this.handleSingle(evt);
return !this.stopSingle
},dblclick:function(evt){this.handleDouble(evt);
return !this.stopDouble
},handleDouble:function(evt){if(this.passesDblclickTolerance(evt)){if(this["double"]){this.callback("dblclick",[evt])
}this.clearTimer()
}},handleSingle:function(evt){if(this.passesTolerance(evt)){if(this.timerId!=null){if(this.last.touches&&this.last.touches.length===1){if(this["double"]){OpenLayers.Event.stop(evt)
}this.handleDouble(evt)
}if(!this.last.touches||this.last.touches.length!==2){this.clearTimer()
}}else{this.first=this.getEventInfo(evt);
var clickEvent=this.single?OpenLayers.Util.extend({},evt):null;
this.queuePotentialClick(clickEvent)
}}},queuePotentialClick:function(evt){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,evt),this.delay)
},passesTolerance:function(evt){var passes=true;
if(this.pixelTolerance!=null&&this.down&&this.down.xy){passes=this.pixelTolerance>=this.down.xy.distanceTo(evt.xy);
if(passes&&this.touch&&this.down.touches.length===this.last.touches.length){for(var i=0,ii=this.down.touches.length;
i<ii;
++i){if(this.getTouchDistance(this.down.touches[i],this.last.touches[i])>this.pixelTolerance){passes=false;
break
}}}}return passes
},getTouchDistance:function(from,to){return Math.sqrt(Math.pow(from.clientX-to.clientX,2)+Math.pow(from.clientY-to.clientY,2))
},passesDblclickTolerance:function(evt){var passes=true;
if(this.down&&this.first){passes=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance
}return passes
},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);
this.timerId=null
}if(this.rightclickTimerId!=null){window.clearTimeout(this.rightclickTimerId);
this.rightclickTimerId=null
}},delayedCall:function(evt){this.timerId=null;
if(evt){this.callback("click",[evt])
}},getEventInfo:function(evt){var touches;
if(evt.touches){var len=evt.touches.length;
touches=new Array(len);
var touch;
for(var i=0;
i<len;
i++){touch=evt.touches[i];
touches[i]={clientX:touch.clientX,clientY:touch.clientY}
}}return{xy:evt.xy,touches:touches}
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();
this.down=null;
this.first=null;
this.last=null;
this.touch=false;
deactivated=true
}return deactivated
},CLASS_NAME:"OpenLayers.Handler.Click"});
OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:false,px:null,timerId:null,mousemove:function(evt){if(this.passesTolerance(evt.xy)){this.clearTimer();
this.callback("move",[evt]);
this.px=evt.xy;
evt=OpenLayers.Util.extend({},evt);
this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,evt),this.delay)
}return !this.stopMove
},mouseout:function(evt){if(OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv)){this.clearTimer();
this.callback("move",[evt])
}return true
},passesTolerance:function(px){var passes=true;
if(this.pixelTolerance&&this.px){var dpx=Math.sqrt(Math.pow(this.px.x-px.x,2)+Math.pow(this.px.y-px.y,2));
if(dpx<this.pixelTolerance){passes=false
}}return passes
},clearTimer:function(){if(this.timerId!=null){window.clearTimeout(this.timerId);
this.timerId=null
}},delayedCall:function(evt){this.callback("pause",[evt])
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();
deactivated=true
}return deactivated
},CLASS_NAME:"OpenLayers.Handler.Hover"});
OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:false,citeCompliant:false,mouseDown:false,stoppedDown:null,lastDown:null,lastUp:null,persist:false,stopDown:false,stopUp:false,layerOptions:null,pixelTolerance:5,touch:false,lastTouchPx:null,initialize:function(control,callbacks,options){if(!(options&&options.layerOptions&&options.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})
}OpenLayers.Handler.prototype.initialize.apply(this,arguments)
},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments)){return false
}var options=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);
this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,options);
this.map.addLayer(this.layer);
return true
},createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel);
var geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);
this.point=new OpenLayers.Feature.Vector(geometry);
this.callback("create",[this.point.geometry,this.point]);
this.point.geometry.clearBounds();
this.layer.addFeatures([this.point],{silent:true})
},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){return false
}this.cancel();
if(this.layer.map!=null){this.destroyFeature(true);
this.layer.destroy(false)
}this.layer=null;
this.touch=false;
return true
},destroyFeature:function(force){if(this.layer&&(force||!this.persist)){this.layer.destroyFeatures()
}this.point=null
},destroyPersistedFeature:function(){var layer=this.layer;
if(layer&&layer.features.length>1){this.layer.features[0].destroy()
}},finalize:function(cancel){var key=cancel?"cancel":"done";
this.mouseDown=false;
this.lastDown=null;
this.lastUp=null;
this.lastTouchPx=null;
this.callback(key,[this.geometryClone()]);
this.destroyFeature(cancel)
},cancel:function(){this.finalize(true)
},click:function(evt){OpenLayers.Event.stop(evt);
return false
},dblclick:function(evt){OpenLayers.Event.stop(evt);
return false
},modifyFeature:function(pixel){if(!this.point){this.createFeature(pixel)
}var lonlat=this.layer.getLonLatFromViewPortPx(pixel);
this.point.geometry.x=lonlat.lon;
this.point.geometry.y=lonlat.lat;
this.callback("modify",[this.point.geometry,this.point,false]);
this.point.geometry.clearBounds();
this.drawFeature()
},drawFeature:function(){this.layer.drawFeature(this.point,this.style)
},getGeometry:function(){var geometry=this.point&&this.point.geometry;
if(geometry&&this.multi){geometry=new OpenLayers.Geometry.MultiPoint([geometry])
}return geometry
},geometryClone:function(){var geom=this.getGeometry();
return geom&&geom.clone()
},mousedown:function(evt){return this.down(evt)
},touchstart:function(evt){if(!this.touch){this.touch=true;
this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})
}this.lastTouchPx=evt.xy;
return this.down(evt)
},mousemove:function(evt){return this.move(evt)
},touchmove:function(evt){this.lastTouchPx=evt.xy;
return this.move(evt)
},mouseup:function(evt){return this.up(evt)
},touchend:function(evt){evt.xy=this.lastTouchPx;
return this.up(evt)
},down:function(evt){this.mouseDown=true;
this.lastDown=evt.xy;
if(!this.touch){this.modifyFeature(evt.xy)
}this.stoppedDown=this.stopDown;
return !this.stopDown
},move:function(evt){if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(evt.xy)
}return true
},up:function(evt){this.mouseDown=false;
this.stoppedDown=this.stopDown;
if(!this.checkModifiers(evt)){return true
}if(this.lastUp&&this.lastUp.equals(evt.xy)){return true
}if(this.lastDown&&this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(evt.xy)
}if(this.persist){this.destroyPersistedFeature()
}this.lastUp=evt.xy;
this.finalize();
return !this.stopUp
}else{return true
}},mouseout:function(evt){if(OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv)){this.stoppedDown=this.stopDown;
this.mouseDown=false
}},passesTolerance:function(pixel1,pixel2,tolerance){var passes=true;
if(tolerance!=null&&pixel1&&pixel2){var dist=pixel1.distanceTo(pixel2);
if(dist>tolerance){passes=false
}}return passes
},CLASS_NAME:"OpenLayers.Handler.Point"});
OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:false,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel);
var geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);
this.point=new OpenLayers.Feature.Vector(geometry);
this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));
this.callback("create",[this.point.geometry,this.getSketch()]);
this.point.geometry.clearBounds();
this.layer.addFeatures([this.line,this.point],{silent:true})
},destroyFeature:function(force){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,force);
this.line=null
},destroyPersistedFeature:function(){var layer=this.layer;
if(layer&&layer.features.length>2){this.layer.features[0].destroy()
}},removePoint:function(){if(this.point){this.layer.removeFeatures([this.point])
}},addPoint:function(pixel){this.layer.removeFeatures([this.point]);
var lonlat=this.layer.getLonLatFromViewPortPx(pixel);
this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat));
this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);
this.layer.addFeatures([this.point]);
this.callback("point",[this.point.geometry,this.getGeometry()]);
this.callback("modify",[this.point.geometry,this.getSketch()]);
this.drawFeature();
delete this.redoStack
},insertXY:function(x,y){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(x,y),this.getCurrentPointIndex());
this.drawFeature();
delete this.redoStack
},insertDeltaXY:function(dx,dy){var previousIndex=this.getCurrentPointIndex()-1;
var p0=this.line.geometry.components[previousIndex];
if(p0&&!isNaN(p0.x)&&!isNaN(p0.y)){this.insertXY(p0.x+dx,p0.y+dy)
}},insertDirectionLength:function(direction,length){direction*=Math.PI/180;
var dx=length*Math.cos(direction);
var dy=length*Math.sin(direction);
this.insertDeltaXY(dx,dy)
},insertDeflectionLength:function(deflection,length){var previousIndex=this.getCurrentPointIndex()-1;
if(previousIndex>0){var p1=this.line.geometry.components[previousIndex];
var p0=this.line.geometry.components[previousIndex-1];
var theta=Math.atan2(p1.y-p0.y,p1.x-p0.x);
this.insertDirectionLength((theta*180/Math.PI)+deflection,length)
}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1
},undo:function(){var geometry=this.line.geometry;
var components=geometry.components;
var index=this.getCurrentPointIndex()-1;
var target=components[index];
var undone=geometry.removeComponent(target);
if(undone){if(!this.redoStack){this.redoStack=[]
}this.redoStack.push(target);
this.drawFeature()
}return undone
},redo:function(){var target=this.redoStack&&this.redoStack.pop();
if(target){this.line.geometry.addComponent(target,this.getCurrentPointIndex());
this.drawFeature()
}return !!target
},freehandMode:function(evt){return(this.freehandToggle&&evt[this.freehandToggle])?!this.freehand:this.freehand
},modifyFeature:function(pixel,drawing){if(!this.line){this.createFeature(pixel)
}var lonlat=this.layer.getLonLatFromViewPortPx(pixel);
this.point.geometry.x=lonlat.lon;
this.point.geometry.y=lonlat.lat;
this.callback("modify",[this.point.geometry,this.getSketch(),drawing]);
this.point.geometry.clearBounds();
this.drawFeature()
},drawFeature:function(){this.layer.drawFeature(this.line,this.style);
this.layer.drawFeature(this.point,this.style)
},getSketch:function(){return this.line
},getGeometry:function(){var geometry=this.line&&this.line.geometry;
if(geometry&&this.multi){geometry=new OpenLayers.Geometry.MultiLineString([geometry])
}return geometry
},touchstart:function(evt){if(this.timerId&&this.passesTolerance(this.lastTouchPx,evt.xy,this.doubleTouchTolerance)){this.finishGeometry();
window.clearTimeout(this.timerId);
this.timerId=null;
return false
}else{if(this.timerId){window.clearTimeout(this.timerId);
this.timerId=null
}this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null
},this),300);
return OpenLayers.Handler.Point.prototype.touchstart.call(this,evt)
}},down:function(evt){var stopDown=this.stopDown;
if(this.freehandMode(evt)){stopDown=true;
if(this.touch){this.modifyFeature(evt.xy,!!this.lastUp);
OpenLayers.Event.stop(evt)
}}if(!this.touch&&(!this.lastDown||!this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance))){this.modifyFeature(evt.xy,!!this.lastUp)
}this.mouseDown=true;
this.lastDown=evt.xy;
this.stoppedDown=stopDown;
return !stopDown
},move:function(evt){if(this.stoppedDown&&this.freehandMode(evt)){if(this.persist){this.destroyPersistedFeature()
}if(this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices){this.removePoint();
this.finalize()
}else{this.addPoint(evt.xy)
}return false
}if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(evt.xy,!!this.lastUp)
}return true
},up:function(evt){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(evt.xy))){if(this.stoppedDown&&this.freehandMode(evt)){if(this.persist){this.destroyPersistedFeature()
}this.removePoint();
this.finalize()
}else{if(this.passesTolerance(this.lastDown,evt.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(evt.xy)
}if(this.lastUp==null&&this.persist){this.destroyPersistedFeature()
}this.addPoint(evt.xy);
this.lastUp=evt.xy;
if(this.line.geometry.components.length===this.maxVertices+1){this.finishGeometry()
}}}}this.stoppedDown=this.stopDown;
this.mouseDown=false;
return !this.stopUp
},finishGeometry:function(){var index=this.line.geometry.components.length-1;
this.line.geometry.removeComponent(this.line.geometry.components[index]);
this.removePoint();
this.finalize()
},dblclick:function(evt){if(!this.freehandMode(evt)){this.finishGeometry()
}return false
},CLASS_NAME:"OpenLayers.Handler.Path"});
OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:false,polygon:null,createFeature:function(pixel){var lonlat=this.layer.getLonLatFromViewPortPx(pixel);
var geometry=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);
this.point=new OpenLayers.Feature.Vector(geometry);
this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));
this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));
this.callback("create",[this.point.geometry,this.getSketch()]);
this.point.geometry.clearBounds();
this.layer.addFeatures([this.polygon,this.point],{silent:true})
},addPoint:function(pixel){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier]){var geometry=this.point.geometry;
var features=this.control.layer.features;
var candidate,polygon;
for(var i=features.length-1;
i>=0;
--i){candidate=features[i].geometry;
if((candidate instanceof OpenLayers.Geometry.Polygon||candidate instanceof OpenLayers.Geometry.MultiPolygon)&&candidate.intersects(geometry)){polygon=features[i];
this.control.layer.removeFeatures([polygon],{silent:true});
this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);
this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);
polygon.geometry.addComponent(this.line.geometry);
this.polygon=polygon;
this.drawingHole=true;
break
}}}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)
},getCurrentPointIndex:function(){return this.line.geometry.components.length-2
},enforceTopology:function(event){var point=event.vertex;
var components=this.line.geometry.components;
if(!this.polygon.geometry.intersects(point)){var last=components[components.length-3];
point.x=last.x;
point.y=last.y
}},finishGeometry:function(){var index=this.line.geometry.components.length-2;
this.line.geometry.removeComponent(this.line.geometry.components[index]);
this.removePoint();
this.finalize()
},finalizeInteriorRing:function(){var ring=this.line.geometry;
var modified=(ring.getArea()!==0);
if(modified){var rings=this.polygon.geometry.components;
for(var i=rings.length-2;
i>=0;
--i){if(ring.intersects(rings[i])){modified=false;
break
}}if(modified){var target;
outer:for(var i=rings.length-2;
i>0;
--i){var points=rings[i].components;
for(var j=0,jj=points.length;
j<jj;
++j){if(ring.containsPoint(points[j])){modified=false;
break outer
}}}}}if(modified){if(this.polygon.state!==OpenLayers.State.INSERT){this.polygon.state=OpenLayers.State.UPDATE
}}else{this.polygon.geometry.removeComponent(ring)
}this.restoreFeature();
return false
},cancel:function(){if(this.drawingHole){this.polygon.geometry.removeComponent(this.line.geometry);
this.restoreFeature(true)
}return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)
},restoreFeature:function(cancel){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);
this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);
this.layer.removeFeatures([this.polygon],{silent:true});
this.control.layer.addFeatures([this.polygon],{silent:true});
this.drawingHole=false;
if(!cancel){this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})
}},destroyFeature:function(force){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,force);
this.polygon=null
},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);
this.layer.drawFeature(this.point,this.style)
},getSketch:function(){return this.polygon
},getGeometry:function(){var geometry=this.polygon&&this.polygon.geometry;
if(geometry&&this.multi){geometry=new OpenLayers.Geometry.MultiPolygon([geometry])
}return geometry
},CLASS_NAME:"OpenLayers.Handler.Polygon"});
OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:false,clickTolerance:4,geometryTypes:null,stopClick:true,stopDown:true,stopUp:false,initialize:function(control,layer,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,[control,callbacks,options]);
this.layer=layer
},touchstart:function(evt){if(!this.touch){this.touch=true;
this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})
}return OpenLayers.Event.isMultiTouch(evt)?true:this.mousedown(evt)
},touchmove:function(evt){OpenLayers.Event.stop(evt)
},mousedown:function(evt){if(OpenLayers.Event.isLeftClick(evt)||OpenLayers.Event.isSingleTouch(evt)){this.down=evt.xy
}return this.handle(evt)?!this.stopDown:true
},mouseup:function(evt){this.up=evt.xy;
return this.handle(evt)?!this.stopUp:true
},click:function(evt){return this.handle(evt)?!this.stopClick:true
},mousemove:function(evt){if(!this.callbacks.over&&!this.callbacks.out){return true
}this.handle(evt);
return true
},dblclick:function(evt){return !this.handle(evt)
},geometryTypeMatches:function(feature){return this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1
},handle:function(evt){if(this.feature&&!this.feature.layer){this.feature=null
}var type=evt.type;
var handled=false;
var previouslyIn=!!(this.feature);
var click=(type=="click"||type=="dblclick"||type=="touchstart");
this.feature=this.layer.getFeatureFromEvent(evt);
if(this.feature&&!this.feature.layer){this.feature=null
}if(this.lastFeature&&!this.lastFeature.layer){this.lastFeature=null
}if(this.feature){if(type==="touchstart"){OpenLayers.Event.stop(evt)
}var inNew=(this.feature!=this.lastFeature);
if(this.geometryTypeMatches(this.feature)){if(previouslyIn&&inNew){if(this.lastFeature){this.triggerCallback(type,"out",[this.lastFeature])
}this.triggerCallback(type,"in",[this.feature])
}else{if(!previouslyIn||click){this.triggerCallback(type,"in",[this.feature])
}}this.lastFeature=this.feature;
handled=true
}else{if(this.lastFeature&&(previouslyIn&&inNew||click)){this.triggerCallback(type,"out",[this.lastFeature])
}this.feature=null
}}else{if(this.lastFeature&&(previouslyIn||click)){this.triggerCallback(type,"out",[this.lastFeature])
}}return handled
},triggerCallback:function(type,mode,args){var key=this.EVENTMAP[type][mode];
if(key){if(type=="click"&&this.up&&this.down){var dpx=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));
if(dpx<=this.clickTolerance){this.callback(key,args)
}}else{this.callback(key,args)
}}},activate:function(){var activated=false;
if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();
this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});
activated=true
}return activated
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();
this.feature=null;
this.lastFeature=null;
this.down=null;
this.up=null;
this.touch=false;
this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});
deactivated=true
}return deactivated
},handleMapEvents:function(evt){if(evt.type=="removelayer"||evt.property=="order"){this.moveLayerToTop()
}},moveLayerToTop:function(){var index=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;
this.layer.setZIndex(index)
},moveLayerBack:function(){var index=this.layer.getZIndex()-1;
if(index>=this.map.Z_INDEX_BASE.Feature){this.layer.setZIndex(index)
}else{this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))
}},CLASS_NAME:"OpenLayers.Handler.Feature"});
OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:true,dragging:false,touch:false,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:false,documentEvents:null,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
if(this.documentDrag===true){var me=this;
this._docMove=function(evt){me.mousemove({xy:{x:evt.clientX,y:evt.clientY},element:document})
};
this._docUp=function(evt){me.mouseup({xy:{x:evt.clientX,y:evt.clientY}})
}
}},dragstart:function(evt){var propagate=true;
this.dragging=false;
if(this.checkModifiers(evt)&&(OpenLayers.Event.isLeftClick(evt)||OpenLayers.Event.isSingleTouch(evt))){this.started=true;
this.start=evt.xy;
this.last=evt.xy;
OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");
this.down(evt);
this.callback("down",[evt.xy]);
OpenLayers.Event.stop(evt);
if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True
}document.onselectstart=OpenLayers.Function.False;
propagate=!this.stopDown
}else{this.started=false;
this.start=null;
this.last=null
}return propagate
},dragmove:function(evt){this.lastMoveEvt=evt;
if(this.started&&!this.timeoutId&&(evt.xy.x!=this.last.x||evt.xy.y!=this.last.y)){if(this.documentDrag===true&&this.documentEvents){if(evt.element===document){this.adjustXY(evt);
this.setEvent(evt)
}else{this.removeDocumentEvents()
}}if(this.interval>0){this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)
}this.dragging=true;
this.move(evt);
this.callback("move",[evt.xy]);
if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;
document.onselectstart=OpenLayers.Function.False
}this.last=evt.xy
}return true
},dragend:function(evt){if(this.started){if(this.documentDrag===true&&this.documentEvents){this.adjustXY(evt);
this.removeDocumentEvents()
}var dragged=(this.start!=this.last);
this.started=false;
this.dragging=false;
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");
this.up(evt);
this.callback("up",[evt.xy]);
if(dragged){this.callback("done",[evt.xy])
}document.onselectstart=this.oldOnselectstart
}return true
},down:function(evt){},move:function(evt){},up:function(evt){},out:function(evt){},mousedown:function(evt){return this.dragstart(evt)
},touchstart:function(evt){if(!this.touch){this.touch=true;
this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})
}return this.dragstart(evt)
},mousemove:function(evt){return this.dragmove(evt)
},touchmove:function(evt){return this.dragmove(evt)
},removeTimeout:function(){this.timeoutId=null;
if(this.dragging){this.mousemove(this.lastMoveEvt)
}},mouseup:function(evt){return this.dragend(evt)
},touchend:function(evt){evt.xy=this.last;
return this.dragend(evt)
},mouseout:function(evt){if(this.started&&OpenLayers.Util.mouseLeft(evt,this.map.viewPortDiv)){if(this.documentDrag===true){this.addDocumentEvents()
}else{var dragged=(this.start!=this.last);
this.started=false;
this.dragging=false;
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");
this.out(evt);
this.callback("out",[]);
if(dragged){this.callback("done",[evt.xy])
}if(document.onselectstart){document.onselectstart=this.oldOnselectstart
}}}return true
},click:function(evt){return(this.start==this.last)
},activate:function(){var activated=false;
if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=false;
activated=true
}return activated
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.touch=false;
this.started=false;
this.dragging=false;
this.start=null;
this.last=null;
deactivated=true;
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")
}return deactivated
},adjustXY:function(evt){var pos=OpenLayers.Util.pagePosition(this.map.viewPortDiv);
evt.xy.x-=pos[0];
evt.xy.y-=pos[1]
},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");
this.documentEvents=true;
OpenLayers.Event.observe(document,"mousemove",this._docMove);
OpenLayers.Event.observe(document,"mouseup",this._docUp)
},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");
this.documentEvents=false;
OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);
OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)
},CLASS_NAME:"OpenLayers.Handler.Drag"});
OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:false,stopDown:false,pinching:false,last:null,start:null,touchstart:function(evt){var propagate=true;
this.pinching=false;
if(OpenLayers.Event.isMultiTouch(evt)){this.started=true;
this.last=this.start={distance:this.getDistance(evt.touches),delta:0,scale:1};
this.callback("start",[evt,this.start]);
propagate=!this.stopDown
}else{this.started=false;
this.start=null;
this.last=null
}OpenLayers.Event.stop(evt);
return propagate
},touchmove:function(evt){if(this.started&&OpenLayers.Event.isMultiTouch(evt)){this.pinching=true;
var current=this.getPinchData(evt);
this.callback("move",[evt,current]);
this.last=current;
OpenLayers.Event.stop(evt)
}return true
},touchend:function(evt){if(this.started){this.started=false;
this.pinching=false;
this.callback("done",[evt,this.start,this.last]);
this.start=null;
this.last=null
}return true
},activate:function(){var activated=false;
if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.pinching=false;
activated=true
}return activated
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=false;
this.pinching=false;
this.start=null;
this.last=null;
deactivated=true
}return deactivated
},getDistance:function(touches){var t0=touches[0];
var t1=touches[1];
return Math.sqrt(Math.pow(t0.clientX-t1.clientX,2)+Math.pow(t0.clientY-t1.clientY,2))
},getPinchData:function(evt){var distance=this.getDistance(evt.touches);
var scale=distance/this.start.distance;
return{distance:distance,delta:this.last.distance-distance,scale:scale}
},CLASS_NAME:"OpenLayers.Handler.Pinch"});
OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:false,irregular:false,citeCompliant:false,angle:null,fixedRadius:false,feature:null,layer:null,origin:null,initialize:function(control,callbacks,options){if(!(options&&options.layerOptions&&options.layerOptions.styleMap)){this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})
}OpenLayers.Handler.Drag.prototype.initialize.apply(this,[control,callbacks,options]);
this.options=(options)?options:{}
},setOptions:function(newOptions){OpenLayers.Util.extend(this.options,newOptions);
OpenLayers.Util.extend(this,newOptions)
},activate:function(){var activated=false;
if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var options=OpenLayers.Util.extend({displayInLayerSwitcher:false,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);
this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,options);
this.map.addLayer(this.layer);
activated=true
}return activated
},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)){if(this.dragging){this.cancel()
}if(this.layer.map!=null){this.layer.destroy(false);
if(this.feature){this.feature.destroy()
}}this.layer=null;
this.feature=null;
deactivated=true
}return deactivated
},down:function(evt){this.fixedRadius=!!(this.radius);
var maploc=this.layer.getLonLatFromViewPortPx(evt.xy);
this.origin=new OpenLayers.Geometry.Point(maploc.lon,maploc.lat);
if(!this.fixedRadius||this.irregular){this.radius=this.map.getResolution()
}if(this.persist){this.clear()
}this.feature=new OpenLayers.Feature.Vector();
this.createGeometry();
this.callback("create",[this.origin,this.feature]);
this.layer.addFeatures([this.feature],{silent:true});
this.layer.drawFeature(this.feature,this.style)
},move:function(evt){var maploc=this.layer.getLonLatFromViewPortPx(evt.xy);
var point=new OpenLayers.Geometry.Point(maploc.lon,maploc.lat);
if(this.irregular){var ry=Math.sqrt(2)*Math.abs(point.y-this.origin.y)/2;
this.radius=Math.max(this.map.getResolution()/2,ry)
}else{if(this.fixedRadius){this.origin=point
}else{this.calculateAngle(point,evt);
this.radius=Math.max(this.map.getResolution()/2,point.distanceTo(this.origin))
}}this.modifyGeometry();
if(this.irregular){var dx=point.x-this.origin.x;
var dy=point.y-this.origin.y;
var ratio;
if(dy==0){ratio=dx/(this.radius*Math.sqrt(2))
}else{ratio=dx/dy
}this.feature.geometry.resize(1,this.origin,ratio);
this.feature.geometry.move(dx/2,dy/2)
}this.layer.drawFeature(this.feature,this.style)
},up:function(evt){this.finalize();
if(this.start==this.last){this.callback("done",[evt.xy])
}},out:function(evt){this.finalize()
},createGeometry:function(){this.angle=Math.PI*((1/this.sides)-(1/2));
if(this.snapAngle){this.angle+=this.snapAngle*(Math.PI/180)
}this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)
},modifyGeometry:function(){var angle,point;
var ring=this.feature.geometry.components[0];
if(ring.components.length!=(this.sides+1)){this.createGeometry();
ring=this.feature.geometry.components[0]
}for(var i=0;
i<this.sides;
++i){point=ring.components[i];
angle=this.angle+(i*2*Math.PI/this.sides);
point.x=this.origin.x+(this.radius*Math.cos(angle));
point.y=this.origin.y+(this.radius*Math.sin(angle));
point.clearBounds()
}},calculateAngle:function(point,evt){var alpha=Math.atan2(point.y-this.origin.y,point.x-this.origin.x);
if(this.snapAngle&&(this.snapToggle&&!evt[this.snapToggle])){var snapAngleRad=(Math.PI/180)*this.snapAngle;
this.angle=Math.round(alpha/snapAngleRad)*snapAngleRad
}else{this.angle=alpha
}},cancel:function(){this.callback("cancel",null);
this.finalize()
},finalize:function(){this.origin=null;
this.radius=this.options.radius
},clear:function(){if(this.layer){this.layer.renderer.clear();
this.layer.destroyFeatures()
}},callback:function(name,args){if(this.callbacks[name]){this.callbacks[name].apply(this.control,[this.feature.geometry.clone()])
}if(!this.persist&&(name=="done"||name=="cancel")){this.clear()
}},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"});
OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})
},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);
if(this.dragHandler){this.dragHandler.destroy();
this.dragHandler=null
}},setMap:function(map){OpenLayers.Handler.prototype.setMap.apply(this,arguments);
if(this.dragHandler){this.dragHandler.setMap(map)
}},startBox:function(xy){this.callback("start",[]);
this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});
this.zoomBox.className=this.boxDivClassName;
this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;
this.map.viewPortDiv.appendChild(this.zoomBox);
OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")
},moveBox:function(xy){var startX=this.dragHandler.start.x;
var startY=this.dragHandler.start.y;
var deltaX=Math.abs(startX-xy.x);
var deltaY=Math.abs(startY-xy.y);
var offset=this.getBoxOffsets();
this.zoomBox.style.width=(deltaX+offset.width+1)+"px";
this.zoomBox.style.height=(deltaY+offset.height+1)+"px";
this.zoomBox.style.left=(xy.x<startX?startX-deltaX-offset.left:startX-offset.left)+"px";
this.zoomBox.style.top=(xy.y<startY?startY-deltaY-offset.top:startY-offset.top)+"px"
},endBox:function(end){var result;
if(Math.abs(this.dragHandler.start.x-end.x)>5||Math.abs(this.dragHandler.start.y-end.y)>5){var start=this.dragHandler.start;
var top=Math.min(start.y,end.y);
var bottom=Math.max(start.y,end.y);
var left=Math.min(start.x,end.x);
var right=Math.max(start.x,end.x);
result=new OpenLayers.Bounds(left,bottom,right,top)
}else{result=this.dragHandler.start.clone()
}this.removeBox();
this.callback("done",[result])
},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);
this.zoomBox=null;
this.boxOffsets=null;
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")
},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();
return true
}else{return false
}},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){if(this.dragHandler.deactivate()){if(this.zoomBox){this.removeBox()
}}return true
}else{return false
}},getBoxOffsets:function(){if(!this.boxOffsets){var testDiv=document.createElement("div");
testDiv.style.position="absolute";
testDiv.style.border="1px solid black";
testDiv.style.width="3px";
document.body.appendChild(testDiv);
var w3cBoxModel=testDiv.clientWidth==3;
document.body.removeChild(testDiv);
var left=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width"));
var right=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width"));
var top=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width"));
var bottom=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));
this.boxOffsets={left:left,right:right,top:top,bottom:bottom,width:w3cBoxModel===false?left+right:0,height:w3cBoxModel===false?top+bottom:0}
}return this.boxOffsets
},CLASS_NAME:"OpenLayers.Handler.Box"});
OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:true,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)
},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);
this.wheelListener=null
},onWheelEvent:function(e){if(!this.map||!this.checkModifiers(e)){return
}var overScrollableDiv=false;
var overLayerDiv=false;
var overMapDiv=false;
var elem=OpenLayers.Event.element(e);
while((elem!=null)&&!overMapDiv&&!overScrollableDiv){if(!overScrollableDiv){try{if(elem.currentStyle){overflow=elem.currentStyle.overflow
}else{var style=document.defaultView.getComputedStyle(elem,null);
var overflow=style.getPropertyValue("overflow")
}overScrollableDiv=(overflow&&(overflow=="auto")||(overflow=="scroll"))
}catch(err){}}if(!overLayerDiv){for(var i=0,len=this.map.layers.length;
i<len;
i++){if(elem==this.map.layers[i].div||elem==this.map.layers[i].pane){overLayerDiv=true;
break
}}}overMapDiv=(elem==this.map.div);
elem=elem.parentNode
}if(!overScrollableDiv&&overMapDiv){if(overLayerDiv){var delta=0;
if(!e){e=window.event
}if(e.wheelDelta){delta=e.wheelDelta/120;
if(window.opera&&window.opera.version()<9.2){delta=-delta
}}else{if(e.detail){delta=-e.detail/3
}}this.delta=this.delta+delta;
if(this.interval){window.clearTimeout(this._timeoutId);
this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(e)
},this),this.interval)
}else{this.wheelZoom(e)
}}OpenLayers.Event.stop(e)
}},wheelZoom:function(e){var delta=this.delta;
this.delta=0;
if(delta){if(this.mousePosition){e.xy=this.mousePosition
}if(!e.xy){e.xy=this.map.getPixelFromLonLat(this.map.getCenter())
}if(delta<0){this.callback("down",[e,this.cumulative?delta:-1])
}else{this.callback("up",[e,this.cumulative?delta:1])
}}},mousemove:function(evt){this.mousePosition=evt.xy
},activate:function(evt){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var wheelListener=this.wheelListener;
OpenLayers.Event.observe(window,"DOMMouseScroll",wheelListener);
OpenLayers.Event.observe(window,"mousewheel",wheelListener);
OpenLayers.Event.observe(document,"mousewheel",wheelListener);
return true
}else{return false
}},deactivate:function(evt){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var wheelListener=this.wheelListener;
OpenLayers.Event.stopObserving(window,"DOMMouseScroll",wheelListener);
OpenLayers.Event.stopObserving(window,"mousewheel",wheelListener);
OpenLayers.Event.stopObserving(document,"mousewheel",wheelListener);
return true
}else{return false
}},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});
OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(control,callbacks,options){OpenLayers.Handler.prototype.initialize.apply(this,arguments);
this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)
},destroy:function(){this.deactivate();
this.eventListener=null;
OpenLayers.Handler.prototype.destroy.apply(this,arguments)
},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;
for(var i=0,len=this.KEY_EVENTS.length;
i<len;
i++){OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[i],this.eventListener)
}return true
}else{return false
}},deactivate:function(){var deactivated=false;
if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var i=0,len=this.KEY_EVENTS.length;
i<len;
i++){OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[i],this.eventListener)
}deactivated=true
}return deactivated
},handleKeyEvent:function(evt){if(this.checkModifiers(evt)){this.callback(evt.type,[evt])
}},CLASS_NAME:"OpenLayers.Handler.Keyboard"});
OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:false,displayClass:"",title:"",autoActivate:false,active:null,handler:null,eventListeners:null,events:null,initialize:function(options){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");
OpenLayers.Util.extend(this,options);
this.events=new OpenLayers.Events(this);
if(this.eventListeners instanceof Object){this.events.on(this.eventListeners)
}if(this.id==null){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
}},destroy:function(){if(this.events){if(this.eventListeners){this.events.un(this.eventListeners)
}this.events.destroy();
this.events=null
}this.eventListeners=null;
if(this.handler){this.handler.destroy();
this.handler=null
}if(this.handlers){for(var key in this.handlers){if(this.handlers.hasOwnProperty(key)&&typeof this.handlers[key].destroy=="function"){this.handlers[key].destroy()
}}this.handlers=null
}if(this.map){this.map.removeControl(this);
this.map=null
}this.div=null
},setMap:function(map){this.map=map;
if(this.handler){this.handler.setMap(map)
}},draw:function(px){if(this.div==null){this.div=OpenLayers.Util.createDiv(this.id);
this.div.className=this.displayClass;
if(!this.allowSelection){this.div.className+=" olControlNoSelect";
this.div.setAttribute("unselectable","on",0);
this.div.onselectstart=OpenLayers.Function.False
}if(this.title!=""){this.div.title=this.title
}}if(px!=null){this.position=px.clone()
}this.moveTo(this.position);
return this.div
},moveTo:function(px){if((px!=null)&&(this.div!=null)){this.div.style.left=px.x+"px";
this.div.style.top=px.y+"px"
}},activate:function(){if(this.active){return false
}if(this.handler){this.handler.activate()
}this.active=true;
if(this.map){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")
}this.events.triggerEvent("activate");
return true
},deactivate:function(){if(this.active){if(this.handler){this.handler.deactivate()
}this.active=false;
if(this.map){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active")
}this.events.triggerEvent("deactivate");
return true
}return false
},CLASS_NAME:"OpenLayers.Control"});
OpenLayers.Control.TYPE_BUTTON=1;
OpenLayers.Control.TYPE_TOGGLE=2;
OpenLayers.Control.TYPE_TOOL=3;
OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this});
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this});
this.updateAttribution();
return this.div
},updateAttribution:function(){var attributions=[];
if(this.map&&this.map.layers){for(var i=0,len=this.map.layers.length;
i<len;
i++){var layer=this.map.layers[i];
if(layer.attribution&&layer.getVisibility()){if(OpenLayers.Util.indexOf(attributions,layer.attribution)===-1){attributions.push(layer.attribution)
}}}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:attributions.join(this.separator)})
}},CLASS_NAME:"OpenLayers.Control.Attribution"});
OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});
OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:true,setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);
var i,layers=this.layers||map.layers;
for(i=layers.length-1;
i>=0;
--i){this.addLayer({layer:layers[i]})
}if(!this.layers){map.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})
}},addLayer:function(evt){evt.layer.events.register(this.fetchEvent,this,this.fetch)
},removeLayer:function(evt){evt.layer.events.unregister(this.fetchEvent,this,this.fetch)
},fetch:function(evt){if(this.active&&window.localStorage&&evt.tile instanceof OpenLayers.Tile.Image){var tile=evt.tile,url=tile.url;
if(!tile.layer.crossOriginKeyword&&OpenLayers.ProxyHost&&url.indexOf(OpenLayers.ProxyHost)===0){url=OpenLayers.Control.CacheWrite.urlMap[url]
}var dataURI=window.localStorage.getItem("olCache_"+url);
if(dataURI){tile.url=dataURI;
if(evt.type==="tileerror"){tile.setImgSrc(dataURI)
}}}},destroy:function(){if(this.layers||this.map){var i,layers=this.layers||this.map.layers;
for(i=layers.length-1;
i>=0;
--i){this.removeLayer({layer:layers[i]})
}}if(this.map){this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})
}OpenLayers.Control.prototype.destroy.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Control.CacheRead"});
OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:(/quota/i),setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);
var i,layers=this.layers||map.layers;
for(i=layers.length-1;
i>=0;
--i){this.addLayer({layer:layers[i]})
}if(!this.layers){map.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})
}},addLayer:function(evt){evt.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})
},removeLayer:function(evt){evt.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})
},makeSameOrigin:function(evt){if(this.active){var tile=evt.tile;
if(tile instanceof OpenLayers.Tile.Image&&!tile.crossOriginKeyword&&tile.url.substr(0,5)!=="data:"){var sameOriginUrl=OpenLayers.Request.makeSameOrigin(tile.url,OpenLayers.ProxyHost);
OpenLayers.Control.CacheWrite.urlMap[sameOriginUrl]=tile.url;
tile.url=sameOriginUrl
}}},cache:function(obj){if(this.active&&window.localStorage){var tile=obj.tile;
if(tile instanceof OpenLayers.Tile.Image&&tile.url.substr(0,5)!=="data:"){try{var canvasContext=tile.getCanvasContext();
if(canvasContext){var urlMap=OpenLayers.Control.CacheWrite.urlMap;
var url=urlMap[tile.url]||tile.url;
window.localStorage.setItem("olCache_"+url,canvasContext.canvas.toDataURL(this.imageFormat));
delete urlMap[tile.url]
}}catch(e){var reason=e.name||e.message;
if(reason&&this.quotaRegEx.test(reason)){this.events.triggerEvent("cachefull",{tile:tile})
}else{OpenLayers.Console.error(e.toString())
}}}}},destroy:function(){if(this.layers||this.map){var i,layers=this.layers||this.map.layers;
for(i=layers.length-1;
i>=0;
--i){this.removeLayer({layer:layers[i]})
}}if(this.map){this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})
}OpenLayers.Control.prototype.destroy.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Control.CacheWrite"});
OpenLayers.Control.CacheWrite.clearCache=function(){if(!window.localStorage){return
}var i,key;
for(i=window.localStorage.length-1;
i>=0;
--i){key=window.localStorage.key(i);
if(key.substr(0,8)==="olCache_"){window.localStorage.removeItem(key)
}}};
OpenLayers.Control.CacheWrite.urlMap={};
OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:false,keyMask:null,alwaysZoom:false,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})
},zoomBox:function(position){if(position instanceof OpenLayers.Bounds){var bounds;
if(!this.out){var minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom});
var maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top});
bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat)
}else{var pixWidth=Math.abs(position.right-position.left);
var pixHeight=Math.abs(position.top-position.bottom);
var zoomFactor=Math.min((this.map.size.h/pixHeight),(this.map.size.w/pixWidth));
var extent=this.map.getExtent();
var center=this.map.getLonLatFromPixel(position.getCenterPixel());
var xmin=center.lon-(extent.getWidth()/2)*zoomFactor;
var xmax=center.lon+(extent.getWidth()/2)*zoomFactor;
var ymin=center.lat-(extent.getHeight()/2)*zoomFactor;
var ymax=center.lat+(extent.getHeight()/2)*zoomFactor;
bounds=new OpenLayers.Bounds(xmin,ymin,xmax,ymax)
}var lastZoom=this.map.getZoom();
this.map.zoomToExtent(bounds);
if(lastZoom==this.map.getZoom()&&this.alwaysZoom==true){this.map.zoomTo(lastZoom+(this.out?-1:1))
}}else{if(!this.out){this.map.setCenter(this.map.getLonLatFromPixel(position),this.map.getZoom()+1)
}else{this.map.setCenter(this.map.getLonLatFromPixel(position),this.map.getZoom()-1)
}}},CLASS_NAME:"OpenLayers.Control.ZoomBox"});
OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){if(this.map){this.map.zoomToMaxExtent()
}},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"});
OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:false,interval:1,documentDrag:false,kinetic:null,enableKinetic:false,kineticInterval:10,draw:function(){if(this.enableKinetic){var config={interval:this.kineticInterval};
if(typeof this.enableKinetic==="object"){config=OpenLayers.Util.extend(config,this.enableKinetic)
}this.kinetic=new OpenLayers.Kinetic(config)
}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})
},panMapStart:function(){if(this.kinetic){this.kinetic.begin()
}},panMap:function(xy){if(this.kinetic){this.kinetic.update(xy)
}this.panned=true;
this.map.pan(this.handler.last.x-xy.x,this.handler.last.y-xy.y,{dragging:true,animate:false})
},panMapDone:function(xy){if(this.panned){var res=null;
if(this.kinetic){res=this.kinetic.end(xy)
}this.map.pan(this.handler.last.x-xy.x,this.handler.last.y-xy.y,{dragging:!!res,animate:false});
if(res){var self=this;
this.kinetic.move(res,function(x,y,end){self.map.pan(x,y,{dragging:!end,animate:false})
})
}this.panned=false
}},CLASS_NAME:"OpenLayers.Control.DragPan"});
OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:false,zoomBox:null,zoomBoxEnabled:true,zoomWheelEnabled:true,mouseWheelOptions:null,handleRightClicks:false,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:true,initialize:function(options){this.handlers={};
OpenLayers.Control.prototype.initialize.apply(this,arguments)
},destroy:function(){this.deactivate();
if(this.dragPan){this.dragPan.destroy()
}this.dragPan=null;
if(this.zoomBox){this.zoomBox.destroy()
}this.zoomBox=null;
if(this.pinchZoom){this.pinchZoom.destroy()
}this.pinchZoom=null;
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},activate:function(){this.dragPan.activate();
if(this.zoomWheelEnabled){this.handlers.wheel.activate()
}this.handlers.click.activate();
if(this.zoomBoxEnabled){this.zoomBox.activate()
}if(this.pinchZoom){this.pinchZoom.activate()
}return OpenLayers.Control.prototype.activate.apply(this,arguments)
},deactivate:function(){if(this.pinchZoom){this.pinchZoom.deactivate()
}this.zoomBox.deactivate();
this.dragPan.deactivate();
this.handlers.click.deactivate();
this.handlers.wheel.deactivate();
return OpenLayers.Control.prototype.deactivate.apply(this,arguments)
},draw:function(){if(this.handleRightClicks){this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False
}var clickCallbacks={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick};
var clickOptions={"double":true,stopDouble:true};
this.handlers.click=new OpenLayers.Handler.Click(this,clickCallbacks,clickOptions);
this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));
this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});
this.dragPan.draw();
this.zoomBox.draw();
this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions);
if(OpenLayers.Control.PinchZoom){this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))
}},defaultClick:function(evt){if(evt.lastTouches&&evt.lastTouches.length==2){this.map.zoomOut()
}},defaultDblClick:function(evt){var newCenter=this.map.getLonLatFromViewPortPx(evt.xy);
this.map.setCenter(newCenter,this.map.zoom+1)
},defaultDblRightClick:function(evt){var newCenter=this.map.getLonLatFromViewPortPx(evt.xy);
this.map.setCenter(newCenter,this.map.zoom-1)
},wheelChange:function(evt,deltaZ){var currentZoom=this.map.getZoom();
var newZoom=this.map.getZoom()+Math.round(deltaZ);
newZoom=Math.max(newZoom,0);
newZoom=Math.min(newZoom,this.map.getNumZoomLevels());
if(newZoom===currentZoom){return
}var size=this.map.getSize();
var deltaX=size.w/2-evt.xy.x;
var deltaY=evt.xy.y-size.h/2;
var newRes=this.map.baseLayer.getResolutionForZoom(newZoom);
var zoomPoint=this.map.getLonLatFromPixel(evt.xy);
var newCenter=new OpenLayers.LonLat(zoomPoint.lon+deltaX*newRes,zoomPoint.lat+deltaY*newRes);
this.map.setCenter(newCenter,newZoom)
},wheelUp:function(evt,delta){this.wheelChange(evt,delta||1)
},wheelDown:function(evt,delta){this.wheelChange(evt,delta||-1)
},disableZoomBox:function(){this.zoomBoxEnabled=false;
this.zoomBox.deactivate()
},enableZoomBox:function(){this.zoomBoxEnabled=true;
if(this.active){this.zoomBox.activate()
}},disableZoomWheel:function(){this.zoomWheelEnabled=false;
this.handlers.wheel.deactivate()
},enableZoomWheel:function(){this.zoomWheelEnabled=true;
if(this.active){this.handlers.wheel.activate()
}},CLASS_NAME:"OpenLayers.Control.Navigation"});
OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerCenter:null,pinchOrigin:null,currentCenter:null,autoActivate:true,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,arguments);
this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)
},activate:function(){var activated=OpenLayers.Control.prototype.activate.apply(this,arguments);
if(activated){this.map.events.on({moveend:this.updateContainerCenter,scope:this});
this.updateContainerCenter()
}return activated
},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.apply(this,arguments);
if(this.map&&this.map.events){this.map.events.un({moveend:this.updateContainerCenter,scope:this})
}return deactivated
},updateContainerCenter:function(){var container=this.map.layerContainerDiv;
this.containerCenter={x:parseInt(container.style.left,10)+50,y:parseInt(container.style.top,10)+50}
},pinchStart:function(evt,pinchData){this.pinchOrigin=evt.xy;
this.currentCenter=evt.xy
},pinchMove:function(evt,pinchData){var scale=pinchData.scale;
var containerCenter=this.containerCenter;
var pinchOrigin=this.pinchOrigin;
var current=evt.xy;
var dx=Math.round((current.x-pinchOrigin.x)+(scale-1)*(containerCenter.x-pinchOrigin.x));
var dy=Math.round((current.y-pinchOrigin.y)+(scale-1)*(containerCenter.y-pinchOrigin.y));
this.applyTransform("translate("+dx+"px, "+dy+"px) scale("+scale+")");
this.currentCenter=current
},applyTransform:function(transform){var style=this.map.layerContainerDiv.style;
style["-webkit-transform"]=transform;
style["-moz-transform"]=transform
},pinchDone:function(evt,start,last){this.applyTransform("");
var zoom=this.map.getZoomForResolution(this.map.getResolution()/last.scale,true);
if(zoom!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var resolution=this.map.getResolutionForZoom(zoom);
var location=this.map.getLonLatFromPixel(this.pinchOrigin);
var zoomPixel=this.currentCenter;
var size=this.map.getSize();
location.lon+=resolution*((size.w/2)-zoomPixel.x);
location.lat-=resolution*((size.h/2)-zoomPixel.y);
this.map.div.clientWidth=this.map.div.clientWidth;
this.map.setCenter(location,zoom)
}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});
OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:false,autoActivate:true,initialize:function(options){this.handlers={};
OpenLayers.Control.prototype.initialize.apply(this,arguments)
},destroy:function(){this.deactivate();
if(this.dragPan){this.dragPan.destroy()
}this.dragPan=null;
if(this.pinchZoom){this.pinchZoom.destroy();
delete this.pinchZoom
}OpenLayers.Control.prototype.destroy.apply(this,arguments)
},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.dragPan.activate();
this.handlers.click.activate();
this.pinchZoom.activate();
return true
}return false
},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.dragPan.deactivate();
this.handlers.click.deactivate();
this.pinchZoom.deactivate();
return true
}return false
},draw:function(){var clickCallbacks={click:this.defaultClick,dblclick:this.defaultDblClick};
var clickOptions=OpenLayers.Util.extend({"double":true,stopDouble:true,pixelTolerance:2},this.clickHandlerOptions);
this.handlers.click=new OpenLayers.Handler.Click(this,clickCallbacks,clickOptions);
this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));
this.dragPan.draw();
this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))
},defaultClick:function(evt){if(evt.lastTouches&&evt.lastTouches.length==2){this.map.zoomOut()
}},defaultDblClick:function(evt){var newCenter=this.map.getLonLatFromViewPortPx(evt.xy);
this.map.setCenter(newCenter,this.map.zoom+1)
},CLASS_NAME:"OpenLayers.Control.TouchNavigation"});
OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate();
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.events.register("mousemove",this,this.redraw);
this.map.events.register("mouseout",this,this.reset);
this.redraw();
return true
}else{return false
}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("mousemove",this,this.redraw);
this.map.events.unregister("mouseout",this,this.reset);
this.element.innerHTML="";
return true
}else{return false
}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(!this.element){this.div.left="";
this.div.top="";
this.element=this.div
}return this.div
},redraw:function(evt){var lonLat;
if(evt==null){this.reset();
return
}else{if(this.lastXy==null||Math.abs(evt.xy.x-this.lastXy.x)>this.granularity||Math.abs(evt.xy.y-this.lastXy.y)>this.granularity){this.lastXy=evt.xy;
return
}lonLat=this.map.getLonLatFromPixel(evt.xy);
if(!lonLat){return
}if(this.displayProjection){lonLat.transform(this.map.getProjectionObject(),this.displayProjection)
}this.lastXy=evt.xy
}var newHtml=this.formatOutput(lonLat);
if(newHtml!=this.element.innerHTML){this.element.innerHTML=newHtml
}},reset:function(evt){if(this.emptyString!=null){this.element.innerHTML=this.emptyString
}},formatOutput:function(lonLat){var digits=parseInt(this.numDigits);
var newHtml=this.prefix+lonLat.lon.toFixed(digits)+this.separator+lonLat.lat.toFixed(digits)+this.suffix;
return newHtml
},CLASS_NAME:"OpenLayers.Control.MousePosition"});
OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:false,handlers:null,resolutionFactor:1,maximized:false,initialize:function(options){this.layers=[];
this.handlers={};
OpenLayers.Control.prototype.initialize.apply(this,[options])
},destroy:function(){if(!this.mapDiv){return
}if(this.handlers.click){this.handlers.click.destroy()
}if(this.handlers.drag){this.handlers.drag.destroy()
}this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle);
this.extentRectangle=null;
if(this.rectEvents){this.rectEvents.destroy();
this.rectEvents=null
}if(this.ovmap){this.ovmap.destroy();
this.ovmap=null
}this.element.removeChild(this.mapDiv);
this.mapDiv=null;
this.div.removeChild(this.element);
this.element=null;
if(this.maximizeDiv){this.div.removeChild(this.maximizeDiv);
this.maximizeDiv=null
}if(this.minimizeDiv){this.div.removeChild(this.minimizeDiv);
this.minimizeDiv=null
}this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(this.layers.length===0){if(this.map.baseLayer){var layer=this.map.baseLayer.clone();
this.layers=[layer]
}else{this.map.events.register("changebaselayer",this,this.baseLayerDraw);
return this.div
}}this.element=document.createElement("div");
this.element.className=this.displayClass+"Element";
this.element.style.display="none";
this.mapDiv=document.createElement("div");
this.mapDiv.style.width=this.size.w+"px";
this.mapDiv.style.height=this.size.h+"px";
this.mapDiv.style.position="relative";
this.mapDiv.style.overflow="hidden";
this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");
this.extentRectangle=document.createElement("div");
this.extentRectangle.style.position="absolute";
this.extentRectangle.style.zIndex=1000;
this.extentRectangle.className=this.displayClass+"ExtentRectangle";
this.element.appendChild(this.mapDiv);
this.div.appendChild(this.element);
if(!this.outsideViewport){this.div.className+=" "+this.displayClass+"Container";
var img=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");
this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,img,"absolute");
this.maximizeDiv.style.display="none";
this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";
this.div.appendChild(this.maximizeDiv);
var img=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");
this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,img,"absolute");
this.minimizeDiv.style.display="none";
this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";
this.div.appendChild(this.minimizeDiv);
this.minimizeControl()
}else{this.element.style.display=""
}if(this.map.getExtent()){this.update()
}this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});
if(this.maximized){this.maximizeControl()
}return this.div
},baseLayerDraw:function(){this.draw();
this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)
},rectDrag:function(px){var deltaX=this.handlers.drag.last.x-px.x;
var deltaY=this.handlers.drag.last.y-px.y;
if(deltaX!=0||deltaY!=0){var rectTop=this.rectPxBounds.top;
var rectLeft=this.rectPxBounds.left;
var rectHeight=Math.abs(this.rectPxBounds.getHeight());
var rectWidth=this.rectPxBounds.getWidth();
var newTop=Math.max(0,(rectTop-deltaY));
newTop=Math.min(newTop,this.ovmap.size.h-this.hComp-rectHeight);
var newLeft=Math.max(0,(rectLeft-deltaX));
newLeft=Math.min(newLeft,this.ovmap.size.w-this.wComp-rectWidth);
this.setRectPxBounds(new OpenLayers.Bounds(newLeft,newTop+rectHeight,newLeft+rectWidth,newTop))
}},mapDivClick:function(evt){var pxCenter=this.rectPxBounds.getCenterPixel();
var deltaX=evt.xy.x-pxCenter.x;
var deltaY=evt.xy.y-pxCenter.y;
var top=this.rectPxBounds.top;
var left=this.rectPxBounds.left;
var height=Math.abs(this.rectPxBounds.getHeight());
var width=this.rectPxBounds.getWidth();
var newTop=Math.max(0,(top+deltaY));
newTop=Math.min(newTop,this.ovmap.size.h-height);
var newLeft=Math.max(0,(left+deltaX));
newLeft=Math.min(newLeft,this.ovmap.size.w-width);
this.setRectPxBounds(new OpenLayers.Bounds(newLeft,newTop+height,newLeft+width,newTop));
this.updateMapToRect()
},onButtonClick:function(evt){if(evt.buttonElement===this.minimizeDiv){this.minimizeControl()
}else{if(evt.buttonElement===this.maximizeDiv){this.maximizeControl()
}}},maximizeControl:function(e){this.element.style.display="";
this.showToggle(false);
if(e!=null){OpenLayers.Event.stop(e)
}},minimizeControl:function(e){this.element.style.display="none";
this.showToggle(true);
if(e!=null){OpenLayers.Event.stop(e)
}},showToggle:function(minimize){this.maximizeDiv.style.display=minimize?"":"none";
this.minimizeDiv.style.display=minimize?"none":""
},update:function(){if(this.ovmap==null){this.createMap()
}if(this.autoPan||!this.isSuitableOverview()){this.updateOverview()
}this.updateRectToMap()
},isSuitableOverview:function(){var mapExtent=this.map.getExtent();
var maxExtent=this.map.maxExtent;
var testExtent=new OpenLayers.Bounds(Math.max(mapExtent.left,maxExtent.left),Math.max(mapExtent.bottom,maxExtent.bottom),Math.min(mapExtent.right,maxExtent.right),Math.min(mapExtent.top,maxExtent.top));
if(this.ovmap.getProjection()!=this.map.getProjection()){testExtent=testExtent.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())
}var resRatio=this.ovmap.getResolution()/this.map.getResolution();
return((resRatio>this.minRatio)&&(resRatio<=this.maxRatio)&&(this.ovmap.getExtent().containsBounds(testExtent)))
},updateOverview:function(){var mapRes=this.map.getResolution();
var targetRes=this.ovmap.getResolution();
var resRatio=targetRes/mapRes;
if(resRatio>this.maxRatio){targetRes=this.minRatio*mapRes
}else{if(resRatio<=this.minRatio){targetRes=this.maxRatio*mapRes
}}var center;
if(this.ovmap.getProjection()!=this.map.getProjection()){center=this.map.center.clone();
center.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())
}else{center=this.map.center
}this.ovmap.setCenter(center,this.ovmap.getZoomForResolution(targetRes*this.resolutionFactor));
this.updateRectToMap()
},createMap:function(){var options=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:false},this.mapOptions);
this.ovmap=new OpenLayers.Map(this.mapDiv,options);
this.ovmap.viewPortDiv.appendChild(this.extentRectangle);
OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);
this.ovmap.addLayers(this.layers);
this.ovmap.zoomToMaxExtent();
this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));
this.wComp=(this.wComp)?this.wComp:2;
this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));
this.hComp=(this.hComp)?this.hComp:2;
this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});
this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:true,"double":false,stopSingle:true,stopDouble:true,pixelTolerance:1,map:this.ovmap});
this.handlers.click.activate();
this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,true);
this.rectEvents.register("mouseover",this,function(e){if(!this.handlers.drag.active&&!this.map.dragging){this.handlers.drag.activate()
}});
this.rectEvents.register("mouseout",this,function(e){if(!this.handlers.drag.dragging){this.handlers.drag.deactivate()
}});
if(this.ovmap.getProjection()!=this.map.getProjection()){var sourceUnits=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;
var targetUnits=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;
this.resolutionFactor=sourceUnits&&targetUnits?OpenLayers.INCHES_PER_UNIT[sourceUnits]/OpenLayers.INCHES_PER_UNIT[targetUnits]:1
}},updateRectToMap:function(){var bounds;
if(this.ovmap.getProjection()!=this.map.getProjection()){bounds=this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())
}else{bounds=this.map.getExtent()
}var pxBounds=this.getRectBoundsFromMapBounds(bounds);
if(pxBounds){this.setRectPxBounds(pxBounds)
}},updateMapToRect:function(){var lonLatBounds=this.getMapBoundsFromRectBounds(this.rectPxBounds);
if(this.ovmap.getProjection()!=this.map.getProjection()){lonLatBounds=lonLatBounds.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())
}this.map.panTo(lonLatBounds.getCenterLonLat())
},setRectPxBounds:function(pxBounds){var top=Math.max(pxBounds.top,0);
var left=Math.max(pxBounds.left,0);
var bottom=Math.min(pxBounds.top+Math.abs(pxBounds.getHeight()),this.ovmap.size.h-this.hComp);
var right=Math.min(pxBounds.left+pxBounds.getWidth(),this.ovmap.size.w-this.wComp);
var width=Math.max(right-left,0);
var height=Math.max(bottom-top,0);
if(width<this.minRectSize||height<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;
var rLeft=left+(width/2)-(this.minRectSize/2);
var rTop=top+(height/2)-(this.minRectSize/2);
this.extentRectangle.style.top=Math.round(rTop)+"px";
this.extentRectangle.style.left=Math.round(rLeft)+"px";
this.extentRectangle.style.height=this.minRectSize+"px";
this.extentRectangle.style.width=this.minRectSize+"px"
}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";
this.extentRectangle.style.top=Math.round(top)+"px";
this.extentRectangle.style.left=Math.round(left)+"px";
this.extentRectangle.style.height=Math.round(height)+"px";
this.extentRectangle.style.width=Math.round(width)+"px"
}this.rectPxBounds=new OpenLayers.Bounds(Math.round(left),Math.round(bottom),Math.round(right),Math.round(top))
},getRectBoundsFromMapBounds:function(lonLatBounds){var leftBottomPx=this.getOverviewPxFromLonLat({lon:lonLatBounds.left,lat:lonLatBounds.bottom});
var rightTopPx=this.getOverviewPxFromLonLat({lon:lonLatBounds.right,lat:lonLatBounds.top});
var bounds=null;
if(leftBottomPx&&rightTopPx){bounds=new OpenLayers.Bounds(leftBottomPx.x,leftBottomPx.y,rightTopPx.x,rightTopPx.y)
}return bounds
},getMapBoundsFromRectBounds:function(pxBounds){var leftBottomLonLat=this.getLonLatFromOverviewPx({x:pxBounds.left,y:pxBounds.bottom});
var rightTopLonLat=this.getLonLatFromOverviewPx({x:pxBounds.right,y:pxBounds.top});
return new OpenLayers.Bounds(leftBottomLonLat.lon,leftBottomLonLat.lat,rightTopLonLat.lon,rightTopLonLat.lat)
},getLonLatFromOverviewPx:function(overviewMapPx){var size=this.ovmap.size;
var res=this.ovmap.getResolution();
var center=this.ovmap.getExtent().getCenterLonLat();
var deltaX=overviewMapPx.x-(size.w/2);
var deltaY=overviewMapPx.y-(size.h/2);
return{lon:center.lon+deltaX*res,lat:center.lat-deltaY*res}
},getOverviewPxFromLonLat:function(lonlat){var res=this.ovmap.getResolution();
var extent=this.ovmap.getExtent();
if(extent){return{x:Math.round(1/res*(lonlat.lon-extent.left)),y:Math.round(1/res*(extent.top-lonlat.lat))}
}},CLASS_NAME:"OpenLayers.Control.OverviewMap"});
OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,slideFactor:75,observeElement:null,draw:function(){var observeElement=this.observeElement||document;
this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:observeElement})
},defaultKeyPress:function(evt){var size,handled=true;
switch(evt.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);
break;
case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);
break;
case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);
break;
case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);
break;
case 33:size=this.map.getSize();
this.map.pan(0,-0.75*size.h);
break;
case 34:size=this.map.getSize();
this.map.pan(0,0.75*size.h);
break;
case 35:size=this.map.getSize();
this.map.pan(0.75*size.w,0);
break;
case 36:size=this.map.getSize();
this.map.pan(-0.75*size.w,0);
break;
case 43:case 61:case 187:case 107:this.map.zoomIn();
break;
case 45:case 109:case 189:case 95:this.map.zoomOut();
break;
default:handled=false
}if(handled){OpenLayers.Event.stop(evt)
}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});
OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(options){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);
OpenLayers.Control.prototype.initialize.apply(this,arguments)
},destroy:function(){if(this.map){this.map.events.unregister("buttonclick",this,this.onButtonClick)
}this.removeButtons();
this.buttons=null;
this.position=null;
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);
this.map.events.register("buttonclick",this,this.onButtonClick)
},draw:function(px){OpenLayers.Control.prototype.draw.apply(this,arguments);
px=this.position;
this.buttons=[];
var sz={w:18,h:18};
var centered=new OpenLayers.Pixel(px.x+sz.w/2,px.y);
this._addButton("panup","north-mini.png",centered,sz);
px.y=centered.y+sz.h;
this._addButton("panleft","west-mini.png",px,sz);
this._addButton("panright","east-mini.png",px.add(sz.w,0),sz);
this._addButton("pandown","south-mini.png",centered.add(0,sz.h*2),sz);
this._addButton("zoomin","zoom-plus-mini.png",centered.add(0,sz.h*3+5),sz);
this._addButton("zoomworld","zoom-world-mini.png",centered.add(0,sz.h*4+5),sz);
this._addButton("zoomout","zoom-minus-mini.png",centered.add(0,sz.h*5+5),sz);
return this.div
},_addButton:function(id,img,xy,sz){var imgLocation=OpenLayers.Util.getImageLocation(img);
var btn=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+id,xy,sz,imgLocation,"absolute");
btn.style.cursor="pointer";
this.div.appendChild(btn);
btn.action=id;
btn.className="olButton";
this.buttons.push(btn);
return btn
},_removeButton:function(btn){this.div.removeChild(btn);
OpenLayers.Util.removeItem(this.buttons,btn)
},removeButtons:function(){for(var i=this.buttons.length-1;
i>=0;
--i){this._removeButton(this.buttons[i])
}},onButtonClick:function(evt){var btn=evt.buttonElement;
switch(btn.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));
break;
case"pandown":this.map.pan(0,this.getSlideFactor("h"));
break;
case"panleft":this.map.pan(-this.getSlideFactor("w"),0);
break;
case"panright":this.map.pan(this.getSlideFactor("w"),0);
break;
case"zoomin":this.map.zoomIn();
break;
case"zoomout":this.map.zoomOut();
break;
case"zoomworld":this.map.zoomToMaxExtent();
break
}},getSlideFactor:function(dim){return this.slideRatio?this.map.getSize()[dim]*this.slideRatio:this.slideFactor
},CLASS_NAME:"OpenLayers.Control.PanZoom"});
OpenLayers.Control.PanZoom.X=4;
OpenLayers.Control.PanZoom.Y=4;
OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:false,panIcons:true,forceFixedZoomLevel:false,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();
this.map.events.un({changebaselayer:this.redraw,scope:this});
OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);
delete this.mouseDragStart;
delete this.zoomStart
},setMap:function(map){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);
this.map.events.register("changebaselayer",this,this.redraw)
},redraw:function(){if(this.div!=null){this.removeButtons();
this._removeZoomBar()
}this.draw()
},draw:function(px){OpenLayers.Control.prototype.draw.apply(this,arguments);
px=this.position.clone();
this.buttons=[];
var sz={w:18,h:18};
if(this.panIcons){var centered=new OpenLayers.Pixel(px.x+sz.w/2,px.y);
var wposition=sz.w;
if(this.zoomWorldIcon){centered=new OpenLayers.Pixel(px.x+sz.w,px.y)
}this._addButton("panup","north-mini.png",centered,sz);
px.y=centered.y+sz.h;
this._addButton("panleft","west-mini.png",px,sz);
if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",px.add(sz.w,0),sz);
wposition*=2
}this._addButton("panright","east-mini.png",px.add(wposition,0),sz);
this._addButton("pandown","south-mini.png",centered.add(0,sz.h*2),sz);
this._addButton("zoomin","zoom-plus-mini.png",centered.add(0,sz.h*3+5),sz);
centered=this._addZoomBar(centered.add(0,sz.h*4+5));
this._addButton("zoomout","zoom-minus-mini.png",centered,sz)
}else{this._addButton("zoomin","zoom-plus-mini.png",px,sz);
centered=this._addZoomBar(px.add(0,sz.h));
this._addButton("zoomout","zoom-minus-mini.png",centered,sz);
if(this.zoomWorldIcon){centered=centered.add(0,sz.h+3);
this._addButton("zoomworld","zoom-world-mini.png",centered,sz)
}}return this.div
},_addZoomBar:function(centered){var imgLocation=OpenLayers.Util.getImageLocation("slider.png");
var id=this.id+"_"+this.map.id;
var zoomsToEnd=this.map.getNumZoomLevels()-1-this.map.getZoom();
var slider=OpenLayers.Util.createAlphaImageDiv(id,centered.add(-1,zoomsToEnd*this.zoomStopHeight),{w:20,h:9},imgLocation,"absolute");
slider.style.cursor="move";
this.slider=slider;
this.sliderEvents=new OpenLayers.Events(this,slider,null,true,{includeXY:true});
this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});
var sz={w:this.zoomStopWidth,h:this.zoomStopHeight*this.map.getNumZoomLevels()};
var imgLocation=OpenLayers.Util.getImageLocation("zoombar.png");
var div=null;
if(OpenLayers.Util.alphaHack()){var id=this.id+"_"+this.map.id;
div=OpenLayers.Util.createAlphaImageDiv(id,centered,{w:sz.w,h:this.zoomStopHeight},imgLocation,"absolute",null,"crop");
div.style.height=sz.h+"px"
}else{div=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,centered,sz,imgLocation)
}div.style.cursor="pointer";
div.className="olButton";
this.zoombarDiv=div;
this.div.appendChild(div);
this.startTop=parseInt(div.style.top);
this.div.appendChild(slider);
this.map.events.register("zoomend",this,this.moveZoomBar);
centered=centered.add(0,this.zoomStopHeight*this.map.getNumZoomLevels());
return centered
},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});
this.sliderEvents.destroy();
this.div.removeChild(this.zoombarDiv);
this.zoombarDiv=null;
this.div.removeChild(this.slider);
this.slider=null;
this.map.events.unregister("zoomend",this,this.moveZoomBar)
},onButtonClick:function(evt){OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);
if(evt.buttonElement===this.zoombarDiv){var levels=evt.buttonXY.y/this.zoomStopHeight;
if(this.forceFixedZoomLevel||!this.map.fractionalZoom){levels=Math.floor(levels)
}var zoom=(this.map.getNumZoomLevels()-1)-levels;
zoom=Math.min(Math.max(zoom,0),this.map.getNumZoomLevels()-1);
this.map.zoomTo(zoom)
}},passEventToSlider:function(evt){this.sliderEvents.handleBrowserEvent(evt)
},zoomBarDown:function(evt){if(!OpenLayers.Event.isLeftClick(evt)&&!OpenLayers.Event.isSingleTouch(evt)){return
}this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});
this.mouseDragStart=evt.xy.clone();
this.zoomStart=evt.xy.clone();
this.div.style.cursor="move";
this.zoombarDiv.offsets=null;
OpenLayers.Event.stop(evt)
},zoomBarDrag:function(evt){if(this.mouseDragStart!=null){var deltaY=this.mouseDragStart.y-evt.xy.y;
var offsets=OpenLayers.Util.pagePosition(this.zoombarDiv);
if((evt.clientY-offsets[1])>0&&(evt.clientY-offsets[1])<parseInt(this.zoombarDiv.style.height)-2){var newTop=parseInt(this.slider.style.top)-deltaY;
this.slider.style.top=newTop+"px";
this.mouseDragStart=evt.xy.clone()
}this.deltaY=this.zoomStart.y-evt.xy.y;
OpenLayers.Event.stop(evt)
}},zoomBarUp:function(evt){if(!OpenLayers.Event.isLeftClick(evt)&&evt.type!=="touchend"){return
}if(this.mouseDragStart){this.div.style.cursor="";
this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});
var zoomLevel=this.map.zoom;
if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){zoomLevel+=this.deltaY/this.zoomStopHeight;
zoomLevel=Math.min(Math.max(zoomLevel,0),this.map.getNumZoomLevels()-1)
}else{zoomLevel+=this.deltaY/this.zoomStopHeight;
zoomLevel=Math.max(Math.round(zoomLevel),0)
}this.map.zoomTo(zoomLevel);
this.mouseDragStart=null;
this.zoomStart=null;
this.deltaY=0;
OpenLayers.Event.stop(evt)
}},moveZoomBar:function(){var newTop=((this.map.getNumZoomLevels()-1)-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;
this.slider.style.top=newTop+"px"
},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});
OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(url){url=url||window.location.href;
var parameters=OpenLayers.Util.getParameters(url);
var index=url.indexOf("#");
if(index>0){url="?"+url.substring(index+1,url.length);
OpenLayers.Util.extend(parameters,OpenLayers.Util.getParameters(url))
}return parameters
},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);
for(var i=0,len=this.map.controls.length;
i<len;
i++){var control=this.map.controls[i];
if((control!=this)&&(control.CLASS_NAME=="OpenLayers.Control.ArgParser")){if(control.displayProjection!=this.displayProjection){this.displayProjection=control.displayProjection
}break
}}if(i==this.map.controls.length){var args=this.getParameters();
if(args.layers){this.layers=args.layers;
this.map.events.register("addlayer",this,this.configureLayers);
this.configureLayers()
}if(args.lat&&args.lon){this.center=new OpenLayers.LonLat(parseFloat(args.lon),parseFloat(args.lat));
if(args.zoom){this.zoom=parseFloat(args.zoom)
}this.map.events.register("changebaselayer",this,this.setCenter);
this.setCenter()
}}},setCenter:function(){if(this.map.baseLayer){this.map.events.unregister("changebaselayer",this,this.setCenter);
if(this.displayProjection){this.center.transform(this.displayProjection,this.map.getProjectionObject())
}this.map.setCenter(this.center,this.zoom)
}},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);
for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.map.layers[i];
var c=this.layers.charAt(i);
if(c=="B"){this.map.setBaseLayer(layer)
}else{if((c=="T")||(c=="F")){layer.setVisibility(c=="T")
}}}}},CLASS_NAME:"OpenLayers.Control.ArgParser"});
OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:false,base:"",displayProjection:null,initialize:function(element,base,options){if(element!==null&&typeof element=="object"&&!OpenLayers.Util.isElement(element)){options=element;
this.base=document.location.href;
OpenLayers.Control.prototype.initialize.apply(this,[options]);
if(this.element!=null){this.element=OpenLayers.Util.getElement(this.element)
}}else{OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.element=OpenLayers.Util.getElement(element);
this.base=base||document.location.href
}},destroy:function(){if(this.element&&this.element.parentNode==this.div){this.div.removeChild(this.element);
this.element=null
}if(this.map){this.map.events.unregister("moveend",this,this.updateLink)
}OpenLayers.Control.prototype.destroy.apply(this,arguments)
},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);
for(var i=0,len=this.map.controls.length;
i<len;
i++){var control=this.map.controls[i];
if(control.CLASS_NAME==this.argParserClass.CLASS_NAME){if(control.displayProjection!=this.displayProjection){this.displayProjection=control.displayProjection
}break
}}if(i==this.map.controls.length){this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))
}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(!this.element&&!this.anchor){this.element=document.createElement("a");
this.element.innerHTML=OpenLayers.i18n("Permalink");
this.element.href="";
this.div.appendChild(this.element)
}this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this});
this.updateLink();
return this.div
},updateLink:function(){var separator=this.anchor?"#":"?";
var href=this.base;
if(href.indexOf(separator)!=-1){href=href.substring(0,href.indexOf(separator))
}href+=separator+OpenLayers.Util.getParameterString(this.createParams());
if(this.anchor&&!this.element){window.location.href=href
}else{this.element.href=href
}},createParams:function(center,zoom,layers){center=center||this.map.getCenter();
var params=OpenLayers.Util.getParameters(this.base);
if(center){params.zoom=zoom||this.map.getZoom();
var lat=center.lat;
var lon=center.lon;
if(this.displayProjection){var mapPosition=OpenLayers.Projection.transform({x:lon,y:lat},this.map.getProjectionObject(),this.displayProjection);
lon=mapPosition.x;
lat=mapPosition.y
}params.lat=Math.round(lat*100000)/100000;
params.lon=Math.round(lon*100000)/100000;
layers=layers||this.map.layers;
params.layers="";
for(var i=0,len=layers.length;
i<len;
i++){var layer=layers[i];
if(layer.isBaseLayer){params.layers+=(layer==this.map.baseLayer)?"B":"0"
}else{params.layers+=(layer.getVisibility())?"T":"F"
}}}return params
},CLASS_NAME:"OpenLayers.Control.Permalink"});
OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:false,initialize:function(element,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.element=OpenLayers.Util.getElement(element)
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(!this.element){this.element=document.createElement("div");
this.div.appendChild(this.element)
}this.map.events.register("moveend",this,this.updateScale);
this.updateScale();
return this.div
},updateScale:function(){var scale;
if(this.geodesic===true){var units=this.map.getUnits();
if(!units){return
}var inches=OpenLayers.INCHES_PER_UNIT;
scale=(this.map.getGeodesicPixelSize().w||0.000001)*inches.km*OpenLayers.DOTS_PER_INCH
}else{scale=this.map.getScale()
}if(!scale){return
}if(scale>=9500&&scale<=950000){scale=Math.round(scale/1000)+"K"
}else{if(scale>=950000){scale=Math.round(scale/1000000)+"M"
}else{scale=Math.round(scale)
}}this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:scale})
},CLASS_NAME:"OpenLayers.Control.Scale"});
OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:false,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(!this.eTop){this.eTop=document.createElement("div");
this.eTop.className=this.displayClass+"Top";
var theLen=this.topInUnits.length;
this.div.appendChild(this.eTop);
if((this.topOutUnits=="")||(this.topInUnits=="")){this.eTop.style.visibility="hidden"
}else{this.eTop.style.visibility="visible"
}this.eBottom=document.createElement("div");
this.eBottom.className=this.displayClass+"Bottom";
this.div.appendChild(this.eBottom);
if((this.bottomOutUnits=="")||(this.bottomInUnits=="")){this.eBottom.style.visibility="hidden"
}else{this.eBottom.style.visibility="visible"
}}this.map.events.register("moveend",this,this.update);
this.update();
return this.div
},getBarLen:function(maxLen){var digits=parseInt(Math.log(maxLen)/Math.log(10));
var pow10=Math.pow(10,digits);
var firstChar=parseInt(maxLen/pow10);
var barLen;
if(firstChar>5){barLen=5
}else{if(firstChar>2){barLen=2
}else{barLen=1
}}return barLen*pow10
},update:function(){var res=this.map.getResolution();
if(!res){return
}var curMapUnits=this.map.getUnits();
var inches=OpenLayers.INCHES_PER_UNIT;
var maxSizeData=this.maxWidth*res*inches[curMapUnits];
var geodesicRatio=1;
if(this.geodesic===true){var maxSizeGeodesic=(this.map.getGeodesicPixelSize().w||0.000001)*this.maxWidth;
var maxSizeKilometers=maxSizeData/inches.km;
geodesicRatio=maxSizeGeodesic/maxSizeKilometers;
maxSizeData*=geodesicRatio
}var topUnits;
var bottomUnits;
if(maxSizeData>100000){topUnits=this.topOutUnits;
bottomUnits=this.bottomOutUnits
}else{topUnits=this.topInUnits;
bottomUnits=this.bottomInUnits
}var topMax=maxSizeData/inches[topUnits];
var bottomMax=maxSizeData/inches[bottomUnits];
var topRounded=this.getBarLen(topMax);
var bottomRounded=this.getBarLen(bottomMax);
topMax=topRounded/inches[curMapUnits]*inches[topUnits];
bottomMax=bottomRounded/inches[curMapUnits]*inches[bottomUnits];
var topPx=topMax/res/geodesicRatio;
var bottomPx=bottomMax/res/geodesicRatio;
if(this.eBottom.style.visibility=="visible"){this.eBottom.style.width=Math.round(bottomPx)+"px";
this.eBottom.innerHTML=bottomRounded+" "+bottomUnits
}if(this.eTop.style.visibility=="visible"){this.eTop.style.width=Math.round(topPx)+"px";
this.eTop.innerHTML=topRounded+" "+topUnits
}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});
OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:true,edge:true,vertex:true},greedy:true,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.options=options||{};
if(this.options.layer){this.setLayer(this.options.layer)
}var defaults=OpenLayers.Util.extend({},this.options.defaults);
this.defaults=OpenLayers.Util.applyDefaults(defaults,this.DEFAULTS);
this.setTargets(this.options.targets);
if(this.targets.length===0&&this.layer){this.addTargetLayer(this.layer)
}this.geoToleranceCache={}
},setLayer:function(layer){if(this.active){this.deactivate();
this.layer=layer;
this.activate()
}else{this.layer=layer
}},setTargets:function(targets){this.targets=[];
if(targets&&targets.length){var target;
for(var i=0,len=targets.length;
i<len;
++i){target=targets[i];
if(target instanceof OpenLayers.Layer.Vector){this.addTargetLayer(target)
}else{this.addTarget(target)
}}}},addTargetLayer:function(layer){this.addTarget({layer:layer})
},addTarget:function(target){target=OpenLayers.Util.applyDefaults(target,this.defaults);
target.nodeTolerance=target.nodeTolerance||target.tolerance;
target.vertexTolerance=target.vertexTolerance||target.tolerance;
target.edgeTolerance=target.edgeTolerance||target.tolerance;
this.targets.push(target)
},removeTargetLayer:function(layer){var target;
for(var i=this.targets.length-1;
i>=0;
--i){target=this.targets[i];
if(target.layer===layer){this.removeTarget(target)
}}},removeTarget:function(target){return OpenLayers.Util.removeItem(this.targets,target)
},activate:function(){var activated=OpenLayers.Control.prototype.activate.call(this);
if(activated){if(this.layer&&this.layer.events){this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})
}}return activated
},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.call(this);
if(deactivated){if(this.layer&&this.layer.events){this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this})
}}this.feature=null;
this.point=null;
return deactivated
},onSketchModified:function(event){this.feature=event.feature;
this.considerSnapping(event.vertex,event.vertex)
},onVertexModified:function(event){this.feature=event.feature;
var loc=this.layer.map.getLonLatFromViewPortPx(event.pixel);
this.considerSnapping(event.vertex,new OpenLayers.Geometry.Point(loc.lon,loc.lat))
},considerSnapping:function(point,loc){var best={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null};
var snapped=false;
var result,target;
for(var i=0,len=this.targets.length;
i<len;
++i){target=this.targets[i];
result=this.testTarget(target,loc);
if(result){if(this.greedy){best=result;
best.target=target;
snapped=true;
break
}else{if((result.rank<best.rank)||(result.rank===best.rank&&result.dist<best.dist)){best=result;
best.target=target;
snapped=true
}}}}if(snapped){var proceed=this.events.triggerEvent("beforesnap",{point:point,x:best.x,y:best.y,distance:best.dist,layer:best.target.layer,snapType:this.precedence[best.rank]});
if(proceed!==false){point.x=best.x;
point.y=best.y;
this.point=point;
this.events.triggerEvent("snap",{point:point,snapType:this.precedence[best.rank],layer:best.target.layer,distance:best.dist})
}else{snapped=false
}}if(this.point&&!snapped){point.x=loc.x;
point.y=loc.y;
this.point=null;
this.events.triggerEvent("unsnap",{point:point})
}},testTarget:function(target,loc){var resolution=this.layer.map.getResolution();
if("minResolution" in target){if(resolution<target.minResolution){return null
}}if("maxResolution" in target){if(resolution>=target.maxResolution){return null
}}var tolerance={node:this.getGeoTolerance(target.nodeTolerance,resolution),vertex:this.getGeoTolerance(target.vertexTolerance,resolution),edge:this.getGeoTolerance(target.edgeTolerance,resolution)};
var maxTolerance=Math.max(tolerance.node,tolerance.vertex,tolerance.edge);
var result={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY};
var eligible=false;
var features=target.layer.features;
var feature,type,vertices,vertex,closest,dist,found;
var numTypes=this.precedence.length;
var ll=new OpenLayers.LonLat(loc.x,loc.y);
for(var i=0,len=features.length;
i<len;
++i){feature=features[i];
if(feature!==this.feature&&!feature._sketch&&feature.state!==OpenLayers.State.DELETE&&(!target.filter||target.filter.evaluate(feature))){if(feature.atPoint(ll,maxTolerance,maxTolerance)){for(var j=0,stop=Math.min(result.rank+1,numTypes);
j<stop;
++j){type=this.precedence[j];
if(target[type]){if(type==="edge"){closest=feature.geometry.distanceTo(loc,{details:true});
dist=closest.distance;
if(dist<=tolerance[type]&&dist<result.dist){result={rank:j,dist:dist,x:closest.x0,y:closest.y0};
eligible=true;
break
}}else{vertices=feature.geometry.getVertices(type==="node");
found=false;
for(var k=0,klen=vertices.length;
k<klen;
++k){vertex=vertices[k];
dist=vertex.distanceTo(loc);
if(dist<=tolerance[type]&&(j<result.rank||(j===result.rank&&dist<result.dist))){result={rank:j,dist:dist,x:vertex.x,y:vertex.y};
eligible=true;
found=true
}}if(found){break
}}}}}}}return eligible?result:null
},getGeoTolerance:function(tolerance,resolution){if(resolution!==this.resolution){this.resolution=resolution;
this.geoToleranceCache={}
}var geoTolerance=this.geoToleranceCache[tolerance];
if(geoTolerance===undefined){geoTolerance=tolerance*resolution;
this.geoToleranceCache[tolerance]=geoTolerance
}return geoTolerance
},destroy:function(){if(this.active){this.deactivate()
}delete this.layer;
delete this.targets;
OpenLayers.Control.prototype.destroy.call(this)
},CLASS_NAME:"OpenLayers.Control.Snapping"});
OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:true,deferDelete:false,mutual:true,targetFilter:null,sourceFilter:null,handler:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.options=options||{};
if(this.options.source){this.setSource(this.options.source)
}},setSource:function(layer){if(this.active){this.deactivate();
if(this.handler){this.handler.destroy();
delete this.handler
}this.source=layer;
this.activate()
}else{this.source=layer
}},activate:function(){var activated=OpenLayers.Control.prototype.activate.call(this);
if(activated){if(!this.source){if(!this.handler){this.handler=new OpenLayers.Handler.Path(this,{done:function(geometry){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(geometry)})
}},{layerOptions:this.sourceOptions})
}this.handler.activate()
}else{if(this.source.events){this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})
}}}return activated
},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.call(this);
if(deactivated){if(this.source&&this.source.events){this.layer.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this})
}}return deactivated
},onSketchComplete:function(event){this.feature=null;
return !this.considerSplit(event.feature)
},afterFeatureModified:function(event){if(event.modified){var feature=event.feature;
if(typeof feature.geometry.split==="function"){this.feature=event.feature;
this.considerSplit(event.feature)
}}},removeByGeometry:function(features,geometry){for(var i=0,len=features.length;
i<len;
++i){if(features[i].geometry===geometry){features.splice(i,1);
break
}}},isEligible:function(target){if(!target.geometry){return false
}else{return(target.state!==OpenLayers.State.DELETE)&&(typeof target.geometry.split==="function")&&(this.feature!==target)&&(!this.targetFilter||this.targetFilter.evaluate(target.attributes))
}},considerSplit:function(feature){var sourceSplit=false;
var targetSplit=false;
if(!this.sourceFilter||this.sourceFilter.evaluate(feature.attributes)){var features=this.layer&&this.layer.features||[];
var target,results,proceed;
var additions=[],removals=[];
var mutual=(this.layer===this.source)&&this.mutual;
var options={edge:this.edge,tolerance:this.tolerance,mutual:mutual};
var sourceParts=[feature.geometry];
var targetFeature,targetParts;
var source,parts;
for(var i=0,len=features.length;
i<len;
++i){targetFeature=features[i];
if(this.isEligible(targetFeature)){targetParts=[targetFeature.geometry];
for(var j=0;
j<sourceParts.length;
++j){source=sourceParts[j];
for(var k=0;
k<targetParts.length;
++k){target=targetParts[k];
if(source.getBounds().intersectsBounds(target.getBounds())){results=source.split(target,options);
if(results){proceed=this.events.triggerEvent("beforesplit",{source:feature,target:targetFeature});
if(proceed!==false){if(mutual){parts=results[0];
if(parts.length>1){parts.unshift(j,1);
Array.prototype.splice.apply(sourceParts,parts);
j+=parts.length-3
}results=results[1]
}if(results.length>1){results.unshift(k,1);
Array.prototype.splice.apply(targetParts,results);
k+=results.length-3
}}}}}}if(targetParts&&targetParts.length>1){this.geomsToFeatures(targetFeature,targetParts);
this.events.triggerEvent("split",{original:targetFeature,features:targetParts});
Array.prototype.push.apply(additions,targetParts);
removals.push(targetFeature);
targetSplit=true
}}}if(sourceParts&&sourceParts.length>1){this.geomsToFeatures(feature,sourceParts);
this.events.triggerEvent("split",{original:feature,features:sourceParts});
Array.prototype.push.apply(additions,sourceParts);
removals.push(feature);
sourceSplit=true
}if(sourceSplit||targetSplit){if(this.deferDelete){var feat,destroys=[];
for(var i=0,len=removals.length;
i<len;
++i){feat=removals[i];
if(feat.state===OpenLayers.State.INSERT){destroys.push(feat)
}else{feat.state=OpenLayers.State.DELETE;
this.layer.drawFeature(feat)
}}this.layer.destroyFeatures(destroys,{silent:true});
for(var i=0,len=additions.length;
i<len;
++i){additions[i].state=OpenLayers.State.INSERT
}}else{this.layer.destroyFeatures(removals,{silent:true})
}this.layer.addFeatures(additions,{silent:true});
this.events.triggerEvent("aftersplit",{source:feature,features:additions})
}}return sourceSplit
},geomsToFeatures:function(feature,geoms){var clone=feature.clone();
delete clone.geometry;
var newFeature;
for(var i=0,len=geoms.length;
i<len;
++i){newFeature=clone.clone();
newFeature.geometry=geoms[i];
newFeature.state=OpenLayers.State.INSERT;
geoms[i]=newFeature
}},destroy:function(){if(this.active){this.deactivate()
}OpenLayers.Control.prototype.destroy.call(this)
},CLASS_NAME:"OpenLayers.Control.Split"});
OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:false,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:true,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,arguments);
this.layerStates=[];
if(this.roundedCorner){OpenLayers.Console.warn("roundedCorner option is deprecated")
}},destroy:function(){this.clearLayersArray("base");
this.clearLayersArray("data");
this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});
this.events.unregister("buttonclick",this,this.onButtonClick);
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);
this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this});
if(this.outsideViewport){this.events.attachToElement(this.div);
this.events.register("buttonclick",this,this.onButtonClick)
}else{this.map.events.register("buttonclick",this,this.onButtonClick)
}},draw:function(){OpenLayers.Control.prototype.draw.apply(this);
this.loadContents();
if(!this.outsideViewport){this.minimizeControl()
}this.redraw();
return this.div
},onButtonClick:function(evt){var button=evt.buttonElement;
if(button===this.minimizeDiv){this.minimizeControl()
}else{if(button===this.maximizeDiv){this.maximizeControl()
}else{if(button._layerSwitcher===this.id){if(button["for"]){button=document.getElementById(button["for"])
}if(!button.disabled){if(button.type=="radio"){button.checked=true;
this.map.setBaseLayer(this.map.getLayer(button._layer))
}else{button.checked=!button.checked;
this.updateMap()
}}}}}},clearLayersArray:function(layersType){this[layersType+"LayersDiv"].innerHTML="";
this[layersType+"Layers"]=[]
},checkRedraw:function(){var redraw=false;
if(!this.layerStates.length||(this.map.layers.length!=this.layerStates.length)){redraw=true
}else{for(var i=0,len=this.layerStates.length;
i<len;
i++){var layerState=this.layerStates[i];
var layer=this.map.layers[i];
if((layerState.name!=layer.name)||(layerState.inRange!=layer.inRange)||(layerState.id!=layer.id)||(layerState.visibility!=layer.visibility)){redraw=true;
break
}}}return redraw
},redraw:function(){if(!this.checkRedraw()){return this.div
}this.clearLayersArray("base");
this.clearLayersArray("data");
var containsOverlays=false;
var containsBaseLayers=false;
var len=this.map.layers.length;
this.layerStates=new Array(len);
for(var i=0;
i<len;
i++){var layer=this.map.layers[i];
this.layerStates[i]={name:layer.name,visibility:layer.visibility,inRange:layer.inRange,id:layer.id}
}var layers=this.map.layers.slice();
if(!this.ascending){layers.reverse()
}for(var i=0,len=layers.length;
i<len;
i++){var layer=layers[i];
var baseLayer=layer.isBaseLayer;
if(layer.displayInLayerSwitcher){if(baseLayer){containsBaseLayers=true
}else{containsOverlays=true
}var checked=(baseLayer)?(layer==this.map.baseLayer):layer.getVisibility();
var inputElem=document.createElement("input");
inputElem.id=this.id+"_input_"+layer.name;
inputElem.name=(baseLayer)?this.id+"_baseLayers":layer.name;
inputElem.type=(baseLayer)?"radio":"checkbox";
inputElem.value=layer.name;
inputElem.checked=checked;
inputElem.defaultChecked=checked;
inputElem.className="olButton";
inputElem._layer=layer.id;
inputElem._layerSwitcher=this.id;
if(!baseLayer&&!layer.inRange){inputElem.disabled=true
}var labelSpan=document.createElement("label");
labelSpan["for"]=inputElem.id;
OpenLayers.Element.addClass(labelSpan,"labelSpan olButton");
labelSpan._layer=layer.id;
labelSpan._layerSwitcher=this.id;
if(!baseLayer&&!layer.inRange){labelSpan.style.color="gray"
}labelSpan.innerHTML=layer.name;
labelSpan.style.verticalAlign=(baseLayer)?"bottom":"baseline";
var br=document.createElement("br");
var groupArray=(baseLayer)?this.baseLayers:this.dataLayers;
groupArray.push({layer:layer,inputElem:inputElem,labelSpan:labelSpan});
var groupDiv=(baseLayer)?this.baseLayersDiv:this.dataLayersDiv;
groupDiv.appendChild(inputElem);
groupDiv.appendChild(labelSpan);
groupDiv.appendChild(br)
}}this.dataLbl.style.display=(containsOverlays)?"":"none";
this.baseLbl.style.display=(containsBaseLayers)?"":"none";
return this.div
},updateMap:function(){for(var i=0,len=this.baseLayers.length;
i<len;
i++){var layerEntry=this.baseLayers[i];
if(layerEntry.inputElem.checked){this.map.setBaseLayer(layerEntry.layer,false)
}}for(var i=0,len=this.dataLayers.length;
i<len;
i++){var layerEntry=this.dataLayers[i];
layerEntry.layer.setVisibility(layerEntry.inputElem.checked)
}},maximizeControl:function(e){this.div.style.width="";
this.div.style.height="";
this.showControls(false);
if(e!=null){OpenLayers.Event.stop(e)
}},minimizeControl:function(e){this.div.style.width="0px";
this.div.style.height="0px";
this.showControls(true);
if(e!=null){OpenLayers.Event.stop(e)
}},showControls:function(minimize){this.maximizeDiv.style.display=minimize?"":"none";
this.minimizeDiv.style.display=minimize?"none":"";
this.layersDiv.style.display=minimize?"none":""
},loadContents:function(){this.layersDiv=document.createElement("div");
this.layersDiv.id=this.id+"_layersDiv";
OpenLayers.Element.addClass(this.layersDiv,"layersDiv");
this.baseLbl=document.createElement("div");
this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer");
OpenLayers.Element.addClass(this.baseLbl,"baseLbl");
this.baseLayersDiv=document.createElement("div");
OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv");
this.dataLbl=document.createElement("div");
this.dataLbl.innerHTML=OpenLayers.i18n("Overlays");
OpenLayers.Element.addClass(this.dataLbl,"dataLbl");
this.dataLayersDiv=document.createElement("div");
OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv");
if(this.ascending){this.layersDiv.appendChild(this.baseLbl);
this.layersDiv.appendChild(this.baseLayersDiv);
this.layersDiv.appendChild(this.dataLbl);
this.layersDiv.appendChild(this.dataLayersDiv)
}else{this.layersDiv.appendChild(this.dataLbl);
this.layersDiv.appendChild(this.dataLayersDiv);
this.layersDiv.appendChild(this.baseLbl);
this.layersDiv.appendChild(this.baseLayersDiv)
}this.div.appendChild(this.layersDiv);
if(this.roundedCorner){OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:false});
OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,0.75)
}var img=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");
this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,img,"absolute");
OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton");
this.maximizeDiv.style.display="none";
this.div.appendChild(this.maximizeDiv);
var img=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");
this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,img,"absolute");
OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton");
this.minimizeDiv.style.display="none";
this.div.appendChild(this.minimizeDiv)
},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"});
OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:false,featureAdded:function(){},handlerOptions:null,initialize:function(layer,handler,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(vertex,feature){this.layer.events.triggerEvent("sketchmodified",{vertex:vertex,feature:feature})
},create:function(vertex,feature){this.layer.events.triggerEvent("sketchstarted",{vertex:vertex,feature:feature})
}},this.callbacks);
this.layer=layer;
this.handlerOptions=this.handlerOptions||{};
this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:layer.renderers,rendererOptions:layer.rendererOptions});
if(!("multi" in this.handlerOptions)){this.handlerOptions.multi=this.multi
}var sketchStyle=this.layer.styleMap&&this.layer.styleMap.styles.temporary;
if(sketchStyle){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":sketchStyle})})
}this.handler=new handler(this,this.callbacks,this.handlerOptions)
},drawFeature:function(geometry){var feature=new OpenLayers.Feature.Vector(geometry);
var proceed=this.layer.events.triggerEvent("sketchcomplete",{feature:feature});
if(proceed!==false){feature.state=OpenLayers.State.INSERT;
this.layer.addFeatures([feature]);
this.featureAdded(feature);
this.events.triggerEvent("featureadded",{feature:feature})
}},insertXY:function(x,y){if(this.handler&&this.handler.line){this.handler.insertXY(x,y)
}},insertDeltaXY:function(dx,dy){if(this.handler&&this.handler.line){this.handler.insertDeltaXY(dx,dy)
}},insertDirectionLength:function(direction,length){if(this.handler&&this.handler.line){this.handler.insertDirectionLength(direction,length)
}},insertDeflectionLength:function(deflection,length){if(this.handler&&this.handler.line){this.handler.insertDeflectionLength(deflection,length)
}},undo:function(){return this.handler.undo&&this.handler.undo()
},redo:function(){return this.handler.redo&&this.handler.redo()
},finishSketch:function(){this.handler.finishGeometry()
},cancel:function(){this.handler.cancel()
},CLASS_NAME:"OpenLayers.Control.DrawFeature"});
OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(feature,pixel){},onDrag:function(feature,pixel){},onComplete:function(feature,pixel){},onEnter:function(feature){},onLeave:function(feature){},documentDrag:false,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(layer,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.layer=layer;
this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}
},clickFeature:function(feature){if(this.handlers.feature.touch&&!this.over&&this.overFeature(feature)){this.handlers.drag.dragstart(this.handlers.feature.evt);
this.handlers.drag.stopDown=false
}},clickoutFeature:function(feature){if(this.handlers.feature.touch&&this.over){this.outFeature(feature);
this.handlers.drag.stopDown=true
}},destroy:function(){this.layer=null;
OpenLayers.Control.prototype.destroy.apply(this,[])
},activate:function(){return(this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))
},deactivate:function(){this.handlers.drag.deactivate();
this.handlers.feature.deactivate();
this.feature=null;
this.dragging=false;
this.lastPixel=null;
OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");
return OpenLayers.Control.prototype.deactivate.apply(this,arguments)
},overFeature:function(feature){var activated=false;
if(!this.handlers.drag.dragging){this.feature=feature;
this.handlers.drag.activate();
activated=true;
this.over=true;
OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over");
this.onEnter(feature)
}else{if(this.feature.id==feature.id){this.over=true
}else{this.over=false
}}return activated
},downFeature:function(pixel){this.lastPixel=pixel;
this.onStart(this.feature,pixel)
},moveFeature:function(pixel){var res=this.map.getResolution();
this.feature.geometry.move(res*(pixel.x-this.lastPixel.x),res*(this.lastPixel.y-pixel.y));
this.layer.drawFeature(this.feature);
this.lastPixel=pixel;
this.onDrag(this.feature,pixel)
},upFeature:function(pixel){if(!this.over){this.handlers.drag.deactivate()
}},doneDragging:function(pixel){this.onComplete(this.feature,pixel)
},outFeature:function(feature){if(!this.handlers.drag.dragging){this.over=false;
this.handlers.drag.deactivate();
OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");
this.onLeave(feature);
this.feature=null
}else{if(this.feature.id==feature.id){this.over=false
}}},cancel:function(){this.handlers.drag.deactivate();
this.over=false
},setMap:function(map){this.handlers.drag.setMap(map);
this.handlers.feature.setMap(map);
OpenLayers.Control.prototype.setMap.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Control.DragFeature"});
OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:true,toggle:true,standalone:false,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:true,modified:false,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(layer,options){options=options||{};
this.layer=layer;
this.vertices=[];
this.virtualVertices=[];
this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,options.vertexRenderIntent));
this.virtualStyle.fillOpacity=0.3;
this.virtualStyle.strokeOpacity=0.3;
this.deleteCodes=[46,68];
this.mode=OpenLayers.Control.ModifyFeature.RESHAPE;
OpenLayers.Control.prototype.initialize.apply(this,[options]);
if(!(OpenLayers.Util.isArray(this.deleteCodes))){this.deleteCodes=[this.deleteCodes]
}var control=this;
var selectOptions={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};
if(this.standalone===false){this.selectControl=new OpenLayers.Control.SelectFeature(layer,selectOptions)
}var dragOptions={geometryTypes:["OpenLayers.Geometry.Point"],onStart:function(feature,pixel){control.dragStart.apply(control,[feature,pixel])
},onDrag:function(feature,pixel){control.dragVertex.apply(control,[feature,pixel])
},onComplete:function(feature){control.dragComplete.apply(control,[feature])
},featureCallbacks:{over:function(feature){if(control.standalone!==true||feature._sketch||control.feature===feature){control.dragControl.overFeature.apply(control.dragControl,[feature])
}}}};
this.dragControl=new OpenLayers.Control.DragFeature(layer,dragOptions);
var keyboardOptions={keydown:this.handleKeypress};
this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,keyboardOptions)}
},destroy:function(){this.layer=null;
this.standalone||this.selectControl.destroy();
this.dragControl.destroy();
OpenLayers.Control.prototype.destroy.apply(this,[])
},activate:function(){return((this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments))
},deactivate:function(){var deactivated=false;
if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:true});
this.layer.removeFeatures(this.virtualVertices,{silent:true});
this.vertices=[];
this.dragControl.deactivate();
var feature=this.feature;
var valid=feature&&feature.geometry&&feature.layer;
if(this.standalone===false){if(valid){this.selectControl.unselect.apply(this.selectControl,[feature])
}this.selectControl.deactivate()
}else{if(valid){this.unselectFeature(feature)
}}this.handlers.keyboard.deactivate();
deactivated=true
}return deactivated
},beforeSelectFeature:function(feature){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:feature})
},selectFeature:function(feature){if(!this.standalone||this.beforeSelectFeature(feature)!==false){this.feature=feature;
this.modified=false;
this.resetVertices();
this.dragControl.activate();
this.onModificationStart(this.feature)
}var modified=feature.modified;
if(feature.geometry&&!(modified&&modified.geometry)){this._originalGeometry=feature.geometry.clone()
}},unselectFeature:function(feature){this.layer.removeFeatures(this.vertices,{silent:true});
this.vertices=[];
this.layer.destroyFeatures(this.virtualVertices,{silent:true});
this.virtualVertices=[];
if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});
delete this.dragHandle
}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});
delete this.radiusHandle
}this.feature=null;
this.dragControl.deactivate();
this.onModificationEnd(feature);
this.layer.events.triggerEvent("afterfeaturemodified",{feature:feature,modified:this.modified});
this.modified=false
},dragStart:function(feature,pixel){if(feature!=this.feature&&!feature.geometry.parent&&feature!=this.dragHandle&&feature!=this.radiusHandle){if(this.standalone===false&&this.feature){this.selectControl.clickFeature.apply(this.selectControl,[this.feature])
}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)!=-1){this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[feature]);
this.dragControl.overFeature.apply(this.dragControl,[feature]);
this.dragControl.lastPixel=pixel;
this.dragControl.handlers.drag.started=true;
this.dragControl.handlers.drag.start=pixel;
this.dragControl.handlers.drag.last=pixel
}}},dragVertex:function(vertex,pixel){this.modified=true;
if(this.feature.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){if(this.feature!=vertex){this.feature=vertex
}this.layer.events.triggerEvent("vertexmodified",{vertex:vertex.geometry,feature:this.feature,pixel:pixel})
}else{if(vertex._index){vertex.geometry.parent.addComponent(vertex.geometry,vertex._index);
delete vertex._index;
OpenLayers.Util.removeItem(this.virtualVertices,vertex);
this.vertices.push(vertex)
}else{if(vertex==this.dragHandle){this.layer.removeFeatures(this.vertices,{silent:true});
this.vertices=[];
if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});
this.radiusHandle=null
}}else{if(vertex!==this.radiusHandle){this.layer.events.triggerEvent("vertexmodified",{vertex:vertex.geometry,feature:this.feature,pixel:pixel})
}}}if(this.virtualVertices.length>0){this.layer.destroyFeatures(this.virtualVertices,{silent:true});
this.virtualVertices=[]
}this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent)
}this.layer.drawFeature(vertex)
},dragComplete:function(vertex){this.resetVertices();
this.setFeatureState();
this.onModification(this.feature);
this.layer.events.triggerEvent("featuremodified",{feature:this.feature})
},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE){this.feature.state=OpenLayers.State.UPDATE;
if(this.modified&&this._originalGeometry){var feature=this.feature;
feature.modified=OpenLayers.Util.extend(feature.modified,{geometry:this._originalGeometry});
delete this._originalGeometry
}}},resetVertices:function(){if(this.dragControl.feature){this.dragControl.outFeature(this.dragControl.feature)
}if(this.vertices.length>0){this.layer.removeFeatures(this.vertices,{silent:true});
this.vertices=[]
}if(this.virtualVertices.length>0){this.layer.removeFeatures(this.virtualVertices,{silent:true});
this.virtualVertices=[]
}if(this.dragHandle){this.layer.destroyFeatures([this.dragHandle],{silent:true});
this.dragHandle=null
}if(this.radiusHandle){this.layer.destroyFeatures([this.radiusHandle],{silent:true});
this.radiusHandle=null
}if(this.feature&&this.feature.geometry.CLASS_NAME!="OpenLayers.Geometry.Point"){if((this.mode&OpenLayers.Control.ModifyFeature.DRAG)){this.collectDragHandle()
}if((this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE))){this.collectRadiusHandle()
}if(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE){if(!(this.mode&OpenLayers.Control.ModifyFeature.RESIZE)){this.collectVertices()
}}}},handleKeypress:function(evt){var code=evt.keyCode;
if(this.feature&&OpenLayers.Util.indexOf(this.deleteCodes,code)!=-1){var vertex=this.dragControl.feature;
if(vertex&&OpenLayers.Util.indexOf(this.vertices,vertex)!=-1&&!this.dragControl.handlers.drag.dragging&&vertex.geometry.parent){vertex.geometry.parent.removeComponent(vertex.geometry);
this.layer.events.triggerEvent("vertexremoved",{vertex:vertex.geometry,feature:this.feature,pixel:evt.xy});
this.layer.drawFeature(this.feature,this.standalone?undefined:this.selectControl.renderIntent);
this.modified=true;
this.resetVertices();
this.setFeatureState();
this.onModification(this.feature);
this.layer.events.triggerEvent("featuremodified",{feature:this.feature})
}}},collectVertices:function(){this.vertices=[];
this.virtualVertices=[];
var control=this;
function collectComponentVertices(geometry){var i,vertex,component,len;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){vertex=new OpenLayers.Feature.Vector(geometry);
vertex._sketch=true;
vertex.renderIntent=control.vertexRenderIntent;
control.vertices.push(vertex)
}else{var numVert=geometry.components.length;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){numVert-=1
}for(i=0;
i<numVert;
++i){component=geometry.components[i];
if(component.CLASS_NAME=="OpenLayers.Geometry.Point"){vertex=new OpenLayers.Feature.Vector(component);
vertex._sketch=true;
vertex.renderIntent=control.vertexRenderIntent;
control.vertices.push(vertex)
}else{collectComponentVertices(component)
}}if(control.createVertices&&geometry.CLASS_NAME!="OpenLayers.Geometry.MultiPoint"){for(i=0,len=geometry.components.length;
i<len-1;
++i){var prevVertex=geometry.components[i];
var nextVertex=geometry.components[i+1];
if(prevVertex.CLASS_NAME=="OpenLayers.Geometry.Point"&&nextVertex.CLASS_NAME=="OpenLayers.Geometry.Point"){var x=(prevVertex.x+nextVertex.x)/2;
var y=(prevVertex.y+nextVertex.y)/2;
var point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(x,y),null,control.virtualStyle);
point.geometry.parent=geometry;
point._index=i+1;
point._sketch=true;
control.virtualVertices.push(point)
}}}}}collectComponentVertices.call(this,this.feature.geometry);
this.layer.addFeatures(this.virtualVertices,{silent:true});
this.layer.addFeatures(this.vertices,{silent:true})
},collectDragHandle:function(){var geometry=this.feature.geometry;
var center=geometry.getBounds().getCenterLonLat();
var originGeometry=new OpenLayers.Geometry.Point(center.lon,center.lat);
var origin=new OpenLayers.Feature.Vector(originGeometry);
originGeometry.move=function(x,y){OpenLayers.Geometry.Point.prototype.move.call(this,x,y);
geometry.move(x,y)
};
origin._sketch=true;
this.dragHandle=origin;
this.dragHandle.renderIntent=this.vertexRenderIntent;
this.layer.addFeatures([this.dragHandle],{silent:true})
},collectRadiusHandle:function(){var geometry=this.feature.geometry;
var bounds=geometry.getBounds();
var center=bounds.getCenterLonLat();
var originGeometry=new OpenLayers.Geometry.Point(center.lon,center.lat);
var radiusGeometry=new OpenLayers.Geometry.Point(bounds.right,bounds.bottom);
var radius=new OpenLayers.Feature.Vector(radiusGeometry);
var resize=(this.mode&OpenLayers.Control.ModifyFeature.RESIZE);
var reshape=(this.mode&OpenLayers.Control.ModifyFeature.RESHAPE);
var rotate=(this.mode&OpenLayers.Control.ModifyFeature.ROTATE);
radiusGeometry.move=function(x,y){OpenLayers.Geometry.Point.prototype.move.call(this,x,y);
var dx1=this.x-originGeometry.x;
var dy1=this.y-originGeometry.y;
var dx0=dx1-x;
var dy0=dy1-y;
if(rotate){var a0=Math.atan2(dy0,dx0);
var a1=Math.atan2(dy1,dx1);
var angle=a1-a0;
angle*=180/Math.PI;
geometry.rotate(angle,originGeometry)
}if(resize){var scale,ratio;
if(reshape){scale=dy1/dy0;
ratio=(dx1/dx0)/scale
}else{var l0=Math.sqrt((dx0*dx0)+(dy0*dy0));
var l1=Math.sqrt((dx1*dx1)+(dy1*dy1));
scale=l1/l0
}geometry.resize(scale,originGeometry,ratio)
}};
radius._sketch=true;
this.radiusHandle=radius;
this.radiusHandle.renderIntent=this.vertexRenderIntent;
this.layer.addFeatures([this.radiusHandle],{silent:true})
},setMap:function(map){this.standalone||this.selectControl.setMap(map);
this.dragControl.setMap(map);
OpenLayers.Control.prototype.setMap.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Control.ModifyFeature"});
OpenLayers.Control.ModifyFeature.RESHAPE=1;
OpenLayers.Control.ModifyFeature.RESIZE=2;
OpenLayers.Control.ModifyFeature.ROTATE=4;
OpenLayers.Control.ModifyFeature.DRAG=8;
OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:true,defaultControl:null,saveState:false,allowDepress:false,activeState:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.controls=[];
this.activeState={}
},destroy:function(){if(this.map){this.map.events.unregister("buttonclick",this,this.onButtonClick)
}OpenLayers.Control.prototype.destroy.apply(this,arguments);
for(var ctl,i=this.controls.length-1;
i>=0;
i--){ctl=this.controls[i];
if(ctl.events){ctl.events.un({activate:this.iconOn,deactivate:this.iconOff})
}ctl.panel_div=null
}this.activeState=null
},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){var control;
for(var i=0,len=this.controls.length;
i<len;
i++){control=this.controls[i];
if(control===this.defaultControl||(this.saveState&&this.activeState[control.id])){control.activate()
}}if(this.saveState===true){this.defaultControl=null
}this.redraw();
return true
}else{return false
}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){var control;
for(var i=0,len=this.controls.length;
i<len;
i++){control=this.controls[i];
this.activeState[control.id]=control.deactivate()
}this.redraw();
return true
}else{return false
}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(this.outsideViewport){this.events.attachToElement(this.div);
this.events.register("buttonclick",this,this.onButtonClick)
}else{this.map.events.register("buttonclick",this,this.onButtonClick)
}this.addControlsToMap(this.controls);
return this.div
},redraw:function(){for(var l=this.div.childNodes.length,i=l-1;
i>=0;
i--){this.div.removeChild(this.div.childNodes[i])
}this.div.innerHTML="";
if(this.active){for(var i=0,len=this.controls.length;
i<len;
i++){this.div.appendChild(this.controls[i].panel_div)
}}},activateControl:function(control){if(!this.active){return false
}if(control.type==OpenLayers.Control.TYPE_BUTTON){control.trigger();
return
}if(control.type==OpenLayers.Control.TYPE_TOGGLE){if(control.active){control.deactivate()
}else{control.activate()
}return
}if(this.allowDepress&&control.active){control.deactivate()
}else{var c;
for(var i=0,len=this.controls.length;
i<len;
i++){c=this.controls[i];
if(c!=control&&(c.type===OpenLayers.Control.TYPE_TOOL||c.type==null)){c.deactivate()
}}control.activate()
}},addControls:function(controls){if(!(OpenLayers.Util.isArray(controls))){controls=[controls]
}this.controls=this.controls.concat(controls);
for(var i=0,len=controls.length;
i<len;
i++){var control=controls[i],element=this.createControlMarkup(control);
OpenLayers.Element.addClass(element,control.displayClass+"ItemInactive");
OpenLayers.Element.addClass(element,"olButton");
if(control.title!=""&&!element.title){element.title=control.title
}control.panel_div=element
}if(this.map){this.addControlsToMap(controls);
this.redraw()
}},createControlMarkup:function(control){return document.createElement("div")
},addControlsToMap:function(controls){var control;
for(var i=0,len=controls.length;
i<len;
i++){control=controls[i];
if(control.autoActivate===true){control.autoActivate=false;
this.map.addControl(control);
control.autoActivate=true
}else{this.map.addControl(control);
control.deactivate()
}control.events.on({activate:this.iconOn,deactivate:this.iconOff})
}},iconOn:function(){var d=this.panel_div;
var re=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");
d.className=d.className.replace(re,"$1Active")
},iconOff:function(){var d=this.panel_div;
var re=new RegExp("\\b("+this.displayClass+"Item)Active\\b");
d.className=d.className.replace(re,"$1Inactive")
},onButtonClick:function(evt){var controls=this.controls,button=evt.buttonElement;
for(var i=controls.length-1;
i>=0;
--i){if(controls[i].panel_div===button){this.activateControl(controls[i]);
break
}}},getControlsBy:function(property,match){var test=(typeof match.test=="function");
var found=OpenLayers.Array.filter(this.controls,function(item){return item[property]==match||(test&&match.test(item[property]))
});
return found
},getControlsByName:function(match){return this.getControlsBy("name",match)
},getControlsByClass:function(match){return this.getControlsBy("CLASS_NAME",match)
},CLASS_NAME:"OpenLayers.Control.Panel"});
OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:false,clickout:true,toggle:false,hover:false,highlightOnly:false,box:false,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(layers,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
if(this.scope===null){this.scope=this
}this.initLayer(layers);
var callbacks={click:this.clickFeature,clickout:this.clickoutFeature};
if(this.hover){callbacks.over=this.overFeature;
callbacks.out=this.outFeature
}this.callbacks=OpenLayers.Util.extend(callbacks,this.callbacks);
this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})};
if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"})
}},initLayer:function(layers){if(OpenLayers.Util.isArray(layers)){this.layers=layers;
this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:layers})
}else{this.layer=layers
}},destroy:function(){if(this.active&&this.layers){this.map.removeLayer(this.layer)
}OpenLayers.Control.prototype.destroy.apply(this,arguments);
if(this.layers){this.layer.destroy()
}},activate:function(){if(!this.active){if(this.layers){this.map.addLayer(this.layer)
}this.handlers.feature.activate();
if(this.box&&this.handlers.box){this.handlers.box.activate()
}}return OpenLayers.Control.prototype.activate.apply(this,arguments)
},deactivate:function(){if(this.active){this.handlers.feature.deactivate();
if(this.handlers.box){this.handlers.box.deactivate()
}if(this.layers){this.map.removeLayer(this.layer)
}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)
},unselectAll:function(options){var layers=this.layers||[this.layer];
var layer,feature;
for(var l=0;
l<layers.length;
++l){layer=layers[l];
for(var i=layer.selectedFeatures.length-1;
i>=0;
--i){feature=layer.selectedFeatures[i];
if(!options||options.except!=feature){this.unselect(feature)
}}}},clickFeature:function(feature){if(!this.hover){var selected=(OpenLayers.Util.indexOf(feature.layer.selectedFeatures,feature)>-1);
if(selected){if(this.toggleSelect()){this.unselect(feature)
}else{if(!this.multipleSelect()){this.unselectAll({except:feature})
}}}else{if(!this.multipleSelect()){this.unselectAll({except:feature})
}this.select(feature)
}}},multipleSelect:function(){return this.multiple||(this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey])
},toggleSelect:function(){return this.toggle||(this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey])
},clickoutFeature:function(feature){if(!this.hover&&this.clickout){this.unselectAll()
}},overFeature:function(feature){var layer=feature.layer;
if(this.hover){if(this.highlightOnly){this.highlight(feature)
}else{if(OpenLayers.Util.indexOf(layer.selectedFeatures,feature)==-1){this.select(feature)
}}}},outFeature:function(feature){if(this.hover){if(this.highlightOnly){if(feature._lastHighlighter==this.id){if(feature._prevHighlighter&&feature._prevHighlighter!=this.id){delete feature._lastHighlighter;
var control=this.map.getControl(feature._prevHighlighter);
if(control){control.highlight(feature)
}}else{this.unhighlight(feature)
}}}else{this.unselect(feature)
}}},highlight:function(feature){var layer=feature.layer;
var cont=this.events.triggerEvent("beforefeaturehighlighted",{feature:feature});
if(cont!==false){feature._prevHighlighter=feature._lastHighlighter;
feature._lastHighlighter=this.id;
var style=this.selectStyle||this.renderIntent;
layer.drawFeature(feature,style);
this.events.triggerEvent("featurehighlighted",{feature:feature})
}},unhighlight:function(feature){var layer=feature.layer;
if(feature._prevHighlighter==undefined){delete feature._lastHighlighter
}else{if(feature._prevHighlighter==this.id){delete feature._prevHighlighter
}else{feature._lastHighlighter=feature._prevHighlighter;
delete feature._prevHighlighter
}}layer.drawFeature(feature,feature.style||feature.layer.style||"default");
this.events.triggerEvent("featureunhighlighted",{feature:feature})
},select:function(feature){var cont=this.onBeforeSelect.call(this.scope,feature);
var layer=feature.layer;
if(cont!==false){cont=layer.events.triggerEvent("beforefeatureselected",{feature:feature});
if(cont!==false){layer.selectedFeatures.push(feature);
this.highlight(feature);
if(!this.handlers.feature.lastFeature){this.handlers.feature.lastFeature=layer.selectedFeatures[0]
}layer.events.triggerEvent("featureselected",{feature:feature});
this.onSelect.call(this.scope,feature)
}}},unselect:function(feature){var layer=feature.layer;
this.unhighlight(feature);
OpenLayers.Util.removeItem(layer.selectedFeatures,feature);
layer.events.triggerEvent("featureunselected",{feature:feature});
this.onUnselect.call(this.scope,feature)
},selectBox:function(position){if(position instanceof OpenLayers.Bounds){var minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom});
var maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top});
var bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat);
if(!this.multipleSelect()){this.unselectAll()
}var prevMultiple=this.multiple;
this.multiple=true;
var layers=this.layers||[this.layer];
this.events.triggerEvent("boxselectionstart",{layers:layers});
var layer;
for(var l=0;
l<layers.length;
++l){layer=layers[l];
for(var i=0,len=layer.features.length;
i<len;
++i){var feature=layer.features[i];
if(!feature.getVisibility()){continue
}if(this.geometryTypes==null||OpenLayers.Util.indexOf(this.geometryTypes,feature.geometry.CLASS_NAME)>-1){if(bounds.toGeometry().intersects(feature.geometry)){if(OpenLayers.Util.indexOf(layer.selectedFeatures,feature)==-1){this.select(feature)
}}}}}this.multiple=prevMultiple;
this.events.triggerEvent("boxselectionend",{layers:layers})
}},setMap:function(map){this.handlers.feature.setMap(map);
if(this.box){this.handlers.box.setMap(map)
}OpenLayers.Control.prototype.setMap.apply(this,arguments)
},setLayer:function(layers){var isActive=this.active;
this.unselectAll();
this.deactivate();
if(this.layers){this.layer.destroy();
this.layers=null
}this.initLayer(layers);
this.handlers.feature.layer=this.layer;
if(isActive){this.activate()
}},CLASS_NAME:"OpenLayers.Control.SelectFeature"});
OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:true,clearOnDeactivate:false,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:false,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);
var previousOptions={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};
OpenLayers.Util.extend(previousOptions,this.previousOptions);
this.previous=new OpenLayers.Control.Button(previousOptions);
var nextOptions={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};
OpenLayers.Util.extend(nextOptions,this.nextOptions);
this.next=new OpenLayers.Control.Button(nextOptions);
this.clear()
},onPreviousChange:function(state,length){if(state&&!this.previous.active){this.previous.activate()
}else{if(!state&&this.previous.active){this.previous.deactivate()
}}},onNextChange:function(state,length){if(state&&!this.next.active){this.next.activate()
}else{if(!state&&this.next.active){this.next.deactivate()
}}},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);
this.previous.destroy();
this.next.destroy();
this.deactivate();
for(var prop in this){this[prop]=null
}},setMap:function(map){this.map=map;
this.next.setMap(map);
this.previous.setMap(map)
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
this.next.draw();
this.previous.draw()
},previousTrigger:function(){var current=this.previousStack.shift();
var state=this.previousStack.shift();
if(state!=undefined){this.nextStack.unshift(current);
this.previousStack.unshift(state);
this.restoring=true;
this.restore(state);
this.restoring=false;
this.onNextChange(this.nextStack[0],this.nextStack.length);
this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)
}else{this.previousStack.unshift(current)
}return state
},nextTrigger:function(){var state=this.nextStack.shift();
if(state!=undefined){this.previousStack.unshift(state);
this.restoring=true;
this.restore(state);
this.restoring=false;
this.onNextChange(this.nextStack[0],this.nextStack.length);
this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)
}return state
},clear:function(){this.previousStack=[];
this.previous.deactivate();
this.nextStack=[];
this.next.deactivate()
},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}
},restore:function(state){var center,zoom;
if(this.map.getProjectionObject()==state.projection){zoom=this.map.getZoomForResolution(state.resolution);
center=state.center
}else{center=state.center.clone();
center.transform(state.projection,this.map.getProjectionObject());
var sourceUnits=state.units;
var targetUnits=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;
var resolutionFactor=sourceUnits&&targetUnits?OpenLayers.INCHES_PER_UNIT[sourceUnits]/OpenLayers.INCHES_PER_UNIT[targetUnits]:1;
zoom=this.map.getZoomForResolution(resolutionFactor*state.resolution)
}this.map.setCenter(center,zoom)
},setListeners:function(){this.listeners={};
for(var type in this.registry){this.listeners[type]=OpenLayers.Function.bind(function(){if(!this.restoring){var state=this.registry[type].apply(this,arguments);
this.previousStack.unshift(state);
if(this.previousStack.length>1){this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)
}if(this.previousStack.length>(this.limit+1)){this.previousStack.pop()
}if(this.nextStack.length>0){this.nextStack=[];
this.onNextChange(null,0)
}}return true
},this)
}},activate:function(){var activated=false;
if(this.map){if(OpenLayers.Control.prototype.activate.apply(this)){if(this.listeners==null){this.setListeners()
}for(var type in this.listeners){this.map.events.register(type,this,this.listeners[type])
}activated=true;
if(this.previousStack.length==0){this.initStack()
}}}return activated
},initStack:function(){if(this.map.getCenter()){this.listeners.moveend()
}},deactivate:function(){var deactivated=false;
if(this.map){if(OpenLayers.Control.prototype.deactivate.apply(this)){for(var type in this.listeners){this.map.events.unregister(type,this,this.listeners[type])
}if(this.clearOnDeactivate){this.clear()
}deactivated=true
}}return deactivated
},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});
OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:false,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:false,immediate:false,initialize:function(handler,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
var callbacks={done:this.measureComplete,point:this.measurePartial};
if(this.immediate){callbacks.modify=this.measureImmediate
}this.callbacks=OpenLayers.Util.extend(callbacks,this.callbacks);
this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);
this.handler=new handler(this,this.callbacks,this.handlerOptions)
},deactivate:function(){this.cancelDelay();
return OpenLayers.Control.prototype.deactivate.apply(this,arguments)
},cancel:function(){this.cancelDelay();
this.handler.cancel()
},setImmediate:function(immediate){this.immediate=immediate;
if(this.immediate){this.callbacks.modify=this.measureImmediate
}else{delete this.callbacks.modify
}},updateHandler:function(handler,options){var active=this.active;
if(active){this.deactivate()
}this.handler=new handler(this,this.callbacks,options);
if(active){this.activate()
}},measureComplete:function(geometry){this.cancelDelay();
this.measure(geometry,"measure")
},measurePartial:function(point,geometry){this.cancelDelay();
geometry=geometry.clone();
if(this.handler.freehandMode(this.handler.evt)){this.measure(geometry,"measurepartial")
}else{this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;
this.measure(geometry,"measurepartial")
},this),this.partialDelay)
}},measureImmediate:function(point,feature,drawing){if(drawing&&!this.handler.freehandMode(this.handler.evt)){this.cancelDelay();
this.measure(feature.geometry,"measurepartial")
}},cancelDelay:function(){if(this.delayedTrigger!==null){window.clearTimeout(this.delayedTrigger);
this.delayedTrigger=null
}},measure:function(geometry,eventType){var stat,order;
if(geometry.CLASS_NAME.indexOf("LineString")>-1){stat=this.getBestLength(geometry);
order=1
}else{stat=this.getBestArea(geometry);
order=2
}this.events.triggerEvent(eventType,{measure:stat[0],units:stat[1],order:order,geometry:geometry})
},getBestArea:function(geometry){var units=this.displaySystemUnits[this.displaySystem];
var unit,area;
for(var i=0,len=units.length;
i<len;
++i){unit=units[i];
area=this.getArea(geometry,unit);
if(area>1){break
}}return[area,unit]
},getArea:function(geometry,units){var area,geomUnits;
if(this.geodesic){area=geometry.getGeodesicArea(this.map.getProjectionObject());
geomUnits="m"
}else{area=geometry.getArea();
geomUnits=this.map.getUnits()
}var inPerDisplayUnit=OpenLayers.INCHES_PER_UNIT[units];
if(inPerDisplayUnit){var inPerMapUnit=OpenLayers.INCHES_PER_UNIT[geomUnits];
area*=Math.pow((inPerMapUnit/inPerDisplayUnit),2)
}return area
},getBestLength:function(geometry){var units=this.displaySystemUnits[this.displaySystem];
var unit,length;
for(var i=0,len=units.length;
i<len;
++i){unit=units[i];
length=this.getLength(geometry,unit);
if(length>1){break
}}return[length,unit]
},getLength:function(geometry,units){var length,geomUnits;
if(this.geodesic){length=geometry.getGeodesicLength(this.map.getProjectionObject());
geomUnits="m"
}else{length=geometry.getLength();
geomUnits=this.map.getUnits()
}var inPerDisplayUnit=OpenLayers.INCHES_PER_UNIT[units];
if(inPerDisplayUnit){var inPerMapUnit=OpenLayers.INCHES_PER_UNIT[geomUnits];
length*=(inPerMapUnit/inPerDisplayUnit)
}return length
},CLASS_NAME:"OpenLayers.Control.Measure"});
OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,drillDown:false,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:false,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,initialize:function(options){options=options||{};
options.handlerOptions=options.handlerOptions||{};
OpenLayers.Control.prototype.initialize.apply(this,[options]);
if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(options.formatOptions)
}if(this.drillDown===true){this.hover=false
}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))
}else{var callbacks={};
callbacks[this.clickCallback]=this.getInfoForClick;
this.handler=new OpenLayers.Handler.Click(this,callbacks,this.handlerOptions.click||{})
}},getInfoForClick:function(evt){this.events.triggerEvent("beforegetfeatureinfo",{xy:evt.xy});
OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");
this.request(evt.xy,{})
},getInfoForHover:function(evt){this.events.triggerEvent("beforegetfeatureinfo",{xy:evt.xy});
this.request(evt.xy,{hover:true})
},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();
this.hoverRequest=null
}},findLayers:function(){var candidates=this.layers||this.map.layers;
var layers=[];
var layer,url;
for(var i=candidates.length-1;
i>=0;
--i){layer=candidates[i];
if(layer instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||layer.getVisibility())){url=OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url;
if(this.drillDown===false&&!this.url){this.url=url
}if(this.drillDown===true||this.urlMatches(url)){layers.push(layer)
}}}return layers
},urlMatches:function(url){var matches=OpenLayers.Util.isEquivalentUrl(this.url,url);
if(!matches&&this.layerUrls){for(var i=0,len=this.layerUrls.length;
i<len;
++i){if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[i],url)){matches=true;
break
}}}return matches
},buildWMSOptions:function(url,layers,clickPosition,format){var layerNames=[],styleNames=[];
for(var i=0,len=layers.length;
i<len;
i++){if(layers[i].params.LAYERS!=null){layerNames=layerNames.concat(layers[i].params.LAYERS);
styleNames=styleNames.concat(this.getStyleNames(layers[i]))
}}var firstLayer=layers[0];
var projection=this.map.getProjection();
var layerProj=firstLayer.projection;
if(layerProj&&layerProj.equals(this.map.getProjectionObject())){projection=layerProj.getCode()
}var params=OpenLayers.Util.extend({service:"WMS",version:firstLayer.params.VERSION,request:"GetFeatureInfo",exceptions:firstLayer.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,firstLayer.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:format,info_format:firstLayer.params.INFO_FORMAT||this.infoFormat},(parseFloat(firstLayer.params.VERSION)>=1.3)?{crs:projection,i:parseInt(clickPosition.x),j:parseInt(clickPosition.y)}:{srs:projection,x:parseInt(clickPosition.x),y:parseInt(clickPosition.y)});
if(layerNames.length!=0){params=OpenLayers.Util.extend({layers:layerNames,query_layers:layerNames,styles:styleNames},params)
}OpenLayers.Util.applyDefaults(params,this.vendorParams);
return{url:url,params:OpenLayers.Util.upperCaseObject(params),callback:function(request){this.handleResponse(clickPosition,request,url)
},scope:this}
},getStyleNames:function(layer){var styleNames;
if(layer.params.STYLES){styleNames=layer.params.STYLES
}else{if(OpenLayers.Util.isArray(layer.params.LAYERS)){styleNames=new Array(layer.params.LAYERS.length)
}else{styleNames=layer.params.LAYERS.replace(/[^,]/g,"")
}}return styleNames
},request:function(clickPosition,options){var layers=this.findLayers();
if(layers.length==0){this.events.triggerEvent("nogetfeatureinfo");
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");
return
}options=options||{};
if(this.drillDown===false){var wmsOptions=this.buildWMSOptions(this.url,layers,clickPosition,layers[0].params.FORMAT);
var request=OpenLayers.Request.GET(wmsOptions);
if(options.hover===true){this.hoverRequest=request
}}else{this._requestCount=0;
this._numRequests=0;
this.features=[];
var services={},url;
for(var i=0,len=layers.length;
i<len;
i++){var layer=layers[i];
var service,found=false;
url=OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url;
if(url in services){services[url].push(layer)
}else{this._numRequests++;
services[url]=[layer]
}}var layers;
for(var url in services){layers=services[url];
var wmsOptions=this.buildWMSOptions(url,layers,clickPosition,layers[0].params.FORMAT);
OpenLayers.Request.GET(wmsOptions)
}}},triggerGetFeatureInfo:function(request,xy,features){this.events.triggerEvent("getfeatureinfo",{text:request.responseText,features:features,request:request,xy:xy});
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")
},handleResponse:function(xy,request,url){var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}var features=this.format.read(doc);
if(this.drillDown===false){this.triggerGetFeatureInfo(request,xy,features)
}else{this._requestCount++;
if(this.output==="object"){this._features=(this._features||[]).concat({url:url,features:features})
}else{this._features=(this._features||[]).concat(features)
}if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(request,xy,this._features.concat());
delete this._features;
delete this._requestCount;
delete this._numRequests
}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});
OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:false,requestEncoding:"KVP",drillDown:false,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:true,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(options){options=options||{};
options.handlerOptions=options.handlerOptions||{};
OpenLayers.Control.prototype.initialize.apply(this,[options]);
if(!this.format){this.format=new OpenLayers.Format.WMSGetFeatureInfo(options.formatOptions)
}if(this.drillDown===true){this.hover=false
}if(this.hover){this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}))
}else{var callbacks={};
callbacks[this.clickCallback]=this.getInfoForClick;
this.handler=new OpenLayers.Handler.Click(this,callbacks,this.handlerOptions.click||{})
}},getInfoForClick:function(evt){this.request(evt.xy,{})
},getInfoForHover:function(evt){this.request(evt.xy,{hover:true})
},cancelHover:function(){if(this.hoverRequest){--this.pending;
if(this.pending<=0){OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");
this.pending=0
}this.hoverRequest.abort();
this.hoverRequest=null
}},findLayers:function(){var candidates=this.layers||this.map.layers;
var layers=[];
var layer;
for(var i=candidates.length-1;
i>=0;
--i){layer=candidates[i];
if(layer instanceof OpenLayers.Layer.WMTS&&layer.requestEncoding===this.requestEncoding&&(!this.queryVisible||layer.getVisibility())){layers.push(layer);
if(!this.drillDown||this.hover){break
}}}return layers
},buildRequestOptions:function(layer,xy){var loc=this.map.getLonLatFromPixel(xy);
var getTileUrl=layer.getURL(new OpenLayers.Bounds(loc.lon,loc.lat,loc.lon,loc.lat));
var params=OpenLayers.Util.getParameters(getTileUrl);
var tileInfo=layer.getTileInfo(loc);
OpenLayers.Util.extend(params,{service:"WMTS",version:layer.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:tileInfo.i,j:tileInfo.j});
OpenLayers.Util.applyDefaults(params,this.vendorParams);
return{url:OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url,params:OpenLayers.Util.upperCaseObject(params),callback:function(request){this.handleResponse(xy,request,layer)
},scope:this}
},request:function(xy,options){options=options||{};
var layers=this.findLayers();
if(layers.length>0){var issue,layer;
for(var i=0,len=layers.length;
i<len;
i++){layer=layers[i];
issue=this.events.triggerEvent("beforegetfeatureinfo",{xy:xy,layer:layer});
if(issue!==false){++this.pending;
var requestOptions=this.buildRequestOptions(layer,xy);
var request=OpenLayers.Request.GET(requestOptions);
if(options.hover===true){this.hoverRequest=request
}}}if(this.pending>0){OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")
}}},handleResponse:function(xy,request,layer){--this.pending;
if(this.pending<=0){OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");
this.pending=0
}if(request.status&&(request.status<200||request.status>=300)){this.events.triggerEvent("exception",{xy:xy,request:request,layer:layer})
}else{var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}var features,except;
try{features=this.format.read(doc)
}catch(error){except=true;
this.events.triggerEvent("exception",{xy:xy,request:request,error:error,layer:layer})
}if(!except){this.events.triggerEvent("getfeatureinfo",{text:request.responseText,features:features,request:request,xy:xy,layer:layer})
}}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"});
OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,intervals:[45,30,20,10,5,2,1,0.5,0.2,0.1,0.05,0.01,0.005,0.002,0.001],displayInLayerSwitcher:true,visible:true,numPoints:50,targetSize:200,layerName:null,labelled:true,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:0.5},labelSymbolizer:{},gratLayer:null,initialize:function(options){options=options||{};
options.layerName=options.layerName||OpenLayers.i18n("Graticule");
OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.labelSymbolizer.stroke=false;
this.labelSymbolizer.fill=false;
this.labelSymbolizer.label="${label}";
this.labelSymbolizer.labelAlign="${labelAlign}";
this.labelSymbolizer.labelXOffset="${xOffset}";
this.labelSymbolizer.labelYOffset="${yOffset}"
},destroy:function(){this.deactivate();
OpenLayers.Control.prototype.destroy.apply(this,arguments);
if(this.gratLayer){this.gratLayer.destroy();
this.gratLayer=null
}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
if(!this.gratLayer){var gratStyle=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});
this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":gratStyle}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})
}return this.div
},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.map.addLayer(this.gratLayer);
this.map.events.register("moveend",this,this.update);
this.update();
return true
}else{return false
}},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.map.events.unregister("moveend",this,this.update);
this.map.removeLayer(this.gratLayer);
return true
}else{return false
}},update:function(){var mapBounds=this.map.getExtent();
if(!mapBounds){return
}this.gratLayer.destroyFeatures();
var llProj=new OpenLayers.Projection("EPSG:4326");
var mapProj=this.map.getProjectionObject();
var mapRes=this.map.getResolution();
if(mapProj.proj&&mapProj.proj.projName=="longlat"){this.numPoints=1
}var mapCenter=this.map.getCenter();
var mapCenterLL=new OpenLayers.Pixel(mapCenter.lon,mapCenter.lat);
OpenLayers.Projection.transform(mapCenterLL,mapProj,llProj);
var testSq=this.targetSize*mapRes;
testSq*=testSq;
var llInterval;
for(var i=0;
i<this.intervals.length;
++i){llInterval=this.intervals[i];
var delta=llInterval/2;
var p1=mapCenterLL.offset({x:-delta,y:-delta});
var p2=mapCenterLL.offset({x:delta,y:delta});
OpenLayers.Projection.transform(p1,llProj,mapProj);
OpenLayers.Projection.transform(p2,llProj,mapProj);
var distSq=(p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y);
if(distSq<=testSq){break
}}mapCenterLL.x=Math.floor(mapCenterLL.x/llInterval)*llInterval;
mapCenterLL.y=Math.floor(mapCenterLL.y/llInterval)*llInterval;
var iter=0;
var centerLonPoints=[mapCenterLL.clone()];
var newPoint=mapCenterLL.clone();
var mapXY;
do{newPoint=newPoint.offset({x:0,y:llInterval});
mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj);
centerLonPoints.unshift(newPoint)
}while(mapBounds.containsPixel(mapXY)&&++iter<1000);
newPoint=mapCenterLL.clone();
do{newPoint=newPoint.offset({x:0,y:-llInterval});
mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj);
centerLonPoints.push(newPoint)
}while(mapBounds.containsPixel(mapXY)&&++iter<1000);
iter=0;
var centerLatPoints=[mapCenterLL.clone()];
newPoint=mapCenterLL.clone();
do{newPoint=newPoint.offset({x:-llInterval,y:0});
mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj);
centerLatPoints.unshift(newPoint)
}while(mapBounds.containsPixel(mapXY)&&++iter<1000);
newPoint=mapCenterLL.clone();
do{newPoint=newPoint.offset({x:llInterval,y:0});
mapXY=OpenLayers.Projection.transform(newPoint.clone(),llProj,mapProj);
centerLatPoints.push(newPoint)
}while(mapBounds.containsPixel(mapXY)&&++iter<1000);
var lines=[];
for(var i=0;
i<centerLatPoints.length;
++i){var lon=centerLatPoints[i].x;
var pointList=[];
var labelPoint=null;
var latEnd=Math.min(centerLonPoints[0].y,90);
var latStart=Math.max(centerLonPoints[centerLonPoints.length-1].y,-90);
var latDelta=(latEnd-latStart)/this.numPoints;
var lat=latStart;
for(var j=0;
j<=this.numPoints;
++j){var gridPoint=new OpenLayers.Geometry.Point(lon,lat);
gridPoint.transform(llProj,mapProj);
pointList.push(gridPoint);
lat+=latDelta;
if(gridPoint.y>=mapBounds.bottom&&!labelPoint){labelPoint=gridPoint
}}if(this.labelled){var labelPos=new OpenLayers.Geometry.Point(labelPoint.x,mapBounds.bottom);
var labelAttrs={value:lon,label:this.labelled?OpenLayers.Util.getFormattedLonLat(lon,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2};
this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(labelPos,labelAttrs))
}var geom=new OpenLayers.Geometry.LineString(pointList);
lines.push(new OpenLayers.Feature.Vector(geom))
}for(var j=0;
j<centerLonPoints.length;
++j){lat=centerLonPoints[j].y;
if(lat<-90||lat>90){continue
}var pointList=[];
var lonStart=centerLatPoints[0].x;
var lonEnd=centerLatPoints[centerLatPoints.length-1].x;
var lonDelta=(lonEnd-lonStart)/this.numPoints;
var lon=lonStart;
var labelPoint=null;
for(var i=0;
i<=this.numPoints;
++i){var gridPoint=new OpenLayers.Geometry.Point(lon,lat);
gridPoint.transform(llProj,mapProj);
pointList.push(gridPoint);
lon+=lonDelta;
if(gridPoint.x<mapBounds.right){labelPoint=gridPoint
}}if(this.labelled){var labelPos=new OpenLayers.Geometry.Point(mapBounds.right,labelPoint.y);
var labelAttrs={value:lat,label:this.labelled?OpenLayers.Util.getFormattedLonLat(lat,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2};
this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(labelPos,labelAttrs))
}var geom=new OpenLayers.Geometry.LineString(pointList);
lines.push(new OpenLayers.Feature.Vector(geom))
}this.gratLayer.addFeatures(lines)
},CLASS_NAME:"OpenLayers.Control.Graticule"});
OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:false,rotate:true,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:false,initialize:function(layer,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.layer=layer;
if(!this.rotationHandleSymbolizer){this.rotationHandleSymbolizer={stroke:false,pointRadius:10,fillOpacity:0,cursor:"pointer"}
}this.createBox();
this.createControl()
},activate:function(){var activated=false;
if(OpenLayers.Control.prototype.activate.apply(this,arguments)){this.dragControl.activate();
this.layer.addFeatures([this.box]);
this.rotate&&this.layer.addFeatures(this.rotationHandles);
this.layer.addFeatures(this.handles);
activated=true
}return activated
},deactivate:function(){var deactivated=false;
if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.handles);
this.rotate&&this.layer.removeFeatures(this.rotationHandles);
this.layer.removeFeatures([this.box]);
this.dragControl.deactivate();
deactivated=true
}return deactivated
},setMap:function(map){this.dragControl.setMap(map);
OpenLayers.Control.prototype.setMap.apply(this,arguments)
},setFeature:function(feature,initialParams){initialParams=OpenLayers.Util.applyDefaults(initialParams,{rotation:0,scale:1,ratio:1});
var oldRotation=this.rotation;
var oldCenter=this.center;
OpenLayers.Util.extend(this,initialParams);
var cont=this.events.triggerEvent("beforesetfeature",{feature:feature});
if(cont===false){return
}this.feature=feature;
this.activate();
this._setfeature=true;
var featureBounds=this.feature.geometry.getBounds();
this.box.move(featureBounds.getCenterLonLat());
this.box.geometry.rotate(-oldRotation,oldCenter);
this._angle=0;
var ll;
if(this.rotation){var geom=feature.geometry.clone();
geom.rotate(-this.rotation,this.center);
var box=new OpenLayers.Feature.Vector(geom.getBounds().toGeometry());
box.geometry.rotate(this.rotation,this.center);
this.box.geometry.rotate(this.rotation,this.center);
this.box.move(box.geometry.getBounds().getCenterLonLat());
var llGeom=box.geometry.components[0].components[0];
ll=llGeom.getBounds().getCenterLonLat()
}else{ll=new OpenLayers.LonLat(featureBounds.left,featureBounds.bottom)
}this.handles[0].move(ll);
delete this._setfeature;
this.events.triggerEvent("setfeature",{feature:feature})
},unsetFeature:function(){if(this.active){this.deactivate()
}else{this.feature=null;
this.rotation=0;
this.scale=1;
this.ratio=1
}},createBox:function(){var control=this;
this.center=new OpenLayers.Geometry.Point(0,0);
this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,typeof this.renderIntent=="string"?null:this.renderIntent);
this.box.geometry.move=function(x,y){control._moving=true;
OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);
control.center.move(x,y);
delete control._moving
};
var vertexMoveFn=function(x,y){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);
this._rotationHandle&&this._rotationHandle.geometry.move(x,y);
this._handle.geometry.move(x,y)
};
var vertexResizeFn=function(scale,center,ratio){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);
this._rotationHandle&&this._rotationHandle.geometry.resize(scale,center,ratio);
this._handle.geometry.resize(scale,center,ratio)
};
var vertexRotateFn=function(angle,center){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);
this._rotationHandle&&this._rotationHandle.geometry.rotate(angle,center);
this._handle.geometry.rotate(angle,center)
};
var handleMoveFn=function(x,y){var oldX=this.x,oldY=this.y;
OpenLayers.Geometry.Point.prototype.move.call(this,x,y);
if(control._moving){return
}var evt=control.dragControl.handlers.drag.evt;
var preserveAspectRatio=!control._setfeature&&control.preserveAspectRatio;
var reshape=!preserveAspectRatio&&!(evt&&evt.shiftKey);
var oldGeom=new OpenLayers.Geometry.Point(oldX,oldY);
var centerGeometry=control.center;
this.rotate(-control.rotation,centerGeometry);
oldGeom.rotate(-control.rotation,centerGeometry);
var dx1=this.x-centerGeometry.x;
var dy1=this.y-centerGeometry.y;
var dx0=dx1-(this.x-oldGeom.x);
var dy0=dy1-(this.y-oldGeom.y);
if(control.irregular&&!control._setfeature){dx1-=(this.x-oldGeom.x)/2;
dy1-=(this.y-oldGeom.y)/2
}this.x=oldX;
this.y=oldY;
var scale,ratio=1;
if(reshape){scale=Math.abs(dy0)<0.00001?1:dy1/dy0;
ratio=(Math.abs(dx0)<0.00001?1:(dx1/dx0))/scale
}else{var l0=Math.sqrt((dx0*dx0)+(dy0*dy0));
var l1=Math.sqrt((dx1*dx1)+(dy1*dy1));
scale=l1/l0
}control._moving=true;
control.box.geometry.rotate(-control.rotation,centerGeometry);
delete control._moving;
control.box.geometry.resize(scale,centerGeometry,ratio);
control.box.geometry.rotate(control.rotation,centerGeometry);
control.transformFeature({scale:scale,ratio:ratio});
if(control.irregular&&!control._setfeature){var newCenter=centerGeometry.clone();
newCenter.x+=Math.abs(oldX-centerGeometry.x)<0.00001?0:(this.x-oldX);
newCenter.y+=Math.abs(oldY-centerGeometry.y)<0.00001?0:(this.y-oldY);
control.box.geometry.move(this.x-oldX,this.y-oldY);
control.transformFeature({center:newCenter})
}};
var rotationHandleMoveFn=function(x,y){var oldX=this.x,oldY=this.y;
OpenLayers.Geometry.Point.prototype.move.call(this,x,y);
if(control._moving){return
}var evt=control.dragControl.handlers.drag.evt;
var constrain=(evt&&evt.shiftKey)?45:1;
var centerGeometry=control.center;
var dx1=this.x-centerGeometry.x;
var dy1=this.y-centerGeometry.y;
var dx0=dx1-x;
var dy0=dy1-y;
this.x=oldX;
this.y=oldY;
var a0=Math.atan2(dy0,dx0);
var a1=Math.atan2(dy1,dx1);
var angle=a1-a0;
angle*=180/Math.PI;
control._angle=(control._angle+angle)%360;
var diff=control.rotation%constrain;
if(Math.abs(control._angle)>=constrain||diff!==0){angle=Math.round(control._angle/constrain)*constrain-diff;
control._angle=0;
control.box.geometry.rotate(angle,centerGeometry);
control.transformFeature({rotation:angle})
}};
var handles=new Array(8);
var rotationHandles=new Array(4);
var geom,handle,rotationHandle;
var positions=["sw","s","se","e","ne","n","nw","w"];
for(var i=0;
i<8;
++i){geom=this.box.geometry.components[i];
handle=new OpenLayers.Feature.Vector(geom.clone(),{role:positions[i]+"-resize"},typeof this.renderIntent=="string"?null:this.renderIntent);
if(i%2==0){rotationHandle=new OpenLayers.Feature.Vector(geom.clone(),{role:positions[i]+"-rotate"},typeof this.rotationHandleSymbolizer=="string"?null:this.rotationHandleSymbolizer);
rotationHandle.geometry.move=rotationHandleMoveFn;
geom._rotationHandle=rotationHandle;
rotationHandles[i/2]=rotationHandle
}geom.move=vertexMoveFn;
geom.resize=vertexResizeFn;
geom.rotate=vertexRotateFn;
handle.geometry.move=handleMoveFn;
geom._handle=handle;
handles[i]=handle
}this.rotationHandles=rotationHandles;
this.handles=handles
},createControl:function(){var control=this;
this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:true,moveFeature:function(pixel){if(this.feature===control.feature){this.feature=control.box
}OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)
},onDrag:function(feature,pixel){if(feature===control.box){control.transformFeature({center:control.center})
}},onStart:function(feature,pixel){var eligible=!control.geometryTypes||OpenLayers.Util.indexOf(control.geometryTypes,feature.geometry.CLASS_NAME)!==-1;
var i=OpenLayers.Util.indexOf(control.handles,feature);
i+=OpenLayers.Util.indexOf(control.rotationHandles,feature);
if(feature!==control.feature&&feature!==control.box&&i==-2&&eligible){control.setFeature(feature)
}},onComplete:function(feature,pixel){control.events.triggerEvent("transformcomplete",{feature:control.feature})
}})
},drawHandles:function(){var layer=this.layer;
for(var i=0;
i<8;
++i){if(this.rotate&&i%2===0){layer.drawFeature(this.rotationHandles[i/2],this.rotationHandleSymbolizer)
}layer.drawFeature(this.handles[i],this.renderIntent)
}},transformFeature:function(mods){if(!this._setfeature){this.scale*=(mods.scale||1);
this.ratio*=(mods.ratio||1);
var oldRotation=this.rotation;
this.rotation=(this.rotation+(mods.rotation||0))%360;
if(this.events.triggerEvent("beforetransform",mods)!==false){var feature=this.feature;
var geom=feature.geometry;
var center=this.center;
geom.rotate(-oldRotation,center);
if(mods.scale||mods.ratio){geom.resize(mods.scale,center,mods.ratio)
}else{if(mods.center){feature.move(mods.center.getBounds().getCenterLonLat())
}}geom.rotate(this.rotation,center);
this.layer.drawFeature(feature);
feature.toState(OpenLayers.State.UPDATE);
this.events.triggerEvent("transform",mods)
}}this.layer.drawFeature(this.box,this.renderIntent);
this.drawHandles()
},destroy:function(){var geom;
for(var i=0;
i<8;
++i){geom=this.box.geometry.components[i];
geom._handle.destroy();
geom._handle=null;
geom._rotationHandle&&geom._rotationHandle.destroy();
geom._rotationHandle=null
}this.center=null;
this.feature=null;
this.handles=null;
this.rotationHandleSymbolizer=null;
this.rotationHandles=null;
this.box.destroy();
this.box=null;
this.layer=null;
this.dragControl.destroy();
this.dragControl=null;
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Control.TransformFeature"});
OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:true,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:false,single:true,"double":false,stopSingle:false,stopDouble:false},handlerMode:"click",setHandler:function(hm){this.handlerMode=hm;
this.resetHandler()
},resetHandler:function(){if(this.handler){this.handler.deactivate();
this.handler.destroy();
this.handler=null
}if(this.handlerMode=="hover"){this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions)
}else{if(this.handlerMode=="click"){this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions)
}else{if(this.handlerMode=="move"){this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)
}}}if(this.handler){return true
}else{return false
}},initialize:function(options){options=options||{};
options.handlerOptions=options.handlerOptions||this.defaultHandlerOptions;
OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.resetHandler()
},handleEvent:function(evt){if(evt==null){this.reset();
return
}var lonLat=this.map.getLonLatFromPixel(evt.xy);
if(!lonLat){return
}var layers=this.findLayers();
if(layers.length>0){var infoLookup={};
var layer,idx;
for(var i=0,len=layers.length;
i<len;
i++){layer=layers[i];
idx=OpenLayers.Util.indexOf(this.map.layers,layer);
infoLookup[idx]=layer.getFeatureInfo(lonLat)
}this.callback(infoLookup,lonLat,evt.xy)
}},callback:function(infoLookup){},reset:function(evt){this.callback(null)
},findLayers:function(){var candidates=this.layers||this.map.layers;
var layers=[];
var layer;
for(var i=candidates.length-1;
i>=0;
--i){layer=candidates[i];
if(layer instanceof OpenLayers.Layer.UTFGrid){layers.push(layer)
}}return layers
},CLASS_NAME:"OpenLayers.Control.UTFGrid"});
OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:false,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:false},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,handlerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(handler,options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks);
this.handlerOptions=this.handlerOptions||{};
this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:false,tileOptions:{maxGetUrlLength:2048}});
if(this.sketchStyle){this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})})
}this.handler=new handler(this,this.callbacks,this.handlerOptions)
},destroy:function(){for(var key in this.layerCache){delete this.layerCache[key]
}for(var key in this.wfsCache){delete this.wfsCache[key]
}OpenLayers.Control.prototype.destroy.apply(this,arguments)
},coupleLayerVisiblity:function(evt){this.setVisibility(evt.object.getVisibility())
},createSelectionLayer:function(source){var selectionLayer;
if(!this.layerCache[source.id]){selectionLayer=new OpenLayers.Layer.WMS(source.name,source.url,source.params,OpenLayers.Util.applyDefaults(this.layerOptions,source.getOptions()));
this.layerCache[source.id]=selectionLayer;
if(this.layerOptions.displayInLayerSwitcher===false){source.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:selectionLayer})
}this.map.addLayer(selectionLayer)
}else{selectionLayer=this.layerCache[source.id]
}return selectionLayer
},createSLD:function(layer,filters,geometryAttributes){var sld={version:"1.0.0",namedLayers:{}};
var layerNames=[layer.params.LAYERS].join(",").split(",");
for(var i=0,len=layerNames.length;
i<len;
i++){var name=layerNames[i];
sld.namedLayers[name]={name:name,userStyles:[]};
var symbolizer=this.selectionSymbolizer;
var geometryAttribute=geometryAttributes[i];
if(geometryAttribute.type.indexOf("Polygon")>=0){symbolizer={Polygon:this.selectionSymbolizer.Polygon}
}else{if(geometryAttribute.type.indexOf("LineString")>=0){symbolizer={Line:this.selectionSymbolizer.Line}
}else{if(geometryAttribute.type.indexOf("Point")>=0){symbolizer={Point:this.selectionSymbolizer.Point}
}}}var filter=filters[i];
sld.namedLayers[name].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:symbolizer,filter:filter,maxScaleDenominator:layer.options.minScale})]})
}return new OpenLayers.Format.SLD({srsName:this.map.getProjection()}).write(sld)
},parseDescribeLayer:function(request){var format=new OpenLayers.Format.WMSDescribeLayer();
var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}var describeLayer=format.read(doc);
var typeNames=[];
var url=null;
for(var i=0,len=describeLayer.length;
i<len;
i++){if(describeLayer[i].owsType=="WFS"){typeNames.push(describeLayer[i].typeName);
url=describeLayer[i].owsURL
}}var options={url:url,params:{SERVICE:"WFS",TYPENAME:typeNames.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(request){var format=new OpenLayers.Format.WFSDescribeFeatureType();
var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}var describeFeatureType=format.read(doc);
this.control.wfsCache[this.layer.id]=describeFeatureType;
this.control._queue&&this.control.applySelection()
},scope:this};
OpenLayers.Request.GET(options)
},getGeometryAttributes:function(layer){var result=[];
var cache=this.wfsCache[layer.id];
for(var i=0,len=cache.featureTypes.length;
i<len;
i++){var typeName=cache.featureTypes[i];
var properties=typeName.properties;
for(var j=0,lenj=properties.length;
j<lenj;
j++){var property=properties[j];
var type=property.type;
if((type.indexOf("LineString")>=0)||(type.indexOf("GeometryAssociationType")>=0)||(type.indexOf("GeometryPropertyType")>=0)||(type.indexOf("Point")>=0)||(type.indexOf("Polygon")>=0)){result.push(property)
}}}return result
},activate:function(){var activated=OpenLayers.Control.prototype.activate.call(this);
if(activated){for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.layers[i];
if(layer&&!this.wfsCache[layer.id]){var options={url:layer.url,params:{SERVICE:"WMS",VERSION:layer.params.VERSION,LAYERS:layer.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:layer,control:this}};
OpenLayers.Request.GET(options)
}}}return activated
},deactivate:function(){var deactivated=OpenLayers.Control.prototype.deactivate.call(this);
if(deactivated){for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.layers[i];
if(layer&&this.clearOnDeactivate===true){var layerCache=this.layerCache;
var selectionLayer=layerCache[layer.id];
if(selectionLayer){layer.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:selectionLayer});
selectionLayer.destroy();
delete layerCache[layer.id]
}}}}return deactivated
},setLayers:function(layers){if(this.active){this.deactivate();
this.layers=layers;
this.activate()
}else{this.layers=layers
}},createFilter:function(geometryAttribute,geometry){var filter=null;
if(this.handler instanceof OpenLayers.Handler.RegularPolygon){if(this.handler.irregular===true){filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:geometryAttribute.name,value:geometry.getBounds()})
}else{filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry})
}}else{if(this.handler instanceof OpenLayers.Handler.Polygon){filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry})
}else{if(this.handler instanceof OpenLayers.Handler.Path){if(geometryAttribute.type.indexOf("Point")>=0){filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:geometryAttribute.name,distance:this.map.getExtent().getWidth()*0.01,distanceUnits:this.map.getUnits(),value:geometry})
}else{filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry})
}}else{if(this.handler instanceof OpenLayers.Handler.Click){if(geometryAttribute.type.indexOf("Polygon")>=0){filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:geometryAttribute.name,value:geometry})
}else{filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:geometryAttribute.name,distance:this.map.getExtent().getWidth()*0.01,distanceUnits:this.map.getUnits(),value:geometry})
}}}}}return filter
},select:function(geometry){this._queue=function(){for(var i=0,len=this.layers.length;
i<len;
i++){var layer=this.layers[i];
var geometryAttributes=this.getGeometryAttributes(layer);
var filters=[];
for(var j=0,lenj=geometryAttributes.length;
j<lenj;
j++){var geometryAttribute=geometryAttributes[j];
if(geometryAttribute!==null){if(!(geometry instanceof OpenLayers.Geometry)){var point=this.map.getLonLatFromPixel(geometry.xy);
geometry=new OpenLayers.Geometry.Point(point.lon,point.lat)
}var filter=this.createFilter(geometryAttribute,geometry);
if(filter!==null){filters.push(filter)
}}}var selectionLayer=this.createSelectionLayer(layer);
var sld=this.createSLD(layer,filters,geometryAttributes);
this.events.triggerEvent("selected",{layer:layer,filters:filters});
selectionLayer.mergeNewParams({SLD_BODY:sld});
delete this._queue
}};
this.applySelection()
},applySelection:function(){var canApply=true;
for(var i=0,len=this.layers.length;
i<len;
i++){if(!this.wfsCache[this.layers[i].id]){canApply=false;
break
}}canApply&&this._queue.call(this)
},CLASS_NAME:"OpenLayers.Control.SLDSelect"});
OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"-",zoomOutId:"olZoomOutLink",draw:function(){var div=OpenLayers.Control.prototype.draw.apply(this),links=this.getOrCreateLinks(div),zoomIn=links.zoomIn,zoomOut=links.zoomOut,eventsInstance=this.map.events;
if(zoomOut.parentNode!==div){eventsInstance=this.events;
eventsInstance.attachToElement(zoomOut.parentNode)
}eventsInstance.register("buttonclick",this,this.onZoomClick);
this.zoomInLink=zoomIn;
this.zoomOutLink=zoomOut;
return div
},getOrCreateLinks:function(el){var zoomIn=document.getElementById(this.zoomInId),zoomOut=document.getElementById(this.zoomOutId);
if(!zoomIn){zoomIn=document.createElement("a");
zoomIn.href="#zoomIn";
zoomIn.appendChild(document.createTextNode(this.zoomInText));
zoomIn.className="olControlZoomIn";
el.appendChild(zoomIn)
}OpenLayers.Element.addClass(zoomIn,"olButton");
if(!zoomOut){zoomOut=document.createElement("a");
zoomOut.href="#zoomOut";
zoomOut.appendChild(document.createTextNode(this.zoomOutText));
zoomOut.className="olControlZoomOut";
el.appendChild(zoomOut)
}OpenLayers.Element.addClass(zoomOut,"olButton");
return{zoomIn:zoomIn,zoomOut:zoomOut}
},onZoomClick:function(evt){var button=evt.buttonElement;
if(button===this.zoomInLink){this.map.zoomIn()
}else{if(button===this.zoomOutLink){this.map.zoomOut()
}}},destroy:function(){if(this.map){this.map.events.unregister("buttonclick",this,this.onZoomClick)
}delete this.zoomInLink;
delete this.zoomOutLink;
OpenLayers.Control.prototype.destroy.apply(this)
},CLASS_NAME:"OpenLayers.Control.Zoom"});
OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){this.id=null;
this.bounds=null
},clone:function(){return new OpenLayers.Geometry()
},setBounds:function(bounds){if(bounds){this.bounds=bounds.clone()
}},clearBounds:function(){this.bounds=null;
if(this.parent){this.parent.clearBounds()
}},extendBounds:function(newBounds){var bounds=this.getBounds();
if(!bounds){this.setBounds(newBounds)
}else{this.bounds.extend(newBounds)
}},getBounds:function(){if(this.bounds==null){this.calculateBounds()
}return this.bounds
},calculateBounds:function(){},distanceTo:function(geometry,options){},getVertices:function(nodes){},atPoint:function(lonlat,toleranceLon,toleranceLat){var atPoint=false;
var bounds=this.getBounds();
if((bounds!=null)&&(lonlat!=null)){var dX=(toleranceLon!=null)?toleranceLon:0;
var dY=(toleranceLat!=null)?toleranceLat:0;
var toleranceBounds=new OpenLayers.Bounds(this.bounds.left-dX,this.bounds.bottom-dY,this.bounds.right+dX,this.bounds.top+dY);
atPoint=toleranceBounds.containsLonLat(lonlat)
}return atPoint
},getLength:function(){return 0
},getArea:function(){return 0
},getCentroid:function(){return null
},toString:function(){var string;
if(OpenLayers.Format&&OpenLayers.Format.WKT){string=OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))
}else{string=Object.prototype.toString.call(this)
}return string
},CLASS_NAME:"OpenLayers.Geometry"});
OpenLayers.Geometry.fromWKT=function(wkt){var geom;
if(OpenLayers.Format&&OpenLayers.Format.WKT){var format=OpenLayers.Geometry.fromWKT.format;
if(!format){format=new OpenLayers.Format.WKT();
OpenLayers.Geometry.fromWKT.format=format
}var result=format.read(wkt);
if(result instanceof OpenLayers.Feature.Vector){geom=result.geometry
}else{if(OpenLayers.Util.isArray(result)){var len=result.length;
var components=new Array(len);
for(var i=0;
i<len;
++i){components[i]=result[i].geometry
}geom=new OpenLayers.Geometry.Collection(components)
}}}return geom
};
OpenLayers.Geometry.segmentsIntersect=function(seg1,seg2,options){var point=options&&options.point;
var tolerance=options&&options.tolerance;
var intersection=false;
var x11_21=seg1.x1-seg2.x1;
var y11_21=seg1.y1-seg2.y1;
var x12_11=seg1.x2-seg1.x1;
var y12_11=seg1.y2-seg1.y1;
var y22_21=seg2.y2-seg2.y1;
var x22_21=seg2.x2-seg2.x1;
var d=(y22_21*x12_11)-(x22_21*y12_11);
var n1=(x22_21*y11_21)-(y22_21*x11_21);
var n2=(x12_11*y11_21)-(y12_11*x11_21);
if(d==0){if(n1==0&&n2==0){intersection=true
}}else{var along1=n1/d;
var along2=n2/d;
if(along1>=0&&along1<=1&&along2>=0&&along2<=1){if(!point){intersection=true
}else{var x=seg1.x1+(along1*x12_11);
var y=seg1.y1+(along1*y12_11);
intersection=new OpenLayers.Geometry.Point(x,y)
}}}if(tolerance){var dist;
if(intersection){if(point){var segs=[seg1,seg2];
var seg,x,y;
outer:for(var i=0;
i<2;
++i){seg=segs[i];
for(var j=1;
j<3;
++j){x=seg["x"+j];
y=seg["y"+j];
dist=Math.sqrt(Math.pow(x-intersection.x,2)+Math.pow(y-intersection.y,2));
if(dist<tolerance){intersection.x=x;
intersection.y=y;
break outer
}}}}}else{var segs=[seg1,seg2];
var source,target,x,y,p,result;
outer:for(var i=0;
i<2;
++i){source=segs[i];
target=segs[(i+1)%2];
for(var j=1;
j<3;
++j){p={x:source["x"+j],y:source["y"+j]};
result=OpenLayers.Geometry.distanceToSegment(p,target);
if(result.distance<tolerance){if(point){intersection=new OpenLayers.Geometry.Point(p.x,p.y)
}else{intersection=true
}break outer
}}}}}return intersection
};
OpenLayers.Geometry.distanceToSegment=function(point,segment){var x0=point.x;
var y0=point.y;
var x1=segment.x1;
var y1=segment.y1;
var x2=segment.x2;
var y2=segment.y2;
var dx=x2-x1;
var dy=y2-y1;
var along=((dx*(x0-x1))+(dy*(y0-y1)))/(Math.pow(dx,2)+Math.pow(dy,2));
var x,y;
if(along<=0){x=x1;
y=y1
}else{if(along>=1){x=x2;
y=y2
}else{x=x1+along*dx;
y=y1+along*dy
}}return{distance:Math.sqrt(Math.pow(x-x0,2)+Math.pow(y-y0,2)),x:x,y:y}
};
OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(components){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);
this.components=[];
if(components!=null){this.addComponents(components)
}},destroy:function(){this.components.length=0;
this.components=null;
OpenLayers.Geometry.prototype.destroy.apply(this,arguments)
},clone:function(){var geometry=eval("new "+this.CLASS_NAME+"()");
for(var i=0,len=this.components.length;
i<len;
i++){geometry.addComponent(this.components[i].clone())
}OpenLayers.Util.applyDefaults(geometry,this);
return geometry
},getComponentsString:function(){var strings=[];
for(var i=0,len=this.components.length;
i<len;
i++){strings.push(this.components[i].toShortString())
}return strings.join(",")
},calculateBounds:function(){this.bounds=null;
var bounds=new OpenLayers.Bounds();
var components=this.components;
if(components){for(var i=0,len=components.length;
i<len;
i++){bounds.extend(components[i].getBounds())
}}if(bounds.left!=null&&bounds.bottom!=null&&bounds.right!=null&&bounds.top!=null){this.setBounds(bounds)
}},addComponents:function(components){if(!(OpenLayers.Util.isArray(components))){components=[components]
}for(var i=0,len=components.length;
i<len;
i++){this.addComponent(components[i])
}},addComponent:function(component,index){var added=false;
if(component){if(this.componentTypes==null||(OpenLayers.Util.indexOf(this.componentTypes,component.CLASS_NAME)>-1)){if(index!=null&&(index<this.components.length)){var components1=this.components.slice(0,index);
var components2=this.components.slice(index,this.components.length);
components1.push(component);
this.components=components1.concat(components2)
}else{this.components.push(component)
}component.parent=this;
this.clearBounds();
added=true
}}return added
},removeComponents:function(components){var removed=false;
if(!(OpenLayers.Util.isArray(components))){components=[components]
}for(var i=components.length-1;
i>=0;
--i){removed=this.removeComponent(components[i])||removed
}return removed
},removeComponent:function(component){OpenLayers.Util.removeItem(this.components,component);
this.clearBounds();
return true
},getLength:function(){var length=0;
for(var i=0,len=this.components.length;
i<len;
i++){length+=this.components[i].getLength()
}return length
},getArea:function(){var area=0;
for(var i=0,len=this.components.length;
i<len;
i++){area+=this.components[i].getArea()
}return area
},getGeodesicArea:function(projection){var area=0;
for(var i=0,len=this.components.length;
i<len;
i++){area+=this.components[i].getGeodesicArea(projection)
}return area
},getCentroid:function(weighted){if(!weighted){return this.components.length&&this.components[0].getCentroid()
}var len=this.components.length;
if(!len){return false
}var areas=[];
var centroids=[];
var areaSum=0;
var minArea=Number.MAX_VALUE;
var component;
for(var i=0;
i<len;
++i){component=this.components[i];
var area=component.getArea();
var centroid=component.getCentroid(true);
if(isNaN(area)||isNaN(centroid.x)||isNaN(centroid.y)){continue
}areas.push(area);
areaSum+=area;
minArea=(area<minArea&&area>0)?area:minArea;
centroids.push(centroid)
}len=areas.length;
if(areaSum===0){for(var i=0;
i<len;
++i){areas[i]=1
}areaSum=areas.length
}else{for(var i=0;
i<len;
++i){areas[i]/=minArea
}areaSum/=minArea
}var xSum=0,ySum=0,centroid,area;
for(var i=0;
i<len;
++i){centroid=centroids[i];
area=areas[i];
xSum+=centroid.x*area;
ySum+=centroid.y*area
}return new OpenLayers.Geometry.Point(xSum/areaSum,ySum/areaSum)
},getGeodesicLength:function(projection){var length=0;
for(var i=0,len=this.components.length;
i<len;
i++){length+=this.components[i].getGeodesicLength(projection)
}return length
},move:function(x,y){for(var i=0,len=this.components.length;
i<len;
i++){this.components[i].move(x,y)
}},rotate:function(angle,origin){for(var i=0,len=this.components.length;
i<len;
++i){this.components[i].rotate(angle,origin)
}},resize:function(scale,origin,ratio){for(var i=0;
i<this.components.length;
++i){this.components[i].resize(scale,origin,ratio)
}return this
},distanceTo:function(geometry,options){var edge=!(options&&options.edge===false);
var details=edge&&options&&options.details;
var result,best,distance;
var min=Number.POSITIVE_INFINITY;
for(var i=0,len=this.components.length;
i<len;
++i){result=this.components[i].distanceTo(geometry,options);
distance=details?result.distance:result;
if(distance<min){min=distance;
best=result;
if(min==0){break
}}}return best
},equals:function(geometry){var equivalent=true;
if(!geometry||!geometry.CLASS_NAME||(this.CLASS_NAME!=geometry.CLASS_NAME)){equivalent=false
}else{if(!(OpenLayers.Util.isArray(geometry.components))||(geometry.components.length!=this.components.length)){equivalent=false
}else{for(var i=0,len=this.components.length;
i<len;
++i){if(!this.components[i].equals(geometry.components[i])){equivalent=false;
break
}}}}return equivalent
},transform:function(source,dest){if(source&&dest){for(var i=0,len=this.components.length;
i<len;
i++){var component=this.components[i];
component.transform(source,dest)
}this.bounds=null
}return this
},intersects:function(geometry){var intersect=false;
for(var i=0,len=this.components.length;
i<len;
++i){intersect=geometry.intersects(this.components[i]);
if(intersect){break
}}return intersect
},getVertices:function(nodes){var vertices=[];
for(var i=0,len=this.components.length;
i<len;
++i){Array.prototype.push.apply(vertices,this.components[i].getVertices(nodes))
}return vertices
},CLASS_NAME:"OpenLayers.Geometry.Collection"});
OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(x,y){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);
this.x=parseFloat(x);
this.y=parseFloat(y)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Geometry.Point(this.x,this.y)
}OpenLayers.Util.applyDefaults(obj,this);
return obj
},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)
},distanceTo:function(geometry,options){var edge=!(options&&options.edge===false);
var details=edge&&options&&options.details;
var distance,x0,y0,x1,y1,result;
if(geometry instanceof OpenLayers.Geometry.Point){x0=this.x;
y0=this.y;
x1=geometry.x;
y1=geometry.y;
distance=Math.sqrt(Math.pow(x0-x1,2)+Math.pow(y0-y1,2));
result=!details?distance:{x0:x0,y0:y0,x1:x1,y1:y1,distance:distance}
}else{result=geometry.distanceTo(this,options);
if(details){result={x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0,distance:result.distance}
}}return result
},equals:function(geom){var equals=false;
if(geom!=null){equals=((this.x==geom.x&&this.y==geom.y)||(isNaN(this.x)&&isNaN(this.y)&&isNaN(geom.x)&&isNaN(geom.y)))
}return equals
},toShortString:function(){return(this.x+", "+this.y)
},move:function(x,y){this.x=this.x+x;
this.y=this.y+y;
this.clearBounds()
},rotate:function(angle,origin){angle*=Math.PI/180;
var radius=this.distanceTo(origin);
var theta=angle+Math.atan2(this.y-origin.y,this.x-origin.x);
this.x=origin.x+(radius*Math.cos(theta));
this.y=origin.y+(radius*Math.sin(theta));
this.clearBounds()
},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)
},resize:function(scale,origin,ratio){ratio=(ratio==undefined)?1:ratio;
this.x=origin.x+(scale*ratio*(this.x-origin.x));
this.y=origin.y+(scale*(this.y-origin.y));
this.clearBounds();
return this
},intersects:function(geometry){var intersect=false;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){intersect=this.equals(geometry)
}else{intersect=geometry.intersects(this)
}return intersect
},transform:function(source,dest){if((source&&dest)){OpenLayers.Projection.transform(this,source,dest);
this.bounds=null
}return this
},getVertices:function(nodes){return[this]
},CLASS_NAME:"OpenLayers.Geometry.Point"});
OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(point,index){this.addComponent(point,index)
},removePoint:function(point){this.removeComponent(point)
},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});
OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var length=0;
if(this.components&&(this.components.length>1)){for(var i=1,len=this.components.length;
i<len;
i++){length+=this.components[i-1].distanceTo(this.components[i])
}}return length
},getGeodesicLength:function(projection){var geom=this;
if(projection){var gg=new OpenLayers.Projection("EPSG:4326");
if(!gg.equals(projection)){geom=this.clone().transform(projection,gg)
}}var length=0;
if(geom.components&&(geom.components.length>1)){var p1,p2;
for(var i=1,len=geom.components.length;
i<len;
i++){p1=geom.components[i-1];
p2=geom.components[i];
length+=OpenLayers.Util.distVincenty({lon:p1.x,lat:p1.y},{lon:p2.x,lat:p2.y})
}}return length*1000
},CLASS_NAME:"OpenLayers.Geometry.Curve"});
OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(point){var removed=this.components&&(this.components.length>2);
if(removed){OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments)
}return removed
},intersects:function(geometry){var intersect=false;
var type=geometry.CLASS_NAME;
if(type=="OpenLayers.Geometry.LineString"||type=="OpenLayers.Geometry.LinearRing"||type=="OpenLayers.Geometry.Point"){var segs1=this.getSortedSegments();
var segs2;
if(type=="OpenLayers.Geometry.Point"){segs2=[{x1:geometry.x,y1:geometry.y,x2:geometry.x,y2:geometry.y}]
}else{segs2=geometry.getSortedSegments()
}var seg1,seg1x1,seg1x2,seg1y1,seg1y2,seg2,seg2y1,seg2y2;
outer:for(var i=0,len=segs1.length;
i<len;
++i){seg1=segs1[i];
seg1x1=seg1.x1;
seg1x2=seg1.x2;
seg1y1=seg1.y1;
seg1y2=seg1.y2;
inner:for(var j=0,jlen=segs2.length;
j<jlen;
++j){seg2=segs2[j];
if(seg2.x1>seg1x2){break
}if(seg2.x2<seg1x1){continue
}seg2y1=seg2.y1;
seg2y2=seg2.y2;
if(Math.min(seg2y1,seg2y2)>Math.max(seg1y1,seg1y2)){continue
}if(Math.max(seg2y1,seg2y2)<Math.min(seg1y1,seg1y2)){continue
}if(OpenLayers.Geometry.segmentsIntersect(seg1,seg2)){intersect=true;
break outer
}}}}else{intersect=geometry.intersects(this)
}return intersect
},getSortedSegments:function(){var numSeg=this.components.length-1;
var segments=new Array(numSeg),point1,point2;
for(var i=0;
i<numSeg;
++i){point1=this.components[i];
point2=this.components[i+1];
if(point1.x<point2.x){segments[i]={x1:point1.x,y1:point1.y,x2:point2.x,y2:point2.y}
}else{segments[i]={x1:point2.x,y1:point2.y,x2:point1.x,y2:point1.y}
}}function byX1(seg1,seg2){return seg1.x1-seg2.x1
}return segments.sort(byX1)
},splitWithSegment:function(seg,options){var edge=!(options&&options.edge===false);
var tolerance=options&&options.tolerance;
var lines=[];
var verts=this.getVertices();
var points=[];
var intersections=[];
var split=false;
var vert1,vert2,point;
var node,vertex,target;
var interOptions={point:true,tolerance:tolerance};
var result=null;
for(var i=0,stop=verts.length-2;
i<=stop;
++i){vert1=verts[i];
points.push(vert1.clone());
vert2=verts[i+1];
target={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y};
point=OpenLayers.Geometry.segmentsIntersect(seg,target,interOptions);
if(point instanceof OpenLayers.Geometry.Point){if((point.x===seg.x1&&point.y===seg.y1)||(point.x===seg.x2&&point.y===seg.y2)||point.equals(vert1)||point.equals(vert2)){vertex=true
}else{vertex=false
}if(vertex||edge){if(!point.equals(intersections[intersections.length-1])){intersections.push(point.clone())
}if(i===0){if(point.equals(vert1)){continue
}}if(point.equals(vert2)){continue
}split=true;
if(!point.equals(vert1)){points.push(point)
}lines.push(new OpenLayers.Geometry.LineString(points));
points=[point.clone()]
}}}if(split){points.push(vert2.clone());
lines.push(new OpenLayers.Geometry.LineString(points))
}if(intersections.length>0){var xDir=seg.x1<seg.x2?1:-1;
var yDir=seg.y1<seg.y2?1:-1;
result={lines:lines,points:intersections.sort(function(p1,p2){return(xDir*p1.x-xDir*p2.x)||(yDir*p1.y-yDir*p2.y)
})}
}return result
},split:function(target,options){var results=null;
var mutual=options&&options.mutual;
var sourceSplit,targetSplit,sourceParts,targetParts;
if(target instanceof OpenLayers.Geometry.LineString){var verts=this.getVertices();
var vert1,vert2,seg,splits,lines,point;
var points=[];
sourceParts=[];
for(var i=0,stop=verts.length-2;
i<=stop;
++i){vert1=verts[i];
vert2=verts[i+1];
seg={x1:vert1.x,y1:vert1.y,x2:vert2.x,y2:vert2.y};
targetParts=targetParts||[target];
if(mutual){points.push(vert1.clone())
}for(var j=0;
j<targetParts.length;
++j){splits=targetParts[j].splitWithSegment(seg,options);
if(splits){lines=splits.lines;
if(lines.length>0){lines.unshift(j,1);
Array.prototype.splice.apply(targetParts,lines);
j+=lines.length-2
}if(mutual){for(var k=0,len=splits.points.length;
k<len;
++k){point=splits.points[k];
if(!point.equals(vert1)){points.push(point);
sourceParts.push(new OpenLayers.Geometry.LineString(points));
if(point.equals(vert2)){points=[]
}else{points=[point.clone()]
}}}}}}}if(mutual&&sourceParts.length>0&&points.length>0){points.push(vert2.clone());
sourceParts.push(new OpenLayers.Geometry.LineString(points))
}}else{results=target.splitWith(this,options)
}if(targetParts&&targetParts.length>1){targetSplit=true
}else{targetParts=[]
}if(sourceParts&&sourceParts.length>1){sourceSplit=true
}else{sourceParts=[]
}if(targetSplit||sourceSplit){if(mutual){results=[sourceParts,targetParts]
}else{results=targetParts
}}return results
},splitWith:function(geometry,options){return geometry.split(this,options)
},getVertices:function(nodes){var vertices;
if(nodes===true){vertices=[this.components[0],this.components[this.components.length-1]]
}else{if(nodes===false){vertices=this.components.slice(1,this.components.length-1)
}else{vertices=this.components.slice()
}}return vertices
},distanceTo:function(geometry,options){var edge=!(options&&options.edge===false);
var details=edge&&options&&options.details;
var result,best={};
var min=Number.POSITIVE_INFINITY;
if(geometry instanceof OpenLayers.Geometry.Point){var segs=this.getSortedSegments();
var x=geometry.x;
var y=geometry.y;
var seg;
for(var i=0,len=segs.length;
i<len;
++i){seg=segs[i];
result=OpenLayers.Geometry.distanceToSegment(geometry,seg);
if(result.distance<min){min=result.distance;
best=result;
if(min===0){break
}}else{if(seg.x2>x&&((y>seg.y1&&y<seg.y2)||(y<seg.y1&&y>seg.y2))){break
}}}if(details){best={distance:best.distance,x0:best.x,y0:best.y,x1:x,y1:y}
}else{best=best.distance
}}else{if(geometry instanceof OpenLayers.Geometry.LineString){var segs0=this.getSortedSegments();
var segs1=geometry.getSortedSegments();
var seg0,seg1,intersection,x0,y0;
var len1=segs1.length;
var interOptions={point:true};
outer:for(var i=0,len=segs0.length;
i<len;
++i){seg0=segs0[i];
x0=seg0.x1;
y0=seg0.y1;
for(var j=0;
j<len1;
++j){seg1=segs1[j];
intersection=OpenLayers.Geometry.segmentsIntersect(seg0,seg1,interOptions);
if(intersection){min=0;
best={distance:0,x0:intersection.x,y0:intersection.y,x1:intersection.x,y1:intersection.y};
break outer
}else{result=OpenLayers.Geometry.distanceToSegment({x:x0,y:y0},seg1);
if(result.distance<min){min=result.distance;
best={distance:min,x0:x0,y0:y0,x1:result.x,y1:result.y}
}}}}if(!details){best=best.distance
}if(min!==0){if(seg0){result=geometry.distanceTo(new OpenLayers.Geometry.Point(seg0.x2,seg0.y2),options);
var dist=details?result.distance:result;
if(dist<min){if(details){best={distance:min,x0:result.x1,y0:result.y1,x1:result.x0,y1:result.y0}
}else{best=dist
}}}}}else{best=geometry.distanceTo(this,options);
if(details){best={distance:best.distance,x0:best.x1,y0:best.y1,x1:best.x0,y1:best.y0}
}}}return best
},simplify:function(tolerance){if(this&&this!==null){var points=this.getVertices();
if(points.length<3){return this
}var compareNumbers=function(a,b){return(a-b)
};
var douglasPeuckerReduction=function(points,firstPoint,lastPoint,tolerance){var maxDistance=0;
var indexFarthest=0;
for(var index=firstPoint,distance;
index<lastPoint;
index++){distance=perpendicularDistance(points[firstPoint],points[lastPoint],points[index]);
if(distance>maxDistance){maxDistance=distance;
indexFarthest=index
}}if(maxDistance>tolerance&&indexFarthest!=firstPoint){pointIndexsToKeep.push(indexFarthest);
douglasPeuckerReduction(points,firstPoint,indexFarthest,tolerance);
douglasPeuckerReduction(points,indexFarthest,lastPoint,tolerance)
}};
var perpendicularDistance=function(point1,point2,point){var area=Math.abs(0.5*(point1.x*point2.y+point2.x*point.y+point.x*point1.y-point2.x*point1.y-point.x*point2.y-point1.x*point.y));
var bottom=Math.sqrt(Math.pow(point1.x-point2.x,2)+Math.pow(point1.y-point2.y,2));
var height=area/bottom*2;
return height
};
var firstPoint=0;
var lastPoint=points.length-1;
var pointIndexsToKeep=[];
pointIndexsToKeep.push(firstPoint);
pointIndexsToKeep.push(lastPoint);
while(points[firstPoint].equals(points[lastPoint])){lastPoint--;
pointIndexsToKeep.push(lastPoint)
}douglasPeuckerReduction(points,firstPoint,lastPoint,tolerance);
var returnPoints=[];
pointIndexsToKeep.sort(compareNumbers);
for(var index=0;
index<pointIndexsToKeep.length;
index++){returnPoints.push(points[pointIndexsToKeep[index]])
}return new OpenLayers.Geometry.LineString(returnPoints)
}else{return this
}},CLASS_NAME:"OpenLayers.Geometry.LineString"});
OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(point,index){var added=false;
var lastPoint=this.components.pop();
if(index!=null||!point.equals(lastPoint)){added=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)
}var firstPoint=this.components[0];
OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint]);
return added
},removeComponent:function(point){var removed=this.components&&(this.components.length>3);
if(removed){this.components.pop();
OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);
var firstPoint=this.components[0];
OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[firstPoint])
}return removed
},move:function(x,y){for(var i=0,len=this.components.length;
i<len-1;
i++){this.components[i].move(x,y)
}},rotate:function(angle,origin){for(var i=0,len=this.components.length;
i<len-1;
++i){this.components[i].rotate(angle,origin)
}},resize:function(scale,origin,ratio){for(var i=0,len=this.components.length;
i<len-1;
++i){this.components[i].resize(scale,origin,ratio)
}return this
},transform:function(source,dest){if(source&&dest){for(var i=0,len=this.components.length;
i<len-1;
i++){var component=this.components[i];
component.transform(source,dest)
}this.bounds=null
}return this
},getCentroid:function(){if(this.components&&(this.components.length>2)){var sumX=0;
var sumY=0;
for(var i=0;
i<this.components.length-1;
i++){var b=this.components[i];
var c=this.components[i+1];
sumX+=(b.x+c.x)*(b.x*c.y-c.x*b.y);
sumY+=(b.y+c.y)*(b.x*c.y-c.x*b.y)
}var area=-1*this.getArea();
var x=sumX/(6*area);
var y=sumY/(6*area);
return new OpenLayers.Geometry.Point(x,y)
}else{return null
}},getArea:function(){var area=0;
if(this.components&&(this.components.length>2)){var sum=0;
for(var i=0,len=this.components.length;
i<len-1;
i++){var b=this.components[i];
var c=this.components[i+1];
sum+=(b.x+c.x)*(c.y-b.y)
}area=-sum/2
}return area
},getGeodesicArea:function(projection){var ring=this;
if(projection){var gg=new OpenLayers.Projection("EPSG:4326");
if(!gg.equals(projection)){ring=this.clone().transform(projection,gg)
}}var area=0;
var len=ring.components&&ring.components.length;
if(len>2){var p1,p2;
for(var i=0;
i<len-1;
i++){p1=ring.components[i];
p2=ring.components[i+1];
area+=OpenLayers.Util.rad(p2.x-p1.x)*(2+Math.sin(OpenLayers.Util.rad(p1.y))+Math.sin(OpenLayers.Util.rad(p2.y)))
}area=area*6378137*6378137/2
}return area
},containsPoint:function(point){var approx=OpenLayers.Number.limitSigDigs;
var digs=14;
var px=approx(point.x,digs);
var py=approx(point.y,digs);
function getX(y,x1,y1,x2,y2){return(y-y2)*((x2-x1)/(y2-y1))+x2
}var numSeg=this.components.length-1;
var start,end,x1,y1,x2,y2,cx,cy;
var crosses=0;
for(var i=0;
i<numSeg;
++i){start=this.components[i];
x1=approx(start.x,digs);
y1=approx(start.y,digs);
end=this.components[i+1];
x2=approx(end.x,digs);
y2=approx(end.y,digs);
if(y1==y2){if(py==y1){if(x1<=x2&&(px>=x1&&px<=x2)||x1>=x2&&(px<=x1&&px>=x2)){crosses=-1;
break
}}continue
}cx=approx(getX(py,x1,y1,x2,y2),digs);
if(cx==px){if(y1<y2&&(py>=y1&&py<=y2)||y1>y2&&(py<=y1&&py>=y2)){crosses=-1;
break
}}if(cx<=px){continue
}if(x1!=x2&&(cx<Math.min(x1,x2)||cx>Math.max(x1,x2))){continue
}if(y1<y2&&(py>=y1&&py<y2)||y1>y2&&(py<y1&&py>=y2)){++crosses
}}var contained=(crosses==-1)?1:!!(crosses&1);
return contained
},intersects:function(geometry){var intersect=false;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){intersect=this.containsPoint(geometry)
}else{if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"){intersect=geometry.intersects(this)
}else{if(geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){intersect=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[geometry])
}else{for(var i=0,len=geometry.components.length;
i<len;
++i){intersect=geometry.components[i].intersects(this);
if(intersect){break
}}}}}return intersect
},getVertices:function(nodes){return(nodes===true)?[]:this.components.slice(0,this.components.length-1)
},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});
OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var area=0;
if(this.components&&(this.components.length>0)){area+=Math.abs(this.components[0].getArea());
for(var i=1,len=this.components.length;
i<len;
i++){area-=Math.abs(this.components[i].getArea())
}}return area
},getGeodesicArea:function(projection){var area=0;
if(this.components&&(this.components.length>0)){area+=Math.abs(this.components[0].getGeodesicArea(projection));
for(var i=1,len=this.components.length;
i<len;
i++){area-=Math.abs(this.components[i].getGeodesicArea(projection))
}}return area
},containsPoint:function(point){var numRings=this.components.length;
var contained=false;
if(numRings>0){contained=this.components[0].containsPoint(point);
if(contained!==1){if(contained&&numRings>1){var hole;
for(var i=1;
i<numRings;
++i){hole=this.components[i].containsPoint(point);
if(hole){if(hole===1){contained=1
}else{contained=false
}break
}}}}}return contained
},intersects:function(geometry){var intersect=false;
var i,len;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){intersect=this.containsPoint(geometry)
}else{if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"||geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){for(i=0,len=this.components.length;
i<len;
++i){intersect=geometry.intersects(this.components[i]);
if(intersect){break
}}if(!intersect){for(i=0,len=geometry.components.length;
i<len;
++i){intersect=this.containsPoint(geometry.components[i]);
if(intersect){break
}}}}else{for(i=0,len=geometry.components.length;
i<len;
++i){intersect=this.intersects(geometry.components[i]);
if(intersect){break
}}}}if(!intersect&&geometry.CLASS_NAME=="OpenLayers.Geometry.Polygon"){var ring=this.components[0];
for(i=0,len=ring.components.length;
i<len;
++i){intersect=geometry.containsPoint(ring.components[i]);
if(intersect){break
}}}return intersect
},distanceTo:function(geometry,options){var edge=!(options&&options.edge===false);
var result;
if(!edge&&this.intersects(geometry)){result=0
}else{result=OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[geometry,options])
}return result
},CLASS_NAME:"OpenLayers.Geometry.Polygon"});
OpenLayers.Geometry.Polygon.createRegularPolygon=function(origin,radius,sides,rotation){var angle=Math.PI*((1/sides)-(1/2));
if(rotation){angle+=(rotation/180)*Math.PI
}var rotatedAngle,x,y;
var points=[];
for(var i=0;
i<sides;
++i){rotatedAngle=angle+(i*2*Math.PI/sides);
x=origin.x+(radius*Math.cos(rotatedAngle));
y=origin.y+(radius*Math.sin(rotatedAngle));
points.push(new OpenLayers.Geometry.Point(x,y))
}var ring=new OpenLayers.Geometry.LinearRing(points);
return new OpenLayers.Geometry.Polygon([ring])
};
OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(geometry,options){var results=null;
var mutual=options&&options.mutual;
var splits,sourceLine,sourceLines,sourceSplit,targetSplit;
var sourceParts=[];
var targetParts=[geometry];
for(var i=0,len=this.components.length;
i<len;
++i){sourceLine=this.components[i];
sourceSplit=false;
for(var j=0;
j<targetParts.length;
++j){splits=sourceLine.split(targetParts[j],options);
if(splits){if(mutual){sourceLines=splits[0];
for(var k=0,klen=sourceLines.length;
k<klen;
++k){if(k===0&&sourceParts.length){sourceParts[sourceParts.length-1].addComponent(sourceLines[k])
}else{sourceParts.push(new OpenLayers.Geometry.MultiLineString([sourceLines[k]]))
}}sourceSplit=true;
splits=splits[1]
}if(splits.length){splits.unshift(j,1);
Array.prototype.splice.apply(targetParts,splits);
break
}}}if(!sourceSplit){if(sourceParts.length){sourceParts[sourceParts.length-1].addComponent(sourceLine.clone())
}else{sourceParts=[new OpenLayers.Geometry.MultiLineString(sourceLine.clone())]
}}}if(sourceParts&&sourceParts.length>1){sourceSplit=true
}else{sourceParts=[]
}if(targetParts&&targetParts.length>1){targetSplit=true
}else{targetParts=[]
}if(sourceSplit||targetSplit){if(mutual){results=[sourceParts,targetParts]
}else{results=targetParts
}}return results
},splitWith:function(geometry,options){var results=null;
var mutual=options&&options.mutual;
var splits,targetLine,sourceLines,sourceSplit,targetSplit,sourceParts,targetParts;
if(geometry instanceof OpenLayers.Geometry.LineString){targetParts=[];
sourceParts=[geometry];
for(var i=0,len=this.components.length;
i<len;
++i){targetSplit=false;
targetLine=this.components[i];
for(var j=0;
j<sourceParts.length;
++j){splits=sourceParts[j].split(targetLine,options);
if(splits){if(mutual){sourceLines=splits[0];
if(sourceLines.length){sourceLines.unshift(j,1);
Array.prototype.splice.apply(sourceParts,sourceLines);
j+=sourceLines.length-2
}splits=splits[1];
if(splits.length===0){splits=[targetLine.clone()]
}}for(var k=0,klen=splits.length;
k<klen;
++k){if(k===0&&targetParts.length){targetParts[targetParts.length-1].addComponent(splits[k])
}else{targetParts.push(new OpenLayers.Geometry.MultiLineString([splits[k]]))
}}targetSplit=true
}}if(!targetSplit){if(targetParts.length){targetParts[targetParts.length-1].addComponent(targetLine.clone())
}else{targetParts=[new OpenLayers.Geometry.MultiLineString([targetLine.clone()])]
}}}}else{results=geometry.split(this)
}if(sourceParts&&sourceParts.length>1){sourceSplit=true
}else{sourceParts=[]
}if(targetParts&&targetParts.length>1){targetSplit=true
}else{targetParts=[]
}if(sourceSplit||targetSplit){if(mutual){results=[sourceParts,targetParts]
}else{results=targetParts
}}return results
},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});
OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});
OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:false,size:null,resolution:null,map:null,featureDx:0,initialize:function(containerID,options){this.container=OpenLayers.Util.getElement(containerID);
OpenLayers.Util.extend(this,options)
},destroy:function(){this.container=null;
this.extent=null;
this.size=null;
this.resolution=null;
this.map=null
},supported:function(){return false
},setExtent:function(extent,resolutionChanged){this.extent=extent.clone();
if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var ratio=extent.getWidth()/this.map.getExtent().getWidth(),extent=extent.scale(1/ratio);
this.extent=extent.wrapDateLine(this.map.getMaxExtent()).scale(ratio)
}if(resolutionChanged){this.resolution=null
}return true
},setSize:function(size){this.size=size.clone();
this.resolution=null
},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();
return this.resolution
},drawFeature:function(feature,style){if(style==null){style=feature.style
}if(feature.geometry){var bounds=feature.geometry.getBounds();
if(bounds){var worldBounds;
if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){worldBounds=this.map.getMaxExtent()
}if(!bounds.intersectsBounds(this.extent,{worldBounds:worldBounds})){style={display:"none"}
}else{this.calculateFeatureDx(bounds,worldBounds)
}var rendered=this.drawGeometry(feature.geometry,style,feature.id);
if(style.display!="none"&&style.label&&rendered!==false){var location=feature.geometry.getCentroid();
if(style.labelXOffset||style.labelYOffset){var xOffset=isNaN(style.labelXOffset)?0:style.labelXOffset;
var yOffset=isNaN(style.labelYOffset)?0:style.labelYOffset;
var res=this.getResolution();
location.move(xOffset*res,yOffset*res)
}this.drawText(feature.id,style,location)
}else{this.removeText(feature.id)
}return rendered
}}},calculateFeatureDx:function(bounds,worldBounds){this.featureDx=0;
if(worldBounds){var worldWidth=worldBounds.getWidth(),rendererCenterX=(this.extent.left+this.extent.right)/2,featureCenterX=(bounds.left+bounds.right)/2,worldsAway=Math.round((featureCenterX-rendererCenterX)/worldWidth);
this.featureDx=worldsAway*worldWidth
}},drawGeometry:function(geometry,style,featureId){},drawText:function(featureId,style,location){},removeText:function(featureId){},clear:function(){},getFeatureIdFromEvent:function(evt){},eraseFeatures:function(features){if(!(OpenLayers.Util.isArray(features))){features=[features]
}for(var i=0,len=features.length;
i<len;
++i){var feature=features[i];
this.eraseGeometry(feature.geometry,feature.id);
this.removeText(feature.id)
}},eraseGeometry:function(geometry,featureId){},moveRoot:function(renderer){},getRenderLayerId:function(){return this.container.id
},applyDefaultSymbolizer:function(symbolizer){var result=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);
if(symbolizer.stroke===false){delete result.strokeWidth;
delete result.strokeColor
}if(symbolizer.fill===false){delete result.fillColor
}OpenLayers.Util.extend(result,symbolizer);
return result
},CLASS_NAME:"OpenLayers.Renderer"});
OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};
OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};
OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(yOrdering){this.compare=yOrdering?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;
this.clear()
},insert:function(newNode){if(this.exists(newNode)){this.remove(newNode)
}var nodeId=newNode.id;
this.determineZIndex(newNode);
var leftIndex=-1;
var rightIndex=this.order.length;
var middle;
while(rightIndex-leftIndex>1){middle=parseInt((leftIndex+rightIndex)/2);
var placement=this.compare(this,newNode,OpenLayers.Util.getElement(this.order[middle]));
if(placement>0){leftIndex=middle
}else{rightIndex=middle
}}this.order.splice(rightIndex,0,nodeId);
this.indices[nodeId]=this.getZIndex(newNode);
return this.getNextElement(rightIndex)
},remove:function(node){var nodeId=node.id;
var arrayIndex=OpenLayers.Util.indexOf(this.order,nodeId);
if(arrayIndex>=0){this.order.splice(arrayIndex,1);
delete this.indices[nodeId];
if(this.order.length>0){var lastId=this.order[this.order.length-1];
this.maxZIndex=this.indices[lastId]
}else{this.maxZIndex=0
}}},clear:function(){this.order=[];
this.indices={};
this.maxZIndex=0
},exists:function(node){return(this.indices[node.id]!=null)
},getZIndex:function(node){return node._style.graphicZIndex
},determineZIndex:function(node){var zIndex=node._style.graphicZIndex;
if(zIndex==null){zIndex=this.maxZIndex;
node._style.graphicZIndex=zIndex
}else{if(zIndex>this.maxZIndex){this.maxZIndex=zIndex
}}},getNextElement:function(index){var nextIndex=index+1;
if(nextIndex<this.order.length){var nextElement=OpenLayers.Util.getElement(this.order[nextIndex]);
if(nextElement==undefined){nextElement=this.getNextElement(nextIndex)
}return nextElement
}else{return null
}},CLASS_NAME:"OpenLayers.ElementsIndexer"});
OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(indexer,newNode,nextNode){var newZIndex=indexer.getZIndex(newNode);
var returnVal=0;
if(nextNode){var nextZIndex=indexer.getZIndex(nextNode);
returnVal=newZIndex-nextZIndex
}return returnVal
},Z_ORDER_DRAWING_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode);
if(nextNode&&returnVal==0){returnVal=1
}return returnVal
},Z_ORDER_Y_ORDER:function(indexer,newNode,nextNode){var returnVal=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(indexer,newNode,nextNode);
if(nextNode&&returnVal===0){var result=nextNode._boundsBottom-newNode._boundsBottom;
returnVal=(result===0)?1:result
}return returnVal
}};
OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(containerID,options){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);
this.rendererRoot=this.createRenderRoot();
this.root=this.createRoot("_root");
this.vectorRoot=this.createRoot("_vroot");
this.textRoot=this.createRoot("_troot");
this.root.appendChild(this.vectorRoot);
this.root.appendChild(this.textRoot);
this.rendererRoot.appendChild(this.root);
this.container.appendChild(this.rendererRoot);
if(options&&(options.zIndexing||options.yOrdering)){this.indexer=new OpenLayers.ElementsIndexer(options.yOrdering)
}},destroy:function(){this.clear();
this.rendererRoot=null;
this.root=null;
this.xmlns=null;
OpenLayers.Renderer.prototype.destroy.apply(this,arguments)
},clear:function(){var child;
var root=this.vectorRoot;
if(root){while(child=root.firstChild){root.removeChild(child)
}}root=this.textRoot;
if(root){while(child=root.firstChild){root.removeChild(child)
}}if(this.indexer){this.indexer.clear()
}},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);
var resolution=this.getResolution();
if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var rightOfDateLine,ratio=extent.getWidth()/this.map.getExtent().getWidth(),extent=extent.scale(1/ratio),world=this.map.getMaxExtent();
if(world.right>extent.left&&world.right<extent.right){rightOfDateLine=true
}else{if(world.left>extent.left&&world.left<extent.right){rightOfDateLine=false
}}if(rightOfDateLine!==this.rightOfDateLine||resolutionChanged){coordSysUnchanged=false;
this.xOffset=rightOfDateLine===true?world.getWidth()/resolution:0
}this.rightOfDateLine=rightOfDateLine
}return coordSysUnchanged
},getNodeType:function(geometry,style){},drawGeometry:function(geometry,style,featureId){var className=geometry.CLASS_NAME;
var rendered=true;
if((className=="OpenLayers.Geometry.Collection")||(className=="OpenLayers.Geometry.MultiPoint")||(className=="OpenLayers.Geometry.MultiLineString")||(className=="OpenLayers.Geometry.MultiPolygon")){for(var i=0,len=geometry.components.length;
i<len;
i++){rendered=this.drawGeometry(geometry.components[i],style,featureId)&&rendered
}return rendered
}rendered=false;
var removeBackground=false;
if(style.display!="none"){if(style.backgroundGraphic){this.redrawBackgroundNode(geometry.id,geometry,style,featureId)
}else{removeBackground=true
}rendered=this.redrawNode(geometry.id,geometry,style,featureId)
}if(rendered==false){var node=document.getElementById(geometry.id);
if(node){if(node._style.backgroundGraphic){removeBackground=true
}node.parentNode.removeChild(node)
}}if(removeBackground){var node=document.getElementById(geometry.id+this.BACKGROUND_ID_SUFFIX);
if(node){node.parentNode.removeChild(node)
}}return rendered
},redrawNode:function(id,geometry,style,featureId){style=this.applyDefaultSymbolizer(style);
var node=this.nodeFactory(id,this.getNodeType(geometry,style));
node._featureId=featureId;
node._boundsBottom=geometry.getBounds().bottom;
node._geometryClass=geometry.CLASS_NAME;
node._style=style;
var drawResult=this.drawGeometryNode(node,geometry,style);
if(drawResult===false){return false
}node=drawResult.node;
if(this.indexer){var insert=this.indexer.insert(node);
if(insert){this.vectorRoot.insertBefore(node,insert)
}else{this.vectorRoot.appendChild(node)
}}else{if(node.parentNode!==this.vectorRoot){this.vectorRoot.appendChild(node)
}}this.postDraw(node);
return drawResult.complete
},redrawBackgroundNode:function(id,geometry,style,featureId){var backgroundStyle=OpenLayers.Util.extend({},style);
backgroundStyle.externalGraphic=backgroundStyle.backgroundGraphic;
backgroundStyle.graphicXOffset=backgroundStyle.backgroundXOffset;
backgroundStyle.graphicYOffset=backgroundStyle.backgroundYOffset;
backgroundStyle.graphicZIndex=backgroundStyle.backgroundGraphicZIndex;
backgroundStyle.graphicWidth=backgroundStyle.backgroundWidth||backgroundStyle.graphicWidth;
backgroundStyle.graphicHeight=backgroundStyle.backgroundHeight||backgroundStyle.graphicHeight;
backgroundStyle.backgroundGraphic=null;
backgroundStyle.backgroundXOffset=null;
backgroundStyle.backgroundYOffset=null;
backgroundStyle.backgroundGraphicZIndex=null;
return this.redrawNode(id+this.BACKGROUND_ID_SUFFIX,geometry,backgroundStyle,null)
},drawGeometryNode:function(node,geometry,style){style=style||node._style;
var options={isFilled:style.fill===undefined?true:style.fill,isStroked:style.stroke===undefined?!!style.strokeWidth:style.stroke};
var drawn;
switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":if(style.graphic===false){options.isFilled=false;
options.isStroked=false
}drawn=this.drawPoint(node,geometry);
break;
case"OpenLayers.Geometry.LineString":options.isFilled=false;
drawn=this.drawLineString(node,geometry);
break;
case"OpenLayers.Geometry.LinearRing":drawn=this.drawLinearRing(node,geometry);
break;
case"OpenLayers.Geometry.Polygon":drawn=this.drawPolygon(node,geometry);
break;
case"OpenLayers.Geometry.Rectangle":drawn=this.drawRectangle(node,geometry);
break;
default:break
}node._options=options;
if(drawn!=false){return{node:this.setStyle(node,style,options,geometry),complete:drawn}
}else{return false
}},postDraw:function(node){},drawPoint:function(node,geometry){},drawLineString:function(node,geometry){},drawLinearRing:function(node,geometry){},drawPolygon:function(node,geometry){},drawRectangle:function(node,geometry){},drawCircle:function(node,geometry){},removeText:function(featureId){var label=document.getElementById(featureId+this.LABEL_ID_SUFFIX);
if(label){this.textRoot.removeChild(label)
}var outline=document.getElementById(featureId+this.LABEL_OUTLINE_SUFFIX);
if(outline){this.textRoot.removeChild(outline)
}},getFeatureIdFromEvent:function(evt){var target=evt.target;
var useElement=target&&target.correspondingUseElement;
var node=useElement?useElement:(target||evt.srcElement);
return node._featureId
},eraseGeometry:function(geometry,featureId){if((geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPoint")||(geometry.CLASS_NAME=="OpenLayers.Geometry.MultiLineString")||(geometry.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon")||(geometry.CLASS_NAME=="OpenLayers.Geometry.Collection")){for(var i=0,len=geometry.components.length;
i<len;
i++){this.eraseGeometry(geometry.components[i],featureId)
}}else{var element=OpenLayers.Util.getElement(geometry.id);
if(element&&element.parentNode){if(element.geometry){element.geometry.destroy();
element.geometry=null
}element.parentNode.removeChild(element);
if(this.indexer){this.indexer.remove(element)
}if(element._style.backgroundGraphic){var backgroundId=geometry.id+this.BACKGROUND_ID_SUFFIX;
var bElem=OpenLayers.Util.getElement(backgroundId);
if(bElem&&bElem.parentNode){bElem.parentNode.removeChild(bElem)
}}}}},nodeFactory:function(id,type){var node=OpenLayers.Util.getElement(id);
if(node){if(!this.nodeTypeCompare(node,type)){node.parentNode.removeChild(node);
node=this.nodeFactory(id,type)
}}else{node=this.createNode(type,id)
}return node
},nodeTypeCompare:function(node,type){},createNode:function(type,id){},moveRoot:function(renderer){var root=this.root;
if(renderer.root.parentNode==this.rendererRoot){root=renderer.root
}root.parentNode.removeChild(root);
renderer.rendererRoot.appendChild(root)
},getRenderLayerId:function(){return this.root.parentNode.parentNode.id
},isComplexSymbol:function(graphicName){return(graphicName!="circle")&&!!graphicName
},CLASS_NAME:"OpenLayers.Renderer.Elements"});
OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15000,translationParameters:null,symbolMetrics:null,initialize:function(containerID){if(!this.supported()){return
}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);
this.translationParameters={x:0,y:0};
this.symbolMetrics={}
},supported:function(){var svgFeature="http://www.w3.org/TR/SVG11/feature#";
return(document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(svgFeature+"SVG","1.1")||document.implementation.hasFeature(svgFeature+"BasicStructure","1.1")))
},inValidRange:function(x,y,xyOnly){var left=x+(xyOnly?0:this.translationParameters.x);
var top=y+(xyOnly?0:this.translationParameters.y);
return(left>=-this.MAX_PIXEL&&left<=this.MAX_PIXEL&&top>=-this.MAX_PIXEL&&top<=this.MAX_PIXEL)
},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);
var resolution=this.getResolution(),left=-extent.left/resolution,top=extent.top/resolution;
if(resolutionChanged){this.left=left;
this.top=top;
var extentString="0 0 "+this.size.w+" "+this.size.h;
this.rendererRoot.setAttributeNS(null,"viewBox",extentString);
this.translate(this.xOffset,0);
return true
}else{var inRange=this.translate(left-this.left+this.xOffset,top-this.top);
if(!inRange){this.setExtent(extent,true)
}return coordSysUnchanged&&inRange
}},translate:function(x,y){if(!this.inValidRange(x,y,true)){return false
}else{var transformString="";
if(x||y){transformString="translate("+x+","+y+")"
}this.root.setAttributeNS(null,"transform",transformString);
this.translationParameters={x:x,y:y};
return true
}},setSize:function(size){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);
this.rendererRoot.setAttributeNS(null,"width",this.size.w);
this.rendererRoot.setAttributeNS(null,"height",this.size.h)
},getNodeType:function(geometry,style){var nodeType=null;
switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":if(style.externalGraphic){nodeType="image"
}else{if(this.isComplexSymbol(style.graphicName)){nodeType="svg"
}else{nodeType="circle"
}}break;
case"OpenLayers.Geometry.Rectangle":nodeType="rect";
break;
case"OpenLayers.Geometry.LineString":nodeType="polyline";
break;
case"OpenLayers.Geometry.LinearRing":nodeType="polygon";
break;
case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":nodeType="path";
break;
default:break
}return nodeType
},setStyle:function(node,style,options){style=style||node._style;
options=options||node._options;
var r=parseFloat(node.getAttributeNS(null,"r"));
var widthFactor=1;
var pos;
if(node._geometryClass=="OpenLayers.Geometry.Point"&&r){node.style.visibility="";
if(style.graphic===false){node.style.visibility="hidden"
}else{if(style.externalGraphic){pos=this.getPosition(node);
if(style.graphicTitle){node.setAttributeNS(null,"title",style.graphicTitle);
var titleNode=node.getElementsByTagName("title");
if(titleNode.length>0){titleNode[0].firstChild.textContent=style.graphicTitle
}else{var label=this.nodeFactory(null,"title");
label.textContent=style.graphicTitle;
node.appendChild(label)
}}if(style.graphicWidth&&style.graphicHeight){node.setAttributeNS(null,"preserveAspectRatio","none")
}var width=style.graphicWidth||style.graphicHeight;
var height=style.graphicHeight||style.graphicWidth;
width=width?width:style.pointRadius*2;
height=height?height:style.pointRadius*2;
var xOffset=(style.graphicXOffset!=undefined)?style.graphicXOffset:-(0.5*width);
var yOffset=(style.graphicYOffset!=undefined)?style.graphicYOffset:-(0.5*height);
var opacity=style.graphicOpacity||style.fillOpacity;
node.setAttributeNS(null,"x",(pos.x+xOffset).toFixed());
node.setAttributeNS(null,"y",(pos.y+yOffset).toFixed());
node.setAttributeNS(null,"width",width);
node.setAttributeNS(null,"height",height);
node.setAttributeNS(this.xlinkns,"href",style.externalGraphic);
node.setAttributeNS(null,"style","opacity: "+opacity);
node.onclick=OpenLayers.Renderer.SVG.preventDefault
}else{if(this.isComplexSymbol(style.graphicName)){var offset=style.pointRadius*3;
var size=offset*2;
var src=this.importSymbol(style.graphicName);
pos=this.getPosition(node);
widthFactor=this.symbolMetrics[src.id][0]*3/size;
var parent=node.parentNode;
var nextSibling=node.nextSibling;
if(parent){parent.removeChild(node)
}node.firstChild&&node.removeChild(node.firstChild);
node.appendChild(src.firstChild.cloneNode(true));
node.setAttributeNS(null,"viewBox",src.getAttributeNS(null,"viewBox"));
node.setAttributeNS(null,"width",size);
node.setAttributeNS(null,"height",size);
node.setAttributeNS(null,"x",pos.x-offset);
node.setAttributeNS(null,"y",pos.y-offset);
if(nextSibling){parent.insertBefore(node,nextSibling)
}else{if(parent){parent.appendChild(node)
}}}else{node.setAttributeNS(null,"r",style.pointRadius)
}}}var rotation=style.rotation;
if((rotation!==undefined||node._rotation!==undefined)&&pos){node._rotation=rotation;
rotation|=0;
if(node.nodeName!=="svg"){node.setAttributeNS(null,"transform","rotate("+rotation+" "+pos.x+" "+pos.y+")")
}else{var metrics=this.symbolMetrics[src.id];
node.firstChild.setAttributeNS(null,"transform","rotate("+rotation+" "+metrics[1]+" "+metrics[2]+")")
}}}if(options.isFilled){node.setAttributeNS(null,"fill",style.fillColor);
node.setAttributeNS(null,"fill-opacity",style.fillOpacity)
}else{node.setAttributeNS(null,"fill","none")
}if(options.isStroked){node.setAttributeNS(null,"stroke",style.strokeColor);
node.setAttributeNS(null,"stroke-opacity",style.strokeOpacity);
node.setAttributeNS(null,"stroke-width",style.strokeWidth*widthFactor);
node.setAttributeNS(null,"stroke-linecap",style.strokeLinecap||"round");
node.setAttributeNS(null,"stroke-linejoin","round");
style.strokeDashstyle&&node.setAttributeNS(null,"stroke-dasharray",this.dashStyle(style,widthFactor))
}else{node.setAttributeNS(null,"stroke","none")
}if(style.pointerEvents){node.setAttributeNS(null,"pointer-events",style.pointerEvents)
}if(style.cursor!=null){node.setAttributeNS(null,"cursor",style.cursor)
}return node
},dashStyle:function(style,widthFactor){var w=style.strokeWidth*widthFactor;
var str=style.strokeDashstyle;
switch(str){case"solid":return"none";
case"dot":return[1,4*w].join();
case"dash":return[4*w,4*w].join();
case"dashdot":return[4*w,4*w,1,4*w].join();
case"longdash":return[8*w,4*w].join();
case"longdashdot":return[8*w,4*w,1,4*w].join();
default:return OpenLayers.String.trim(str).replace(/\s+/g,",")
}},createNode:function(type,id){var node=document.createElementNS(this.xmlns,type);
if(id){node.setAttributeNS(null,"id",id)
}return node
},nodeTypeCompare:function(node,type){return(type==node.nodeName)
},createRenderRoot:function(){var svg=this.nodeFactory(this.container.id+"_svgRoot","svg");
svg.style.display="block";
return svg
},createRoot:function(suffix){return this.nodeFactory(this.container.id+suffix,"g")
},createDefs:function(){var defs=this.nodeFactory(this.container.id+"_defs","defs");
this.rendererRoot.appendChild(defs);
return defs
},drawPoint:function(node,geometry){return this.drawCircle(node,geometry,1)
},drawCircle:function(node,geometry,radius){var resolution=this.getResolution();
var x=((geometry.x-this.featureDx)/resolution+this.left);
var y=(this.top-geometry.y/resolution);
if(this.inValidRange(x,y)){node.setAttributeNS(null,"cx",x);
node.setAttributeNS(null,"cy",y);
node.setAttributeNS(null,"r",radius);
return node
}else{return false
}},drawLineString:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);
if(componentsResult.path){node.setAttributeNS(null,"points",componentsResult.path);
return(componentsResult.complete?node:null)
}else{return false
}},drawLinearRing:function(node,geometry){var componentsResult=this.getComponentsString(geometry.components);
if(componentsResult.path){node.setAttributeNS(null,"points",componentsResult.path);
return(componentsResult.complete?node:null)
}else{return false
}},drawPolygon:function(node,geometry){var d="";
var draw=true;
var complete=true;
var linearRingResult,path;
for(var j=0,len=geometry.components.length;
j<len;
j++){d+=" M";
linearRingResult=this.getComponentsString(geometry.components[j].components," ");
path=linearRingResult.path;
if(path){d+=" "+path;
complete=linearRingResult.complete&&complete
}else{draw=false
}}d+=" z";
if(draw){node.setAttributeNS(null,"d",d);
node.setAttributeNS(null,"fill-rule","evenodd");
return complete?node:null
}else{return false
}},drawRectangle:function(node,geometry){var resolution=this.getResolution();
var x=((geometry.x-this.featureDx)/resolution+this.left);
var y=(this.top-geometry.y/resolution);
if(this.inValidRange(x,y)){node.setAttributeNS(null,"x",x);
node.setAttributeNS(null,"y",y);
node.setAttributeNS(null,"width",geometry.width/resolution);
node.setAttributeNS(null,"height",geometry.height/resolution);
return node
}else{return false
}},drawText:function(featureId,style,location){var drawOutline=(!!style.labelOutlineWidth);
if(drawOutline){var outlineStyle=OpenLayers.Util.extend({},style);
outlineStyle.fontColor=outlineStyle.labelOutlineColor;
outlineStyle.fontStrokeColor=outlineStyle.labelOutlineColor;
outlineStyle.fontStrokeWidth=style.labelOutlineWidth;
delete outlineStyle.labelOutlineWidth;
this.drawText(featureId,outlineStyle,location)
}var resolution=this.getResolution();
var x=((location.x-this.featureDx)/resolution+this.left);
var y=(location.y/resolution-this.top);
var suffix=(drawOutline)?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX;
var label=this.nodeFactory(featureId+suffix,"text");
label.setAttributeNS(null,"x",x);
label.setAttributeNS(null,"y",-y);
if(style.fontColor){label.setAttributeNS(null,"fill",style.fontColor)
}if(style.fontStrokeColor){label.setAttributeNS(null,"stroke",style.fontStrokeColor)
}if(style.fontStrokeWidth){label.setAttributeNS(null,"stroke-width",style.fontStrokeWidth)
}if(style.fontOpacity){label.setAttributeNS(null,"opacity",style.fontOpacity)
}if(style.fontFamily){label.setAttributeNS(null,"font-family",style.fontFamily)
}if(style.fontSize){label.setAttributeNS(null,"font-size",style.fontSize)
}if(style.fontWeight){label.setAttributeNS(null,"font-weight",style.fontWeight)
}if(style.fontStyle){label.setAttributeNS(null,"font-style",style.fontStyle)
}if(style.labelSelect===true){label.setAttributeNS(null,"pointer-events","visible");
label._featureId=featureId
}else{label.setAttributeNS(null,"pointer-events","none")
}var align=style.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;
label.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[0]]||"middle");
if(OpenLayers.IS_GECKO===true){label.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[align[1]]||"central")
}var labelRows=style.label.split("\n");
var numRows=labelRows.length;
while(label.childNodes.length>numRows){label.removeChild(label.lastChild)
}for(var i=0;
i<numRows;
i++){var tspan=this.nodeFactory(featureId+suffix+"_tspan_"+i,"tspan");
if(style.labelSelect===true){tspan._featureId=featureId;
tspan._geometry=location;
tspan._geometryClass=location.CLASS_NAME
}if(OpenLayers.IS_GECKO===false){tspan.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[align[1]]||"-35%")
}tspan.setAttribute("x",x);
if(i==0){var vfactor=OpenLayers.Renderer.SVG.LABEL_VFACTOR[align[1]];
if(vfactor==null){vfactor=-0.5
}tspan.setAttribute("dy",(vfactor*(numRows-1))+"em")
}else{tspan.setAttribute("dy","1em")
}tspan.textContent=(labelRows[i]==="")?" ":labelRows[i];
if(!tspan.parentNode){label.appendChild(tspan)
}}if(!label.parentNode){this.textRoot.appendChild(label)
}},getComponentsString:function(components,separator){var renderCmp=[];
var complete=true;
var len=components.length;
var strings=[];
var str,component;
for(var i=0;
i<len;
i++){component=components[i];
renderCmp.push(component);
str=this.getShortString(component);
if(str){strings.push(str)
}else{if(i>0){if(this.getShortString(components[i-1])){strings.push(this.clipLine(components[i],components[i-1]))
}}if(i<len-1){if(this.getShortString(components[i+1])){strings.push(this.clipLine(components[i],components[i+1]))
}}complete=false
}}return{path:strings.join(separator||","),complete:complete}
},clipLine:function(badComponent,goodComponent){if(goodComponent.equals(badComponent)){return""
}var resolution=this.getResolution();
var maxX=this.MAX_PIXEL-this.translationParameters.x;
var maxY=this.MAX_PIXEL-this.translationParameters.y;
var x1=(goodComponent.x-this.featureDx)/resolution+this.left;
var y1=this.top-goodComponent.y/resolution;
var x2=(badComponent.x-this.featureDx)/resolution+this.left;
var y2=this.top-badComponent.y/resolution;
var k;
if(x2<-maxX||x2>maxX){k=(y2-y1)/(x2-x1);
x2=x2<0?-maxX:maxX;
y2=y1+(x2-x1)*k
}if(y2<-maxY||y2>maxY){k=(x2-x1)/(y2-y1);
y2=y2<0?-maxY:maxY;
x2=x1+(y2-y1)*k
}return x2+","+y2
},getShortString:function(point){var resolution=this.getResolution();
var x=((point.x-this.featureDx)/resolution+this.left);
var y=(this.top-point.y/resolution);
if(this.inValidRange(x,y)){return x+","+y
}else{return false
}},getPosition:function(node){return({x:parseFloat(node.getAttributeNS(null,"cx")),y:parseFloat(node.getAttributeNS(null,"cy"))})
},importSymbol:function(graphicName){if(!this.defs){this.defs=this.createDefs()
}var id=this.container.id+"-"+graphicName;
var existing=document.getElementById(id);
if(existing!=null){return existing
}var symbol=OpenLayers.Renderer.symbol[graphicName];
if(!symbol){throw new Error(graphicName+" is not a valid symbol name")
}var symbolNode=this.nodeFactory(id,"symbol");
var node=this.nodeFactory(null,"polygon");
symbolNode.appendChild(node);
var symbolExtent=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);
var points=[];
var x,y;
for(var i=0;
i<symbol.length;
i=i+2){x=symbol[i];
y=symbol[i+1];
symbolExtent.left=Math.min(symbolExtent.left,x);
symbolExtent.bottom=Math.min(symbolExtent.bottom,y);
symbolExtent.right=Math.max(symbolExtent.right,x);
symbolExtent.top=Math.max(symbolExtent.top,y);
points.push(x,",",y)
}node.setAttributeNS(null,"points",points.join(" "));
var width=symbolExtent.getWidth();
var height=symbolExtent.getHeight();
var viewBox=[symbolExtent.left-width,symbolExtent.bottom-height,width*3,height*3];
symbolNode.setAttributeNS(null,"viewBox",viewBox.join(" "));
this.symbolMetrics[id]=[Math.max(width,height),symbolExtent.getCenterLonLat().lon,symbolExtent.getCenterLonLat().lat];
this.defs.appendChild(symbolNode);
return symbolNode
},getFeatureIdFromEvent:function(evt){var featureId=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);
if(!featureId){var target=evt.target;
featureId=target.parentNode&&target!=this.rendererRoot?target.parentNode._featureId:undefined
}return featureId
},CLASS_NAME:"OpenLayers.Renderer.SVG"});
OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};
OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};
OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};
OpenLayers.Renderer.SVG.preventDefault=function(e){e.preventDefault&&e.preventDefault()
};
OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:true,hitOverflow:0,canvas:null,features:null,pendingRedraw:false,cachedSymbolBounds:{},initialize:function(containerID,options){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);
this.root=document.createElement("canvas");
this.container.appendChild(this.root);
this.canvas=this.root.getContext("2d");
this.features={};
if(this.hitDetection){this.hitCanvas=document.createElement("canvas");
this.hitContext=this.hitCanvas.getContext("2d")
}},setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);
return false
},eraseGeometry:function(geometry,featureId){this.eraseFeatures(this.features[featureId][0])
},supported:function(){return OpenLayers.CANVAS_SUPPORTED
},setSize:function(size){this.size=size.clone();
var root=this.root;
root.style.width=size.w+"px";
root.style.height=size.h+"px";
root.width=size.w;
root.height=size.h;
this.resolution=null;
if(this.hitDetection){var hitCanvas=this.hitCanvas;
hitCanvas.style.width=size.w+"px";
hitCanvas.style.height=size.h+"px";
hitCanvas.width=size.w;
hitCanvas.height=size.h
}},drawFeature:function(feature,style){var rendered;
if(feature.geometry){style=this.applyDefaultSymbolizer(style||feature.style);
var bounds=feature.geometry.getBounds();
var worldBounds;
if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){worldBounds=this.map.getMaxExtent()
}var intersects=bounds&&bounds.intersectsBounds(this.extent,{worldBounds:worldBounds});
rendered=(style.display!=="none")&&!!bounds&&intersects;
if(rendered){this.features[feature.id]=[feature,style]
}else{delete (this.features[feature.id])
}this.pendingRedraw=true
}if(this.pendingRedraw&&!this.locked){this.redraw();
this.pendingRedraw=false
}return rendered
},drawGeometry:function(geometry,style,featureId){var className=geometry.CLASS_NAME;
if((className=="OpenLayers.Geometry.Collection")||(className=="OpenLayers.Geometry.MultiPoint")||(className=="OpenLayers.Geometry.MultiLineString")||(className=="OpenLayers.Geometry.MultiPolygon")){for(var i=0;
i<geometry.components.length;
i++){this.drawGeometry(geometry.components[i],style,featureId)
}return
}switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(geometry,style,featureId);
break;
case"OpenLayers.Geometry.LineString":this.drawLineString(geometry,style,featureId);
break;
case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(geometry,style,featureId);
break;
case"OpenLayers.Geometry.Polygon":this.drawPolygon(geometry,style,featureId);
break;
default:break
}},drawExternalGraphic:function(geometry,style,featureId){var img=new Image();
if(style.graphicTitle){img.title=style.graphicTitle
}var width=style.graphicWidth||style.graphicHeight;
var height=style.graphicHeight||style.graphicWidth;
width=width?width:style.pointRadius*2;
height=height?height:style.pointRadius*2;
var xOffset=(style.graphicXOffset!=undefined)?style.graphicXOffset:-(0.5*width);
var yOffset=(style.graphicYOffset!=undefined)?style.graphicYOffset:-(0.5*height);
var opacity=style.graphicOpacity||style.fillOpacity;
var onLoad=function(){if(!this.features[featureId]){return
}var pt=this.getLocalXY(geometry);
var p0=pt[0];
var p1=pt[1];
if(!isNaN(p0)&&!isNaN(p1)){var x=(p0+xOffset)|0;
var y=(p1+yOffset)|0;
var canvas=this.canvas;
canvas.globalAlpha=opacity;
var factor=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);
canvas.drawImage(img,x*factor,y*factor,width*factor,height*factor);
if(this.hitDetection){this.setHitContextStyle("fill",featureId);
this.hitContext.fillRect(x,y,width,height)
}}};
img.onload=OpenLayers.Function.bind(onLoad,this);
img.src=style.externalGraphic
},drawNamedSymbol:function(geometry,style,featureId){var x,y,cx,cy,i,symbolBounds,scaling,angle;
var unscaledStrokeWidth;
var deg2rad=Math.PI/180;
var symbol=OpenLayers.Renderer.symbol[style.graphicName];
if(!symbol){throw new Error(style.graphicName+" is not a valid symbol name")
}if(!symbol.length||symbol.length<2){return
}var pt=this.getLocalXY(geometry);
var p0=pt[0];
var p1=pt[1];
if(isNaN(p0)||isNaN(p1)){return
}this.canvas.lineCap="round";
this.canvas.lineJoin="round";
if(this.hitDetection){this.hitContext.lineCap="round";
this.hitContext.lineJoin="round"
}if(style.graphicName in this.cachedSymbolBounds){symbolBounds=this.cachedSymbolBounds[style.graphicName]
}else{symbolBounds=new OpenLayers.Bounds();
for(i=0;
i<symbol.length;
i+=2){symbolBounds.extend(new OpenLayers.LonLat(symbol[i],symbol[i+1]))
}this.cachedSymbolBounds[style.graphicName]=symbolBounds
}this.canvas.save();
if(this.hitDetection){this.hitContext.save()
}this.canvas.translate(p0,p1);
if(this.hitDetection){this.hitContext.translate(p0,p1)
}angle=deg2rad*style.rotation;
if(!isNaN(angle)){this.canvas.rotate(angle);
if(this.hitDetection){this.hitContext.rotate(angle)
}}scaling=2*style.pointRadius/Math.max(symbolBounds.getWidth(),symbolBounds.getHeight());
this.canvas.scale(scaling,scaling);
if(this.hitDetection){this.hitContext.scale(scaling,scaling)
}cx=symbolBounds.getCenterLonLat().lon;
cy=symbolBounds.getCenterLonLat().lat;
this.canvas.translate(-cx,-cy);
if(this.hitDetection){this.hitContext.translate(-cx,-cy)
}unscaledStrokeWidth=style.strokeWidth;
style.strokeWidth=unscaledStrokeWidth/scaling;
if(style.fill!==false){this.setCanvasStyle("fill",style);
this.canvas.beginPath();
for(i=0;
i<symbol.length;
i=i+2){x=symbol[i];
y=symbol[i+1];
if(i==0){this.canvas.moveTo(x,y)
}this.canvas.lineTo(x,y)
}this.canvas.closePath();
this.canvas.fill();
if(this.hitDetection){this.setHitContextStyle("fill",featureId,style);
this.hitContext.beginPath();
for(i=0;
i<symbol.length;
i=i+2){x=symbol[i];
y=symbol[i+1];
if(i==0){this.canvas.moveTo(x,y)
}this.hitContext.lineTo(x,y)
}this.hitContext.closePath();
this.hitContext.fill()
}}if(style.stroke!==false){this.setCanvasStyle("stroke",style);
this.canvas.beginPath();
for(i=0;
i<symbol.length;
i=i+2){x=symbol[i];
y=symbol[i+1];
if(i==0){this.canvas.moveTo(x,y)
}this.canvas.lineTo(x,y)
}this.canvas.closePath();
this.canvas.stroke();
if(this.hitDetection){this.setHitContextStyle("stroke",featureId,style,scaling);
this.hitContext.beginPath();
for(i=0;
i<symbol.length;
i=i+2){x=symbol[i];
y=symbol[i+1];
if(i==0){this.hitContext.moveTo(x,y)
}this.hitContext.lineTo(x,y)
}this.hitContext.closePath();
this.hitContext.stroke()
}}style.strokeWidth=unscaledStrokeWidth;
this.canvas.restore();
if(this.hitDetection){this.hitContext.restore()
}this.setCanvasStyle("reset")
},setCanvasStyle:function(type,style){if(type==="fill"){this.canvas.globalAlpha=style.fillOpacity;
this.canvas.fillStyle=style.fillColor
}else{if(type==="stroke"){this.canvas.globalAlpha=style.strokeOpacity;
this.canvas.strokeStyle=style.strokeColor;
this.canvas.lineWidth=style.strokeWidth
}else{this.canvas.globalAlpha=0;
this.canvas.lineWidth=1
}}},featureIdToHex:function(featureId){var id=Number(featureId.split("_").pop())+1;
if(id>=16777216){this.hitOverflow=id-16777215;
id=id%16777216+1
}var hex="000000"+id.toString(16);
var len=hex.length;
hex="#"+hex.substring(len-6,len);
return hex
},setHitContextStyle:function(type,featureId,symbolizer,strokeScaling){var hex=this.featureIdToHex(featureId);
if(type=="fill"){this.hitContext.globalAlpha=1;
this.hitContext.fillStyle=hex
}else{if(type=="stroke"){this.hitContext.globalAlpha=1;
this.hitContext.strokeStyle=hex;
if(typeof strokeScaling==="undefined"){this.hitContext.lineWidth=symbolizer.strokeWidth+2
}else{if(!isNaN(strokeScaling)){this.hitContext.lineWidth=symbolizer.strokeWidth+2/strokeScaling
}}}else{this.hitContext.globalAlpha=0;
this.hitContext.lineWidth=1
}}},drawPoint:function(geometry,style,featureId){if(style.graphic!==false){if(style.externalGraphic){this.drawExternalGraphic(geometry,style,featureId)
}else{if(style.graphicName&&(style.graphicName!="circle")){this.drawNamedSymbol(geometry,style,featureId)
}else{var pt=this.getLocalXY(geometry);
var p0=pt[0];
var p1=pt[1];
if(!isNaN(p0)&&!isNaN(p1)){var twoPi=Math.PI*2;
var radius=style.pointRadius;
if(style.fill!==false){this.setCanvasStyle("fill",style);
this.canvas.beginPath();
this.canvas.arc(p0,p1,radius,0,twoPi,true);
this.canvas.fill();
if(this.hitDetection){this.setHitContextStyle("fill",featureId,style);
this.hitContext.beginPath();
this.hitContext.arc(p0,p1,radius,0,twoPi,true);
this.hitContext.fill()
}}if(style.stroke!==false){this.setCanvasStyle("stroke",style);
this.canvas.beginPath();
this.canvas.arc(p0,p1,radius,0,twoPi,true);
this.canvas.stroke();
if(this.hitDetection){this.setHitContextStyle("stroke",featureId,style);
this.hitContext.beginPath();
this.hitContext.arc(p0,p1,radius,0,twoPi,true);
this.hitContext.stroke()
}this.setCanvasStyle("reset")
}}}}}},drawLineString:function(geometry,style,featureId){style=OpenLayers.Util.applyDefaults({fill:false},style);
this.drawLinearRing(geometry,style,featureId)
},drawLinearRing:function(geometry,style,featureId){if(style.fill!==false){this.setCanvasStyle("fill",style);
this.renderPath(this.canvas,geometry,style,featureId,"fill");
if(this.hitDetection){this.setHitContextStyle("fill",featureId,style);
this.renderPath(this.hitContext,geometry,style,featureId,"fill")
}}if(style.stroke!==false){this.setCanvasStyle("stroke",style);
this.renderPath(this.canvas,geometry,style,featureId,"stroke");
if(this.hitDetection){this.setHitContextStyle("stroke",featureId,style);
this.renderPath(this.hitContext,geometry,style,featureId,"stroke")
}}this.setCanvasStyle("reset")
},renderPath:function(context,geometry,style,featureId,type){var components=geometry.components;
var len=components.length;
context.beginPath();
var start=this.getLocalXY(components[0]);
var x=start[0];
var y=start[1];
if(!isNaN(x)&&!isNaN(y)){context.moveTo(start[0],start[1]);
for(var i=1;
i<len;
++i){var pt=this.getLocalXY(components[i]);
context.lineTo(pt[0],pt[1])
}if(type==="fill"){context.fill()
}else{context.stroke()
}}},drawPolygon:function(geometry,style,featureId){var components=geometry.components;
var len=components.length;
this.drawLinearRing(components[0],style,featureId);
for(var i=1;
i<len;
++i){this.canvas.globalCompositeOperation="destination-out";
if(this.hitDetection){this.hitContext.globalCompositeOperation="destination-out"
}this.drawLinearRing(components[i],OpenLayers.Util.applyDefaults({stroke:false,fillOpacity:1},style),featureId);
this.canvas.globalCompositeOperation="source-over";
if(this.hitDetection){this.hitContext.globalCompositeOperation="source-over"
}this.drawLinearRing(components[i],OpenLayers.Util.applyDefaults({fill:false},style),featureId)
}},drawText:function(location,style){var pt=this.getLocalXY(location);
this.setCanvasStyle("reset");
this.canvas.fillStyle=style.fontColor;
this.canvas.globalAlpha=style.fontOpacity||1;
var fontStyle=[style.fontStyle?style.fontStyle:"normal","normal",style.fontWeight?style.fontWeight:"normal",style.fontSize?style.fontSize:"1em",style.fontFamily?style.fontFamily:"sans-serif"].join(" ");
var labelRows=style.label.split("\n");
var numRows=labelRows.length;
if(this.canvas.fillText){this.canvas.font=fontStyle;
this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[style.labelAlign[0]]||"center";
this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[style.labelAlign[1]]||"middle";
var vfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[1]];
if(vfactor==null){vfactor=-0.5
}var lineHeight=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;
pt[1]+=lineHeight*vfactor*(numRows-1);
for(var i=0;
i<numRows;
i++){if(style.labelOutlineWidth){this.canvas.save();
this.canvas.strokeStyle=style.labelOutlineColor;
this.canvas.lineWidth=style.labelOutlineWidth;
this.canvas.strokeText(labelRows[i],pt[0],pt[1]+(lineHeight*i)+1);
this.canvas.restore()
}this.canvas.fillText(labelRows[i],pt[0],pt[1]+(lineHeight*i))
}}else{if(this.canvas.mozDrawText){this.canvas.mozTextStyle=fontStyle;
var hfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[0]];
if(hfactor==null){hfactor=-0.5
}var vfactor=OpenLayers.Renderer.Canvas.LABEL_FACTOR[style.labelAlign[1]];
if(vfactor==null){vfactor=-0.5
}var lineHeight=this.canvas.mozMeasureText("xx");
pt[1]+=lineHeight*(1+(vfactor*numRows));
for(var i=0;
i<numRows;
i++){var x=pt[0]+(hfactor*this.canvas.mozMeasureText(labelRows[i]));
var y=pt[1]+(i*lineHeight);
this.canvas.translate(x,y);
this.canvas.mozDrawText(labelRows[i]);
this.canvas.translate(-x,-y)
}}}this.setCanvasStyle("reset")
},getLocalXY:function(point){var resolution=this.getResolution();
var extent=this.extent;
var x=((point.x-this.featureDx)/resolution+(-extent.left/resolution));
var y=((extent.top/resolution)-point.y/resolution);
return[x,y]
},clear:function(){var height=this.root.height;
var width=this.root.width;
this.canvas.clearRect(0,0,width,height);
this.features={};
if(this.hitDetection){this.hitContext.clearRect(0,0,width,height)
}},getFeatureIdFromEvent:function(evt){var featureId,feature;
if(this.hitDetection&&this.root.style.display!=="none"){if(!this.map.dragging){var xy=evt.xy;
var x=xy.x|0;
var y=xy.y|0;
var data=this.hitContext.getImageData(x,y,1,1).data;
if(data[3]===255){var id=data[2]+(256*(data[1]+(256*data[0])));
if(id){featureId="OpenLayers.Feature.Vector_"+(id-1+this.hitOverflow);
try{feature=this.features[featureId][0]
}catch(err){}}}}}return feature
},eraseFeatures:function(features){if(!(OpenLayers.Util.isArray(features))){features=[features]
}for(var i=0;
i<features.length;
++i){delete this.features[features[i].id]
}this.redraw()
},redraw:function(){if(!this.locked){var height=this.root.height;
var width=this.root.width;
this.canvas.clearRect(0,0,width,height);
if(this.hitDetection){this.hitContext.clearRect(0,0,width,height)
}var labelMap=[];
var feature,geometry,style;
var worldBounds=(this.map.baseLayer&&this.map.baseLayer.wrapDateLine)&&this.map.getMaxExtent();
for(var id in this.features){if(!this.features.hasOwnProperty(id)){continue
}feature=this.features[id][0];
geometry=feature.geometry;
this.calculateFeatureDx(geometry.getBounds(),worldBounds);
style=this.features[id][1];
this.drawGeometry(geometry,style,feature.id);
if(style.label){labelMap.push([feature,style])
}}var item;
for(var i=0,len=labelMap.length;
i<len;
++i){item=labelMap[i];
this.drawText(item[0].geometry.getCentroid(),item[1])
}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});
OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};
OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};
OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;
OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(containerID){if(!this.supported()){return
}if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);
var style=document.createStyleSheet();
var shapes=["shape","rect","oval","fill","stroke","imagedata","group","textbox"];
for(var i=0,len=shapes.length;
i<len;
i++){style.addRule("olv\\:"+shapes[i],"behavior: url(#default#VML); position: absolute; display: inline-block;")
}}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)
},supported:function(){return !!(document.namespaces)
},setExtent:function(extent,resolutionChanged){var coordSysUnchanged=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);
var resolution=this.getResolution();
var left=(extent.left/resolution)|0;
var top=(extent.top/resolution-this.size.h)|0;
if(resolutionChanged||!this.offset){this.offset={x:left,y:top};
left=0;
top=0
}else{left=left-this.offset.x;
top=top-this.offset.y
}var org=(left-this.xOffset)+" "+top;
this.root.coordorigin=org;
var roots=[this.root,this.vectorRoot,this.textRoot];
var root;
for(var i=0,len=roots.length;
i<len;
++i){root=roots[i];
var size=this.size.w+" "+this.size.h;
root.coordsize=size
}this.root.style.flip="y";
return coordSysUnchanged
},setSize:function(size){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);
var roots=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot];
var w=this.size.w+"px";
var h=this.size.h+"px";
var root;
for(var i=0,len=roots.length;
i<len;
++i){root=roots[i];
root.style.width=w;
root.style.height=h
}},getNodeType:function(geometry,style){var nodeType=null;
switch(geometry.CLASS_NAME){case"OpenLayers.Geometry.Point":if(style.externalGraphic){nodeType="olv:rect"
}else{if(this.isComplexSymbol(style.graphicName)){nodeType="olv:shape"
}else{nodeType="olv:oval"
}}break;
case"OpenLayers.Geometry.Rectangle":nodeType="olv:rect";
break;
case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":nodeType="olv:shape";
break;
default:break
}return nodeType
},setStyle:function(node,style,options,geometry){style=style||node._style;
options=options||node._options;
var fillColor=style.fillColor;
if(node._geometryClass==="OpenLayers.Geometry.Point"){if(style.externalGraphic){options.isFilled=true;
if(style.graphicTitle){node.title=style.graphicTitle
}var width=style.graphicWidth||style.graphicHeight;
var height=style.graphicHeight||style.graphicWidth;
width=width?width:style.pointRadius*2;
height=height?height:style.pointRadius*2;
var resolution=this.getResolution();
var xOffset=(style.graphicXOffset!=undefined)?style.graphicXOffset:-(0.5*width);
var yOffset=(style.graphicYOffset!=undefined)?style.graphicYOffset:-(0.5*height);
node.style.left=((((geometry.x-this.featureDx)/resolution-this.offset.x)+xOffset)|0)+"px";
node.style.top=(((geometry.y/resolution-this.offset.y)-(yOffset+height))|0)+"px";
node.style.width=width+"px";
node.style.height=height+"px";
node.style.flip="y";
fillColor="none";
options.isStroked=false
}else{if(this.isComplexSymbol(style.graphicName)){var cache=this.importSymbol(style.graphicName);
node.path=cache.path;
node.coordorigin=cache.left+","+cache.bottom;
var size=cache.size;
node.coordsize=size+","+size;
this.drawCircle(node,geometry,style.pointRadius);
node.style.flip="y"
}else{this.drawCircle(node,geometry,style.pointRadius)
}}}if(options.isFilled){node.fillcolor=fillColor
}else{node.filled="false"
}var fills=node.getElementsByTagName("fill");
var fill=(fills.length==0)?null:fills[0];
if(!options.isFilled){if(fill){node.removeChild(fill)
}}else{if(!fill){fill=this.createNode("olv:fill",node.id+"_fill")
}fill.opacity=style.fillOpacity;
if(node._geometryClass==="OpenLayers.Geometry.Point"&&style.externalGraphic){if(style.graphicOpacity){fill.opacity=style.graphicOpacity
}fill.src=style.externalGraphic;
fill.type="frame";
if(!(style.graphicWidth&&style.graphicHeight)){fill.aspect="atmost"
}}if(fill.parentNode!=node){node.appendChild(fill)
}}var rotation=style.rotation;
if((rotation!==undefined||node._rotation!==undefined)){node._rotation=rotation;
if(style.externalGraphic){this.graphicRotate(node,xOffset,yOffset,style);
fill.opacity=0
}else{if(node._geometryClass==="OpenLayers.Geometry.Point"){node.style.rotation=rotation||0
}}}var strokes=node.getElementsByTagName("stroke");
var stroke=(strokes.length==0)?null:strokes[0];
if(!options.isStroked){node.stroked=false;
if(stroke){stroke.on=false
}}else{if(!stroke){stroke=this.createNode("olv:stroke",node.id+"_stroke");
node.appendChild(stroke)
}stroke.on=true;
stroke.color=style.strokeColor;
stroke.weight=style.strokeWidth+"px";
stroke.opacity=style.strokeOpacity;
stroke.endcap=style.strokeLinecap=="butt"?"flat":(style.strokeLinecap||"round");
if(style.strokeDashstyle){stroke.dashstyle=this.dashStyle(style)
}}if(style.cursor!="inherit"&&style.cursor!=null){node.style.cursor=style.cursor
}return node
},graphicRotate:function(node,xOffset,yOffset,style){var style=style||node._style;
var rotation=style.rotation||0;
var aspectRatio,size;
if(!(style.graphicWidth&&style.graphicHeight)){var img=new Image();
img.onreadystatechange=OpenLayers.Function.bind(function(){if(img.readyState=="complete"||img.readyState=="interactive"){aspectRatio=img.width/img.height;
size=Math.max(style.pointRadius*2,style.graphicWidth||0,style.graphicHeight||0);
xOffset=xOffset*aspectRatio;
style.graphicWidth=size*aspectRatio;
style.graphicHeight=size;
this.graphicRotate(node,xOffset,yOffset,style)
}},this);
img.src=style.externalGraphic;
return
}else{size=Math.max(style.graphicWidth,style.graphicHeight);
aspectRatio=style.graphicWidth/style.graphicHeight
}var width=Math.round(style.graphicWidth||size*aspectRatio);
var height=Math.round(style.graphicHeight||size);
node.style.width=width+"px";
node.style.height=height+"px";
var image=document.getElementById(node.id+"_image");
if(!image){image=this.createNode("olv:imagedata",node.id+"_image");
node.appendChild(image)
}image.style.width=width+"px";
image.style.height=height+"px";
image.src=style.externalGraphic;
image.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";
var rot=rotation*Math.PI/180;
var sintheta=Math.sin(rot);
var costheta=Math.cos(rot);
var filter="progid:DXImageTransform.Microsoft.Matrix(M11="+costheta+",M12="+(-sintheta)+",M21="+sintheta+",M22="+costheta+",SizingMethod='auto expand')\n";
var opacity=style.graphicOpacity||style.fillOpacity;
if(opacity&&opacity!=1){filter+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+opacity+")\n"
}node.style.filter=filter;
var centerPoint=new OpenLayers.Geometry.Point(-xOffset,-yOffset);
var imgBox=new OpenLayers.Bounds(0,0,width,height).toGeometry();
imgBox.rotate(style.rotation,centerPoint);
var imgBounds=imgBox.getBounds();
node.style.left=Math.round(parseInt(node.style.left)+imgBounds.left)+"px";
node.style.top=Math.round(parseInt(node.style.top)-imgBounds.bottom)+"px"
},postDraw:function(node){node.style.visibility="visible";
var fillColor=node._style.fillColor;
var strokeColor=node._style.strokeColor;
if(fillColor=="none"&&node.fillcolor!=fillColor){node.fillcolor=fillColor
}if(strokeColor=="none"&&node.strokecolor!=strokeColor){node.strokecolor=strokeColor
}},setNodeDimension:function(node,geometry){var bbox=geometry.getBounds();
if(bbox){var resolution=this.getResolution();
var scaledBox=new OpenLayers.Bounds(((bbox.left-this.featureDx)/resolution-this.offset.x)|0,(bbox.bottom/resolution-this.offset.y)|0,((bbox.right-this.featureDx)/resolution-this.offset.x)|0,(bbox.top/resolution-this.offset.y)|0);
node.style.left=scaledBox.left+"px";
node.style.top=scaledBox.top+"px";
node.style.width=scaledBox.getWidth()+"px";
node.style.height=scaledBox.getHeight()+"px";
node.coordorigin=scaledBox.left+" "+scaledBox.top;
node.coordsize=scaledBox.getWidth()+" "+scaledBox.getHeight()
}},dashStyle:function(style){var dash=style.strokeDashstyle;
switch(dash){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return dash;
default:var parts=dash.split(/[ ,]/);
if(parts.length==2){if(1*parts[0]>=2*parts[1]){return"longdash"
}return(parts[0]==1||parts[1]==1)?"dot":"dash"
}else{if(parts.length==4){return(1*parts[0]>=2*parts[1])?"longdashdot":"dashdot"
}}return"solid"
}},createNode:function(type,id){var node=document.createElement(type);
if(id){node.id=id
}node.unselectable="on";
node.onselectstart=OpenLayers.Function.False;
return node
},nodeTypeCompare:function(node,type){var subType=type;
var splitIndex=subType.indexOf(":");
if(splitIndex!=-1){subType=subType.substr(splitIndex+1)
}var nodeName=node.nodeName;
splitIndex=nodeName.indexOf(":");
if(splitIndex!=-1){nodeName=nodeName.substr(splitIndex+1)
}return(subType==nodeName)
},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")
},createRoot:function(suffix){return this.nodeFactory(this.container.id+suffix,"olv:group")
},drawPoint:function(node,geometry){return this.drawCircle(node,geometry,1)
},drawCircle:function(node,geometry,radius){if(!isNaN(geometry.x)&&!isNaN(geometry.y)){var resolution=this.getResolution();
node.style.left=((((geometry.x-this.featureDx)/resolution-this.offset.x)|0)-radius)+"px";
node.style.top=(((geometry.y/resolution-this.offset.y)|0)-radius)+"px";
var diameter=radius*2;
node.style.width=diameter+"px";
node.style.height=diameter+"px";
return node
}return false
},drawLineString:function(node,geometry){return this.drawLine(node,geometry,false)
},drawLinearRing:function(node,geometry){return this.drawLine(node,geometry,true)
},drawLine:function(node,geometry,closeLine){this.setNodeDimension(node,geometry);
var resolution=this.getResolution();
var numComponents=geometry.components.length;
var parts=new Array(numComponents);
var comp,x,y;
for(var i=0;
i<numComponents;
i++){comp=geometry.components[i];
x=((comp.x-this.featureDx)/resolution-this.offset.x)|0;
y=(comp.y/resolution-this.offset.y)|0;
parts[i]=" "+x+","+y+" l "
}var end=(closeLine)?" x e":" e";
node.path="m"+parts.join("")+end;
return node
},drawPolygon:function(node,geometry){this.setNodeDimension(node,geometry);
var resolution=this.getResolution();
var path=[];
var j,jj,points,area,first,second,i,ii,comp,pathComp,x,y;
for(j=0,jj=geometry.components.length;
j<jj;
j++){path.push("m");
points=geometry.components[j].components;
area=(j===0);
first=null;
second=null;
for(i=0,ii=points.length;
i<ii;
i++){comp=points[i];
x=((comp.x-this.featureDx)/resolution-this.offset.x)|0;
y=(comp.y/resolution-this.offset.y)|0;
pathComp=" "+x+","+y;
path.push(pathComp);
if(i==0){path.push(" l")
}if(!area){if(!first){first=pathComp
}else{if(first!=pathComp){if(!second){second=pathComp
}else{if(second!=pathComp){area=true
}}}}}}path.push(area?" x ":" ")
}path.push("e");
node.path=path.join("");
return node
},drawRectangle:function(node,geometry){var resolution=this.getResolution();
node.style.left=(((geometry.x-this.featureDx)/resolution-this.offset.x)|0)+"px";
node.style.top=((geometry.y/resolution-this.offset.y)|0)+"px";
node.style.width=((geometry.width/resolution)|0)+"px";
node.style.height=((geometry.height/resolution)|0)+"px";
return node
},drawText:function(featureId,style,location){var label=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX,"olv:rect");
var textbox=this.nodeFactory(featureId+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox");
var resolution=this.getResolution();
label.style.left=(((location.x-this.featureDx)/resolution-this.offset.x)|0)+"px";
label.style.top=((location.y/resolution-this.offset.y)|0)+"px";
label.style.flip="y";
textbox.innerText=style.label;
if(style.cursor!="inherit"&&style.cursor!=null){textbox.style.cursor=style.cursor
}if(style.fontColor){textbox.style.color=style.fontColor
}if(style.fontOpacity){textbox.style.filter="alpha(opacity="+(style.fontOpacity*100)+")"
}if(style.fontFamily){textbox.style.fontFamily=style.fontFamily
}if(style.fontSize){textbox.style.fontSize=style.fontSize
}if(style.fontWeight){textbox.style.fontWeight=style.fontWeight
}if(style.fontStyle){textbox.style.fontStyle=style.fontStyle
}if(style.labelSelect===true){label._featureId=featureId;
textbox._featureId=featureId;
textbox._geometry=location;
textbox._geometryClass=location.CLASS_NAME
}textbox.style.whiteSpace="nowrap";
textbox.inset="1px,0px,0px,0px";
if(!label.parentNode){label.appendChild(textbox);
this.textRoot.appendChild(label)
}var align=style.labelAlign||"cm";
if(align.length==1){align+="m"
}var xshift=textbox.clientWidth*(OpenLayers.Renderer.VML.LABEL_SHIFT[align.substr(0,1)]);
var yshift=textbox.clientHeight*(OpenLayers.Renderer.VML.LABEL_SHIFT[align.substr(1,1)]);
label.style.left=parseInt(label.style.left)-xshift-1+"px";
label.style.top=parseInt(label.style.top)+yshift+"px"
},moveRoot:function(renderer){var layer=this.map.getLayer(renderer.container.id);
if(layer instanceof OpenLayers.Layer.Vector.RootContainer){layer=this.map.getLayer(this.container.id)
}layer&&layer.renderer.clear();
OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);
layer&&layer.redraw()
},importSymbol:function(graphicName){var id=this.container.id+"-"+graphicName;
var cache=this.symbolCache[id];
if(cache){return cache
}var symbol=OpenLayers.Renderer.symbol[graphicName];
if(!symbol){throw new Error(graphicName+" is not a valid symbol name")
}var symbolExtent=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0);
var pathitems=["m"];
for(var i=0;
i<symbol.length;
i=i+2){var x=symbol[i];
var y=symbol[i+1];
symbolExtent.left=Math.min(symbolExtent.left,x);
symbolExtent.bottom=Math.min(symbolExtent.bottom,y);
symbolExtent.right=Math.max(symbolExtent.right,x);
symbolExtent.top=Math.max(symbolExtent.top,y);
pathitems.push(x);
pathitems.push(y);
if(i==0){pathitems.push("l")
}}pathitems.push("x e");
var path=pathitems.join(" ");
var diff=(symbolExtent.getWidth()-symbolExtent.getHeight())/2;
if(diff>0){symbolExtent.bottom=symbolExtent.bottom-diff;
symbolExtent.top=symbolExtent.top+diff
}else{symbolExtent.left=symbolExtent.left+diff;
symbolExtent.right=symbolExtent.right-diff
}cache={path:path,size:symbolExtent.getWidth(),left:symbolExtent.left,bottom:symbolExtent.bottom};
this.symbolCache[id]=cache;
return cache
},CLASS_NAME:"OpenLayers.Renderer.VML"});
OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:0.5,r:1,t:0,m:0.5,b:1};
OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:false,isFixed:false,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:true,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:false,ratio:1,initialize:function(name,options){OpenLayers.Layer.prototype.initialize.apply(this,arguments);
if(!this.renderer||!this.renderer.supported()){this.assignRenderer()
}if(!this.renderer||!this.renderer.supported()){this.renderer=null;
this.displayError()
}if(!this.styleMap){this.styleMap=new OpenLayers.StyleMap()
}this.features=[];
this.selectedFeatures=[];
this.unrenderedFeatures={};
if(this.strategies){for(var i=0,len=this.strategies.length;
i<len;
i++){this.strategies[i].setLayer(this)
}}},destroy:function(){if(this.strategies){var strategy,i,len;
for(i=0,len=this.strategies.length;
i<len;
i++){strategy=this.strategies[i];
if(strategy.autoDestroy){strategy.destroy()
}}this.strategies=null
}if(this.protocol){if(this.protocol.autoDestroy){this.protocol.destroy()
}this.protocol=null
}this.destroyFeatures();
this.features=null;
this.selectedFeatures=null;
this.unrenderedFeatures=null;
if(this.renderer){this.renderer.destroy()
}this.renderer=null;
this.geometryType=null;
this.drawn=null;
OpenLayers.Layer.prototype.destroy.apply(this,arguments)
},clone:function(obj){if(obj==null){obj=new OpenLayers.Layer.Vector(this.name,this.getOptions())
}obj=OpenLayers.Layer.prototype.clone.apply(this,[obj]);
var features=this.features;
var len=features.length;
var clonedFeatures=new Array(len);
for(var i=0;
i<len;
++i){clonedFeatures[i]=features[i].clone()
}obj.features=clonedFeatures;
return obj
},refresh:function(obj){if(this.calculateInRange()&&this.visibility){this.events.triggerEvent("refresh",obj)
}},assignRenderer:function(){for(var i=0,len=this.renderers.length;
i<len;
i++){var rendererClass=this.renderers[i];
var renderer=(typeof rendererClass=="function")?rendererClass:OpenLayers.Renderer[rendererClass];
if(renderer&&renderer.prototype.supported()){this.renderer=new renderer(this.div,this.rendererOptions);
break
}}},displayError:function(){if(this.reportError){OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))
}},setMap:function(map){OpenLayers.Layer.prototype.setMap.apply(this,arguments);
if(!this.renderer){this.map.removeLayer(this)
}else{this.renderer.map=this.map;
var newSize=this.map.getSize();
newSize.w=newSize.w*this.ratio;
newSize.h=newSize.h*this.ratio;
this.renderer.setSize(newSize)
}},afterAdd:function(){if(this.strategies){var strategy,i,len;
for(i=0,len=this.strategies.length;
i<len;
i++){strategy=this.strategies[i];
if(strategy.autoActivate){strategy.activate()
}}}},removeMap:function(map){this.drawn=false;
if(this.strategies){var strategy,i,len;
for(i=0,len=this.strategies.length;
i<len;
i++){strategy=this.strategies[i];
if(strategy.autoActivate){strategy.deactivate()
}}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);
var newSize=this.map.getSize();
newSize.w=newSize.w*this.ratio;
newSize.h=newSize.h*this.ratio;
this.renderer.setSize(newSize)
},moveTo:function(bounds,zoomChanged,dragging){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);
var coordSysUnchanged=true;
if(!dragging){this.renderer.root.style.visibility="hidden";
var viewSize=this.map.getSize(),viewWidth=viewSize.w,viewHeight=viewSize.h,offsetLeft=(viewWidth/2*this.ratio)-viewWidth/2,offsetTop=(viewHeight/2*this.ratio)-viewHeight/2;
offsetLeft+=parseInt(this.map.layerContainerDiv.style.left,10);
offsetLeft=-Math.round(offsetLeft);
offsetTop+=parseInt(this.map.layerContainerDiv.style.top,10);
offsetTop=-Math.round(offsetTop);
this.div.style.left=offsetLeft+"px";
this.div.style.top=offsetTop+"px";
var extent=this.map.getExtent().scale(this.ratio);
coordSysUnchanged=this.renderer.setExtent(extent,zoomChanged);
this.renderer.root.style.visibility="visible";
if(OpenLayers.IS_GECKO===true){this.div.scrollLeft=this.div.scrollLeft
}if(!zoomChanged&&coordSysUnchanged){for(var i in this.unrenderedFeatures){var feature=this.unrenderedFeatures[i];
this.drawFeature(feature)
}}}if(!this.drawn||zoomChanged||!coordSysUnchanged){this.drawn=true;
var feature;
for(var i=0,len=this.features.length;
i<len;
i++){this.renderer.locked=(i!==(len-1));
feature=this.features[i];
this.drawFeature(feature)
}}},display:function(display){OpenLayers.Layer.prototype.display.apply(this,arguments);
var currentDisplay=this.div.style.display;
if(currentDisplay!=this.renderer.root.style.display){this.renderer.root.style.display=currentDisplay
}},addFeatures:function(features,options){if(!(OpenLayers.Util.isArray(features))){features=[features]
}var notify=!options||!options.silent;
if(notify){var event={features:features};
var ret=this.events.triggerEvent("beforefeaturesadded",event);
if(ret===false){return
}features=event.features
}var featuresAdded=[];
for(var i=0,len=features.length;
i<len;
i++){if(i!=(features.length-1)){this.renderer.locked=true
}else{this.renderer.locked=false
}var feature=features[i];
if(this.geometryType&&!(feature.geometry instanceof this.geometryType)){throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME)
}feature.layer=this;
if(!feature.style&&this.style){feature.style=OpenLayers.Util.extend({},this.style)
}if(notify){if(this.events.triggerEvent("beforefeatureadded",{feature:feature})===false){continue
}this.preFeatureInsert(feature)
}featuresAdded.push(feature);
this.features.push(feature);
this.drawFeature(feature);
if(notify){this.events.triggerEvent("featureadded",{feature:feature});
this.onFeatureInsert(feature)
}}if(notify){this.events.triggerEvent("featuresadded",{features:featuresAdded})
}},removeFeatures:function(features,options){if(!features||features.length===0){return
}if(features===this.features){return this.removeAllFeatures(options)
}if(!(OpenLayers.Util.isArray(features))){features=[features]
}if(features===this.selectedFeatures){features=features.slice()
}var notify=!options||!options.silent;
if(notify){this.events.triggerEvent("beforefeaturesremoved",{features:features})
}for(var i=features.length-1;
i>=0;
i--){if(i!=0&&features[i-1].geometry){this.renderer.locked=true
}else{this.renderer.locked=false
}var feature=features[i];
delete this.unrenderedFeatures[feature.id];
if(notify){this.events.triggerEvent("beforefeatureremoved",{feature:feature})
}this.features=OpenLayers.Util.removeItem(this.features,feature);
feature.layer=null;
if(feature.geometry){this.renderer.eraseFeatures(feature)
}if(OpenLayers.Util.indexOf(this.selectedFeatures,feature)!=-1){OpenLayers.Util.removeItem(this.selectedFeatures,feature)
}if(notify){this.events.triggerEvent("featureremoved",{feature:feature})
}}if(notify){this.events.triggerEvent("featuresremoved",{features:features})
}},removeAllFeatures:function(options){var notify=!options||!options.silent;
var features=this.features;
if(notify){this.events.triggerEvent("beforefeaturesremoved",{features:features})
}var feature;
for(var i=features.length-1;
i>=0;
i--){feature=features[i];
if(notify){this.events.triggerEvent("beforefeatureremoved",{feature:feature})
}feature.layer=null;
if(notify){this.events.triggerEvent("featureremoved",{feature:feature})
}}this.renderer.clear();
this.features=[];
this.unrenderedFeatures={};
this.selectedFeatures=[];
if(notify){this.events.triggerEvent("featuresremoved",{features:features})
}},destroyFeatures:function(features,options){var all=(features==undefined);
if(all){features=this.features
}if(features){this.removeFeatures(features,options);
for(var i=features.length-1;
i>=0;
i--){features[i].destroy()
}}},drawFeature:function(feature,style){if(!this.drawn){return
}if(typeof style!="object"){if(!style&&feature.state===OpenLayers.State.DELETE){style="delete"
}var renderIntent=style||feature.renderIntent;
style=feature.style||this.style;
if(!style){style=this.styleMap.createSymbolizer(feature,renderIntent)
}}var drawn=this.renderer.drawFeature(feature,style);
if(drawn===false||drawn===null){this.unrenderedFeatures[feature.id]=feature
}else{delete this.unrenderedFeatures[feature.id]
}},eraseFeatures:function(features){this.renderer.eraseFeatures(features)
},getFeatureFromEvent:function(evt){if(!this.renderer){throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.")
}var feature=null;
var featureId=this.renderer.getFeatureIdFromEvent(evt);
if(featureId){if(typeof featureId==="string"){feature=this.getFeatureById(featureId)
}else{feature=featureId
}}return feature
},getFeatureBy:function(property,value){var feature=null;
for(var i=0,len=this.features.length;
i<len;
++i){if(this.features[i][property]==value){feature=this.features[i];
break
}}return feature
},getFeatureById:function(featureId){return this.getFeatureBy("id",featureId)
},getFeatureByFid:function(featureFid){return this.getFeatureBy("fid",featureFid)
},getFeaturesByAttribute:function(attrName,attrValue){var i,feature,len=this.features.length,foundFeatures=[];
for(i=0;
i<len;
i++){feature=this.features[i];
if(feature&&feature.attributes){if(feature.attributes[attrName]===attrValue){foundFeatures.push(feature)
}}}return foundFeatures
},onFeatureInsert:function(feature){},preFeatureInsert:function(feature){},getDataExtent:function(){var maxExtent=null;
var features=this.features;
if(features&&(features.length>0)){var geometry=null;
for(var i=0,len=features.length;
i<len;
i++){geometry=features[i].geometry;
if(geometry){if(maxExtent===null){maxExtent=new OpenLayers.Bounds()
}maxExtent.extend(geometry.getBounds())
}}}return maxExtent
},CLASS_NAME:"OpenLayers.Layer.Vector"});
OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(config){config=config||{};
OpenLayers.Layer.Vector.prototype.initialize.apply(this,[config.name,config])
},setMap:function(map){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);
map.events.register("moveend",this,this.onMoveEnd)
},removeMap:function(map){map.events.unregister("moveend",this,this.onMoveEnd);
OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)
},setRatio:function(ratio){this.ratio=ratio;
this.updateGrid(true)
},setMaxFeatures:function(maxFeatures){this.maxFeatures=maxFeatures;
this.updateGrid(true)
},setSpacing:function(dx,dy){this.dx=dx;
this.dy=dy||dx;
this.updateGrid(true)
},setOrigin:function(origin){this.origin=origin;
this.updateGrid(true)
},getOrigin:function(){if(!this.origin){this.origin=this.map.getExtent().getCenterLonLat()
}return this.origin
},setRotation:function(rotation){this.rotation=rotation;
this.updateGrid(true)
},onMoveEnd:function(){this.updateGrid()
},getViewBounds:function(){var bounds=this.map.getExtent();
if(this.rotation){var origin=this.getOrigin();
var rotationOrigin=new OpenLayers.Geometry.Point(origin.lon,origin.lat);
var rect=bounds.toGeometry();
rect.rotate(-this.rotation,rotationOrigin);
bounds=rect.getBounds()
}return bounds
},updateGrid:function(force){if(force||this.invalidBounds()){var viewBounds=this.getViewBounds();
var origin=this.getOrigin();
var rotationOrigin=new OpenLayers.Geometry.Point(origin.lon,origin.lat);
var viewBoundsWidth=viewBounds.getWidth();
var viewBoundsHeight=viewBounds.getHeight();
var aspectRatio=viewBoundsWidth/viewBoundsHeight;
var maxHeight=Math.sqrt(this.dx*this.dy*this.maxFeatures/aspectRatio);
var maxWidth=maxHeight*aspectRatio;
var gridWidth=Math.min(viewBoundsWidth*this.ratio,maxWidth);
var gridHeight=Math.min(viewBoundsHeight*this.ratio,maxHeight);
var center=viewBounds.getCenterLonLat();
this.gridBounds=new OpenLayers.Bounds(center.lon-(gridWidth/2),center.lat-(gridHeight/2),center.lon+(gridWidth/2),center.lat+(gridHeight/2));
var rows=Math.floor(gridHeight/this.dy);
var cols=Math.floor(gridWidth/this.dx);
var gridLeft=origin.lon+(this.dx*Math.ceil((this.gridBounds.left-origin.lon)/this.dx));
var gridBottom=origin.lat+(this.dy*Math.ceil((this.gridBounds.bottom-origin.lat)/this.dy));
var features=new Array(rows*cols);
var x,y,point;
for(var i=0;
i<cols;
++i){x=gridLeft+(i*this.dx);
for(var j=0;
j<rows;
++j){y=gridBottom+(j*this.dy);
point=new OpenLayers.Geometry.Point(x,y);
if(this.rotation){point.rotate(this.rotation,rotationOrigin)
}features[(i*rows)+j]=new OpenLayers.Feature.Vector(point)
}}this.destroyFeatures(this.features,{silent:true});
this.addFeatures(features,{silent:true})
}},invalidBounds:function(){return !this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())
},CLASS_NAME:"OpenLayers.Layer.PointGrid"});
OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:false,layers:null,display:function(){},getFeatureFromEvent:function(evt){var layers=this.layers;
var feature;
for(var i=0;
i<layers.length;
i++){feature=layers[i].getFeatureFromEvent(evt);
if(feature){return feature
}}},setMap:function(map){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments);
this.collectRoots();
map.events.register("changelayer",this,this.handleChangeLayer)
},removeMap:function(map){map.events.unregister("changelayer",this,this.handleChangeLayer);
this.resetRoots();
OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)
},collectRoots:function(){var layer;
for(var i=0;
i<this.map.layers.length;
++i){layer=this.map.layers[i];
if(OpenLayers.Util.indexOf(this.layers,layer)!=-1){layer.renderer.moveRoot(this.renderer)
}}},resetRoots:function(){var layer;
for(var i=0;
i<this.layers.length;
++i){layer=this.layers[i];
if(this.renderer&&layer.renderer.getRenderLayerId()==this.id){this.renderer.moveRoot(layer.renderer)
}}},handleChangeLayer:function(evt){var layer=evt.layer;
if(evt.property=="order"&&OpenLayers.Util.indexOf(this.layers,layer)!=-1){this.resetRoots();
this.collectRoots()
}},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"});
OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:true,autoDestroy:true,initialize:function(options){OpenLayers.Util.extend(this,options);
this.options=options;
this.active=false
},destroy:function(){this.deactivate();
this.layer=null;
this.options=null
},setLayer:function(layer){this.layer=layer
},activate:function(){if(!this.active){this.active=true;
return true
}return false
},deactivate:function(){if(this.active){this.active=false;
return true
}return false
},CLASS_NAME:"OpenLayers.Strategy"});
OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:false,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.apply(this,arguments);
if(activated){this.cache=[];
this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})
}return activated
},deactivate:function(){this.cache=null;
if(this.layer&&this.layer.events){this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})
}return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)
},handleAdd:function(event){if(!this.caching&&this.filter){var features=event.features;
event.features=[];
var feature;
for(var i=0,ii=features.length;
i<ii;
++i){feature=features[i];
if(this.filter.evaluate(feature)){event.features.push(feature)
}else{this.cache.push(feature)
}}}},handleRemove:function(event){if(!this.caching){this.cache=[]
}},setFilter:function(filter){this.filter=filter;
var previousCache=this.cache;
this.cache=[];
this.handleAdd({features:this.layer.features});
if(this.cache.length>0){this.caching=true;
this.layer.removeFeatures(this.cache.slice());
this.caching=false
}if(previousCache.length>0){var event={features:previousCache};
this.handleAdd(event);
if(event.features.length>0){this.caching=true;
this.layer.addFeatures(event.features);
this.caching=false
}}},CLASS_NAME:"OpenLayers.Strategy.Filter"});
OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:false,activate:function(){if(OpenLayers.Strategy.prototype.activate.apply(this,arguments)){this.layer.events.on({refresh:this.load,scope:this});
if(this.layer.visibility==true||this.preload){this.load()
}else{this.layer.events.on({visibilitychanged:this.load,scope:this})
}return true
}return false
},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);
if(deactivated){this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this})
}return deactivated
},load:function(options){var layer=this.layer;
layer.events.triggerEvent("loadstart");
layer.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,layer.map.getProjectionObject()),filter:layer.filter},options));
layer.events.un({visibilitychanged:this.load,scope:this})
},merge:function(mapProjection,resp){var layer=this.layer;
layer.destroyFeatures();
var features=resp.features;
if(features&&features.length>0){if(!mapProjection.equals(layer.projection)){var geom;
for(var i=0,len=features.length;
i<len;
++i){geom=features[i].geometry;
if(geom){geom.transform(layer.projection,mapProjection)
}}}layer.addFeatures(features)
}layer.events.triggerEvent("loadend")
},CLASS_NAME:"OpenLayers.Strategy.Fixed"});
OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:false,resolution:null,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);
if(activated){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})
}return activated
},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);
if(deactivated){this.clearCache();
this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})
}return deactivated
},cacheFeatures:function(event){var propagate=true;
if(!this.clustering){this.clearCache();
this.features=event.features;
this.cluster();
propagate=false
}return propagate
},clearCache:function(){this.features=null
},cluster:function(event){if((!event||event.zoomChanged)&&this.features){var resolution=this.layer.map.getResolution();
if(resolution!=this.resolution||!this.clustersExist()){this.resolution=resolution;
var clusters=[];
var feature,clustered,cluster;
for(var i=0;
i<this.features.length;
++i){feature=this.features[i];
if(feature.geometry){clustered=false;
for(var j=clusters.length-1;
j>=0;
--j){cluster=clusters[j];
if(this.shouldCluster(cluster,feature)){this.addToCluster(cluster,feature);
clustered=true;
break
}}if(!clustered){clusters.push(this.createCluster(this.features[i]))
}}}this.layer.removeAllFeatures();
if(clusters.length>0){if(this.threshold>1){var clone=clusters.slice();
clusters=[];
var candidate;
for(var i=0,len=clone.length;
i<len;
++i){candidate=clone[i];
if(candidate.attributes.count<this.threshold){Array.prototype.push.apply(clusters,candidate.cluster)
}else{clusters.push(candidate)
}}}this.clustering=true;
this.layer.addFeatures(clusters);
this.clustering=false
}this.clusters=clusters
}}},clustersExist:function(){var exist=false;
if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){exist=true;
for(var i=0;
i<this.clusters.length;
++i){if(this.clusters[i]!=this.layer.features[i]){exist=false;
break
}}}return exist
},shouldCluster:function(cluster,feature){var cc=cluster.geometry.getBounds().getCenterLonLat();
var fc=feature.geometry.getBounds().getCenterLonLat();
var distance=(Math.sqrt(Math.pow((cc.lon-fc.lon),2)+Math.pow((cc.lat-fc.lat),2))/this.resolution);
return(distance<=this.distance)
},addToCluster:function(cluster,feature){cluster.cluster.push(feature);
cluster.attributes.count+=1
},createCluster:function(feature){var center=feature.geometry.getBounds().getCenterLonLat();
var cluster=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(center.lon,center.lat),{count:1});
cluster.cluster=[feature];
return cluster
},CLASS_NAME:"OpenLayers.Strategy.Cluster"});
OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:false,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);
if(activated){this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this})
}return activated
},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);
if(deactivated){this.clearCache();
this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})
}return deactivated
},cacheFeatures:function(event){if(!this.paging){this.clearCache();
this.features=event.features;
this.pageNext(event)
}},clearCache:function(){if(this.features){for(var i=0;
i<this.features.length;
++i){this.features[i].destroy()
}}this.features=null;
this.num=null
},pageCount:function(){var numFeatures=this.features?this.features.length:0;
return Math.ceil(numFeatures/this.length)
},pageNum:function(){return this.num
},pageLength:function(newLength){if(newLength&&newLength>0){this.length=newLength
}return this.length
},pageNext:function(event){var changed=false;
if(this.features){if(this.num===null){this.num=-1
}var start=(this.num+1)*this.length;
changed=this.page(start,event)
}return changed
},pagePrevious:function(){var changed=false;
if(this.features){if(this.num===null){this.num=this.pageCount()
}var start=(this.num-1)*this.length;
changed=this.page(start)
}return changed
},page:function(start,event){var changed=false;
if(this.features){if(start>=0&&start<this.features.length){var num=Math.floor(start/this.length);
if(num!=this.num){this.paging=true;
var features=this.features.slice(start,start+this.length);
this.layer.removeFeatures(this.layer.features);
this.num=num;
if(event&&event.features){event.features=features
}else{this.layer.addFeatures(features)
}this.paging=false;
changed=true
}}}return changed
},CLASS_NAME:"OpenLayers.Strategy.Paging"});
OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);
if(activated){this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this});
this.update()
}return activated
},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);
if(deactivated){this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this})
}return deactivated
},update:function(options){var mapBounds=this.getMapBounds();
if(mapBounds!==null&&((options&&options.force)||(this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(mapBounds)))){this.calculateBounds(mapBounds);
this.resolution=this.layer.map.getResolution();
this.triggerRead(options)
}},getMapBounds:function(){if(this.layer.map===null){return null
}var bounds=this.layer.map.getExtent();
if(bounds&&!this.layer.projection.equals(this.layer.map.getProjectionObject())){bounds=bounds.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)
}return bounds
},invalidBounds:function(mapBounds){if(!mapBounds){mapBounds=this.getMapBounds()
}var invalid=!this.bounds||!this.bounds.containsBounds(mapBounds);
if(!invalid&&this.resFactor){var ratio=this.resolution/this.layer.map.getResolution();
invalid=(ratio>=this.resFactor||ratio<=(1/this.resFactor))
}return invalid
},calculateBounds:function(mapBounds){if(!mapBounds){mapBounds=this.getMapBounds()
}var center=mapBounds.getCenterLonLat();
var dataWidth=mapBounds.getWidth()*this.ratio;
var dataHeight=mapBounds.getHeight()*this.ratio;
this.bounds=new OpenLayers.Bounds(center.lon-(dataWidth/2),center.lat-(dataHeight/2),center.lon+(dataWidth/2),center.lat+(dataHeight/2))
},triggerRead:function(options){if(this.response&&!(options&&options.noAbort===true)){this.layer.protocol.abort(this.response);
this.layer.events.triggerEvent("loadend")
}this.layer.events.triggerEvent("loadstart");
this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},options))
},createFilter:function(){var filter=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});
if(this.layer.filter){filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,filter]})
}return filter
},merge:function(resp){this.layer.destroyFeatures();
var features=resp.features;
if(features&&features.length>0){var remote=this.layer.projection;
var local=this.layer.map.getProjectionObject();
if(!local.equals(remote)){var geom;
for(var i=0,len=features.length;
i<len;
++i){geom=features[i].geometry;
if(geom){geom.transform(remote,local)
}}}this.layer.addFeatures(features)
}this.response=null;
this.layer.events.triggerEvent("loadend")
},CLASS_NAME:"OpenLayers.Strategy.BBOX"});
OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:false,timer:null,initialize:function(options){OpenLayers.Strategy.prototype.initialize.apply(this,[options]);
this.events=new OpenLayers.Events(this)
},activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);
if(activated){if(this.auto){if(typeof this.auto==="number"){this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),this.auto*1000)
}else{this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})
}}}return activated
},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);
if(deactivated){if(this.auto){if(typeof this.auto==="number"){window.clearInterval(this.timer)
}else{this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})
}}}return deactivated
},triggerSave:function(event){var feature=event.feature;
if(feature.state===OpenLayers.State.INSERT||feature.state===OpenLayers.State.UPDATE||feature.state===OpenLayers.State.DELETE){this.save([event.feature])
}},save:function(features){if(!features){features=this.layer.features
}this.events.triggerEvent("start",{features:features});
var remote=this.layer.projection;
var local=this.layer.map.getProjectionObject();
if(!local.equals(remote)){var len=features.length;
var clones=new Array(len);
var orig,clone;
for(var i=0;
i<len;
++i){orig=features[i];
clone=orig.clone();
clone.fid=orig.fid;
clone.state=orig.state;
if(orig.url){clone.url=orig.url
}clone._original=orig;
clone.geometry.transform(local,remote);
clones[i]=clone
}features=clones
}this.layer.protocol.commit(features,{callback:this.onCommit,scope:this})
},onCommit:function(response){var evt={response:response};
if(response.success()){var features=response.reqFeatures;
var state,feature;
var destroys=[];
var insertIds=response.insertIds||[];
var j=0;
for(var i=0,len=features.length;
i<len;
++i){feature=features[i];
feature=feature._original||feature;
state=feature.state;
if(state){if(state==OpenLayers.State.DELETE){destroys.push(feature)
}else{if(state==OpenLayers.State.INSERT){feature.fid=insertIds[j];
++j
}}feature.state=null
}}if(destroys.length>0){this.layer.destroyFeatures(destroys)
}this.events.triggerEvent("success",evt)
}else{this.events.triggerEvent("fail",evt)
}},CLASS_NAME:"OpenLayers.Strategy.Save"});
OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:false,interval:0,timer:null,activate:function(){var activated=OpenLayers.Strategy.prototype.activate.call(this);
if(activated){if(this.layer.visibility===true){this.start()
}this.layer.events.on({visibilitychanged:this.reset,scope:this})
}return activated
},deactivate:function(){var deactivated=OpenLayers.Strategy.prototype.deactivate.call(this);
if(deactivated){this.stop()
}return deactivated
},reset:function(){if(this.layer.visibility===true){this.start()
}else{this.stop()
}},start:function(){if(this.interval&&typeof this.interval==="number"&&this.interval>0){this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval)
}},refresh:function(){if(this.layer&&this.layer.refresh&&typeof this.layer.refresh=="function"){this.layer.refresh({force:this.force})
}},stop:function(){if(this.timer!==null){window.clearInterval(this.timer);
this.timer=null
}},CLASS_NAME:"OpenLayers.Strategy.Refresh"});
OpenLayers.Filter=OpenLayers.Class({initialize:function(options){OpenLayers.Util.extend(this,options)
},destroy:function(){},evaluate:function(context){return true
},clone:function(){return null
},toString:function(){var string;
if(OpenLayers.Format&&OpenLayers.Format.CQL){string=OpenLayers.Format.CQL.prototype.write(this)
}else{string=Object.prototype.toString.call(this)
}return string
},CLASS_NAME:"OpenLayers.Filter"});
OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(options){this.fids=[];
OpenLayers.Filter.prototype.initialize.apply(this,[options])
},evaluate:function(feature){for(var i=0,len=this.fids.length;
i<len;
i++){var fid=feature.fid||feature.id;
if(fid==this.fids[i]){return true
}}return false
},clone:function(){var filter=new OpenLayers.Filter.FeatureId();
OpenLayers.Util.extend(filter,this);
filter.fids=this.fids.slice();
return filter
},CLASS_NAME:"OpenLayers.Filter.FeatureId"});
OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(options){this.filters=[];
OpenLayers.Filter.prototype.initialize.apply(this,[options])
},destroy:function(){this.filters=null;
OpenLayers.Filter.prototype.destroy.apply(this)
},evaluate:function(context){var i,len;
switch(this.type){case OpenLayers.Filter.Logical.AND:for(i=0,len=this.filters.length;
i<len;
i++){if(this.filters[i].evaluate(context)==false){return false
}}return true;
case OpenLayers.Filter.Logical.OR:for(i=0,len=this.filters.length;
i<len;
i++){if(this.filters[i].evaluate(context)==true){return true
}}return false;
case OpenLayers.Filter.Logical.NOT:return(!this.filters[0].evaluate(context))
}return undefined
},clone:function(){var filters=[];
for(var i=0,len=this.filters.length;
i<len;
++i){filters.push(this.filters[i].clone())
}return new OpenLayers.Filter.Logical({type:this.type,filters:filters})
},CLASS_NAME:"OpenLayers.Filter.Logical"});
OpenLayers.Filter.Logical.AND="&&";
OpenLayers.Filter.Logical.OR="||";
OpenLayers.Filter.Logical.NOT="!";
OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:true,lowerBoundary:null,upperBoundary:null,initialize:function(options){OpenLayers.Filter.prototype.initialize.apply(this,[options]);
if(this.type===OpenLayers.Filter.Comparison.LIKE&&options.matchCase===undefined){this.matchCase=null
}},evaluate:function(context){if(context instanceof OpenLayers.Feature.Vector){context=context.attributes
}var result=false;
var got=context[this.property];
var exp;
switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:exp=this.value;
if(!this.matchCase&&typeof got=="string"&&typeof exp=="string"){result=(got.toUpperCase()==exp.toUpperCase())
}else{result=(got==exp)
}break;
case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:exp=this.value;
if(!this.matchCase&&typeof got=="string"&&typeof exp=="string"){result=(got.toUpperCase()!=exp.toUpperCase())
}else{result=(got!=exp)
}break;
case OpenLayers.Filter.Comparison.LESS_THAN:result=got<this.value;
break;
case OpenLayers.Filter.Comparison.GREATER_THAN:result=got>this.value;
break;
case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:result=got<=this.value;
break;
case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:result=got>=this.value;
break;
case OpenLayers.Filter.Comparison.BETWEEN:result=(got>=this.lowerBoundary)&&(got<=this.upperBoundary);
break;
case OpenLayers.Filter.Comparison.LIKE:var regexp=new RegExp(this.value,"gi");
result=regexp.test(got);
break
}return result
},value2regex:function(wildCard,singleChar,escapeChar){if(wildCard=="."){throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison")
}wildCard=wildCard?wildCard:"*";
singleChar=singleChar?singleChar:".";
escapeChar=escapeChar?escapeChar:"!";
this.value=this.value.replace(new RegExp("\\"+escapeChar+"(.|$)","g"),"\\$1");
this.value=this.value.replace(new RegExp("\\"+singleChar,"g"),".");
this.value=this.value.replace(new RegExp("\\"+wildCard,"g"),".*");
this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+wildCard);
this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+singleChar);
return this.value
},regex2value:function(){var value=this.value;
value=value.replace(/!/g,"!!");
value=value.replace(/(\\)?\\\./g,function($0,$1){return $1?$0:"!."
});
value=value.replace(/(\\)?\\\*/g,function($0,$1){return $1?$0:"!*"
});
value=value.replace(/\\\\/g,"\\");
value=value.replace(/\.\*/g,"*");
return value
},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison(),this)
},CLASS_NAME:"OpenLayers.Filter.Comparison"});
OpenLayers.Filter.Comparison.EQUAL_TO="==";
OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";
OpenLayers.Filter.Comparison.LESS_THAN="<";
OpenLayers.Filter.Comparison.GREATER_THAN=">";
OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";
OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";
OpenLayers.Filter.Comparison.BETWEEN="..";
OpenLayers.Filter.Comparison.LIKE="~";
OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(feature){var intersect=false;
switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(feature.geometry){var geom=this.value;
if(this.value.CLASS_NAME=="OpenLayers.Bounds"){geom=this.value.toGeometry()
}if(feature.geometry.intersects(geom)){intersect=true
}}break;
default:throw new Error("evaluate is not implemented for this filter type.")
}return intersect
},clone:function(){var options=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);
return new OpenLayers.Filter.Spatial(options)
},CLASS_NAME:"OpenLayers.Filter.Spatial"});
OpenLayers.Filter.Spatial.BBOX="BBOX";
OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";
OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";
OpenLayers.Filter.Spatial.WITHIN="WITHIN";
OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";
OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});
OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:true,defaultFilter:null,initialize:function(options){options=options||{};
OpenLayers.Util.extend(this,options);
this.options=options
},mergeWithDefaultFilter:function(filter){var merged;
if(filter&&this.defaultFilter){merged=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,filter]})
}else{merged=filter||this.defaultFilter||undefined
}return merged
},destroy:function(){this.options=null;
this.format=null
},read:function(options){options=options||{};
options.filter=this.mergeWithDefaultFilter(options.filter)
},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(response){},createCallback:function(method,response,options){return OpenLayers.Function.bind(function(){method.apply(this,[response,options])
},this)
},CLASS_NAME:"OpenLayers.Protocol"});
OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:true,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(options){OpenLayers.Util.extend(this,options)
},success:function(){return this.code>0
},CLASS_NAME:"OpenLayers.Protocol.Response"});
OpenLayers.Protocol.Response.SUCCESS=1;
OpenLayers.Protocol.Response.FAILURE=0;
OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:false,updateWithPOST:false,deleteWithPOST:false,wildcarded:false,srsInBBOX:false,initialize:function(options){options=options||{};
this.params={};
this.headers={};
OpenLayers.Protocol.prototype.initialize.apply(this,arguments);
if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var format=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});
this.filterToParams=function(filter,params){return format.write(filter,params)
}
}},destroy:function(){this.params=null;
this.headers=null;
OpenLayers.Protocol.prototype.destroy.apply(this)
},read:function(options){OpenLayers.Protocol.prototype.read.apply(this,arguments);
options=options||{};
options.params=OpenLayers.Util.applyDefaults(options.params,this.options.params);
options=OpenLayers.Util.applyDefaults(options,this.options);
if(options.filter&&this.filterToParams){options.params=this.filterToParams(options.filter,options.params)
}var readWithPOST=(options.readWithPOST!==undefined)?options.readWithPOST:this.readWithPOST;
var resp=new OpenLayers.Protocol.Response({requestType:"read"});
if(readWithPOST){var headers=options.headers||{};
headers["Content-Type"]="application/x-www-form-urlencoded";
resp.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,resp,options),data:OpenLayers.Util.getParameterString(options.params),headers:headers})
}else{resp.priv=OpenLayers.Request.GET({url:options.url,callback:this.createCallback(this.handleRead,resp,options),params:options.params,headers:options.headers})
}return resp
},handleRead:function(resp,options){this.handleResponse(resp,options)
},create:function(features,options){options=OpenLayers.Util.applyDefaults(options,this.options);
var resp=new OpenLayers.Protocol.Response({reqFeatures:features,requestType:"create"});
resp.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleCreate,resp,options),headers:options.headers,data:this.format.write(features)});
return resp
},handleCreate:function(resp,options){this.handleResponse(resp,options)
},update:function(feature,options){options=options||{};
var url=options.url||feature.url||this.options.url+"/"+feature.fid;
options=OpenLayers.Util.applyDefaults(options,this.options);
var resp=new OpenLayers.Protocol.Response({reqFeatures:feature,requestType:"update"});
var method=this.updateWithPOST?"POST":"PUT";
resp.priv=OpenLayers.Request[method]({url:url,callback:this.createCallback(this.handleUpdate,resp,options),headers:options.headers,data:this.format.write(feature)});
return resp
},handleUpdate:function(resp,options){this.handleResponse(resp,options)
},"delete":function(feature,options){options=options||{};
var url=options.url||feature.url||this.options.url+"/"+feature.fid;
options=OpenLayers.Util.applyDefaults(options,this.options);
var resp=new OpenLayers.Protocol.Response({reqFeatures:feature,requestType:"delete"});
var method=this.deleteWithPOST?"POST":"DELETE";
var requestOptions={url:url,callback:this.createCallback(this.handleDelete,resp,options),headers:options.headers};
if(this.deleteWithPOST){requestOptions.data=this.format.write(feature)
}resp.priv=OpenLayers.Request[method](requestOptions);
return resp
},handleDelete:function(resp,options){this.handleResponse(resp,options)
},handleResponse:function(resp,options){var request=resp.priv;
if(options.callback){if(request.status>=200&&request.status<300){if(resp.requestType!="delete"){resp.features=this.parseFeatures(request)
}resp.code=OpenLayers.Protocol.Response.SUCCESS
}else{resp.code=OpenLayers.Protocol.Response.FAILURE
}options.callback.call(options.scope,resp)
}},parseFeatures:function(request){var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}if(!doc||doc.length<=0){return null
}return this.format.read(doc)
},commit:function(features,options){options=OpenLayers.Util.applyDefaults(options,this.options);
var resp=[],nResponses=0;
var types={};
types[OpenLayers.State.INSERT]=[];
types[OpenLayers.State.UPDATE]=[];
types[OpenLayers.State.DELETE]=[];
var feature,list,requestFeatures=[];
for(var i=0,len=features.length;
i<len;
++i){feature=features[i];
list=types[feature.state];
if(list){list.push(feature);
requestFeatures.push(feature)
}}var nRequests=(types[OpenLayers.State.INSERT].length>0?1:0)+types[OpenLayers.State.UPDATE].length+types[OpenLayers.State.DELETE].length;
var success=true;
var finalResponse=new OpenLayers.Protocol.Response({reqFeatures:requestFeatures});
function insertCallback(response){var len=response.features?response.features.length:0;
var fids=new Array(len);
for(var i=0;
i<len;
++i){fids[i]=response.features[i].fid
}finalResponse.insertIds=fids;
callback.apply(this,[response])
}function callback(response){this.callUserCallback(response,options);
success=success&&response.success();
nResponses++;
if(nResponses>=nRequests){if(options.callback){finalResponse.code=success?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;
options.callback.apply(options.scope,[finalResponse])
}}}var queue=types[OpenLayers.State.INSERT];
if(queue.length>0){resp.push(this.create(queue,OpenLayers.Util.applyDefaults({callback:insertCallback,scope:this},options.create)))
}queue=types[OpenLayers.State.UPDATE];
for(var i=queue.length-1;
i>=0;
--i){resp.push(this.update(queue[i],OpenLayers.Util.applyDefaults({callback:callback,scope:this},options.update)))
}queue=types[OpenLayers.State.DELETE];
for(var i=queue.length-1;
i>=0;
--i){resp.push(this["delete"](queue[i],OpenLayers.Util.applyDefaults({callback:callback,scope:this},options["delete"])))
}return resp
},abort:function(response){if(response){response.priv.abort()
}},callUserCallback:function(resp,options){var opt=options[resp.requestType];
if(opt&&opt.callback){opt.callback.call(opt.scope,resp)
}},CLASS_NAME:"OpenLayers.Protocol.HTTP"});
OpenLayers.Protocol.WFS=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Protocol.WFS.DEFAULTS);
var cls=OpenLayers.Protocol.WFS["v"+options.version.replace(/\./g,"_")];
if(!cls){throw"Unsupported WFS version: "+options.version
}return new cls(options)
};
OpenLayers.Protocol.WFS.fromWMSLayer=function(layer,options){var typeName,featurePrefix;
var param=layer.params.LAYERS;
var parts=(OpenLayers.Util.isArray(param)?param[0]:param).split(":");
if(parts.length>1){featurePrefix=parts[0]
}typeName=parts.pop();
var protocolOptions={url:layer.url,featureType:typeName,featurePrefix:featurePrefix,srsName:layer.projection&&layer.projection.getCode()||layer.map&&layer.map.getProjectionObject().getCode(),version:"1.1.0"};
return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(options,protocolOptions))
};
OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};
OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(options){OpenLayers.Protocol.prototype.initialize.apply(this,[options]);
if(!options.format){this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))
}if(!options.geometryName&&parseFloat(this.format.version)>1){this.setGeometryName(null)
}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()
}this.format=null;
OpenLayers.Protocol.prototype.destroy.apply(this)
},read:function(options){OpenLayers.Protocol.prototype.read.apply(this,arguments);
options=OpenLayers.Util.extend({},options);
OpenLayers.Util.applyDefaults(options,this.options||{});
var response=new OpenLayers.Protocol.Response({requestType:"read"});
var data=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",options)]);
response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),params:options.params,headers:options.headers,data:data});
return response
},setFeatureType:function(featureType){this.featureType=featureType;
this.format.featureType=featureType
},setGeometryName:function(geometryName){this.geometryName=geometryName;
this.format.geometryName=geometryName
},handleRead:function(response,options){options=OpenLayers.Util.extend({},options);
OpenLayers.Util.applyDefaults(options,this.options);
if(options.callback){var request=response.priv;
if(request.status>=200&&request.status<300){var result=this.parseResponse(request,options.readOptions);
if(result&&result.success!==false){if(options.readOptions&&options.readOptions.output=="object"){OpenLayers.Util.extend(response,result)
}else{response.features=result
}response.code=OpenLayers.Protocol.Response.SUCCESS
}else{response.code=OpenLayers.Protocol.Response.FAILURE;
response.error=result
}}else{response.code=OpenLayers.Protocol.Response.FAILURE
}options.callback.call(options.scope,response)
}},parseResponse:function(request,options){var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}if(!doc||doc.length<=0){return null
}var result=(this.readFormat!==null)?this.readFormat.read(doc):this.format.read(doc,options);
if(!this.featureNS){var format=this.readFormat||this.format;
this.featureNS=format.featureNS;
format.autoConfig=false;
if(!this.geometryName){this.setGeometryName(format.geometryName)
}}return result
},commit:function(features,options){options=OpenLayers.Util.extend({},options);
OpenLayers.Util.applyDefaults(options,this.options);
var response=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:features});
response.priv=OpenLayers.Request.POST({url:options.url,headers:options.headers,data:this.format.write(features,options),callback:this.createCallback(this.handleCommit,response,options)});
return response
},handleCommit:function(response,options){if(options.callback){var request=response.priv;
var data=request.responseXML;
if(!data||!data.documentElement){data=request.responseText
}var obj=this.format.read(data)||{};
response.insertIds=obj.insertIds||[];
if(obj.success){response.code=OpenLayers.Protocol.Response.SUCCESS
}else{response.code=OpenLayers.Protocol.Response.FAILURE;
response.error=obj
}options.callback.call(options.scope,response)
}},filterDelete:function(filter,options){options=OpenLayers.Util.extend({},options);
OpenLayers.Util.applyDefaults(options,this.options);
var response=new OpenLayers.Protocol.Response({requestType:"commit"});
var root=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}});
var deleteNode=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(options.featureNS?this.featurePrefix+":":"")+options.featureType}});
if(options.featureNS){deleteNode.setAttribute("xmlns:"+this.featurePrefix,options.featureNS)
}var filterNode=this.format.writeNode("ogc:Filter",filter);
deleteNode.appendChild(filterNode);
root.appendChild(deleteNode);
var data=OpenLayers.Format.XML.prototype.write.apply(this.format,[root]);
return OpenLayers.Request.POST({url:this.url,callback:options.callback||function(){},data:data})
},abort:function(response){if(response){response.priv.abort()
}},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});
OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});
OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(options){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);
if(this.outputFormat&&!this.readFormat){if(this.outputFormat.toLowerCase()=="gml2"){this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName})
}else{if(this.outputFormat.toLowerCase()=="json"){this.readFormat=new OpenLayers.Format.GeoJSON()
}}}},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});
OpenLayers.Protocol.CSW=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Protocol.CSW.DEFAULTS);
var cls=OpenLayers.Protocol.CSW["v"+options.version.replace(/\./g,"_")];
if(!cls){throw"Unsupported CSW version: "+options.version
}return new cls(options)
};
OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"};
OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(options){OpenLayers.Protocol.prototype.initialize.apply(this,[options]);
if(!options.format){this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions))
}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()
}this.format=null;
OpenLayers.Protocol.prototype.destroy.apply(this)
},read:function(options){options=OpenLayers.Util.extend({},options);
OpenLayers.Util.applyDefaults(options,this.options||{});
var response=new OpenLayers.Protocol.Response({requestType:"read"});
var data=this.format.write(options.params);
response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),params:options.params,headers:options.headers,data:data});
return response
},handleRead:function(response,options){if(options.callback){var request=response.priv;
if(request.status>=200&&request.status<300){response.data=this.parseData(request);
response.code=OpenLayers.Protocol.Response.SUCCESS
}else{response.code=OpenLayers.Protocol.Response.FAILURE
}options.callback.call(options.scope,response)
}},parseData:function(request){var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}if(!doc||doc.length<=0){return null
}return this.format.read(doc)
},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"});
OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.org.geonetwork-opensource:geonetwork-client:jar:2.9.2",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:false,initialize:function(options){options=options||{};
this.params={};
this.pendingRequests={};
OpenLayers.Protocol.prototype.initialize.apply(this,arguments);
if(!this.format){this.format=new OpenLayers.Format.GeoJSON()
}if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var format=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});
this.filterToParams=function(filter,params){return format.write(filter,params)
}
}},read:function(options){OpenLayers.Protocol.prototype.read.apply(this,arguments);
options=OpenLayers.Util.applyDefaults(options,this.options);
options.params=OpenLayers.Util.applyDefaults(options.params,this.options.params);
if(options.filter&&this.filterToParams){options.params=this.filterToParams(options.filter,options.params)
}var response=new OpenLayers.Protocol.Response({requestType:"read"});
var request=this.createRequest(options.url,options.params,OpenLayers.Function.bind(function(data){response.data=data;
this.handleRead(response,options)
},this));
response.priv=request;
return response
},createRequest:function(url,params,callback){var id=OpenLayers.Protocol.Script.register(callback);
var name=OpenLayers.String.format(this.callbackTemplate,{id:id});
params=OpenLayers.Util.extend({},params);
params[this.callbackKey]=this.callbackPrefix+name;
url=OpenLayers.Util.urlAppend(url,OpenLayers.Util.getParameterString(params));
var script=document.createElement("script");
script.type="text/javascript";
script.src=url;
script.id="OpenLayers_Protocol_Script_"+id;
this.pendingRequests[script.id]=script;
var head=document.getElementsByTagName("head")[0];
head.appendChild(script);
return script
},destroyRequest:function(script){OpenLayers.Protocol.Script.unregister(script.id.split("_").pop());
delete this.pendingRequests[script.id];
if(script.parentNode){script.parentNode.removeChild(script)
}},handleRead:function(response,options){this.handleResponse(response,options)
},handleResponse:function(response,options){if(options.callback){if(response.data){response.features=this.parseFeatures(response.data);
response.code=OpenLayers.Protocol.Response.SUCCESS
}else{response.code=OpenLayers.Protocol.Response.FAILURE
}this.destroyRequest(response.priv);
options.callback.call(options.scope,response)
}},parseFeatures:function(data){return this.format.read(data)
},abort:function(response){if(response){this.destroyRequest(response.priv)
}else{for(var key in this.pendingRequests){this.destroyRequest(this.pendingRequests[key])
}}},destroy:function(){this.abort();
delete this.params;
delete this.format;
OpenLayers.Protocol.prototype.destroy.apply(this)
},CLASS_NAME:"OpenLayers.Protocol.Script"});
(function(){var o=OpenLayers.Protocol.Script;
var counter=0;
o.registry={};
o.register=function(callback){var id="c"+(++counter);
o.registry[id]=function(){callback.apply(this,arguments)
};
return id
};
o.unregister=function(id){delete o.registry[id]
}
})();
OpenLayers.Protocol.SOS=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Protocol.SOS.DEFAULTS);
var cls=OpenLayers.Protocol.SOS["v"+options.version.replace(/\./g,"_")];
if(!cls){throw"Unsupported SOS version: "+options.version
}return new cls(options)
};
OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"};
OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(options){OpenLayers.Protocol.prototype.initialize.apply(this,[options]);
if(!options.format){this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions)
}},destroy:function(){if(this.options&&!this.options.format){this.format.destroy()
}this.format=null;
OpenLayers.Protocol.prototype.destroy.apply(this)
},read:function(options){options=OpenLayers.Util.extend({},options);
OpenLayers.Util.applyDefaults(options,this.options||{});
var response=new OpenLayers.Protocol.Response({requestType:"read"});
var format=this.format;
var data=OpenLayers.Format.XML.prototype.write.apply(format,[format.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);
response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),data:data});
return response
},handleRead:function(response,options){if(options.callback){var request=response.priv;
if(request.status>=200&&request.status<300){response.features=this.parseFeatures(request);
response.code=OpenLayers.Protocol.Response.SUCCESS
}else{response.code=OpenLayers.Protocol.Response.FAILURE
}options.callback.call(options.scope,response)
}},parseFeatures:function(request){var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}if(!doc||doc.length<=0){return null
}return this.format.read(doc)
},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"});
OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(pointFeatures,options){if(pointFeatures.length<2){throw new Error("At least two point features have to be added to create a line from")
}var lines=new Array(pointFeatures.length-1);
var pointFeature,startPoint,endPoint;
for(var i=0,len=pointFeatures.length;
i<len;
i++){pointFeature=pointFeatures[i];
endPoint=pointFeature.geometry;
if(!endPoint){var lonlat=pointFeature.lonlat;
endPoint=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat)
}else{if(endPoint.CLASS_NAME!="OpenLayers.Geometry.Point"){throw new TypeError("Only features with point geometries are supported.")
}}if(i>0){var attributes=(this.dataFrom!=null)?(pointFeatures[i+this.dataFrom].data||pointFeatures[i+this.dataFrom].attributes):null;
var style=(this.styleFrom!=null)?(pointFeatures[i+this.styleFrom].style):null;
var line=new OpenLayers.Geometry.LineString([startPoint,endPoint]);
lines[i-1]=new OpenLayers.Feature.Vector(line,attributes,style)
}startPoint=endPoint
}this.addFeatures(lines,options)
},CLASS_NAME:"OpenLayers.Layer.PointTrack"});
OpenLayers.Layer.PointTrack.SOURCE_NODE=-1;
OpenLayers.Layer.PointTrack.TARGET_NODE=0;
OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0};
OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:false,propertyStyles:null,initialize:function(style,options){OpenLayers.Util.extend(this,options);
this.rules=[];
if(options&&options.rules){this.addRules(options.rules)
}this.setDefaultStyle(style||OpenLayers.Feature.Vector.style["default"]);
this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){for(var i=0,len=this.rules.length;
i<len;
i++){this.rules[i].destroy();
this.rules[i]=null
}this.rules=null;
this.defaultStyle=null
},createSymbolizer:function(feature){var style=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),feature);
var rules=this.rules;
var rule,context;
var elseRules=[];
var appliedRules=false;
for(var i=0,len=rules.length;
i<len;
i++){rule=rules[i];
var applies=rule.evaluate(feature);
if(applies){if(rule instanceof OpenLayers.Rule&&rule.elseFilter){elseRules.push(rule)
}else{appliedRules=true;
this.applySymbolizer(rule,style,feature)
}}}if(appliedRules==false&&elseRules.length>0){appliedRules=true;
for(var i=0,len=elseRules.length;
i<len;
i++){this.applySymbolizer(elseRules[i],style,feature)
}}if(rules.length>0&&appliedRules==false){style.display="none"
}if(style.label!=null&&typeof style.label!=="string"){style.label=String(style.label)
}return style
},applySymbolizer:function(rule,style,feature){var symbolizerPrefix=feature.geometry?this.getSymbolizerPrefix(feature.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0];
var symbolizer=rule.symbolizer[symbolizerPrefix]||rule.symbolizer;
if(this.defaultsPerSymbolizer===true){var defaults=this.defaultStyle;
OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:defaults.pointRadius});
if(symbolizer.stroke===true||symbolizer.graphic===true){OpenLayers.Util.applyDefaults(symbolizer,{strokeWidth:defaults.strokeWidth,strokeColor:defaults.strokeColor,strokeOpacity:defaults.strokeOpacity,strokeDashstyle:defaults.strokeDashstyle,strokeLinecap:defaults.strokeLinecap})
}if(symbolizer.fill===true||symbolizer.graphic===true){OpenLayers.Util.applyDefaults(symbolizer,{fillColor:defaults.fillColor,fillOpacity:defaults.fillOpacity})
}if(symbolizer.graphic===true){OpenLayers.Util.applyDefaults(symbolizer,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})
}}return this.createLiterals(OpenLayers.Util.extend(style,symbolizer),feature)
},createLiterals:function(style,feature){var context=OpenLayers.Util.extend({},feature.attributes||feature.data);
OpenLayers.Util.extend(context,this.context);
for(var i in this.propertyStyles){style[i]=OpenLayers.Style.createLiteral(style[i],context,feature,i)
}return style
},findPropertyStyles:function(){var propertyStyles={};
var style=this.defaultStyle;
this.addPropertyStyles(propertyStyles,style);
var rules=this.rules;
var symbolizer,value;
for(var i=0,len=rules.length;
i<len;
i++){symbolizer=rules[i].symbolizer;
for(var key in symbolizer){value=symbolizer[key];
if(typeof value=="object"){this.addPropertyStyles(propertyStyles,value)
}else{this.addPropertyStyles(propertyStyles,symbolizer);
break
}}}return propertyStyles
},addPropertyStyles:function(propertyStyles,symbolizer){var property;
for(var key in symbolizer){property=symbolizer[key];
if(typeof property=="string"&&property.match(/\$\{\w+\}/)){propertyStyles[key]=true
}}return propertyStyles
},addRules:function(rules){Array.prototype.push.apply(this.rules,rules);
this.propertyStyles=this.findPropertyStyles()
},setDefaultStyle:function(style){this.defaultStyle=style;
this.propertyStyles=this.findPropertyStyles()
},getSymbolizerPrefix:function(geometry){var prefixes=OpenLayers.Style.SYMBOLIZER_PREFIXES;
for(var i=0,len=prefixes.length;
i<len;
i++){if(geometry.CLASS_NAME.indexOf(prefixes[i])!=-1){return prefixes[i]
}}},clone:function(){var options=OpenLayers.Util.extend({},this);
if(this.rules){options.rules=[];
for(var i=0,len=this.rules.length;
i<len;
++i){options.rules.push(this.rules[i].clone())
}}options.context=this.context&&OpenLayers.Util.extend({},this.context);
var defaultStyle=OpenLayers.Util.extend({},this.defaultStyle);
return new OpenLayers.Style(defaultStyle,options)
},CLASS_NAME:"OpenLayers.Style"});
OpenLayers.Style.createLiteral=function(value,context,feature,property){if(typeof value=="string"&&value.indexOf("${")!=-1){value=OpenLayers.String.format(value,context,[feature,property]);
value=(isNaN(value)||!value)?value:parseFloat(value)
}return value
};
OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];
OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:false,rules:null,initialize:function(config){OpenLayers.Util.extend(this,config);
this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){for(var i=0,len=this.rules.length;
i<len;
i++){this.rules[i].destroy()
}delete this.rules
},clone:function(){var config=OpenLayers.Util.extend({},this);
if(this.rules){config.rules=[];
for(var i=0,len=this.rules.length;
i<len;
++i){config.rules.push(this.rules[i].clone())
}}return new OpenLayers.Style2(config)
},CLASS_NAME:"OpenLayers.Style2"});
OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:true,initialize:function(style,options){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};
if(style instanceof OpenLayers.Style){this.styles["default"]=style;
this.styles.select=style;
this.styles.temporary=style;
this.styles["delete"]=style
}else{if(typeof style=="object"){for(var key in style){if(style[key] instanceof OpenLayers.Style){this.styles[key]=style[key]
}else{if(typeof style[key]=="object"){this.styles[key]=new OpenLayers.Style(style[key])
}else{this.styles["default"]=new OpenLayers.Style(style);
this.styles.select=new OpenLayers.Style(style);
this.styles.temporary=new OpenLayers.Style(style);
this.styles["delete"]=new OpenLayers.Style(style);
break
}}}}}OpenLayers.Util.extend(this,options)
},destroy:function(){for(var key in this.styles){this.styles[key].destroy()
}this.styles=null
},createSymbolizer:function(feature,intent){if(!feature){feature=new OpenLayers.Feature.Vector()
}if(!this.styles[intent]){intent="default"
}feature.renderIntent=intent;
var defaultSymbolizer={};
if(this.extendDefault&&intent!="default"){defaultSymbolizer=this.styles["default"].createSymbolizer(feature)
}return OpenLayers.Util.extend(defaultSymbolizer,this.styles[intent].createSymbolizer(feature))
},addUniqueValueRules:function(renderIntent,property,symbolizers,context){var rules=[];
for(var value in symbolizers){rules.push(new OpenLayers.Rule({symbolizer:symbolizers[value],context:context,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:property,value:value})}))
}this.styles[renderIntent].addRules(rules)
},CLASS_NAME:"OpenLayers.StyleMap"});
OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:false,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(options){this.symbolizer={};
OpenLayers.Util.extend(this,options);
if(this.symbolizers){delete this.symbolizer
}this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},destroy:function(){for(var i in this.symbolizer){this.symbolizer[i]=null
}this.symbolizer=null;
delete this.symbolizers
},evaluate:function(feature){var context=this.getContext(feature);
var applies=true;
if(this.minScaleDenominator||this.maxScaleDenominator){var scale=feature.layer.map.getScale()
}if(this.minScaleDenominator){applies=scale>=OpenLayers.Style.createLiteral(this.minScaleDenominator,context)
}if(applies&&this.maxScaleDenominator){applies=scale<OpenLayers.Style.createLiteral(this.maxScaleDenominator,context)
}if(applies&&this.filter){if(this.filter.CLASS_NAME=="OpenLayers.Filter.FeatureId"){applies=this.filter.evaluate(feature)
}else{applies=this.filter.evaluate(context)
}}return applies
},getContext:function(feature){var context=this.context;
if(!context){context=feature.attributes||feature.data
}if(typeof this.context=="function"){context=this.context(feature)
}return context
},clone:function(){var options=OpenLayers.Util.extend({},this);
if(this.symbolizers){var len=this.symbolizers.length;
options.symbolizers=new Array(len);
for(var i=0;
i<len;
++i){options.symbolizers[i]=this.symbolizers[i].clone()
}}else{options.symbolizer={};
var value,type;
for(var key in this.symbolizer){value=this.symbolizer[key];
type=typeof value;
if(type==="object"){options.symbolizer[key]=OpenLayers.Util.extend({},value)
}else{if(type==="string"){options.symbolizer[key]=value
}}}}options.filter=this.filter&&this.filter.clone();
options.context=this.context&&OpenLayers.Util.extend({},this.context);
return new OpenLayers.Rule(options)
},CLASS_NAME:"OpenLayers.Rule"});
OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:false,initialize:function(options){OpenLayers.Util.extend(this,options);
this.options=options
},destroy:function(){},read:function(data){throw new Error("Read not implemented.")
},write:function(object){throw new Error("Write not implemented.")
},CLASS_NAME:"OpenLayers.Format"});
OpenLayers.Format.QueryStringFilter=(function(){var cmpToStr={};
cmpToStr[OpenLayers.Filter.Comparison.EQUAL_TO]="eq";
cmpToStr[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne";
cmpToStr[OpenLayers.Filter.Comparison.LESS_THAN]="lt";
cmpToStr[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte";
cmpToStr[OpenLayers.Filter.Comparison.GREATER_THAN]="gt";
cmpToStr[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte";
cmpToStr[OpenLayers.Filter.Comparison.LIKE]="ilike";
function regex2value(value){value=value.replace(/%/g,"\\%");
value=value.replace(/\\\\\.(\*)?/g,function($0,$1){return $1?$0:"\\\\_"
});
value=value.replace(/\\\\\.\*/g,"\\\\%");
value=value.replace(/(\\)?\.(\*)?/g,function($0,$1,$2){return $1||$2?$0:"_"
});
value=value.replace(/(\\)?\.\*/g,function($0,$1){return $1?$0:"%"
});
value=value.replace(/\\\./g,".");
value=value.replace(/(\\)?\\\*/g,function($0,$1){return $1?$0:"*"
});
return value
}return OpenLayers.Class(OpenLayers.Format,{wildcarded:false,srsInBBOX:false,write:function(filter,params){params=params||{};
var className=filter.CLASS_NAME;
var filterType=className.substring(className.lastIndexOf(".")+1);
switch(filterType){case"Spatial":switch(filter.type){case OpenLayers.Filter.Spatial.BBOX:params.bbox=filter.value.toArray();
if(this.srsInBBOX&&filter.projection){params.bbox.push(filter.projection.getCode())
}break;
case OpenLayers.Filter.Spatial.DWITHIN:params.tolerance=filter.distance;
case OpenLayers.Filter.Spatial.WITHIN:params.lon=filter.value.x;
params.lat=filter.value.y;
break;
default:OpenLayers.Console.warn("Unknown spatial filter type "+filter.type)
}break;
case"Comparison":var op=cmpToStr[filter.type];
if(op!==undefined){var value=filter.value;
if(filter.type==OpenLayers.Filter.Comparison.LIKE){value=regex2value(value);
if(this.wildcarded){value="%"+value+"%"
}}params[filter.property+"__"+op]=value;
params.queryable=params.queryable||[];
params.queryable.push(filter.property)
}else{OpenLayers.Console.warn("Unknown comparison filter type "+filter.type)
}break;
case"Logical":if(filter.type===OpenLayers.Filter.Logical.AND){for(var i=0,len=filter.filters.length;
i<len;
i++){params=this.write(filter.filters[i],params)
}}else{OpenLayers.Console.warn("Unsupported logical filter type "+filter.type)
}break;
default:OpenLayers.Console.warn("Unknown filter type "+filterType)
}return params
},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})
})();
OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(options){if(window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")
}OpenLayers.Format.prototype.initialize.apply(this,[options]);
this.namespaces=OpenLayers.Util.extend({},this.namespaces);
this.namespaceAlias={};
for(var alias in this.namespaces){this.namespaceAlias[this.namespaces[alias]]=alias
}},destroy:function(){this.xmldom=null;
OpenLayers.Format.prototype.destroy.apply(this,arguments)
},setNamespace:function(alias,uri){this.namespaces[alias]=uri;
this.namespaceAlias[uri]=alias
},read:function(text){var index=text.indexOf("<");
if(index>0){text=text.substring(index)
}var node=OpenLayers.Util.Try(OpenLayers.Function.bind((function(){var xmldom;
if(window.ActiveXObject&&!this.xmldom){xmldom=new ActiveXObject("Microsoft.XMLDOM")
}else{xmldom=this.xmldom
}xmldom.loadXML(text);
return xmldom
}),this),function(){return new DOMParser().parseFromString(text,"text/xml")
},function(){var req=new XMLHttpRequest();
req.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(text),false);
if(req.overrideMimeType){req.overrideMimeType("text/xml")
}req.send(null);
return req.responseXML
});
if(this.keepData){this.data=node
}return node
},write:function(node){var data;
if(this.xmldom){data=node.xml
}else{var serializer=new XMLSerializer();
if(node.nodeType==1){var doc=document.implementation.createDocument("","",null);
if(doc.importNode){node=doc.importNode(node,true)
}doc.appendChild(node);
data=serializer.serializeToString(doc)
}else{data=serializer.serializeToString(node)
}}return data
},createElementNS:function(uri,name){var element;
if(this.xmldom){if(typeof uri=="string"){element=this.xmldom.createNode(1,name,uri)
}else{element=this.xmldom.createNode(1,name,"")
}}else{element=document.createElementNS(uri,name)
}return element
},createTextNode:function(text){var node;
if(typeof text!=="string"){text=String(text)
}if(this.xmldom){node=this.xmldom.createTextNode(text)
}else{node=document.createTextNode(text)
}return node
},getElementsByTagNameNS:function(node,uri,name){var elements=[];
if(node.getElementsByTagNameNS){elements=node.getElementsByTagNameNS(uri,name)
}else{var allNodes=node.getElementsByTagName("*");
var potentialNode,fullName;
for(var i=0,len=allNodes.length;
i<len;
++i){potentialNode=allNodes[i];
fullName=(potentialNode.prefix)?(potentialNode.prefix+":"+name):name;
if((name=="*")||(fullName==potentialNode.nodeName)){if((uri=="*")||(uri==potentialNode.namespaceURI)){elements.push(potentialNode)
}}}}return elements
},getAttributeNodeNS:function(node,uri,name){var attributeNode=null;
if(node.getAttributeNodeNS){attributeNode=node.getAttributeNodeNS(uri,name)
}else{var attributes=node.attributes;
var potentialNode,fullName;
for(var i=0,len=attributes.length;
i<len;
++i){potentialNode=attributes[i];
if(potentialNode.namespaceURI==uri){fullName=(potentialNode.prefix)?(potentialNode.prefix+":"+name):name;
if(fullName==potentialNode.nodeName){attributeNode=potentialNode;
break
}}}}return attributeNode
},getAttributeNS:function(node,uri,name){var attributeValue="";
if(node.getAttributeNS){attributeValue=node.getAttributeNS(uri,name)||""
}else{var attributeNode=this.getAttributeNodeNS(node,uri,name);
if(attributeNode){attributeValue=attributeNode.nodeValue
}}return attributeValue
},getChildValue:function(node,def){var value=def||"";
if(node){for(var child=node.firstChild;
child;
child=child.nextSibling){switch(child.nodeType){case 3:case 4:value+=child.nodeValue
}}}return value
},isSimpleContent:function(node){var simple=true;
for(var child=node.firstChild;
child;
child=child.nextSibling){if(child.nodeType===1){simple=false;
break
}}return simple
},contentType:function(node){var simple=false,complex=false;
var type=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY;
for(var child=node.firstChild;
child;
child=child.nextSibling){switch(child.nodeType){case 1:complex=true;
break;
case 8:break;
default:simple=true
}if(complex&&simple){break
}}if(complex&&simple){type=OpenLayers.Format.XML.CONTENT_TYPE.MIXED
}else{if(complex){return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX
}else{if(simple){return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE
}}}return type
},hasAttributeNS:function(node,uri,name){var found=false;
if(node.hasAttributeNS){found=node.hasAttributeNS(uri,name)
}else{found=!!this.getAttributeNodeNS(node,uri,name)
}return found
},setAttributeNS:function(node,uri,name,value){if(node.setAttributeNS){node.setAttributeNS(uri,name,value)
}else{if(this.xmldom){if(uri){var attribute=node.ownerDocument.createNode(2,name,uri);
attribute.nodeValue=value;
node.setAttributeNode(attribute)
}else{node.setAttribute(name,value)
}}else{throw"setAttributeNS not implemented"
}}},createElementNSPlus:function(name,options){options=options||{};
var uri=options.uri||this.namespaces[options.prefix];
if(!uri){var loc=name.indexOf(":");
uri=this.namespaces[name.substring(0,loc)]
}if(!uri){uri=this.namespaces[this.defaultPrefix]
}var node=this.createElementNS(uri,name);
if(options.attributes){this.setAttributes(node,options.attributes)
}var value=options.value;
if(value!=null){node.appendChild(this.createTextNode(value))
}return node
},setAttributes:function(node,obj){var value,uri;
for(var name in obj){if(obj[name]!=null&&obj[name].toString){value=obj[name].toString();
uri=this.namespaces[name.substring(0,name.indexOf(":"))]||null;
this.setAttributeNS(node,uri,name,value)
}}},readNode:function(node,obj){if(!obj){obj={}
}var group=this.readers[node.namespaceURI?this.namespaceAlias[node.namespaceURI]:this.defaultPrefix];
if(group){var local=node.localName||node.nodeName.split(":").pop();
var reader=group[local]||group["*"];
if(reader){reader.apply(this,[node,obj])
}}return obj
},readChildNodes:function(node,obj){if(!obj){obj={}
}var children=node.childNodes;
var child;
for(var i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType==1){this.readNode(child,obj)
}}return obj
},writeNode:function(name,obj,parent){var prefix,local;
var split=name.indexOf(":");
if(split>0){prefix=name.substring(0,split);
local=name.substring(split+1)
}else{if(parent){prefix=this.namespaceAlias[parent.namespaceURI]
}else{prefix=this.defaultPrefix
}local=name
}var child=this.writers[prefix][local].apply(this,[obj]);
if(parent){parent.appendChild(child)
}return child
},getChildEl:function(node,name,uri){return node&&this.getThisOrNextEl(node.firstChild,name,uri)
},getNextEl:function(node,name,uri){return node&&this.getThisOrNextEl(node.nextSibling,name,uri)
},getThisOrNextEl:function(node,name,uri){outer:for(var sibling=node;
sibling;
sibling=sibling.nextSibling){switch(sibling.nodeType){case 1:if((!name||name===(sibling.localName||sibling.nodeName.split(":").pop()))&&(!uri||uri===sibling.namespaceURI)){break outer
}sibling=null;
break outer;
case 3:if(/^\s*$/.test(sibling.nodeValue)){break
}case 4:case 6:case 12:case 10:case 11:sibling=null;
break outer
}}return sibling||null
},lookupNamespaceURI:function(node,prefix){var uri=null;
if(node){if(node.lookupNamespaceURI){uri=node.lookupNamespaceURI(prefix)
}else{outer:switch(node.nodeType){case 1:if(node.namespaceURI!==null&&node.prefix===prefix){uri=node.namespaceURI;
break outer
}var len=node.attributes.length;
if(len){var attr;
for(var i=0;
i<len;
++i){attr=node.attributes[i];
if(attr.prefix==="xmlns"&&attr.name==="xmlns:"+prefix){uri=attr.value||null;
break outer
}else{if(attr.name==="xmlns"&&prefix===null){uri=attr.value||null;
break outer
}}}}uri=this.lookupNamespaceURI(node.parentNode,prefix);
break outer;
case 2:uri=this.lookupNamespaceURI(node.ownerElement,prefix);
break outer;
case 9:uri=this.lookupNamespaceURI(node.documentElement,prefix);
break outer;
case 6:case 12:case 10:case 11:break outer;
default:uri=this.lookupNamespaceURI(node.parentNode,prefix);
break outer
}}}return uri
},getXMLDoc:function(){if(!OpenLayers.Format.XML.document&&!this.xmldom){if(document.implementation&&document.implementation.createDocument){OpenLayers.Format.XML.document=document.implementation.createDocument("","",null)
}else{if(!this.xmldom&&window.ActiveXObject){this.xmldom=new ActiveXObject("Microsoft.XMLDOM")
}}}return OpenLayers.Format.XML.document||this.xmldom
},CLASS_NAME:"OpenLayers.Format.XML"});
OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};
OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);
OpenLayers.Format.XML.document=null;
OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,errorProperty:null,name:null,stringifyOutput:false,parser:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);
var className=this.CLASS_NAME;
this.name=className.substring(className.lastIndexOf(".")+1)
},getVersion:function(root,options){var version;
if(root){version=this.version;
if(!version){version=root.getAttribute("version");
if(!version){version=this.defaultVersion
}}}else{version=(options&&options.version)||this.version||this.defaultVersion
}return version
},getParser:function(version){version=version||this.defaultVersion;
var profile=this.profile?"_"+this.profile:"";
if(!this.parser||this.parser.VERSION!=version){var format=OpenLayers.Format[this.name]["v"+version.replace(/\./g,"_")+profile];
if(!format){throw"Can't find a "+this.name+" parser for version "+version+profile
}this.parser=new format(this.options)
}return this.parser
},write:function(obj,options){var version=this.getVersion(null,options);
this.parser=this.getParser(version);
var root=this.parser.write(obj,options);
if(this.stringifyOutput===false){return root
}else{return OpenLayers.Format.XML.prototype.write.apply(this,[root])
}},read:function(data,options){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var root=data.documentElement;
var version=this.getVersion(root);
this.parser=this.getParser(version);
var obj=this.parser.read(data,options);
if(this.errorProperty!==null&&obj[this.errorProperty]===undefined){var format=new OpenLayers.Format.OGCExceptionReport();
obj.error=format.read(data)
}obj.version=version;
return obj
},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});
OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(data,options){var context=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);
var map;
if(options&&options.map){this.context=context;
if(options.map instanceof OpenLayers.Map){map=this.mergeContextToMap(context,options.map)
}else{var mapOptions=options.map;
if(OpenLayers.Util.isElement(mapOptions)||typeof mapOptions=="string"){mapOptions={div:mapOptions}
}map=this.contextToMap(context,mapOptions)
}}else{map=context
}return map
},getLayerFromContext:function(layerContext){var i,len;
var options={queryable:layerContext.queryable,visibility:layerContext.visibility,maxExtent:layerContext.maxExtent,metadata:OpenLayers.Util.applyDefaults(layerContext.metadata,{styles:layerContext.styles,formats:layerContext.formats,"abstract":layerContext["abstract"],dataURL:layerContext.dataURL}),numZoomLevels:layerContext.numZoomLevels,units:layerContext.units,isBaseLayer:layerContext.isBaseLayer,opacity:layerContext.opacity,displayInLayerSwitcher:layerContext.displayInLayerSwitcher,singleTile:layerContext.singleTile,tileSize:(layerContext.tileSize)?new OpenLayers.Size(layerContext.tileSize.width,layerContext.tileSize.height):undefined,minScale:layerContext.minScale||layerContext.maxScaleDenominator,maxScale:layerContext.maxScale||layerContext.minScaleDenominator,srs:layerContext.srs,dimensions:layerContext.dimensions,metadataURL:layerContext.metadataURL};
if(this.layerOptions){OpenLayers.Util.applyDefaults(options,this.layerOptions)
}var params={layers:layerContext.name,transparent:layerContext.transparent,version:layerContext.version};
if(layerContext.formats&&layerContext.formats.length>0){params.format=layerContext.formats[0].value;
for(i=0,len=layerContext.formats.length;
i<len;
i++){var format=layerContext.formats[i];
if(format.current==true){params.format=format.value;
break
}}}if(layerContext.styles&&layerContext.styles.length>0){for(i=0,len=layerContext.styles.length;
i<len;
i++){var style=layerContext.styles[i];
if(style.current==true){if(style.href){params.sld=style.href
}else{if(style.body){params.sld_body=style.body
}else{params.styles=style.name
}}break
}}}if(this.layerParams){OpenLayers.Util.applyDefaults(params,this.layerParams)
}var layer=null;
var service=layerContext.service;
if(service==OpenLayers.Format.Context.serviceTypes.WFS){options.strategies=[new OpenLayers.Strategy.BBOX()];
options.protocol=new OpenLayers.Protocol.WFS({url:layerContext.url,featurePrefix:layerContext.name.split(":")[0],featureType:layerContext.name.split(":").pop()});
layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options)
}else{if(service==OpenLayers.Format.Context.serviceTypes.KML){options.strategies=[new OpenLayers.Strategy.Fixed()];
options.protocol=new OpenLayers.Protocol.HTTP({url:layerContext.url,format:new OpenLayers.Format.KML()});
layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options)
}else{if(service==OpenLayers.Format.Context.serviceTypes.GML){options.strategies=[new OpenLayers.Strategy.Fixed()];
options.protocol=new OpenLayers.Protocol.HTTP({url:layerContext.url,format:new OpenLayers.Format.GML()});
layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options)
}else{if(layerContext.features){layer=new OpenLayers.Layer.Vector(layerContext.title||layerContext.name,options);
layer.addFeatures(layerContext.features)
}else{if(layerContext.categoryLayer!==true){layer=new OpenLayers.Layer.WMS(layerContext.title||layerContext.name,layerContext.url,params,options)
}}}}}return layer
},getLayersFromContext:function(layersContext){var layers=[];
for(var i=0,len=layersContext.length;
i<len;
i++){var layer=this.getLayerFromContext(layersContext[i]);
if(layer!==null){layers.push(layer)
}}return layers
},contextToMap:function(context,options){options=OpenLayers.Util.applyDefaults({maxExtent:context.maxExtent,projection:context.projection,units:context.units},options);
if(options.maxExtent){options.maxResolution=options.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH
}var metadata={contactInformation:context.contactInformation,"abstract":context["abstract"],keywords:context.keywords,logo:context.logo,descriptionURL:context.descriptionURL};
options.metadata=metadata;
var map=new OpenLayers.Map(options);
map.addLayers(this.getLayersFromContext(context.layersContext));
map.setCenter(context.bounds.getCenterLonLat(),map.getZoomForExtent(context.bounds,true));
return map
},mergeContextToMap:function(context,map){map.addLayers(this.getLayersFromContext(context.layersContext));
return map
},write:function(obj,options){obj=this.toContext(obj);
return OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Format.Context"});
OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"};
OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(options){this.request=new OpenLayers.Format.ArcXML.Request();
this.response=new OpenLayers.Format.ArcXML.Response();
if(options){if(options.requesttype=="feature"){this.request.get_image=null;
var qry=this.request.get_feature.query;
this.addCoordSys(qry.featurecoordsys,options.featureCoordSys);
this.addCoordSys(qry.filtercoordsys,options.filterCoordSys);
if(options.polygon){qry.isspatial=true;
qry.spatialfilter.polygon=options.polygon
}else{if(options.envelope){qry.isspatial=true;
qry.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0};
this.parseEnvelope(qry.spatialfilter.envelope,options.envelope)
}}}else{if(options.requesttype=="image"){this.request.get_feature=null;
var props=this.request.get_image.properties;
this.parseEnvelope(props.envelope,options.envelope);
this.addLayers(props.layerlist,options.layers);
this.addImageSize(props.imagesize,options.tileSize);
this.addCoordSys(props.featurecoordsys,options.featureCoordSys);
this.addCoordSys(props.filtercoordsys,options.filterCoordSys)
}else{this.request=null
}}}OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},parseEnvelope:function(env,arr){if(arr&&arr.length==4){env.minx=arr[0];
env.miny=arr[1];
env.maxx=arr[2];
env.maxy=arr[3]
}},addLayers:function(ll,lyrs){for(var lind=0,len=lyrs.length;
lind<len;
lind++){ll.push(lyrs[lind])
}},addImageSize:function(imsize,olsize){if(olsize!==null){imsize.width=olsize.w;
imsize.height=olsize.h;
imsize.printwidth=olsize.w;
imsize.printheight=olsize.h
}},addCoordSys:function(featOrFilt,fsys){if(typeof fsys=="string"){featOrFilt.id=parseInt(fsys);
featOrFilt.string=fsys
}else{if(typeof fsys=="object"&&fsys.proj!==null){featOrFilt.id=fsys.proj.srsProjNumber;
featOrFilt.string=fsys.proj.srsCode
}else{featOrFilt=fsys
}}},iserror:function(data){var ret=null;
if(!data){ret=(this.response.error!=="")
}else{data=OpenLayers.Format.XML.prototype.read.apply(this,[data]);
var errorNodes=data.documentElement.getElementsByTagName("ERROR");
ret=(errorNodes!==null&&errorNodes.length>0)
}return ret
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var arcNode=null;
if(data&&data.documentElement){if(data.documentElement.nodeName=="ARCXML"){arcNode=data.documentElement
}else{arcNode=data.documentElement.getElementsByTagName("ARCXML")[0]
}}if(!arcNode||arcNode.firstChild.nodeName==="parsererror"){var error,source;
try{error=data.firstChild.nodeValue;
source=data.firstChild.childNodes[1].firstChild.nodeValue
}catch(err){}throw {message:"Error parsing the ArcXML request",error:error,source:source}
}var response=this.parseResponse(arcNode);
return response
},write:function(request){if(!request){request=this.request
}var root=this.createElementNS("","ARCXML");
root.setAttribute("version","1.1");
var reqElem=this.createElementNS("","REQUEST");
if(request.get_image!=null){var getElem=this.createElementNS("","GET_IMAGE");
reqElem.appendChild(getElem);
var propElem=this.createElementNS("","PROPERTIES");
getElem.appendChild(propElem);
var props=request.get_image.properties;
if(props.featurecoordsys!=null){var feat=this.createElementNS("","FEATURECOORDSYS");
propElem.appendChild(feat);
if(props.featurecoordsys.id===0){feat.setAttribute("string",props.featurecoordsys.string)
}else{feat.setAttribute("id",props.featurecoordsys.id)
}}if(props.filtercoordsys!=null){var filt=this.createElementNS("","FILTERCOORDSYS");
propElem.appendChild(filt);
if(props.filtercoordsys.id===0){filt.setAttribute("string",props.filtercoordsys.string)
}else{filt.setAttribute("id",props.filtercoordsys.id)
}}if(props.envelope!=null){var env=this.createElementNS("","ENVELOPE");
propElem.appendChild(env);
env.setAttribute("minx",props.envelope.minx);
env.setAttribute("miny",props.envelope.miny);
env.setAttribute("maxx",props.envelope.maxx);
env.setAttribute("maxy",props.envelope.maxy)
}var imagesz=this.createElementNS("","IMAGESIZE");
propElem.appendChild(imagesz);
imagesz.setAttribute("height",props.imagesize.height);
imagesz.setAttribute("width",props.imagesize.width);
if(props.imagesize.height!=props.imagesize.printheight||props.imagesize.width!=props.imagesize.printwidth){imagesz.setAttribute("printheight",props.imagesize.printheight);
imagesz.setArrtibute("printwidth",props.imagesize.printwidth)
}if(props.background!=null){var backgrnd=this.createElementNS("","BACKGROUND");
propElem.appendChild(backgrnd);
backgrnd.setAttribute("color",props.background.color.r+","+props.background.color.g+","+props.background.color.b);
if(props.background.transcolor!==null){backgrnd.setAttribute("transcolor",props.background.transcolor.r+","+props.background.transcolor.g+","+props.background.transcolor.b)
}}if(props.layerlist!=null&&props.layerlist.length>0){var layerlst=this.createElementNS("","LAYERLIST");
propElem.appendChild(layerlst);
for(var ld=0;
ld<props.layerlist.length;
ld++){var ldef=this.createElementNS("","LAYERDEF");
layerlst.appendChild(ldef);
ldef.setAttribute("id",props.layerlist[ld].id);
ldef.setAttribute("visible",props.layerlist[ld].visible);
if(typeof props.layerlist[ld].query=="object"){var query=props.layerlist[ld].query;
if(query.where.length<0){continue
}var queryElem=null;
if(typeof query.spatialfilter=="boolean"&&query.spatialfilter){queryElem=this.createElementNS("","SPATIALQUERY")
}else{queryElem=this.createElementNS("","QUERY")
}queryElem.setAttribute("where",query.where);
if(typeof query.accuracy=="number"&&query.accuracy>0){queryElem.setAttribute("accuracy",query.accuracy)
}if(typeof query.featurelimit=="number"&&query.featurelimit<2000){queryElem.setAttribute("featurelimit",query.featurelimit)
}if(typeof query.subfields=="string"&&query.subfields!="#ALL#"){queryElem.setAttribute("subfields",query.subfields)
}if(typeof query.joinexpression=="string"&&query.joinexpression.length>0){queryElem.setAttribute("joinexpression",query.joinexpression)
}if(typeof query.jointables=="string"&&query.jointables.length>0){queryElem.setAttribute("jointables",query.jointables)
}ldef.appendChild(queryElem)
}if(typeof props.layerlist[ld].renderer=="object"){this.addRenderer(ldef,props.layerlist[ld].renderer)
}}}}else{if(request.get_feature!=null){var getElem=this.createElementNS("","GET_FEATURES");
getElem.setAttribute("outputmode","newxml");
getElem.setAttribute("checkesc","true");
if(request.get_feature.geometry){getElem.setAttribute("geometry",request.get_feature.geometry)
}else{getElem.setAttribute("geometry","false")
}if(request.get_feature.compact){getElem.setAttribute("compact",request.get_feature.compact)
}if(request.get_feature.featurelimit=="number"){getElem.setAttribute("featurelimit",request.get_feature.featurelimit)
}getElem.setAttribute("globalenvelope","true");
reqElem.appendChild(getElem);
if(request.get_feature.layer!=null&&request.get_feature.layer.length>0){var lyrElem=this.createElementNS("","LAYER");
lyrElem.setAttribute("id",request.get_feature.layer);
getElem.appendChild(lyrElem)
}var fquery=request.get_feature.query;
if(fquery!=null){var qElem=null;
if(fquery.isspatial){qElem=this.createElementNS("","SPATIALQUERY")
}else{qElem=this.createElementNS("","QUERY")
}getElem.appendChild(qElem);
if(typeof fquery.accuracy=="number"){qElem.setAttribute("accuracy",fquery.accuracy)
}if(fquery.featurecoordsys!=null){var fcsElem1=this.createElementNS("","FEATURECOORDSYS");
if(fquery.featurecoordsys.id==0){fcsElem1.setAttribute("string",fquery.featurecoordsys.string)
}else{fcsElem1.setAttribute("id",fquery.featurecoordsys.id)
}qElem.appendChild(fcsElem1)
}if(fquery.filtercoordsys!=null){var fcsElem2=this.createElementNS("","FILTERCOORDSYS");
if(fquery.filtercoordsys.id===0){fcsElem2.setAttribute("string",fquery.filtercoordsys.string)
}else{fcsElem2.setAttribute("id",fquery.filtercoordsys.id)
}qElem.appendChild(fcsElem2)
}if(fquery.buffer>0){var bufElem=this.createElementNS("","BUFFER");
bufElem.setAttribute("distance",fquery.buffer);
qElem.appendChild(bufElem)
}if(fquery.isspatial){var spfElem=this.createElementNS("","SPATIALFILTER");
spfElem.setAttribute("relation",fquery.spatialfilter.relation);
qElem.appendChild(spfElem);
if(fquery.spatialfilter.envelope){var envElem=this.createElementNS("","ENVELOPE");
envElem.setAttribute("minx",fquery.spatialfilter.envelope.minx);
envElem.setAttribute("miny",fquery.spatialfilter.envelope.miny);
envElem.setAttribute("maxx",fquery.spatialfilter.envelope.maxx);
envElem.setAttribute("maxy",fquery.spatialfilter.envelope.maxy);
spfElem.appendChild(envElem)
}else{if(typeof fquery.spatialfilter.polygon=="object"){spfElem.appendChild(this.writePolygonGeometry(fquery.spatialfilter.polygon))
}}}if(fquery.where!=null&&fquery.where.length>0){qElem.setAttribute("where",fquery.where)
}}}}root.appendChild(reqElem);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},addGroupRenderer:function(ldef,toprenderer){var topRelem=this.createElementNS("","GROUPRENDERER");
ldef.appendChild(topRelem);
for(var rind=0;
rind<toprenderer.length;
rind++){var renderer=toprenderer[rind];
this.addRenderer(topRelem,renderer)
}},addRenderer:function(topRelem,renderer){if(OpenLayers.Util.isArray(renderer)){this.addGroupRenderer(topRelem,renderer)
}else{var renderElem=this.createElementNS("",renderer.type.toUpperCase()+"RENDERER");
topRelem.appendChild(renderElem);
if(renderElem.tagName=="VALUEMAPRENDERER"){this.addValueMapRenderer(renderElem,renderer)
}else{if(renderElem.tagName=="VALUEMAPLABELRENDERER"){this.addValueMapLabelRenderer(renderElem,renderer)
}else{if(renderElem.tagName=="SIMPLELABELRENDERER"){this.addSimpleLabelRenderer(renderElem,renderer)
}else{if(renderElem.tagName=="SCALEDEPENDENTRENDERER"){this.addScaleDependentRenderer(renderElem,renderer)
}}}}}},addScaleDependentRenderer:function(renderElem,renderer){if(typeof renderer.lower=="string"||typeof renderer.lower=="number"){renderElem.setAttribute("lower",renderer.lower)
}if(typeof renderer.upper=="string"||typeof renderer.upper=="number"){renderElem.setAttribute("upper",renderer.upper)
}this.addRenderer(renderElem,renderer.renderer)
},addValueMapLabelRenderer:function(renderElem,renderer){renderElem.setAttribute("lookupfield",renderer.lookupfield);
renderElem.setAttribute("labelfield",renderer.labelfield);
if(typeof renderer.exacts=="object"){for(var ext=0,extlen=renderer.exacts.length;
ext<extlen;
ext++){var exact=renderer.exacts[ext];
var eelem=this.createElementNS("","EXACT");
if(typeof exact.value=="string"){eelem.setAttribute("value",exact.value)
}if(typeof exact.label=="string"){eelem.setAttribute("label",exact.label)
}if(typeof exact.method=="string"){eelem.setAttribute("method",exact.method)
}renderElem.appendChild(eelem);
if(typeof exact.symbol=="object"){var selem=null;
if(exact.symbol.type=="text"){selem=this.createElementNS("","TEXTSYMBOL")
}if(selem!=null){var keys=this.fontStyleKeys;
for(var i=0,len=keys.length;
i<len;
i++){var key=keys[i];
if(exact.symbol[key]){selem.setAttribute(key,exact.symbol[key])
}}eelem.appendChild(selem)
}}}}},addValueMapRenderer:function(renderElem,renderer){renderElem.setAttribute("lookupfield",renderer.lookupfield);
if(typeof renderer.ranges=="object"){for(var rng=0,rnglen=renderer.ranges.length;
rng<rnglen;
rng++){var range=renderer.ranges[rng];
var relem=this.createElementNS("","RANGE");
relem.setAttribute("lower",range.lower);
relem.setAttribute("upper",range.upper);
renderElem.appendChild(relem);
if(typeof range.symbol=="object"){var selem=null;
if(range.symbol.type=="simplepolygon"){selem=this.createElementNS("","SIMPLEPOLYGONSYMBOL")
}if(selem!=null){if(typeof range.symbol.boundarycolor=="string"){selem.setAttribute("boundarycolor",range.symbol.boundarycolor)
}if(typeof range.symbol.fillcolor=="string"){selem.setAttribute("fillcolor",range.symbol.fillcolor)
}if(typeof range.symbol.filltransparency=="number"){selem.setAttribute("filltransparency",range.symbol.filltransparency)
}relem.appendChild(selem)
}}}}else{if(typeof renderer.exacts=="object"){for(var ext=0,extlen=renderer.exacts.length;
ext<extlen;
ext++){var exact=renderer.exacts[ext];
var eelem=this.createElementNS("","EXACT");
if(typeof exact.value=="string"){eelem.setAttribute("value",exact.value)
}if(typeof exact.label=="string"){eelem.setAttribute("label",exact.label)
}if(typeof exact.method=="string"){eelem.setAttribute("method",exact.method)
}renderElem.appendChild(eelem);
if(typeof exact.symbol=="object"){var selem=null;
if(exact.symbol.type=="simplemarker"){selem=this.createElementNS("","SIMPLEMARKERSYMBOL")
}if(selem!=null){if(typeof exact.symbol.antialiasing=="string"){selem.setAttribute("antialiasing",exact.symbol.antialiasing)
}if(typeof exact.symbol.color=="string"){selem.setAttribute("color",exact.symbol.color)
}if(typeof exact.symbol.outline=="string"){selem.setAttribute("outline",exact.symbol.outline)
}if(typeof exact.symbol.overlap=="string"){selem.setAttribute("overlap",exact.symbol.overlap)
}if(typeof exact.symbol.shadow=="string"){selem.setAttribute("shadow",exact.symbol.shadow)
}if(typeof exact.symbol.transparency=="number"){selem.setAttribute("transparency",exact.symbol.transparency)
}if(typeof exact.symbol.usecentroid=="string"){selem.setAttribute("usecentroid",exact.symbol.usecentroid)
}if(typeof exact.symbol.width=="number"){selem.setAttribute("width",exact.symbol.width)
}eelem.appendChild(selem)
}}}}}},addSimpleLabelRenderer:function(renderElem,renderer){renderElem.setAttribute("field",renderer.field);
var keys=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"];
for(var i=0,len=keys.length;
i<len;
i++){var key=keys[i];
if(renderer[key]){renderElem.setAttribute(key,renderer[key])
}}if(renderer.symbol.type=="text"){var symbol=renderer.symbol;
var selem=this.createElementNS("","TEXTSYMBOL");
renderElem.appendChild(selem);
var keys=this.fontStyleKeys;
for(var i=0,len=keys.length;
i<len;
i++){var key=keys[i];
if(symbol[key]){selem.setAttribute(key,renderer[key])
}}}},writePolygonGeometry:function(polygon){if(!(polygon instanceof OpenLayers.Geometry.Polygon)){throw {message:"Cannot write polygon geometry to ArcXML with an "+polygon.CLASS_NAME+" object.",geometry:polygon}
}var polyElem=this.createElementNS("","POLYGON");
for(var ln=0,lnlen=polygon.components.length;
ln<lnlen;
ln++){var ring=polygon.components[ln];
var ringElem=this.createElementNS("","RING");
for(var rn=0,rnlen=ring.components.length;
rn<rnlen;
rn++){var point=ring.components[rn];
var pointElem=this.createElementNS("","POINT");
pointElem.setAttribute("x",point.x);
pointElem.setAttribute("y",point.y);
ringElem.appendChild(pointElem)
}polyElem.appendChild(ringElem)
}return polyElem
},parseResponse:function(data){if(typeof data=="string"){var newData=new OpenLayers.Format.XML();
data=newData.read(data)
}var response=new OpenLayers.Format.ArcXML.Response();
var errorNode=data.getElementsByTagName("ERROR");
if(errorNode!=null&&errorNode.length>0){response.error=this.getChildValue(errorNode,"Unknown error.")
}else{var responseNode=data.getElementsByTagName("RESPONSE");
if(responseNode==null||responseNode.length==0){response.error="No RESPONSE tag found in ArcXML response.";
return response
}var rtype=responseNode[0].firstChild.nodeName;
if(rtype=="#text"){rtype=responseNode[0].firstChild.nextSibling.nodeName
}if(rtype=="IMAGE"){var envelopeNode=data.getElementsByTagName("ENVELOPE");
var outputNode=data.getElementsByTagName("OUTPUT");
if(envelopeNode==null||envelopeNode.length==0){response.error="No ENVELOPE tag found in ArcXML response."
}else{if(outputNode==null||outputNode.length==0){response.error="No OUTPUT tag found in ArcXML response."
}else{var envAttr=this.parseAttributes(envelopeNode[0]);
var outputAttr=this.parseAttributes(outputNode[0]);
if(typeof outputAttr.type=="string"){response.image={envelope:envAttr,output:{type:outputAttr.type,data:this.getChildValue(outputNode[0])}}
}else{response.image={envelope:envAttr,output:outputAttr}
}}}}else{if(rtype=="FEATURES"){var features=responseNode[0].getElementsByTagName("FEATURES");
var featureCount=features[0].getElementsByTagName("FEATURECOUNT");
response.features.featurecount=featureCount[0].getAttribute("count");
if(response.features.featurecount>0){var envelope=features[0].getElementsByTagName("ENVELOPE");
response.features.envelope=this.parseAttributes(envelope[0],typeof(0));
var featureList=features[0].getElementsByTagName("FEATURE");
for(var fn=0;
fn<featureList.length;
fn++){var feature=new OpenLayers.Feature.Vector();
var fields=featureList[fn].getElementsByTagName("FIELD");
for(var fdn=0;
fdn<fields.length;
fdn++){var fieldName=fields[fdn].getAttribute("name");
var fieldValue=fields[fdn].getAttribute("value");
feature.attributes[fieldName]=fieldValue
}var geom=featureList[fn].getElementsByTagName("POLYGON");
if(geom.length>0){var ring=geom[0].getElementsByTagName("RING");
var polys=[];
for(var rn=0;
rn<ring.length;
rn++){var linearRings=[];
linearRings.push(this.parsePointGeometry(ring[rn]));
var holes=ring[rn].getElementsByTagName("HOLE");
for(var hn=0;
hn<holes.length;
hn++){linearRings.push(this.parsePointGeometry(holes[hn]))
}holes=null;
polys.push(new OpenLayers.Geometry.Polygon(linearRings));
linearRings=null
}ring=null;
if(polys.length==1){feature.geometry=polys[0]
}else{feature.geometry=new OpenLayers.Geometry.MultiPolygon(polys)
}}response.features.feature.push(feature)
}}}else{response.error="Unidentified response type."
}}}return response
},parseAttributes:function(node,type){var attributes={};
for(var attr=0;
attr<node.attributes.length;
attr++){if(type=="number"){attributes[node.attributes[attr].nodeName]=parseFloat(node.attributes[attr].nodeValue)
}else{attributes[node.attributes[attr].nodeName]=node.attributes[attr].nodeValue
}}return attributes
},parsePointGeometry:function(node){var ringPoints=[];
var coords=node.getElementsByTagName("COORDS");
if(coords.length>0){var coordArr=this.getChildValue(coords[0]);
coordArr=coordArr.split(/;/);
for(var cn=0;
cn<coordArr.length;
cn++){var coordItems=coordArr[cn].split(/ /);
ringPoints.push(new OpenLayers.Geometry.Point(coordItems[0],coordItems[1]))
}coords=null
}else{var point=node.getElementsByTagName("POINT");
if(point.length>0){for(var pn=0;
pn<point.length;
pn++){ringPoints.push(new OpenLayers.Geometry.Point(parseFloat(point[pn].getAttribute("x")),parseFloat(point[pn].getAttribute("y"))))
}}point=null
}return new OpenLayers.Geometry.LinearRing(ringPoints)
},CLASS_NAME:"OpenLayers.Format.ArcXML"});
OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(params){var defaults={get_image:{properties:{background:null,draw:true,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:false},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:false,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};
return OpenLayers.Util.extend(this,defaults)
},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"});
OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(params){var defaults={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};
return OpenLayers.Util.extend(this,defaults)
},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"});
OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(data){var axl=new OpenLayers.Format.ArcXML();
var parsed=axl.read(data);
return parsed.features.feature
}});
OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:true,xy:true,initialize:function(options){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)};
OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var featureNodes=this.getElementsByTagNameNS(data.documentElement,this.gmlns,this.featureName);
var features=[];
for(var i=0;
i<featureNodes.length;
i++){var feature=this.parseFeature(featureNodes[i]);
if(feature){features.push(feature)
}}return features
},parseFeature:function(node){var order=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"];
var type,nodeList,geometry,parser;
for(var i=0;
i<order.length;
++i){type=order[i];
nodeList=this.getElementsByTagNameNS(node,this.gmlns,type);
if(nodeList.length>0){parser=this.parseGeometry[type.toLowerCase()];
if(parser){geometry=parser.apply(this,[nodeList[0]]);
if(this.internalProjection&&this.externalProjection){geometry.transform(this.externalProjection,this.internalProjection)
}}else{throw new TypeError("Unsupported geometry type: "+type)
}break
}}var bounds;
var boxNodes=this.getElementsByTagNameNS(node,this.gmlns,"Box");
for(i=0;
i<boxNodes.length;
++i){var boxNode=boxNodes[i];
var box=this.parseGeometry.box.apply(this,[boxNode]);
var parentNode=boxNode.parentNode;
var parentName=parentNode.localName||parentNode.nodeName.split(":").pop();
if(parentName==="boundedBy"){bounds=box
}else{geometry=box.toGeometry()
}}var attributes;
if(this.extractAttributes){attributes=this.parseAttributes(node)
}var feature=new OpenLayers.Feature.Vector(geometry,attributes);
feature.bounds=bounds;
feature.gml={featureType:node.firstChild.nodeName.split(":")[1],featureNS:node.firstChild.namespaceURI,featureNSPrefix:node.firstChild.prefix};
var childNode=node.firstChild;
var fid;
while(childNode){if(childNode.nodeType==1){fid=childNode.getAttribute("fid")||childNode.getAttribute("id");
if(fid){break
}}childNode=childNode.nextSibling
}feature.fid=fid;
return feature
},parseGeometry:{point:function(node){var nodeList,coordString;
var coords=[];
var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"pos");
if(nodeList.length>0){coordString=nodeList[0].firstChild.nodeValue;
coordString=coordString.replace(this.regExes.trimSpace,"");
coords=coordString.split(this.regExes.splitSpace)
}if(coords.length==0){nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates");
if(nodeList.length>0){coordString=nodeList[0].firstChild.nodeValue;
coordString=coordString.replace(this.regExes.removeSpace,"");
coords=coordString.split(",")
}}if(coords.length==0){nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coord");
if(nodeList.length>0){var xList=this.getElementsByTagNameNS(nodeList[0],this.gmlns,"X");
var yList=this.getElementsByTagNameNS(nodeList[0],this.gmlns,"Y");
if(xList.length>0&&yList.length>0){coords=[xList[0].firstChild.nodeValue,yList[0].firstChild.nodeValue]
}}}if(coords.length==2){coords[2]=null
}if(this.xy){return new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{return new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}},multipoint:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"Point");
var components=[];
if(nodeList.length>0){var point;
for(var i=0;
i<nodeList.length;
++i){point=this.parseGeometry.point.apply(this,[nodeList[i]]);
if(point){components.push(point)
}}}return new OpenLayers.Geometry.MultiPoint(components)
},linestring:function(node,ring){var nodeList,coordString;
var coords=[];
var points=[];
nodeList=this.getElementsByTagNameNS(node,this.gmlns,"posList");
if(nodeList.length>0){coordString=this.getChildValue(nodeList[0]);
coordString=coordString.replace(this.regExes.trimSpace,"");
coords=coordString.split(this.regExes.splitSpace);
var dim=parseInt(nodeList[0].getAttribute("dimension"));
var j,x,y,z;
for(var i=0;
i<coords.length/dim;
++i){j=i*dim;
x=coords[j];
y=coords[j+1];
z=(dim==2)?null:coords[j+2];
if(this.xy){points.push(new OpenLayers.Geometry.Point(x,y,z))
}else{points.push(new OpenLayers.Geometry.Point(y,x,z))
}}}if(coords.length==0){nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates");
if(nodeList.length>0){coordString=this.getChildValue(nodeList[0]);
coordString=coordString.replace(this.regExes.trimSpace,"");
coordString=coordString.replace(this.regExes.trimComma,",");
var pointList=coordString.split(this.regExes.splitSpace);
for(var i=0;
i<pointList.length;
++i){coords=pointList[i].split(",");
if(coords.length==2){coords[2]=null
}if(this.xy){points.push(new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2]))
}else{points.push(new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2]))
}}}}var line=null;
if(points.length!=0){if(ring){line=new OpenLayers.Geometry.LinearRing(points)
}else{line=new OpenLayers.Geometry.LineString(points)
}}return line
},multilinestring:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"LineString");
var components=[];
if(nodeList.length>0){var line;
for(var i=0;
i<nodeList.length;
++i){line=this.parseGeometry.linestring.apply(this,[nodeList[i]]);
if(line){components.push(line)
}}}return new OpenLayers.Geometry.MultiLineString(components)
},polygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"LinearRing");
var components=[];
if(nodeList.length>0){var ring;
for(var i=0;
i<nodeList.length;
++i){ring=this.parseGeometry.linestring.apply(this,[nodeList[i],true]);
if(ring){components.push(ring)
}}}return new OpenLayers.Geometry.Polygon(components)
},multipolygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"Polygon");
var components=[];
if(nodeList.length>0){var polygon;
for(var i=0;
i<nodeList.length;
++i){polygon=this.parseGeometry.polygon.apply(this,[nodeList[i]]);
if(polygon){components.push(polygon)
}}}return new OpenLayers.Geometry.MultiPolygon(components)
},envelope:function(node){var components=[];
var coordString;
var envelope;
var lpoint=this.getElementsByTagNameNS(node,this.gmlns,"lowerCorner");
if(lpoint.length>0){var coords=[];
if(lpoint.length>0){coordString=lpoint[0].firstChild.nodeValue;
coordString=coordString.replace(this.regExes.trimSpace,"");
coords=coordString.split(this.regExes.splitSpace)
}if(coords.length==2){coords[2]=null
}if(this.xy){var lowerPoint=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{var lowerPoint=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}}var upoint=this.getElementsByTagNameNS(node,this.gmlns,"upperCorner");
if(upoint.length>0){var coords=[];
if(upoint.length>0){coordString=upoint[0].firstChild.nodeValue;
coordString=coordString.replace(this.regExes.trimSpace,"");
coords=coordString.split(this.regExes.splitSpace)
}if(coords.length==2){coords[2]=null
}if(this.xy){var upperPoint=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{var upperPoint=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}}if(lowerPoint&&upperPoint){components.push(new OpenLayers.Geometry.Point(lowerPoint.x,lowerPoint.y));
components.push(new OpenLayers.Geometry.Point(upperPoint.x,lowerPoint.y));
components.push(new OpenLayers.Geometry.Point(upperPoint.x,upperPoint.y));
components.push(new OpenLayers.Geometry.Point(lowerPoint.x,upperPoint.y));
components.push(new OpenLayers.Geometry.Point(lowerPoint.x,lowerPoint.y));
var ring=new OpenLayers.Geometry.LinearRing(components);
envelope=new OpenLayers.Geometry.Polygon([ring])
}return envelope
},box:function(node){var nodeList=this.getElementsByTagNameNS(node,this.gmlns,"coordinates");
var coordString;
var coords,beginPoint=null,endPoint=null;
if(nodeList.length>0){coordString=nodeList[0].firstChild.nodeValue;
coords=coordString.split(" ");
if(coords.length==2){beginPoint=coords[0].split(",");
endPoint=coords[1].split(",")
}}if(beginPoint!==null&&endPoint!==null){return new OpenLayers.Bounds(parseFloat(beginPoint[0]),parseFloat(beginPoint[1]),parseFloat(endPoint[0]),parseFloat(endPoint[1]))
}}},parseAttributes:function(node){var attributes={};
var childNode=node.firstChild;
var children,i,child,grandchildren,grandchild,name,value;
while(childNode){if(childNode.nodeType==1){children=childNode.childNodes;
for(i=0;
i<children.length;
++i){child=children[i];
if(child.nodeType==1){grandchildren=child.childNodes;
if(grandchildren.length==1){grandchild=grandchildren[0];
if(grandchild.nodeType==3||grandchild.nodeType==4){name=(child.prefix)?child.nodeName.split(":")[1]:child.nodeName;
value=grandchild.nodeValue.replace(this.regExes.trimSpace,"");
attributes[name]=value
}}else{attributes[child.nodeName.split(":").pop()]=null
}}}break
}childNode=childNode.nextSibling
}return attributes
},write:function(features){if(!(OpenLayers.Util.isArray(features))){features=[features]
}var gml=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName);
for(var i=0;
i<features.length;
i++){gml.appendChild(this.createFeatureXML(features[i]))
}return OpenLayers.Format.XML.prototype.write.apply(this,[gml])
},createFeatureXML:function(feature){var geometry=feature.geometry;
var geometryNode=this.buildGeometryNode(geometry);
var geomContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);
geomContainer.appendChild(geometryNode);
var featureNode=this.createElementNS(this.gmlns,"gml:"+this.featureName);
var featureContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);
var fid=feature.fid||feature.id;
featureContainer.setAttribute("fid",fid);
featureContainer.appendChild(geomContainer);
for(var attr in feature.attributes){var attrText=this.createTextNode(feature.attributes[attr]);
var nodename=attr.substring(attr.lastIndexOf(":")+1);
var attrContainer=this.createElementNS(this.featureNS,this.featurePrefix+":"+nodename);
attrContainer.appendChild(attrText);
featureContainer.appendChild(attrContainer)
}featureNode.appendChild(featureContainer);
return featureNode
},buildGeometryNode:function(geometry){if(this.externalProjection&&this.internalProjection){geometry=geometry.clone();
geometry.transform(this.internalProjection,this.externalProjection)
}var className=geometry.CLASS_NAME;
var type=className.substring(className.lastIndexOf(".")+1);
var builder=this.buildGeometry[type.toLowerCase()];
return builder.apply(this,[geometry])
},buildGeometry:{point:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:Point");
gml.appendChild(this.buildCoordinatesNode(geometry));
return gml
},multipoint:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:MultiPoint");
var points=geometry.components;
var pointMember,pointGeom;
for(var i=0;
i<points.length;
i++){pointMember=this.createElementNS(this.gmlns,"gml:pointMember");
pointGeom=this.buildGeometry.point.apply(this,[points[i]]);
pointMember.appendChild(pointGeom);
gml.appendChild(pointMember)
}return gml
},linestring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:LineString");
gml.appendChild(this.buildCoordinatesNode(geometry));
return gml
},multilinestring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:MultiLineString");
var lines=geometry.components;
var lineMember,lineGeom;
for(var i=0;
i<lines.length;
++i){lineMember=this.createElementNS(this.gmlns,"gml:lineStringMember");
lineGeom=this.buildGeometry.linestring.apply(this,[lines[i]]);
lineMember.appendChild(lineGeom);
gml.appendChild(lineMember)
}return gml
},linearring:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:LinearRing");
gml.appendChild(this.buildCoordinatesNode(geometry));
return gml
},polygon:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:Polygon");
var rings=geometry.components;
var ringMember,ringGeom,type;
for(var i=0;
i<rings.length;
++i){type=(i==0)?"outerBoundaryIs":"innerBoundaryIs";
ringMember=this.createElementNS(this.gmlns,"gml:"+type);
ringGeom=this.buildGeometry.linearring.apply(this,[rings[i]]);
ringMember.appendChild(ringGeom);
gml.appendChild(ringMember)
}return gml
},multipolygon:function(geometry){var gml=this.createElementNS(this.gmlns,"gml:MultiPolygon");
var polys=geometry.components;
var polyMember,polyGeom;
for(var i=0;
i<polys.length;
++i){polyMember=this.createElementNS(this.gmlns,"gml:polygonMember");
polyGeom=this.buildGeometry.polygon.apply(this,[polys[i]]);
polyMember.appendChild(polyGeom);
gml.appendChild(polyMember)
}return gml
},bounds:function(bounds){var gml=this.createElementNS(this.gmlns,"gml:Box");
gml.appendChild(this.buildCoordinatesNode(bounds));
return gml
}},buildCoordinatesNode:function(geometry){var coordinatesNode=this.createElementNS(this.gmlns,"gml:coordinates");
coordinatesNode.setAttribute("decimal",".");
coordinatesNode.setAttribute("cs",",");
coordinatesNode.setAttribute("ts"," ");
var parts=[];
if(geometry instanceof OpenLayers.Bounds){parts.push(geometry.left+","+geometry.bottom);
parts.push(geometry.right+","+geometry.top)
}else{var points=(geometry.components)?geometry.components:[geometry];
for(var i=0;
i<points.length;
i++){parts.push(points[i].x+","+points[i].y)
}}var txtNode=this.createTextNode(parts.join(" "));
coordinatesNode.appendChild(txtNode);
return coordinatesNode
},CLASS_NAME:"OpenLayers.Format.GML"});
if(!OpenLayers.Format.GML){OpenLayers.Format.GML={}
}OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:true,srsName:null,xy:true,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),featureMember:(/^(.*:)?featureMembers?$/)},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);
this.setGeometryTypes();
if(options&&options.featureNS){this.setNamespace("feature",options.featureNS)
}this.singleFeatureType=!options||(typeof options.featureType==="string")
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var features=[];
this.readNode(data,{features:features},true);
if(features.length==0){var elements=this.getElementsByTagNameNS(data,this.namespaces.gml,"featureMember");
if(elements.length){for(var i=0,len=elements.length;
i<len;
++i){this.readNode(elements[i],{features:features},true)
}}else{var elements=this.getElementsByTagNameNS(data,this.namespaces.gml,"featureMembers");
if(elements.length){this.readNode(elements[0],{features:features},true)
}}}return features
},readNode:function(node,obj,first){if(first===true&&this.autoConfig===true){this.featureType=null;
delete this.namespaceAlias[this.featureNS];
delete this.namespaces.feature;
this.featureNS=null
}if(!this.featureNS&&(!(node.prefix in this.namespaces)&&node.parentNode.namespaceURI==this.namespaces.gml&&this.regExes.featureMember.test(node.parentNode.nodeName))){this.featureType=node.nodeName.split(":").pop();
this.setNamespace("feature",node.namespaceURI);
this.featureNS=node.namespaceURI;
this.autoConfig=true
}return OpenLayers.Format.XML.prototype.readNode.apply(this,[node,obj])
},readers:{gml:{featureMember:function(node,obj){this.readChildNodes(node,obj)
},featureMembers:function(node,obj){this.readChildNodes(node,obj)
},name:function(node,obj){obj.name=this.getChildValue(node)
},boundedBy:function(node,obj){var container={};
this.readChildNodes(node,container);
if(container.components&&container.components.length>0){obj.bounds=container.components[0]
}},Point:function(node,container){var obj={points:[]};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}container.components.push(obj.points[0])
},coordinates:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
str=str.replace(this.regExes.trimComma,",");
var pointList=str.split(this.regExes.splitSpace);
var coords;
var numPoints=pointList.length;
var points=new Array(numPoints);
for(var i=0;
i<numPoints;
++i){coords=pointList[i].split(",");
if(this.xy){points[i]=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{points[i]=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}}obj.points=points
},coord:function(node,obj){var coord={};
this.readChildNodes(node,coord);
if(!obj.points){obj.points=[]
}obj.points.push(new OpenLayers.Geometry.Point(coord.x,coord.y,coord.z))
},X:function(node,coord){coord.x=this.getChildValue(node)
},Y:function(node,coord){coord.y=this.getChildValue(node)
},Z:function(node,coord){coord.z=this.getChildValue(node)
},MultiPoint:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
container.components=[new OpenLayers.Geometry.MultiPoint(obj.components)]
},pointMember:function(node,obj){this.readChildNodes(node,obj)
},LineString:function(node,container){var obj={};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}container.components.push(new OpenLayers.Geometry.LineString(obj.points))
},MultiLineString:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
container.components=[new OpenLayers.Geometry.MultiLineString(obj.components)]
},lineStringMember:function(node,obj){this.readChildNodes(node,obj)
},Polygon:function(node,container){var obj={outer:null,inner:[]};
this.readChildNodes(node,obj);
obj.inner.unshift(obj.outer);
if(!container.components){container.components=[]
}container.components.push(new OpenLayers.Geometry.Polygon(obj.inner))
},LinearRing:function(node,obj){var container={};
this.readChildNodes(node,container);
obj.components=[new OpenLayers.Geometry.LinearRing(container.points)]
},MultiPolygon:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
container.components=[new OpenLayers.Geometry.MultiPolygon(obj.components)]
},polygonMember:function(node,obj){this.readChildNodes(node,obj)
},GeometryCollection:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
container.components=[new OpenLayers.Geometry.Collection(obj.components)]
},geometryMember:function(node,obj){this.readChildNodes(node,obj)
}},feature:{"*":function(node,obj){var name;
var local=node.localName||node.nodeName.split(":").pop();
if(obj.features){if(!this.singleFeatureType&&(OpenLayers.Util.indexOf(this.featureType,local)!==-1)){name="_typeName"
}else{if(local===this.featureType){name="_typeName"
}}}else{if(node.childNodes.length==0||(node.childNodes.length==1&&node.firstChild.nodeType==3)){if(this.extractAttributes){name="_attribute"
}}else{name="_geometry"
}}if(name){this.readers.feature[name].apply(this,[node,obj])
}},_typeName:function(node,obj){var container={components:[],attributes:{}};
this.readChildNodes(node,container);
if(container.name){container.attributes.name=container.name
}var feature=new OpenLayers.Feature.Vector(container.components[0],container.attributes);
if(!this.singleFeatureType){feature.type=node.nodeName.split(":").pop();
feature.namespace=node.namespaceURI
}var fid=node.getAttribute("fid")||this.getAttributeNS(node,this.namespaces.gml,"id");
if(fid){feature.fid=fid
}if(this.internalProjection&&this.externalProjection&&feature.geometry){feature.geometry.transform(this.externalProjection,this.internalProjection)
}if(container.bounds){feature.bounds=container.bounds
}obj.features.push(feature)
},_geometry:function(node,obj){if(!this.geometryName){this.geometryName=node.nodeName.split(":").pop()
}this.readChildNodes(node,obj)
},_attribute:function(node,obj){var local=node.localName||node.nodeName.split(":").pop();
var value=this.getChildValue(node);
obj.attributes[local]=value
}},wfs:{FeatureCollection:function(node,obj){this.readChildNodes(node,obj)
}}},write:function(features){var name;
if(OpenLayers.Util.isArray(features)){name="featureMembers"
}else{name="featureMember"
}var root=this.writeNode("gml:"+name,features);
this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},writers:{gml:{featureMember:function(feature){var node=this.createElementNSPlus("gml:featureMember");
this.writeNode("feature:_typeName",feature,node);
return node
},MultiPoint:function(geometry){var node=this.createElementNSPlus("gml:MultiPoint");
var components=geometry.components||[geometry];
for(var i=0,ii=components.length;
i<ii;
++i){this.writeNode("pointMember",components[i],node)
}return node
},pointMember:function(geometry){var node=this.createElementNSPlus("gml:pointMember");
this.writeNode("Point",geometry,node);
return node
},MultiLineString:function(geometry){var node=this.createElementNSPlus("gml:MultiLineString");
var components=geometry.components||[geometry];
for(var i=0,ii=components.length;
i<ii;
++i){this.writeNode("lineStringMember",components[i],node)
}return node
},lineStringMember:function(geometry){var node=this.createElementNSPlus("gml:lineStringMember");
this.writeNode("LineString",geometry,node);
return node
},MultiPolygon:function(geometry){var node=this.createElementNSPlus("gml:MultiPolygon");
var components=geometry.components||[geometry];
for(var i=0,ii=components.length;
i<ii;
++i){this.writeNode("polygonMember",components[i],node)
}return node
},polygonMember:function(geometry){var node=this.createElementNSPlus("gml:polygonMember");
this.writeNode("Polygon",geometry,node);
return node
},GeometryCollection:function(geometry){var node=this.createElementNSPlus("gml:GeometryCollection");
for(var i=0,len=geometry.components.length;
i<len;
++i){this.writeNode("geometryMember",geometry.components[i],node)
}return node
},geometryMember:function(geometry){var node=this.createElementNSPlus("gml:geometryMember");
var child=this.writeNode("feature:_geometry",geometry);
node.appendChild(child.firstChild);
return node
}},feature:{_typeName:function(feature){var node=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:feature.fid}});
if(feature.geometry){this.writeNode("feature:_geometry",feature.geometry,node)
}for(var name in feature.attributes){var value=feature.attributes[name];
if(value!=null){this.writeNode("feature:_attribute",{name:name,value:value},node)
}}return node
},_geometry:function(geometry){if(this.externalProjection&&this.internalProjection){geometry=geometry.clone().transform(this.internalProjection,this.externalProjection)
}var node=this.createElementNSPlus("feature:"+this.geometryName);
var type=this.geometryTypes[geometry.CLASS_NAME];
var child=this.writeNode("gml:"+type,geometry,node);
if(this.srsName){child.setAttribute("srsName",this.srsName)
}return node
},_attribute:function(obj){return this.createElementNSPlus("feature:"+obj.name,{value:obj.value})
}},wfs:{FeatureCollection:function(features){var node=this.createElementNSPlus("wfs:FeatureCollection");
for(var i=0,len=features.length;
i<len;
++i){this.writeNode("gml:featureMember",features[i],node)
}return node
}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}
},CLASS_NAME:"OpenLayers.Format.GML.Base"});
OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(options){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[options])
},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(node,container){var obj={};
this.readChildNodes(node,obj);
container.outer=obj.components[0]
},innerBoundaryIs:function(node,container){var obj={};
this.readChildNodes(node,obj);
container.inner.push(obj.components[0])
},Box:function(node,container){var obj={};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}var min=obj.points[0];
var max=obj.points[1];
container.components.push(new OpenLayers.Bounds(min.x,min.y,max.x,max.y))
}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(features){var name;
if(OpenLayers.Util.isArray(features)){name="wfs:FeatureCollection"
}else{name="gml:featureMember"
}var root=this.writeNode(name,features);
this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(geometry){var node=this.createElementNSPlus("gml:Point");
this.writeNode("coordinates",[geometry],node);
return node
},coordinates:function(points){var numPoints=points.length;
var parts=new Array(numPoints);
var point;
for(var i=0;
i<numPoints;
++i){point=points[i];
if(this.xy){parts[i]=point.x+","+point.y
}else{parts[i]=point.y+","+point.x
}if(point.z!=undefined){parts[i]+=","+point.z
}}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:(numPoints==1)?parts[0]:parts.join(" ")})
},LineString:function(geometry){var node=this.createElementNSPlus("gml:LineString");
this.writeNode("coordinates",geometry.components,node);
return node
},Polygon:function(geometry){var node=this.createElementNSPlus("gml:Polygon");
this.writeNode("outerBoundaryIs",geometry.components[0],node);
for(var i=1;
i<geometry.components.length;
++i){this.writeNode("innerBoundaryIs",geometry.components[i],node)
}return node
},outerBoundaryIs:function(ring){var node=this.createElementNSPlus("gml:outerBoundaryIs");
this.writeNode("LinearRing",ring,node);
return node
},innerBoundaryIs:function(ring){var node=this.createElementNSPlus("gml:innerBoundaryIs");
this.writeNode("LinearRing",ring,node);
return node
},LinearRing:function(ring){var node=this.createElementNSPlus("gml:LinearRing");
this.writeNode("coordinates",ring.components,node);
return node
},Box:function(bounds){var node=this.createElementNSPlus("gml:Box");
this.writeNode("coordinates",[{x:bounds.left,y:bounds.bottom},{x:bounds.right,y:bounds.top}],node);
if(this.srsName){node.setAttribute("srsName",this.srsName)
}return node
}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});
OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:false,multiCurve:true,surface:false,multiSurface:true,initialize:function(options){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[options])
},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(node,obj){this.readChildNodes(node,obj)
},Curve:function(node,container){var obj={points:[]};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}container.components.push(new OpenLayers.Geometry.LineString(obj.points))
},segments:function(node,obj){this.readChildNodes(node,obj)
},LineStringSegment:function(node,container){var obj={};
this.readChildNodes(node,obj);
if(obj.points){Array.prototype.push.apply(container.points,obj.points)
}},pos:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var point;
if(this.xy){point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{point=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}obj.points=[point]
},posList:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var dim=parseInt(node.getAttribute("dimension"))||2;
var j,x,y,z;
var numPoints=coords.length/dim;
var points=new Array(numPoints);
for(var i=0,len=coords.length;
i<len;
i+=dim){x=coords[i];
y=coords[i+1];
z=(dim==2)?undefined:coords[i+2];
if(this.xy){points[i/dim]=new OpenLayers.Geometry.Point(x,y,z)
}else{points[i/dim]=new OpenLayers.Geometry.Point(y,x,z)
}}obj.points=points
},Surface:function(node,obj){this.readChildNodes(node,obj)
},patches:function(node,obj){this.readChildNodes(node,obj)
},PolygonPatch:function(node,obj){this.readers.gml.Polygon.apply(this,[node,obj])
},exterior:function(node,container){var obj={};
this.readChildNodes(node,obj);
container.outer=obj.components[0]
},interior:function(node,container){var obj={};
this.readChildNodes(node,obj);
container.inner.push(obj.components[0])
},MultiCurve:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
if(obj.components.length>0){container.components=[new OpenLayers.Geometry.MultiLineString(obj.components)]
}},curveMember:function(node,obj){this.readChildNodes(node,obj)
},MultiSurface:function(node,container){var obj={components:[]};
this.readChildNodes(node,obj);
if(obj.components.length>0){container.components=[new OpenLayers.Geometry.MultiPolygon(obj.components)]
}},surfaceMember:function(node,obj){this.readChildNodes(node,obj)
},surfaceMembers:function(node,obj){this.readChildNodes(node,obj)
},pointMembers:function(node,obj){this.readChildNodes(node,obj)
},lineStringMembers:function(node,obj){this.readChildNodes(node,obj)
},polygonMembers:function(node,obj){this.readChildNodes(node,obj)
},geometryMembers:function(node,obj){this.readChildNodes(node,obj)
},Envelope:function(node,container){var obj={points:new Array(2)};
this.readChildNodes(node,obj);
if(!container.components){container.components=[]
}var min=obj.points[0];
var max=obj.points[1];
container.components.push(new OpenLayers.Bounds(min.x,min.y,max.x,max.y))
},lowerCorner:function(node,container){var obj={};
this.readers.gml.pos.apply(this,[node,obj]);
container.points[0]=obj.points[0]
},upperCorner:function(node,container){var obj={};
this.readers.gml.pos.apply(this,[node,obj]);
container.points[1]=obj.points[0]
}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(features){var name;
if(OpenLayers.Util.isArray(features)){name="featureMembers"
}else{name="featureMember"
}var root=this.writeNode("gml:"+name,features);
this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(features){var node=this.createElementNSPlus("gml:featureMembers");
for(var i=0,len=features.length;
i<len;
++i){this.writeNode("feature:_typeName",features[i],node)
}return node
},Point:function(geometry){var node=this.createElementNSPlus("gml:Point");
this.writeNode("pos",geometry,node);
return node
},pos:function(point){var pos=(this.xy)?(point.x+" "+point.y):(point.y+" "+point.x);
return this.createElementNSPlus("gml:pos",{value:pos})
},LineString:function(geometry){var node=this.createElementNSPlus("gml:LineString");
this.writeNode("posList",geometry.components,node);
return node
},Curve:function(geometry){var node=this.createElementNSPlus("gml:Curve");
this.writeNode("segments",geometry,node);
return node
},segments:function(geometry){var node=this.createElementNSPlus("gml:segments");
this.writeNode("LineStringSegment",geometry,node);
return node
},LineStringSegment:function(geometry){var node=this.createElementNSPlus("gml:LineStringSegment");
this.writeNode("posList",geometry.components,node);
return node
},posList:function(points){var len=points.length;
var parts=new Array(len);
var point;
for(var i=0;
i<len;
++i){point=points[i];
if(this.xy){parts[i]=point.x+" "+point.y
}else{parts[i]=point.y+" "+point.x
}}return this.createElementNSPlus("gml:posList",{value:parts.join(" ")})
},Surface:function(geometry){var node=this.createElementNSPlus("gml:Surface");
this.writeNode("patches",geometry,node);
return node
},patches:function(geometry){var node=this.createElementNSPlus("gml:patches");
this.writeNode("PolygonPatch",geometry,node);
return node
},PolygonPatch:function(geometry){var node=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});
this.writeNode("exterior",geometry.components[0],node);
for(var i=1,len=geometry.components.length;
i<len;
++i){this.writeNode("interior",geometry.components[i],node)
}return node
},Polygon:function(geometry){var node=this.createElementNSPlus("gml:Polygon");
this.writeNode("exterior",geometry.components[0],node);
for(var i=1,len=geometry.components.length;
i<len;
++i){this.writeNode("interior",geometry.components[i],node)
}return node
},exterior:function(ring){var node=this.createElementNSPlus("gml:exterior");
this.writeNode("LinearRing",ring,node);
return node
},interior:function(ring){var node=this.createElementNSPlus("gml:interior");
this.writeNode("LinearRing",ring,node);
return node
},LinearRing:function(ring){var node=this.createElementNSPlus("gml:LinearRing");
this.writeNode("posList",ring.components,node);
return node
},MultiCurve:function(geometry){var node=this.createElementNSPlus("gml:MultiCurve");
var components=geometry.components||[geometry];
for(var i=0,len=components.length;
i<len;
++i){this.writeNode("curveMember",components[i],node)
}return node
},curveMember:function(geometry){var node=this.createElementNSPlus("gml:curveMember");
if(this.curve){this.writeNode("Curve",geometry,node)
}else{this.writeNode("LineString",geometry,node)
}return node
},MultiSurface:function(geometry){var node=this.createElementNSPlus("gml:MultiSurface");
var components=geometry.components||[geometry];
for(var i=0,len=components.length;
i<len;
++i){this.writeNode("surfaceMember",components[i],node)
}return node
},surfaceMember:function(polygon){var node=this.createElementNSPlus("gml:surfaceMember");
if(this.surface){this.writeNode("Surface",polygon,node)
}else{this.writeNode("Polygon",polygon,node)
}return node
},Envelope:function(bounds){var node=this.createElementNSPlus("gml:Envelope");
this.writeNode("lowerCorner",bounds,node);
this.writeNode("upperCorner",bounds,node);
if(this.srsName){node.setAttribute("srsName",this.srsName)
}return node
},lowerCorner:function(bounds){var pos=(this.xy)?(bounds.left+" "+bounds.bottom):(bounds.bottom+" "+bounds.left);
return this.createElementNSPlus("gml:lowerCorner",{value:pos})
},upperCorner:function(bounds){var pos=(this.xy)?(bounds.right+" "+bounds.top):(bounds.top+" "+bounds.right);
return this.createElementNSPlus("gml:upperCorner",{value:pos})
}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":(this.curve===true)?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":(this.multiCurve===false)?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":(this.surface===true)?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":(this.multiSurface===false)?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}
},CLASS_NAME:"OpenLayers.Format.GML.v3"});
OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:false,read:function(doc){if(typeof doc=="string"){doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc])
}return this.parseFeatures(doc)
},write:function(features){var doc;
if(OpenLayers.Util.isArray(features)){doc=this.createElementNSPlus("atom:feed");
doc.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));
for(var i=0,ii=features.length;
i<ii;
i++){doc.appendChild(this.buildEntryNode(features[i]))
}}else{doc=this.buildEntryNode(features)
}return OpenLayers.Format.XML.prototype.write.apply(this,[doc])
},buildContentNode:function(content){var node=this.createElementNSPlus("atom:content",{attributes:{type:content.type||null}});
if(content.src){node.setAttribute("src",content.src)
}else{if(content.type=="text"||content.type==null){node.appendChild(this.createTextNode(content.value))
}else{if(content.type=="html"){if(typeof content.value!="string"){throw"HTML content must be in form of an escaped string"
}node.appendChild(this.createTextNode(content.value))
}else{if(content.type=="xhtml"){node.appendChild(content.value)
}else{if(content.type=="xhtml"||content.type.match(/(\+|\/)xml$/)){node.appendChild(content.value)
}else{node.appendChild(this.createTextNode(content.value))
}}}}}return node
},buildEntryNode:function(feature){var attrib=feature.attributes;
var atomAttrib=attrib.atom||{};
var entryNode=this.createElementNSPlus("atom:entry");
if(atomAttrib.authors){var authors=OpenLayers.Util.isArray(atomAttrib.authors)?atomAttrib.authors:[atomAttrib.authors];
for(var i=0,ii=authors.length;
i<ii;
i++){entryNode.appendChild(this.buildPersonConstructNode("author",authors[i]))
}}if(atomAttrib.categories){var categories=OpenLayers.Util.isArray(atomAttrib.categories)?atomAttrib.categories:[atomAttrib.categories];
var category;
for(var i=0,ii=categories.length;
i<ii;
i++){category=categories[i];
entryNode.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:category.term,scheme:category.scheme||null,label:category.label||null}}))
}}if(atomAttrib.content){entryNode.appendChild(this.buildContentNode(atomAttrib.content))
}if(atomAttrib.contributors){var contributors=OpenLayers.Util.isArray(atomAttrib.contributors)?atomAttrib.contributors:[atomAttrib.contributors];
for(var i=0,ii=contributors.length;
i<ii;
i++){entryNode.appendChild(this.buildPersonConstructNode("contributor",contributors[i]))
}}if(feature.fid){entryNode.appendChild(this.createElementNSPlus("atom:id",{value:feature.fid}))
}if(atomAttrib.links){var links=OpenLayers.Util.isArray(atomAttrib.links)?atomAttrib.links:[atomAttrib.links];
var link;
for(var i=0,ii=links.length;
i<ii;
i++){link=links[i];
entryNode.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:link.href,rel:link.rel||null,type:link.type||null,hreflang:link.hreflang||null,title:link.title||null,length:link.length||null}}))
}}if(atomAttrib.published){entryNode.appendChild(this.createElementNSPlus("atom:published",{value:atomAttrib.published}))
}if(atomAttrib.rights){entryNode.appendChild(this.createElementNSPlus("atom:rights",{value:atomAttrib.rights}))
}if(atomAttrib.summary||attrib.description){entryNode.appendChild(this.createElementNSPlus("atom:summary",{value:atomAttrib.summary||attrib.description}))
}entryNode.appendChild(this.createElementNSPlus("atom:title",{value:atomAttrib.title||attrib.title||this.defaultEntryTitle}));
if(atomAttrib.updated){entryNode.appendChild(this.createElementNSPlus("atom:updated",{value:atomAttrib.updated}))
}if(feature.geometry){var whereNode=this.createElementNSPlus("georss:where");
whereNode.appendChild(this.buildGeometryNode(feature.geometry));
entryNode.appendChild(whereNode)
}return entryNode
},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})
},buildGeometryNode:function(geometry){if(!this.gmlParser){this.initGmlParser()
}var node=this.gmlParser.writeNode("feature:_geometry",geometry);
return node.firstChild
},buildPersonConstructNode:function(name,value){var oNames=["uri","email"];
var personNode=this.createElementNSPlus("atom:"+name);
personNode.appendChild(this.createElementNSPlus("atom:name",{value:value.name}));
for(var i=0,ii=oNames.length;
i<ii;
i++){if(value[oNames[i]]){personNode.appendChild(this.createElementNSPlus("atom:"+oNames[i],{value:value[oNames[i]]}))
}}return personNode
},getFirstChildValue:function(node,nsuri,name,def){var value;
var nodes=this.getElementsByTagNameNS(node,nsuri,name);
if(nodes&&nodes.length>0){value=this.getChildValue(nodes[0],def)
}else{value=def
}return value
},parseFeature:function(node){var atomAttrib={};
var value=null;
var nodes=null;
var attval=null;
var atomns=this.namespaces.atom;
this.parsePersonConstructs(node,"author",atomAttrib);
nodes=this.getElementsByTagNameNS(node,atomns,"category");
if(nodes.length>0){atomAttrib.categories=[]
}for(var i=0,ii=nodes.length;
i<ii;
i++){value={};
value.term=nodes[i].getAttribute("term");
attval=nodes[i].getAttribute("scheme");
if(attval){value.scheme=attval
}attval=nodes[i].getAttribute("label");
if(attval){value.label=attval
}atomAttrib.categories.push(value)
}nodes=this.getElementsByTagNameNS(node,atomns,"content");
if(nodes.length>0){value={};
attval=nodes[0].getAttribute("type");
if(attval){value.type=attval
}attval=nodes[0].getAttribute("src");
if(attval){value.src=attval
}else{if(value.type=="text"||value.type=="html"||value.type==null){value.value=this.getFirstChildValue(node,atomns,"content",null)
}else{if(value.type=="xhtml"||value.type.match(/(\+|\/)xml$/)){value.value=this.getChildEl(nodes[0])
}else{value.value=this.getFirstChildValue(node,atomns,"content",null)
}}atomAttrib.content=value
}}this.parsePersonConstructs(node,"contributor",atomAttrib);
atomAttrib.id=this.getFirstChildValue(node,atomns,"id",null);
nodes=this.getElementsByTagNameNS(node,atomns,"link");
if(nodes.length>0){atomAttrib.links=new Array(nodes.length)
}var oAtts=["rel","type","hreflang","title","length"];
for(var i=0,ii=nodes.length;
i<ii;
i++){value={};
value.href=nodes[i].getAttribute("href");
for(var j=0,jj=oAtts.length;
j<jj;
j++){attval=nodes[i].getAttribute(oAtts[j]);
if(attval){value[oAtts[j]]=attval
}}atomAttrib.links[i]=value
}value=this.getFirstChildValue(node,atomns,"published",null);
if(value){atomAttrib.published=value
}value=this.getFirstChildValue(node,atomns,"rights",null);
if(value){atomAttrib.rights=value
}value=this.getFirstChildValue(node,atomns,"summary",null);
if(value){atomAttrib.summary=value
}atomAttrib.title=this.getFirstChildValue(node,atomns,"title",null);
atomAttrib.updated=this.getFirstChildValue(node,atomns,"updated",null);
var featureAttrib={title:atomAttrib.title,description:atomAttrib.summary,atom:atomAttrib};
var geometry=this.parseLocations(node)[0];
var feature=new OpenLayers.Feature.Vector(geometry,featureAttrib);
feature.fid=atomAttrib.id;
return feature
},parseFeatures:function(node){var features=[];
var entries=this.getElementsByTagNameNS(node,this.namespaces.atom,"entry");
if(entries.length==0){entries=[node]
}for(var i=0,ii=entries.length;
i<ii;
i++){features.push(this.parseFeature(entries[i]))
}return features
},parseLocations:function(node){var georssns=this.namespaces.georss;
var locations={components:[]};
var where=this.getElementsByTagNameNS(node,georssns,"where");
if(where&&where.length>0){if(!this.gmlParser){this.initGmlParser()
}for(var i=0,ii=where.length;
i<ii;
i++){this.gmlParser.readChildNodes(where[i],locations)
}}var components=locations.components;
var point=this.getElementsByTagNameNS(node,georssns,"point");
if(point&&point.length>0){for(var i=0,ii=point.length;
i<ii;
i++){var xy=OpenLayers.String.trim(point[i].firstChild.nodeValue).split(/\s+/);
if(xy.length!=2){xy=OpenLayers.String.trim(point[i].firstChild.nodeValue).split(/\s*,\s*/)
}components.push(new OpenLayers.Geometry.Point(xy[1],xy[0]))
}}var line=this.getElementsByTagNameNS(node,georssns,"line");
if(line&&line.length>0){var coords;
var p;
var points;
for(var i=0,ii=line.length;
i<ii;
i++){coords=OpenLayers.String.trim(line[i].firstChild.nodeValue).split(/\s+/);
points=[];
for(var j=0,jj=coords.length;
j<jj;
j+=2){p=new OpenLayers.Geometry.Point(coords[j+1],coords[j]);
points.push(p)
}components.push(new OpenLayers.Geometry.LineString(points))
}}var polygon=this.getElementsByTagNameNS(node,georssns,"polygon");
if(polygon&&polygon.length>0){var coords;
var p;
var points;
for(var i=0,ii=polygon.length;
i<ii;
i++){coords=OpenLayers.String.trim(polygon[i].firstChild.nodeValue).split(/\s+/);
points=[];
for(var j=0,jj=coords.length;
j<jj;
j+=2){p=new OpenLayers.Geometry.Point(coords[j+1],coords[j]);
points.push(p)
}components.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(components)]))
}}if(this.internalProjection&&this.externalProjection){for(var i=0,ii=components.length;
i<ii;
i++){if(components[i]){components[i].transform(this.externalProjection,this.internalProjection)
}}}return components
},parsePersonConstructs:function(node,name,data){var persons=[];
var atomns=this.namespaces.atom;
var nodes=this.getElementsByTagNameNS(node,atomns,name);
var oAtts=["uri","email"];
for(var i=0,ii=nodes.length;
i<ii;
i++){var value={};
value.name=this.getFirstChildValue(nodes[i],atomns,"name",null);
for(var j=0,jj=oAtts.length;
j<jj;
j++){var attval=this.getFirstChildValue(nodes[i],atomns,oAtts[j],null);
if(attval){value[oAtts[j]]=attval
}}persons.push(value)
}if(persons.length>0){data[name+"s"]=persons
}},CLASS_NAME:"OpenLayers.Format.Atom"});
OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date(),extractAttributes:true,kvpAttributes:false,extractStyles:false,extractTracks:false,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(options){this.regExes={trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),kmlColor:(/(\w{2})(\w{2})(\w{2})(\w{2})/),kmlIconPalette:(/root:\/\/icons\/palette-(\d+)(\.\w+)/),straightBracket:(/\$\[(.*?)\]/g)};
this.externalProjection=new OpenLayers.Projection("EPSG:4326");
OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){this.features=[];
this.styles={};
this.fetched={};
var options={depth:0,styleBaseUrl:this.styleBaseUrl};
return this.parseData(data,options)
},parseData:function(data,options){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var types=["Link","NetworkLink","Style","StyleMap","Placemark"];
for(var i=0,len=types.length;
i<len;
++i){var type=types[i];
var nodes=this.getElementsByTagNameNS(data,"*",type);
if(nodes.length==0){continue
}switch(type.toLowerCase()){case"link":case"networklink":this.parseLinks(nodes,options);
break;
case"style":if(this.extractStyles){this.parseStyles(nodes,options)
}break;
case"stylemap":if(this.extractStyles){this.parseStyleMaps(nodes,options)
}break;
case"placemark":this.parseFeatures(nodes,options);
break
}}return this.features
},parseLinks:function(nodes,options){if(options.depth>=this.maxDepth){return false
}var newOptions=OpenLayers.Util.extend({},options);
newOptions.depth++;
for(var i=0,len=nodes.length;
i<len;
i++){var href=this.parseProperty(nodes[i],"*","href");
if(href&&!this.fetched[href]){this.fetched[href]=true;
var data=this.fetchLink(href);
if(data){this.parseData(data,newOptions)
}}}},fetchLink:function(href){var request=OpenLayers.Request.GET({url:href,async:false});
if(request){return request.responseText
}},parseStyles:function(nodes,options){for(var i=0,len=nodes.length;
i<len;
i++){var style=this.parseStyle(nodes[i]);
if(style){var styleName=(options.styleBaseUrl||"")+"#"+style.id;
this.styles[styleName]=style
}}},parseKmlColor:function(kmlColor){var color=null;
if(kmlColor){var matches=kmlColor.match(this.regExes.kmlColor);
if(matches){color={color:"#"+matches[4]+matches[3]+matches[2],opacity:parseInt(matches[1],16)/255}
}}return color
},parseStyle:function(node){var style={};
var types=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"];
var type,styleTypeNode,nodeList,geometry,parser;
for(var i=0,len=types.length;
i<len;
++i){type=types[i];
styleTypeNode=this.getElementsByTagNameNS(node,"*",type)[0];
if(!styleTypeNode){continue
}switch(type.toLowerCase()){case"linestyle":var kmlColor=this.parseProperty(styleTypeNode,"*","color");
var color=this.parseKmlColor(kmlColor);
if(color){style.strokeColor=color.color;
style.strokeOpacity=color.opacity
}var width=this.parseProperty(styleTypeNode,"*","width");
if(width){style.strokeWidth=width
}break;
case"polystyle":var kmlColor=this.parseProperty(styleTypeNode,"*","color");
var color=this.parseKmlColor(kmlColor);
if(color){style.fillOpacity=color.opacity;
style.fillColor=color.color
}var fill=this.parseProperty(styleTypeNode,"*","fill");
if(fill=="0"){style.fillColor="none"
}var outline=this.parseProperty(styleTypeNode,"*","outline");
if(outline=="0"){style.strokeWidth="0"
}break;
case"iconstyle":var scale=parseFloat(this.parseProperty(styleTypeNode,"*","scale")||1);
var width=32*scale;
var height=32*scale;
var iconNode=this.getElementsByTagNameNS(styleTypeNode,"*","Icon")[0];
if(iconNode){var href=this.parseProperty(iconNode,"*","href");
if(href){var w=this.parseProperty(iconNode,"*","w");
var h=this.parseProperty(iconNode,"*","h");
var google="http://maps.google.com/mapfiles/kml";
if(OpenLayers.String.startsWith(href,google)&&!w&&!h){w=64;
h=64;
scale=scale/2
}w=w||h;
h=h||w;
if(w){width=parseInt(w)*scale
}if(h){height=parseInt(h)*scale
}var matches=href.match(this.regExes.kmlIconPalette);
if(matches){var palette=matches[1];
var file_extension=matches[2];
var x=this.parseProperty(iconNode,"*","x");
var y=this.parseProperty(iconNode,"*","y");
var posX=x?x/32:0;
var posY=y?(7-y/32):7;
var pos=posY*8+posX;
href="http://maps.google.com/mapfiles/kml/pal"+palette+"/icon"+pos+file_extension
}style.graphicOpacity=1;
style.externalGraphic=href
}}var hotSpotNode=this.getElementsByTagNameNS(styleTypeNode,"*","hotSpot")[0];
if(hotSpotNode){var x=parseFloat(hotSpotNode.getAttribute("x"));
var y=parseFloat(hotSpotNode.getAttribute("y"));
var xUnits=hotSpotNode.getAttribute("xunits");
if(xUnits=="pixels"){style.graphicXOffset=-x*scale
}else{if(xUnits=="insetPixels"){style.graphicXOffset=-width+(x*scale)
}else{if(xUnits=="fraction"){style.graphicXOffset=-width*x
}}}var yUnits=hotSpotNode.getAttribute("yunits");
if(yUnits=="pixels"){style.graphicYOffset=-height+(y*scale)+1
}else{if(yUnits=="insetPixels"){style.graphicYOffset=-(y*scale)+1
}else{if(yUnits=="fraction"){style.graphicYOffset=-height*(1-y)+1
}}}}style.graphicWidth=width;
style.graphicHeight=height;
break;
case"balloonstyle":var balloonStyle=OpenLayers.Util.getXmlNodeValue(styleTypeNode);
if(balloonStyle){style.balloonStyle=balloonStyle.replace(this.regExes.straightBracket,"${$1}")
}break;
case"labelstyle":var kmlColor=this.parseProperty(styleTypeNode,"*","color");
var color=this.parseKmlColor(kmlColor);
if(color){style.fontColor=color.color;
style.fontOpacity=color.opacity
}break;
default:}}if(!style.strokeColor&&style.fillColor){style.strokeColor=style.fillColor
}var id=node.getAttribute("id");
if(id&&style){style.id=id
}return style
},parseStyleMaps:function(nodes,options){for(var i=0,len=nodes.length;
i<len;
i++){var node=nodes[i];
var pairs=this.getElementsByTagNameNS(node,"*","Pair");
var id=node.getAttribute("id");
for(var j=0,jlen=pairs.length;
j<jlen;
j++){var pair=pairs[j];
var key=this.parseProperty(pair,"*","key");
var styleUrl=this.parseProperty(pair,"*","styleUrl");
if(styleUrl&&key=="normal"){this.styles[(options.styleBaseUrl||"")+"#"+id]=this.styles[(options.styleBaseUrl||"")+styleUrl]
}}}},parseFeatures:function(nodes,options){var features=[];
for(var i=0,len=nodes.length;
i<len;
i++){var featureNode=nodes[i];
var feature=this.parseFeature.apply(this,[featureNode]);
if(feature){if(this.extractStyles&&feature.attributes&&feature.attributes.styleUrl){feature.style=this.getStyle(feature.attributes.styleUrl,options)
}if(this.extractStyles){var inlineStyleNode=this.getElementsByTagNameNS(featureNode,"*","Style")[0];
if(inlineStyleNode){var inlineStyle=this.parseStyle(inlineStyleNode);
if(inlineStyle){feature.style=OpenLayers.Util.extend(feature.style,inlineStyle)
}}}if(this.extractTracks){var tracks=this.getElementsByTagNameNS(featureNode,this.namespaces.gx,"Track");
if(tracks&&tracks.length>0){var track=tracks[0];
var container={features:[],feature:feature};
this.readNode(track,container);
if(container.features.length>0){features.push.apply(features,container.features)
}}}else{features.push(feature)
}}else{throw"Bad Placemark: "+i
}}this.features=this.features.concat(features)
},readers:{kml:{when:function(node,container){container.whens.push(OpenLayers.Date.parse(this.getChildValue(node)))
},_trackPointAttribute:function(node,container){var name=node.nodeName.split(":").pop();
container.attributes[name].push(this.getChildValue(node))
}},gx:{Track:function(node,container){var obj={whens:[],points:[],angles:[]};
if(this.trackAttributes){var name;
obj.attributes={};
for(var i=0,ii=this.trackAttributes.length;
i<ii;
++i){name=this.trackAttributes[i];
obj.attributes[name]=[];
if(!(name in this.readers.kml)){this.readers.kml[name]=this.readers.kml._trackPointAttribute
}}}this.readChildNodes(node,obj);
if(obj.whens.length!==obj.points.length){throw new Error("gx:Track with unequal number of when ("+obj.whens.length+") and gx:coord ("+obj.points.length+") elements.")
}var hasAngles=obj.angles.length>0;
if(hasAngles&&obj.whens.length!==obj.angles.length){throw new Error("gx:Track with unequal number of when ("+obj.whens.length+") and gx:angles ("+obj.angles.length+") elements.")
}var feature,point,angles;
for(var i=0,ii=obj.whens.length;
i<ii;
++i){feature=container.feature.clone();
feature.fid=container.feature.fid||container.feature.id;
point=obj.points[i];
feature.geometry=point;
if("z" in point){feature.attributes.altitude=point.z
}if(this.internalProjection&&this.externalProjection){feature.geometry.transform(this.externalProjection,this.internalProjection)
}if(this.trackAttributes){for(var j=0,jj=this.trackAttributes.length;
j<jj;
++j){feature.attributes[name]=obj.attributes[this.trackAttributes[j]][i]
}}feature.attributes.when=obj.whens[i];
feature.attributes.trackId=container.feature.id;
if(hasAngles){angles=obj.angles[i];
feature.attributes.heading=parseFloat(angles[0]);
feature.attributes.tilt=parseFloat(angles[1]);
feature.attributes.roll=parseFloat(angles[2])
}container.features.push(feature)
}},coord:function(node,container){var str=this.getChildValue(node);
var coords=str.replace(this.regExes.trimSpace,"").split(/\s+/);
var point=new OpenLayers.Geometry.Point(coords[0],coords[1]);
if(coords.length>2){point.z=parseFloat(coords[2])
}container.points.push(point)
},angles:function(node,container){var str=this.getChildValue(node);
var parts=str.replace(this.regExes.trimSpace,"").split(/\s+/);
container.angles.push(parts)
}}},parseFeature:function(node){var order=["MultiGeometry","Polygon","LineString","Point"];
var type,nodeList,geometry,parser;
for(var i=0,len=order.length;
i<len;
++i){type=order[i];
this.internalns=node.namespaceURI?node.namespaceURI:this.kmlns;
nodeList=this.getElementsByTagNameNS(node,this.internalns,type);
if(nodeList.length>0){var parser=this.parseGeometry[type.toLowerCase()];
if(parser){geometry=parser.apply(this,[nodeList[0]]);
if(this.internalProjection&&this.externalProjection){geometry.transform(this.externalProjection,this.internalProjection)
}}else{throw new TypeError("Unsupported geometry type: "+type)
}break
}}var attributes;
if(this.extractAttributes){attributes=this.parseAttributes(node)
}var feature=new OpenLayers.Feature.Vector(geometry,attributes);
var fid=node.getAttribute("id")||node.getAttribute("name");
if(fid!=null){feature.fid=fid
}return feature
},getStyle:function(styleUrl,options){var styleBaseUrl=OpenLayers.Util.removeTail(styleUrl);
var newOptions=OpenLayers.Util.extend({},options);
newOptions.depth++;
newOptions.styleBaseUrl=styleBaseUrl;
if(!this.styles[styleUrl]&&!OpenLayers.String.startsWith(styleUrl,"#")&&newOptions.depth<=this.maxDepth&&!this.fetched[styleBaseUrl]){var data=this.fetchLink(styleBaseUrl);
if(data){this.parseData(data,newOptions)
}}var style=OpenLayers.Util.extend({},this.styles[styleUrl]);
return style
},parseGeometry:{point:function(node){var nodeList=this.getElementsByTagNameNS(node,this.internalns,"coordinates");
var coords=[];
if(nodeList.length>0){var coordString=nodeList[0].firstChild.nodeValue;
coordString=coordString.replace(this.regExes.removeSpace,"");
coords=coordString.split(",")
}var point=null;
if(coords.length>1){if(coords.length==2){coords[2]=null
}point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{throw"Bad coordinate string: "+coordString
}return point
},linestring:function(node,ring){var nodeList=this.getElementsByTagNameNS(node,this.internalns,"coordinates");
var line=null;
if(nodeList.length>0){var coordString=this.getChildValue(nodeList[0]);
coordString=coordString.replace(this.regExes.trimSpace,"");
coordString=coordString.replace(this.regExes.trimComma,",");
var pointList=coordString.split(this.regExes.splitSpace);
var numPoints=pointList.length;
var points=new Array(numPoints);
var coords,numCoords;
for(var i=0;
i<numPoints;
++i){coords=pointList[i].split(",");
numCoords=coords.length;
if(numCoords>1){if(coords.length==2){coords[2]=null
}points[i]=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{throw"Bad LineString point coordinates: "+pointList[i]
}}if(numPoints){if(ring){line=new OpenLayers.Geometry.LinearRing(points)
}else{line=new OpenLayers.Geometry.LineString(points)
}}else{throw"Bad LineString coordinates: "+coordString
}}return line
},polygon:function(node){var nodeList=this.getElementsByTagNameNS(node,this.internalns,"LinearRing");
var numRings=nodeList.length;
var components=new Array(numRings);
if(numRings>0){var ring;
for(var i=0,len=nodeList.length;
i<len;
++i){ring=this.parseGeometry.linestring.apply(this,[nodeList[i],true]);
if(ring){components[i]=ring
}else{throw"Bad LinearRing geometry: "+i
}}}return new OpenLayers.Geometry.Polygon(components)
},multigeometry:function(node){var child,parser;
var parts=[];
var children=node.childNodes;
for(var i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType==1){var type=(child.prefix)?child.nodeName.split(":")[1]:child.nodeName;
var parser=this.parseGeometry[type.toLowerCase()];
if(parser){parts.push(parser.apply(this,[child]))
}}}return new OpenLayers.Geometry.Collection(parts)
}},parseAttributes:function(node){var attributes={};
var edNodes=node.getElementsByTagName("ExtendedData");
if(edNodes.length){attributes=this.parseExtendedData(edNodes[0])
}var child,grandchildren,grandchild;
var children=node.childNodes;
for(var i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType==1){grandchildren=child.childNodes;
if(grandchildren.length>=1&&grandchildren.length<=3){var grandchild;
switch(grandchildren.length){case 1:grandchild=grandchildren[0];
break;
case 2:var c1=grandchildren[0];
var c2=grandchildren[1];
grandchild=(c1.nodeType==3||c1.nodeType==4)?c1:c2;
break;
case 3:default:grandchild=grandchildren[1];
break
}if(grandchild.nodeType==3||grandchild.nodeType==4){var name=(child.prefix)?child.nodeName.split(":")[1]:child.nodeName;
var value=OpenLayers.Util.getXmlNodeValue(grandchild);
if(value){value=value.replace(this.regExes.trimSpace,"");
attributes[name]=value
}}}}}return attributes
},parseExtendedData:function(node){var attributes={};
var i,len,data,key;
var dataNodes=node.getElementsByTagName("Data");
for(i=0,len=dataNodes.length;
i<len;
i++){data=dataNodes[i];
key=data.getAttribute("name");
var ed={};
var valueNode=data.getElementsByTagName("value");
if(valueNode.length){ed.value=this.getChildValue(valueNode[0])
}if(this.kvpAttributes){attributes[key]=ed.value
}else{var nameNode=data.getElementsByTagName("displayName");
if(nameNode.length){ed.displayName=this.getChildValue(nameNode[0])
}attributes[key]=ed
}}var simpleDataNodes=node.getElementsByTagName("SimpleData");
for(i=0,len=simpleDataNodes.length;
i<len;
i++){var ed={};
data=simpleDataNodes[i];
key=data.getAttribute("name");
ed.value=this.getChildValue(data);
if(this.kvpAttributes){attributes[key]=ed.value
}else{ed.displayName=key;
attributes[key]=ed
}}return attributes
},parseProperty:function(xmlNode,namespace,tagName){var value;
var nodeList=this.getElementsByTagNameNS(xmlNode,namespace,tagName);
try{value=OpenLayers.Util.getXmlNodeValue(nodeList[0])
}catch(e){value=null
}return value
},write:function(features){if(!(OpenLayers.Util.isArray(features))){features=[features]
}var kml=this.createElementNS(this.kmlns,"kml");
var folder=this.createFolderXML();
for(var i=0,len=features.length;
i<len;
++i){folder.appendChild(this.createPlacemarkXML(features[i]))
}kml.appendChild(folder);
return OpenLayers.Format.XML.prototype.write.apply(this,[kml])
},createFolderXML:function(){var folder=this.createElementNS(this.kmlns,"Folder");
if(this.foldersName){var folderName=this.createElementNS(this.kmlns,"name");
var folderNameText=this.createTextNode(this.foldersName);
folderName.appendChild(folderNameText);
folder.appendChild(folderName)
}if(this.foldersDesc){var folderDesc=this.createElementNS(this.kmlns,"description");
var folderDescText=this.createTextNode(this.foldersDesc);
folderDesc.appendChild(folderDescText);
folder.appendChild(folderDesc)
}return folder
},createPlacemarkXML:function(feature){var placemarkName=this.createElementNS(this.kmlns,"name");
var name=feature.style&&feature.style.label?feature.style.label:feature.attributes.name||feature.id;
placemarkName.appendChild(this.createTextNode(name));
var placemarkDesc=this.createElementNS(this.kmlns,"description");
var desc=feature.attributes.description||this.placemarksDesc;
placemarkDesc.appendChild(this.createTextNode(desc));
var placemarkNode=this.createElementNS(this.kmlns,"Placemark");
if(feature.fid!=null){placemarkNode.setAttribute("id",feature.fid)
}placemarkNode.appendChild(placemarkName);
placemarkNode.appendChild(placemarkDesc);
var geometryNode=this.buildGeometryNode(feature.geometry);
placemarkNode.appendChild(geometryNode);
if(feature.attributes){var edNode=this.buildExtendedData(feature.attributes);
if(edNode){placemarkNode.appendChild(edNode)
}}return placemarkNode
},buildGeometryNode:function(geometry){var className=geometry.CLASS_NAME;
var type=className.substring(className.lastIndexOf(".")+1);
var builder=this.buildGeometry[type.toLowerCase()];
var node=null;
if(builder){node=builder.apply(this,[geometry])
}return node
},buildGeometry:{point:function(geometry){var kml=this.createElementNS(this.kmlns,"Point");
kml.appendChild(this.buildCoordinatesNode(geometry));
return kml
},multipoint:function(geometry){return this.buildGeometry.collection.apply(this,[geometry])
},linestring:function(geometry){var kml=this.createElementNS(this.kmlns,"LineString");
kml.appendChild(this.buildCoordinatesNode(geometry));
return kml
},multilinestring:function(geometry){return this.buildGeometry.collection.apply(this,[geometry])
},linearring:function(geometry){var kml=this.createElementNS(this.kmlns,"LinearRing");
kml.appendChild(this.buildCoordinatesNode(geometry));
return kml
},polygon:function(geometry){var kml=this.createElementNS(this.kmlns,"Polygon");
var rings=geometry.components;
var ringMember,ringGeom,type;
for(var i=0,len=rings.length;
i<len;
++i){type=(i==0)?"outerBoundaryIs":"innerBoundaryIs";
ringMember=this.createElementNS(this.kmlns,type);
ringGeom=this.buildGeometry.linearring.apply(this,[rings[i]]);
ringMember.appendChild(ringGeom);
kml.appendChild(ringMember)
}return kml
},multipolygon:function(geometry){return this.buildGeometry.collection.apply(this,[geometry])
},collection:function(geometry){var kml=this.createElementNS(this.kmlns,"MultiGeometry");
var child;
for(var i=0,len=geometry.components.length;
i<len;
++i){child=this.buildGeometryNode.apply(this,[geometry.components[i]]);
if(child){kml.appendChild(child)
}}return kml
}},buildCoordinatesNode:function(geometry){var coordinatesNode=this.createElementNS(this.kmlns,"coordinates");
var path;
var points=geometry.components;
if(points){var point;
var numPoints=points.length;
var parts=new Array(numPoints);
for(var i=0;
i<numPoints;
++i){point=points[i];
parts[i]=this.buildCoordinates(point)
}path=parts.join(" ")
}else{path=this.buildCoordinates(geometry)
}var txtNode=this.createTextNode(path);
coordinatesNode.appendChild(txtNode);
return coordinatesNode
},buildCoordinates:function(point){if(this.internalProjection&&this.externalProjection){point=point.clone();
point.transform(this.internalProjection,this.externalProjection)
}return point.x+","+point.y
},buildExtendedData:function(attributes){var extendedData=this.createElementNS(this.kmlns,"ExtendedData");
for(var attributeName in attributes){if(attributes[attributeName]&&attributeName!="name"&&attributeName!="description"&&attributeName!="styleUrl"){var data=this.createElementNS(this.kmlns,"Data");
data.setAttribute("name",attributeName);
var value=this.createElementNS(this.kmlns,"value");
if(typeof attributes[attributeName]=="object"){if(attributes[attributeName].value){value.appendChild(this.createTextNode(attributes[attributeName].value))
}if(attributes[attributeName].displayName){var displayName=this.createElementNS(this.kmlns,"displayName");
displayName.appendChild(this.getXMLDoc().createCDATASection(attributes[attributeName].displayName));
data.appendChild(displayName)
}}else{value.appendChild(this.createTextNode(attributes[attributeName]))
}data.appendChild(value);
extendedData.appendChild(data)
}}if(this.isSimpleContent(extendedData)){return null
}else{return extendedData
}},CLASS_NAME:"OpenLayers.Format.KML"});
OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:false,createGeometryFromItem:function(item){var point=this.getElementsByTagNameNS(item,this.georssns,"point");
var lat=this.getElementsByTagNameNS(item,this.geons,"lat");
var lon=this.getElementsByTagNameNS(item,this.geons,"long");
var line=this.getElementsByTagNameNS(item,this.georssns,"line");
var polygon=this.getElementsByTagNameNS(item,this.georssns,"polygon");
var where=this.getElementsByTagNameNS(item,this.georssns,"where");
var box=this.getElementsByTagNameNS(item,this.georssns,"box");
if(point.length>0||(lat.length>0&&lon.length>0)){var location;
if(point.length>0){location=OpenLayers.String.trim(point[0].firstChild.nodeValue).split(/\s+/);
if(location.length!=2){location=OpenLayers.String.trim(point[0].firstChild.nodeValue).split(/\s*,\s*/)
}}else{location=[parseFloat(lat[0].firstChild.nodeValue),parseFloat(lon[0].firstChild.nodeValue)]
}var geometry=new OpenLayers.Geometry.Point(location[1],location[0])
}else{if(line.length>0){var coords=OpenLayers.String.trim(this.getChildValue(line[0])).split(/\s+/);
var components=[];
var point;
for(var i=0,len=coords.length;
i<len;
i+=2){point=new OpenLayers.Geometry.Point(coords[i+1],coords[i]);
components.push(point)
}geometry=new OpenLayers.Geometry.LineString(components)
}else{if(polygon.length>0){var coords=OpenLayers.String.trim(this.getChildValue(polygon[0])).split(/\s+/);
var components=[];
var point;
for(var i=0,len=coords.length;
i<len;
i+=2){point=new OpenLayers.Geometry.Point(coords[i+1],coords[i]);
components.push(point)
}geometry=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(components)])
}else{if(where.length>0){if(!this.gmlParser){this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})
}var feature=this.gmlParser.parseFeature(where[0]);
geometry=feature.geometry
}else{if(box.length>0){var coords=OpenLayers.String.trim(box[0].firstChild.nodeValue).split(/\s+/);
var components=[];
var point;
if(coords.length>3){point=new OpenLayers.Geometry.Point(coords[1],coords[0]);
components.push(point);
point=new OpenLayers.Geometry.Point(coords[1],coords[2]);
components.push(point);
point=new OpenLayers.Geometry.Point(coords[3],coords[2]);
components.push(point);
point=new OpenLayers.Geometry.Point(coords[3],coords[0]);
components.push(point);
point=new OpenLayers.Geometry.Point(coords[1],coords[0]);
components.push(point)
}geometry=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(components)])
}}}}}if(geometry&&this.internalProjection&&this.externalProjection){geometry.transform(this.externalProjection,this.internalProjection)
}return geometry
},createFeatureFromItem:function(item){var geometry=this.createGeometryFromItem(item);
var title=this._getChildValue(item,"*","title",this.featureTitle);
var description=this._getChildValue(item,"*","description",this._getChildValue(item,"*","content",this._getChildValue(item,"*","summary",this.featureDescription)));
var link=this._getChildValue(item,"*","link");
if(!link){try{link=this.getElementsByTagNameNS(item,"*","link")[0].getAttribute("href")
}catch(e){link=null
}}var id=this._getChildValue(item,"*","id",null);
var data={title:title,description:description,link:link};
var feature=new OpenLayers.Feature.Vector(geometry,data);
feature.fid=id;
return feature
},_getChildValue:function(node,nsuri,name,def){var value;
var eles=this.getElementsByTagNameNS(node,nsuri,name);
if(eles&&eles[0]&&eles[0].firstChild&&eles[0].firstChild.nodeValue){value=this.getChildValue(eles[0])
}else{value=(def==undefined)?"":def
}return value
},read:function(doc){if(typeof doc=="string"){doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc])
}var itemlist=null;
itemlist=this.getElementsByTagNameNS(doc,"*","item");
if(itemlist.length==0){itemlist=this.getElementsByTagNameNS(doc,"*","entry")
}var numItems=itemlist.length;
var features=new Array(numItems);
for(var i=0;
i<numItems;
i++){features[i]=this.createFeatureFromItem(itemlist[i])
}return features
},write:function(features){var georss;
if(OpenLayers.Util.isArray(features)){georss=this.createElementNS(this.rssns,"rss");
for(var i=0,len=features.length;
i<len;
i++){georss.appendChild(this.createFeatureXML(features[i]))
}}else{georss=this.createFeatureXML(features)
}return OpenLayers.Format.XML.prototype.write.apply(this,[georss])
},createFeatureXML:function(feature){var geometryNode=this.buildGeometryNode(feature.geometry);
var featureNode=this.createElementNS(this.rssns,"item");
var titleNode=this.createElementNS(this.rssns,"title");
titleNode.appendChild(this.createTextNode(feature.attributes.title?feature.attributes.title:""));
var descNode=this.createElementNS(this.rssns,"description");
descNode.appendChild(this.createTextNode(feature.attributes.description?feature.attributes.description:""));
featureNode.appendChild(titleNode);
featureNode.appendChild(descNode);
if(feature.attributes.link){var linkNode=this.createElementNS(this.rssns,"link");
linkNode.appendChild(this.createTextNode(feature.attributes.link));
featureNode.appendChild(linkNode)
}for(var attr in feature.attributes){if(attr=="link"||attr=="title"||attr=="description"){continue
}var attrText=this.createTextNode(feature.attributes[attr]);
var nodename=attr;
if(attr.search(":")!=-1){nodename=attr.split(":")[1]
}var attrContainer=this.createElementNS(this.featureNS,"feature:"+nodename);
attrContainer.appendChild(attrText);
featureNode.appendChild(attrContainer)
}featureNode.appendChild(geometryNode);
return featureNode
},buildGeometryNode:function(geometry){if(this.internalProjection&&this.externalProjection){geometry=geometry.clone();
geometry.transform(this.internalProjection,this.externalProjection)
}var node;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.Polygon"){node=this.createElementNS(this.georssns,"georss:polygon");
node.appendChild(this.buildCoordinatesNode(geometry.components[0]))
}else{if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"){node=this.createElementNS(this.georssns,"georss:line");
node.appendChild(this.buildCoordinatesNode(geometry))
}else{if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){node=this.createElementNS(this.georssns,"georss:point");
node.appendChild(this.buildCoordinatesNode(geometry))
}else{throw"Couldn't parse "+geometry.CLASS_NAME
}}}return node
},buildCoordinatesNode:function(geometry){var points=null;
if(geometry.components){points=geometry.components
}var path;
if(points){var numPoints=points.length;
var parts=new Array(numPoints);
for(var i=0;
i<numPoints;
i++){parts[i]=points[i].y+" "+points[i].x
}path=parts.join(" ")
}else{path=geometry.y+" "+geometry.x
}return this.createTextNode(path)
},CLASS_NAME:"OpenLayers.Format.GeoRSS"});
OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(options,layer){OpenLayers.Format.GML.prototype.initialize.apply(this,[options]);
this.layer=layer;
if(this.layer.featureNS){this.featureNS=this.layer.featureNS
}if(this.layer.options.geometry_column){this.geometryName=this.layer.options.geometry_column
}if(this.layer.options.typename){this.featureName=this.layer.options.typename
}},write:function(features){var transaction=this.createElementNS(this.wfsns,"wfs:Transaction");
transaction.setAttribute("version","1.0.0");
transaction.setAttribute("service","WFS");
for(var i=0;
i<features.length;
i++){switch(features[i].state){case OpenLayers.State.INSERT:transaction.appendChild(this.insert(features[i]));
break;
case OpenLayers.State.UPDATE:transaction.appendChild(this.update(features[i]));
break;
case OpenLayers.State.DELETE:transaction.appendChild(this.remove(features[i]));
break
}}return OpenLayers.Format.XML.prototype.write.apply(this,[transaction])
},createFeatureXML:function(feature){var geometryNode=this.buildGeometryNode(feature.geometry);
var geomContainer=this.createElementNS(this.featureNS,"feature:"+this.geometryName);
geomContainer.appendChild(geometryNode);
var featureContainer=this.createElementNS(this.featureNS,"feature:"+this.featureName);
featureContainer.appendChild(geomContainer);
for(var attr in feature.attributes){var attrText=this.createTextNode(feature.attributes[attr]);
var nodename=attr;
if(attr.search(":")!=-1){nodename=attr.split(":")[1]
}var attrContainer=this.createElementNS(this.featureNS,"feature:"+nodename);
attrContainer.appendChild(attrText);
featureContainer.appendChild(attrContainer)
}return featureContainer
},insert:function(feature){var insertNode=this.createElementNS(this.wfsns,"wfs:Insert");
insertNode.appendChild(this.createFeatureXML(feature));
return insertNode
},update:function(feature){if(!feature.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"))
}var updateNode=this.createElementNS(this.wfsns,"wfs:Update");
updateNode.setAttribute("typeName",this.featurePrefix+":"+this.featureName);
updateNode.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);
var propertyNode=this.createElementNS(this.wfsns,"wfs:Property");
var nameNode=this.createElementNS(this.wfsns,"wfs:Name");
var txtNode=this.createTextNode(this.geometryName);
nameNode.appendChild(txtNode);
propertyNode.appendChild(nameNode);
var valueNode=this.createElementNS(this.wfsns,"wfs:Value");
var geometryNode=this.buildGeometryNode(feature.geometry);
if(feature.layer){geometryNode.setAttribute("srsName",feature.layer.projection.getCode())
}valueNode.appendChild(geometryNode);
propertyNode.appendChild(valueNode);
updateNode.appendChild(propertyNode);
for(var propName in feature.attributes){propertyNode=this.createElementNS(this.wfsns,"wfs:Property");
nameNode=this.createElementNS(this.wfsns,"wfs:Name");
nameNode.appendChild(this.createTextNode(propName));
propertyNode.appendChild(nameNode);
valueNode=this.createElementNS(this.wfsns,"wfs:Value");
valueNode.appendChild(this.createTextNode(feature.attributes[propName]));
propertyNode.appendChild(valueNode);
updateNode.appendChild(propertyNode)
}var filterNode=this.createElementNS(this.ogcns,"ogc:Filter");
var filterIdNode=this.createElementNS(this.ogcns,"ogc:FeatureId");
filterIdNode.setAttribute("fid",feature.fid);
filterNode.appendChild(filterIdNode);
updateNode.appendChild(filterNode);
return updateNode
},remove:function(feature){if(!feature.fid){OpenLayers.Console.userError(OpenLayers.i18n("noFID"));
return false
}var deleteNode=this.createElementNS(this.wfsns,"wfs:Delete");
deleteNode.setAttribute("typeName",this.featurePrefix+":"+this.featureName);
deleteNode.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);
var filterNode=this.createElementNS(this.ogcns,"ogc:Filter");
var filterIdNode=this.createElementNS(this.ogcns,"ogc:FeatureId");
filterIdNode.setAttribute("fid",feature.fid);
filterNode.appendChild(filterIdNode);
deleteNode.appendChild(filterNode);
return deleteNode
},destroy:function(){this.layer=null
},CLASS_NAME:"OpenLayers.Format.WFS"});
OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(root,options){var version=this.version;
if(!version){var uri=root.getAttribute("xmlns:ows");
if(uri&&uri.substring(uri.lastIndexOf("/")+1)==="1.1"){version="1.1.0"
}if(!version){version=this.defaultVersion
}}return version
},CLASS_NAME:"OpenLayers.Format.OWSCommon"});
OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(data,options){options=OpenLayers.Util.applyDefaults(options,this.options);
var ows={};
this.readChildNodes(data,ows);
return ows
},readers:{ows:{Exception:function(node,exceptionReport){var exception={code:node.getAttribute("exceptionCode"),locator:node.getAttribute("locator"),texts:[]};
exceptionReport.exceptions.push(exception);
this.readChildNodes(node,exception)
},ExceptionText:function(node,exception){var text=this.getChildValue(node);
exception.texts.push(text)
},ServiceIdentification:function(node,obj){obj.serviceIdentification={};
this.readChildNodes(node,obj.serviceIdentification)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,serviceIdentification){serviceIdentification["abstract"]=this.getChildValue(node)
},Keywords:function(node,serviceIdentification){serviceIdentification.keywords={};
this.readChildNodes(node,serviceIdentification.keywords)
},Keyword:function(node,keywords){keywords[this.getChildValue(node)]=true
},ServiceType:function(node,serviceIdentification){serviceIdentification.serviceType={codeSpace:node.getAttribute("codeSpace"),value:this.getChildValue(node)}
},ServiceTypeVersion:function(node,serviceIdentification){serviceIdentification.serviceTypeVersion=this.getChildValue(node)
},Fees:function(node,serviceIdentification){serviceIdentification.fees=this.getChildValue(node)
},AccessConstraints:function(node,serviceIdentification){serviceIdentification.accessConstraints=this.getChildValue(node)
},ServiceProvider:function(node,obj){obj.serviceProvider={};
this.readChildNodes(node,obj.serviceProvider)
},ProviderName:function(node,serviceProvider){serviceProvider.providerName=this.getChildValue(node)
},ProviderSite:function(node,serviceProvider){serviceProvider.providerSite=this.getAttributeNS(node,this.namespaces.xlink,"href")
},ServiceContact:function(node,serviceProvider){serviceProvider.serviceContact={};
this.readChildNodes(node,serviceProvider.serviceContact)
},IndividualName:function(node,serviceContact){serviceContact.individualName=this.getChildValue(node)
},PositionName:function(node,serviceContact){serviceContact.positionName=this.getChildValue(node)
},ContactInfo:function(node,serviceContact){serviceContact.contactInfo={};
this.readChildNodes(node,serviceContact.contactInfo)
},Phone:function(node,contactInfo){contactInfo.phone={};
this.readChildNodes(node,contactInfo.phone)
},Voice:function(node,phone){phone.voice=this.getChildValue(node)
},Address:function(node,contactInfo){contactInfo.address={};
this.readChildNodes(node,contactInfo.address)
},DeliveryPoint:function(node,address){address.deliveryPoint=this.getChildValue(node)
},City:function(node,address){address.city=this.getChildValue(node)
},AdministrativeArea:function(node,address){address.administrativeArea=this.getChildValue(node)
},PostalCode:function(node,address){address.postalCode=this.getChildValue(node)
},Country:function(node,address){address.country=this.getChildValue(node)
},ElectronicMailAddress:function(node,address){address.electronicMailAddress=this.getChildValue(node)
},Role:function(node,serviceContact){serviceContact.role=this.getChildValue(node)
},OperationsMetadata:function(node,obj){obj.operationsMetadata={};
this.readChildNodes(node,obj.operationsMetadata)
},Operation:function(node,operationsMetadata){var name=node.getAttribute("name");
operationsMetadata[name]={};
this.readChildNodes(node,operationsMetadata[name])
},DCP:function(node,operation){operation.dcp={};
this.readChildNodes(node,operation.dcp)
},HTTP:function(node,dcp){dcp.http={};
this.readChildNodes(node,dcp.http)
},Get:function(node,http){if(!http.get){http.get=[]
}var obj={url:this.getAttributeNS(node,this.namespaces.xlink,"href")};
this.readChildNodes(node,obj);
http.get.push(obj)
},Post:function(node,http){if(!http.post){http.post=[]
}var obj={url:this.getAttributeNS(node,this.namespaces.xlink,"href")};
this.readChildNodes(node,obj);
http.post.push(obj)
},Parameter:function(node,operation){if(!operation.parameters){operation.parameters={}
}var name=node.getAttribute("name");
operation.parameters[name]={};
this.readChildNodes(node,operation.parameters[name])
},Constraint:function(node,obj){if(!obj.constraints){obj.constraints={}
}var name=node.getAttribute("name");
obj.constraints[name]={};
this.readChildNodes(node,obj.constraints[name])
},Value:function(node,allowedValues){allowedValues[this.getChildValue(node)]=true
},OutputFormat:function(node,obj){obj.formats.push({value:this.getChildValue(node)});
this.readChildNodes(node,obj)
},WGS84BoundingBox:function(node,obj){var boundingBox={};
boundingBox.crs=node.getAttribute("crs");
if(obj.BoundingBox){obj.BoundingBox.push(boundingBox)
}else{obj.projection=boundingBox.crs;
boundingBox=obj
}this.readChildNodes(node,boundingBox)
},BoundingBox:function(node,obj){this.readers.ows.WGS84BoundingBox.apply(this,[node,obj])
},LowerCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
str=str.replace(this.regExes.trimComma,",");
var pointList=str.split(this.regExes.splitSpace);
obj.left=pointList[0];
obj.bottom=pointList[1]
},UpperCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
str=str.replace(this.regExes.trimComma,",");
var pointList=str.split(this.regExes.splitSpace);
obj.right=pointList[0];
obj.top=pointList[1];
obj.bounds=new OpenLayers.Bounds(obj.left,obj.bottom,obj.right,obj.top);
delete obj.left;
delete obj.bottom;
delete obj.right;
delete obj.top
},Language:function(node,obj){obj.language=this.getChildValue(node)
}}},writers:{ows:{BoundingBox:function(options){var node=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:options.projection}});
this.writeNode("ows:LowerCorner",options,node);
this.writeNode("ows:UpperCorner",options,node);
return node
},LowerCorner:function(options){var node=this.createElementNSPlus("ows:LowerCorner",{value:options.bounds.left+" "+options.bounds.bottom});
return node
},UpperCorner:function(options){var node=this.createElementNSPlus("ows:UpperCorner",{value:options.bounds.right+" "+options.bounds.top});
return node
},Identifier:function(identifier){var node=this.createElementNSPlus("ows:Identifier",{value:identifier});
return node
},Title:function(title){var node=this.createElementNSPlus("ows:Title",{value:title});
return node
},Abstract:function(abstractValue){var node=this.createElementNSPlus("ows:Abstract",{value:abstractValue});
return node
},OutputFormat:function(format){var node=this.createElementNSPlus("ows:OutputFormat",{value:format});
return node
}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});
OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(node,obj){obj.success=false;
obj.exceptionReport={version:node.getAttribute("version"),language:node.getAttribute("language"),exceptions:[]};
this.readChildNodes(node,obj.exceptionReport)
}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});
OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(node,obj){obj.exceptionReport={version:node.getAttribute("version"),language:node.getAttribute("xml:lang"),exceptions:[]};
this.readChildNodes(node,obj.exceptionReport)
},AllowedValues:function(node,parameter){parameter.allowedValues={};
this.readChildNodes(node,parameter.allowedValues)
},AnyValue:function(node,parameter){parameter.anyValue=true
},DataType:function(node,parameter){parameter.dataType=this.getChildValue(node)
},Range:function(node,allowedValues){allowedValues.range={};
this.readChildNodes(node,allowedValues.range)
},MinimumValue:function(node,range){range.minValue=this.getChildValue(node)
},MaximumValue:function(node,range){range.maxValue=this.getChildValue(node)
},Identifier:function(node,obj){obj.identifier=this.getChildValue(node)
},SupportedCRS:function(node,obj){obj.supportedCRS=this.getChildValue(node)
}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(range){var node=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":range.closure}});
this.writeNode("ows:MinimumValue",range.minValue,node);
this.writeNode("ows:MaximumValue",range.maxValue,node);
return node
},MinimumValue:function(minValue){var node=this.createElementNSPlus("ows:MinimumValue",{value:minValue});
return node
},MaximumValue:function(maxValue){var node=this.createElementNSPlus("ows:MaximumValue",{value:maxValue});
return node
},Value:function(value){var node=this.createElementNSPlus("ows:Value",{value:value});
return node
}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});
OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"});
OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var raw=data;
if(data&&data.nodeType==9){data=data.documentElement
}var capabilities={};
this.readNode(data,capabilities);
return capabilities
},readers:{wfs:{WFS_Capabilities:function(node,obj){this.readChildNodes(node,obj)
},FeatureTypeList:function(node,request){request.featureTypeList={featureTypes:[]};
this.readChildNodes(node,request.featureTypeList)
},FeatureType:function(node,featureTypeList){var featureType={};
this.readChildNodes(node,featureType);
featureTypeList.featureTypes.push(featureType)
},Name:function(node,obj){var name=this.getChildValue(node);
if(name){var parts=name.split(":");
obj.name=parts.pop();
if(parts.length>0){obj.featureNS=this.lookupNamespaceURI(node,parts[0])
}}},Title:function(node,obj){var title=this.getChildValue(node);
if(title){obj.title=title
}},Abstract:function(node,obj){var abst=this.getChildValue(node);
if(abst){obj["abstract"]=abst
}}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"});
OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(node,capabilities){capabilities.service={};
this.readChildNodes(node,capabilities.service)
},Fees:function(node,service){var fees=this.getChildValue(node);
if(fees&&fees.toLowerCase()!="none"){service.fees=fees
}},AccessConstraints:function(node,service){var constraints=this.getChildValue(node);
if(constraints&&constraints.toLowerCase()!="none"){service.accessConstraints=constraints
}},OnlineResource:function(node,service){var onlineResource=this.getChildValue(node);
if(onlineResource&&onlineResource.toLowerCase()!="none"){service.onlineResource=onlineResource
}},Keywords:function(node,service){var keywords=this.getChildValue(node);
if(keywords&&keywords.toLowerCase()!="none"){service.keywords=keywords.split(", ")
}},Capability:function(node,capabilities){capabilities.capability={};
this.readChildNodes(node,capabilities.capability)
},Request:function(node,obj){obj.request={};
this.readChildNodes(node,obj.request)
},GetFeature:function(node,request){request.getfeature={href:{},formats:[]};
this.readChildNodes(node,request.getfeature)
},ResultFormat:function(node,obj){var children=node.childNodes;
var childNode;
for(var i=0;
i<children.length;
i++){childNode=children[i];
if(childNode.nodeType==1){obj.formats.push(childNode.nodeName)
}}},DCPType:function(node,obj){this.readChildNodes(node,obj)
},HTTP:function(node,obj){this.readChildNodes(node,obj.href)
},Get:function(node,obj){obj.get=node.getAttribute("onlineResource")
},Post:function(node,obj){obj.post=node.getAttribute("onlineResource")
},SRS:function(node,obj){var srs=this.getChildValue(node);
if(srs){obj.srs=srs
}}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"});
OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(node,obj){var defaultSRS=this.getChildValue(node);
if(defaultSRS){obj.srs=defaultSRS
}}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"});
OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(node,obj){var complexTypes=[];
var customTypes={};
var schema={complexTypes:complexTypes,customTypes:customTypes};
this.readChildNodes(node,schema);
var attributes=node.attributes;
var attr,name;
for(var i=0,len=attributes.length;
i<len;
++i){attr=attributes[i];
name=attr.name;
if(name.indexOf("xmlns")==0){this.setNamespace(name.split(":")[1]||"",attr.value)
}else{obj[name]=attr.value
}}obj.featureTypes=complexTypes;
obj.targetPrefix=this.namespaceAlias[obj.targetNamespace];
var complexType,customType;
for(var i=0,len=complexTypes.length;
i<len;
++i){complexType=complexTypes[i];
customType=customTypes[complexType.typeName];
if(customTypes[complexType.typeName]){complexType.typeName=customType.name
}}},complexType:function(node,obj){var complexType={typeName:node.getAttribute("name")};
this.readChildNodes(node,complexType);
obj.complexTypes.push(complexType)
},complexContent:function(node,obj){this.readChildNodes(node,obj)
},extension:function(node,obj){this.readChildNodes(node,obj)
},sequence:function(node,obj){var sequence={elements:[]};
this.readChildNodes(node,sequence);
obj.properties=sequence.elements
},element:function(node,obj){if(obj.elements){var element={};
var attributes=node.attributes;
var attr;
for(var i=0,len=attributes.length;
i<len;
++i){attr=attributes[i];
element[attr.name]=attr.value
}var type=element.type;
if(!type){type={};
this.readChildNodes(node,type);
element.restriction=type;
element.type=type.base
}var fullType=type.base||type;
element.localType=fullType.split(":").pop();
obj.elements.push(element)
}if(obj.complexTypes){var type=node.getAttribute("type");
var localType=type.split(":").pop();
obj.customTypes[localType]={name:node.getAttribute("name"),type:type}
}},simpleType:function(node,obj){this.readChildNodes(node,obj)
},restriction:function(node,obj){obj.base=node.getAttribute("base");
this.readRestriction(node,obj)
}}},readRestriction:function(node,obj){var children=node.childNodes;
var child,nodeName,value;
for(var i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType==1){nodeName=child.nodeName.split(":").pop();
value=child.getAttribute("value");
if(!obj[nodeName]){obj[nodeName]=value
}else{if(typeof obj[nodeName]=="string"){obj[nodeName]=[obj[nodeName]]
}obj[nodeName].push(value)
}}}},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var schema={};
this.readNode(data,schema);
return schema
},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"});
OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",getVersion:function(root,options){var version=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);
if(version=="1.1.1"||version=="1.1.0"){version="1.1"
}return version
},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"});
OpenLayers.Format.WMSDescribeLayer.v1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(options){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var root=data.documentElement;
var children=root.childNodes;
var describelayer=[];
var childNode,nodeName;
for(var i=0;
i<children.length;
++i){childNode=children[i];
nodeName=childNode.nodeName;
if(nodeName=="LayerDescription"){var layerName=childNode.getAttribute("name");
var owsType="";
var owsURL="";
var typeName="";
if(childNode.getAttribute("owsType")){owsType=childNode.getAttribute("owsType");
owsURL=childNode.getAttribute("owsURL")
}else{if(childNode.getAttribute("wfs")!=""){owsType="WFS";
owsURL=childNode.getAttribute("wfs")
}else{if(childNode.getAttribute("wcs")!=""){owsType="WCS";
owsURL=childNode.getAttribute("wcs")
}}}var query=childNode.getElementsByTagName("Query");
if(query.length>0){typeName=query[0].getAttribute("typeName");
if(!typeName){typeName=query[0].getAttribute("typename")
}}describelayer.push({layerName:layerName,owsType:owsType,owsURL:owsURL,typeName:typeName})
}}return describelayer
},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1"});
OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(options){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};
OpenLayers.Format.prototype.initialize.apply(this,[options])
},read:function(wkt){var features,type,str;
wkt=wkt.replace(/[\n\r]/g," ");
var matches=this.regExes.typeStr.exec(wkt);
if(matches){type=matches[1].toLowerCase();
str=matches[2];
if(this.parse[type]){features=this.parse[type].apply(this,[str])
}if(this.internalProjection&&this.externalProjection){if(features&&features.CLASS_NAME=="OpenLayers.Feature.Vector"){features.geometry.transform(this.externalProjection,this.internalProjection)
}else{if(features&&type!="geometrycollection"&&typeof features=="object"){for(var i=0,len=features.length;
i<len;
i++){var component=features[i];
component.geometry.transform(this.externalProjection,this.internalProjection)
}}}}}return features
},write:function(features){var collection,geometry,type,data,isCollection;
if(features.constructor==Array){collection=features;
isCollection=true
}else{collection=[features];
isCollection=false
}var pieces=[];
if(isCollection){pieces.push("GEOMETRYCOLLECTION(")
}for(var i=0,len=collection.length;
i<len;
++i){if(isCollection&&i>0){pieces.push(",")
}geometry=collection[i].geometry;
pieces.push(this.extractGeometry(geometry))
}if(isCollection){pieces.push(")")
}return pieces.join("")
},extractGeometry:function(geometry){var type=geometry.CLASS_NAME.split(".")[2].toLowerCase();
if(!this.extract[type]){return null
}if(this.internalProjection&&this.externalProjection){geometry=geometry.clone();
geometry.transform(this.internalProjection,this.externalProjection)
}var wktType=type=="collection"?"GEOMETRYCOLLECTION":type.toUpperCase();
var data=wktType+"("+this.extract[type].apply(this,[geometry])+")";
return data
},extract:{point:function(point){return point.x+" "+point.y
},multipoint:function(multipoint){var array=[];
for(var i=0,len=multipoint.components.length;
i<len;
++i){array.push("("+this.extract.point.apply(this,[multipoint.components[i]])+")")
}return array.join(",")
},linestring:function(linestring){var array=[];
for(var i=0,len=linestring.components.length;
i<len;
++i){array.push(this.extract.point.apply(this,[linestring.components[i]]))
}return array.join(",")
},multilinestring:function(multilinestring){var array=[];
for(var i=0,len=multilinestring.components.length;
i<len;
++i){array.push("("+this.extract.linestring.apply(this,[multilinestring.components[i]])+")")
}return array.join(",")
},polygon:function(polygon){var array=[];
for(var i=0,len=polygon.components.length;
i<len;
++i){array.push("("+this.extract.linestring.apply(this,[polygon.components[i]])+")")
}return array.join(",")
},multipolygon:function(multipolygon){var array=[];
for(var i=0,len=multipolygon.components.length;
i<len;
++i){array.push("("+this.extract.polygon.apply(this,[multipolygon.components[i]])+")")
}return array.join(",")
},collection:function(collection){var array=[];
for(var i=0,len=collection.components.length;
i<len;
++i){array.push(this.extractGeometry.apply(this,[collection.components[i]]))
}return array.join(",")
}},parse:{point:function(str){var coords=OpenLayers.String.trim(str).split(this.regExes.spaces);
return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(coords[0],coords[1]))
},multipoint:function(str){var point;
var points=OpenLayers.String.trim(str).split(",");
var components=[];
for(var i=0,len=points.length;
i<len;
++i){point=points[i].replace(this.regExes.trimParens,"$1");
components.push(this.parse.point.apply(this,[point]).geometry)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(components))
},linestring:function(str){var points=OpenLayers.String.trim(str).split(",");
var components=[];
for(var i=0,len=points.length;
i<len;
++i){components.push(this.parse.point.apply(this,[points[i]]).geometry)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(components))
},multilinestring:function(str){var line;
var lines=OpenLayers.String.trim(str).split(this.regExes.parenComma);
var components=[];
for(var i=0,len=lines.length;
i<len;
++i){line=lines[i].replace(this.regExes.trimParens,"$1");
components.push(this.parse.linestring.apply(this,[line]).geometry)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(components))
},polygon:function(str){var ring,linestring,linearring;
var rings=OpenLayers.String.trim(str).split(this.regExes.parenComma);
var components=[];
for(var i=0,len=rings.length;
i<len;
++i){ring=rings[i].replace(this.regExes.trimParens,"$1");
linestring=this.parse.linestring.apply(this,[ring]).geometry;
linearring=new OpenLayers.Geometry.LinearRing(linestring.components);
components.push(linearring)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(components))
},multipolygon:function(str){var polygon;
var polygons=OpenLayers.String.trim(str).split(this.regExes.doubleParenComma);
var components=[];
for(var i=0,len=polygons.length;
i<len;
++i){polygon=polygons[i].replace(this.regExes.trimParens,"$1");
components.push(this.parse.polygon.apply(this,[polygon]).geometry)
}return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(components))
},geometrycollection:function(str){str=str.replace(/,\s*([A-Za-z])/g,"|$1");
var wktArray=OpenLayers.String.trim(str).split("|");
var components=[];
for(var i=0,len=wktArray.length;
i<len;
++i){components.push(OpenLayers.Format.WKT.prototype.read.apply(this,[wktArray[i]]))
}return components
}},CLASS_NAME:"OpenLayers.Format.WKT"});
OpenLayers.Format.CQL=(function(){var tokens=["PROPERTY","COMPARISON","VALUE","LOGICAL"],patterns={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('\w+'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(text){var type=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(text);
if(type){var len=text.length;
var idx=text.indexOf("(",type[0].length);
if(idx>-1){var depth=1;
while(idx<len&&depth>0){idx++;
switch(text.charAt(idx)){case"(":depth++;
break;
case")":depth--;
break;
default:}}}return[text.substr(0,idx+1)]
}},END:/^$/},follows={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA"],BETWEEN:["VALUE"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},operators={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN},operatorReverse={},logicals={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},logicalReverse={},precedence={RPAREN:3,LOGICAL:2,COMPARISON:1};
var i;
for(i in operators){if(operators.hasOwnProperty(i)){operatorReverse[operators[i]]=i
}}for(i in logicals){if(logicals.hasOwnProperty(i)){logicalReverse[logicals[i]]=i
}}function tryToken(text,pattern){if(pattern instanceof RegExp){return pattern.exec(text)
}else{return pattern(text)
}}function nextToken(text,tokens){var i,token,len=tokens.length;
for(i=0;
i<len;
i++){token=tokens[i];
var pat=patterns[token];
var matches=tryToken(text,pat);
if(matches){var match=matches[0];
var remainder=text.substr(match.length).replace(/^\s*/,"");
return{type:token,text:match,remainder:remainder}
}}var msg="ERROR: In parsing: ["+text+"], expected one of: ";
for(i=0;
i<len;
i++){token=tokens[i];
msg+="\n    "+token+": "+patterns[token]
}throw new Error(msg)
}function tokenize(text){var results=[];
var token,expect=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];
do{token=nextToken(text,expect);
text=token.remainder;
expect=follows[token.type];
if(token.type!="END"&&!expect){throw new Error("No follows list for "+token.type)
}results.push(token)
}while(token.type!="END");
return results
}function buildAst(tokens){var operatorStack=[],postfix=[];
while(tokens.length){var tok=tokens.shift();
switch(tok.type){case"PROPERTY":case"GEOMETRY":case"VALUE":postfix.push(tok);
break;
case"COMPARISON":case"BETWEEN":case"LOGICAL":var p=precedence[tok.type];
while(operatorStack.length>0&&(precedence[operatorStack[operatorStack.length-1].type]<=p)){postfix.push(operatorStack.pop())
}operatorStack.push(tok);
break;
case"SPATIAL":case"NOT":case"LPAREN":operatorStack.push(tok);
break;
case"RPAREN":while(operatorStack.length>0&&(operatorStack[operatorStack.length-1].type!="LPAREN")){postfix.push(operatorStack.pop())
}operatorStack.pop();
if(operatorStack.length>0&&operatorStack[operatorStack.length-1].type=="SPATIAL"){postfix.push(operatorStack.pop())
}case"COMMA":case"END":break;
default:throw new Error("Unknown token type "+tok.type)
}}while(operatorStack.length>0){postfix.push(operatorStack.pop())
}function buildTree(){var tok=postfix.pop();
switch(tok.type){case"LOGICAL":var rhs=buildTree(),lhs=buildTree();
return new OpenLayers.Filter.Logical({filters:[lhs,rhs],type:logicals[tok.text.toUpperCase()]});
case"NOT":var operand=buildTree();
return new OpenLayers.Filter.Logical({filters:[operand],type:OpenLayers.Filter.Logical.NOT});
case"BETWEEN":var min,max,property;
postfix.pop();
max=buildTree();
min=buildTree();
property=buildTree();
return new OpenLayers.Filter.Comparison({property:property,lowerBoundary:min,upperBoundary:max,type:OpenLayers.Filter.Comparison.BETWEEN});
case"COMPARISON":var value=buildTree(),property=buildTree();
return new OpenLayers.Filter.Comparison({property:property,value:value,type:operators[tok.text.toUpperCase()]});
case"VALUE":if((/^'.*'$/).test(tok.text)){return tok.text.substr(1,tok.text.length-2)
}else{return Number(tok.text)
}case"SPATIAL":switch(tok.text.toUpperCase()){case"BBOX":var maxy=buildTree(),maxx=buildTree(),miny=buildTree(),minx=buildTree(),prop=buildTree();
return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:prop,value:OpenLayers.Bounds.fromArray([minx,miny,maxx,maxy])});
case"INTERSECTS":var value=buildTree(),property=buildTree();
return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:property,value:value});
case"WITHIN":var value=buildTree(),property=buildTree();
return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:property,value:value});
case"CONTAINS":var value=buildTree(),property=buildTree();
return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:property,value:value});
case"DWITHIN":var distance=buildTree(),value=buildTree(),property=buildTree();
return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:value,property:property,distance:Number(distance)})
}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(tok.text);
default:return tok.text
}}var result=buildTree();
if(postfix.length>0){var msg="Remaining tokens after building AST: \n";
for(var i=postfix.length-1;
i>=0;
i--){msg+=postfix[i].type+": "+postfix[i].text+"\n"
}throw new Error(msg)
}return result
}return OpenLayers.Class(OpenLayers.Format,{read:function(text){var result=buildAst(tokenize(text));
if(this.keepData){this.data=result
}return result
},write:function(filter){if(filter instanceof OpenLayers.Geometry){return filter.toString()
}switch(filter.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(filter.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+filter.property+","+filter.value.toBBOX()+")";
case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+filter.property+", "+this.write(filter.value)+", "+filter.distance+")";
case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+filter.property+", "+this.write(filter.value)+")";
case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+filter.property+", "+this.write(filter.value)+")";
case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+filter.property+", "+this.write(filter.value)+")";
default:throw new Error("Unknown spatial filter type: "+filter.type)
}case"OpenLayers.Filter.Logical":if(filter.type==OpenLayers.Filter.Logical.NOT){return"NOT ("+this.write(filter.filters[0])+")"
}else{var res="(";
var first=true;
for(var i=0;
i<filter.filters.length;
i++){if(first){first=false
}else{res+=") "+logicalReverse[filter.type]+" ("
}res+=this.write(filter.filters[i])
}return res+")"
}case"OpenLayers.Filter.Comparison":if(filter.type==OpenLayers.Filter.Comparison.BETWEEN){return filter.property+" BETWEEN "+this.write(filter.lowerBoundary)+" AND "+this.write(filter.upperBoundary)
}else{return filter.property+" "+operatorReverse[filter.type]+" "+this.write(filter.value)
}case undefined:if(typeof filter==="string"){return"'"+filter+"'"
}else{if(typeof filter==="number"){return String(filter)
}}default:throw new Error("Can't encode: "+filter.CLASS_NAME+" "+filter)
}},CLASS_NAME:"OpenLayers.Format.CQL"})
})();
OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:false,interestingTagsExclude:null,areaTags:null,initialize:function(options){var layer_defaults={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};
layer_defaults=OpenLayers.Util.extend(layer_defaults,options);
var interesting={};
for(var i=0;
i<layer_defaults.interestingTagsExclude.length;
i++){interesting[layer_defaults.interestingTagsExclude[i]]=true
}layer_defaults.interestingTagsExclude=interesting;
var area={};
for(var i=0;
i<layer_defaults.areaTags.length;
i++){area[layer_defaults.areaTags[i]]=true
}layer_defaults.areaTags=area;
this.externalProjection=new OpenLayers.Projection("EPSG:4326");
OpenLayers.Format.XML.prototype.initialize.apply(this,[layer_defaults])
},read:function(doc){if(typeof doc=="string"){doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc])
}var nodes=this.getNodes(doc);
var ways=this.getWays(doc);
var feat_list=new Array(ways.length);
for(var i=0;
i<ways.length;
i++){var point_list=new Array(ways[i].nodes.length);
var poly=this.isWayArea(ways[i])?1:0;
for(var j=0;
j<ways[i].nodes.length;
j++){var node=nodes[ways[i].nodes[j]];
var point=new OpenLayers.Geometry.Point(node.lon,node.lat);
point.osm_id=parseInt(ways[i].nodes[j]);
point_list[j]=point;
node.used=true
}var geometry=null;
if(poly){geometry=new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(point_list))
}else{geometry=new OpenLayers.Geometry.LineString(point_list)
}if(this.internalProjection&&this.externalProjection){geometry.transform(this.externalProjection,this.internalProjection)
}var feat=new OpenLayers.Feature.Vector(geometry,ways[i].tags);
feat.osm_id=parseInt(ways[i].id);
feat.fid="way."+feat.osm_id;
feat_list[i]=feat
}for(var node_id in nodes){var node=nodes[node_id];
if(!node.used||this.checkTags){var tags=null;
if(this.checkTags){var result=this.getTags(node.node,true);
if(node.used&&!result[1]){continue
}tags=result[0]
}else{tags=this.getTags(node.node)
}var feat=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(node.lon,node.lat),tags);
if(this.internalProjection&&this.externalProjection){feat.geometry.transform(this.externalProjection,this.internalProjection)
}feat.osm_id=parseInt(node_id);
feat.fid="node."+feat.osm_id;
feat_list.push(feat)
}node.node=null
}return feat_list
},getNodes:function(doc){var node_list=doc.getElementsByTagName("node");
var nodes={};
for(var i=0;
i<node_list.length;
i++){var node=node_list[i];
var id=node.getAttribute("id");
nodes[id]={lat:node.getAttribute("lat"),lon:node.getAttribute("lon"),node:node}
}return nodes
},getWays:function(doc){var way_list=doc.getElementsByTagName("way");
var return_ways=[];
for(var i=0;
i<way_list.length;
i++){var way=way_list[i];
var way_object={id:way.getAttribute("id")};
way_object.tags=this.getTags(way);
var node_list=way.getElementsByTagName("nd");
way_object.nodes=new Array(node_list.length);
for(var j=0;
j<node_list.length;
j++){way_object.nodes[j]=node_list[j].getAttribute("ref")
}return_ways.push(way_object)
}return return_ways
},getTags:function(dom_node,interesting_tags){var tag_list=dom_node.getElementsByTagName("tag");
var tags={};
var interesting=false;
for(var j=0;
j<tag_list.length;
j++){var key=tag_list[j].getAttribute("k");
tags[key]=tag_list[j].getAttribute("v");
if(interesting_tags){if(!this.interestingTagsExclude[key]){interesting=true
}}}return interesting_tags?[tags,interesting]:tags
},isWayArea:function(way){var poly_shaped=false;
var poly_tags=false;
if(way.nodes[0]==way.nodes[way.nodes.length-1]){poly_shaped=true
}if(this.checkTags){for(var key in way.tags){if(this.areaTags[key]){poly_tags=true;
break
}}}return poly_shaped&&(this.checkTags?poly_tags:true)
},write:function(features){if(!(OpenLayers.Util.isArray(features))){features=[features]
}this.osm_id=1;
this.created_nodes={};
var root_node=this.createElementNS(null,"osm");
root_node.setAttribute("version","0.5");
root_node.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);
for(var i=features.length-1;
i>=0;
i--){var nodes=this.createFeatureNodes(features[i]);
for(var j=0;
j<nodes.length;
j++){root_node.appendChild(nodes[j])
}}return OpenLayers.Format.XML.prototype.write.apply(this,[root_node])
},createFeatureNodes:function(feature){var nodes=[];
var className=feature.geometry.CLASS_NAME;
var type=className.substring(className.lastIndexOf(".")+1);
type=type.toLowerCase();
var builder=this.createXML[type];
if(builder){nodes=builder.apply(this,[feature])
}return nodes
},createXML:{point:function(point){var id=null;
var geometry=point.geometry?point.geometry:point;
if(this.internalProjection&&this.externalProjection){geometry=geometry.clone();
geometry.transform(this.internalProjection,this.externalProjection)
}var already_exists=false;
if(point.osm_id){id=point.osm_id;
if(this.created_nodes[id]){already_exists=true
}}else{id=-this.osm_id;
this.osm_id++
}if(already_exists){node=this.created_nodes[id]
}else{var node=this.createElementNS(null,"node")
}this.created_nodes[id]=node;
node.setAttribute("id",id);
node.setAttribute("lon",geometry.x);
node.setAttribute("lat",geometry.y);
if(point.attributes){this.serializeTags(point,node)
}this.setState(point,node);
return already_exists?[]:[node]
},linestring:function(feature){var id;
var nodes=[];
var geometry=feature.geometry;
if(feature.osm_id){id=feature.osm_id
}else{id=-this.osm_id;
this.osm_id++
}var way=this.createElementNS(null,"way");
way.setAttribute("id",id);
for(var i=0;
i<geometry.components.length;
i++){var node=this.createXML.point.apply(this,[geometry.components[i]]);
if(node.length){node=node[0];
var node_ref=node.getAttribute("id");
nodes.push(node)
}else{node_ref=geometry.components[i].osm_id;
node=this.created_nodes[node_ref]
}this.setState(feature,node);
var nd_dom=this.createElementNS(null,"nd");
nd_dom.setAttribute("ref",node_ref);
way.appendChild(nd_dom)
}this.serializeTags(feature,way);
nodes.push(way);
return nodes
},polygon:function(feature){var attrs=OpenLayers.Util.extend({area:"yes"},feature.attributes);
var feat=new OpenLayers.Feature.Vector(feature.geometry.components[0],attrs);
feat.osm_id=feature.osm_id;
return this.createXML.linestring.apply(this,[feat])
}},serializeTags:function(feature,node){for(var key in feature.attributes){var tag=this.createElementNS(null,"tag");
tag.setAttribute("k",key);
tag.setAttribute("v",feature.attributes[key]);
node.appendChild(tag)
}},setState:function(feature,node){if(feature.state){var state=null;
switch(feature.state){case OpenLayers.State.UPDATE:state="modify";
case OpenLayers.State.DELETE:state="delete"
}if(state){node.setAttribute("action",state)
}}},CLASS_NAME:"OpenLayers.Format.OSM"});
OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:true,extractTracks:true,extractRoutes:true,extractAttributes:true,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(options){this.externalProjection=new OpenLayers.Projection("EPSG:4326");
OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(doc){if(typeof doc=="string"){doc=OpenLayers.Format.XML.prototype.read.apply(this,[doc])
}var features=[];
if(this.extractTracks){var tracks=doc.getElementsByTagName("trk");
for(var i=0,len=tracks.length;
i<len;
i++){var attrs={};
if(this.extractAttributes){attrs=this.parseAttributes(tracks[i])
}var segs=this.getElementsByTagNameNS(tracks[i],tracks[i].namespaceURI,"trkseg");
for(var j=0,seglen=segs.length;
j<seglen;
j++){var track=this.extractSegment(segs[j],"trkpt");
features.push(new OpenLayers.Feature.Vector(track,attrs))
}}}if(this.extractRoutes){var routes=doc.getElementsByTagName("rte");
for(var k=0,klen=routes.length;
k<klen;
k++){var attrs={};
if(this.extractAttributes){attrs=this.parseAttributes(routes[k])
}var route=this.extractSegment(routes[k],"rtept");
features.push(new OpenLayers.Feature.Vector(route,attrs))
}}if(this.extractWaypoints){var waypoints=doc.getElementsByTagName("wpt");
for(var l=0,len=waypoints.length;
l<len;
l++){var attrs={};
if(this.extractAttributes){attrs=this.parseAttributes(waypoints[l])
}var wpt=new OpenLayers.Geometry.Point(waypoints[l].getAttribute("lon"),waypoints[l].getAttribute("lat"));
features.push(new OpenLayers.Feature.Vector(wpt,attrs))
}}if(this.internalProjection&&this.externalProjection){for(var g=0,featLength=features.length;
g<featLength;
g++){features[g].geometry.transform(this.externalProjection,this.internalProjection)
}}return features
},extractSegment:function(segment,segmentType){var points=this.getElementsByTagNameNS(segment,segment.namespaceURI,segmentType);
var point_features=[];
for(var i=0,len=points.length;
i<len;
i++){point_features.push(new OpenLayers.Geometry.Point(points[i].getAttribute("lon"),points[i].getAttribute("lat")))
}return new OpenLayers.Geometry.LineString(point_features)
},parseAttributes:function(node){var attributes={};
var attrNode=node.firstChild,value,name;
while(attrNode){if(attrNode.nodeType==1&&attrNode.firstChild){value=attrNode.firstChild;
if(value.nodeType==3||value.nodeType==4){name=(attrNode.prefix)?attrNode.nodeName.split(":")[1]:attrNode.nodeName;
if(name!="trkseg"&&name!="rtept"){attributes[name]=value.nodeValue
}}}attrNode=attrNode.nextSibling
}return attributes
},write:function(features,metadata){features=OpenLayers.Util.isArray(features)?features:[features];
var gpx=this.createElementNS(this.namespaces.gpx,"gpx");
gpx.setAttribute("version","1.1");
gpx.setAttribute("creator",this.creator);
this.setAttributes(gpx,{"xsi:schemaLocation":this.schemaLocation});
if(metadata&&typeof metadata=="object"){gpx.appendChild(this.buildMetadataNode(metadata))
}for(var i=0,len=features.length;
i<len;
i++){gpx.appendChild(this.buildFeatureNode(features[i]))
}return OpenLayers.Format.XML.prototype.write.apply(this,[gpx])
},buildMetadataNode:function(metadata){var types=["name","desc","author"],node=this.createElementNSPlus("gpx:metadata");
for(var i=0;
i<types.length;
i++){var type=types[i];
if(metadata[type]){var n=this.createElementNSPlus("gpx:"+type);
n.appendChild(this.createTextNode(metadata[type]));
node.appendChild(n)
}}return node
},buildFeatureNode:function(feature){var geometry=feature.geometry;
geometry=geometry.clone();
if(this.internalProjection&&this.externalProjection){geometry.transform(this.internalProjection,this.externalProjection)
}if(geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){var wpt=this.buildWptNode(geometry);
this.appendAttributesNode(wpt,feature);
return wpt
}else{var trkNode=this.createElementNSPlus("gpx:trk");
this.appendAttributesNode(trkNode,feature);
var trkSegNodes=this.buildTrkSegNode(geometry);
trkSegNodes=OpenLayers.Util.isArray(trkSegNodes)?trkSegNodes:[trkSegNodes];
for(var i=0,len=trkSegNodes.length;
i<len;
i++){trkNode.appendChild(trkSegNodes[i])
}return trkNode
}},buildTrkSegNode:function(geometry){var node,i,len,point,nodes;
if(geometry.CLASS_NAME=="OpenLayers.Geometry.LineString"||geometry.CLASS_NAME=="OpenLayers.Geometry.LinearRing"){node=this.createElementNSPlus("gpx:trkseg");
for(i=0,len=geometry.components.length;
i<len;
i++){point=geometry.components[i];
node.appendChild(this.buildTrkPtNode(point))
}return node
}else{nodes=[];
for(i=0,len=geometry.components.length;
i<len;
i++){nodes.push(this.buildTrkSegNode(geometry.components[i]))
}return nodes
}},buildTrkPtNode:function(point){var node=this.createElementNSPlus("gpx:trkpt");
node.setAttribute("lon",point.x);
node.setAttribute("lat",point.y);
return node
},buildWptNode:function(geometry){var node=this.createElementNSPlus("gpx:wpt");
node.setAttribute("lon",geometry.x);
node.setAttribute("lat",geometry.y);
return node
},appendAttributesNode:function(node,feature){var name=this.createElementNSPlus("gpx:name");
name.appendChild(this.createTextNode(feature.attributes.name||feature.id));
node.appendChild(name);
var desc=this.createElementNSPlus("gpx:desc");
desc.appendChild(this.createTextNode(feature.attributes.description||this.defaultDesc));
node.appendChild(desc)
},CLASS_NAME:"OpenLayers.Format.GPX"});
OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});
OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){var obj={};
this.readers.ogc.Filter.apply(this,[data,obj]);
return obj.filter
},readers:{ogc:{_expression:function(node){var obj,value="";
for(var child=node.firstChild;
child;
child=child.nextSibling){switch(child.nodeType){case 1:obj=this.readNode(child);
if(obj.property){value+="${"+obj.property+"}"
}else{if(obj.value!==undefined){value+=obj.value
}}break;
case 3:case 4:value+=child.nodeValue
}}return value
},Filter:function(node,parent){var obj={fids:[],filters:[]};
this.readChildNodes(node,obj);
if(obj.fids.length>0){parent.filter=new OpenLayers.Filter.FeatureId({fids:obj.fids})
}else{if(obj.filters.length>0){parent.filter=obj.filters[0]
}}},FeatureId:function(node,obj){var fid=node.getAttribute("fid");
if(fid){obj.fids.push(fid)
}},And:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},Or:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},Not:function(node,obj){var filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsLessThan:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsGreaterThan:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsLessThanOrEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsGreaterThanOrEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsBetween:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},Literal:function(node,obj){obj.value=OpenLayers.String.numericIf(this.getChildValue(node))
},PropertyName:function(node,filter){filter.property=this.getChildValue(node)
},LowerBoundary:function(node,filter){filter.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,node))
},UpperBoundary:function(node,filter){filter.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,node))
},Intersects:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.INTERSECTS)
},Within:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.WITHIN)
},Contains:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.CONTAINS)
},DWithin:function(node,obj){this.readSpatial(node,obj,OpenLayers.Filter.Spatial.DWITHIN)
},Distance:function(node,obj){obj.distance=parseInt(this.getChildValue(node));
obj.distanceUnits=node.getAttribute("units")
},Function:function(node,obj){return
}}},readSpatial:function(node,obj,type){var filter=new OpenLayers.Filter.Spatial({type:type});
this.readChildNodes(node,filter);
filter.value=filter.components[0];
delete filter.components;
obj.filters.push(filter)
},writeOgcExpression:function(value,node){if(value instanceof OpenLayers.Filter.Function){var child=this.writeNode("Function",value,node);
node.appendChild(child)
}else{this.writeNode("Literal",value,node)
}return node
},write:function(filter){return this.writers.ogc.Filter.apply(this,[filter])
},writeFeatureIdNodes:function(filter,node){for(var i=0,ii=filter.fids.length;
i<ii;
++i){this.writeNode("FeatureId",filter.fids[i],node)
}},writers:{ogc:{Filter:function(filter){var node=this.createElementNSPlus("ogc:Filter");
if(filter.type==="FID"){OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,filter,node)
}else{this.writeNode(this.getFilterType(filter),filter,node)
}return node
},FeatureId:function(fid){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:fid}})
},And:function(filter){var node=this.createElementNSPlus("ogc:And");
var childFilter;
for(var i=0,ii=filter.filters.length;
i<ii;
++i){childFilter=filter.filters[i];
if(childFilter.type==="FID"){OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,childFilter,node)
}else{this.writeNode(this.getFilterType(childFilter),childFilter,node)
}}return node
},Or:function(filter){var node=this.createElementNSPlus("ogc:Or");
var childFilter;
for(var i=0,ii=filter.filters.length;
i<ii;
++i){childFilter=filter.filters[i];
if(childFilter.type==="FID"){OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,childFilter,node)
}else{this.writeNode(this.getFilterType(childFilter),childFilter,node)
}}return node
},Not:function(filter){var node=this.createElementNSPlus("ogc:Not");
var childFilter=filter.filters[0];
if(childFilter.type==="FID"){OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,childFilter,node)
}else{this.writeNode(this.getFilterType(childFilter),childFilter,node)
}return node
},PropertyIsLessThan:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLessThan");
this.writeNode("PropertyName",filter,node);
this.writeOgcExpression(filter.value,node);
return node
},PropertyIsGreaterThan:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsGreaterThan");
this.writeNode("PropertyName",filter,node);
this.writeOgcExpression(filter.value,node);
return node
},PropertyIsLessThanOrEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");
this.writeNode("PropertyName",filter,node);
this.writeOgcExpression(filter.value,node);
return node
},PropertyIsGreaterThanOrEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");
this.writeNode("PropertyName",filter,node);
this.writeOgcExpression(filter.value,node);
return node
},PropertyIsBetween:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsBetween");
this.writeNode("PropertyName",filter,node);
this.writeNode("LowerBoundary",filter,node);
this.writeNode("UpperBoundary",filter,node);
return node
},PropertyName:function(filter){return this.createElementNSPlus("ogc:PropertyName",{value:filter.property})
},Literal:function(value){return this.createElementNSPlus("ogc:Literal",{value:value})
},LowerBoundary:function(filter){var node=this.createElementNSPlus("ogc:LowerBoundary");
this.writeOgcExpression(filter.lowerBoundary,node);
return node
},UpperBoundary:function(filter){var node=this.createElementNSPlus("ogc:UpperBoundary");
this.writeNode("Literal",filter.upperBoundary,node);
return node
},INTERSECTS:function(filter){return this.writeSpatial(filter,"Intersects")
},WITHIN:function(filter){return this.writeSpatial(filter,"Within")
},CONTAINS:function(filter){return this.writeSpatial(filter,"Contains")
},DWITHIN:function(filter){var node=this.writeSpatial(filter,"DWithin");
this.writeNode("Distance",filter,node);
return node
},Distance:function(filter){return this.createElementNSPlus("ogc:Distance",{attributes:{units:filter.distanceUnits},value:filter.distance})
},Function:function(filter){var node=this.createElementNSPlus("ogc:Function",{attributes:{name:filter.name}});
var params=filter.params;
for(var i=0,len=params.length;
i<len;
i++){this.writeOgcExpression(params[i],node)
}return node
}}},getFilterType:function(filter){var filterType=this.filterMap[filter.type];
if(!filterType){throw"Filter writing not supported for rule type: "+filter.type
}return filterType
},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});
OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(options){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[options])
},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsNotEqualTo:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsLike:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});
this.readChildNodes(node,filter);
var wildCard=node.getAttribute("wildCard");
var singleChar=node.getAttribute("singleChar");
var esc=node.getAttribute("escape");
filter.value2regex(wildCard,singleChar,esc);
obj.filters.push(filter)
}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsEqualTo");
this.writeNode("PropertyName",filter,node);
this.writeOgcExpression(filter.value,node);
return node
},PropertyIsNotEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");
this.writeNode("PropertyName",filter,node);
this.writeOgcExpression(filter.value,node);
return node
},PropertyIsLike:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.regex2value(),node);
return node
},BBOX:function(filter){var node=this.createElementNSPlus("ogc:BBOX");
filter.property&&this.writeNode("PropertyName",filter,node);
var box=this.writeNode("gml:Box",filter.value,node);
if(filter.projection){box.setAttribute("srsName",filter.projection)
}return node
}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(filter,name){var node=this.createElementNSPlus("ogc:"+name);
this.writeNode("PropertyName",filter,node);
if(filter.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",filter.value,node)
}else{var child;
if(filter.value instanceof OpenLayers.Geometry){child=this.writeNode("feature:_geometry",filter.value).firstChild
}else{child=this.writeNode("gml:Box",filter.value)
}if(filter.projection){child.setAttribute("srsName",filter.projection)
}node.appendChild(child)
}return node
},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});
OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(options){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[options])
},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(node,obj){var matchCase=node.getAttribute("matchCase");
var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!(matchCase==="false"||matchCase==="0")});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsNotEqualTo:function(node,obj){var matchCase=node.getAttribute("matchCase");
var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!(matchCase==="false"||matchCase==="0")});
this.readChildNodes(node,filter);
obj.filters.push(filter)
},PropertyIsLike:function(node,obj){var filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});
this.readChildNodes(node,filter);
var wildCard=node.getAttribute("wildCard");
var singleChar=node.getAttribute("singleChar");
var esc=node.getAttribute("escapeChar");
filter.value2regex(wildCard,singleChar,esc);
obj.filters.push(filter)
}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:filter.matchCase}});
this.writeNode("PropertyName",filter,node);
this.writeOgcExpression(filter.value,node);
return node
},PropertyIsNotEqualTo:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:filter.matchCase}});
this.writeNode("PropertyName",filter,node);
this.writeOgcExpression(filter.value,node);
return node
},PropertyIsLike:function(filter){var node=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:filter.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});
this.writeNode("PropertyName",filter,node);
this.writeNode("Literal",filter.regex2value(),node);
return node
},BBOX:function(filter){var node=this.createElementNSPlus("ogc:BBOX");
filter.property&&this.writeNode("PropertyName",filter,node);
var box=this.writeNode("gml:Envelope",filter.value);
if(filter.projection){box.setAttribute("srsName",filter.projection)
}node.appendChild(box);
return node
},SortBy:function(sortProperties){var node=this.createElementNSPlus("ogc:SortBy");
for(var i=0,l=sortProperties.length;
i<l;
i++){this.writeNode("ogc:SortProperty",sortProperties[i],node)
}return node
},SortProperty:function(sortProperty){var node=this.createElementNSPlus("ogc:SortProperty");
this.writeNode("ogc:PropertyName",sortProperty,node);
this.writeNode("ogc:SortOrder",(sortProperty.order=="DESC")?"DESC":"ASC",node);
return node
},SortOrder:function(value){var node=this.createElementNSPlus("ogc:SortOrder",{value:value});
return node
}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(filter,name){var node=this.createElementNSPlus("ogc:"+name);
this.writeNode("PropertyName",filter,node);
if(filter.value instanceof OpenLayers.Filter.Function){this.writeNode("Function",filter.value,node)
}else{var child;
if(filter.value instanceof OpenLayers.Geometry){child=this.writeNode("feature:_geometry",filter.value).firstChild
}else{child=this.writeNode("gml:Envelope",filter.value)
}if(filter.projection){child.setAttribute("srsName",filter.projection)
}node.appendChild(child)
}return node
},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});
OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:true,namedLayersAsArray:false,CLASS_NAME:"OpenLayers.Format.SLD"});
OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:false,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(data,options){options=OpenLayers.Util.applyDefaults(options,this.options);
var sld={namedLayers:options.namedLayersAsArray===true?[]:{}};
this.readChildNodes(data,sld);
return sld
},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(node,sld){sld.version=node.getAttribute("version");
this.readChildNodes(node,sld)
},Name:function(node,obj){obj.name=this.getChildValue(node)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,obj){obj.description=this.getChildValue(node)
},NamedLayer:function(node,sld){var layer={userStyles:[],namedStyles:[]};
this.readChildNodes(node,layer);
for(var i=0,len=layer.userStyles.length;
i<len;
++i){layer.userStyles[i].layerName=layer.name
}if(OpenLayers.Util.isArray(sld.namedLayers)){sld.namedLayers.push(layer)
}else{sld.namedLayers[layer.name]=layer
}},NamedStyle:function(node,layer){layer.namedStyles.push(this.getChildName(node.firstChild))
},UserStyle:function(node,layer){var obj={defaultsPerSymbolizer:true,rules:[]};
this.featureTypeCounter=-1;
this.readChildNodes(node,obj);
var style;
if(this.multipleSymbolizers){delete obj.defaultsPerSymbolizer;
style=new OpenLayers.Style2(obj)
}else{style=new OpenLayers.Style(this.defaultSymbolizer,obj)
}layer.userStyles.push(style)
},IsDefault:function(node,style){if(this.getChildValue(node)=="1"){style.isDefault=true
}},FeatureTypeStyle:function(node,style){++this.featureTypeCounter;
var obj={rules:this.multipleSymbolizers?style.rules:[]};
this.readChildNodes(node,obj);
if(!this.multipleSymbolizers){style.rules=obj.rules
}},Rule:function(node,obj){var config;
if(this.multipleSymbolizers){config={symbolizers:[]}
}var rule=new OpenLayers.Rule(config);
this.readChildNodes(node,rule);
obj.rules.push(rule)
},ElseFilter:function(node,rule){rule.elseFilter=true
},MinScaleDenominator:function(node,rule){rule.minScaleDenominator=parseFloat(this.getChildValue(node))
},MaxScaleDenominator:function(node,rule){rule.maxScaleDenominator=parseFloat(this.getChildValue(node))
},TextSymbolizer:function(node,rule){var config={};
this.readChildNodes(node,config);
if(this.multipleSymbolizers){config.zIndex=this.featureTypeCounter;
rule.symbolizers.push(new OpenLayers.Symbolizer.Text(config))
}else{rule.symbolizer.Text=OpenLayers.Util.applyDefaults(config,rule.symbolizer.Text)
}},LabelPlacement:function(node,symbolizer){this.readChildNodes(node,symbolizer)
},PointPlacement:function(node,symbolizer){var config={};
this.readChildNodes(node,config);
config.labelRotation=config.rotation;
delete config.rotation;
var labelAlign,x=symbolizer.labelAnchorPointX,y=symbolizer.labelAnchorPointY;
if(x<=1/3){labelAlign="l"
}else{if(x>1/3&&x<2/3){labelAlign="c"
}else{if(x>=2/3){labelAlign="r"
}}}if(y<=1/3){labelAlign+="b"
}else{if(y>1/3&&y<2/3){labelAlign+="m"
}else{if(y>=2/3){labelAlign+="t"
}}}config.labelAlign=labelAlign;
OpenLayers.Util.applyDefaults(symbolizer,config)
},AnchorPoint:function(node,symbolizer){this.readChildNodes(node,symbolizer)
},AnchorPointX:function(node,symbolizer){var labelAnchorPointX=this.readers.ogc._expression.call(this,node);
if(labelAnchorPointX){symbolizer.labelAnchorPointX=labelAnchorPointX
}},AnchorPointY:function(node,symbolizer){var labelAnchorPointY=this.readers.ogc._expression.call(this,node);
if(labelAnchorPointY){symbolizer.labelAnchorPointY=labelAnchorPointY
}},Displacement:function(node,symbolizer){this.readChildNodes(node,symbolizer)
},DisplacementX:function(node,symbolizer){var labelXOffset=this.readers.ogc._expression.call(this,node);
if(labelXOffset){symbolizer.labelXOffset=labelXOffset
}},DisplacementY:function(node,symbolizer){var labelYOffset=this.readers.ogc._expression.call(this,node);
if(labelYOffset){symbolizer.labelYOffset=labelYOffset
}},LinePlacement:function(node,symbolizer){this.readChildNodes(node,symbolizer)
},PerpendicularOffset:function(node,symbolizer){var labelPerpendicularOffset=this.readers.ogc._expression.call(this,node);
if(labelPerpendicularOffset){symbolizer.labelPerpendicularOffset=labelPerpendicularOffset
}},Label:function(node,symbolizer){var value=this.readers.ogc._expression.call(this,node);
if(value){symbolizer.label=value
}},Font:function(node,symbolizer){this.readChildNodes(node,symbolizer)
},Halo:function(node,symbolizer){var obj={};
this.readChildNodes(node,obj);
symbolizer.haloRadius=obj.haloRadius;
symbolizer.haloColor=obj.fillColor;
symbolizer.haloOpacity=obj.fillOpacity
},Radius:function(node,symbolizer){var radius=this.readers.ogc._expression.call(this,node);
if(radius!=null){symbolizer.haloRadius=radius
}},RasterSymbolizer:function(node,rule){var config={};
this.readChildNodes(node,config);
if(this.multipleSymbolizers){config.zIndex=this.featureTypeCounter;
rule.symbolizers.push(new OpenLayers.Symbolizer.Raster(config))
}else{rule.symbolizer.Raster=OpenLayers.Util.applyDefaults(config,rule.symbolizer.Raster)
}},Geometry:function(node,obj){obj.geometry={};
this.readChildNodes(node,obj.geometry)
},ColorMap:function(node,symbolizer){symbolizer.colorMap=[];
this.readChildNodes(node,symbolizer.colorMap)
},ColorMapEntry:function(node,colorMap){var q=node.getAttribute("quantity");
var o=node.getAttribute("opacity");
colorMap.push({color:node.getAttribute("color"),quantity:q!==null?parseFloat(q):undefined,label:node.getAttribute("label")||undefined,opacity:o!==null?parseFloat(o):undefined})
},LineSymbolizer:function(node,rule){var config={};
this.readChildNodes(node,config);
if(this.multipleSymbolizers){config.zIndex=this.featureTypeCounter;
rule.symbolizers.push(new OpenLayers.Symbolizer.Line(config))
}else{rule.symbolizer.Line=OpenLayers.Util.applyDefaults(config,rule.symbolizer.Line)
}},PolygonSymbolizer:function(node,rule){var config={fill:false,stroke:false};
if(!this.multipleSymbolizers){config=rule.symbolizer.Polygon||config
}this.readChildNodes(node,config);
if(this.multipleSymbolizers){config.zIndex=this.featureTypeCounter;
rule.symbolizers.push(new OpenLayers.Symbolizer.Polygon(config))
}else{rule.symbolizer.Polygon=config
}},PointSymbolizer:function(node,rule){var config={fill:false,stroke:false,graphic:false};
if(!this.multipleSymbolizers){config=rule.symbolizer.Point||config
}this.readChildNodes(node,config);
if(this.multipleSymbolizers){config.zIndex=this.featureTypeCounter;
rule.symbolizers.push(new OpenLayers.Symbolizer.Point(config))
}else{rule.symbolizer.Point=config
}},Stroke:function(node,symbolizer){symbolizer.stroke=true;
this.readChildNodes(node,symbolizer)
},Fill:function(node,symbolizer){symbolizer.fill=true;
this.readChildNodes(node,symbolizer)
},CssParameter:function(node,symbolizer){var cssProperty=node.getAttribute("name");
var symProperty=this.cssMap[cssProperty];
if(symbolizer.label){if(cssProperty==="fill"){symProperty="fontColor"
}else{if(cssProperty==="fill-opacity"){symProperty="fontOpacity"
}}}if(symProperty){var value=this.readers.ogc._expression.call(this,node);
if(value){symbolizer[symProperty]=value
}}},Graphic:function(node,symbolizer){symbolizer.graphic=true;
var graphic={};
this.readChildNodes(node,graphic);
var properties=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"];
var prop,value;
for(var i=0,len=properties.length;
i<len;
++i){prop=properties[i];
value=graphic[prop];
if(value!=undefined){symbolizer[prop]=value
}}if(graphic.opacity!=undefined){symbolizer.graphicOpacity=graphic.opacity
}if(graphic.size!=undefined){var pointRadius=graphic.size/2;
if(isNaN(pointRadius)){symbolizer.graphicWidth=graphic.size
}else{symbolizer.pointRadius=graphic.size/2
}}if(graphic.href!=undefined){symbolizer.externalGraphic=graphic.href
}if(graphic.rotation!=undefined){symbolizer.rotation=graphic.rotation
}},ExternalGraphic:function(node,graphic){this.readChildNodes(node,graphic)
},Mark:function(node,graphic){this.readChildNodes(node,graphic)
},WellKnownName:function(node,graphic){graphic.graphicName=this.getChildValue(node)
},Opacity:function(node,obj){var opacity=this.readers.ogc._expression.call(this,node);
if(opacity){obj.opacity=opacity
}},Size:function(node,obj){var size=this.readers.ogc._expression.call(this,node);
if(size){obj.size=size
}},Rotation:function(node,obj){var rotation=this.readers.ogc._expression.call(this,node);
if(rotation){obj.rotation=rotation
}},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")
},Format:function(node,graphic){graphic.graphicFormat=this.getChildValue(node)
}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(sym){var css=null;
for(var prop in this.cssMap){if(this.cssMap[prop]==sym){css=prop;
break
}}return css
},getGraphicFormat:function(href){var format,regex;
for(var key in this.graphicFormats){if(this.graphicFormats[key].test(href)){format=key;
break
}}return format||this.defaultGraphicFormat
},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(sld){return this.writers.sld.StyledLayerDescriptor.apply(this,[sld])
},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(nodeName,value){var node=this.createElementNSPlus(nodeName);
var tokens=typeof value=="string"?value.split("${"):[value];
node.appendChild(this.createTextNode(tokens[0]));
var item,last;
for(var i=1,len=tokens.length;
i<len;
i++){item=tokens[i];
last=item.indexOf("}");
if(last>0){this.writeNode("ogc:PropertyName",{property:item.substring(0,last)},node);
node.appendChild(this.createTextNode(item.substring(++last)))
}else{node.appendChild(this.createTextNode("${"+item))
}}return node
},StyledLayerDescriptor:function(sld){var root=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});
root.setAttribute("xmlns:ogc",this.namespaces.ogc);
root.setAttribute("xmlns:gml",this.namespaces.gml);
if(sld.name){this.writeNode("Name",sld.name,root)
}if(sld.title){this.writeNode("Title",sld.title,root)
}if(sld.description){this.writeNode("Abstract",sld.description,root)
}if(OpenLayers.Util.isArray(sld.namedLayers)){for(var i=0,len=sld.namedLayers.length;
i<len;
++i){this.writeNode("NamedLayer",sld.namedLayers[i],root)
}}else{for(var name in sld.namedLayers){this.writeNode("NamedLayer",sld.namedLayers[name],root)
}}return root
},Name:function(name){return this.createElementNSPlus("sld:Name",{value:name})
},Title:function(title){return this.createElementNSPlus("sld:Title",{value:title})
},Abstract:function(description){return this.createElementNSPlus("sld:Abstract",{value:description})
},NamedLayer:function(layer){var node=this.createElementNSPlus("sld:NamedLayer");
this.writeNode("Name",layer.name,node);
if(layer.namedStyles){for(var i=0,len=layer.namedStyles.length;
i<len;
++i){this.writeNode("NamedStyle",layer.namedStyles[i],node)
}}if(layer.userStyles){for(var i=0,len=layer.userStyles.length;
i<len;
++i){this.writeNode("UserStyle",layer.userStyles[i],node)
}}return node
},NamedStyle:function(name){var node=this.createElementNSPlus("sld:NamedStyle");
this.writeNode("Name",name,node);
return node
},UserStyle:function(style){var node=this.createElementNSPlus("sld:UserStyle");
if(style.name){this.writeNode("Name",style.name,node)
}if(style.title){this.writeNode("Title",style.title,node)
}if(style.description){this.writeNode("Abstract",style.description,node)
}if(style.isDefault){this.writeNode("IsDefault",style.isDefault,node)
}if(this.multipleSymbolizers&&style.rules){var rulesByZ={0:[]};
var zValues=[0];
var rule,ruleMap,symbolizer,zIndex,clone;
for(var i=0,ii=style.rules.length;
i<ii;
++i){rule=style.rules[i];
if(rule.symbolizers){ruleMap={};
for(var j=0,jj=rule.symbolizers.length;
j<jj;
++j){symbolizer=rule.symbolizers[j];
zIndex=symbolizer.zIndex;
if(!(zIndex in ruleMap)){clone=rule.clone();
clone.symbolizers=[];
ruleMap[zIndex]=clone
}ruleMap[zIndex].symbolizers.push(symbolizer.clone())
}for(zIndex in ruleMap){if(!(zIndex in rulesByZ)){zValues.push(zIndex);
rulesByZ[zIndex]=[]
}rulesByZ[zIndex].push(ruleMap[zIndex])
}}else{rulesByZ[0].push(rule.clone())
}}zValues.sort();
var rules;
for(var i=0,ii=zValues.length;
i<ii;
++i){rules=rulesByZ[zValues[i]];
if(rules.length>0){clone=style.clone();
clone.rules=rulesByZ[zValues[i]];
this.writeNode("FeatureTypeStyle",clone,node)
}}}else{this.writeNode("FeatureTypeStyle",style,node)
}return node
},IsDefault:function(bool){return this.createElementNSPlus("sld:IsDefault",{value:(bool)?"1":"0"})
},FeatureTypeStyle:function(style){var node=this.createElementNSPlus("sld:FeatureTypeStyle");
for(var i=0,len=style.rules.length;
i<len;
++i){this.writeNode("Rule",style.rules[i],node)
}return node
},Rule:function(rule){var node=this.createElementNSPlus("sld:Rule");
if(rule.name){this.writeNode("Name",rule.name,node)
}if(rule.title){this.writeNode("Title",rule.title,node)
}if(rule.description){this.writeNode("Abstract",rule.description,node)
}if(rule.elseFilter){this.writeNode("ElseFilter",null,node)
}else{if(rule.filter){this.writeNode("ogc:Filter",rule.filter,node)
}}if(rule.minScaleDenominator!=undefined){this.writeNode("MinScaleDenominator",rule.minScaleDenominator,node)
}if(rule.maxScaleDenominator!=undefined){this.writeNode("MaxScaleDenominator",rule.maxScaleDenominator,node)
}var type,symbolizer;
if(this.multipleSymbolizers&&rule.symbolizers){var symbolizer;
for(var i=0,ii=rule.symbolizers.length;
i<ii;
++i){symbolizer=rule.symbolizers[i];
type=symbolizer.CLASS_NAME.split(".").pop();
this.writeNode(type+"Symbolizer",symbolizer,node)
}}else{var types=OpenLayers.Style.SYMBOLIZER_PREFIXES;
for(var i=0,len=types.length;
i<len;
++i){type=types[i];
symbolizer=rule.symbolizer[type];
if(symbolizer){this.writeNode(type+"Symbolizer",symbolizer,node)
}}}return node
},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")
},MinScaleDenominator:function(scale){return this.createElementNSPlus("sld:MinScaleDenominator",{value:scale})
},MaxScaleDenominator:function(scale){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:scale})
},LineSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:LineSymbolizer");
this.writeNode("Stroke",symbolizer,node);
return node
},Stroke:function(symbolizer){var node=this.createElementNSPlus("sld:Stroke");
if(symbolizer.strokeColor!=undefined){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeColor"},node)
}if(symbolizer.strokeOpacity!=undefined){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeOpacity"},node)
}if(symbolizer.strokeWidth!=undefined){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeWidth"},node)
}if(symbolizer.strokeDashstyle!=undefined&&symbolizer.strokeDashstyle!=="solid"){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeDashstyle"},node)
}if(symbolizer.strokeLinecap!=undefined){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"strokeLinecap"},node)
}return node
},CssParameter:function(obj){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(obj.key)},value:obj.symbolizer[obj.key]})
},TextSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:TextSymbolizer");
if(symbolizer.label!=null){this.writeNode("Label",symbolizer.label,node)
}if(symbolizer.fontFamily!=null||symbolizer.fontSize!=null||symbolizer.fontWeight!=null||symbolizer.fontStyle!=null){this.writeNode("Font",symbolizer,node)
}if(symbolizer.labelAnchorPointX!=null||symbolizer.labelAnchorPointY!=null||symbolizer.labelAlign!=null||symbolizer.labelXOffset!=null||symbolizer.labelYOffset!=null||symbolizer.labelRotation!=null||symbolizer.labelPerpendicularOffset!=null){this.writeNode("LabelPlacement",symbolizer,node)
}if(symbolizer.haloRadius!=null||symbolizer.haloColor!=null||symbolizer.haloOpacity!=null){this.writeNode("Halo",symbolizer,node)
}if(symbolizer.fontColor!=null||symbolizer.fontOpacity!=null){this.writeNode("Fill",{fillColor:symbolizer.fontColor,fillOpacity:symbolizer.fontOpacity},node)
}return node
},LabelPlacement:function(symbolizer){var node=this.createElementNSPlus("sld:LabelPlacement");
if((symbolizer.labelAnchorPointX!=null||symbolizer.labelAnchorPointY!=null||symbolizer.labelAlign!=null||symbolizer.labelXOffset!=null||symbolizer.labelYOffset!=null||symbolizer.labelRotation!=null)&&symbolizer.labelPerpendicularOffset==null){this.writeNode("PointPlacement",symbolizer,node)
}if(symbolizer.labelPerpendicularOffset!=null){this.writeNode("LinePlacement",symbolizer,node)
}return node
},LinePlacement:function(symbolizer){var node=this.createElementNSPlus("sld:LinePlacement");
this.writeNode("PerpendicularOffset",symbolizer.labelPerpendicularOffset,node);
return node
},PerpendicularOffset:function(value){return this.createElementNSPlus("sld:PerpendicularOffset",{value:value})
},PointPlacement:function(symbolizer){var node=this.createElementNSPlus("sld:PointPlacement");
if(symbolizer.labelAnchorPointX!=null||symbolizer.labelAnchorPointY!=null||symbolizer.labelAlign!=null){this.writeNode("AnchorPoint",symbolizer,node)
}if(symbolizer.labelXOffset!=null||symbolizer.labelYOffset!=null){this.writeNode("Displacement",symbolizer,node)
}if(symbolizer.labelRotation!=null){this.writeNode("Rotation",symbolizer.labelRotation,node)
}return node
},AnchorPoint:function(symbolizer){var node=this.createElementNSPlus("sld:AnchorPoint");
var x=symbolizer.labelAnchorPointX,y=symbolizer.labelAnchorPointY;
if(x!=null){this.writeNode("AnchorPointX",x,node)
}if(y!=null){this.writeNode("AnchorPointY",y,node)
}if(x==null&&y==null){var xAlign=symbolizer.labelAlign.substr(0,1),yAlign=symbolizer.labelAlign.substr(1,1);
if(xAlign==="l"){x=0
}else{if(xAlign==="c"){x=0.5
}else{if(xAlign==="r"){x=1
}}}if(yAlign==="b"){y=0
}else{if(yAlign==="m"){y=0.5
}else{if(yAlign==="t"){y=1
}}}this.writeNode("AnchorPointX",x,node);
this.writeNode("AnchorPointY",y,node)
}return node
},AnchorPointX:function(value){return this.createElementNSPlus("sld:AnchorPointX",{value:value})
},AnchorPointY:function(value){return this.createElementNSPlus("sld:AnchorPointY",{value:value})
},Displacement:function(symbolizer){var node=this.createElementNSPlus("sld:Displacement");
if(symbolizer.labelXOffset!=null){this.writeNode("DisplacementX",symbolizer.labelXOffset,node)
}if(symbolizer.labelYOffset!=null){this.writeNode("DisplacementY",symbolizer.labelYOffset,node)
}return node
},DisplacementX:function(value){return this.createElementNSPlus("sld:DisplacementX",{value:value})
},DisplacementY:function(value){return this.createElementNSPlus("sld:DisplacementY",{value:value})
},Font:function(symbolizer){var node=this.createElementNSPlus("sld:Font");
if(symbolizer.fontFamily){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontFamily"},node)
}if(symbolizer.fontSize){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontSize"},node)
}if(symbolizer.fontWeight){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontWeight"},node)
}if(symbolizer.fontStyle){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fontStyle"},node)
}return node
},Label:function(label){return this.writers.sld._OGCExpression.call(this,"sld:Label",label)
},Halo:function(symbolizer){var node=this.createElementNSPlus("sld:Halo");
if(symbolizer.haloRadius){this.writeNode("Radius",symbolizer.haloRadius,node)
}if(symbolizer.haloColor||symbolizer.haloOpacity){this.writeNode("Fill",{fillColor:symbolizer.haloColor,fillOpacity:symbolizer.haloOpacity},node)
}return node
},Radius:function(value){return this.createElementNSPlus("sld:Radius",{value:value})
},RasterSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:RasterSymbolizer");
if(symbolizer.geometry){this.writeNode("Geometry",symbolizer.geometry,node)
}if(symbolizer.opacity){this.writeNode("Opacity",symbolizer.opacity,node)
}if(symbolizer.colorMap){this.writeNode("ColorMap",symbolizer.colorMap,node)
}return node
},Geometry:function(geometry){var node=this.createElementNSPlus("sld:Geometry");
if(geometry.property){this.writeNode("ogc:PropertyName",geometry,node)
}return node
},ColorMap:function(colorMap){var node=this.createElementNSPlus("sld:ColorMap");
for(var i=0,len=colorMap.length;
i<len;
++i){this.writeNode("ColorMapEntry",colorMap[i],node)
}return node
},ColorMapEntry:function(colorMapEntry){var node=this.createElementNSPlus("sld:ColorMapEntry");
var a=colorMapEntry;
node.setAttribute("color",a.color);
a.opacity!==undefined&&node.setAttribute("opacity",parseFloat(a.opacity));
a.quantity!==undefined&&node.setAttribute("quantity",parseFloat(a.quantity));
a.label!==undefined&&node.setAttribute("label",a.label);
return node
},PolygonSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:PolygonSymbolizer");
if(symbolizer.fill!==false){this.writeNode("Fill",symbolizer,node)
}if(symbolizer.stroke!==false){this.writeNode("Stroke",symbolizer,node)
}return node
},Fill:function(symbolizer){var node=this.createElementNSPlus("sld:Fill");
if(symbolizer.fillColor){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fillColor"},node)
}if(symbolizer.fillOpacity!=null){this.writeNode("CssParameter",{symbolizer:symbolizer,key:"fillOpacity"},node)
}return node
},PointSymbolizer:function(symbolizer){var node=this.createElementNSPlus("sld:PointSymbolizer");
this.writeNode("Graphic",symbolizer,node);
return node
},Graphic:function(symbolizer){var node=this.createElementNSPlus("sld:Graphic");
if(symbolizer.externalGraphic!=undefined){this.writeNode("ExternalGraphic",symbolizer,node)
}else{this.writeNode("Mark",symbolizer,node)
}if(symbolizer.graphicOpacity!=undefined){this.writeNode("Opacity",symbolizer.graphicOpacity,node)
}if(symbolizer.pointRadius!=undefined){this.writeNode("Size",symbolizer.pointRadius*2,node)
}else{if(symbolizer.graphicWidth!=undefined){this.writeNode("Size",symbolizer.graphicWidth,node)
}}if(symbolizer.rotation!=undefined){this.writeNode("Rotation",symbolizer.rotation,node)
}return node
},ExternalGraphic:function(symbolizer){var node=this.createElementNSPlus("sld:ExternalGraphic");
this.writeNode("OnlineResource",symbolizer.externalGraphic,node);
var format=symbolizer.graphicFormat||this.getGraphicFormat(symbolizer.externalGraphic);
this.writeNode("Format",format,node);
return node
},Mark:function(symbolizer){var node=this.createElementNSPlus("sld:Mark");
if(symbolizer.graphicName){this.writeNode("WellKnownName",symbolizer.graphicName,node)
}if(symbolizer.fill!==false){this.writeNode("Fill",symbolizer,node)
}if(symbolizer.stroke!==false){this.writeNode("Stroke",symbolizer,node)
}return node
},WellKnownName:function(name){return this.createElementNSPlus("sld:WellKnownName",{value:name})
},Opacity:function(value){return this.createElementNSPlus("sld:Opacity",{value:value})
},Size:function(value){return this.writers.sld._OGCExpression.call(this,"sld:Size",value)
},Rotation:function(value){return this.createElementNSPlus("sld:Rotation",{value:value})
},OnlineResource:function(href){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":href}})
},Format:function(format){return this.createElementNSPlus("sld:Format",{value:format})
}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"});
OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"});
OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(node,obj){var value=this.readers.ogc._expression.call(this,node);
if(value){obj.priority=value
}},VendorOption:function(node,obj){if(!obj.vendorOptions){obj.vendorOptions={}
}obj.vendorOptions[node.getAttribute("name")]=this.getChildValue(node)
}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(priority){return this.writers.sld._OGCExpression.call(this,"sld:Priority",priority)
},VendorOption:function(option){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:option.name},value:option.value})
},TextSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers;
var node=writers.sld.TextSymbolizer.apply(this,arguments);
if(symbolizer.graphic!==false&&(symbolizer.externalGraphic||symbolizer.graphicName)){this.writeNode("Graphic",symbolizer,node)
}if("priority" in symbolizer){this.writeNode("Priority",symbolizer.priority,node)
}return this.addVendorOptions(node,symbolizer)
},PointSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers;
var node=writers.sld.PointSymbolizer.apply(this,arguments);
return this.addVendorOptions(node,symbolizer)
},LineSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers;
var node=writers.sld.LineSymbolizer.apply(this,arguments);
return this.addVendorOptions(node,symbolizer)
},PolygonSymbolizer:function(symbolizer){var writers=OpenLayers.Format.SLD.v1_0_0.prototype.writers;
var node=writers.sld.PolygonSymbolizer.apply(this,arguments);
return this.addVendorOptions(node,symbolizer)
}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(node,symbolizer){var options=symbolizer.vendorOptions;
if(options){for(var key in symbolizer.vendorOptions){this.writeNode("VendorOption",{name:key,value:symbolizer.vendorOptions[key]},node)
}}return node
},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"});
OpenLayers.Format.CSWGetDomain=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.CSWGetDomain.DEFAULTS);
var cls=OpenLayers.Format.CSWGetDomain["v"+options.version.replace(/\./g,"_")];
if(!cls){throw"Unsupported CSWGetDomain version: "+options.version
}return new cls(options)
};
OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"};
OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var obj={};
this.readNode(data,obj);
return obj
},readers:{csw:{GetDomainResponse:function(node,obj){this.readChildNodes(node,obj)
},DomainValues:function(node,obj){if(!(OpenLayers.Util.isArray(obj.DomainValues))){obj.DomainValues=[]
}var attrs=node.attributes;
var domainValue={};
for(var i=0,len=attrs.length;
i<len;
++i){domainValue[attrs[i].name]=attrs[i].nodeValue
}this.readChildNodes(node,domainValue);
obj.DomainValues.push(domainValue)
},PropertyName:function(node,obj){obj.PropertyName=this.getChildValue(node)
},ParameterName:function(node,obj){obj.ParameterName=this.getChildValue(node)
},ListOfValues:function(node,obj){if(!(OpenLayers.Util.isArray(obj.ListOfValues))){obj.ListOfValues=[]
}this.readChildNodes(node,obj.ListOfValues)
},Value:function(node,obj){var attrs=node.attributes;
var value={};
for(var i=0,len=attrs.length;
i<len;
++i){value[attrs[i].name]=attrs[i].nodeValue
}value.value=this.getChildValue(node);
obj.push({Value:value})
},ConceptualScheme:function(node,obj){obj.ConceptualScheme={};
this.readChildNodes(node,obj.ConceptualScheme)
},Name:function(node,obj){obj.Name=this.getChildValue(node)
},Document:function(node,obj){obj.Document=this.getChildValue(node)
},Authority:function(node,obj){obj.Authority=this.getChildValue(node)
},RangeOfValues:function(node,obj){obj.RangeOfValues={};
this.readChildNodes(node,obj.RangeOfValues)
},MinValue:function(node,obj){var attrs=node.attributes;
var value={};
for(var i=0,len=attrs.length;
i<len;
++i){value[attrs[i].name]=attrs[i].nodeValue
}value.value=this.getChildValue(node);
obj.MinValue=value
},MaxValue:function(node,obj){var attrs=node.attributes;
var value={};
for(var i=0,len=attrs.length;
i<len;
++i){value[attrs[i].name]=attrs[i].nodeValue
}value.value=this.getChildValue(node);
obj.MaxValue=value
}}},write:function(options){var node=this.writeNode("csw:GetDomain",options);
return OpenLayers.Format.XML.prototype.write.apply(this,[node])
},writers:{csw:{GetDomain:function(options){var node=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});
if(options.PropertyName||this.PropertyName){this.writeNode("csw:PropertyName",options.PropertyName||this.PropertyName,node)
}else{if(options.ParameterName||this.ParameterName){this.writeNode("csw:ParameterName",options.ParameterName||this.ParameterName,node)
}}this.readChildNodes(node,options);
return node
},PropertyName:function(value){var node=this.createElementNSPlus("csw:PropertyName",{value:value});
return node
},ParameterName:function(value){var node=this.createElementNSPlus("csw:ParameterName",{value:value});
return node
}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"});
OpenLayers.Format.CSWGetRecords=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.CSWGetRecords.DEFAULTS);
var cls=OpenLayers.Format.CSWGetRecords["v"+options.version.replace(/\./g,"_")];
if(!cls){throw"Unsupported CSWGetRecords version: "+options.version
}return new cls(options)
};
OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"};
OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var obj={};
this.readNode(data,obj);
return obj
},readers:{csw:{GetRecordsResponse:function(node,obj){obj.records=[];
this.readChildNodes(node,obj);
var version=this.getAttributeNS(node,"","version");
if(version!=""){obj.version=version
}},RequestId:function(node,obj){obj.RequestId=this.getChildValue(node)
},SearchStatus:function(node,obj){obj.SearchStatus={};
var timestamp=this.getAttributeNS(node,"","timestamp");
if(timestamp!=""){obj.SearchStatus.timestamp=timestamp
}},SearchResults:function(node,obj){this.readChildNodes(node,obj);
var attrs=node.attributes;
var SearchResults={};
for(var i=0,len=attrs.length;
i<len;
++i){if((attrs[i].name=="numberOfRecordsMatched")||(attrs[i].name=="numberOfRecordsReturned")||(attrs[i].name=="nextRecord")){SearchResults[attrs[i].name]=parseInt(attrs[i].nodeValue)
}else{SearchResults[attrs[i].name]=attrs[i].nodeValue
}}obj.SearchResults=SearchResults
},SummaryRecord:function(node,obj){var record={type:"SummaryRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},BriefRecord:function(node,obj){var record={type:"BriefRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},DCMIRecord:function(node,obj){var record={type:"DCMIRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},Record:function(node,obj){var record={type:"Record"};
this.readChildNodes(node,record);
obj.records.push(record)
},"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
obj[name]=this.getChildValue(node)
}},geonet:{info:function(node,obj){var gninfo={};
this.readChildNodes(node,gninfo);
obj.gninfo=gninfo
}},dc:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
if(!(OpenLayers.Util.isArray(obj[name]))){obj[name]=[]
}var dc_element={};
var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){dc_element[attrs[i].name]=attrs[i].nodeValue
}dc_element.value=this.getChildValue(node);
if(dc_element.value!=""){obj[name].push(dc_element)
}}},dct:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
if(!(OpenLayers.Util.isArray(obj[name]))){obj[name]=[]
}obj[name].push(this.getChildValue(node))
}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(node,obj){if(obj.bounds){obj.BoundingBox=[{crs:obj.projection,value:[obj.bounds.left,obj.bounds.bottom,obj.bounds.right,obj.bounds.top]}];
delete obj.projection;
delete obj.bounds
}OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)
}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(options){var node=this.writeNode("csw:GetRecords",options);
node.setAttribute("xmlns:gmd",this.namespaces.gmd);
return OpenLayers.Format.XML.prototype.write.apply(this,[node])
},writers:{csw:{GetRecords:function(options){if(!options){options={}
}var node=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:options.requestId||this.requestId,resultType:options.resultType||this.resultType,outputFormat:options.outputFormat||this.outputFormat,outputSchema:options.outputSchema||this.outputSchema,startPosition:options.startPosition||this.startPosition,maxRecords:options.maxRecords||this.maxRecords}});
if(options.DistributedSearch||this.DistributedSearch){this.writeNode("csw:DistributedSearch",options.DistributedSearch||this.DistributedSearch,node)
}var ResponseHandler=options.ResponseHandler||this.ResponseHandler;
if(OpenLayers.Util.isArray(ResponseHandler)&&ResponseHandler.length>0){for(var i=0,len=ResponseHandler.length;
i<len;
i++){this.writeNode("csw:ResponseHandler",ResponseHandler[i],node)
}}this.writeNode("Query",options.Query||this.Query,node);
return node
},DistributedSearch:function(options){var node=this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:options.hopCount}});
return node
},ResponseHandler:function(options){var node=this.createElementNSPlus("csw:ResponseHandler",{value:options.value});
return node
},Query:function(options){if(!options){options={}
}var node=this.createElementNSPlus("csw:Query",{attributes:{typeNames:options.typeNames||"csw:Record"}});
var ElementName=options.ElementName;
if(OpenLayers.Util.isArray(ElementName)&&ElementName.length>0){for(var i=0,len=ElementName.length;
i<len;
i++){this.writeNode("csw:ElementName",ElementName[i],node)
}}else{this.writeNode("csw:ElementSetName",options.ElementSetName||{value:"summary"},node)
}if(options.Constraint){this.writeNode("csw:Constraint",options.Constraint,node)
}if(options.SortBy){this.writeNode("ogc:SortBy",options.SortBy,node)
}return node
},ElementName:function(options){var node=this.createElementNSPlus("csw:ElementName",{value:options.value});
return node
},ElementSetName:function(options){var node=this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:options.typeNames},value:options.value});
return node
},Constraint:function(options){var node=this.createElementNSPlus("csw:Constraint",{attributes:{version:options.version}});
if(options.Filter){var format=new OpenLayers.Format.Filter({version:options.version});
node.appendChild(format.write(options.Filter))
}else{if(options.CqlText){var child=this.createElementNSPlus("CqlText",{value:options.CqlText.value});
node.appendChild(child)
}}return node
}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"});
OpenLayers.Format.WFST=function(options){options=OpenLayers.Util.applyDefaults(options,OpenLayers.Format.WFST.DEFAULTS);
var cls=OpenLayers.Format.WFST["v"+options.version.replace(/\./g,"_")];
if(!cls){throw"Unsupported WFST version: "+options.version
}return new cls(options)
};
OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};
OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:true,xy:true,stateName:null,initialize:function(options){this.stateName={};
this.stateName[OpenLayers.State.INSERT]="wfs:Insert";
this.stateName[OpenLayers.State.UPDATE]="wfs:Update";
this.stateName[OpenLayers.State.DELETE]="wfs:Delete";
OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},getSrsName:function(feature,options){var srsName=options&&options.srsName;
if(!srsName){if(feature&&feature.layer){srsName=feature.layer.projection.getCode()
}else{srsName=this.srsName
}}return srsName
},read:function(data,options){options=options||{};
OpenLayers.Util.applyDefaults(options,{output:"features"});
if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var obj={};
if(data){this.readNode(data,obj,true)
}if(obj.features&&options.output==="features"){obj=obj.features
}return obj
},readers:{wfs:{FeatureCollection:function(node,obj){obj.features=[];
this.readChildNodes(node,obj)
}}},write:function(features,options){var node=this.writeNode("wfs:Transaction",{features:features,options:options});
var value=this.schemaLocationAttr();
if(value){this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",value)
}return OpenLayers.Format.XML.prototype.write.apply(this,[node])
},writers:{wfs:{GetFeature:function(options){var node=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:options&&options.handle,outputFormat:options&&options.outputFormat,maxFeatures:options&&options.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(options)}});
if(typeof this.featureType=="string"){this.writeNode("Query",options,node)
}else{for(var i=0,len=this.featureType.length;
i<len;
i++){options.featureType=this.featureType[i];
this.writeNode("Query",options,node)
}}return node
},Transaction:function(obj){obj=obj||{};
var options=obj.options||{};
var node=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:options.handle}});
var i,len;
var features=obj.features;
if(features){if(options.multi===true){OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":(this.multiCurve===true)?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":(this.multiSurface===true)?"MultiSurface":"MultiPolygon"})
}var name,feature;
for(i=0,len=features.length;
i<len;
++i){feature=features[i];
name=this.stateName[feature.state];
if(name){this.writeNode(name,{feature:feature,options:options},node)
}}if(options.multi===true){this.setGeometryTypes()
}}if(options.nativeElements){for(i=0,len=options.nativeElements.length;
i<len;
++i){this.writeNode("wfs:Native",options.nativeElements[i],node)
}}return node
},Native:function(nativeElement){var node=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:nativeElement.vendorId,safeToIgnore:nativeElement.safeToIgnore},value:nativeElement.value});
return node
},Insert:function(obj){var feature=obj.feature;
var options=obj.options;
var node=this.createElementNSPlus("wfs:Insert",{attributes:{handle:options&&options.handle}});
this.srsName=this.getSrsName(feature);
this.writeNode("feature:_typeName",feature,node);
return node
},Update:function(obj){var feature=obj.feature;
var options=obj.options;
var node=this.createElementNSPlus("wfs:Update",{attributes:{handle:options&&options.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});
if(this.featureNS){node.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)
}var modified=feature.modified;
if(this.geometryName!==null&&(!modified||modified.geometry!==undefined)){this.srsName=this.getSrsName(feature);
this.writeNode("Property",{name:this.geometryName,value:feature.geometry},node)
}for(var key in feature.attributes){if(feature.attributes[key]!==undefined&&(!modified||!modified.attributes||(modified.attributes&&modified.attributes[key]!==undefined))){this.writeNode("Property",{name:key,value:feature.attributes[key]},node)
}}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[feature.fid]}),node);
return node
},Property:function(obj){var node=this.createElementNSPlus("wfs:Property");
this.writeNode("Name",obj.name,node);
if(obj.value!==null){this.writeNode("Value",obj.value,node)
}return node
},Name:function(name){return this.createElementNSPlus("wfs:Name",{value:name})
},Value:function(obj){var node;
if(obj instanceof OpenLayers.Geometry){node=this.createElementNSPlus("wfs:Value");
var geom=this.writeNode("feature:_geometry",obj).firstChild;
node.appendChild(geom)
}else{node=this.createElementNSPlus("wfs:Value",{value:obj})
}return node
},Delete:function(obj){var feature=obj.feature;
var options=obj.options;
var node=this.createElementNSPlus("wfs:Delete",{attributes:{handle:options&&options.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});
if(this.featureNS){node.setAttribute("xmlns:"+this.featurePrefix,this.featureNS)
}this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[feature.fid]}),node);
return node
}}},schemaLocationAttr:function(options){options=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},options);
var schemaLocations=OpenLayers.Util.extend({},this.schemaLocations);
if(options.schema){schemaLocations[options.featurePrefix]=options.schema
}var parts=[];
var uri;
for(var key in schemaLocations){uri=this.namespaces[key];
if(uri){parts.push(uri+" "+schemaLocations[key])
}}var value=parts.join(" ")||undefined;
return value
},setFilterProperty:function(filter){if(filter.filters){for(var i=0,len=filter.filters.length;
i<len;
++i){OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,filter.filters[i])
}}else{if(filter instanceof OpenLayers.Filter.Spatial&&!filter.property){filter.property=this.geometryName
}}},CLASS_NAME:"OpenLayers.Format.WFST.v1"});
OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:false,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(options){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[options]);
OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[options])
},readNode:function(node,obj,first){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,[node,obj])
},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(node,obj){obj.insertIds=[];
obj.success=false;
this.readChildNodes(node,obj)
},InsertResult:function(node,container){var obj={fids:[]};
this.readChildNodes(node,obj);
container.insertIds.push(obj.fids[0])
},TransactionResult:function(node,obj){this.readChildNodes(node,obj)
},Status:function(node,obj){this.readChildNodes(node,obj)
},SUCCESS:function(node,obj){obj.success=true
}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(options){options=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},options);
var prefix=options.featurePrefix;
var node=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(prefix?prefix+":":"")+options.featureType}});
if(options.srsNameInQuery&&options.srsName){node.setAttribute("srsName",options.srsName)
}if(options.featureNS){node.setAttribute("xmlns:"+prefix,options.featureNS)
}if(options.propertyNames){for(var i=0,len=options.propertyNames.length;
i<len;
i++){this.writeNode("ogc:PropertyName",{property:options.propertyNames[i]},node)
}}if(options.filter){this.setFilterProperty(options.filter);
this.writeNode("ogc:Filter",options.filter,node)
}return node
}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});
OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(options){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[options]);
OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[options])
},readNode:function(node,obj,first){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,[node,obj])
},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(node,obj){obj.numberOfFeatures=parseInt(node.getAttribute("numberOfFeatures"));
OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)
},TransactionResponse:function(node,obj){obj.insertIds=[];
obj.success=false;
this.readChildNodes(node,obj)
},TransactionSummary:function(node,obj){obj.success=true
},InsertResults:function(node,obj){this.readChildNodes(node,obj)
},Feature:function(node,container){var obj={fids:[]};
this.readChildNodes(node,obj);
container.insertIds.push(obj.fids[0])
}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(options){var node=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);
options&&this.setAttributes(node,{resultType:options.resultType,startIndex:options.startIndex,count:options.count});
return node
},Query:function(options){options=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},options);
var prefix=options.featurePrefix;
var node=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(prefix?prefix+":":"")+options.featureType,srsName:options.srsName}});
if(options.featureNS){node.setAttribute("xmlns:"+prefix,options.featureNS)
}if(options.propertyNames){for(var i=0,len=options.propertyNames.length;
i<len;
i++){this.writeNode("wfs:PropertyName",{property:options.propertyNames[i]},node)
}}if(options.filter){OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,options.filter);
this.writeNode("ogc:Filter",options.filter,node)
}return node
},PropertyName:function(obj){return this.createElementNSPlus("wfs:PropertyName",{value:obj.property})
}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});
OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:true,initialize:function(options){options=options||{};
if(options.extractStyles!==false){options.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}
}OpenLayers.Format.prototype.initialize.apply(this,[options])
},read:function(text){var lines=text.split("\n");
var columns;
var features=[];
for(var lcv=0;
lcv<(lines.length-1);
lcv++){var currLine=lines[lcv].replace(/^\s*/,"").replace(/\s*$/,"");
if(currLine.charAt(0)!="#"){if(!columns){columns=currLine.split("\t")
}else{var vals=currLine.split("\t");
var geometry=new OpenLayers.Geometry.Point(0,0);
var attributes={};
var style=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null;
var icon,iconSize,iconOffset,overflow;
var set=false;
for(var valIndex=0;
valIndex<vals.length;
valIndex++){if(vals[valIndex]){if(columns[valIndex]=="point"){var coords=vals[valIndex].split(",");
geometry.y=parseFloat(coords[0]);
geometry.x=parseFloat(coords[1]);
set=true
}else{if(columns[valIndex]=="lat"){geometry.y=parseFloat(vals[valIndex]);
set=true
}else{if(columns[valIndex]=="lon"){geometry.x=parseFloat(vals[valIndex]);
set=true
}else{if(columns[valIndex]=="title"){attributes.title=vals[valIndex]
}else{if(columns[valIndex]=="image"||columns[valIndex]=="icon"&&style){style.externalGraphic=vals[valIndex]
}else{if(columns[valIndex]=="iconSize"&&style){var size=vals[valIndex].split(",");
style.graphicWidth=parseFloat(size[0]);
style.graphicHeight=parseFloat(size[1])
}else{if(columns[valIndex]=="iconOffset"&&style){var offset=vals[valIndex].split(",");
style.graphicXOffset=parseFloat(offset[0]);
style.graphicYOffset=parseFloat(offset[1])
}else{if(columns[valIndex]=="description"){attributes.description=vals[valIndex]
}else{if(columns[valIndex]=="overflow"){attributes.overflow=vals[valIndex]
}else{attributes[columns[valIndex]]=vals[valIndex]
}}}}}}}}}}}if(set){if(this.internalProjection&&this.externalProjection){geometry.transform(this.externalProjection,this.internalProjection)
}var feature=new OpenLayers.Feature.Vector(geometry,attributes,style);
features.push(feature)
}}}}return features
},CLASS_NAME:"OpenLayers.Format.Text"});
OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:false,nativeJSON:(function(){return !!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")
})(),read:function(json,filter){var object;
if(this.nativeJSON){object=JSON.parse(json,filter)
}else{try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){object=eval("("+json+")");
if(typeof filter==="function"){function walk(k,v){if(v&&typeof v==="object"){for(var i in v){if(v.hasOwnProperty(i)){v[i]=walk(i,v[i])
}}}return filter(k,v)
}object=walk("",object)
}}}catch(e){}}if(this.keepData){this.data=object
}return object
},write:function(value,pretty){this.pretty=!!pretty;
var json=null;
var type=typeof value;
if(this.serialize[type]){try{json=(!this.pretty&&this.nativeJSON)?JSON.stringify(value):this.serialize[type].apply(this,[value])
}catch(err){OpenLayers.Console.error("Trouble serializing: "+err)
}}return json
},writeIndent:function(){var pieces=[];
if(this.pretty){for(var i=0;
i<this.level;
++i){pieces.push(this.indent)
}}return pieces.join("")
},writeNewline:function(){return(this.pretty)?this.newline:""
},writeSpace:function(){return(this.pretty)?this.space:""
},serialize:{object:function(object){if(object==null){return"null"
}if(object.constructor==Date){return this.serialize.date.apply(this,[object])
}if(object.constructor==Array){return this.serialize.array.apply(this,[object])
}var pieces=["{"];
this.level+=1;
var key,keyJSON,valueJSON;
var addComma=false;
for(key in object){if(object.hasOwnProperty(key)){keyJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[key,this.pretty]);
valueJSON=OpenLayers.Format.JSON.prototype.write.apply(this,[object[key],this.pretty]);
if(keyJSON!=null&&valueJSON!=null){if(addComma){pieces.push(",")
}pieces.push(this.writeNewline(),this.writeIndent(),keyJSON,":",this.writeSpace(),valueJSON);
addComma=true
}}}this.level-=1;
pieces.push(this.writeNewline(),this.writeIndent(),"}");
return pieces.join("")
},array:function(array){var json;
var pieces=["["];
this.level+=1;
for(var i=0,len=array.length;
i<len;
++i){json=OpenLayers.Format.JSON.prototype.write.apply(this,[array[i],this.pretty]);
if(json!=null){if(i>0){pieces.push(",")
}pieces.push(this.writeNewline(),this.writeIndent(),json)
}}this.level-=1;
pieces.push(this.writeNewline(),this.writeIndent(),"]");
return pieces.join("")
},string:function(string){var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};
if(/["\\\x00-\x1f]/.test(string)){return'"'+string.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];
if(c){return c
}c=b.charCodeAt();
return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)
})+'"'
}return'"'+string+'"'
},number:function(number){return isFinite(number)?String(number):"null"
},"boolean":function(bool){return String(bool)
},date:function(date){function format(number){return(number<10)?"0"+number:number
}return'"'+date.getFullYear()+"-"+format(date.getMonth()+1)+"-"+format(date.getDate())+"T"+format(date.getHours())+":"+format(date.getMinutes())+":"+format(date.getSeconds())+'"'
}},CLASS_NAME:"OpenLayers.Format.JSON"});
OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:false,read:function(json,type,filter){type=(type)?type:"FeatureCollection";
var results=null;
var obj=null;
if(typeof json=="string"){obj=OpenLayers.Format.JSON.prototype.read.apply(this,[json,filter])
}else{obj=json
}if(!obj){OpenLayers.Console.error("Bad JSON: "+json)
}else{if(typeof(obj.type)!="string"){OpenLayers.Console.error("Bad GeoJSON - no type: "+json)
}else{if(this.isValidType(obj,type)){switch(type){case"Geometry":try{results=this.parseGeometry(obj)
}catch(err){OpenLayers.Console.error(err)
}break;
case"Feature":try{results=this.parseFeature(obj);
results.type="Feature"
}catch(err){OpenLayers.Console.error(err)
}break;
case"FeatureCollection":results=[];
switch(obj.type){case"Feature":try{results.push(this.parseFeature(obj))
}catch(err){results=null;
OpenLayers.Console.error(err)
}break;
case"FeatureCollection":for(var i=0,len=obj.features.length;
i<len;
++i){try{results.push(this.parseFeature(obj.features[i]))
}catch(err){results=null;
OpenLayers.Console.error(err)
}}break;
default:try{var geom=this.parseGeometry(obj);
results.push(new OpenLayers.Feature.Vector(geom))
}catch(err){results=null;
OpenLayers.Console.error(err)
}}break
}}}}return results
},isValidType:function(obj,type){var valid=false;
switch(type){case"Geometry":if(OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],obj.type)==-1){OpenLayers.Console.error("Unsupported geometry type: "+obj.type)
}else{valid=true
}break;
case"FeatureCollection":valid=true;
break;
default:if(obj.type==type){valid=true
}else{OpenLayers.Console.error("Cannot convert types from "+obj.type+" to "+type)
}}return valid
},parseFeature:function(obj){var feature,geometry,attributes,bbox;
attributes=(obj.properties)?obj.properties:{};
bbox=(obj.geometry&&obj.geometry.bbox)||obj.bbox;
try{geometry=this.parseGeometry(obj.geometry)
}catch(err){throw err
}feature=new OpenLayers.Feature.Vector(geometry,attributes);
if(bbox){feature.bounds=OpenLayers.Bounds.fromArray(bbox)
}if(obj.id){feature.fid=obj.id
}return feature
},parseGeometry:function(obj){if(obj==null){return null
}var geometry,collection=false;
if(obj.type=="GeometryCollection"){if(!(OpenLayers.Util.isArray(obj.geometries))){throw"GeometryCollection must have geometries array: "+obj
}var numGeom=obj.geometries.length;
var components=new Array(numGeom);
for(var i=0;
i<numGeom;
++i){components[i]=this.parseGeometry.apply(this,[obj.geometries[i]])
}geometry=new OpenLayers.Geometry.Collection(components);
collection=true
}else{if(!(OpenLayers.Util.isArray(obj.coordinates))){throw"Geometry must have coordinates array: "+obj
}if(!this.parseCoords[obj.type.toLowerCase()]){throw"Unsupported geometry type: "+obj.type
}try{geometry=this.parseCoords[obj.type.toLowerCase()].apply(this,[obj.coordinates])
}catch(err){throw err
}}if(this.internalProjection&&this.externalProjection&&!collection){geometry.transform(this.externalProjection,this.internalProjection)
}return geometry
},parseCoords:{point:function(array){if(this.ignoreExtraDims==false&&array.length!=2){throw"Only 2D points are supported: "+array
}return new OpenLayers.Geometry.Point(array[0],array[1])
},multipoint:function(array){var points=[];
var p=null;
for(var i=0,len=array.length;
i<len;
++i){try{p=this.parseCoords.point.apply(this,[array[i]])
}catch(err){throw err
}points.push(p)
}return new OpenLayers.Geometry.MultiPoint(points)
},linestring:function(array){var points=[];
var p=null;
for(var i=0,len=array.length;
i<len;
++i){try{p=this.parseCoords.point.apply(this,[array[i]])
}catch(err){throw err
}points.push(p)
}return new OpenLayers.Geometry.LineString(points)
},multilinestring:function(array){var lines=[];
var l=null;
for(var i=0,len=array.length;
i<len;
++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])
}catch(err){throw err
}lines.push(l)
}return new OpenLayers.Geometry.MultiLineString(lines)
},polygon:function(array){var rings=[];
var r,l;
for(var i=0,len=array.length;
i<len;
++i){try{l=this.parseCoords.linestring.apply(this,[array[i]])
}catch(err){throw err
}r=new OpenLayers.Geometry.LinearRing(l.components);
rings.push(r)
}return new OpenLayers.Geometry.Polygon(rings)
},multipolygon:function(array){var polys=[];
var p=null;
for(var i=0,len=array.length;
i<len;
++i){try{p=this.parseCoords.polygon.apply(this,[array[i]])
}catch(err){throw err
}polys.push(p)
}return new OpenLayers.Geometry.MultiPolygon(polys)
},box:function(array){if(array.length!=2){throw"GeoJSON box coordinates must have 2 elements"
}return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(array[0][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[0][1]),new OpenLayers.Geometry.Point(array[1][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[1][1]),new OpenLayers.Geometry.Point(array[0][0],array[0][1])])])
}},write:function(obj,pretty){var geojson={type:null};
if(OpenLayers.Util.isArray(obj)){geojson.type="FeatureCollection";
var numFeatures=obj.length;
geojson.features=new Array(numFeatures);
for(var i=0;
i<numFeatures;
++i){var element=obj[i];
if(!element instanceof OpenLayers.Feature.Vector){var msg="FeatureCollection only supports collections of features: "+element;
throw msg
}geojson.features[i]=this.extract.feature.apply(this,[element])
}}else{if(obj.CLASS_NAME.indexOf("OpenLayers.Geometry")==0){geojson=this.extract.geometry.apply(this,[obj])
}else{if(obj instanceof OpenLayers.Feature.Vector){geojson=this.extract.feature.apply(this,[obj]);
if(obj.layer&&obj.layer.projection){geojson.crs=this.createCRSObject(obj)
}}}}return OpenLayers.Format.JSON.prototype.write.apply(this,[geojson,pretty])
},createCRSObject:function(object){var proj=object.layer.projection.toString();
var crs={};
if(proj.match(/epsg:/i)){var code=parseInt(proj.substring(proj.indexOf(":")+1));
if(code==4326){crs={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}
}else{crs={type:"name",properties:{name:"EPSG:"+code}}
}}return crs
},extract:{feature:function(feature){var geom=this.extract.geometry.apply(this,[feature.geometry]);
var json={type:"Feature",properties:feature.attributes,geometry:geom};
if(feature.fid!=null){json.id=feature.fid
}return json
},geometry:function(geometry){if(geometry==null){return null
}if(this.internalProjection&&this.externalProjection){geometry=geometry.clone();
geometry.transform(this.internalProjection,this.externalProjection)
}var geometryType=geometry.CLASS_NAME.split(".")[2];
var data=this.extract[geometryType.toLowerCase()].apply(this,[geometry]);
var json;
if(geometryType=="Collection"){json={type:"GeometryCollection",geometries:data}
}else{json={type:geometryType,coordinates:data}
}return json
},point:function(point){return[point.x,point.y]
},multipoint:function(multipoint){var array=[];
for(var i=0,len=multipoint.components.length;
i<len;
++i){array.push(this.extract.point.apply(this,[multipoint.components[i]]))
}return array
},linestring:function(linestring){var array=[];
for(var i=0,len=linestring.components.length;
i<len;
++i){array.push(this.extract.point.apply(this,[linestring.components[i]]))
}return array
},multilinestring:function(multilinestring){var array=[];
for(var i=0,len=multilinestring.components.length;
i<len;
++i){array.push(this.extract.linestring.apply(this,[multilinestring.components[i]]))
}return array
},polygon:function(polygon){var array=[];
for(var i=0,len=polygon.components.length;
i<len;
++i){array.push(this.extract.linestring.apply(this,[polygon.components[i]]))
}return array
},multipolygon:function(multipolygon){var array=[];
for(var i=0,len=multipolygon.components.length;
i<len;
++i){array.push(this.extract.polygon.apply(this,[multipolygon.components[i]]))
}return array
},collection:function(collection){var len=collection.components.length;
var array=new Array(len);
for(var i=0;
i<len;
++i){array[i]=this.extract.geometry.apply(this,[collection.components[i]])
}return array
}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});
OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(layer){var parser=this.getParser();
var layerContext={queryable:layer.queryable,visibility:layer.visibility,name:layer.params.LAYERS,title:layer.name,"abstract":layer.metadata["abstract"],dataURL:layer.metadata.dataURL,metadataURL:layer.metadataURL,server:{version:layer.params.VERSION,url:layer.url},maxExtent:layer.maxExtent,transparent:layer.params.TRANSPARENT,numZoomLevels:layer.numZoomLevels,units:layer.units,isBaseLayer:layer.isBaseLayer,opacity:layer.opacity==1?undefined:layer.opacity,displayInLayerSwitcher:layer.displayInLayerSwitcher,singleTile:layer.singleTile,tileSize:(layer.singleTile||!layer.tileSize)?undefined:{width:layer.tileSize.w,height:layer.tileSize.h},minScale:(layer.options.resolutions||layer.options.scales||layer.options.maxResolution||layer.options.minScale)?layer.minScale:undefined,maxScale:(layer.options.resolutions||layer.options.scales||layer.options.minResolution||layer.options.maxScale)?layer.maxScale:undefined,formats:[],styles:[],srs:layer.srs,dimensions:layer.dimensions};
if(layer.metadata.servertitle){layerContext.server.title=layer.metadata.servertitle
}if(layer.metadata.formats&&layer.metadata.formats.length>0){for(var i=0,len=layer.metadata.formats.length;
i<len;
i++){var format=layer.metadata.formats[i];
layerContext.formats.push({value:format.value,current:(format.value==layer.params.FORMAT)})
}}else{layerContext.formats.push({value:layer.params.FORMAT,current:true})
}if(layer.metadata.styles&&layer.metadata.styles.length>0){for(var i=0,len=layer.metadata.styles.length;
i<len;
i++){var style=layer.metadata.styles[i];
if((style.href==layer.params.SLD)||(style.body==layer.params.SLD_BODY)||(style.name==layer.params.STYLES)){style.current=true
}else{style.current=false
}layerContext.styles.push(style)
}}else{layerContext.styles.push({href:layer.params.SLD,body:layer.params.SLD_BODY,name:layer.params.STYLES||parser.defaultStyleName,title:parser.defaultStyleTitle,current:true})
}return layerContext
},toContext:function(obj){var context={};
var layers=obj.layers;
if(obj.CLASS_NAME=="OpenLayers.Map"){var metadata=obj.metadata||{};
context.size=obj.getSize();
context.bounds=obj.getExtent();
context.projection=obj.projection;
context.title=obj.title;
context.keywords=metadata.keywords;
context["abstract"]=metadata["abstract"];
context.logo=metadata.logo;
context.descriptionURL=metadata.descriptionURL;
context.contactInformation=metadata.contactInformation;
context.maxExtent=obj.maxExtent
}else{OpenLayers.Util.applyDefaults(context,obj);
if(context.layers!=undefined){delete (context.layers)
}}if(context.layersContext==undefined){context.layersContext=[]
}if(layers!=undefined&&OpenLayers.Util.isArray(layers)){for(var i=0,len=layers.length;
i<len;
i++){var layer=layers[i];
if(layer instanceof OpenLayers.Layer.WMS){context.layersContext.push(this.layerToContext(layer))
}}}return context
},CLASS_NAME:"OpenLayers.Format.WMC"});
OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(uri){var prefix=null;
if(uri==null){prefix=this.namespaces[this.defaultPrefix]
}else{for(prefix in this.namespaces){if(this.namespaces[prefix]==uri){break
}}}return prefix
},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var root=data.documentElement;
this.rootPrefix=root.prefix;
var context={version:root.getAttribute("version")};
this.runChildNodes(context,root);
return context
},runChildNodes:function(obj,node){var children=node.childNodes;
var childNode,processor,prefix,local;
for(var i=0,len=children.length;
i<len;
++i){childNode=children[i];
if(childNode.nodeType==1){prefix=this.getNamespacePrefix(childNode.namespaceURI);
local=childNode.nodeName.split(":").pop();
processor=this["read_"+prefix+"_"+local];
if(processor){processor.apply(this,[obj,childNode])
}}}},read_wmc_General:function(context,node){this.runChildNodes(context,node)
},read_wmc_BoundingBox:function(context,node){context.projection=node.getAttribute("SRS");
context.bounds=new OpenLayers.Bounds(node.getAttribute("minx"),node.getAttribute("miny"),node.getAttribute("maxx"),node.getAttribute("maxy"))
},read_wmc_LayerList:function(context,node){context.layersContext=[];
this.runChildNodes(context,node)
},read_wmc_Layer:function(context,node){var layerContext={visibility:(node.getAttribute("hidden")!="1"),queryable:(node.getAttribute("queryable")=="1"),formats:[],styles:[],metadata:{}};
this.runChildNodes(layerContext,node);
context.layersContext.push(layerContext)
},read_wmc_Extension:function(obj,node){this.runChildNodes(obj,node)
},read_ol_units:function(layerContext,node){layerContext.units=this.getChildValue(node)
},read_ol_maxExtent:function(obj,node){var bounds=new OpenLayers.Bounds(node.getAttribute("minx"),node.getAttribute("miny"),node.getAttribute("maxx"),node.getAttribute("maxy"));
obj.maxExtent=bounds
},read_ol_transparent:function(layerContext,node){layerContext.transparent=this.getChildValue(node)
},read_ol_numZoomLevels:function(layerContext,node){layerContext.numZoomLevels=parseInt(this.getChildValue(node))
},read_ol_opacity:function(layerContext,node){layerContext.opacity=parseFloat(this.getChildValue(node))
},read_ol_singleTile:function(layerContext,node){layerContext.singleTile=(this.getChildValue(node)=="true")
},read_ol_tileSize:function(layerContext,node){var obj={width:node.getAttribute("width"),height:node.getAttribute("height")};
layerContext.tileSize=obj
},read_ol_isBaseLayer:function(layerContext,node){layerContext.isBaseLayer=(this.getChildValue(node)=="true")
},read_ol_displayInLayerSwitcher:function(layerContext,node){layerContext.displayInLayerSwitcher=(this.getChildValue(node)=="true")
},read_wmc_Server:function(layerContext,node){layerContext.version=node.getAttribute("version");
layerContext.url=this.getOnlineResource_href(node);
layerContext.metadata.servertitle=node.getAttribute("title")
},read_wmc_FormatList:function(layerContext,node){this.runChildNodes(layerContext,node)
},read_wmc_Format:function(layerContext,node){var format={value:this.getChildValue(node)};
if(node.getAttribute("current")=="1"){format.current=true
}layerContext.formats.push(format)
},read_wmc_StyleList:function(layerContext,node){this.runChildNodes(layerContext,node)
},read_wmc_Style:function(layerContext,node){var style={};
this.runChildNodes(style,node);
if(node.getAttribute("current")=="1"){style.current=true
}layerContext.styles.push(style)
},read_wmc_SLD:function(style,node){this.runChildNodes(style,node)
},read_sld_StyledLayerDescriptor:function(sld,node){var xml=OpenLayers.Format.XML.prototype.write.apply(this,[node]);
sld.body=xml
},read_sld_FeatureTypeStyle:function(sld,node){var xml=OpenLayers.Format.XML.prototype.write.apply(this,[node]);
sld.body=xml
},read_wmc_OnlineResource:function(obj,node){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")
},read_wmc_Name:function(obj,node){var name=this.getChildValue(node);
if(name){obj.name=name
}},read_wmc_Title:function(obj,node){var title=this.getChildValue(node);
if(title){obj.title=title
}},read_wmc_MetadataURL:function(layerContext,node){layerContext.metadataURL=this.getOnlineResource_href(node)
},read_wmc_KeywordList:function(context,node){context.keywords=[];
this.runChildNodes(context.keywords,node)
},read_wmc_Keyword:function(keywords,node){keywords.push(this.getChildValue(node))
},read_wmc_Abstract:function(obj,node){var abst=this.getChildValue(node);
if(abst){obj["abstract"]=abst
}},read_wmc_LogoURL:function(context,node){context.logo={width:node.getAttribute("width"),height:node.getAttribute("height"),format:node.getAttribute("format"),href:this.getOnlineResource_href(node)}
},read_wmc_DescriptionURL:function(context,node){context.descriptionURL=this.getOnlineResource_href(node)
},read_wmc_ContactInformation:function(obj,node){var contact={};
this.runChildNodes(contact,node);
obj.contactInformation=contact
},read_wmc_ContactPersonPrimary:function(contact,node){var personPrimary={};
this.runChildNodes(personPrimary,node);
contact.personPrimary=personPrimary
},read_wmc_ContactPerson:function(primaryPerson,node){var person=this.getChildValue(node);
if(person){primaryPerson.person=person
}},read_wmc_ContactOrganization:function(primaryPerson,node){var organization=this.getChildValue(node);
if(organization){primaryPerson.organization=organization
}},read_wmc_ContactPosition:function(contact,node){var position=this.getChildValue(node);
if(position){contact.position=position
}},read_wmc_ContactAddress:function(contact,node){var contactAddress={};
this.runChildNodes(contactAddress,node);
contact.contactAddress=contactAddress
},read_wmc_AddressType:function(contactAddress,node){var type=this.getChildValue(node);
if(type){contactAddress.type=type
}},read_wmc_Address:function(contactAddress,node){var address=this.getChildValue(node);
if(address){contactAddress.address=address
}},read_wmc_City:function(contactAddress,node){var city=this.getChildValue(node);
if(city){contactAddress.city=city
}},read_wmc_StateOrProvince:function(contactAddress,node){var stateOrProvince=this.getChildValue(node);
if(stateOrProvince){contactAddress.stateOrProvince=stateOrProvince
}},read_wmc_PostCode:function(contactAddress,node){var postcode=this.getChildValue(node);
if(postcode){contactAddress.postcode=postcode
}},read_wmc_Country:function(contactAddress,node){var country=this.getChildValue(node);
if(country){contactAddress.country=country
}},read_wmc_ContactVoiceTelephone:function(contact,node){var phone=this.getChildValue(node);
if(phone){contact.phone=phone
}},read_wmc_ContactFacsimileTelephone:function(contact,node){var fax=this.getChildValue(node);
if(fax){contact.fax=fax
}},read_wmc_ContactElectronicMailAddress:function(contact,node){var email=this.getChildValue(node);
if(email){contact.email=email
}},read_wmc_DataURL:function(layerContext,node){layerContext.dataURL=this.getOnlineResource_href(node)
},read_wmc_LegendURL:function(style,node){var legend={width:node.getAttribute("width"),height:node.getAttribute("height"),format:node.getAttribute("format"),href:this.getOnlineResource_href(node)};
style.legend=legend
},read_wmc_DimensionList:function(layerContext,node){layerContext.dimensions={};
this.runChildNodes(layerContext.dimensions,node)
},read_wmc_Dimension:function(dimensions,node){var name=node.getAttribute("name").toLowerCase();
var dim={name:name,units:node.getAttribute("units")||"",unitSymbol:node.getAttribute("unitSymbol")||"",userValue:node.getAttribute("userValue")||"",nearestValue:node.getAttribute("nearestValue")==="1",multipleValues:node.getAttribute("multipleValues")==="1",current:node.getAttribute("current")==="1","default":node.getAttribute("default")||""};
var values=this.getChildValue(node);
dim.values=values.split(",");
dimensions[dim.name]=dim
},write:function(context,options){var root=this.createElementDefaultNS("ViewContext");
this.setAttributes(root,{version:this.VERSION,id:(options&&typeof options.id=="string")?options.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")});
this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
root.appendChild(this.write_wmc_General(context));
root.appendChild(this.write_wmc_LayerList(context));
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},createElementDefaultNS:function(name,childValue,attributes){var node=this.createElementNS(this.namespaces[this.defaultPrefix],name);
if(childValue){node.appendChild(this.createTextNode(childValue))
}if(attributes){this.setAttributes(node,attributes)
}return node
},setAttributes:function(node,obj){var value;
for(var name in obj){value=obj[name].toString();
if(value.match(/[A-Z]/)){this.setAttributeNS(node,null,name,value)
}else{node.setAttribute(name,value)
}}},write_wmc_General:function(context){var node=this.createElementDefaultNS("General");
if(context.size){node.appendChild(this.createElementDefaultNS("Window",null,{width:context.size.w,height:context.size.h}))
}var bounds=context.bounds;
node.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18),SRS:context.projection}));
node.appendChild(this.createElementDefaultNS("Title",context.title));
if(context.keywords){node.appendChild(this.write_wmc_KeywordList(context.keywords))
}if(context["abstract"]){node.appendChild(this.createElementDefaultNS("Abstract",context["abstract"]))
}if(context.logo){node.appendChild(this.write_wmc_URLType("LogoURL",context.logo.href,context.logo))
}if(context.descriptionURL){node.appendChild(this.write_wmc_URLType("DescriptionURL",context.descriptionURL))
}if(context.contactInformation){node.appendChild(this.write_wmc_ContactInformation(context.contactInformation))
}node.appendChild(this.write_ol_MapExtension(context));
return node
},write_wmc_KeywordList:function(keywords){var node=this.createElementDefaultNS("KeywordList");
for(var i=0,len=keywords.length;
i<len;
i++){node.appendChild(this.createElementDefaultNS("Keyword",keywords[i]))
}return node
},write_wmc_ContactInformation:function(contact){var node=this.createElementDefaultNS("ContactInformation");
if(contact.personPrimary){node.appendChild(this.write_wmc_ContactPersonPrimary(contact.personPrimary))
}if(contact.position){node.appendChild(this.createElementDefaultNS("ContactPosition",contact.position))
}if(contact.contactAddress){node.appendChild(this.write_wmc_ContactAddress(contact.contactAddress))
}if(contact.phone){node.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",contact.phone))
}if(contact.fax){node.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",contact.fax))
}if(contact.email){node.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",contact.email))
}return node
},write_wmc_ContactPersonPrimary:function(personPrimary){var node=this.createElementDefaultNS("ContactPersonPrimary");
if(personPrimary.person){node.appendChild(this.createElementDefaultNS("ContactPerson",personPrimary.person))
}if(personPrimary.organization){node.appendChild(this.createElementDefaultNS("ContactOrganization",personPrimary.organization))
}return node
},write_wmc_ContactAddress:function(contactAddress){var node=this.createElementDefaultNS("ContactAddress");
if(contactAddress.type){node.appendChild(this.createElementDefaultNS("AddressType",contactAddress.type))
}if(contactAddress.address){node.appendChild(this.createElementDefaultNS("Address",contactAddress.address))
}if(contactAddress.city){node.appendChild(this.createElementDefaultNS("City",contactAddress.city))
}if(contactAddress.stateOrProvince){node.appendChild(this.createElementDefaultNS("StateOrProvince",contactAddress.stateOrProvince))
}if(contactAddress.postcode){node.appendChild(this.createElementDefaultNS("PostCode",contactAddress.postcode))
}if(contactAddress.country){node.appendChild(this.createElementDefaultNS("Country",contactAddress.country))
}return node
},write_ol_MapExtension:function(context){var node=this.createElementDefaultNS("Extension");
var bounds=context.maxExtent;
if(bounds){var maxExtent=this.createElementNS(this.namespaces.ol,"ol:maxExtent");
this.setAttributes(maxExtent,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18)});
node.appendChild(maxExtent)
}return node
},write_wmc_LayerList:function(context){var list=this.createElementDefaultNS("LayerList");
for(var i=0,len=context.layersContext.length;
i<len;
++i){list.appendChild(this.write_wmc_Layer(context.layersContext[i]))
}return list
},write_wmc_Layer:function(context){var node=this.createElementDefaultNS("Layer",null,{queryable:context.queryable?"1":"0",hidden:context.visibility?"0":"1"});
node.appendChild(this.write_wmc_Server(context));
node.appendChild(this.createElementDefaultNS("Name",context.name));
node.appendChild(this.createElementDefaultNS("Title",context.title));
if(context["abstract"]){node.appendChild(this.createElementDefaultNS("Abstract",context["abstract"]))
}if(context.dataURL){node.appendChild(this.write_wmc_URLType("DataURL",context.dataURL))
}if(context.metadataURL){node.appendChild(this.write_wmc_URLType("MetadataURL",context.metadataURL))
}return node
},write_wmc_LayerExtension:function(context){var node=this.createElementDefaultNS("Extension");
var bounds=context.maxExtent;
var maxExtent=this.createElementNS(this.namespaces.ol,"ol:maxExtent");
this.setAttributes(maxExtent,{minx:bounds.left.toPrecision(18),miny:bounds.bottom.toPrecision(18),maxx:bounds.right.toPrecision(18),maxy:bounds.top.toPrecision(18)});
node.appendChild(maxExtent);
if(context.tileSize&&!context.singleTile){var size=this.createElementNS(this.namespaces.ol,"ol:tileSize");
this.setAttributes(size,context.tileSize);
node.appendChild(size)
}var properties=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"];
var child;
for(var i=0,len=properties.length;
i<len;
++i){child=this.createOLPropertyNode(context,properties[i]);
if(child){node.appendChild(child)
}}return node
},createOLPropertyNode:function(obj,prop){var node=null;
if(obj[prop]!=null){node=this.createElementNS(this.namespaces.ol,"ol:"+prop);
node.appendChild(this.createTextNode(obj[prop].toString()))
}return node
},write_wmc_Server:function(context){var server=context.server;
var node=this.createElementDefaultNS("Server");
var attributes={service:"OGC:WMS",version:server.version};
if(server.title){attributes.title=server.title
}this.setAttributes(node,attributes);
node.appendChild(this.write_wmc_OnlineResource(server.url));
return node
},write_wmc_URLType:function(elName,url,attr){var node=this.createElementDefaultNS(elName);
node.appendChild(this.write_wmc_OnlineResource(url));
if(attr){var optionalAttributes=["width","height","format"];
for(var i=0;
i<optionalAttributes.length;
i++){if(optionalAttributes[i] in attr){node.setAttribute(optionalAttributes[i],attr[optionalAttributes[i]])
}}}return node
},write_wmc_DimensionList:function(context){var node=this.createElementDefaultNS("DimensionList");
var required_attributes={name:true,units:true,unitSymbol:true,userValue:true};
for(var dim in context.dimensions){var attributes={};
var dimension=context.dimensions[dim];
for(var name in dimension){if(typeof dimension[name]=="boolean"){attributes[name]=Number(dimension[name])
}else{attributes[name]=dimension[name]
}}var values="";
if(attributes.values){values=attributes.values.join(",");
delete attributes.values
}node.appendChild(this.createElementDefaultNS("Dimension",values,attributes))
}return node
},write_wmc_FormatList:function(context){var node=this.createElementDefaultNS("FormatList");
for(var i=0,len=context.formats.length;
i<len;
i++){var format=context.formats[i];
node.appendChild(this.createElementDefaultNS("Format",format.value,(format.current&&format.current==true)?{current:"1"}:null))
}return node
},write_wmc_StyleList:function(layer){var node=this.createElementDefaultNS("StyleList");
var styles=layer.styles;
if(styles&&OpenLayers.Util.isArray(styles)){var sld;
for(var i=0,len=styles.length;
i<len;
i++){var s=styles[i];
var style=this.createElementDefaultNS("Style",null,(s.current&&s.current==true)?{current:"1"}:null);
if(s.href){sld=this.createElementDefaultNS("SLD");
if(s.name){sld.appendChild(this.createElementDefaultNS("Name",s.name))
}if(s.title){sld.appendChild(this.createElementDefaultNS("Title",s.title))
}if(s.legend){sld.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend))
}var link=this.write_wmc_OnlineResource(s.href);
sld.appendChild(link);
style.appendChild(sld)
}else{if(s.body){sld=this.createElementDefaultNS("SLD");
if(s.name){sld.appendChild(this.createElementDefaultNS("Name",s.name))
}if(s.title){sld.appendChild(this.createElementDefaultNS("Title",s.title))
}if(s.legend){sld.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend))
}var doc=OpenLayers.Format.XML.prototype.read.apply(this,[s.body]);
var imported=doc.documentElement;
if(sld.ownerDocument&&sld.ownerDocument.importNode){imported=sld.ownerDocument.importNode(imported,true)
}sld.appendChild(imported);
style.appendChild(sld)
}else{style.appendChild(this.createElementDefaultNS("Name",s.name));
style.appendChild(this.createElementDefaultNS("Title",s.title));
if(s["abstract"]){style.appendChild(this.createElementDefaultNS("Abstract",s["abstract"]))
}if(s.legend){style.appendChild(this.write_wmc_URLType("LegendURL",s.legend.href,s.legend))
}}}node.appendChild(style)
}}return node
},write_wmc_OnlineResource:function(href){var node=this.createElementDefaultNS("OnlineResource");
this.setAttributeNS(node,this.namespaces.xlink,"xlink:type","simple");
this.setAttributeNS(node,this.namespaces.xlink,"xlink:href",href);
return node
},getOnlineResource_href:function(node){var object={};
var links=node.getElementsByTagName("OnlineResource");
if(links.length>0){this.read_wmc_OnlineResource(object,links[0])
}return object.href
},CLASS_NAME:"OpenLayers.Format.WMC.v1"});
OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(options){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[options])
},read_wmc_SRS:function(layerContext,node){var srs=this.getChildValue(node);
if(typeof layerContext.projections!="object"){layerContext.projections={}
}var values=srs.split(/ +/);
for(var i=0,len=values.length;
i<len;
i++){layerContext.projections[values[i]]=true
}},write_wmc_Layer:function(context){var node=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[context]);
if(context.srs){var projections=[];
for(var name in context.srs){projections.push(name)
}node.appendChild(this.createElementDefaultNS("SRS",projections.join(" ")))
}node.appendChild(this.write_wmc_FormatList(context));
node.appendChild(this.write_wmc_StyleList(context));
if(context.dimensions){node.appendChild(this.write_wmc_DimensionList(context))
}node.appendChild(this.write_wmc_LayerExtension(context))
},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"});
OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(options){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[options])
},read_sld_MinScaleDenominator:function(layerContext,node){var minScaleDenominator=parseFloat(this.getChildValue(node));
if(minScaleDenominator>0){layerContext.maxScale=minScaleDenominator
}},read_sld_MaxScaleDenominator:function(layerContext,node){layerContext.minScale=parseFloat(this.getChildValue(node))
},read_wmc_SRS:function(layerContext,node){if(!("srs" in layerContext)){layerContext.srs={}
}layerContext.srs[this.getChildValue(node)]=true
},write_wmc_Layer:function(context){var node=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[context]);
if(context.maxScale){var minSD=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");
minSD.appendChild(this.createTextNode(context.maxScale.toPrecision(16)));
node.appendChild(minSD)
}if(context.minScale){var maxSD=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");
maxSD.appendChild(this.createTextNode(context.minScale.toPrecision(16)));
node.appendChild(maxSD)
}if(context.srs){for(var name in context.srs){node.appendChild(this.createElementDefaultNS("SRS",name))
}}node.appendChild(this.write_wmc_FormatList(context));
node.appendChild(this.write_wmc_StyleList(context));
if(context.dimensions){node.appendChild(this.write_wmc_DimensionList(context))
}node.appendChild(this.write_wmc_LayerExtension(context));
return node
},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"});
OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(options){var node=this.writeNode("wcs:GetCoverage",options);
this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[node])
},writers:{wcs:{GetCoverage:function(options){var node=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:options.version||this.VERSION,service:"WCS"}});
this.writeNode("ows:Identifier",options.identifier,node);
this.writeNode("wcs:DomainSubset",options.domainSubset,node);
this.writeNode("wcs:Output",options.output,node);
return node
},DomainSubset:function(domainSubset){var node=this.createElementNSPlus("wcs:DomainSubset",{});
this.writeNode("ows:BoundingBox",domainSubset.boundingBox,node);
if(domainSubset.temporalSubset){this.writeNode("wcs:TemporalSubset",domainSubset.temporalSubset,node)
}return node
},TemporalSubset:function(temporalSubset){var node=this.createElementNSPlus("wcs:TemporalSubset",{});
for(var i=0,len=temporalSubset.timePeriods.length;
i<len;
++i){this.writeNode("wcs:TimePeriod",temporalSubset.timePeriods[i],node)
}return node
},TimePeriod:function(timePeriod){var node=this.createElementNSPlus("wcs:TimePeriod",{});
this.writeNode("wcs:BeginPosition",timePeriod.begin,node);
this.writeNode("wcs:EndPosition",timePeriod.end,node);
if(timePeriod.resolution){this.writeNode("wcs:TimeResolution",timePeriod.resolution,node)
}return node
},BeginPosition:function(begin){var node=this.createElementNSPlus("wcs:BeginPosition",{value:begin});
return node
},EndPosition:function(end){var node=this.createElementNSPlus("wcs:EndPosition",{value:end});
return node
},TimeResolution:function(resolution){var node=this.createElementNSPlus("wcs:TimeResolution",{value:resolution});
return node
},Output:function(output){var node=this.createElementNSPlus("wcs:Output",{attributes:{format:output.format,store:output.store}});
if(output.gridCRS){this.writeNode("wcs:GridCRS",output.gridCRS,node)
}return node
},GridCRS:function(gridCRS){var node=this.createElementNSPlus("wcs:GridCRS",{});
this.writeNode("wcs:GridBaseCRS",gridCRS.baseCRS,node);
if(gridCRS.type){this.writeNode("wcs:GridType",gridCRS.type,node)
}if(gridCRS.origin){this.writeNode("wcs:GridOrigin",gridCRS.origin,node)
}this.writeNode("wcs:GridOffsets",gridCRS.offsets,node);
if(gridCRS.CS){this.writeNode("wcs:GridCS",gridCRS.CS,node)
}return node
},GridBaseCRS:function(baseCRS){return this.createElementNSPlus("wcs:GridBaseCRS",{value:baseCRS})
},GridOrigin:function(origin){return this.createElementNSPlus("wcs:GridOrigin",{value:origin})
},GridType:function(type){return this.createElementNSPlus("wcs:GridType",{value:type})
},GridOffsets:function(offsets){return this.createElementNSPlus("wcs:GridOffsets",{value:offsets})
},GridCS:function(CS){return this.createElementNSPlus("wcs:GridCS",{value:CS})
}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"});
OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});
OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var raw=data;
if(data&&data.nodeType==9){data=data.documentElement
}var capabilities={};
this.readNode(data,capabilities);
if(capabilities.service===undefined){var parser=new OpenLayers.Format.OGCExceptionReport();
capabilities.error=parser.read(raw)
}return capabilities
},readers:{wms:{Service:function(node,obj){obj.service={};
this.readChildNodes(node,obj.service)
},Name:function(node,obj){obj.name=this.getChildValue(node)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,obj){obj["abstract"]=this.getChildValue(node)
},BoundingBox:function(node,obj){var bbox={};
bbox.bbox=[parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy"))];
var res={x:parseFloat(node.getAttribute("resx")),y:parseFloat(node.getAttribute("resy"))};
if(!(isNaN(res.x)&&isNaN(res.y))){bbox.res=res
}return bbox
},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")
},ContactInformation:function(node,obj){obj.contactInformation={};
this.readChildNodes(node,obj.contactInformation)
},ContactPersonPrimary:function(node,obj){obj.personPrimary={};
this.readChildNodes(node,obj.personPrimary)
},ContactPerson:function(node,obj){obj.person=this.getChildValue(node)
},ContactOrganization:function(node,obj){obj.organization=this.getChildValue(node)
},ContactPosition:function(node,obj){obj.position=this.getChildValue(node)
},ContactAddress:function(node,obj){obj.contactAddress={};
this.readChildNodes(node,obj.contactAddress)
},AddressType:function(node,obj){obj.type=this.getChildValue(node)
},Address:function(node,obj){obj.address=this.getChildValue(node)
},City:function(node,obj){obj.city=this.getChildValue(node)
},StateOrProvince:function(node,obj){obj.stateOrProvince=this.getChildValue(node)
},PostCode:function(node,obj){obj.postcode=this.getChildValue(node)
},Country:function(node,obj){obj.country=this.getChildValue(node)
},ContactVoiceTelephone:function(node,obj){obj.phone=this.getChildValue(node)
},ContactFacsimileTelephone:function(node,obj){obj.fax=this.getChildValue(node)
},ContactElectronicMailAddress:function(node,obj){obj.email=this.getChildValue(node)
},Fees:function(node,obj){var fees=this.getChildValue(node);
if(fees&&fees.toLowerCase()!="none"){obj.fees=fees
}},AccessConstraints:function(node,obj){var constraints=this.getChildValue(node);
if(constraints&&constraints.toLowerCase()!="none"){obj.accessConstraints=constraints
}},Capability:function(node,obj){obj.capability={nestedLayers:[],layers:[]};
this.readChildNodes(node,obj.capability)
},Request:function(node,obj){obj.request={};
this.readChildNodes(node,obj.request)
},GetCapabilities:function(node,obj){obj.getcapabilities={formats:[]};
this.readChildNodes(node,obj.getcapabilities)
},Format:function(node,obj){if(OpenLayers.Util.isArray(obj.formats)){obj.formats.push(this.getChildValue(node))
}else{obj.format=this.getChildValue(node)
}},DCPType:function(node,obj){this.readChildNodes(node,obj)
},HTTP:function(node,obj){this.readChildNodes(node,obj)
},Get:function(node,obj){obj.get={};
this.readChildNodes(node,obj.get);
if(!obj.href){obj.href=obj.get.href
}},Post:function(node,obj){obj.post={};
this.readChildNodes(node,obj.post);
if(!obj.href){obj.href=obj.get.href
}},GetMap:function(node,obj){obj.getmap={formats:[]};
this.readChildNodes(node,obj.getmap)
},GetFeatureInfo:function(node,obj){obj.getfeatureinfo={formats:[]};
this.readChildNodes(node,obj.getfeatureinfo)
},Exception:function(node,obj){obj.exception={formats:[]};
this.readChildNodes(node,obj.exception)
},Layer:function(node,obj){var parentLayer,capability;
if(obj.capability){capability=obj.capability;
parentLayer=obj
}else{capability=obj
}var attrNode=node.getAttributeNode("queryable");
var queryable=(attrNode&&attrNode.specified)?node.getAttribute("queryable"):null;
attrNode=node.getAttributeNode("cascaded");
var cascaded=(attrNode&&attrNode.specified)?node.getAttribute("cascaded"):null;
attrNode=node.getAttributeNode("opaque");
var opaque=(attrNode&&attrNode.specified)?node.getAttribute("opaque"):null;
var noSubsets=node.getAttribute("noSubsets");
var fixedWidth=node.getAttribute("fixedWidth");
var fixedHeight=node.getAttribute("fixedHeight");
var parent=parentLayer||{},extend=OpenLayers.Util.extend;
var layer={nestedLayers:[],styles:parentLayer?[].concat(parentLayer.styles):[],srs:parentLayer?extend({},parent.srs):{},metadataURLs:[],bbox:parentLayer?extend({},parent.bbox):{},llbbox:parent.llbbox,dimensions:parentLayer?extend({},parent.dimensions):{},authorityURLs:parentLayer?extend({},parent.authorityURLs):{},identifiers:{},keywords:[],queryable:(queryable&&queryable!=="")?(queryable==="1"||queryable==="true"):(parent.queryable||false),cascaded:(cascaded!==null)?parseInt(cascaded):(parent.cascaded||0),opaque:opaque?(opaque==="1"||opaque==="true"):(parent.opaque||false),noSubsets:(noSubsets!==null)?(noSubsets==="1"||noSubsets==="true"):(parent.noSubsets||false),fixedWidth:(fixedWidth!=null)?parseInt(fixedWidth):(parent.fixedWidth||0),fixedHeight:(fixedHeight!=null)?parseInt(fixedHeight):(parent.fixedHeight||0),minScale:parent.minScale,maxScale:parent.maxScale,attribution:parent.attribution};
obj.nestedLayers.push(layer);
layer.capability=capability;
this.readChildNodes(node,layer);
delete layer.capability;
if(layer.name){var parts=layer.name.split(":"),request=capability.request,gfi=request.getfeatureinfo;
if(parts.length>0){layer.prefix=parts[0]
}capability.layers.push(layer);
if(layer.formats===undefined){layer.formats=request.getmap.formats
}if(layer.infoFormats===undefined&&gfi){layer.infoFormats=gfi.formats
}}},Attribution:function(node,obj){obj.attribution={};
this.readChildNodes(node,obj.attribution)
},LogoURL:function(node,obj){obj.logo={width:node.getAttribute("width"),height:node.getAttribute("height")};
this.readChildNodes(node,obj.logo)
},Style:function(node,obj){var style={};
obj.styles.push(style);
this.readChildNodes(node,style)
},LegendURL:function(node,obj){var legend={width:node.getAttribute("width"),height:node.getAttribute("height")};
obj.legend=legend;
this.readChildNodes(node,legend)
},MetadataURL:function(node,obj){var metadataURL={type:node.getAttribute("type")};
obj.metadataURLs.push(metadataURL);
this.readChildNodes(node,metadataURL)
},DataURL:function(node,obj){obj.dataURL={};
this.readChildNodes(node,obj.dataURL)
},FeatureListURL:function(node,obj){obj.featureListURL={};
this.readChildNodes(node,obj.featureListURL)
},AuthorityURL:function(node,obj){var name=node.getAttribute("name");
var authority={};
this.readChildNodes(node,authority);
obj.authorityURLs[name]=authority.href
},Identifier:function(node,obj){var authority=node.getAttribute("authority");
obj.identifiers[authority]=this.getChildValue(node)
},KeywordList:function(node,obj){this.readChildNodes(node,obj)
},SRS:function(node,obj){obj.srs[this.getChildValue(node)]=true
}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});
OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(node,obj){this.readChildNodes(node,obj)
},Keyword:function(node,obj){if(obj.keywords){obj.keywords.push(this.getChildValue(node))
}},DescribeLayer:function(node,obj){obj.describelayer={formats:[]};
this.readChildNodes(node,obj.describelayer)
},GetLegendGraphic:function(node,obj){obj.getlegendgraphic={formats:[]};
this.readChildNodes(node,obj.getlegendgraphic)
},GetStyles:function(node,obj){obj.getstyles={formats:[]};
this.readChildNodes(node,obj.getstyles)
},PutStyles:function(node,obj){obj.putstyles={formats:[]};
this.readChildNodes(node,obj.putstyles)
},UserDefinedSymbolization:function(node,obj){var userSymbols={supportSLD:parseInt(node.getAttribute("SupportSLD"))==1,userLayer:parseInt(node.getAttribute("UserLayer"))==1,userStyle:parseInt(node.getAttribute("UserStyle"))==1,remoteWFS:parseInt(node.getAttribute("RemoteWFS"))==1};
obj.userSymbols=userSymbols
},LatLonBoundingBox:function(node,obj){obj.llbbox=[parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy"))]
},BoundingBox:function(node,obj){var bbox=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[node,obj]);
bbox.srs=node.getAttribute("SRS");
obj.bbox[bbox.srs]=bbox
},ScaleHint:function(node,obj){var min=node.getAttribute("min");
var max=node.getAttribute("max");
var rad2=Math.pow(2,0.5);
var ipm=OpenLayers.INCHES_PER_UNIT.m;
obj.maxScale=parseFloat(((min/rad2)*ipm*OpenLayers.DOTS_PER_INCH).toPrecision(13));
obj.minScale=parseFloat(((max/rad2)*ipm*OpenLayers.DOTS_PER_INCH).toPrecision(13))
},Dimension:function(node,obj){var name=node.getAttribute("name").toLowerCase();
var dim={name:name,units:node.getAttribute("units"),unitsymbol:node.getAttribute("unitSymbol")};
obj.dimensions[dim.name]=dim
},Extent:function(node,obj){var name=node.getAttribute("name").toLowerCase();
if(name in obj.dimensions){var extent=obj.dimensions[name];
extent.nearestVal=node.getAttribute("nearestValue")==="1";
extent.multipleVal=node.getAttribute("multipleValues")==="1";
extent.current=node.getAttribute("current")==="1";
extent["default"]=node.getAttribute("default")||"";
var values=this.getChildValue(node);
extent.values=values.split(",")
}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});
OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(node,obj){var srs=this.getChildValue(node);
var values=srs.split(/ +/);
for(var i=0,len=values.length;
i<len;
i++){obj.srs[values[i]]=true
}}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});
OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(node,obj){obj.srs[this.getChildValue(node)]=true
}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});
OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(node,obj){this.readChildNodes(node,obj)
},LayerLimit:function(node,obj){obj.layerLimit=parseInt(this.getChildValue(node))
},MaxWidth:function(node,obj){obj.maxWidth=parseInt(this.getChildValue(node))
},MaxHeight:function(node,obj){obj.maxHeight=parseInt(this.getChildValue(node))
},BoundingBox:function(node,obj){var bbox=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[node,obj]);
bbox.srs=node.getAttribute("CRS");
obj.bbox[bbox.srs]=bbox
},CRS:function(node,obj){this.readers.wms.SRS.apply(this,[node,obj])
},EX_GeographicBoundingBox:function(node,obj){obj.llbbox=[];
this.readChildNodes(node,obj.llbbox)
},westBoundLongitude:function(node,obj){obj[0]=this.getChildValue(node)
},eastBoundLongitude:function(node,obj){obj[2]=this.getChildValue(node)
},southBoundLatitude:function(node,obj){obj[1]=this.getChildValue(node)
},northBoundLatitude:function(node,obj){obj[3]=this.getChildValue(node)
},MinScaleDenominator:function(node,obj){obj.maxScale=parseFloat(this.getChildValue(node)).toPrecision(16)
},MaxScaleDenominator:function(node,obj){obj.minScale=parseFloat(this.getChildValue(node)).toPrecision(16)
},Dimension:function(node,obj){var name=node.getAttribute("name").toLowerCase();
var dim={name:name,units:node.getAttribute("units"),unitsymbol:node.getAttribute("unitSymbol"),nearestVal:node.getAttribute("nearestValue")==="1",multipleVal:node.getAttribute("multipleValues")==="1","default":node.getAttribute("default")||"",current:node.getAttribute("current")==="1",values:this.getChildValue(node).split(",")};
obj.dimensions[dim.name]=dim
},Keyword:function(node,obj){var keyword={value:this.getChildValue(node),vocabulary:node.getAttribute("vocabulary")};
if(obj.keywords){obj.keywords.push(keyword)
}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(node,obj){this.readers.wms.UserDefinedSymbolization.apply(this,[node,obj]);
obj.userSymbols.inlineFeature=parseInt(node.getAttribute("InlineFeature"))==1;
obj.userSymbols.remoteWCS=parseInt(node.getAttribute("RemoteWCS"))==1
},DescribeLayer:function(node,obj){this.readers.wms.DescribeLayer.apply(this,[node,obj])
},GetLegendGraphic:function(node,obj){this.readers.wms.GetLegendGraphic.apply(this,[node,obj])
}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});
OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});
OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(node,obj){obj.vendorSpecific={tileSets:[]};
this.readChildNodes(node,obj.vendorSpecific)
},TileSet:function(node,vendorSpecific){var tileset={srs:{},bbox:{},resolutions:[]};
this.readChildNodes(node,tileset);
vendorSpecific.tileSets.push(tileset)
},Resolutions:function(node,tileset){var res=this.getChildValue(node).split(" ");
for(var i=0,len=res.length;
i<len;
i++){if(res[i]!=""){tileset.resolutions.push(parseFloat(res[i]))
}}},Width:function(node,tileset){tileset.width=parseInt(this.getChildValue(node))
},Height:function(node,tileset){tileset.height=parseInt(this.getChildValue(node))
},Layers:function(node,tileset){tileset.layers=this.getChildValue(node)
},Styles:function(node,tileset){tileset.styles=this.getChildValue(node)
}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"});
OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},gmlFormat:null,read:function(data){var result;
if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var root=data.documentElement;
if(root){var scope=this;
var read=this["read_"+root.nodeName];
if(read){result=read.call(this,root)
}else{result=new OpenLayers.Format.GML((this.options?this.options:{})).read(data)
}}else{result=data
}return result
},read_msGMLOutput:function(data){var response=[];
var layerNodes=this.getSiblingNodesByTagCriteria(data,this.layerIdentifier);
if(layerNodes){for(var i=0,len=layerNodes.length;
i<len;
++i){var node=layerNodes[i];
var layerName=node.nodeName;
if(node.prefix){layerName=layerName.split(":")[1]
}var layerName=layerName.replace(this.layerIdentifier,"");
var featureNodes=this.getSiblingNodesByTagCriteria(node,this.featureIdentifier);
if(featureNodes){for(var j=0;
j<featureNodes.length;
j++){var featureNode=featureNodes[j];
var geomInfo=this.parseGeometry(featureNode);
var attributes=this.parseAttributes(featureNode);
var feature=new OpenLayers.Feature.Vector(geomInfo.geometry,attributes,null);
feature.bounds=geomInfo.bounds;
feature.type=layerName;
response.push(feature)
}}}}return response
},read_FeatureInfoResponse:function(data){var response=[];
var featureNodes=this.getElementsByTagNameNS(data,"*","FIELDS");
for(var i=0,len=featureNodes.length;
i<len;
i++){var featureNode=featureNodes[i];
var geom=null;
var attributes={};
var j;
var jlen=featureNode.attributes.length;
if(jlen>0){for(j=0;
j<jlen;
j++){var attribute=featureNode.attributes[j];
attributes[attribute.nodeName]=attribute.nodeValue
}}else{var nodes=featureNode.childNodes;
for(j=0,jlen=nodes.length;
j<jlen;
++j){var node=nodes[j];
if(node.nodeType!=3){attributes[node.getAttribute("name")]=node.getAttribute("value")
}}}response.push(new OpenLayers.Feature.Vector(geom,attributes,null))
}return response
},getSiblingNodesByTagCriteria:function(node,criteria){var nodes=[];
var children,tagName,n,matchNodes,child;
if(node&&node.hasChildNodes()){children=node.childNodes;
n=children.length;
for(var k=0;
k<n;
k++){child=children[k];
while(child&&child.nodeType!=1){child=child.nextSibling;
k++
}tagName=(child?child.nodeName:"");
if(tagName.length>0&&tagName.indexOf(criteria)>-1){nodes.push(child)
}else{matchNodes=this.getSiblingNodesByTagCriteria(child,criteria);
if(matchNodes.length>0){(nodes.length==0)?nodes=matchNodes:nodes.push(matchNodes)
}}}}return nodes
},parseAttributes:function(node){var attributes={};
if(node.nodeType==1){var children=node.childNodes;
var n=children.length;
for(var i=0;
i<n;
++i){var child=children[i];
if(child.nodeType==1){var grandchildren=child.childNodes;
var name=(child.prefix)?child.nodeName.split(":")[1]:child.nodeName;
if(grandchildren.length==0){attributes[name]=null
}else{if(grandchildren.length==1){var grandchild=grandchildren[0];
if(grandchild.nodeType==3||grandchild.nodeType==4){var value=grandchild.nodeValue.replace(this.regExes.trimSpace,"");
attributes[name]=value
}}}}}}return attributes
},parseGeometry:function(node){if(!this.gmlFormat){this.gmlFormat=new OpenLayers.Format.GML()
}var feature=this.gmlFormat.parseFeature(node);
var geometry,bounds=null;
if(feature){geometry=feature.geometry&&feature.geometry.clone();
bounds=feature.bounds&&feature.bounds.clone();
feature.destroy()
}return{geometry:geometry,bounds:bounds}
},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});
OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"});
OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);
this.options=options
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var capabilities={};
this.readNode(data,capabilities);
return capabilities
},readers:{gml:OpenLayers.Util.applyDefaults({name:function(node,obj){obj.name=this.getChildValue(node)
},TimePeriod:function(node,obj){obj.timePeriod={};
this.readChildNodes(node,obj.timePeriod)
},beginPosition:function(node,timePeriod){timePeriod.beginPosition=this.getChildValue(node)
},endPosition:function(node,timePeriod){timePeriod.endPosition=this.getChildValue(node)
}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(node,obj){this.readChildNodes(node,obj)
},Contents:function(node,obj){obj.contents={};
this.readChildNodes(node,obj.contents)
},ObservationOfferingList:function(node,contents){contents.offeringList={};
this.readChildNodes(node,contents.offeringList)
},ObservationOffering:function(node,offeringList){var id=this.getAttributeNS(node,this.namespaces.gml,"id");
offeringList[id]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]};
this.readChildNodes(node,offeringList[id])
},time:function(node,offering){offering.time={};
this.readChildNodes(node,offering.time)
},procedure:function(node,offering){offering.procedures.push(this.getAttributeNS(node,this.namespaces.xlink,"href"))
},observedProperty:function(node,offering){offering.observedProperties.push(this.getAttributeNS(node,this.namespaces.xlink,"href"))
},featureOfInterest:function(node,offering){offering.featureOfInterestIds.push(this.getAttributeNS(node,this.namespaces.xlink,"href"))
},responseFormat:function(node,offering){offering.responseFormats.push(this.getChildValue(node))
},resultModel:function(node,offering){offering.resultModels.push(this.getChildValue(node))
},responseMode:function(node,offering){offering.responseModes.push(this.getChildValue(node))
}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"});
OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var info={features:[]};
this.readNode(data,info);
var features=[];
for(var i=0,len=info.features.length;
i<len;
i++){var container=info.features[i];
if(this.internalProjection&&this.externalProjection&&container.components[0]){container.components[0].transform(this.externalProjection,this.internalProjection)
}var feature=new OpenLayers.Feature.Vector(container.components[0],container.attributes);
features.push(feature)
}return features
},readers:{sa:{SamplingPoint:function(node,obj){if(!obj.attributes){var feature={attributes:{}};
obj.features.push(feature);
obj=feature
}obj.attributes.id=this.getAttributeNS(node,this.namespaces.gml,"id");
this.readChildNodes(node,obj)
},position:function(node,obj){this.readChildNodes(node,obj)
}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(node,obj){this.readChildNodes(node,obj)
},featureMember:function(node,obj){var feature={attributes:{}};
obj.features.push(feature);
this.readChildNodes(node,feature)
},name:function(node,obj){obj.attributes.name=this.getChildValue(node)
},pos:function(node,obj){if(!this.externalProjection){this.externalProjection=new OpenLayers.Projection(node.getAttribute("srsName"))
}OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[node,obj])
}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(options){var node=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}});
for(var i=0,len=options.fois.length;
i<len;
i++){this.writeNode("FeatureOfInterestId",{foi:options.fois[i]},node)
}return node
},FeatureOfInterestId:function(options){var node=this.createElementNSPlus("FeatureOfInterestId",{value:options.foi});
return node
}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"});
OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(root,options){var version=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);
if(version==="0.3.0"){version=this.defaultVersion
}return version
},toContext:function(obj){var context={};
if(obj.CLASS_NAME=="OpenLayers.Map"){context.bounds=obj.getExtent();
context.maxExtent=obj.maxExtent;
context.projection=obj.projection;
context.size=obj.getSize();
context.layers=obj.layers
}return context
},CLASS_NAME:"OpenLayers.Format.OWSContext"});
OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:true,xy:true,regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);
OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)
},setNestingPath:function(l){if(l.layersContext){for(var i=0,len=l.layersContext.length;
i<len;
i++){var layerContext=l.layersContext[i];
var nPath=[];
var nTitle=l.title||"";
if(l.metadata&&l.metadata.nestingPath){nPath=l.metadata.nestingPath.slice()
}if(nTitle!=""){nPath.push(nTitle)
}layerContext.metadata.nestingPath=nPath;
if(layerContext.layersContext){this.setNestingPath(layerContext)
}}}},decomposeNestingPath:function(nPath){var a=[];
if(OpenLayers.Util.isArray(nPath)){var path=nPath.slice();
while(path.length>0){a.push(path.slice());
path.pop()
}a.reverse()
}return a
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var context={};
this.readNode(data,context);
this.setNestingPath({layersContext:context.layersContext});
var layers=[];
this.processLayer(layers,context);
delete context.layersContext;
context.layersContext=layers;
return context
},processLayer:function(layerArray,layer){if(layer.layersContext){for(var i=0,len=layer.layersContext.length;
i<len;
i++){var l=layer.layersContext[i];
layerArray.push(l);
if(l.layersContext){this.processLayer(layerArray,l)
}}}},write:function(context,options){var name="OWSContext";
this.nestingLayerLookup={};
options=options||{};
OpenLayers.Util.applyDefaults(options,context);
var root=this.writeNode(name,options);
this.nestingLayerLookup=null;
this.setAttributeNS(root,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},readers:{kml:{Document:function(node,obj){obj.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:true}).read(node)
}},owc:{OWSContext:function(node,obj){this.readChildNodes(node,obj)
},General:function(node,obj){this.readChildNodes(node,obj)
},ResourceList:function(node,obj){this.readChildNodes(node,obj)
},Layer:function(node,obj){var layerContext={metadata:{},visibility:(node.getAttribute("hidden")!="1"),queryable:(node.getAttribute("queryable")=="1"),opacity:((node.getAttribute("opacity")!=null)?parseFloat(node.getAttribute("opacity")):null),name:node.getAttribute("name"),categoryLayer:(node.getAttribute("name")==null),formats:[],styles:[]};
if(!obj.layersContext){obj.layersContext=[]
}obj.layersContext.push(layerContext);
this.readChildNodes(node,layerContext)
},InlineGeometry:function(node,obj){obj.features=[];
var elements=this.getElementsByTagNameNS(node,this.namespaces.gml,"featureMember");
var el;
if(elements.length>=1){el=elements[0]
}if(el&&el.firstChild){var featurenode=(el.firstChild.nextSibling)?el.firstChild.nextSibling:el.firstChild;
this.setNamespace("feature",featurenode.namespaceURI);
this.featureType=featurenode.localName||featurenode.nodeName.split(":").pop();
this.readChildNodes(node,obj)
}},Server:function(node,obj){if((!obj.service&&!obj.version)||(obj.service!=OpenLayers.Format.Context.serviceTypes.WMS)){obj.service=node.getAttribute("service");
obj.version=node.getAttribute("version");
this.readChildNodes(node,obj)
}},Name:function(node,obj){obj.name=this.getChildValue(node);
this.readChildNodes(node,obj)
},Title:function(node,obj){obj.title=this.getChildValue(node);
this.readChildNodes(node,obj)
},StyleList:function(node,obj){this.readChildNodes(node,obj.styles)
},Style:function(node,obj){var style={};
obj.push(style);
this.readChildNodes(node,style)
},LegendURL:function(node,obj){var legend={};
obj.legend=legend;
this.readChildNodes(node,legend)
},OnlineResource:function(node,obj){obj.url=this.getAttributeNS(node,this.namespaces.xlink,"href");
this.readChildNodes(node,obj)
}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(options){var node=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:options.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});
this.writeNode("General",options,node);
this.writeNode("ResourceList",options,node);
return node
},General:function(options){var node=this.createElementNSPlus("General");
this.writeNode("ows:BoundingBox",options,node);
this.writeNode("ows:Title",options.title||"OpenLayers OWSContext",node);
return node
},ResourceList:function(options){var node=this.createElementNSPlus("ResourceList");
for(var i=0,len=options.layers.length;
i<len;
i++){var layer=options.layers[i];
var decomposedPath=this.decomposeNestingPath(layer.metadata.nestingPath);
this.writeNode("_Layer",{layer:layer,subPaths:decomposedPath},node)
}return node
},Server:function(options){var node=this.createElementNSPlus("Server",{attributes:{version:options.version,service:options.service}});
this.writeNode("OnlineResource",options,node);
return node
},OnlineResource:function(options){var node=this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":options.url}});
return node
},InlineGeometry:function(layer){var node=this.createElementNSPlus("InlineGeometry");
this.writeNode("gml:boundedBy",layer.getDataExtent(),node);
for(var i=0,len=layer.features.length;
i<len;
i++){this.writeNode("gml:featureMember",layer.features[i],node)
}return node
},StyleList:function(styles){var node=this.createElementNSPlus("StyleList");
for(var i=0,len=styles.length;
i<len;
i++){this.writeNode("Style",styles[i],node)
}return node
},Style:function(style){var node=this.createElementNSPlus("Style");
this.writeNode("Name",style,node);
this.writeNode("Title",style,node);
if(style.legend){this.writeNode("LegendURL",style,node)
}return node
},Name:function(obj){var node=this.createElementNSPlus("Name",{value:obj.name});
return node
},Title:function(obj){var node=this.createElementNSPlus("Title",{value:obj.title});
return node
},LegendURL:function(style){var node=this.createElementNSPlus("LegendURL");
this.writeNode("OnlineResource",style.legend,node);
return node
},_WMS:function(layer){var node=this.createElementNSPlus("Layer",{attributes:{name:layer.params.LAYERS,queryable:layer.queryable?"1":"0",hidden:layer.visibility?"0":"1",opacity:layer.hasOwnProperty("opacity")?layer.opacity:null}});
this.writeNode("ows:Title",layer.name,node);
this.writeNode("ows:OutputFormat",layer.params.FORMAT,node);
this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:layer.params.VERSION,url:layer.url},node);
if(layer.metadata.styles&&layer.metadata.styles.length>0){this.writeNode("StyleList",layer.metadata.styles,node)
}return node
},_Layer:function(options){var layer,subPaths,node,title;
layer=options.layer;
subPaths=options.subPaths;
node=null;
title=null;
if(subPaths.length>0){var path=subPaths[0].join("/");
var index=path.lastIndexOf("/");
node=this.nestingLayerLookup[path];
title=(index>0)?path.substring(index+1,path.length):path;
if(!node){node=this.createElementNSPlus("Layer");
this.writeNode("ows:Title",title,node);
this.nestingLayerLookup[path]=node
}options.subPaths.shift();
this.writeNode("_Layer",options,node);
return node
}else{if(layer instanceof OpenLayers.Layer.WMS){node=this.writeNode("_WMS",layer)
}else{if(layer instanceof OpenLayers.Layer.Vector){if(layer.protocol instanceof OpenLayers.Protocol.WFS.v1){node=this.writeNode("_WFS",layer)
}else{if(layer.protocol instanceof OpenLayers.Protocol.HTTP){if(layer.protocol.format instanceof OpenLayers.Format.GML){layer.protocol.format.version="2.1.2";
node=this.writeNode("_GML",layer)
}else{if(layer.protocol.format instanceof OpenLayers.Format.KML){layer.protocol.format.version="2.2";
node=this.writeNode("_KML",layer)
}}}else{this.setNamespace("feature",this.featureNS);
node=this.writeNode("_InlineGeometry",layer)
}}}}if(layer.options.maxScale){this.writeNode("sld:MinScaleDenominator",layer.options.maxScale,node)
}if(layer.options.minScale){this.writeNode("sld:MaxScaleDenominator",layer.options.minScale,node)
}this.nestingLayerLookup[layer.name]=node;
return node
}},_WFS:function(layer){var node=this.createElementNSPlus("Layer",{attributes:{name:layer.protocol.featurePrefix+":"+layer.protocol.featureType,hidden:layer.visibility?"0":"1"}});
this.writeNode("ows:Title",layer.name,node);
this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:layer.protocol.version,url:layer.protocol.url},node);
return node
},_InlineGeometry:function(layer){var node=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:layer.visibility?"0":"1"}});
this.writeNode("ows:Title",layer.name,node);
this.writeNode("InlineGeometry",layer,node);
return node
},_GML:function(layer){var node=this.createElementNSPlus("Layer");
this.writeNode("ows:Title",layer.name,node);
this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:layer.protocol.url,version:layer.protocol.format.version},node);
return node
},_KML:function(layer){var node=this.createElementNSPlus("Layer");
this.writeNode("ows:Title",layer.name,node);
this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:layer.protocol.format.version,url:layer.protocol.url},node);
return node
}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(bounds){var node=this.createElementNSPlus("gml:boundedBy");
this.writeNode("gml:Box",bounds,node);
return node
}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"});
OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":true},createLayer:function(capabilities,config){var layer;
var required={layer:true,matrixSet:true};
for(var prop in required){if(!(prop in config)){throw new Error("Missing property '"+prop+"' in layer configuration.")
}}var contents=capabilities.contents;
var matrixSet=contents.tileMatrixSets[config.matrixSet];
var layers=contents.layers;
var layerDef;
for(var i=0,ii=contents.layers.length;
i<ii;
++i){if(contents.layers[i].identifier===config.layer){layerDef=contents.layers[i];
break
}}if(layerDef&&matrixSet){var style;
for(var i=0,ii=layerDef.styles.length;
i<ii;
++i){style=layerDef.styles[i];
if(style.isDefault){break
}}layer=new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(config,{url:config.requestEncoding==="REST"&&layerDef.resourceUrl?layerDef.resourceUrl.tile.template:capabilities.operationsMetadata.GetTile.dcp.http.get[0].url,name:layerDef.title,style:style.identifier,matrixIds:matrixSet.matrixIds,tileFullExtent:matrixSet.bounds}))
}return layer
},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});
OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options]);
this.options=options;
var yx=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);
this.yx=OpenLayers.Util.extend(yx,this.yx)
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var capabilities={};
this.readNode(data,capabilities);
capabilities.version=this.version;
return capabilities
},readers:{wmts:{Capabilities:function(node,obj){this.readChildNodes(node,obj)
},Contents:function(node,obj){obj.contents={};
obj.contents.layers=[];
obj.contents.tileMatrixSets={};
this.readChildNodes(node,obj.contents)
},Layer:function(node,obj){var layer={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};
layer.layers=[];
this.readChildNodes(node,layer);
obj.layers.push(layer)
},Style:function(node,obj){var style={};
style.isDefault=(node.getAttribute("isDefault")==="true");
this.readChildNodes(node,style);
obj.styles.push(style)
},Format:function(node,obj){obj.formats.push(this.getChildValue(node))
},TileMatrixSetLink:function(node,obj){var tileMatrixSetLink={};
this.readChildNodes(node,tileMatrixSetLink);
obj.tileMatrixSetLinks.push(tileMatrixSetLink)
},TileMatrixSet:function(node,obj){if(obj.layers){var tileMatrixSet={matrixIds:[]};
this.readChildNodes(node,tileMatrixSet);
obj.tileMatrixSets[tileMatrixSet.identifier]=tileMatrixSet
}else{obj.tileMatrixSet=this.getChildValue(node)
}},TileMatrix:function(node,obj){var tileMatrix={supportedCRS:obj.supportedCRS};
this.readChildNodes(node,tileMatrix);
obj.matrixIds.push(tileMatrix)
},ScaleDenominator:function(node,obj){obj.scaleDenominator=parseFloat(this.getChildValue(node))
},TopLeftCorner:function(node,obj){var topLeftCorner=this.getChildValue(node);
var coords=topLeftCorner.split(" ");
var yx;
if(obj.supportedCRS){var crs=obj.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");
yx=!!this.yx[crs]
}if(yx){obj.topLeftCorner=new OpenLayers.LonLat(coords[1],coords[0])
}else{obj.topLeftCorner=new OpenLayers.LonLat(coords[0],coords[1])
}},TileWidth:function(node,obj){obj.tileWidth=parseInt(this.getChildValue(node))
},TileHeight:function(node,obj){obj.tileHeight=parseInt(this.getChildValue(node))
},MatrixWidth:function(node,obj){obj.matrixWidth=parseInt(this.getChildValue(node))
},MatrixHeight:function(node,obj){obj.matrixHeight=parseInt(this.getChildValue(node))
},ResourceURL:function(node,obj){obj.resourceUrl=obj.resourceUrl||{};
obj.resourceUrl[node.getAttribute("resourceType")]={format:node.getAttribute("format"),template:node.getAttribute("template")}
},WSDL:function(node,obj){obj.wsdl={};
obj.wsdl.href=node.getAttribute("xlink:href")
},ServiceMetadataURL:function(node,obj){obj.serviceMetadataUrl={};
obj.serviceMetadataUrl.href=node.getAttribute("xlink:href")
},LegendURL:function(node,obj){obj.legend={};
obj.legend.href=node.getAttribute("xlink:href");
obj.legend.format=node.getAttribute("format")
},Dimension:function(node,obj){var dimension={values:[]};
this.readChildNodes(node,dimension);
obj.dimensions.push(dimension)
},Default:function(node,obj){obj["default"]=this.getChildValue(node)
},Value:function(node,obj){obj.values.push(this.getChildValue(node))
}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});
OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"});
OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var capabilities={};
this.readNode(data,capabilities);
return capabilities
},readers:{wps:{Capabilities:function(node,obj){this.readChildNodes(node,obj)
},ProcessOfferings:function(node,obj){obj.processOfferings={};
this.readChildNodes(node,obj.processOfferings)
},Process:function(node,processOfferings){var processVersion=this.getAttributeNS(node,this.namespaces.wps,"processVersion");
var process={processVersion:processVersion};
this.readChildNodes(node,process);
processOfferings[process.identifier]=process
},Languages:function(node,obj){obj.languages=[];
this.readChildNodes(node,obj.languages)
},Default:function(node,languages){var language={isDefault:true};
this.readChildNodes(node,language);
languages.push(language)
},Supported:function(node,languages){var language={};
this.readChildNodes(node,language);
languages.push(language)
}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"});
OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var info={};
this.readNode(data,info);
return info
},readers:{wps:{ProcessDescriptions:function(node,obj){obj.processDescriptions={};
this.readChildNodes(node,obj.processDescriptions)
},ProcessDescription:function(node,processDescriptions){var processVersion=this.getAttributeNS(node,this.namespaces.wps,"processVersion");
var processDescription={processVersion:processVersion,statusSupported:(node.getAttribute("statusSupported")==="true"),storeSupported:(node.getAttribute("storeSupported")==="true")};
this.readChildNodes(node,processDescription);
processDescriptions[processDescription.identifier]=processDescription
},DataInputs:function(node,processDescription){processDescription.dataInputs=[];
this.readChildNodes(node,processDescription.dataInputs)
},ProcessOutputs:function(node,processDescription){processDescription.processOutputs=[];
this.readChildNodes(node,processDescription.processOutputs)
},Output:function(node,processOutputs){var output={};
this.readChildNodes(node,output);
processOutputs.push(output)
},ComplexOutput:function(node,output){output.complexOutput={};
this.readChildNodes(node,output.complexOutput)
},Input:function(node,dataInputs){var input={maxOccurs:parseInt(node.getAttribute("maxOccurs")),minOccurs:parseInt(node.getAttribute("minOccurs"))};
this.readChildNodes(node,input);
dataInputs.push(input)
},BoundingBoxData:function(node,input){input.boundingBoxData={};
this.readChildNodes(node,input.boundingBoxData)
},CRS:function(node,obj){if(!obj.CRSs){obj.CRSs={}
}obj.CRSs[this.getChildValue(node)]=true
},LiteralData:function(node,input){input.literalData={};
this.readChildNodes(node,input.literalData)
},ComplexData:function(node,input){input.complexData={};
this.readChildNodes(node,input.complexData)
},Default:function(node,complexData){complexData["default"]={};
this.readChildNodes(node,complexData["default"])
},Supported:function(node,complexData){complexData.supported={};
this.readChildNodes(node,complexData.supported)
},Format:function(node,obj){var format={};
this.readChildNodes(node,format);
if(!obj.formats){obj.formats={}
}obj.formats[format.mimeType]=true
},MimeType:function(node,format){format.mimeType=this.getChildValue(node)
}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"});
OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(options){return undefined
},write:function(options){var doc;
if(window.ActiveXObject){doc=new ActiveXObject("Microsoft.XMLDOM");
this.xmldom=doc
}else{doc=document.implementation.createDocument("","",null)
}var node=this.writeNode("wps:Execute",options,doc);
this.setAttributeNS(node,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);
return OpenLayers.Format.XML.prototype.write.apply(this,[node])
},writers:{wps:{Execute:function(options){var node=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});
this.writeNode("ows:Identifier",options.identifier,node);
this.writeNode("wps:DataInputs",options.dataInputs,node);
this.writeNode("wps:ResponseForm",options.responseForm,node);
return node
},ResponseForm:function(responseForm){var node=this.createElementNSPlus("wps:ResponseForm",{});
if(responseForm.rawDataOutput){this.writeNode("wps:RawDataOutput",responseForm.rawDataOutput,node)
}if(responseForm.responseDocument){this.writeNode("wps:ResponseDocument",responseForm.responseDocument,node)
}return node
},ResponseDocument:function(responseDocument){var node=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:responseDocument.storeExecuteResponse,lineage:responseDocument.lineage,status:responseDocument.status}});
if(responseDocument.output){this.writeNode("wps:Output",responseDocument.output,node)
}return node
},Output:function(output){var node=this.createElementNSPlus("wps:Output",{attributes:{asReference:output.asReference}});
this.writeNode("ows:Identifier",output.identifier,node);
this.writeNode("ows:Title",output.title,node);
this.writeNode("ows:Abstract",output["abstract"],node);
return node
},RawDataOutput:function(rawDataOutput){var node=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:rawDataOutput.mimeType}});
this.writeNode("ows:Identifier",rawDataOutput.identifier,node);
return node
},DataInputs:function(dataInputs){var node=this.createElementNSPlus("wps:DataInputs",{});
for(var i=0,ii=dataInputs.length;
i<ii;
++i){this.writeNode("wps:Input",dataInputs[i],node)
}return node
},Input:function(input){var node=this.createElementNSPlus("wps:Input",{});
this.writeNode("ows:Identifier",input.identifier,node);
if(input.title){this.writeNode("ows:Title",input.title,node)
}if(input.data){this.writeNode("wps:Data",input.data,node)
}if(input.reference){this.writeNode("wps:Reference",input.reference,node)
}return node
},Data:function(data){var node=this.createElementNSPlus("wps:Data",{});
if(data.literalData){this.writeNode("wps:LiteralData",data.literalData,node)
}else{if(data.complexData){this.writeNode("wps:ComplexData",data.complexData,node)
}}return node
},LiteralData:function(literalData){var node=this.createElementNSPlus("wps:LiteralData",{attributes:{uom:literalData.uom},value:literalData.value});
return node
},ComplexData:function(complexData){var node=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:complexData.mimeType,encoding:complexData.encoding,schema:complexData.schema}});
var data=complexData.value;
if(typeof data==="string"){node.appendChild(this.getXMLDoc().createCDATASection(complexData.value))
}else{node.appendChild(data)
}return node
},Reference:function(reference){var node=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:reference.mimeType,"xlink:href":reference.href,method:reference.method,encoding:reference.encoding,schema:reference.schema}});
if(reference.body){this.writeNode("wps:Body",reference.body,node)
}return node
},Body:function(body){var node=this.createElementNSPlus("wps:Body",{});
if(body.wcs){this.writeNode("wcs:GetCoverage",body.wcs,node)
}else{if(body.wfs){this.featureType=body.wfs.featureType;
this.version=body.wfs.version;
this.writeNode("wfs:GetFeature",body.wfs,node)
}else{this.writeNode("wps:Execute",body,node)
}}return node
}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"});
OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:true,CLASS_NAME:"OpenLayers.Format.XLS"});
OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},xy:true,defaultPrefix:"xls",schemaLocation:null,read:function(data,options){options=OpenLayers.Util.applyDefaults(options,this.options);
var xls={};
this.readChildNodes(data,xls);
return xls
},readers:{xls:{XLS:function(node,xls){xls.version=node.getAttribute("version");
this.readChildNodes(node,xls)
},Response:function(node,xls){this.readChildNodes(node,xls)
},GeocodeResponse:function(node,xls){xls.responseLists=[];
this.readChildNodes(node,xls)
},GeocodeResponseList:function(node,xls){var responseList={features:[],numberOfGeocodedAddresses:parseInt(node.getAttribute("numberOfGeocodedAddresses"))};
xls.responseLists.push(responseList);
this.readChildNodes(node,responseList)
},GeocodedAddress:function(node,responseList){var feature=new OpenLayers.Feature.Vector();
responseList.features.push(feature);
this.readChildNodes(node,feature);
feature.geometry=feature.components[0]
},GeocodeMatchCode:function(node,feature){feature.attributes.matchCode={accuracy:parseFloat(node.getAttribute("accuracy")),matchType:node.getAttribute("matchType")}
},Address:function(node,feature){var address={countryCode:node.getAttribute("countryCode"),addressee:node.getAttribute("addressee"),street:[],place:[]};
feature.attributes.address=address;
this.readChildNodes(node,address)
},freeFormAddress:function(node,address){address.freeFormAddress=this.getChildValue(node)
},StreetAddress:function(node,address){this.readChildNodes(node,address)
},Building:function(node,address){address.building={number:node.getAttribute("number"),subdivision:node.getAttribute("subdivision"),buildingName:node.getAttribute("buildingName")}
},Street:function(node,address){address.street.push(this.getChildValue(node))
},Place:function(node,address){address.place[node.getAttribute("type")]=this.getChildValue(node)
},PostalCode:function(node,address){address.postalCode=this.getChildValue(node)
}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(request){return this.writers.xls.XLS.apply(this,[request])
},writers:{xls:{XLS:function(request){var root=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});
this.writeNode("RequestHeader",request.header,root);
this.writeNode("Request",request,root);
return root
},RequestHeader:function(header){return this.createElementNSPlus("xls:RequestHeader")
},Request:function(request){var node=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:request.requestID||"",version:this.VERSION}});
this.writeNode("GeocodeRequest",request.addresses,node);
return node
},GeocodeRequest:function(addresses){var node=this.createElementNSPlus("xls:GeocodeRequest");
for(var i=0,len=addresses.length;
i<len;
i++){this.writeNode("Address",addresses[i],node)
}return node
},Address:function(address){var node=this.createElementNSPlus("xls:Address",{attributes:{countryCode:address.countryCode}});
if(address.freeFormAddress){this.writeNode("freeFormAddress",address.freeFormAddress,node)
}else{if(address.street){this.writeNode("StreetAddress",address,node)
}if(address.municipality){this.writeNode("Municipality",address.municipality,node)
}if(address.countrySubdivision){this.writeNode("CountrySubdivision",address.countrySubdivision,node)
}if(address.postalCode){this.writeNode("PostalCode",address.postalCode,node)
}}return node
},freeFormAddress:function(freeFormAddress){return this.createElementNSPlus("freeFormAddress",{value:freeFormAddress})
},StreetAddress:function(address){var node=this.createElementNSPlus("xls:StreetAddress");
if(address.building){this.writeNode(node,"Building",address.building)
}var street=address.street;
if(!(OpenLayers.Util.isArray(street))){street=[street]
}for(var i=0,len=street.length;
i<len;
i++){this.writeNode("Street",street[i],node)
}return node
},Building:function(building){return this.createElementNSPlus("xls:Building",{attributes:{number:building.number,subdivision:building.subdivision,buildingName:building.buildingName}})
},Street:function(street){return this.createElementNSPlus("xls:Street",{value:street})
},Municipality:function(municipality){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:municipality})
},CountrySubdivision:function(countrySubdivision){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:countrySubdivision})
},PostalCode:function(postalCode){return this.createElementNSPlus("xls:PostalCode",{value:postalCode})
}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"});
OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"});
OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0;
OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g)},defaultPrefix:"ogc",read:function(data){var result;
if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var root=data.documentElement;
var exceptionInfo={exceptionReport:null};
if(root){this.readChildNodes(data,exceptionInfo);
if(exceptionInfo.exceptionReport===null){exceptionInfo=new OpenLayers.Format.OWSCommon().read(data)
}}return exceptionInfo
},readers:{ogc:{ServiceExceptionReport:function(node,obj){obj.exceptionReport={exceptions:[]};
this.readChildNodes(node,obj.exceptionReport)
},ServiceException:function(node,exceptionReport){var exception={code:node.getAttribute("code"),locator:node.getAttribute("locator"),text:this.getChildValue(node)};
exceptionReport.exceptions.push(exception)
}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});
OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:false,click:true,single:true,clickout:true,toggle:false,clickTolerance:5,hover:false,box:false,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(options){options.handlerOptions=options.handlerOptions||{};
OpenLayers.Control.prototype.initialize.apply(this,[options]);
this.features={};
this.handlers={};
if(this.click){this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})
}if(this.box){this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))
}if(this.hover){this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2}))
}},activate:function(){if(!this.active){for(var i in this.handlers){this.handlers[i].activate()
}}return OpenLayers.Control.prototype.activate.apply(this,arguments)
},deactivate:function(){if(this.active){for(var i in this.handlers){this.handlers[i].deactivate()
}}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)
},selectClick:function(evt){var bounds=this.pixelToBounds(evt.xy);
this.setModifiers(evt);
this.request(bounds,{single:this.single})
},selectBox:function(position){var bounds;
if(position instanceof OpenLayers.Bounds){var minXY=this.map.getLonLatFromPixel({x:position.left,y:position.bottom});
var maxXY=this.map.getLonLatFromPixel({x:position.right,y:position.top});
bounds=new OpenLayers.Bounds(minXY.lon,minXY.lat,maxXY.lon,maxXY.lat)
}else{if(this.click){return
}bounds=this.pixelToBounds(position)
}this.setModifiers(this.handlers.box.dragHandler.evt);
this.request(bounds)
},selectHover:function(evt){var bounds=this.pixelToBounds(evt.xy);
this.request(bounds,{single:true,hover:true})
},cancelHover:function(){if(this.hoverResponse){this.protocol.abort(this.hoverResponse);
this.hoverResponse=null;
OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")
}},request:function(bounds,options){options=options||{};
var filter=new OpenLayers.Filter.Spatial({type:this.filterType,value:bounds});
OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");
var response=this.protocol.read({maxFeatures:options.single==true?this.maxFeatures:undefined,filter:filter,callback:function(result){if(result.success()){if(result.features.length){if(options.single==true){this.selectBestFeature(result.features,bounds.getCenterLonLat(),options)
}else{this.select(result.features)
}}else{if(options.hover){this.hoverSelect()
}else{this.events.triggerEvent("clickout");
if(this.clickout){this.unselectAll()
}}}}OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")
},scope:this});
if(options.hover==true){this.hoverResponse=response
}},selectBestFeature:function(features,clickPosition,options){options=options||{};
if(features.length){var point=new OpenLayers.Geometry.Point(clickPosition.lon,clickPosition.lat);
var feature,resultFeature,dist;
var minDist=Number.MAX_VALUE;
for(var i=0;
i<features.length;
++i){feature=features[i];
if(feature.geometry){dist=point.distanceTo(feature.geometry,{edge:false});
if(dist<minDist){minDist=dist;
resultFeature=feature;
if(minDist==0){break
}}}}if(options.hover==true){this.hoverSelect(resultFeature)
}else{this.select(resultFeature||features)
}}},setModifiers:function(evt){this.modifiers={multiple:this.multiple||(this.multipleKey&&evt[this.multipleKey]),toggle:this.toggle||(this.toggleKey&&evt[this.toggleKey])}
},select:function(features){if(!this.modifiers.multiple&&!this.modifiers.toggle){this.unselectAll()
}if(!(OpenLayers.Util.isArray(features))){features=[features]
}var cont=this.events.triggerEvent("beforefeaturesselected",{features:features});
if(cont!==false){var selectedFeatures=[];
var feature;
for(var i=0,len=features.length;
i<len;
++i){feature=features[i];
if(this.features[feature.fid||feature.id]){if(this.modifiers.toggle){this.unselect(this.features[feature.fid||feature.id])
}}else{cont=this.events.triggerEvent("beforefeatureselected",{feature:feature});
if(cont!==false){this.features[feature.fid||feature.id]=feature;
selectedFeatures.push(feature);
this.events.triggerEvent("featureselected",{feature:feature})
}}}this.events.triggerEvent("featuresselected",{features:selectedFeatures})
}},hoverSelect:function(feature){var fid=feature?feature.fid||feature.id:null;
var hfid=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;
if(hfid&&hfid!=fid){this.events.triggerEvent("outfeature",{feature:this.hoverFeature});
this.hoverFeature=null
}if(fid&&fid!=hfid){this.events.triggerEvent("hoverfeature",{feature:feature});
this.hoverFeature=feature
}},unselect:function(feature){delete this.features[feature.fid||feature.id];
this.events.triggerEvent("featureunselected",{feature:feature})
},unselectAll:function(){for(var fid in this.features){this.unselect(this.features[fid])
}},setMap:function(map){for(var i in this.handlers){this.handlers[i].setMap(map)
}OpenLayers.Control.prototype.setMap.apply(this,arguments)
},pixelToBounds:function(pixel){var llPx=pixel.add(-this.clickTolerance/2,this.clickTolerance/2);
var urPx=pixel.add(this.clickTolerance/2,-this.clickTolerance/2);
var ll=this.map.getLonLatFromPixel(llPx);
var ur=this.map.getLonLatFromPixel(urPx);
return new OpenLayers.Bounds(ll.lon,ll.lat,ur.lon,ur.lat)
},CLASS_NAME:"OpenLayers.Control.GetFeature"});
OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]);
this.addControls([new OpenLayers.Control.Navigation(),new OpenLayers.Control.ZoomBox()])
},draw:function(){var div=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);
if(this.defaultControl===null){this.defaultControl=this.controls[0]
}return div
},CLASS_NAME:"OpenLayers.Control.NavToolbar"});
OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]);
var options={slideFactor:this.slideFactor,slideRatio:this.slideRatio};
this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,options),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,options),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,options),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,options)])
},CLASS_NAME:"OpenLayers.Control.PanPanel"});
OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(direction,options){this.direction=direction;
this.CLASS_NAME+=this.direction;
OpenLayers.Control.prototype.initialize.apply(this,[options])
},trigger:function(){var getSlideFactor=OpenLayers.Function.bind(function(dim){return this.slideRatio?this.map.getSize()[dim]*this.slideRatio:this.slideFactor
},this);
switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-getSlideFactor("h"));
break;
case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,getSlideFactor("h"));
break;
case OpenLayers.Control.Pan.WEST:this.map.pan(-getSlideFactor("w"),0);
break;
case OpenLayers.Control.Pan.EAST:this.map.pan(getSlideFactor("w"),0);
break
}},CLASS_NAME:"OpenLayers.Control.Pan"});
OpenLayers.Control.Pan.NORTH="North";
OpenLayers.Control.Pan.SOUTH="South";
OpenLayers.Control.Pan.EAST="East";
OpenLayers.Control.Pan.WEST="West";
OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()
},CLASS_NAME:"OpenLayers.Control.ZoomIn"});
OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()
},CLASS_NAME:"OpenLayers.Control.ZoomOut"});
OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]);
this.addControls([new OpenLayers.Control.ZoomIn(),new OpenLayers.Control.ZoomToMaxExtent(),new OpenLayers.Control.ZoomOut()])
},CLASS_NAME:"OpenLayers.Control.ZoomPanel"});
OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:false,initialize:function(layer,options){OpenLayers.Control.Panel.prototype.initialize.apply(this,[options]);
this.addControls([new OpenLayers.Control.Navigation()]);
var controls=[new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(layer,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];
this.addControls(controls)
},draw:function(){var div=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);
if(this.defaultControl===null){this.defaultControl=this.controls[0]
}return div
},CLASS_NAME:"OpenLayers.Control.EditingToolbar"});
OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:navigator.geolocation,bind:true,watch:false,geolocationOptions:null,destroy:function(){this.deactivate();
OpenLayers.Control.prototype.destroy.apply(this,arguments)
},activate:function(){if(!this.geolocation){this.events.triggerEvent("locationuncapable");
return false
}if(OpenLayers.Control.prototype.activate.apply(this,arguments)){if(this.watch){this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions)
}else{this.getCurrentLocation()
}return true
}return false
},deactivate:function(){if(this.active&&this.watchId!==null){this.geolocation.clearWatch(this.watchId)
}return OpenLayers.Control.prototype.deactivate.apply(this,arguments)
},geolocate:function(position){var center=new OpenLayers.LonLat(position.coords.longitude,position.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());
if(this.bind){this.map.setCenter(center)
}this.events.triggerEvent("locationupdated",{position:position,point:new OpenLayers.Geometry.Point(center.lon,center.lat)})
},getCurrentLocation:function(){if(!this.active||this.watch){return false
}this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions);
return true
},failure:function(error){this.events.triggerEvent("locationfailed",{error:error})
},CLASS_NAME:"OpenLayers.Control.Geolocate"});
OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(config){OpenLayers.Util.extend(this,config)
},clone:function(){var Type=eval(this.CLASS_NAME);
return new Type(OpenLayers.Util.extend({},this))
},CLASS_NAME:"OpenLayers.Symbolizer"});
OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Symbolizer.Point"});
OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Symbolizer.Line"});
OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"});
OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Symbolizer.Text"});
OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(config){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Symbolizer.Raster"});
OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){if(!OpenLayers.Lang.code){OpenLayers.Lang.setCode()
}return OpenLayers.Lang.code
},setCode:function(code){var lang;
if(!code){code=(OpenLayers.BROWSER_NAME=="msie")?navigator.userLanguage:navigator.language
}var parts=code.split("-");
parts[0]=parts[0].toLowerCase();
if(typeof OpenLayers.Lang[parts[0]]=="object"){lang=parts[0]
}if(parts[1]){var testLang=parts[0]+"-"+parts[1].toUpperCase();
if(typeof OpenLayers.Lang[testLang]=="object"){lang=testLang
}}if(!lang){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+parts.join("-")+" dictionary, falling back to default language");
lang=OpenLayers.Lang.defaultCode
}OpenLayers.Lang.code=lang
},translate:function(key,context){var dictionary=OpenLayers.Lang[OpenLayers.Lang.getCode()];
var message=dictionary&&dictionary[key];
if(!message){message=key
}if(context){message=OpenLayers.String.format(message,context)
}return message
}};
OpenLayers.i18n=OpenLayers.Lang.translate;
OpenLayers.Lang.es={unhandledRequest:"Respuesta a peticin no gestionada ${statusText}",Permalink:"Enlace permanente",Overlays:"Capas superpuestas","Base Layer":"Capa Base",noFID:"No se puede actualizar un elemento para el que no existe FID.",browserNotSupported:"Su navegador no soporta renderizacin vectorial. Los renderizadores soportados actualmente son:\n${renderers}",minZoomLevelError:"La propiedad minZoomLevel debe slo utilizarse con las capas que tienen FixedZoomLevels. El hecho de que una capa wfs compruebe minZoomLevel es una reliquia del pasado. Sin embargo, no podemos eliminarla sin discontinuar probablemente las aplicaciones OL que puedan depender de ello. As pues estamos hacindolo obsoleto --la comprobacin minZoomLevel se eliminar en la versin 3.0. Utilice el ajuste de resolution min/max en su lugar, tal como se describe aqu: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"Transaccin WFS: XITO ${response}",commitFailed:"Transaccin WFS: FALL ${response}",googleWarning:"La capa Google no pudo ser cargada correctamente.<br><br>Para evitar este mensaje, seleccione una nueva Capa Base en el selector de capas en la esquina superior derecha.<br><br>Probablemente, esto se debe a que el script de la biblioteca de Google Maps no fue correctamente incluido en su pgina, o no contiene la clave del API correcta para su sitio.<br><br>Desarrolladores: Para ayudar a hacer funcionar esto correctamente, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>haga clic aqu</a>",getLayerWarning:"La capa ${layerType} no pudo ser cargada correctamente.<br><br>Para evitar este mensaje, seleccione una nueva Capa Base en el selector de capas en la esquina superior derecha.<br><br>Probablemente, esto se debe a que el script de la biblioteca ${layerLib} no fue correctamente incluido en su pgina.<br><br>Desarrolladores: Para ayudar a hacer funcionar esto correctamente, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>haga clic aqu</a>","Scale = 1 : ${scaleDenom}":"Escala = 1 : ${scaleDenom}",W:"O",E:"E",N:"N",S:"S",Graticule:"Retcula",reprojectDeprecated:"Est usando la opcin 'reproject' en la capa ${layerName}. Esta opcin es obsoleta: su uso fue diseado para soportar la visualizacin de datos sobre mapas base comerciales, pero ahora esa funcionalidad debera conseguirse mediante el soporte de la proyeccin Spherical Mercator. Ms informacin disponible en http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Este mtodo es obsoleto y se eliminar en la versin 3.0. Por favor utilice el mtodo ${newMethod} en su lugar.",end:""};
OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Base Layer",noFID:"Can't update a feature for which there is no FID.",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>","Scale = 1 : ${scaleDenom}":"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",Graticule:"Graticule",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",proxyNeeded:"You probably need to set OpenLayers.ProxyHost to access http://geonetwork-opensource.org/geonetwork-client.See http://trac.osgeo.org/openlayers/wiki/FrequentlyAskedQuestions#ProxyHost",end:""};
OpenLayers.Lang.nl=OpenLayers.Util.applyDefaults({unhandledRequest:"Het verzoek is niet afgehandeld met de volgende melding: ${statusText}",Permalink:"Permanente verwijzing",Overlays:"Overlays","Base Layer":"Achtergrondkaart",noFID:"Een optie die geen FID heeft kan niet bijgewerkt worden.",browserNotSupported:"Uw browser ondersteunt het weergeven van vectoren niet.\nMomenteel ondersteunde weergavemogelijkheden:\n${renderers}",minZoomLevelError:"De eigenschap minZoomLevel is alleen bedoeld voor gebruik lagen met die afstammen van FixedZoomLevels-lagen.\nDat deze WFS-laag minZoomLevel controleert, is een overblijfsel uit het verleden.\nWe kunnen deze controle echter niet verwijderen zonder op OL gebaseerde applicaties die hervan afhankelijk zijn stuk te maken.\nDaarom heeft deze functionaliteit de eigenschap 'deprecated' gekregen - de minZoomLevel wordt verwijderd in versie 3.0.\nGebruik in plaats van deze functie de mogelijkheid om min/max voor resolutie in te stellen zoals op de volgende pagina wordt beschreven:\nhttp://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS-transactie: succesvol ${response}",commitFailed:"WFS-transactie: mislukt ${response}",googleWarning:"De Google-Layer kon niet correct geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct ingevoegd is.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.",getLayerWarning:"De laag ${layerType} kon niet goed geladen worden.\x3cbr /\x3e\x3cbr /\x3e\nOm deze melding niet meer te krijgen, moet u een andere achtergrondkaart kiezen in de laagwisselaar in de rechterbovenhoek.\x3cbr /\x3e\x3cbr /\x3e\nDit komt waarschijnlijk doordat de bibliotheek ${layerLib} niet correct is ingevoegd.\x3cbr /\x3e\x3cbr /\x3e\nOntwikkelaars: \x3ca href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'\x3eklik hier\x3c/a\x3e om dit werkend te krijgen.","Scale = 1 : ${scaleDenom}":"Schaal = 1 : ${scaleDenom}",W:"W",E:"O",N:"N",S:"Z",reprojectDeprecated:"U gebruikt de optie 'reproject' op de laag ${layerName}.\nDeze optie is vervallen: deze optie was ontwikkeld om gegevens over commercile basiskaarten weer te geven, maar deze functionaliteit wordt nu bereikt door ondersteuning van Spherical Mercator.\nMeer informatie is beschikbaar op http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"Deze methode is verouderd en wordt verwijderd in versie 3.0.\nGebruik ${newMethod}."});
OpenLayers.Spherical=OpenLayers.Spherical||{};
OpenLayers.Spherical.DEFAULT_RADIUS=6378137;
OpenLayers.Spherical.computeDistanceBetween=function(from,to,radius){var R=radius||OpenLayers.Spherical.DEFAULT_RADIUS;
var sinHalfDeltaLon=Math.sin(Math.PI*(to.lon-from.lon)/360);
var sinHalfDeltaLat=Math.sin(Math.PI*(to.lat-from.lat)/360);
var a=sinHalfDeltaLat*sinHalfDeltaLat+sinHalfDeltaLon*sinHalfDeltaLon*Math.cos(Math.PI*from.lat/180)*Math.cos(Math.PI*to.lat/180);
return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))
};
OpenLayers.Spherical.computeHeading=function(from,to){var y=Math.sin(Math.PI*(from.lon-to.lon)/180)*Math.cos(Math.PI*to.lat/180);
var x=Math.cos(Math.PI*from.lat/180)*Math.sin(Math.PI*to.lat/180)-Math.sin(Math.PI*from.lat/180)*Math.cos(Math.PI*to.lat/180)*Math.cos(Math.PI*(from.lon-to.lon)/180);
return 180*Math.atan2(y,x)/Math.PI
};
OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:false,visible:true,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options])
},setVisible:function(visible){this.visible=visible;
if(visible){OpenLayers.Element.show(this.div)
}else{OpenLayers.Element.hide(this.div)
}},getVisible:function(){return this.visible
},hide:function(){this.setVisible(false)
},show:function(){this.setVisible(true)
},toggle:function(){this.setVisible(!this.getVisible())
},addLayer:function(evt){if(evt.layer){evt.layer.events.register("loadstart",this,this.increaseCounter);
evt.layer.events.register("loadend",this,this.decreaseCounter)
}},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);
this.map.events.register("preaddlayer",this,this.addLayer);
for(var i=0;
i<this.map.layers.length;
i++){var layer=this.map.layers[i];
layer.events.register("loadstart",this,this.increaseCounter);
layer.events.register("loadend",this,this.decreaseCounter)
}},increaseCounter:function(){this.counter++;
if(this.counter>0){if(!this.maximized&&this.visible){this.maximizeControl()
}}},decreaseCounter:function(){if(this.counter>0){this.counter--
}if(this.counter==0){if(this.maximized&&this.visible){this.minimizeControl()
}}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
return this.div
},minimizeControl:function(evt){this.div.style.display="none";
this.div.style.width="0px";
this.div.style.height="0px";
this.maximized=false;
if(evt!=null){OpenLayers.Event.stop(evt)
}},maximizeControl:function(evt){var viewSize=this.map.getSize();
var msgW=viewSize.w;
var msgH=viewSize.h;
this.div.style.width=msgW+"px";
this.div.style.height=msgH+"px";
this.div.style.display="block";
this.maximized=true;
if(evt!=null){OpenLayers.Event.stop(evt)
}},destroy:function(){if(this.map){this.map.events.unregister("preaddlayer",this,this.addLayer);
if(this.map.layers){for(var i=0;
i<this.map.layers.length;
i++){var layer=this.map.layers[i];
layer.events.unregister("loadstart",this,this.increaseCounter);
layer.events.unregister("loadend",this,this.decreaseCounter)
}}}OpenLayers.Control.prototype.destroy.apply(this,arguments)
},CLASS_NAME:"OpenLayers.Control.LoadingPanel"});
OpenLayers.Control.ScaleBar=OpenLayers.Class(OpenLayers.Control,{element:null,scale:1,displaySystem:"metric",minWidth:100,maxWidth:200,divisions:2,subdivisions:2,showMinorMeasures:false,abbreviateLabel:false,singleLine:false,align:"left",div:null,scaleText:"scale 1:",thousandsSeparator:"",measurementProperties:{english:{units:["miles","feet","inches"],abbr:["mi","ft","in"],inches:[63360,12,1]},metric:{units:["kilometers","meters","centimeters"],abbr:["km","m","cm"],inches:[39370.07874,39.370079,0.393701]}},limitedStyle:false,customStyles:null,defaultStyles:{Bar:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},BarAlt:{height:11,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMajor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},MarkerMinor:{height:13,width:13,top:12,borderLeftWidth:0,borderRightWidth:0},NumbersBox:{height:13,width:40,top:24},LabelBox:{height:15,top:-2},LabelBoxSingleLine:{height:15,width:35,top:5,left:10}},appliedStyles:null,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);
if(!document.styleSheets){this.limitedStyle=true
}if(this.limitedStyle){this.appliedStyles=OpenLayers.Util.extend({},this.defaultStyles);
OpenLayers.Util.extend(this.appliedStyles,this.customStyles)
}this.element=document.createElement("div");
this.element.style.position="relative";
this.element.className=this.displayClass+"Wrapper";
this.labelContainer=document.createElement("div");
this.labelContainer.className=this.displayClass+"Units";
this.labelContainer.style.position="absolute";
this.graphicsContainer=document.createElement("div");
this.graphicsContainer.style.position="absolute";
this.graphicsContainer.className=this.displayClass+"Graphics";
this.numbersContainer=document.createElement("div");
this.numbersContainer.style.position="absolute";
this.numbersContainer.className=this.displayClass+"Numbers";
this.element.appendChild(this.graphicsContainer);
this.element.appendChild(this.labelContainer);
this.element.appendChild(this.numbersContainer)
},destroy:function(){this.map.events.unregister("moveend",this,this.onMoveend);
this.div.innerHTML="";
OpenLayers.Control.prototype.destroy.apply(this)
},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);
this.dxMarkerMajor=(this.styleValue("MarkerMajor","borderLeftWidth")+this.styleValue("MarkerMajor","width")+this.styleValue("MarkerMajor","borderRightWidth"))/2;
this.dxMarkerMinor=(this.styleValue("MarkerMinor","borderLeftWidth")+this.styleValue("MarkerMinor","width")+this.styleValue("MarkerMinor","borderRightWidth"))/2;
this.dxBar=(this.styleValue("Bar","borderLeftWidth")+this.styleValue("Bar","borderRightWidth"))/2;
this.dxBarAlt=(this.styleValue("BarAlt","borderLeftWidth")+this.styleValue("BarAlt","borderRightWidth"))/2;
this.dxNumbersBox=this.styleValue("NumbersBox","width")/2;
var classNames=["Bar","BarAlt","MarkerMajor","MarkerMinor"];
if(this.singleLine){classNames.push("LabelBoxSingleLine")
}else{classNames.push("NumbersBox","LabelBox")
}var vertDisp=0;
for(var classIndex=0;
classIndex<classNames.length;
++classIndex){var cls=classNames[classIndex];
vertDisp=Math.max(vertDisp,this.styleValue(cls,"top")+this.styleValue(cls,"height"))
}this.element.style.height=vertDisp+"px";
this.xOffsetSingleLine=this.styleValue("LabelBoxSingleLine","width")+this.styleValue("LabelBoxSingleLine","left");
this.div.appendChild(this.element);
this.map.events.register("moveend",this,this.onMoveend);
this.update();
return this.div
},onMoveend:function(){this.update()
},update:function(scale){if(this.map.baseLayer==null||!this.map.getScale()){return
}this.scale=(scale!=undefined)?scale:this.map.getScale();
this.element.title=this.scaleText+OpenLayers.Number.format(this.scale);
this.element.style.width=this.maxWidth+"px";
var comp=this.getComp();
this.setSubProps(comp);
this.labelContainer.innerHTML="";
this.graphicsContainer.innerHTML="";
this.numbersContainer.innerHTML="";
var numDiv=this.divisions*this.subdivisions;
var alignmentOffset={left:0+(this.singleLine?0:this.dxNumbersBox),center:(this.maxWidth/2)-(numDiv*this.subProps.pixels/2)-(this.singleLine?this.xOffsetSingleLine/2:0),right:this.maxWidth-(numDiv*this.subProps.pixels)-(this.singleLine?this.xOffsetSingleLine:this.dxNumbersBox)};
var xPos,measure,divNum,cls,left;
for(var di=0;
di<this.divisions;
++di){xPos=di*this.subdivisions*this.subProps.pixels+alignmentOffset[this.align];
this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",xPos-this.dxMarkerMajor));
if(!this.singleLine){measure=(di==0)?0:OpenLayers.Number.format((di*this.subdivisions)*this.subProps.length,this.subProps.dec,this.thousandsSeparator);
this.numbersContainer.appendChild(this.createElement("NumbersBox",measure,xPos-this.dxNumbersBox))
}for(var si=0;
si<this.subdivisions;
++si){if((si%2)==0){cls="Bar";
left=xPos-this.dxBar
}else{cls="BarAlt";
left=xPos-this.dxBarAlt
}this.graphicsContainer.appendChild(this.createElement(cls," ",left,this.subProps.pixels));
if(si<this.subdivisions-1){divNum=(di*this.subdivisions)+si+1;
xPos=divNum*this.subProps.pixels+alignmentOffset[this.align];
this.graphicsContainer.appendChild(this.createElement("MarkerMinor"," ",xPos-this.dxMarkerMinor));
if(this.showMinorMeasures&&!this.singleLine){measure=divNum*this.subProps.length;
this.numbersContainer.appendChild(this.createElement("NumbersBox",measure,xPos-this.dxNumbersBox))
}}}}xPos=numDiv*this.subProps.pixels;
xPos+=alignmentOffset[this.align];
this.graphicsContainer.appendChild(this.createElement("MarkerMajor"," ",xPos-this.dxMarkerMajor));
measure=OpenLayers.Number.format(numDiv*this.subProps.length,this.subProps.dec,this.thousandsSeparator);
if(!this.singleLine){this.numbersContainer.appendChild(this.createElement("NumbersBox",measure,xPos-this.dxNumbersBox))
}var labelBox=document.createElement("div");
labelBox.style.position="absolute";
var labelText;
if(this.singleLine){labelText=measure;
labelBox.className=this.displayClass+"LabelBoxSingleLine";
labelBox.style.left=Math.round(xPos+this.styleValue("LabelBoxSingleLine","left"))+"px"
}else{labelText="";
labelBox.className=this.displayClass+"LabelBox";
labelBox.style.textAlign="center";
labelBox.style.width=Math.round(numDiv*this.subProps.pixels)+"px";
labelBox.style.left=Math.round(alignmentOffset[this.align])+"px";
labelBox.style.overflow="hidden"
}if(this.abbreviateLabel){labelText+=" "+this.subProps.abbr
}else{labelText+=" "+this.subProps.units
}labelBox.appendChild(document.createTextNode(labelText));
this.labelContainer.appendChild(labelBox)
},createElement:function(cls,text,left,width){var element=document.createElement("div");
element.className=this.displayClass+cls;
OpenLayers.Util.extend(element.style,{position:"absolute",textAlign:"center",overflow:"hidden",left:Math.round(left)+"px"});
element.appendChild(document.createTextNode(text));
if(width){element.style.width=Math.round(width)+"px"
}return element
},getComp:function(){var system=this.measurementProperties[this.displaySystem];
var numUnits=system.units.length;
var comp=new Array(numUnits);
var numDiv=this.divisions*this.subdivisions;
for(var unitIndex=0;
unitIndex<numUnits;
++unitIndex){comp[unitIndex]={};
var ppdu=OpenLayers.DOTS_PER_INCH*system.inches[unitIndex]/this.scale;
var minSDDisplayLength=((this.minWidth-this.dxNumbersBox)/ppdu)/numDiv;
var maxSDDisplayLength=((this.maxWidth-this.dxNumbersBox)/ppdu)/numDiv;
for(var vi=0;
vi<numDiv;
++vi){var minNumber=minSDDisplayLength*(vi+1);
var maxNumber=maxSDDisplayLength*(vi+1);
var num=this.getHandsomeNumber(minNumber,maxNumber);
var compNum={value:(num.value/(vi+1)),score:0,tie:0,dec:0,displayed:0};
for(var vi2=0;
vi2<numDiv;
++vi2){var position=num.value*(vi2+1)/(vi+1);
var num2=this.getHandsomeNumber(position,position);
var major=((vi2+1)%this.subdivisions==0);
var last=((vi2+1)==numDiv);
if((this.singleLine&&last)||(!this.singleLine&&(major||this.showMinorMeasures))){compNum.score+=num2.score;
compNum.tie+=num2.tie;
compNum.dec=Math.max(compNum.dec,num2.dec);
compNum.displayed+=1
}else{compNum.score+=num2.score/this.subdivisions;
compNum.tie+=num2.tie/this.subdivisions
}}compNum.score*=(unitIndex+1)*compNum.tie/compNum.displayed;
comp[unitIndex][vi]=compNum
}}return comp
},setSubProps:function(comp){var system=this.measurementProperties[this.displaySystem];
var score=Number.POSITIVE_INFINITY;
var tie=Number.POSITIVE_INFINITY;
for(var unitIndex=0;
unitIndex<comp.length;
++unitIndex){var ppdu=OpenLayers.DOTS_PER_INCH*system.inches[unitIndex]/this.scale;
for(var vi in comp[unitIndex]){var compNum=comp[unitIndex][vi];
if((compNum.score<score)||((compNum.score==score)&&(compNum.tie<tie))){this.subProps={length:compNum.value,pixels:ppdu*compNum.value,units:system.units[unitIndex],abbr:system.abbr[unitIndex],dec:compNum.dec};
score=compNum.score;
tie=compNum.tie
}}}},styleValue:function(selector,key){var value=0;
if(this.limitedStyle){value=this.appliedStyles[selector][key]
}else{selector="."+this.displayClass+selector;
rules:for(var i=document.styleSheets.length-1;
i>=0;
--i){var sheet=document.styleSheets[i];
if(!sheet.disabled){var allRules;
try{if(typeof(sheet.cssRules)=="undefined"){if(typeof(sheet.rules)=="undefined"){continue
}else{allRules=sheet.rules
}}else{allRules=sheet.cssRules
}}catch(err){continue
}for(var ruleIndex=0;
ruleIndex<allRules.length;
++ruleIndex){var rule=allRules[ruleIndex];
if(rule.selectorText&&(rule.selectorText.toLowerCase()==selector.toLowerCase())){if(rule.style[key]!=""){value=parseInt(rule.style[key]);
break rules
}}}}}}return value?value:0
},getHandsomeNumber:function(small,big,sigFigs){sigFigs=(sigFigs==null)?10:sigFigs;
var num={value:small,score:Number.POSITIVE_INFINITY,tie:Number.POSITIVE_INFINITY,dec:3};
var cmult,max,dec,tmult,multiplier,score,tie;
for(var hexp=0;
hexp<3;
++hexp){cmult=Math.pow(2,(-1*hexp));
max=Math.floor(Math.log(big/cmult)/Math.LN10);
for(var texp=max;
texp>(max-sigFigs+1);
--texp){dec=Math.max(hexp-texp,0);
tmult=cmult*Math.pow(10,texp);
if((tmult*Math.floor(big/tmult))>=small){if(small%tmult==0){multiplier=small/tmult
}else{multiplier=Math.floor(small/tmult)+1
}score=multiplier+(2*hexp);
tie=(texp<0)?(Math.abs(texp)+1):texp;
if((score<num.score)||((score==num.score)&&(tie<num.tie))){num.value=parseFloat((tmult*multiplier).toFixed(dec));
num.score=score;
num.tie=tie;
num.dec=dec
}}}}return num
},CLASS_NAME:"OpenLayers.Control.ScaleBar"});
OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork=OpenLayers.Class(OpenLayers.Format.CSWGetRecords.v2_0_2,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows",geonet:"http://www.fao.org/geonetwork"},initialize:function(options){OpenLayers.Format.CSWGetRecords.v2_0_2.prototype.initialize.apply(this,[options])
},readers:{csw:{GetRecordsResponse:function(node,obj){obj.records=[];
this.readChildNodes(node,obj);
var version=this.getAttributeNS(node,"","version");
if(version!=""){obj.version=version
}},RequestId:function(node,obj){obj.RequestId=this.getChildValue(node)
},SearchStatus:function(node,obj){obj.SearchStatus={};
var timestamp=this.getAttributeNS(node,"","timestamp");
if(timestamp!=""){obj.SearchStatus.timestamp=timestamp
}},SearchResults:function(node,obj){this.readChildNodes(node,obj);
var attrs=node.attributes;
var SearchResults={};
for(var i=0,len=attrs.length;
i<len;
++i){if((attrs[i].name=="numberOfRecordsMatched")||(attrs[i].name=="numberOfRecordsReturned")||(attrs[i].name=="nextRecord")){SearchResults[attrs[i].name]=parseInt(attrs[i].nodeValue)
}else{SearchResults[attrs[i].name]=attrs[i].nodeValue
}}obj.SearchResults=SearchResults
},SummaryRecord:function(node,obj){var record={type:"SummaryRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},BriefRecord:function(node,obj){var record={type:"BriefRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},DCMIRecord:function(node,obj){var record={type:"DCMIRecord"};
this.readChildNodes(node,record);
obj.records.push(record)
},Record:function(node,obj){var record={type:"Record"};
this.readChildNodes(node,record);
obj.records.push(record)
},"*":function(node,obj){var info=node.localName;
if(!(obj.geonet_info[info] instanceof Array)){obj.geonet_info[info]=new Array()
}var value=this.getChildValue(node);
obj.geonet_info[info].push(value)
}},dc:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
if(!(obj[name] instanceof Array)){obj[name]=new Array()
}var dc_element={};
var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){dc_element[attrs[i].name]=attrs[i].nodeValue
}dc_element.value=this.getChildValue(node);
obj[name].push(dc_element)
}},dct:{"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
if(!(obj[name] instanceof Array)){obj[name]=new Array()
}obj[name].push(this.getChildValue(node))
}},geonet:{info:function(node,obj){if(!(obj.geonet_info instanceof Array)){obj.geonet_info=new Array()
}this.readChildNodes(node,obj)
}},ows:{WGS84BoundingBox:function(node,obj){if(!(obj.BoundingBox instanceof Array)){obj.BoundingBox=new Array()
}var lc=this.getChildValue(this.getElementsByTagNameNS(node,this.namespaces.ows,"LowerCorner")[0]).split(" ",2);
var uc=this.getChildValue(this.getElementsByTagNameNS(node,this.namespaces.ows,"UpperCorner")[0]).split(" ",2);
var boundingBox={value:[parseFloat(lc[0]),parseFloat(lc[1]),parseFloat(uc[0]),parseFloat(uc[1])]};
var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){boundingBox[attrs[i].name]=attrs[i].nodeValue
}obj.BoundingBox.push(boundingBox)
},BoundingBox:function(node,obj){this.readers.ows.WGS84BoundingBox.apply(this,[node,obj])
}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2_GeoNetwork"});
OpenLayers.Format.GeoNetworkRecords=OpenLayers.Class(OpenLayers.Format.XML,{defaultPrefix:"nons",namespaces:{nons:"",geonet:"http://www.fao.org/geonetwork"},initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}if(data&&data.nodeType==9){data=data.documentElement
}var obj={};
this.readNode(data,obj);
return obj
},readers:{nons:{response:function(node,obj){obj.records=[];
this.readChildNodes(node,obj);
var from=this.getAttributeNS(node,"","from");
if(from!=""){obj.from=from
}var to=this.getAttributeNS(node,"","to");
if(to!=""){obj.to=to
}},summary:function(node,obj){obj.summary={};
var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){obj.summary[attrs[i].name]=attrs[i].nodeValue
}this.readChildNodes(node,obj.summary)
},metadata:function(node,obj){var record={type:"metadata"};
this.readChildNodes(node,record);
obj.records.push(record)
},geoBox:function(node,obj){if(!(obj.BoundingBox instanceof Array)){obj.BoundingBox=new Array()
}var s,w,e,n;
if(node.firstChild.nodeValue&&node.firstChild.nodeValue.indexOf("|")){var coords=node.firstChild.nodeValue.split("|");
w=coords[0];
s=coords[1];
e=coords[2];
n=coords[3]
}else{for(var child=node.firstChild;
child;
child=child.nextSibling){switch(child.nodeName){case"southBL":s=this.getChildValue(child);
break;
case"westBL":w=this.getChildValue(child);
break;
case"eastBL":e=this.getChildValue(child);
break;
case"northBL":n=this.getChildValue(child);
break
}}}var boundingBox={value:[parseFloat(w),parseFloat(s),parseFloat(e),parseFloat(n)]};
obj.BoundingBox.push(boundingBox)
},"*":function(node,obj){var name=node.localName||node.nodeName.split(":").pop();
var parentName=node.parentNode.localName||node.parentNode.nodeName.split(":").pop();
var value={};
value.value=this.getChildValue(node);
if(parentName=="info"){if(!(obj.geonet_info[name] instanceof Array)){obj.geonet_info[name]=new Array()
}obj.geonet_info[name].push(value);
if(name=="harvestInfo"||name=="valid_details"){this.readChildNodes(node,obj.geonet_info[name])
}}else{if(!(obj[name] instanceof Array)){obj[name]=new Array()
}var attrs=node.attributes;
for(var i=0,len=attrs.length;
i<len;
++i){value[attrs[i].name]=attrs[i].nodeValue
}obj[name].push(value);
this.readChildNodes(node,obj[name])
}}},geonet:{info:function(node,obj){if(!(obj.geonet_info instanceof Array)){obj.geonet_info=new Array()
}this.readChildNodes(node,obj)
}}},CLASS_NAME:"OpenLayers.Format.GeoNetworkRecords"});
(function(){var createComplete=function(fn,cb){return function(request){if(cb&&cb[fn]){cb[fn].call(cb.scope||window,{responseText:request.responseText,responseXML:request.responseXML,argument:cb.argument})
}}
};
Ext.apply(Ext.lib.Ajax,{request:function(method,uri,cb,data,options){options=options||{};
method=method||options.method;
var hs=options.headers;
if(options.xmlData){if(!hs||!hs["Content-Type"]){hs=hs||{};
hs["Content-Type"]="text/xml"
}method=method||"POST";
data=options.xmlData
}else{if(options.jsonData){if(!hs||!hs["Content-Type"]){hs=hs||{};
hs["Content-Type"]="application/json"
}method=method||"POST";
data=typeof options.jsonData=="object"?Ext.encode(options.jsonData):options.jsonData
}}if((method&&method.toLowerCase()=="post")&&(options.form||options.params)&&(!hs||!hs["Content-Type"])){hs=hs||{};
hs["Content-Type"]="application/x-www-form-urlencoded"
}return OpenLayers.Request.issue({success:createComplete("success",cb),failure:createComplete("failure",cb),method:method,headers:hs,data:data,url:uri})
},isCallInProgress:function(request){return true
},abort:function(request){request.abort()
}})
})();
Ext.namespace("GeoExt");
GeoExt.singleFile=true;
(function(){var singleFile=(typeof GeoExt=="object"&&GeoExt.singleFile);
var scriptName=singleFile?"GeoExt.js":"lib/GeoExt.js";
var getScriptLocation=function(){var scriptLocation="";
var scripts=document.documentElement.getElementsByTagName("script");
for(var i=0,len=scripts.length;
i<len;
i++){var src=scripts[i].getAttribute("src");
if(src){var index=src.lastIndexOf(scriptName);
var pathLength=src.lastIndexOf("?");
if(pathLength<0){pathLength=src.length
}if((index>-1)&&(index+scriptName.length==pathLength)){scriptLocation=src.slice(0,pathLength-scriptName.length);
break
}}}return scriptLocation
};
if(!singleFile){var jsfiles=new Array("GeoExt/data/AttributeReader.js","GeoExt/data/AttributeStore.js","GeoExt/data/FeatureRecord.js","GeoExt/data/FeatureReader.js","GeoExt/data/FeatureStore.js","GeoExt/data/LayerRecord.js","GeoExt/data/LayerReader.js","GeoExt/data/LayerStore.js","GeoExt/data/ScaleStore.js","GeoExt/data/WMSCapabilitiesReader.js","GeoExt/data/WMSCapabilitiesStore.js","GeoExt/data/WFSCapabilitiesReader.js","GeoExt/data/WFSCapabilitiesStore.js","GeoExt/data/WMSDescribeLayerReader.js","GeoExt/data/WMSDescribeLayerStore.js","GeoExt/data/WMCReader.js","GeoExt/widgets/Action.js","GeoExt/data/ProtocolProxy.js","GeoExt/widgets/FeatureRenderer.js","GeoExt/widgets/MapPanel.js","GeoExt/widgets/Popup.js","GeoExt/widgets/form.js","GeoExt/widgets/form/SearchAction.js","GeoExt/widgets/form/BasicForm.js","GeoExt/widgets/form/FormPanel.js","GeoExt/widgets/tips/SliderTip.js","GeoExt/widgets/tips/LayerOpacitySliderTip.js","GeoExt/widgets/tips/ZoomSliderTip.js","GeoExt/widgets/tree/LayerNode.js","GeoExt/widgets/tree/TreeNodeUIEventMixin.js","GeoExt/plugins/TreeNodeComponent.js","GeoExt/plugins/TreeNodeRadioButton.js","GeoExt/widgets/tree/LayerLoader.js","GeoExt/widgets/tree/LayerContainer.js","GeoExt/widgets/tree/BaseLayerContainer.js","GeoExt/widgets/tree/OverlayLayerContainer.js","GeoExt/widgets/tree/LayerParamNode.js","GeoExt/widgets/tree/LayerParamLoader.js","GeoExt/widgets/tree/WMSCapabilitiesLoader.js","GeoExt/widgets/LayerOpacitySlider.js","GeoExt/widgets/LayerLegend.js","GeoExt/widgets/LegendImage.js","GeoExt/widgets/UrlLegend.js","GeoExt/widgets/WMSLegend.js","GeoExt/widgets/VectorLegend.js","GeoExt/widgets/LegendPanel.js","GeoExt/widgets/ZoomSlider.js","GeoExt/widgets/grid/FeatureSelectionModel.js","GeoExt/data/PrintPage.js","GeoExt/data/PrintProvider.js","GeoExt/plugins/PrintPageField.js","GeoExt/plugins/PrintProviderField.js","GeoExt/plugins/PrintExtent.js","GeoExt/plugins/AttributeForm.js","GeoExt/widgets/PrintMapPanel.js","GeoExt/state/PermalinkProvider.js");
var allScriptTags=new Array(jsfiles.length);
var host=getScriptLocation()+"lib/";
for(var i=0,len=jsfiles.length;
i<len;
i++){allScriptTags[i]="<script src='"+host+jsfiles[i]+"'><\/script>"
}document.write(allScriptTags.join(""))
}})();
Ext.namespace("GeoExt.data");
GeoExt.data.AttributeReader=function(meta,recordType){meta=meta||{};
if(!meta.format){meta.format=new OpenLayers.Format.WFSDescribeFeatureType()
}GeoExt.data.AttributeReader.superclass.constructor.call(this,meta,recordType||meta.fields);
if(meta.feature){this.recordType.prototype.fields.add(new Ext.data.Field("value"))
}};
Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(request){var data=request.responseXML;
if(!data||!data.documentElement){data=request.responseText
}return this.readRecords(data)
},readRecords:function(data){var attributes;
if(data instanceof Array){attributes=data
}else{attributes=this.meta.format.read(data).featureTypes[0].properties
}var feature=this.meta.feature;
var recordType=this.recordType;
var fields=recordType.prototype.fields;
var numFields=fields.length;
var attr,values,name,record,ignore,value,records=[];
for(var i=0,len=attributes.length;
i<len;
++i){ignore=false;
attr=attributes[i];
values={};
for(var j=0;
j<numFields;
++j){name=fields.items[j].name;
value=attr[name];
if(this.ignoreAttribute(name,value)){ignore=true;
break
}values[name]=value
}if(feature){value=feature.attributes[values.name];
if(value!==undefined){if(this.ignoreAttribute("value",value)){ignore=true
}else{values.value=value
}}}if(!ignore){records[records.length]=new recordType(values)
}}return{success:true,records:records,totalRecords:records.length}
},ignoreAttribute:function(name,value){var ignore=false;
if(this.meta.ignore&&this.meta.ignore[name]){var matches=this.meta.ignore[name];
if(typeof matches=="string"){ignore=(matches===value)
}else{if(matches instanceof Array){ignore=(matches.indexOf(value)>-1)
}else{if(matches instanceof RegExp){ignore=(matches.test(value))
}}}}return ignore
}});
Ext.namespace("GeoExt.data");
GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(c){c=c||{};
arguments.callee.superclass.constructor.call(this,Ext.apply(c,{proxy:c.proxy||(!c.data?new Ext.data.HttpProxy({url:c.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.AttributeReader(c,c.fields||["name","type","restriction"])}));
if(this.feature){this.bind()
}},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});
var records=[];
this.each(function(record){records.push(record)
});
this.updateFeature(records)
},onUpdate:function(store,record,operation){this.updateFeature([record])
},onLoad:function(store,records,options){if(!options||options.add!==true){this.updateFeature(records)
}},onAdd:function(store,records,index){this.updateFeature(records)
},updateFeature:function(records){var feature=this.feature,layer=feature.layer;
var i,len,record,name,value,oldValue,dirty;
for(i=0,len=records.length;
i<len;
i++){record=records[i];
name=record.get("name");
value=record.get("value");
oldValue=feature.attributes[name];
if(oldValue!==value){dirty=true
}}if(dirty&&layer&&layer.events&&layer.events.triggerEvent("beforefeaturemodified",{feature:feature})!==false){for(i=0,len=records.length;
i<len;
i++){record=records[i];
name=record.get("name");
value=record.get("value");
feature.attributes[name]=value
}layer.events.triggerEvent("featuremodified",{feature:feature});
layer.drawFeature(feature)
}}}
};
GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin());
Ext.namespace("GeoExt","GeoExt.data");
GeoExt.data.FeatureReader=function(meta,recordType){meta=meta||{};
if(!(recordType instanceof Function)){recordType=GeoExt.data.FeatureRecord.create(recordType||meta.fields||{})
}GeoExt.data.FeatureReader.superclass.constructor.call(this,meta,recordType)
};
Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(response){return this.readRecords(response.features)
},readRecords:function(features){var records=[];
if(features){var recordType=this.recordType,fields=recordType.prototype.fields;
var i,lenI,j,lenJ,feature,values,field,v;
for(i=0,lenI=features.length;
i<lenI;
i++){feature=features[i];
values={};
if(feature.attributes){for(j=0,lenJ=fields.length;
j<lenJ;
j++){field=fields.items[j];
if(/[\[\.]/.test(field.mapping)){try{v=new Function("obj","return obj."+field.mapping)(feature.attributes)
}catch(e){v=field.defaultValue
}}else{v=feature.attributes[field.mapping||field.name]||field.defaultValue
}if(field.convert){v=field.convert(v)
}values[field.name]=v
}}values.feature=feature;
values.state=feature.state;
values.fid=feature.fid;
var id=(feature.state===OpenLayers.State.INSERT)?undefined:feature.id;
records[records.length]=new recordType(values,id)
}}return{records:records,totalRecords:this.totalRecords!=null?this.totalRecords:records.length}
}});
Ext.namespace("GeoExt.data");
GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(config){config=config||{};
config.reader=config.reader||new GeoExt.data.FeatureReader({},config.fields);
var layer=config.layer;
delete config.layer;
if(config.features){config.data=config.features
}delete config.features;
var options={initDir:config.initDir};
delete config.initDir;
arguments.callee.superclass.constructor.call(this,config);
if(layer){this.bind(layer,options)
}},bind:function(layer,options){if(this.layer){return
}this.layer=layer;
options=options||{};
var initDir=options.initDir;
if(options.initDir==undefined){initDir=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER
}var features=layer.features.slice(0);
if(initDir&GeoExt.data.FeatureStore.STORE_TO_LAYER){var records=this.getRange();
for(var i=records.length-1;
i>=0;
i--){this.layer.addFeatures([records[i].getFeature()])
}}if(initDir&GeoExt.data.FeatureStore.LAYER_TO_STORE){this.loadData(features,true)
}layer.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});
this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this})
},unbind:function(){if(this.layer){this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this});
this.un("load",this.onLoad,this);
this.un("clear",this.onClear,this);
this.un("add",this.onAdd,this);
this.un("remove",this.onRemove,this);
this.un("update",this.onUpdate,this);
this.layer=null
}},getRecordFromFeature:function(feature){var record=null;
if(feature.state!==OpenLayers.State.INSERT){record=this.getById(feature.id)
}else{var index=this.findBy(function(r){return r.getFeature()===feature
});
if(index>-1){record=this.getAt(index)
}}return record
},onFeaturesAdded:function(evt){if(!this._adding){var features=evt.features,toAdd=features;
if(this.featureFilter){toAdd=[];
var i,len,feature;
for(var i=0,len=features.length;
i<len;
i++){feature=features[i];
if(this.featureFilter.evaluate(feature)!==false){toAdd.push(feature)
}}}this._adding=true;
this.loadData(toAdd,true);
delete this._adding
}},onFeaturesRemoved:function(evt){if(!this._removing){var features=evt.features,feature,record,i;
for(i=features.length-1;
i>=0;
i--){feature=features[i];
record=this.getRecordFromFeature(feature);
if(record!==undefined){this._removing=true;
this.remove(record);
delete this._removing
}}}},onFeatureModified:function(evt){if(!this._updating){var feature=evt.feature;
var record=this.getRecordFromFeature(feature);
if(record!==undefined){record.beginEdit();
var attributes=feature.attributes;
if(attributes){var fields=this.recordType.prototype.fields;
for(var i=0,len=fields.length;
i<len;
i++){var field=fields.items[i];
var key=field.mapping||field.name;
if(key in attributes){record.set(field.name,field.convert(attributes[key]))
}}}record.set("state",feature.state);
record.set("fid",feature.fid);
record.setFeature(feature);
this._updating=true;
record.endEdit();
delete this._updating
}}},addFeaturesToLayer:function(records){var i,len,features;
features=new Array((len=records.length));
for(i=0;
i<len;
i++){features[i]=records[i].getFeature()
}if(features.length>0){this._adding=true;
this.layer.addFeatures(features);
delete this._adding
}},onLoad:function(store,records,options){if(!options||options.add!==true){this._removing=true;
this.layer.removeFeatures(this.layer.features);
delete this._removing;
this.addFeaturesToLayer(records)
}},onClear:function(store){this._removing=true;
this.layer.removeFeatures(this.layer.features);
delete this._removing
},onAdd:function(store,records,index){if(!this._adding){this.addFeaturesToLayer(records)
}},onRemove:function(store,record,index){if(!this._removing){var feature=record.getFeature();
if(this.layer.getFeatureById(feature.id)!=null){this._removing=true;
this.layer.removeFeatures([record.getFeature()]);
delete this._removing
}}},onUpdate:function(store,record,operation){if(!this._updating){var defaultFields=new GeoExt.data.FeatureRecord().fields;
var feature=record.getFeature();
if(record.fields){var cont=this.layer.events.triggerEvent("beforefeaturemodified",{feature:feature});
if(cont!==false){var attributes=feature.attributes;
record.fields.each(function(field){var key=field.mapping||field.name;
if(!defaultFields.containsKey(key)){attributes[key]=record.get(field.name)
}});
this._updating=true;
this.layer.events.triggerEvent("featuremodified",{feature:feature});
delete this._updating;
if(this.layer.getFeatureById(feature.id)!=null){this.layer.drawFeature(feature)
}}}}}}
};
GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin);
GeoExt.data.FeatureStore.LAYER_TO_STORE=1;
GeoExt.data.FeatureStore.STORE_TO_LAYER=2;
Ext.namespace("GeoExt.data");
GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]);
GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer")
};
GeoExt.data.LayerRecord.prototype.setLayer=function(layer){if(layer!==this.data.layer){this.dirty=true;
if(!this.modified){this.modified={}
}if(this.modified.layer===undefined){this.modified.layer=this.data.layer
}this.data.layer=layer;
if(!this.editing){this.afterEdit()
}}};
GeoExt.data.LayerRecord.prototype.clone=function(id){var layer=this.getLayer()&&this.getLayer().clone();
return new this.constructor(Ext.applyIf({layer:layer},this.data),id||layer.id)
};
GeoExt.data.LayerRecord.create=function(o){var f=Ext.extend(GeoExt.data.LayerRecord,{});
var p=f.prototype;
p.fields=new Ext.util.MixedCollection(false,function(field){return field.name
});
GeoExt.data.LayerRecord.prototype.fields.each(function(f){p.fields.add(f)
});
if(o){for(var i=0,len=o.length;
i<len;
i++){p.fields.add(new Ext.data.Field(o[i]))
}}f.getField=function(name){return p.fields.get(name)
};
return f
};
Ext.namespace("GeoExt","GeoExt.data");
GeoExt.data.LayerReader=function(meta,recordType){meta=meta||{};
if(!(recordType instanceof Function)){recordType=GeoExt.data.LayerRecord.create(recordType||meta.fields||{})
}GeoExt.data.LayerReader.superclass.constructor.call(this,meta,recordType)
};
Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(layers){var records=[];
if(layers){var recordType=this.recordType,fields=recordType.prototype.fields;
var i,lenI,j,lenJ,layer,values,field,v;
for(i=0,lenI=layers.length;
i<lenI;
i++){layer=layers[i];
values={};
for(j=0,lenJ=fields.length;
j<lenJ;
j++){field=fields.items[j];
v=layer[field.mapping||field.name]||field.defaultValue;
v=field.convert(v);
values[field.name]=v
}values.layer=layer;
records[records.length]=new recordType(values,layer.id)
}}return{records:records,totalRecords:this.totalRecords!=null?this.totalRecords:records.length}
}});
Ext.namespace("GeoExt.data");
GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(config){config=config||{};
config.reader=config.reader||new GeoExt.data.LayerReader({},config.fields);
delete config.fields;
var map=config.map instanceof GeoExt.MapPanel?config.map.map:config.map;
delete config.map;
if(config.layers){config.data=config.layers
}delete config.layers;
var options={initDir:config.initDir};
delete config.initDir;
arguments.callee.superclass.constructor.call(this,config);
if(map){this.bind(map,options)
}},bind:function(map,options){if(this.map){return
}this.map=map;
options=options||{};
var initDir=options.initDir;
if(options.initDir==undefined){initDir=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP
}var layers=map.layers.slice(0);
if(initDir&GeoExt.data.LayerStore.STORE_TO_MAP){this.each(function(record){this.map.addLayer(record.getLayer())
},this)
}if(initDir&GeoExt.data.LayerStore.MAP_TO_STORE){this.loadData(layers,true)
}map.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});
this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this});
this.data.on({replace:this.onReplace,scope:this})
},unbind:function(){if(this.map){this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this});
this.un("load",this.onLoad,this);
this.un("clear",this.onClear,this);
this.un("add",this.onAdd,this);
this.un("remove",this.onRemove,this);
this.data.un("replace",this.onReplace,this);
this.map=null
}},onChangeLayer:function(evt){var layer=evt.layer;
var recordIndex=this.findBy(function(rec,id){return rec.getLayer()===layer
});
if(recordIndex>-1){var record=this.getAt(recordIndex);
if(evt.property==="order"){if(!this._adding&&!this._removing){var layerIndex=this.map.getLayerIndex(layer);
if(layerIndex!==recordIndex){this._removing=true;
this.remove(record);
delete this._removing;
this._adding=true;
this.insert(layerIndex,[record]);
delete this._adding
}}}else{if(evt.property==="name"){record.set("title",layer.name)
}else{this.fireEvent("update",this,record,Ext.data.Record.EDIT)
}}}},onAddLayer:function(evt){if(!this._adding){var layer=evt.layer;
this._adding=true;
this.loadData([layer],true);
delete this._adding
}},onRemoveLayer:function(evt){if(this.map.unloadDestroy){if(!this._removing){var layer=evt.layer;
this._removing=true;
this.remove(this.getById(layer.id));
delete this._removing
}}else{this.unbind()
}},onLoad:function(store,records,options){if(!Ext.isArray(records)){records=[records]
}if(options&&!options.add){this._removing=true;
for(var i=this.map.layers.length-1;
i>=0;
i--){this.map.removeLayer(this.map.layers[i])
}delete this._removing;
var len=records.length;
if(len>0){var layers=new Array(len);
for(var j=0;
j<len;
j++){layers[j]=records[j].getLayer()
}this._adding=true;
this.map.addLayers(layers);
delete this._adding
}}},onClear:function(store){this._removing=true;
for(var i=this.map.layers.length-1;
i>=0;
i--){this.map.removeLayer(this.map.layers[i])
}delete this._removing
},onAdd:function(store,records,index){if(!this._adding){this._adding=true;
var layer;
for(var i=records.length-1;
i>=0;
--i){layer=records[i].getLayer();
this.map.addLayer(layer);
if(index!==this.map.layers.length-1){this.map.setLayerIndex(layer,index)
}}delete this._adding
}},onRemove:function(store,record,index){if(!this._removing){var layer=record.getLayer();
if(this.map.getLayer(layer.id)!=null){this._removing=true;
this.removeMapLayer(record);
delete this._removing
}}},onUpdate:function(store,record,operation){if(operation===Ext.data.Record.EDIT){if(record.modified&&record.modified.title){var layer=record.getLayer();
var title=record.get("title");
if(title!==layer.name){layer.setName(title)
}}}},removeMapLayer:function(record){this.map.removeLayer(record.getLayer())
},onReplace:function(key,oldRecord,newRecord){this.removeMapLayer(oldRecord)
},getByLayer:function(layer){var index=this.findBy(function(r){return r.getLayer()===layer
});
if(index>-1){return this.getAt(index)
}},destroy:function(){this.unbind();
GeoExt.data.LayerStore.superclass.destroy.call(this)
}}
};
GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin);
GeoExt.data.LayerStore.MAP_TO_STORE=1;
GeoExt.data.LayerStore.STORE_TO_MAP=2;
Ext.namespace("GeoExt.data");
GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(config){var map=(config.map instanceof GeoExt.MapPanel?config.map.map:config.map);
delete config.map;
config=Ext.applyIf(config,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])});
GeoExt.data.ScaleStore.superclass.constructor.call(this,config);
if(map){this.bind(map)
}},bind:function(map,options){this.map=(map instanceof GeoExt.MapPanel?map.map:map);
this.map.events.register("changebaselayer",this,this.populateFromMap);
if(this.map.baseLayer){this.populateFromMap()
}else{this.map.events.register("addlayer",this,this.populateOnAdd)
}},unbind:function(){if(this.map){this.map.events.unregister("addlayer",this,this.populateOnAdd);
this.map.events.unregister("changebaselayer",this,this.populateFromMap);
delete this.map
}},populateOnAdd:function(evt){if(evt.layer.isBaseLayer){this.populateFromMap();
this.map.events.unregister("addlayer",this,this.populateOnAdd)
}},populateFromMap:function(){var zooms=[];
var resolutions=this.map.baseLayer.resolutions;
var units=this.map.baseLayer.units;
for(var i=resolutions.length-1;
i>=0;
i--){var res=resolutions[i];
zooms.push({level:i,resolution:res,scale:OpenLayers.Util.getScaleFromResolution(res,units)})
}this.loadData(zooms)
},destroy:function(){this.unbind();
GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments)
}});
Ext.namespace("GeoExt.data");
GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,constructor:function(config){this.initialConfig=config;
Ext.apply(this,config);
if(!this.customParams){this.customParams={}
}this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer");
GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments);
this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]});
this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]});
this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]});
if(config.capabilities){this.loadStores()
}else{if(this.url.split("/").pop()){this.url+="/"
}this.initialConfig.autoLoad&&this.loadCapabilities()
}},setLayout:function(layout){this.layout=layout;
this.fireEvent("layoutchange",this,layout)
},setDpi:function(dpi){this.dpi=dpi;
this.fireEvent("dpichange",this,dpi)
},print:function(map,pages,options){if(map instanceof GeoExt.MapPanel){map=map.map
}pages=pages instanceof Array?pages:[pages];
options=options||{};
if(this.fireEvent("beforeprint",this,map,pages,options)===false){return
}var jsonData=Ext.apply({units:map.getUnits(),srs:map.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams);
var pagesLayer=pages[0].feature.layer;
var encodedLayers=[];
Ext.each(map.layers,function(layer){if(layer!==pagesLayer&&layer.getVisibility()===true){var enc=this.encodeLayer(layer);
enc&&encodedLayers.push(enc)
}},this);
jsonData.layers=encodedLayers;
var encodedPages=[];
Ext.each(pages,function(page){encodedPages.push(Ext.apply({center:[page.center.lon,page.center.lat],scale:page.scale.get("value"),rotation:page.rotation},page.customParams))
},this);
jsonData.pages=encodedPages;
if(options.overview){var encodedOverviewLayers=[];
Ext.each(options.overview.layers,function(layer){var enc=this.encodeLayer(layer);
enc&&encodedOverviewLayers.push(enc)
},this);
jsonData.overviewLayers=encodedOverviewLayers
}if(options.legend){var legend=options.legend;
var rendered=legend.rendered;
if(!rendered){legend=legend.cloneConfig({renderTo:document.body,hidden:true})
}var encodedLegends=[];
legend.items.each(function(cmp){if(!cmp.hidden){var encFn=this.encoders.legends[cmp.getXType()];
encodedLegends=encodedLegends.concat(encFn.call(this,cmp))
}},this);
if(!rendered){legend.destroy()
}jsonData.legends=encodedLegends
}if(this.method==="GET"){var url=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(jsonData)));
window.open(url);
this.fireEvent("print",this,url)
}else{Ext.Ajax.request({url:this.capabilities.createURL,jsonData:jsonData,success:function(response){var url=Ext.decode(response.responseText).getURL+(Ext.isIE?"?inline=true":"");
if(Ext.isOpera||Ext.isIE){window.open(url)
}else{window.location.href=url
}this.fireEvent("print",this,url)
},failure:function(response){this.fireEvent("printexception",this,response)
},params:this.initialConfig.baseParams,scope:this})
}},loadCapabilities:function(){if(!this.url){return
}var url=this.url+"info.json";
Ext.Ajax.request({url:url,method:"GET",disableCaching:false,success:function(response){this.capabilities=Ext.decode(response.responseText);
this.loadStores()
},params:this.initialConfig.baseParams,scope:this})
},loadStores:function(){this.scales.loadData(this.capabilities);
this.dpis.loadData(this.capabilities);
this.layouts.loadData(this.capabilities);
this.setLayout(this.layouts.getAt(0));
this.setDpi(this.dpis.getAt(0));
this.fireEvent("loadcapabilities",this,this.capabilities)
},encodeLayer:function(layer){var encLayer;
for(var c in this.encoders.layers){if(OpenLayers.Layer[c]&&layer instanceof OpenLayers.Layer[c]){if(this.fireEvent("beforeencodelayer",this,layer)===false){return
}encLayer=this.encoders.layers[c].call(this,layer);
this.fireEvent("encodelayer",this,layer,encLayer);
break
}}return(encLayer&&encLayer.type)?encLayer:null
},getAbsoluteUrl:function(url){var a;
a=document.createElement("a");
a.href=url;
return a.href
},encoders:{layers:{WMS:function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);
Ext.apply(enc,{type:"WMS",layers:[layer.params.LAYERS].join(",").split(","),format:layer.params.FORMAT,styles:[layer.params.STYLES].join(",").split(",")});
var param;
for(var p in layer.params){param=p.toLowerCase();
if(!layer.DEFAULT_PARAMS[param]&&"layers,styles,width,height,srs".indexOf(param)==-1){if(!enc.customParams){enc.customParams={}
}enc.customParams[p]=layer.params[p]
}}return enc
},OSM:function(layer){var enc=this.encoders.layers.TileCache.call(this,layer);
return Ext.apply(enc,{type:"OSM",baseURL:enc.baseURL.substr(0,enc.baseURL.indexOf("$")),extension:"png"})
},TMS:function(layer){var enc=this.encoders.layers.TileCache.call(this,layer);
return Ext.apply(enc,{type:"TMS",format:layer.type})
},TileCache:function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);
return Ext.apply(enc,{type:"TileCache",layer:layer.layername,maxExtent:layer.maxExtent.toArray(),tileSize:[layer.tileSize.w,layer.tileSize.h],extension:layer.extension,resolutions:layer.serverResolutions||layer.resolutions})
},KaMapCache:function(layer){var enc=this.encoders.layers.KaMap.call(this,layer);
return Ext.apply(enc,{type:"KaMapCache",group:layer.params.g,metaTileWidth:layer.params.metaTileSize.w,metaTileHeight:layer.params.metaTileSize.h})
},KaMap:function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);
return Ext.apply(enc,{type:"KaMap",map:layer.params.map,extension:layer.params.i,group:layer.params.g||"",maxExtent:layer.maxExtent.toArray(),tileSize:[layer.tileSize.w,layer.tileSize.h],resolutions:layer.serverResolutions||layer.resolutions})
},HTTPRequest:function(layer){return{baseURL:this.getAbsoluteUrl(layer.url instanceof Array?layer.url[0]:layer.url),opacity:(layer.opacity!=null)?layer.opacity:1,singleTile:layer.singleTile}
},Image:function(layer){return{type:"Image",baseURL:this.getAbsoluteUrl(layer.getURL(layer.extent)),opacity:(layer.opacity!=null)?layer.opacity:1,extent:layer.extent.toArray(),pixelSize:[layer.size.w,layer.size.h],name:layer.name}
},Vector:function(layer){if(!layer.features.length){return
}var encFeatures=[];
var encStyles={};
var features=layer.features;
var featureFormat=new OpenLayers.Format.GeoJSON();
var styleFormat=new OpenLayers.Format.JSON();
var nextId=1;
var styleDict={};
var feature,style,dictKey,dictItem,styleName;
for(var i=0,len=features.length;
i<len;
++i){feature=features[i];
style=feature.style||layer.style||layer.styleMap.createSymbolizer(feature,feature.renderIntent);
dictKey=styleFormat.write(style);
dictItem=styleDict[dictKey];
if(dictItem){styleName=dictItem
}else{styleDict[dictKey]=styleName=nextId++;
if(style.externalGraphic){encStyles[styleName]=Ext.applyIf({externalGraphic:this.getAbsoluteUrl(style.externalGraphic)},style)
}else{encStyles[styleName]=style
}}var featureGeoJson=featureFormat.extract.feature.call(featureFormat,feature);
featureGeoJson.properties=OpenLayers.Util.extend({_gx_style:styleName},featureGeoJson.properties);
encFeatures.push(featureGeoJson)
}return{type:"Vector",styles:encStyles,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:encFeatures},name:layer.name,opacity:(layer.opacity!=null)?layer.opacity:1}
}},legends:{gx_wmslegend:function(legend){var enc=this.encoders.legends.base.call(this,legend);
var icons=[];
for(var i=1,len=legend.items.getCount();
i<len;
++i){icons.push(this.getAbsoluteUrl(legend.items.get(i).url))
}enc[0].classes[0]={name:"",icons:icons};
return enc
},gx_urllegend:function(legend){var enc=this.encoders.legends.base.call(this,legend);
enc[0].classes.push({name:"",icon:this.getAbsoluteUrl(legend.items.get(1).url)});
return enc
},base:function(legend){return[{name:legend.items.get(0).text,classes:[]}]
}}}});
Ext.namespace("GeoExt.data");
GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(config){this.initialConfig=config;
Ext.apply(this,config);
if(!this.customParams){this.customParams={}
}this.addEvents("change");
GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments);
this.feature=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POLYGON((-1 -1,1 -1,1 1,-1 1,-1 -1))"));
if(this.printProvider.capabilities){this.setScale(this.printProvider.scales.getAt(0))
}else{this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0))
},scope:this,single:true})
}this.printProvider.on({layoutchange:this.onLayoutChange,scope:this})
},getPrintExtent:function(map){map=map instanceof GeoExt.MapPanel?map.map:map;
return this.calculatePageBounds(this.scale,map.getUnits())
},setScale:function(scale,units){var bounds=this.calculatePageBounds(scale,units);
var geom=bounds.toGeometry();
var rotation=this.rotation;
if(rotation!=0){geom.rotate(-rotation,geom.getCentroid())
}this.updateFeature(geom,{scale:scale})
},setCenter:function(center){var geom=this.feature.geometry;
var oldCenter=geom.getBounds().getCenterLonLat();
var dx=center.lon-oldCenter.lon;
var dy=center.lat-oldCenter.lat;
geom.move(dx,dy);
this.updateFeature(geom,{center:center})
},setRotation:function(rotation,force){if(force||this.printProvider.layout.get("rotation")===true){var geom=this.feature.geometry;
geom.rotate(this.rotation-rotation,geom.getCentroid());
this.updateFeature(geom,{rotation:rotation})
}},fit:function(fitTo,options){options=options||{};
var map=fitTo,extent;
if(fitTo instanceof GeoExt.MapPanel){map=fitTo.map
}else{if(fitTo instanceof OpenLayers.Feature.Vector){map=fitTo.layer.map;
extent=fitTo.geometry.getBounds()
}}if(!extent){extent=map.getExtent();
if(!extent){return
}}this._updating=true;
var center=extent.getCenterLonLat();
this.setCenter(center);
var units=map.getUnits();
var scale=this.printProvider.scales.getAt(0);
var closest=Number.POSITIVE_INFINITY;
var mapWidth=extent.getWidth();
var mapHeight=extent.getHeight();
this.printProvider.scales.each(function(rec){var bounds=this.calculatePageBounds(rec,units);
if(options.mode=="closest"){var diff=Math.abs(bounds.getWidth()-mapWidth)+Math.abs(bounds.getHeight()-mapHeight);
if(diff<closest){closest=diff;
scale=rec
}}else{var contains=options.mode=="screen"?!extent.containsBounds(bounds):bounds.containsBounds(extent);
if(contains||(options.mode=="screen"&&!contains)){scale=rec
}return contains
}},this);
this.setScale(scale,units);
delete this._updating;
this.updateFeature(this.feature.geometry,{center:center,scale:scale})
},updateFeature:function(geometry,mods){var f=this.feature;
var modified=f.geometry!==geometry;
geometry.id=f.geometry.id;
f.geometry=geometry;
if(!this._updating){for(var property in mods){if(mods[property]===this[property]){delete mods[property]
}else{this[property]=mods[property];
modified=true
}}Ext.apply(this,mods);
f.layer&&f.layer.drawFeature(f);
modified&&this.fireEvent("change",this,mods)
}},calculatePageBounds:function(scale,units){var s=scale?scale.get("value"):0;
var f=this.feature;
var geom=this.feature.geometry;
var center=geom.getBounds().getCenterLonLat();
var size=this.printProvider.layout.get("size");
var units=units||(f.layer&&f.layer.map&&f.layer.map.getUnits())||"dd";
var unitsRatio=OpenLayers.INCHES_PER_UNIT[units];
var w=size.width/72/unitsRatio*s/2;
var h=size.height/72/unitsRatio*s/2;
return new OpenLayers.Bounds(center.lon-w,center.lat-h,center.lon+w,center.lat+h)
},onLayoutChange:function(){if(this.printProvider.layout.get("rotation")===false){this.setRotation(0,true)
}this.scale&&this.setScale(this.scale)
},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this)
}});
Ext.namespace("GeoExt.data");
GeoExt.data.WMSCapabilitiesReader=function(meta,recordType){meta=meta||{};
if(!meta.format){meta.format=new OpenLayers.Format.WMSCapabilities()
}if(typeof recordType!=="function"){recordType=GeoExt.data.LayerRecord.create(recordType||meta.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"}])
}GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,meta,recordType)
};
Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(request){var data=request.responseXML;
if(!data||!data.documentElement){data=request.responseText
}return this.readRecords(data)
},serviceExceptionFormat:function(formats){if(OpenLayers.Util.indexOf(formats,"application/vnd.ogc.se_inimage")>-1){return"application/vnd.ogc.se_inimage"
}if(OpenLayers.Util.indexOf(formats,"application/vnd.ogc.se_xml")>-1){return"application/vnd.ogc.se_xml"
}return formats[0]
},imageFormat:function(layer){var formats=layer.formats;
if(layer.opaque&&OpenLayers.Util.indexOf(formats,"image/jpeg")>-1){return"image/jpeg"
}if(OpenLayers.Util.indexOf(formats,"image/png")>-1){return"image/png"
}if(OpenLayers.Util.indexOf(formats,"image/png; mode=24bit")>-1){return"image/png; mode=24bit"
}if(OpenLayers.Util.indexOf(formats,"image/gif")>-1){return"image/gif"
}return formats[0]
},imageTransparent:function(layer){return layer.opaque==undefined||!layer.opaque
},readRecords:function(data){if(typeof data==="string"||data.nodeType){data=this.meta.format.read(data)
}var version=data.version;
var capability=data.capability||{};
var url=capability.request&&capability.request.getmap&&capability.request.getmap.href;
var layers=capability.layers;
var formats=capability.exception?capability.exception.formats:[];
var exceptions=this.serviceExceptionFormat(formats);
var records=[];
if(url&&layers){var fields=this.recordType.prototype.fields;
var layer,values,options,params,field,v;
for(var i=0,lenI=layers.length;
i<lenI;
i++){layer=layers[i];
if(layer.name){values={};
for(var j=0,lenJ=fields.length;
j<lenJ;
j++){field=fields.items[j];
v=layer[field.mapping||field.name]||field.defaultValue;
v=field.convert(v);
values[field.name]=v
}options={attribution:layer.attribution?this.attributionMarkup(layer.attribution):undefined,minScale:layer.minScale,maxScale:layer.maxScale};
if(this.meta.layerOptions){Ext.apply(options,this.meta.layerOptions)
}params={layers:layer.name,exceptions:exceptions,format:this.imageFormat(layer),transparent:this.imageTransparent(layer),version:version};
if(this.meta.layerParams){Ext.apply(params,this.meta.layerParams)
}values.layer=new OpenLayers.Layer.WMS(layer.title||layer.name,url,params,options);
records.push(new this.recordType(values,values.layer.id))
}}}return{totalRecords:records.length,success:true,records:records}
},attributionMarkup:function(attribution){var markup=[];
if(attribution.logo){markup.push("<img class='"+this.attributionCls+"-image' src='"+attribution.logo.href+"' />")
}if(attribution.title){markup.push("<span class='"+this.attributionCls+"-title'>"+attribution.title+"</span>")
}if(attribution.href){for(var i=0;
i<markup.length;
i++){markup[i]="<a class='"+this.attributionCls+"-link' href="+attribution.href+">"+markup[i]+"</a>"
}}return markup.join(" ")
}});
Ext.namespace("GeoExt.data");
GeoExt.data.WMSCapabilitiesStore=function(c){c=c||{};
GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(c,{proxy:c.proxy||(!c.data?new Ext.data.HttpProxy({url:c.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSCapabilitiesReader(c,c.fields)}))
};
Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store);
Ext.namespace("GeoExt.data");
GeoExt.data.WMSDescribeLayerReader=function(meta,recordType){meta=meta||{};
if(!meta.format){meta.format=new OpenLayers.Format.WMSDescribeLayer()
}if(!(typeof recordType==="function")){recordType=Ext.data.Record.create(recordType||meta.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}])
}GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,meta,recordType)
};
Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(request){var data=request.responseXML;
if(!data||!data.documentElement){data=request.responseText
}return this.readRecords(data)
},readRecords:function(data){if(typeof data==="string"||data.nodeType){data=this.meta.format.read(data)
}var records=[],description;
for(var i=0,len=data.length;
i<len;
i++){description=data[i];
if(description){records.push(new this.recordType(description))
}}return{totalRecords:records.length,success:true,records:records}
}});
Ext.namespace("GeoExt.data");
GeoExt.data.WMSDescribeLayerStore=function(c){c=c||{};
GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(c,{proxy:c.proxy||(!c.data?new Ext.data.HttpProxy({url:c.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoExt.data.WMSDescribeLayerReader(c,c.fields)}))
};
Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store);
Ext.namespace("GeoExt.state");
GeoExt.state.PermalinkProvider=function(config){GeoExt.state.PermalinkProvider.superclass.constructor.apply(this,arguments);
config=config||{};
var url=config.url;
delete config.url;
Ext.apply(this,config);
this.state=this.readURL(url)
};
Ext.extend(GeoExt.state.PermalinkProvider,Ext.state.Provider,{encodeType:true,readURL:function(url){var state={};
var params=OpenLayers.Util.getParameters(url);
var k,split,stateId;
for(k in params){if(params.hasOwnProperty(k)){split=k.split("_");
if(split.length>1){stateId=split[0];
state[stateId]=state[stateId]||{};
state[stateId][split.slice(1).join("_")]=this.encodeType?this.decodeValue(params[k]):params[k]
}}}return state
},getLink:function(base){base=base||document.location.href;
var params={};
var id,k,state=this.state;
for(id in state){if(state.hasOwnProperty(id)){for(k in state[id]){params[id+"_"+k]=this.encodeType?unescape(this.encodeValue(state[id][k])):state[id][k]
}}}OpenLayers.Util.applyDefaults(params,OpenLayers.Util.getParameters(base));
var paramsStr=OpenLayers.Util.getParameterString(params);
var qMark=base.indexOf("?");
if(qMark>0){base=base.substring(0,qMark)
}return Ext.urlAppend(base,paramsStr)
}});
Ext.namespace("GeoExt");
GeoExt.Action=Ext.extend(Ext.Action,{control:null,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(config){this.uScope=config.scope;
this.uHandler=config.handler;
this.uToggleHandler=config.toggleHandler;
this.uCheckHandler=config.checkHandler;
config.scope=this;
config.handler=this.pHandler;
config.toggleHandler=this.pToggleHandler;
config.checkHandler=this.pCheckHandler;
var ctrl=this.control=config.control;
delete config.control;
if(ctrl){if(config.map){config.map.addControl(ctrl);
delete config.map
}if((config.pressed||config.checked)&&ctrl.map){ctrl.activate()
}ctrl.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this})
}arguments.callee.superclass.constructor.call(this,config)
},pHandler:function(cmp){var ctrl=this.control;
if(ctrl&&ctrl.type==OpenLayers.Control.TYPE_BUTTON){ctrl.trigger()
}if(this.uHandler){this.uHandler.apply(this.uScope,arguments)
}},pToggleHandler:function(cmp,state){this.changeControlState(state);
if(this.uToggleHandler){this.uToggleHandler.apply(this.uScope,arguments)
}},pCheckHandler:function(cmp,state){this.changeControlState(state);
if(this.uCheckHandler){this.uCheckHandler.apply(this.uScope,arguments)
}},changeControlState:function(state){if(state){if(!this._activating){this._activating=true;
this.control.activate();
this._activating=false
}}else{if(!this._deactivating){this._deactivating=true;
this.control.deactivate();
this._deactivating=false
}}},onCtrlActivate:function(){var ctrl=this.control;
if(ctrl.type==OpenLayers.Control.TYPE_BUTTON){this.enable()
}else{this.safeCallEach("toggle",[true]);
this.safeCallEach("setChecked",[true])
}},onCtrlDeactivate:function(){var ctrl=this.control;
if(ctrl.type==OpenLayers.Control.TYPE_BUTTON){this.disable()
}else{this.safeCallEach("toggle",[false]);
this.safeCallEach("setChecked",[false])
}},safeCallEach:function(fnName,args){var cs=this.items;
for(var i=0,len=cs.length;
i<len;
i++){if(cs[i][fnName]){cs[i].rendered?cs[i][fnName].apply(cs[i],args):cs[i].on({render:cs[i][fnName].createDelegate(cs[i],args),single:true})
}}}});
Ext.namespace("GeoExt");
GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,prettyStateKeys:false,extent:null,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange"],initComponent:function(){if(!(this.map instanceof OpenLayers.Map)){this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:true}))
}var layers=this.layers;
if(!layers||layers instanceof Array){this.layers=new GeoExt.data.LayerStore({layers:layers,map:this.map.layers.length>0?this.map:null})
}if(typeof this.center=="string"){this.center=OpenLayers.LonLat.fromString(this.center)
}else{if(this.center instanceof Array){this.center=new OpenLayers.LonLat(this.center[0],this.center[1])
}}if(typeof this.extent=="string"){this.extent=OpenLayers.Bounds.fromString(this.extent)
}else{if(this.extent instanceof Array){this.extent=OpenLayers.Bounds.fromArray(this.extent)
}}GeoExt.MapPanel.superclass.initComponent.call(this);
this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange");
this.map.events.on({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this})
},onMoveend:function(){this.fireEvent("aftermapmove")
},onLayerchange:function(e){if(e.property){if(e.property==="visibility"){this.fireEvent("afterlayervisibilitychange")
}else{if(e.property==="opacity"){this.fireEvent("afterlayeropacitychange")
}}}},applyState:function(state){this.center=new OpenLayers.LonLat(state.x,state.y);
this.zoom=state.zoom;
var i,l,layer,layerId,visibility,opacity;
var layers=this.map.layers;
for(i=0,l=layers.length;
i<l;
i++){layer=layers[i];
layerId=this.prettyStateKeys?layer.name:layer.id;
visibility=state["visibility_"+layerId];
if(visibility!==undefined){visibility=(/^true$/i).test(visibility);
if(layer.isBaseLayer){if(visibility){this.map.setBaseLayer(layer);
this.map.events.triggerEvent("changebaselayer")
}}else{layer.setVisibility(visibility)
}}opacity=state["opacity_"+layerId];
if(opacity!==undefined){layer.setOpacity(opacity)
}}},getState:function(){var state;
if(!this.map){return
}var center=this.map.getCenter();
state={x:center.lon,y:center.lat,zoom:this.map.getZoom()};
var i,l,layer,layerId,layers=this.map.layers;
for(i=0,l=layers.length;
i<l;
i++){layer=layers[i];
layerId=this.prettyStateKeys?layer.name:layer.id;
state["visibility_"+layerId]=layer.getVisibility();
state["opacity_"+layerId]=layer.opacity==null?1:layer.opacity
}return state
},updateMapSize:function(){if(this.map){this.map.updateSize()
}},renderMap:function(){var map=this.map;
map.render(this.body.dom);
this.layers.bind(map);
if(map.layers.length>0){if(this.center||this.zoom!=null){map.setCenter(this.center,this.zoom)
}else{if(this.extent){map.zoomToExtent(this.extent)
}else{map.zoomToMaxExtent()
}}}},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments);
if(!this.ownerCt){this.renderMap()
}else{this.ownerCt.on("move",this.updateMapSize,this);
this.ownerCt.on({afterlayout:{fn:this.renderMap,scope:this,single:true}})
}},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments);
this.updateMapSize()
},onBeforeAdd:function(item){if(typeof item.addToMapPanel==="function"){item.addToMapPanel(this)
}GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments)
},remove:function(item,autoDestroy){if(typeof item.removeFromMapPanel==="function"){item.removeFromMapPanel(this)
}GeoExt.MapPanel.superclass.remove.apply(this,arguments)
},beforeDestroy:function(){if(this.ownerCt){this.ownerCt.un("move",this.updateMapSize,this)
}if(this.map&&this.map.events){this.map.events.un({moveend:this.onMoveend,changelayer:this.onLayerchange,scope:this})
}if(!this.initialConfig.map||!(this.initialConfig.map instanceof OpenLayers.Map)){if(this.map&&this.map.destroy){this.map.destroy()
}}delete this.map;
GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments)
}});
GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(o){return o instanceof GeoExt.MapPanel
})
};
Ext.reg("gx_mappanel",GeoExt.MapPanel);
Ext.namespace("GeoExt");
GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this);
if(this.defaultImgSrc===null){this.defaultImgSrc=Ext.BLANK_IMAGE_URL
}this.autoEl={tag:"img","class":(this.imgCls?this.imgCls:""),src:this.defaultImgSrc}
},setUrl:function(url){this.url=url;
var el=this.getEl();
if(el){el.un("error",this.onImageLoadError,this);
el.on("error",this.onImageLoadError,this,{single:true});
el.dom.src=url
}},onRender:function(ct,position){GeoExt.LegendImage.superclass.onRender.call(this,ct,position);
if(this.url){this.setUrl(this.url)
}},onDestroy:function(){var el=this.getEl();
if(el){el.un("error",this.onImageLoadError,this)
}GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments)
},onImageLoadError:function(){this.getEl().dom.src=this.defaultImgSrc
}});
Ext.reg("gx_legendimage",GeoExt.LegendImage);
Ext.namespace("GeoExt");
GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:true,layerStore:null,preferredTypes:null,filter:function(record){return true
},initComponent:function(){GeoExt.LegendPanel.superclass.initComponent.call(this)
},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments);
if(!this.layerStore){this.layerStore=GeoExt.MapPanel.guess().layers
}this.layerStore.each(function(record){this.addLegend(record)
},this);
if(this.dynamic){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this})
}},recordIndexToPanelIndex:function(index){var store=this.layerStore;
var count=store.getCount();
var panelIndex=-1;
var legendCount=this.items?this.items.length:0;
var record,layer;
for(var i=count-1;
i>=0;
--i){record=store.getAt(i);
layer=record.getLayer();
var types=GeoExt.LayerLegend.getTypes(record);
if(layer.displayInLayerSwitcher&&types.length>0&&(store.getAt(i).get("hideInLegend")!==true)){++panelIndex;
if(index===i||panelIndex>legendCount-1){break
}}}return panelIndex
},getIdForLayer:function(layer){return this.id+"-"+layer.id
},onStoreAdd:function(store,records,index){var panelIndex=this.recordIndexToPanelIndex(index+records.length-1);
for(var i=0,len=records.length;
i<len;
i++){this.addLegend(records[i],panelIndex)
}this.doLayout()
},onStoreRemove:function(store,record,index){this.removeLegend(record)
},removeLegend:function(record){if(this.items){var legend=this.getComponent(this.getIdForLayer(record.getLayer()));
if(legend){this.remove(legend,true);
this.doLayout()
}}},onStoreClear:function(store){this.removeAllLegends()
},removeAllLegends:function(){this.removeAll(true);
this.doLayout()
},addLegend:function(record,index){if(this.filter(record)===true){var layer=record.getLayer();
index=index||0;
var legend;
var types=GeoExt.LayerLegend.getTypes(record,this.preferredTypes);
if(layer.displayInLayerSwitcher&&!record.get("hideInLegend")&&types.length>0){this.insert(index,{xtype:types[0],id:this.getIdForLayer(layer),layerRecord:record,hidden:!((!layer.map&&layer.visibility)||(layer.getVisibility()&&layer.calculateInRange()))})
}}},onDestroy:function(){if(this.layerStore){this.layerStore.un("add",this.onStoreAdd,this);
this.layerStore.un("remove",this.onStoreRemove,this);
this.layerStore.un("clear",this.onStoreClear,this)
}GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments)
}});
Ext.reg("gx_legendpanel",GeoExt.LegendPanel);
Ext.namespace("GeoExt");
GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:true,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this);
this.autoEl={};
this.add({xtype:"label",text:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")});
if(this.layerRecord&&this.layerRecord.store){this.layerStore=this.layerRecord.store;
this.layerStore.on("update",this.onStoreUpdate,this)
}},onStoreUpdate:function(store,record,operation){if(record===this.layerRecord&&this.items.getCount()>0){var layer=record.getLayer();
this.setVisible(layer.getVisibility()&&layer.calculateInRange()&&layer.displayInLayerSwitcher&&!record.get("hideInLegend"));
this.update()
}},update:function(){var title=this.getLayerTitle(this.layerRecord);
if(this.items.get(0).text!==title){this.items.get(0).text=title
}},getLayerTitle:function(record){var title=this.legendTitle||"";
if(this.showTitle&&!title){if(record&&!record.get("hideTitle")){title=record.get("title")||record.get("name")||record.getLayer().name||""
}}return title
},beforeDestroy:function(){this.layerStore&&this.layerStore.un("update",this.onStoreUpdate,this);
GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments)
}});
GeoExt.LayerLegend.getTypes=function(layerRecord,preferredTypes){var types=(preferredTypes||[]).concat();
var goodTypes=[];
for(var type in GeoExt.LayerLegend.types){if(GeoExt.LayerLegend.types[type].supports(layerRecord)){types.indexOf(type)==-1&&goodTypes.push(type)
}else{types.remove(type)
}}return types.concat(goodTypes)
};
GeoExt.LayerLegend.supports=function(layerRecord){};
GeoExt.LayerLegend.types={};
Ext.namespace("GeoExt");
GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:true,useScaleParameter:true,baseParams:null,initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);
var layer=this.layerRecord.getLayer();
this._noMap=!layer.map;
layer.events.register("moveend",this,this.onLayerMoveend);
this.update()
},onLayerMoveend:function(e){if((e.zoomChanged===true&&this.useScaleParameter===true)||this._noMap){delete this._noMap;
this.update()
}},getLegendUrl:function(layerName,layerNames){var rec=this.layerRecord;
var url;
var styles=rec&&rec.get("styles");
var layer=rec.getLayer();
layerNames=layerNames||[layer.params.LAYERS].join(",").split(",");
var styleNames=layer.params.STYLES&&[layer.params.STYLES].join(",").split(",");
var idx=layerNames.indexOf(layerName);
var styleName=styleNames&&styleNames[idx];
if(styles&&styles.length>0){if(styleName){Ext.each(styles,function(s){url=(s.name==styleName&&s.legend)&&s.legend.href;
return !url
})
}else{if(this.defaultStyleIsFirst===true&&!styleNames&&!layer.params.SLD&&!layer.params.SLD_BODY){url=styles[0].legend&&styles[0].legend.href
}}}if(!url){url=layer.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:layerName,LAYERS:null,STYLE:(styleName!=="")?styleName:null,STYLES:null,SRS:null,FORMAT:null})
}if(this.useScaleParameter===true&&url.toLowerCase().indexOf("request=getlegendgraphic")!=-1){var scale=layer.map.getScale();
url=Ext.urlAppend(url,"SCALE="+scale)
}var params=this.baseParams||{};
Ext.applyIf(params,{FORMAT:"image/gif"});
if(url.indexOf("?")>0){url=Ext.urlEncode(params,url)
}return url
},update:function(){var layer=this.layerRecord.getLayer();
if(!(layer&&layer.map)){return
}GeoExt.WMSLegend.superclass.update.apply(this,arguments);
var layerNames,layerName,i,len;
layerNames=[layer.params.LAYERS].join(",").split(",");
var destroyList=[];
var textCmp=this.items.get(0);
this.items.each(function(cmp){i=layerNames.indexOf(cmp.itemId);
if(i<0&&cmp!=textCmp){destroyList.push(cmp)
}else{if(cmp!==textCmp){layerName=layerNames[i];
var newUrl=this.getLegendUrl(layerName,layerNames);
if(!OpenLayers.Util.isEquivalentUrl(newUrl,cmp.url)){cmp.setUrl(newUrl)
}}}},this);
for(i=0,len=destroyList.length;
i<len;
i++){var cmp=destroyList[i];
this.remove(cmp);
cmp.destroy()
}for(i=0,len=layerNames.length;
i<len;
i++){layerName=layerNames[i];
if(!this.items||!this.getComponent(layerName)){this.add({xtype:"gx_legendimage",url:this.getLegendUrl(layerName,layerNames),itemId:layerName})
}}this.doLayout()
},beforeDestroy:function(){if(this.useScaleParameter===true){var layer=this.layerRecord.getLayer();
layer&&layer.events&&layer.events.unregister("moveend",this,this.onLayerMoveend)
}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments)
}});
GeoExt.WMSLegend.supports=function(layerRecord){return layerRecord.getLayer() instanceof OpenLayers.Layer.WMS
};
GeoExt.LayerLegend.types.gx_wmslegend=GeoExt.WMSLegend;
Ext.reg("gx_wmslegend",GeoExt.WMSLegend);
Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{constructor:function(config){config=Ext.applyIf(config||{},{text:"Layers"});
this.loader=config.loader instanceof GeoExt.tree.LayerLoader?config.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(config.loader||{},{store:config.layerStore}));
GeoExt.tree.LayerContainer.superclass.constructor.call(this,config)
},recordIndexToNodeIndex:function(index){var store=this.loader.store;
var count=store.getCount();
var nodeCount=this.childNodes.length;
var nodeIndex=-1;
for(var i=count-1;
i>=0;
--i){if(this.loader.filter(store.getAt(i))===true){++nodeIndex;
if(index===i||nodeIndex>nodeCount-1){break
}}}return nodeIndex
},destroy:function(){delete this.layerStore;
GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments)
}});
Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer;
Ext.namespace("GeoExt.tree");
GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(config){config=Ext.applyIf(config||{},{text:"Base Layer",loader:{}});
config.loader=Ext.applyIf(config.loader,{baseAttrs:Ext.applyIf(config.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(record){var layer=record.getLayer();
return layer.displayInLayerSwitcher===true&&layer.isBaseLayer===true
}});
GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,config)
}});
Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer;
Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerLoader=function(config){Ext.apply(this,config);
this.addEvents("beforeload","load");
GeoExt.tree.LayerLoader.superclass.constructor.call(this)
};
Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(record){return record.getLayer().displayInLayerSwitcher==true
},baseAttrs:null,uiProviders:null,load:function(node,callback){if(this.fireEvent("beforeload",this,node)){this.removeStoreHandlers();
while(node.firstChild){node.removeChild(node.firstChild)
}if(!this.uiProviders){this.uiProviders=node.getOwnerTree().getLoader().uiProviders
}if(!this.store){this.store=GeoExt.MapPanel.guess().layers
}this.store.each(function(record){this.addLayerNode(node,record)
},this);
this.addStoreHandlers(node);
if(typeof callback=="function"){callback()
}this.fireEvent("load",this,node)
}},onStoreAdd:function(store,records,index,node){if(!this._reordering){var nodeIndex=node.recordIndexToNodeIndex(index+records.length-1);
for(var i=0;
i<records.length;
++i){this.addLayerNode(node,records[i],nodeIndex)
}}},onStoreRemove:function(store,record,index,node){if(!this._reordering){this.removeLayerNode(node,record)
}},addLayerNode:function(node,layerRecord,index){index=index||0;
if(this.filter(layerRecord)===true){var child=this.createNode({nodeType:"gx_layer",layer:layerRecord.getLayer(),layerStore:this.store});
var sibling=node.item(index);
if(sibling){node.insertBefore(child,sibling)
}else{node.appendChild(child)
}child.on("move",this.onChildMove,this)
}},removeLayerNode:function(node,layerRecord){if(this.filter(layerRecord)===true){var child=node.findChildBy(function(node){return node.layer==layerRecord.getLayer()
});
if(child){child.un("move",this.onChildMove,this);
child.remove();
node.reload()
}}},onChildMove:function(tree,node,oldParent,newParent,index){this._reordering=true;
var record=this.store.getByLayer(node.layer);
if(newParent instanceof GeoExt.tree.LayerContainer&&this.store===newParent.loader.store){newParent.loader._reordering=true;
this.store.remove(record);
var newRecordIndex;
if(newParent.childNodes.length>1){var searchIndex=(index===0)?index+1:index-1;
newRecordIndex=this.store.findBy(function(r){return newParent.childNodes[searchIndex].layer===r.getLayer()
});
index===0&&newRecordIndex++
}else{if(oldParent.parentNode===newParent.parentNode){var prev=newParent;
do{prev=prev.previousSibling
}while(prev&&!(prev instanceof GeoExt.tree.LayerContainer&&prev.lastChild));
if(prev){newRecordIndex=this.store.findBy(function(r){return prev.lastChild.layer===r.getLayer()
})
}else{var next=newParent;
do{next=next.nextSibling
}while(next&&!(next instanceof GeoExt.tree.LayerContainer&&next.firstChild));
if(next){newRecordIndex=this.store.findBy(function(r){return next.firstChild.layer===r.getLayer()
})
}newRecordIndex++
}}}if(newRecordIndex!==undefined){this.store.insert(newRecordIndex,[record]);
window.setTimeout(function(){newParent.reload();
oldParent.reload()
})
}else{this.store.insert(oldRecordIndex,[record])
}delete newParent.loader._reordering
}delete this._reordering
},addStoreHandlers:function(node){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[node],true),remove:this.onStoreRemove.createDelegate(this,[node],true)};
for(var evt in this._storeHandlers){this.store.on(evt,this._storeHandlers[evt],this)
}}},removeStoreHandlers:function(){if(this._storeHandlers){for(var evt in this._storeHandlers){this.store.un(evt,this._storeHandlers[evt],this)
}delete this._storeHandlers
}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs)
}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}attr.nodeType=attr.nodeType||"gx_layer";
return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)
},destroy:function(){this.removeStoreHandlers()
}});
Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(config){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments)
},render:function(bulkRender){var a=this.node.attributes;
if(a.checked===undefined){a.checked=this.node.layer.getVisibility()
}GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);
var cb=this.checkbox;
if(a.checkedGroup){var radio=Ext.DomHelper.insertAfter(cb,['<input type="radio" name="',a.checkedGroup,'_checkbox" class="',cb.className,cb.checked?'" checked="checked"':"",'"></input>'].join(""));
radio.defaultChecked=cb.defaultChecked;
Ext.get(cb).remove();
this.checkbox=radio
}this.enforceOneVisible()
},onClick:function(e){if(e.getTarget(".x-tree-node-cb",1)){this.toggleCheck(this.isChecked())
}else{GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments)
}},toggleCheck:function(value){value=(value===undefined?!this.isChecked():value);
GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,value);
this.enforceOneVisible()
},enforceOneVisible:function(){var attributes=this.node.attributes;
var group=attributes.checkedGroup;
if(group&&group!=="gx_baselayer"){var layer=this.node.layer;
var checkedNodes=this.node.getOwnerTree().getChecked();
var checkedCount=0;
Ext.each(checkedNodes,function(n){var l=n.layer;
if(!n.hidden&&n.attributes.checkedGroup===group){checkedCount++;
if(l!=layer&&attributes.checked){l.setVisibility(false)
}}});
if(checkedCount===0&&attributes.checked==false){layer.setVisibility(true)
}}},appendDDGhost:function(ghostNode){var n=this.elNode.cloneNode(true);
var radio=Ext.DomQuery.select("input[type='radio']",n);
Ext.each(radio,function(r){r.name=r.name+"_clone"
});
ghostNode.appendChild(n)
}});
GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,layerStore:null,constructor:function(config){config.leaf=config.leaf||!(config.children||config.loader);
if(!config.iconCls&&!config.children){config.iconCls="gx-tree-layer-icon"
}if(config.loader&&!(config.loader instanceof Ext.tree.TreeLoader)){config.loader=new GeoExt.tree.LayerParamLoader(config.loader)
}this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI;
Ext.apply(this,{layer:config.layer,layerStore:config.layerStore});
if(config.text){this.fixedText=true
}GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments)
},render:function(bulkRender){var layer=this.layer instanceof OpenLayers.Layer&&this.layer;
if(!layer){if(!this.layerStore||this.layerStore=="auto"){this.layerStore=GeoExt.MapPanel.guess().layers
}var i=this.layerStore.findBy(function(o){return o.get("title")==this.layer
},this);
if(i!=-1){layer=this.layerStore.getAt(i).getLayer()
}}if(!this.rendered||!layer){var ui=this.getUI();
if(layer){this.layer=layer;
if(layer.isBaseLayer){this.draggable=false;
Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"})
}if(!this.text){this.text=layer.name
}ui.show();
this.addVisibilityEventHandlers()
}else{ui.hide()
}if(this.layerStore instanceof GeoExt.data.LayerStore){this.addStoreEventHandlers(layer)
}}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments)
},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});
this.on({checkchange:this.onCheckChange,scope:this})
},onLayerVisibilityChanged:function(){if(!this._visibilityChanging){this.getUI().toggleCheck(this.layer.getVisibility())
}},onCheckChange:function(node,checked){if(checked!=this.layer.getVisibility()){this._visibilityChanging=true;
var layer=this.layer;
if(checked&&layer.isBaseLayer&&layer.map){layer.map.setBaseLayer(layer);
layer.map.events.triggerEvent("changebaselayer")
}else{layer.setVisibility(checked)
}delete this._visibilityChanging
}},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this})
},onStoreAdd:function(store,records,index){var l;
for(var i=0;
i<records.length;
++i){l=records[i].getLayer();
if(this.layer==l){this.getUI().show();
break
}else{if(this.layer==l.name){this.render();
break
}}}},onStoreRemove:function(store,record,index){if(this.layer==record.getLayer()){this.getUI().hide()
}},onStoreUpdate:function(store,record,operation){var layer=record.getLayer();
if(!this.fixedText&&(this.layer==layer&&this.text!==layer.name)){this.setText(layer.name)
}},destroy:function(){var layer=this.layer;
if(layer instanceof OpenLayers.Layer){layer.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this})
}delete this.layer;
var layerStore=this.layerStore;
if(layerStore){layerStore.un("add",this.onStoreAdd,this);
layerStore.un("remove",this.onStoreRemove,this);
layerStore.un("update",this.onStoreUpdate,this)
}delete this.layerStore;
this.un("checkchange",this.onCheckChange,this);
GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments)
}});
Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode;
Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerParamLoader=function(config){Ext.apply(this,config);
this.addEvents("beforeload","load");
GeoExt.tree.LayerParamLoader.superclass.constructor.call(this)
};
Ext.extend(GeoExt.tree.LayerParamLoader,Ext.util.Observable,{param:null,delimiter:",",load:function(node,callback){if(this.fireEvent("beforeload",this,node)){while(node.firstChild){node.removeChild(node.firstChild)
}var paramValue=(node.layer instanceof OpenLayers.Layer.HTTPRequest)&&node.layer.params[this.param];
if(paramValue){var items=(paramValue instanceof Array)?paramValue.slice():paramValue.split(this.delimiter);
Ext.each(items,function(item,index,allItems){this.addParamNode(item,allItems,node)
},this)
}if(typeof callback=="function"){callback()
}this.fireEvent("load",this,node)
}},addParamNode:function(paramItem,allParamItems,node){var child=this.createNode({layer:node.layer,param:this.param,item:paramItem,allItems:allParamItems,delimiter:this.delimiter});
var sibling=node.item(0);
if(sibling){node.insertBefore(child,sibling)
}else{node.appendChild(child)
}},createNode:function(attr){if(this.baseAttrs){Ext.apply(attr,this.baseAttrs)
}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)
}attr.nodeType=attr.nodeType||"gx_layerparam";
return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)
}});
Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerParamNode=Ext.extend(Ext.tree.TreeNode,{layer:null,param:null,item:null,delimiter:null,allItems:null,constructor:function(attributes){var config=attributes||{};
config.iconCls=config.iconCls||"gx-tree-layerparam-icon";
config.text=config.text||config.item;
this.param=config.param;
this.item=config.item;
this.delimiter=config.delimiter||",";
this.allItems=config.allItems;
GeoExt.tree.LayerParamNode.superclass.constructor.apply(this,arguments);
this.getLayer();
if(this.layer){if(!this.allItems){this.allItems=this.getItemsFromLayer()
}if(this.attributes.checked==null){this.attributes.checked=this.layer.getVisibility()&&this.getItemsFromLayer().indexOf(this.item)>=0
}else{this.onCheckChange(this,this.attributes.checked)
}this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this});
this.on({checkchange:this.onCheckChange,scope:this})
}},getLayer:function(){if(!this.layer){var layer=this.attributes.layer;
if(typeof layer=="string"){var store=this.attributes.layerStore||GeoExt.MapPanel.guess().layers;
var i=store.findBy(function(o){return o.get("title")==layer
});
layer=i!=-1?store.getAt(i).getLayer():null
}this.layer=layer
}return this.layer
},getItemsFromLayer:function(){var paramValue=this.layer.params[this.param];
return paramValue instanceof Array?paramValue:(paramValue?paramValue.split(this.delimiter):[])
},createParams:function(items){var params={};
params[this.param]=this.layer.params[this.param] instanceof Array?items:items.join(this.delimiter);
return params
},onLayerVisibilityChanged:function(){if(this.getItemsFromLayer().length===0){this.layer.mergeNewParams(this.createParams(this.allItems))
}var visible=this.layer.getVisibility();
if(visible&&this.getItemsFromLayer().indexOf(this.item)!==-1){this.getUI().toggleCheck(true)
}if(!visible){this.layer.mergeNewParams(this.createParams([]));
this.getUI().toggleCheck(false)
}},onCheckChange:function(node,checked){var layer=this.layer;
var newItems=[];
var curItems=this.getItemsFromLayer();
if(checked===true&&layer.getVisibility()===false&&curItems.length===this.allItems.length){curItems=[]
}Ext.each(this.allItems,function(item){if((item!==this.item&&curItems.indexOf(item)!==-1)||(checked===true&&item===this.item)){newItems.push(item)
}},this);
var visible=(newItems.length>0);
visible&&layer.mergeNewParams(this.createParams(newItems));
if(visible!==layer.getVisibility()){layer.setVisibility(visible)
}(!visible)&&layer.mergeNewParams(this.createParams([]))
},destroy:function(){var layer=this.layer;
if(layer instanceof OpenLayers.Layer){layer.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this})
}delete this.layer;
this.un("checkchange",this.onCheckChange,this);
GeoExt.tree.LayerParamNode.superclass.destroy.apply(this,arguments)
}});
Ext.tree.TreePanel.nodeTypes.gx_layerparam=GeoExt.tree.LayerParamNode;
Ext.namespace("GeoExt.tree");
GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{constructor:function(config){config=Ext.applyIf(config||{},{text:"Overlays"});
config.loader=Ext.applyIf(config.loader||{},{filter:function(record){var layer=record.getLayer();
return layer.displayInLayerSwitcher===true&&layer.isBaseLayer===false
}});
GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,config)
}});
Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer;
Ext.namespace("GeoExt.tree");
GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(node){node.addEvents("rendernode","rawclicknode");
this.superclass=arguments.callee.superclass;
this.superclass.constructor.apply(this,arguments)
},render:function(bulkRender){if(!this.rendered){this.superclass.render.apply(this,arguments);
this.fireEvent("rendernode",this.node)
}},onClick:function(e){if(this.fireEvent("rawclicknode",this.node,e)!==false){this.superclass.onClick.apply(this,arguments)
}}}
};
Ext.namespace("GeoExt.plugins");
GeoExt.plugins.TreeNodeRadioButton=Ext.extend(Ext.util.Observable,{constructor:function(config){Ext.apply(this.initialConfig,Ext.apply({},config));
Ext.apply(this,config);
this.addEvents("radiochange");
GeoExt.plugins.TreeNodeRadioButton.superclass.constructor.apply(this,arguments)
},init:function(tree){tree.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this})
},onRenderNode:function(node){var a=node.attributes;
if(a.radioGroup&&!a.radio){a.radio=Ext.DomHelper.insertBefore(node.ui.anchor,['<input type="radio" class="gx-tree-radio" name="',a.radioGroup,'_radio"></input>'].join(""))
}},onRawClickNode:function(node,e){var el=e.getTarget(".gx-tree-radio",1);
if(el){el.defaultChecked=el.checked;
this.fireEvent("radiochange",node);
return false
}},onBeforeDestroy:function(tree){tree.un("rendernode",this.onRenderNode,this);
tree.un("rawclicknode",this.onRenderNode,this);
tree.un("beforedestroy",this.onBeforeDestroy,this)
}});
Ext.preg("gx_treenoderadiobutton",GeoExt.plugins.TreeNodeRadioButton);
Ext.namespace("GeoExt.plugins");
GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(config){this.initialConfig=config;
Ext.apply(this,config);
GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments)
},init:function(target){this.target=target;
var onCfg={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};
onCfg[target instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange;
target.on(onCfg)
},onRender:function(field){var printProvider=this.printProvider||field.ownerCt.printProvider;
if(field.store===printProvider.layouts){field.setValue(printProvider.layout.get(field.displayField));
printProvider.on({layoutchange:this.onProviderChange,scope:this})
}else{if(field.store===printProvider.dpis){field.setValue(printProvider.dpi.get(field.displayField));
printProvider.on({dpichange:this.onProviderChange,scope:this})
}else{if(field.initialConfig.value===undefined){field.setValue(printProvider.customParams[field.name])
}}}},onFieldChange:function(field,record){var printProvider=this.printProvider||field.ownerCt.printProvider;
var value=field.getValue();
this._updating=true;
if(record){switch(field.store){case printProvider.layouts:printProvider.setLayout(record);
break;
case printProvider.dpis:printProvider.setDpi(record)
}}else{printProvider.customParams[field.name]=value
}delete this._updating
},onProviderChange:function(printProvider,rec){if(!this._updating){this.target.setValue(rec.get(this.target.displayField))
}},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);
this.target.un("render",this.onRender,this);
this.target.un("select",this.onFieldChange,this);
this.target.un("valid",this.onFieldChange,this);
this.printProvider.un("layoutchange",this.onProviderChange,this);
this.printProvider.un("dpichange",this.onProviderChange,this)
}});
Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField);
Ext.namespace("GeoExt.plugins");
GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(config){this.initialConfig=config;
Ext.apply(this,config);
GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments)
},init:function(target){this.target=target;
var onCfg={beforedestroy:this.onBeforeDestroy,scope:this};
var eventName=target instanceof Ext.form.ComboBox?"select":target instanceof Ext.form.Checkbox?"check":"valid";
onCfg[eventName]=this.onFieldChange;
target.on(onCfg);
this.printPage.on({change:this.onPageChange,scope:this});
this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this});
this.setValue(this.printPage)
},onFieldChange:function(field,record){var printProvider=this.printPage.printProvider;
var value=field.getValue();
this._updating=true;
if(field.store===printProvider.scales||field.name==="scale"){this.printPage.setScale(record)
}else{if(field.name=="rotation"){!isNaN(value)&&this.printPage.setRotation(value)
}else{this.printPage.customParams[field.name]=value
}}delete this._updating
},onPageChange:function(printPage){if(!this._updating){this.setValue(printPage)
}},onLayoutChange:function(printProvider,layout){var t=this.target;
t.name=="rotation"&&t.setDisabled(!layout.get("rotation"))
},setValue:function(printPage){var t=this.target;
t.suspendEvents();
if(t.store===printPage.printProvider.scales||t.name==="scale"){if(printPage.scale){t.setValue(printPage.scale.get(t.displayField))
}}else{if(t.name=="rotation"){t.setValue(printPage.rotation)
}}t.resumeEvents()
},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this);
this.target.un("select",this.onFieldChange,this);
this.target.un("valid",this.onFieldChange,this);
this.printPage.un("change",this.onPageChange,this);
this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this)
}});
Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField);
Ext.namespace("GeoExt");
GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:true,minWidth:10,offsets:[0,-10],dragging:false,init:function(slider){GeoExt.SliderTip.superclass.init.apply(this,arguments);
if(this.hover){slider.on("render",this.registerThumbListeners,this)
}this.slider=slider
},registerThumbListeners:function(){var thumb,el;
for(var i=0,ii=this.slider.thumbs.length;
i<ii;
++i){thumb=this.slider.thumbs[i];
el=thumb.tracker.el;
(function(thumb,el){el.on({mouseover:function(e){this.onSlide(this.slider,e,thumb);
this.dragging=false
},mouseout:function(){if(!this.dragging){this.hide.apply(this,arguments)
}},scope:this})
}).apply(this,[thumb,el])
}},onSlide:function(slider,e,thumb){this.dragging=true;
return GeoExt.SliderTip.superclass.onSlide.apply(this,arguments)
}});
Ext.namespace("GeoExt");
GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(slider){this.compiledTemplate=new Ext.Template(this.template);
GeoExt.LayerOpacitySliderTip.superclass.init.call(this,slider)
},getText:function(thumb){var data={opacity:thumb.value};
return this.compiledTemplate.apply(data)
}});
Ext.namespace("GeoExt.tree");
GeoExt.tree.LayerOpacitySliderPlugin=Ext.extend(Ext.util.Observable,{constructor:function(config){Ext.apply(this.initialConfig,Ext.apply({},config));
Ext.apply(this,config);
this.addEvents("opacityslide");
GeoExt.tree.LayerOpacitySliderPlugin.superclass.constructor.apply(this,arguments)
},init:function(tree){tree.on({rendernode:this.onRenderNode,scope:this})
},onRenderNode:function(node){var a=node.attributes;
var layer=node.layer;
if(a.slider){this.indentMarkup=node.parentNode?node.parentNode.ui.getChildIndent():"";
var elID=node.id+"-tree-slider-";
elID=Ext.id(null,elID);
buf=["<br/>","<table><tr>","<td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>",'<span class="x-tree-node-indent">',this.indentMarkup,"</span>","</td><td>","<a id=",elID,"></a>","</td>","</tr></table>"];
Ext.DomHelper.insertAfter(node.ui.anchor,buf.join(""));
var initValue=100;
var slider=new Ext.Slider({minValue:0,maxValue:100,value:initValue,width:100,aggressive:true,layer:layer,plugins:new GeoExt.LayerOpacitySliderTip()});
Ext.override(Ext.Slider,{getRatio:function(){var w=this.innerEl.getComputedWidth();
var v=this.maxValue-this.minValue;
return v==0?w:(w/v)
}});
slider.on("change",function(slider,value,oldValue){this.layer.setOpacity(value/100)
});
slider.render(elID)
}}});
Ext.preg&&Ext.preg("gx_layeropacitysliderplugin",GeoExt.tree.LayerOpacitySliderPlugin);
Ext.namespace("GeoNetwork");
GeoNetwork.singleFile=true;
Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.ca={previousPage:"Tornar a la pgina anterior",nextPage:"Anar a la pgina segent",upInPage:"Desplaar cap amunt als resultats",downInPage:"Desplaar cap avall als resultats",example:"Exemple:",noInfo:"Cap informaci",helper:"Suggeriment:",toggleLayerManager:"Mostrar el gestor de capes",tagName:"Nom de l'element:",enableTooltip:"Activar l'indicador de funci per obtenir ms informaci de cada camp.",connectIssue:"Problemes amb la connexi al catleg",connectIssueMsg:"Error 404. Impossible connectar amb el catleg de la URL ",featureInfoTooltipTitle:"Informaci de l'entitat",featureInfoTooltipText:"Punxi sobre el mapa per obtenir informaci de les entitats de totes les capes visibles.",zoomToMaxExtentTooltipTitle:"Extensi total",zoomToMaxExtentTooltipText:"Utilitzi aquest bot per visualitzar l'extensi total del mapa.",zoominTooltipTitle:"Apropar",zoominTooltipText:"Dibuixi una capsa en el mapa per apropar-se a la zona. Tamb pot punxar sobre el mapa per apropar-se un factor de 2.",zoomoutTooltipTitle:"Allunyar",zoomoutTooltipText:"Punxi sobre el mapa o dibuixi una capsa per allunyar-se.",dragTooltipTitle:"Desplaar el mapa",dragTooltipText:"Premi el bot esquerre de ratol per desplaar el mapa.",previousTooltipTitle:"Vista anterior",previosTooltipText:"Premi aquest bot per anar a la vista anterior del mapa",nextTooltipTitle:"Vista segent",nextTooltipText:"Premi aquest bot per anar a la vista segent del mapa",featureInfoTitle:"Informaci de l'entitat",layerManagerTabTitle:"Gesti de capes",legendTabTitle:"Llegenda",scaleTitle:"Escala",xTitle:"X",yTitle:"Y",projectionTitle:"Projecci",FeatureInfoNotQueryable:"No hi ha cap capa consultable",WMSBrowserTab1:"Seleccionar",WMSBrowserTab3:"Extern",WMSBrowserPreviewTitle:"Previsualitzaci de la capa",WMSBrowserAddButton:"Afegir",WMSBrowserDuplicateMsg:"La capa ja est al mapa",WMSBrowserPreviewWaitMsg:"Recuperar la imatge anterior",WMSBrowserConnectButton:"Connectar",WMSBrowserConnectError:"Error de connexi al servidor WMS. Si us plau, verifiqui la URL.",infoTitle:"Informaci","mf.print.mapTitle":"Ttol","mf.print.comment":"Commentari","mf.print.dpi":"Resoluci","mf.print.scale":"Escala","mf.print.rotation":"Angle","mf.print.resetPos":"Esborrar","mf.print.print":"Imprimir","mf.print.generatingPDF":"Generant PDF","mf.print.unableToPrint":"No ha estat possible imprimir, intenti-ho ms tard","mf.error":"Error",selectExtentTooltipTitle:"Seleccionar una zona",selectExtentTooltipText:"Seleccionar una zona per cercar al catleg",clearExtentTooltipTitle:"Eliminar zona",clearExtentTooltipText:"Esborrar zona (s a dir, cap criteri espacial)",printTooltipTitle:"Imprimir",printTooltipText:"Imprimir el mapa actual",savewmcTooltipTitle:"Guardar el context de mapa web (WMC)",savewmcTooltipText:"Guardar el context de mapa web a un arxiu","saveWMCFile.windowTitle":"Guardar el context de mapa web (WMC)","saveWMCFile.errorSaveWMC":"No s'ha pogut guardar el context de mapa web (WMC)",loadwmcTooltipTitle:"Carregar un context de mapa web (WMC)",loadwmcTooltipText:"Carregar un context de mapa web des d'un arxiu en el mapa actual","selectWMCFile.windowTitle":"Carregar un context de mapa web (WMC)",selectWMCFile:"Seleccionar arxiu de context de mapa web (WMC)","selectWMCFile.waitLoadingWMC":"Carregant un context de mapa web (WMC)","selectWMCFile.loadButtonText":"Carregar","selectWMCFile.mergeButtonText":"Fusionar","selectWMCFile.errorLoadingWMC":"No ha estat possible carregar el context de mapa web (WMC)",opacityButtonText:"Opacitat",opacityWindowTitle:"Opacitat",metadataButtonText:"Metadada",removeButtonText:"Esborrar",addWMSButtonText:"Afegir WMS",addWMSWindowTitle:"Afegir capa d'un servei WMS","layerInfoPanel.windowTitle":"Metadades de la capa","layerInfoPanel.titleField":"Ttol","layerInfoPanel.descriptionField":"Descripci","layerInfoPanel.queryableField":"Consultable",layerList:"Llista de capes",baseLayerList:"Capes base",overlaysList:"Overlays","metadataResults.buttonText":"Resultats","metadataResults.tooltipTitle":"Resultats","metadataResults.tooltipText":"Anar a la pgina de resultats ","metadataResults.alertTitle":"Resultats","metadataResults.alertText":"Cap resultat a mostrar","featureInfoWindow.windowTitle":"Informaci d'entitat","mf.information":"Imprimir","mf.print.pdfReady":"PDF llest","loadLayer.loadingMessage":"Carregant capa","loadLayer.error.title":"Carregar capa","loadLayer.error.message":"La capa no s'ha pogut carregar","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Carregant...","disclaimer.buttonClose":"Tancar",gazetteerAddressField1Label:"Codi postal",gazetteerAddressField2Label:"Carrer",gazetteerAddressField3Label:"Lloc",gazetteerAddressField4Label:"Municipi",gazetteerAddressField5Label:"Portal",searchOptionButton:"Buscar",resetSearchForm:"Reinicialitzar el formulari de cerca.",GazetteerWindowTitle:"Buscar adrea",searchResults:"Resultats de la cerca",errorTitle:"Error",SearchOptionLoadFailureMsg:"No hi ha resultats. \n El servei potser no est disponible. \n",gazetteerTooltipTitle:"Cerca basada en adrea",gazetteerTooltipText:"Cerca per localitzaci, codi postal, carrer, municipi o lloc.",SearchOptionNoResults:"No s'ha trobat cap resultat",zoomlayerTooltipTitle:"Zoom a la capa",zoomlayerTooltipText:"Usi aquest bot per anar a l'extensi mxima de la capa seleccionada.","zoomlayer.selectLayerTitle":"Zoom a la capa","zoomlayer.selectLayerText":"Cap capa seleccionada",layerStylesWindowTitle:"Estils de capa",layerStylesPreviewTitle:"Previsualitzar llegenda",selectStyleButton:"Seleccionar estil",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Seleccionar una posici en el temps",WMSTimeMovieTitle:"Executar animaci",wmsTimeUpdateButtonText:"Aplicar",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Cerca completa de text",keyword:"Paraules clau",org:"Organitzaci",mapTypes:"Tipus de mapa",rsIdentifier:"Identificador de recurs",inspireSearchOptions:"criteris INSPIRE",inspireannex:"annex INSPIRE",inspirerelated:"Relacionat amb INSPIRE",inspirerelatedtt:"Conjunt de dades INSPIRE que informen sobre la conformitat respecte a les especificacions de dades",inspiretheme:"temes INSPIRE",inspireClassificationDataServices:"INSPIRE classification data services",serviceType:"Tipus de servei",serviceType_discovery:"Discovery Service (discovery)",serviceType_view:"View Service (view)",serviceType_transformation:"Transformation Service (transformation)",serviceType_invoke:"Invoke Spatial Data Service (invoke)",serviceType_other:"Other Services (other)",similarity:"Search accuracy",wkt:"geomentria WKT",simpleViewMode:"Simple view",spatialSearch:"Criteris espacials",mdChangeDate:"Data d'actualitzaci de la metadada",tempExtent:"Extensi temporal",creationDate:"Data de creaci",modificationDate:"Data de modificaci",publicationDate:"Data de publicaci",hitsPerPage:"Nmero per pgina",sortBy:"Ordenar per",relevance:"Rellevncia",options:"Opcions",title:"Ttol",changeDate:"Data d'actualitzaci",rating:"Rting",popularity:"Popularitat",scaleDesc:"Escala (desc)",scaleAsc:"Escala (asc)","abstract":"Resum",catalogue:"Catleg",group:"Grup",chooseGroup:"Seleccionar un grup",md:"Metadada",tpl:"Plantilla",category:"Categoria",advTextSearch:"Opcions avanades de cerca de text",eitherWords:"Almenys una de les paraules",exactPhrase:"Frase exacta",allWords:"Totes les paraules",withoutWords:"Sense les paraules",precise:"Precisa",imprecise:"Imprecisa",relationType:"Tipus de relaci",within:"dins",touches:"toca",crosses:"travessa",fullyOutsideOf:"completament fora",encloses:"cont",overlaps:"superposa",intersection:"intersecci",nearYou:"A prop",from:"Des de",to:"a",scaleNominator:"1: ",scale:"Escala",digital:"Digital",hardCopy:"Cpia en paper",download:"Descarregar",downloadable:"Descarregable",interactive:"Interactiu",resourceType:"Tipus de recurs",dataset:"Conjunt de dades",series:"Srie",service:"Servei",model:"Catleg d'entitats",spatialRepType:"Representaci espacial",video:"Vdeo",vector:"Vector",textTable:"Text, taula",tin:"Tin",stereoModel:"Model estreo",grid:"Raster",kind:"Tipus",enterGetCapURL:"Introdueixi la URL d'un GetCapabilities per enregistrar un nou servei.",edit:"Editar",duplicate:"Duplicar","delete":"Esborrar",createChild:"Crear fill",privileges:"Privilegis",privilegesTT:"Gestionar els privilegis per a l'accs pblic i per als grups de catleg.",categories:"Categories",otherActions:"Altres accions",permalinkInfo:"Paste link in email or IM",view:"Consultar",zoomTo:"Zoom a",saveXml:"Salvar com a XML",exportCsv:"Exportar (CSV)",exportZip:"Exportar (ZIP)",printSel:"Exportar (PDF)",printTT:"Imprimir. Obrir una nova pgina per imprimir.",newOwner:"Nou propietari",updateCategories:"Actualitzar categories",updatePrivileges:"Actualitzar privilegis",noneSelected:"Cap seleccionat",none:"cap",all:"tots",allInPage:"tots els de la pgina",select:"Seleccionar ",username:"usuari",password:"contrasenya",login:"Connexi",logout:"Desconnexi",administration:"Administraci",validationReport:"Informe de validaci",setStatus:"Estat de la metadada",status:"Estat",updateStatus:"Actualitzar estat",updateVersion:"Activar versionat",statusTT:"Canviar l'estat d'un registre segons la fase del seu cicle de vida",setVersioning:"Versionat de metadades",versioning:"Activar versionat",versioningTT:"Un cop activat, tots els canvis realitzats a la metadada es guardaran al repositoru SVN",items:"tems",item:"tem",thumbnails:"Miniatures",noimages:"Cap imatge disponible",add:"Afegir",small:"Petit",large:"Gran",selectImage:"Seleccionar una imatge",selectFile:"Seleccionar un arxiu",image:"Imatge",uploading:"Carregant ...",upload:"Carregar",success:"xit",failure:"Error",error:"Error",save:"Salvar",reset:"Reinicialitzar",fileProcessedMsg:" Arxiu ${res} processat al servidor",suggestion:"Suggeriment",logoSelect:"Seleccionar un logo",relatedResources:"Recursos relacionats",createLink:"Crear enllaos ...",featureCat:"Catleg d'entitats",serviceMd:"Metadada de servei",datasetMd:"Metadata de conjunt de dades",parentMd:"Metadada pare",updateChildren:"Actualitzar fills",records:"registres",record:"registre",help:"Ajuda",publishError:"La publicaci ha fallat.",outOfMemoryError:"Error de falta de memoria.",publishErrorCode:"Codi d'error: ",saveAndCheck:"Salvar i comprovar",saveAndClose:"Salvar i tancar",cancel:"Cancellar",layout:"Maquetaci",collapseAll:"Collapsar totes les seccions",editAttributes:"Gestionar attributs",chooseAType:"Escollir un tipus",chooseAView:"Escollir una vista",viewMode:"Mode vista",errorAndStatusMsg:"Error. Estat: ${status}, text: ${text}. Intenti-ho de nou.",mdEditor:"Editor de metadades",minorEditTT:"Do not update timestamp on save",editing:"Editant ${title} (${uuid})",GetCapabilitiesDocumentError:"Error intentant recuperar la informaci del servei (document GetCapabilities) de la URL: ",maxResults:"Nmero de resultats",mdTitle:"Ttol de la metadada",keywords:"Paraules clau",createRelation:"Crear relaci",createIfNotExistButton:"Crear una metadada nova",getCapabilitiesLayer:"Capes de GetCapabilities",layerName:"Nom de capa",searching:"Buscant ...",perThesaurus:" per tesaurus",anyThesaurus:"Tots els tesaurus",selectedKeywords:"Paraules clau seleccionades",foundKeywords:"Paraules clau disponibles",clear:"Esborrar",publish:"Publicar",publishTooltip:"Publicar el conjunt de dades actual al node remot. El conjunt de dades s'actualitzar en cas que ja sigui present.",publishSuccess:"Publicaci realitzada amb xit.",publishLayerAdded:" Capa afegida a la previsualitzaci del mapa.",unpublish:"Despublicar",unpublishTooltip:"Esborrar l'actual conjunt de dades del node remot.",unpublishSuccess:"Despublicaci realitzada amb xit.",unpublishError:"Error despublicant. ",check:"Comprovar",errorDatasetNotFound:"No s'ha trobat el conjunt de dades.",datasetFound:"S'ha trobat el conjunt de dades i s'ha afegit a la previsualitzaci del mapa ",checkFailure:"Error al comprovar el conjunt de dades en el node remot.",addOnlineSourceTitle:"Enllaar servei a la metadada",addOnlineSource:"Afegir enllaos",addOnlineSourceTT:"Afegir una secci de tipus onlinesource a la metadada actual per fer l'enlla als serveis WMS/WFS/WCS. Si el servei s WMS, la capa es pot mostrar al visor de mapes.",statusInformation:"Informaci de l'estat.",publishing:"Publicant ...",mapPreview:"Previsualitzaci del mapa",selectANode:"Seleccionar un node ...",geoPublisherWindowTitle:"Geo-publicaci: ",keywordSelectionWindowTitle:"Selecci de paraules clau",crsSelectionWindowTitle:"Selecci del sistema de coordenades de referncia",linkedMetadataSelectionWindowTitle:"Selecci de la metadada relacionada",NotOwnerError:"No disposa de privilegis per actualitzar el registre relacionat.",ServiceUpdateError:"Error durant l'actualitzaci de la metadada de servei",associateService:"Enllaar metadades d'un servei",associateDataset:"Enllaar metadades d'un conjunt de dades",logoSelectionWindow:"Esculli un logo",fileUploadWindow:"Carregar dades o document",selectedCRS:"Sistemes de coordenades seleccionats",foundCRS:"Sistemes de coordenades disponibles",search:"Buscar",restrictSearchToMap:"Restringir cerca a l'extensi del mapa",selected:"seleccionat",selectRegion:"Seleccionar una regi ...",drawRectangle:"Dibuixar un rectangle",drawPolygon:"Dibuixar un polgon",drawPolygonTT:"Clic al bot i desprs dibuixar un polgon fent clic en el mapa per cada punt. Doble clic per crear l'ltim punt del polgon.",drawCircle:"Dibuixar cercle",discovery:"Descobriment",visualization:"Visualitzaci",when:"Quan ?",anyTime:"A qualsevol moment",onSelection:"A la selecci",adminAction:"Altres",newMetadata:"Nova metadada",newMetadataTitle:"Crear una metadada escollint una plantilla i seleccionant un grup",tplTitle:"Descripci de la plantilla",metadatatype:"Tipus de recurs",process:"Processar",suggestions:"Suggeriments",applySelected:"Aplicar la tasca seleccionada",processParametersWindow:"Parmetres de la tasca",noSuggestion:"Cap suggeriment.",thumbnailUploadWindow:"Carrega miniatura",addThumbnail:"Afegir",createSmall:"Crear miniatura petita",scalingFactor:"Factor d'escala",smallScalingFactor:"Factor d'escala",type:"Tipus de registre",clickToClose:"Clic per tancar",removeSelected:"Esborrar els seleccionats",ownerName:"Propietari de la metadada",setPrivileges:"Definir privilegis",setCategories:"Definir categories",massiveOp:"Operaci batch ",prepareDownload:"Descarregar arxius",mdMenu:"Accions",deleteRecord:"Esborrar la metadada ?",deleteConfirm:"Est segur que vol esborrar aquesta metadada?",deleteRecordSuccess:"Metadada esborrada.",deleteRecordFailure:"Error a l'esborrar la metadada.",advancedSearchOptions:"Criteris avanats",relatedservices:"Serveis relacionats",relatedchildren:"Fills",relatedfcats:"Catleg d'entitats relacionat",relatedhasfeaturecat:"Conjunt de dades",relatedsources:"Source datasets",getMEF:"Exportar (ZIP)",metadataCategories:"Categories de la metadada",validityInfo:"Estat de la validaci: ",lastUpdate:"Lltima actualitzaci : ",importMetadata:"Importar metadada",validationStatus:"Estat de la validaci",valid:"Vlid",notValid:"No vlid",notDetermined:"Indeterminat",addToMap:"Afegir al mapa: ",downloadLink:"Descarregar: ",webLink:"Enlla Web: ",viewKml:"Obrir a GoogleEarth: ",layerTree:"Gestor de capes",mdResultsLayer:"Resultats de la cerca",printLayer:"Imprimir pgina",relatedservices:"Serveis relacionats",relatedparent:"Pare",relateddatasets:"Conjunt de dades relacionades",relatedchildren:"Fills",relatedrelated:"Enlla al catleg d'entitats o al conjunt de dades",delete19110Relation:"Esborra relaci amb el catleg d'entitats",newWindow:"Nova finestra",addAsXLink:"Afegir un element enllaat",contactSelectionWindowTitle:"Selecci dels contactes",selectedContacts:"Contactes seleccionats",foundContacts:"Disponible",contactRole:"Rol del contacte",mapNearYou:"Centrar el mapa a la seva localitzaci",errorChangeProtocol:"Esborrar el fitxer carregat abans de canviar el protocol d'un recurs online.",resultBy:" resultat(s) / ",subTemplateImport:"Importar un element al directori",xmlData:"XML",minorEdit:"Modificaci menor",minorEditTT:"",runASearch:"Executar una cerca.",focusOnAny:"Moure el cursor al camp de cerca de text.",hideSearchForm:"Amagar o mostrar el formulari de cerca.",switchMode:"Canviar el mode de visualitzaci.",resetSearchForm:"Reinicialitzar el formulari de cerca.",focusOnLogin:"Collocar el cursor sobre el formulari de connexi o desconnexi si esteu connectats.",openAdmin:"Administrar el catleg",displayInfoPanel:"Mostrar el panell d'informaci.",displayHelpPanel:"Mostrar aquesta ajuda.",SelectionWindowTitle:"Seleccionar del directori",found:"Registres trobats",selected:"Seleccionat",create:"Crear",feedbackcontactDetails:"les dades de contacte",feedbacknameInitials:"Nom, Inicial (s)",feedbackmale:"mascul",feedbackfemale:"femen",feedbackposition:"funci",feedbackorganization:"Organitzaci",feedbackphone:"telfon",feedbackemail:"E-mail",feedbackfeedback:"realimentaci",feedbackfunction:"funci",feedbackquestion:"Qesti",feedbackerror:"Error",feedbackremark:"observaci",feedbackcontact:"contacte",feedbackcategory:"categoria",feedbackmetadataContent:"Contingut de Metadades",feedbackdataContent:"contingut de les dades",feedbackserviceContent:"contingut dels serveis",feedbacksupport:"Suport",feedbackmapViewer:"Map Viewer",feedbacksearch:"Cercar",feedbackorganizations:"Organitzacions",feedbackcontentManagement:"Content Management",feedbackmetadataImport:"Importaci de Metadades",feedbackmetadataEdit:"edici de metadades",feedbackharvesting:"collita",feedbackvalidator:"Validator",feedbackother:"Si no s aix",feedbackremarks:"notes",feedbackmetadataData:"Metadades informaci",feedbacktitle:"Ttol",feedbackPanelTitle:"Amb aquest formulari pot donar la seva opini sobre metadades, dades i / o serveis.",feedbacksubmit:"Enviar",feedbackerrorTitle:"precauci",feedbackerrorMsg:"No s'ha pogut durant l'enviament. Torneu-ho a provar ms tard.",feedbackcancel:"Cancel",feedbackWindowTitle:"realimentaci","add-extent-from-geokeywordsreplace":"Reemplaar l'extensi existent","add-info-from-wmssetExtent":"Definir l'extensi","add-info-from-wmssetAndReplaceExtent":"Reemplaar l'extensi existent","add-info-from-wmssetCRS":"Indicar el sistema de coordenades de referncia","add-info-from-wmssetDynamicGraphicOverview":"Definir la vista predefinida (usant la URL de la petici GetMap)","add-info-from-wmswmsServiceUrl":"URL del servei","linked-data-checkerlinkUrl":"URL a suprimir","related-metadata-checkeruuidToRemove":"Identificador a esborrar","add-service-info-from-wxssetAndReplaceOperations":"Reemplaar operacions existents","add-service-info-from-wxswxsServiceUrl":"URL de servei",manageDirectories:"Gestionar directoris",directory:"Directori",thesaurusManager:"Gestor de tesaurus",Theme:"Tema",thesaurusFilePath:"Arxiu de tesaurus (.rdf)",ThesaurusName:"Nom de tesaurus",createThesaurusFromURL:"a partir d'una URL",createThesaurusFromRepository:"a partir d'un repositori",creationMode:"Crear",thesaurusFromRepository:"Tesaurus",externalThesaurusURL:"URL",thesaurusCreation:"Add a thesaurus",Type:"Tipus",Activated:"Activat",emptyThesaurus:"Nou tesaurus buit",thesaurusFromFile:"A partir d'un arxiu local",thesaurusFromURL:"A partir d'un arxiu remot (URL)",id:"Identificador",label:"Etiqueta",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Etiqueta",newDefinition:"Definici",selDirectoryTT:"Seleccioni un tipus de directori. Un directori agrupa tots els elements que tenen la mateixa arrel (per exemple. gmd:CI_ResponsibleParty s un directori de contactes)",privTplElTT:"Gestionar els privilegis de la selecci actual.",addTplElTT:"Afegir un element a partir d'un fragment d'XML. El directori dest es basa en l'element arrel (per exemple. gmd:CI_ResponsibleParty).",copyTplElTT:"Crear un nou element en el directori a partir de l'element seleccionat.",delTplElTT:"Esborrar la selecci del directori.",language:"Idioma",Home:"Pgina d'inici",Map:"Mapa",Poweredby:"Creat per",About:"Sobre",org:"Organitzaci",keyword:"paraula clau",when:"quan",advancedSearchOptions:"Opcions de cerca avanades",hitsPerPage:"Resultats per pgina",Searchforspatialdataon:"Buscar les dades espacials sobre",search:"cerca",fullTextSearch:"Cerca per text complet",reset:"reinicialitzar",resetSearchForm:"Reinicialitzar el formulari de cerca",Advanced:"Avanat",newWindow:"Nova finestra",mdEditor:"Editor de metadades",List:"Llista"};
OpenLayers.Util.extend(OpenLayers.Lang.ca,GeoNetwork.Lang.ca);
Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.de={previousPage:"Zur vorherigen Seite",nextPage:"Zur nchsten Seite",upInPage:"Blttern Sie nach oben in den Ergebnissen",downInPage:"Blttern Sie nach unten in den Ergebnissen",example:"Beispiel",helper:"Vorschlag",toggleLayerManager:"Kartenebenen-Manager anzeigen",tagName:"Elementname",enableTooltip:"Tooltips aktivieren, um mehr Informationen zu den Deskriptoren zu bekommen.",connectIssue:"Katalog Verbindungsproblem",connectIssueMsg:"Error 404. Keine Verbindung zum Katalog unter dieser URL",featureInfoTooltipTitle:"Objekteigenschaften anzeigen",featureInfoTooltipText:"Klicken Sie in die Karte um Informationen von allen aktuell sichtbaren Kartenebenen abzufragen.",zoomToMaxExtentTooltipTitle:"Gesamte Ausdehnung",zoomToMaxExtentTooltipText:"Verwenden Sie diese Taste um auf die gesamte Ausdehnung der Karte zu zoomen.",zoominTooltipTitle:"Vergrern",zoominTooltipText:"Ziehen Sie in der Karte ein Rechteck auf um die Karte auf diesen Bereich zu vergrern. Ein einfacher Klick vergrert die Karte um Faktor 2.",zoomoutTooltipTitle:"Verkleinern",zoomoutTooltipText:"Ziehen Sie in der Karte ein Rechteck auf um die Karte auf diesen Bereich zu verkleinern.",dragTooltipTitle:"Karte verschieben",dragTooltipText:"Verschieben Sie die Karte mit der linke Maustaste.",previousTooltipTitle:"Zu vorheriger ausdehnung",previosTooltipText:"Klicken Sie auf diese Taste um zur vorherigen Ausdehnung der Karte zurueckzukehren.",nextTooltipTitle:"Zu nchster Ausdehnung",nextTooltipText:"Klicken Sie diese Taste um zur nchsten Ausdehnung der Karte zur gelangen.",featureInfoTitle:"Objekteigenschaften anzeigen",layerManagerTabTitle:"Kartenebenen verwalten",legendTabTitle:"Legende",scaleTitle:"Skalieren",xTitle:"X",yTitle:"Y",projectionTitle:"Projektion",FeatureInfoNotQueryable:"Keine abfragbare Kartenebene vorhanden",WMSBrowserTab1:"Auswhlen",WMSBrowserTab3:"Extern",WMSBrowserPreviewTitle:"Vorschau der Kartenebene",WMSBrowserAddButton:"Hinzufgen",WMSBrowserDuplicateMsg:"Kartenebene existiert bereits in der Karte",WMSBrowserPreviewWaitMsg:"Lade Vorschaubild",WMSBrowserConnectButton:"Verbinden",WMSBrowserConnectError:"Fehler whrend dem Verbindungsaufbau zum Web Map Service bitte URL berprfen.",infoTitle:"Information","mf.print.mapTitle":"Titel","mf.print.comment":"Kommentar","mf.print.dpi":"Auflsung","mf.print.scale":"Skalierung","mf.print.rotation":"Winkel","mf.print.resetPos":"Zurcksetzen","mf.print.print":"Drucken","mf.print.generatingPDF":"PDF wird erzeugt","mf.print.unableToPrint":"Druckvorgang fehlgeschlagen bitte spter nochmals probieren","mf.error":"Fehler",selectExtentTooltipTitle:"Ausdehnung whlen",selectExtentTooltipText:"Ausdehnung fr Katalogsuche whlen",printTooltipTitle:"Drucken",printTooltipText:"Aktuelle Karte drucken",savewmcTooltipTitle:"Web-Map-Context speichern",savewmcTooltipText:"Web-Map-Context der aktuellen Karten in eine Datei abspeichern.","saveWMCFile.windowTitle":"Web-Map-Context speichern","saveWMCFile.errorSaveWMC":"Web-Map-Context konnte nicht gespeichert werden",loadwmcTooltipTitle:"Web-Map-Context laden",loadwmcTooltipText:"Web-Map-Context von einer Datei in die aktuelle Karte laden.","selectWMCFile.windowTitle":"Web-Map-Context laden",selectWMCFile:"Web-Map-Context Datei auswhlen","selectWMCFile.waitLoadingWMC":"Laden Web-Map-Context","selectWMCFile.loadButtonText":"Laden","selectWMCFile.mergeButtonText":"Zusammenfassen","selectWMCFile.errorLoadingWMC":"Web-Map-Context konnte nicht geladen werden",opacityButtonText:"Deckkraft",opacityWindowTitle:"Deckkraft",metadataButtonText:"Metadaten",removeButtonText:"Entfernen",addWMSButtonText:"WMS hinzufgen",addWMSWindowTitle:"WMS hinzufgen","layerInfoPanel.windowTitle ":"Metadaten der Kartenebene","layerInfoPanel.titleField ":"Titel","layerInfoPanel.descriptionField ":"Beschreibung","layerInfoPanel.queryableField ":"Abfragbar","layerList ":"Kartenebenen",baseLayerList:"Basis Kartenbene","metadataResults.buttonText ":"Metadaten Ergebnisse","metadataResults.tooltipTitle ":"Metadaten Ergebnisse","metadataResults.tooltipText ":"Gehe zur Metadaten Ergebnis Seite","metadataResults.alertTitle ":"Metadaten Ergebnisse","metadataResults.alertText ":"Keine Metadaten Ergebnisse vorhanden","featureInfoWindow.windowTitle":"Objekteigenschaften anzeigen","mf.information":"Drucken","mf.print.pdfReady":"PDF bereit","loadLayer.loadingMessage":"Kartenebene Ladevorgang","loadLayer.error.title":"Kartenebene Ladevorgang Fehlermeldung","loadLayer.error.message":"Kartenebene konnte nicht geladen werden","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Disclaimer Ladevorgang...","disclaimer.buttonClose":"Schlieen",gazetteerAddressField1Label:"Postleitzahl",gazetteerAddressField2Label:"Strae",gazetteerAddressField3Label:"Ort",gazetteerAddressField4Label:"Gemeinde",gazetteerAddressField5Label:"Hausnummer",searchOptionButton:"Suche",GazetteerWindowTitle:"Adresssuche",searchResults:"Suchergebnis",errorTitle:"Fehler",SearchOptionLoadFailureMsg:"Kein Ergebnis vorhanden.\n Service mglicherweise nicht erreichbar.\n",gazetteerTooltipTitle:"Adresssuche",gazetteerTooltipText:"Ort- Postleitzahl- Straenname- Gemeinde- oder Ortssuche.",SearchOptionNoResults:"Keine Ergebnisse gefunden",zoomlayerTooltipTitle:"Kartenebne vergrern",zoomlayerTooltipText:"Verwenden Sie diese Taste um die ausgewhlte Kartenebene in ihrer gesamten Ausdehnung zu sehen.","zoomlayer.selectLayerTitle":"Kartenebene vergrern","zoomlayer.selectLayerText":"Keine Kartenebene ausgewhlt",layerStylesWindowTitle:"Stil der Kartenebene",layerStylesPreviewTitle:"Vorschau Legende",selectStyleButton:"Whle Stil",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Whle einen Zeitpunkt",WMSTimeMovieTitle:"Animation abspielen",wmsTimeUpdateButtonText:"Anwenden",WMSTimeAnimationCheckbox:"Film abspielen mit den letzten ${steps} Zeitpunkten",fullTextSearch:"Volltextsuche",keyword:"Schlagwort",org:"Organisation",mapTypes:"Map types",rsIdentifier:"Resource identifier",inspireSearchOptions:"INSPIRE criteria",inspireannex:"INSPIRE annex",inspirerelated:"Bezug zu INSPIRE",inspirerelatedtt:"INSPIRE Datensatz mit Bericht ber die Konformitt in Bezug auf die Daten Spezifikation",inspiretheme:"INSPIRE Thema",inspireClassificationDataServices:"INSPIRE Einstufung Datendienste",serviceType:"Service-Typ",serviceType_discovery:"Discovery Service (Discovery)",serviceType_view:"View Service (Ansicht)",serviceType_transformation:"Transformation Service (Transformation)",serviceType_invoke:"Invoke Spatial Data Service (aufrufen)",serviceType_other:"Sonstige Dienstleistungen (sonstige)",similarity:"Suche Genauigkeit",wkt:"WKT-Geometrie",simpleViewMode:"Einfache Ansicht",spatialSearch:"Rumliche Kriterien",mdChangeDate:"Metadaten nderungsdatum",tempExtent:"Zeitlicher Umfang",creationDate:"Erstellungsdatum",modificationDate:"nderungsdatum",publicationDate:"Verffentlichung",hitsPerPage:"Treffer pro Seite",sortBy:"Sortieren nach",relevance:"Relevanz",options:"Optionen",title:"Titel",changeDate:"Datum ndern",rating:"Bewertung",popularity:"Popularitt",scaleDesc:"Mastab (ab)",scaleAsc:"Msstab (auf)","abstract":"Kurzbeschreibung",catalogue:"Katalog",group:"Gruppe",chooseGroup:"Whlen Sie eine Gruppe",md:"Metadaten",tpl:"Vorlage",category:"Kategorie",advTextSearch:"Erweiterte Suchmglichkeiten",eitherWords:"Eines der Wrter",exactPhrase:"Exakter Ausdruck",allWords:"Alle Worte",withoutWords:"Ohne diese Wrter",precise:"Przise",imprecise:"Ungenau",relationType:"Relation",within:"innerhalb",touches:"berhren",crosses:"kreuzen",fullyOutsideOf:"vollstndig auerhalb",encloses:"umschlieen",overlaps:"berschneiden",intersection:"kreuzen",nearYou:"In Ihrer Nhe",from:"von",to:"bis",scaleNominator:"1",scale:"Mastab",digital:"Digital",hardCopy:"Hardcopy",download:"Herunterladen",downloadable:"Herunterlandbar",interactive:"Interaktiv",resourceType:"Ressourcentyp",dataset:"Datensatz",series:"Serie",service:"Service",spatialRepType:"Rumliche Darstellung",video:"Video",vector:"Vektor",textTable:"Texttabelle",tin:"Tin",stereoModel:"Stereo-Modell",grid:"Gitter",kind:"Art",enterGetCapURL:"Geben Sie eine URL GetCapabilities um einen neuen Dienst zu registrieren.",edit:"Bearbeiten",duplicate:"Duplizieren","delete":"Lschen",createChild:"Erstellen Sie untergeordnete",privileges:"Rechte",categories:"Kategorien",otherActions:"Andere Aktionen",view:"Anzeigen",zoomTo:"Zoom auf",saveXml:"Speichern als XML",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Export (PDF)",printTT:"Drucken. ffnen Sie eine neue Seite zum Drucken.",newOwner:"Neuer Eigentmer",updateCategories:"Kategorien Aktualisieren",updatePrivileges:"Rechte Aktualisieren",noneSelected:"Nichts ausgewhlt",none:"keiner",all:"alle",allInPage:"auf einer Seite",select:"Whlen",username:"Benutzername",password:"Kennwort",login:"Login",logout:"Logout",administration:"Verwaltung",validationReport:"Validation Report",status:"Status",items:"Artikel",item:"Artikel",thumbnails:"Thumbnails",noimages:"Keine Bilder zum anzeigen",add:"Hinzufgen",small:"Klein",large:"Gro",selectImage:"Whlen Sie ein Bild",selectFile:"Whlen Sie eine Datei",image:"Bild",uploading:"Hochladen von ...",upload:"Laden",success:"Erfolg",failure:"Scheitern",error:"Fehler",save:"Speicher",reset:"Zurcksetzen",fileProcessedMsg:"Verarbeitete Datei $ {res} auf dem Server",suggestion:"Vorschlag",logoSelect:"Whlen Sie ein Logo",relatedResources:"Verwandte Ressourcen",createLink:"Verknpfungen erstellen ...",featureCat:"Feature-Katalog",serviceMd:"Service-Metadaten",datasetMd:"Datansatz Metadaten",parentMd:"Eltern-Metadaten",updateChildren:"Kinder Aktualisieren",records:"Aufzeichnungen",record:"Aufzeichnung",recordsFound:" record(s) found",help:"Hilfe",publishError:"Verffentlichung fehlgeschlagen.",outOfMemoryError:"Nicht gengend Speicher verfgbar.",publishErrorCode:"Fehlercode",saveAndCheck:"Speichern und berprfen",saveAndClose:"Speichern und schlieen",cancel:"Abbrechen",layout:"Layout",collapseAll:"Alle Abschnitte ausblenden",editAttributes:"Verwalten von Attributen",chooseAType:"Whlen Sie einen Typ",chooseAView:"Whlen Sie eine Ansicht",viewMode:"Modus anzeigen",errorAndStatusMsg:"Fehler. Status ${text}. Versuchen Sie es noch einmal.,",mdEditor:"Metadaten-Editor",minorEditTT:"Zeitstempel beim Speichern nicht aktualisieren",editing:"Bearbeiten von $ {title} ($ {uuid})",GetCapabilitiesDocumentError:"Fehler beim Laden Service GetCapabilities Dokument von URL",maxResults:"Anzahl der Ergebnisse",mdTitle:"Metadaten Titel",keywords:"Schlagwrter",createRelation:"Relation erstellen",createIfNotExistButton:"Erstellen Sie einen neuen Metadatensatz",getCapabilitiesLayer:"GetCapabilities Kartenebene",layerName:"Namen der Kartenebene",searching:"Suche ...",perThesaurus:"pro Thesaurus",anyThesaurus:"Jeder Thesaurus",selectedKeywords:"Ausgewhlte Schlagwrter",foundKeywords:"Verfgbare Schlagwrter",clear:"Lschen",publish:"Verffentlichen",publishTooltip:"Verffentlichen Sie aktuelle Datenbestand auf Remote-Knoten. Wenn der Datensatz bereits auf diesem Knoten verffentlicht wurde, wird er aktualisiert.",publishSuccess:"Erfolgreiche Verffentlichung.",publishLayerAdded:"Kartenebene zur Kartenvorschau hinzugefgt.",unpublish:"Verffentlichung zurcknehmen",unpublishTooltip:"Entfernen Sie die aktuellen Datensatz aus Remote-Knoten.",unpublishSuccess:"Verffentlichung erfolgreich zurckgenommen.",unpublishError:"Verffentlichung konnte nicht zrckgenommen werden.",check:"berprfen",errorDatasetNotFound:"Datensatz nicht gefunden.",datasetFound:"Datensatz gefunden und zur Kartenvorschay hinzugefgt.",checkFailure:"Datensatz auf Remote-Knoten kinnte nicht berprft werden.",addOnlineSourceTitle:"Link-Service fr Metadaten",addOnlineSource:"Links hinzufgen",addOnlineSourceTT:"Fgen Sie dem aktuellen Metadaten-Datensatz einen onlinesource Abschnitt hinzu, der auf die WMS/WFS/WCS Dienste verweist. Wenn der Dienst ist ein WMS ist, kann die Kartenebene in der Karte dargestellt werden.",statusInformation:"Statusinformationen.",publishing:"Wird verffentlich ...",mapPreview:"Karten-Vorschau",selectANode:"Whlen Sie einen Knoten ...",geoPublisherWindowTitle:"Geo-Verffentlichung",keywordSelectionWindowTitle:"Schlagwrter whlen",crsSelectionWindowTitle:"Koordinatenreferenzsystem whlen",linkedMetadataSelectionWindowTitle:"Verwandte Metadaten whlen",NotOwnerError:"Sie haben keine Berechtigung, um diese verwandten Datensatz zu aktualisieren.",ServiceUpdateError:"Fehler bei der Service-Metadaten-Update",associateService:"Link-Service-Metadaten",associateDataset:"Link-Datensatz-Metadaten",logoSelectionWindow:"Whlen Sie ein Logo",fileUploadWindow:"Hochladen von Daten oder Dokumenten",selectedCRS:"Ausgewhlte Koordinatensysteme",foundCRS:"Verfgbare Koordinatensysteme",search:"Suche",restrictSearchToMap:"Suche auf Ausdehnung der Karte begrenzen",selected:"ausgewhlt",selectRegion:"Whlen Sie eine Region ...",drawRectangle:"Rechteck zeichnen",drawPolygon:"Polygon zeichenen",drawPolygonTT:"Klicken Sie auf die Schaltflche und zeichnen Sie jeden Punkt eines Polygons durch Klicken auf die Karte. Doppelklicken Sie um den letzten Punkt zu zeichnen.",drawCircle:"Kreis zeichnen",discovery:"Entdecken",visualization:"Visualisierung",when:"Wann?",anyTime:"Jederzeit",onSelection:"Nach Auswahl",adminAction:"Andere",newMetadata:"Neue Metadaten",model:"Feature catalogue",newMetadataTitle:"Create a metadata by choosing a template and selecting one group",tplTitle:"Template description",metadatatype:"Ressource type",process:"Prozess",suggestions:"Vorschlge",applySelected:"bernehme Ausgewhltes",processParametersWindow:"Task-Parameter",noSuggestion:"Kein Vorschlag.",thumbnailUploadWindow:"Thumbnail hochladen",addThumbnail:"Hinzufgen",createSmall:"Neues Thumbnail erstellen",scalingFactor:"Skalierungsfaktor",smallScalingFactor:"Kleine Skalierungsfaktor",type:"Datensatzart",clickToClose:"Klicken um zu Schlieen",removeSelected:"Auswahl entfernen",ownerName:"Metadatensatz Besitzer",setPrivileges:"Rechte festlegen",setCategories:"Kategorien festlegen",massiveOp:"Batch-Betrieb",prepareDownload:"Herunterladen von Dateien",mdMenu:"Aktionen",deleteRecord:"Lschen der Metadaten?",deleteConfirm:"Sind Sie sicher, diese Metadaten Datensatz wirklich lschen?",deleteRecordSuccess:"Metadaten gelscht.",deleteRecordFailure:"Fehler beim Lschen der Metadaten.",advancedSearchOptions:"Erweiterte Kriterien",relatedservices:"Related Service",relatedchildren:"Kinder",relatedfcats:"In Verbindung stehende Feature-Katalog",relatedhasfeaturecat:"Datenstze",relatedsources:"Quelldatenstze",getMEF:"Export (ZIP)",metadataCategories:"Metadaten-Kategorien",validityInfo:"Validations-Status",lastUpdate:"Letzte Aktualisierung",importMetadata:"Import von Metadaten",validationStatus:"Validation Status",valid:"Gltig",notValid:"Nicht gltig",notDetermined:"Nicht bestimmt",addToMap:"Zur Karte hinzufgen",downloadLink:"Herunterladen",webLink:"Weblink",viewKml:"Mit GoogleEarth ffnen",layerTree:"Kartenebenen-Manager",mdResultsLayer:"Suchergebnisse",printLayer:"Seite drucken",relatedservices:"Zugehrige Dienste",relatedparent:"Elternteil",relateddatasets:"hnliche Datenstze",relatedchildren:"Kinder",relatedrelated:"Feature-Katalog / Datensatz Link",delete19110Relation:"Entferne Feature-Katalog Relation",newWindow:"Neues Fenster",addAsXLink:"Als verknpftes Element hinzufgen",contactSelectionWindowTitle:"Kontakt Auswahl",selectedContacts:"Ausgewhlte Kontakte",foundContacts:"Verfgbar",contactRole:"Kontakt-Rolle",mapNearYou:"Karten auf Ihren Standort zentrieren",errorChangeProtocol:"Entfernen Sie die hochgeladene Datei vor dem ndern des Protokolls einer Online-Ressource.",resultBy:"Ergebnis(se) /",subTemplateImport:"Directory-Eintrag Import",xmlData:"XML",minorEdit:"Kleine nderung",minorEditTT:"",runASearch:"Suchen ausfhren.",focusOnAny:"Volltextsuche Feld vorauswhlen.",hideSearchForm:"Suchformular ein-/ausblenden.",switchMode:"Visualisierung Modus ein-/ausblenden.",resetSearchForm:"Suchformular zurcksetzen.",focusOnLogin:"Whle Login-Formular aus um auf die Katalogverwaltung zuzugreifen oder melden Sie sich ab, wenn sie bereits angemeldet sind",openAdmin:"Zur Verwaltung",displayInfoPanel:"Informationspanel anzeigen.",displayHelpPanel:"Hilfe anzeigen.",SelectionWindowTitle:"Whlen Sie aus dem Verzeichnis",found:"Eintrge gefunden",selected:"Ausgewhlt",create:"Erstellen",feedbackcontactDetails:"Kontaktdaten",feedbacknameInitials:"Name, Initial(en)",feedbackmale:"mnnlich",feedbackfemale:"weiblich",feedbackposition:"Funktion",feedbackorganization:"Organisation",feedbackphone:"Telefon",feedbackemail:"E-mail",feedbackfeedback:"Rckkopplung",feedbackfunction:"Funktion",feedbackquestion:"Frage",feedbackerror:"Fehler",feedbackremark:"Bemerkung",feedbackcontact:"Kontakt",feedbackcategory:"Kategorie",feedbackmetadataContent:"Metadaten-Inhalt",feedbackdataContent:"Dateninhalt",feedbackserviceContent:"Service Content",feedbacksupport:"Untersttzung",feedbackmapViewer:"Map Viewer",feedbacksearch:"Suchen",feedbackorganizations:"Organisationen",feedbackcontentManagement:"Content Management",feedbackmetadataImport:"Importieren von Metadaten",feedbackmetadataEdit:"Metadaten bearbeiten",feedbackharvesting:"Ernte",feedbackvalidator:"Validator",feedbackother:"Sonst",feedbackremarks:"Aufzeichnungen",feedbackmetadataData:"Metadaten-Informationen",feedbacktitle:"Titel",feedbackPanelTitle:"Mit diesem Formular knnen Sie Feedback zu Metadaten, Daten und / oder Dienstleistungen.",feedbacksubmit:"Senden",feedbackerrorTitle:"Achtung",feedbackerrorMsg:"Ein Fehler beim Senden. Bitte versuchen Sie es spter erneut.",feedbackcancel:"Kndigen",feedbackWindowTitle:"Rckkopplung","add-extent-from-geokeywordsreplace":"Vorhandene Ausdehnung ersetzen","add-info-from-wmssetExtent":"Ausdehnung festlegen","add-info-from-wmssetAndReplaceExtent":"Vorhandene Ausdehnung ersetzen","add-info-from-wmssetCRS":"Koordinatenreferenzsystem festlegen","add-info-from-wmssetDynamicGraphicOverview":"Grafische bersicht festelegen (mit GetMap Anfrage-URL)","add-info-from-wmswmsServiceUrl":"Service-URL","linked-data-checkerlinkUrl":"URL um zu entfernen","related-metadata-checkeruuidToRemove":"Identifier um zu entfernen","add-service-info-from-wxssetAndReplaceOperations":"Vorhandene Operationen ersetzen","add-service-info-from-wxswxsServiceUrl":"Service-URL","manageDirectories ":"Verwalten von Verzeichnissen",directory:"Verzeichnis",thesaurusManager:"Thesaurus-Manager",Theme:"Thema",thesaurusFilePath:"Thesaurus-Datei (. RDF)",ThesaurusName:"Thesaurus-Namen",createThesaurusFromURL:"von URL",createThesaurusFromRepository:"von Thesaurus-Repository",creationMode:"Erstellen",thesaurusFromRepository:"Thesaurus",externalThesaurusURL:"URL",thesaurusCreation:"Thesaurus hinzufgen",Type:"Typ",Activated:"Aktiviert",emptyThesaurus:"Neuer leerer Thesaurus",thesaurusFromFile:"Von der lokaler Datei",thesaurusFromURL:"Von Remote-Datei (URL)",id:"Identifier",label:"Beschriftung",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Beschriftung",newDefinition:"Definition",selDirectoryTT:"Verzeichnisart auswhlen. In einer Verzeichnis-Gruppe haben alle Elemente den gleichen Wurzel-Element-Namen (z.B. ist gmd:CI_ResponsibleParty ein Kontakt-Verzeichnis)",privTplElTT:"Berechtigungen fr die aktuelle Auswahl verwalten.",addTplElTT:"Ein Element aus einer XML-Fragment in ein Verzeichnis einfgen. Das Zielverzeichnis basiert auf der Root-Element-Namen (z.B. gmd:CI_ResponsibleParty).",copyTplElTT:"Erstellen Sie einen neuen Eintrag in das Verzeichnis aus der aktuellen Auswahl.",delTplElTT:"Ausgewhlte Eintrag aus dem Verzeichnis entfernen.",Home:"Home",Map:"Karte",Poweredby:"Bereitgestellt von",About:"Uber",org:"Organisation",When:"Wenn",Where:"Wo",What:"Wass",Searchforspatialdataon:"Suche nach Geodaten ber",Advanced:"Erweitert",metadataPOC:"metadata point of contact",metadataPOCs:"Metadata point of contact",spatialRepresentationType:"spatial type",spatialRepresentationTypes:"Spatial types",createDateYear:"year",createDateYears:"Years",denominator:"scale denominator",denominators:"Scale denominators",orgName:"organization",orgNames:"Organizations",serviceTypes:"Service types",facetMore:"+ Show more",facetLess:"- Show less",List:"Liste",extractorTitle:"Download data from ",defineExtractionArea:"Define extraction area",chooseALayer:"Choose a layer",outputFormat:"Output format",dataDownload:"Download data",wfsVersion:"Service version","wxs-extract-service-not-found":"Error connecting to the service http://geonetwork-opensource.org/geonetwork-client. ${misc}.","wxs-extract-layer-not-found":"Layer ${layer} not found in WFS (http://geonetwork-opensource.org/geonetwork-client).",GML2:"GML 2",GML3:"GML 3",CSV:"Text CSV","SHAPE-ZIP":"ESRI Shapefile",xsd:"ISO schema",rules:"rules",rule:"rule","schematron-rules-geonetwork":"GeoNetwork validation","schematron-rules-iso":"ISO validation","schematron-rules-inspire":"INSPIRE validation","linklabel-application/vnd.ogc.wms_xml":"Add to map","linklabel-OGC:WMS":"Add to map","linklabel-OGC:WFS":"WFS link","linklabel-application/vnd.google-earth.kml+xml":"View in Google Earth","linklabel-application/zip":"Download","linklabel-WWW:DOWNLOAD-1.0-http--download":"Download","linklabel-application/x-compressed":"Download","linklabel-text/html":"Web link","linklabel-text/plain":"Web link","linklabel-image/png":"Image link","linklabel-":"Link"};
OpenLayers.Util.extend(OpenLayers.Lang.de,GeoNetwork.Lang.de);
Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.en={Autofill:"Autofill","Data for download":"Data for download",E_inspireannex:"INSPIRE annex",E_inspirerelated:"Related to INSPIRE",E_inspiretheme:"INSPIRE theme",E_orgName:"Organisation",E_serviceType:"Service type",E_template:"Kind",E_themekey:"Keyword",E__owner:"Owner #",E_relation:"Spatial relation",E__isHarvested:"Harvested metadata",E_isPublishedToAll:"Published/unpublished metadata facet",FeatureInfoNotQueryable:"There is no queryable map layer",GazetteerWindowTitle:"Search for address",GetCapabilitiesDocumentError:"Error loading service GetCapabilities document from URL: ","Login.error":"Bad login","Login.error":"Error on Login","Login.error.message":"Login failed. Check your username and password.","Login.error.message":"The username or password you entered is incorrect","No direct download":"No direct data access (contact point)",NotOwnerError:"You don't have privileges to update this related record.","Online data":"Online data",Preview:"Preview",SearchOptionLoadFailureMsg:"No results available. \n The service may be unavailable. \n",SearchOptionNoResults:"No results found",ServiceUpdateError:"Error during service metadata update",WMSBrowserAddButton:"Add",WMSBrowserConnectButton:"Connect",WMSBrowserConnectError:"There was an error connecting to the Web Map Service, please check the URL.",WMSBrowserDuplicateMsg:"Layer is already in the map",WMSBrowserPreviewTitle:"Preview layer",WMSBrowserPreviewWaitMsg:"Retrieving preview image",WMSBrowserTab1:"Select",WMSBrowserTab3:"External",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",WMSTimeMovieTitle:"Play animation",WMSTimePositionTitle:"Pick a time position",WMSTimeWindowTitle:"WMS Time","abstract":"Abstract",add:"Add",addAsXLink:"Add as linked element",addOnlineSource:"Add links",addOnlineSourceTT:"Add an onlinesource section to the current metadata record pointing to the WMS/WFS/WCS services. If the service is a WMS, the layer could be displayed in the map viewer.",addOnlineSourceTitle:"Link service to metadata",addThumbnail:"Add",addToMap:"Add to map: ",addWMSButtonText:"Add WMS",addWMSWindowTitle:"Add layer from a WMS service",adminAction:"Other",administration:"Administration",advTextSearch:"Advanced text search options",advancedSearchOptions:"Advanced Search Options",all:"all",allInPage:"all in page",allWords:"All of the words",anyThesaurus:"Any thesaurus",anyTime:"Anytime",applySelected:"Apply selected task",associateDataset:"Link dataset metadata",associateService:"Link service metadata","autofill.tooltip":"Fill conditional and ordered elements that do not exist in the metadata",baseLayerList:"Base layers",cancel:"Cancel","cancel.tooltip":"Exit the edit area without saving",catalogue:"Catalogue",categories:"Categories",category:"Category",changeDate:"Change date",check:"Check",checkFailure:"Failed to check dataset in remote node.",chooseAType:"Choose a type",chooseAView:"Choose a view",chooseGroup:"Select a group",clear:"Clear",clearExtentTooltipText:"Remove extent (ie. no spatial criteria)",clearExtentTooltipTitle:"Remove extent",clickToClose:"Click to close",collapseAll:"Collapse all sections",connectIssue:"Catalogue connection issue",connectIssueMsg:"Error 404. Can't connect to catalogue at url ",contactRole:"Contact role",contactSelectionWindowTitle:"Contact selection",createChild:"Create child",createIfNotExistButton:"Create a new metadata record",createLink:"Create links ...",createRelation:"Create relation",createSmall:"Create small thumbnail",creationDate:"Creation date",crosses:"crosses",crsSelectionWindowTitle:"Coordinate reference system selection",dataset:"Dataset",datasetFound:"Dataset found and added to the map preview.",datasetMd:"Dataset metadata",dateType:"Date type","delete":"Delete",delete19110Relation:"Remove feature catalogue relation",deleteConfirm:"Are you sure to delete this metadata record?",deleteRecord:"Delete metadata record ?",deleteRecordFailure:"Error when deleting metadata record.",deleteRecordSuccess:"Metadata deleted.",digital:"Digital","disclaimer.buttonClose":"Close","disclaimer.loading":"Loading...","disclaimer.windowTitle":"Disclaimer",discovery:"Discovery",downInPage:"Scroll down in the results",download:"Download",downloadLink:"Download: ",downloadable:"Download",dragTooltipText:"Press the left mouse button to drag the map.",dragTooltipTitle:"Pan map",drawCircle:"Draw circle",drawPolygon:"Draw polygon",drawPolygonTT:"Click the button and draw a polygon by clicking on the map for each points. Double click to create polygon last points.",drawRectangle:"Draw rectangle",duplicate:"Duplicate",edit:"Edit",editAttributes:"Manage attributes",editing:"Editing ${title} (${uuid})",eitherWords:"Either of the words",enableTooltip:"Enable tooltips to get more information about each descriptors.",encloses:"encloses",enterGetCapURL:"Enter a GetCapabilities URL to register a new service.",error:"Error",errorAndStatusMsg:"Error. Status: ${status}, text: ${text}. Try again.",errorChangeProtocol:"Remove uploaded file before changing protocol of an online resource.",errorDatasetNotFound:"Dataset not found.",errorTitle:"Error",exactPhrase:"Exact phrase",example:"Example:",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",facetprotocol:"Online Resource",facetprotocols:"Online Resources",failure:"Failure",featureCat:"Feature catalogue",featureInfoTitle:"Feature info",featureInfoTooltipText:"Click in the map to get feature info from all visible layers.",featureInfoTooltipTitle:"Feature info","featureInfoWindow.windowTitle":"Feature info",fileProcessedMsg:"Processed file ${res} on the server",fileUploadWindow:"Upload data or document",foundCRS:"Available coordinate systems",foundContacts:"Available",foundKeywords:"Available keywords",from:"From",fullTextSearch:"Full text search",fullyOutsideOf:"fullyOutsideOf",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"Municipality",gazetteerAddressField5Label:"House number",gazetteerTooltipText:"Search for a location, based on postcode, street name, municipality or place.",gazetteerTooltipTitle:"Search based on an address",geoPublisherWindowTitle:"Geo-publication: ",getCapabilitiesLayer:"GetCapabilities layer",getMEF:"Export (ZIP)",grid:"Grid",group:"Group",hardCopy:"Hard copy",help:"Help",helper:"Suggestion:",hideBigMap:"Hide Big Map and Show Results",hitsPerPage:"Hits per page",image:"Image",importMetadata:"Import metadata",imprecise:"Imprecise",infoTitle:"Information",inspireClassificationDataServices:"INSPIRE classification data services",inspireSearchOptions:"INSPIRE criteria",inspireannex:"INSPIRE annex",inspirerelated:"Related to INSPIRE",inspirerelatedtt:"INSPIRE dataset with report on the conformity regarding the data specification",inspiretheme:"INSPIRE theme",interactive:"Interactive",intersection:"intersection",item:"item",items:"items",keyword:"Keyword",keywordSelectionWindowTitle:"Keywords selection",keywords:"Keywords",kind:"Kind",large:"Large",lastUpdate:"Last update: ","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Queryable","layerInfoPanel.titleField":"Title","layerInfoPanel.windowTitle":"Layer metadata",layerList:"Layer list",layerManagerTabTitle:"Layer management",layerName:"Layer name",layerStylesPreviewTitle:"Preview legend",layerStylesWindowTitle:"Layer styles",layerTree:"Layer manager",layout:"Layout",legendTabTitle:"Legend",licenses:"Licenses",linkedMetadataSelectionWindowTitle:"Related metadata selection","loadLayer.error.message":"The layer could not be loaded","loadLayer.error.title":"Load layer","loadLayer.loadingMessage":"Loading layer",loadwmcTooltipText:"Loads web map context in current map",loadwmcTooltipTitle:"Load web map context",login:"Login",logoSelect:"Select a logo",logoSelectionWindow:"Choose a logo",logout:"Logout",mapNearYou:"Center map on your location",mapPreview:"Map preview",mapTypes:"Map types",massiveOp:"Batch operation ",maxResults:"Number of results",md:"Metadata",mdChangeDate:"Metadata change date",mdEditor:"Metadata editor",mdMenu:"Actions",mdResultsLayer:"Search results",mdTitle:"Metadata title",metadataButtonText:"Metadata",metadataCategories:"Metadata categories","metadataResults.alertText":"No metadata results to show","metadataResults.alertTitle":"Metadata results","metadataResults.buttonText":"Metadata results","metadataResults.tooltipText":"Go to metadata results page","metadataResults.tooltipTitle":"Metadata results",metadatatype:"Ressource type","mf.error":"Error","mf.information":"Print","mf.print.comment":"Comment","mf.print.dpi":"Resolution","mf.print.generatingPDF":"Generating PDF","mf.print.mapTitle":"Title","mf.print.pdfReady":"PDF ready","mf.print.print":"Print","mf.print.resetPos":"Reset","mf.print.rotation":"Angle","mf.print.scale":"Scale","mf.print.unableToPrint":"It was not possible to print, try later",minorEdit:"Minor edit",minorEditTT:"",minorEditTT:"Do not update timestamp on save",model:"Feature catalogue",modificationDate:"Modification date",nearYou:"Near you",newMetadata:"New metadata",newMetadataTitle:"Create a metadata by choosing a template and selecting one group",newOwner:"New owner",newWindow:"New window",nextPage:"Move to next page",nextTooltipText:"Click this button to go to the next map extent",nextTooltipTitle:"Next map extent",noInfo:"No information",noSuggestion:"No suggestion.",noimages:"No images to display",none:"none",noneSelected:"None selected",notDetermined:"Not determined",notValid:"Not valid",onSelection:"On selection",opacityButtonText:"Opacity",opacityWindowTitle:"Opacity",options:"Options",org:"Organisation",otherActions:"Other actions",outOfMemoryError:"Out of memory error.",overlaps:"overlaps",overlaysList:"Overlays",ownerName:"Metadata record owner",parentMd:"Parent metadata",password:"password",perThesaurus:" per thesaurus",permalinkInfo:"Paste link in email or IM",popularity:"Popularity",precise:"Precise",prepareDownload:"Download files",previosTooltipText:"Click this button to go back to the previous map extent",previousPage:"Move to previous page",previousTooltipTitle:"Previous map extent",printLayer:"Print page",printSel:"Export (PDF)",printTT:"Print. Open a new page for printing.",printTooltipText:"Print the current map",printTooltipTitle:"Print",privileges:"Privileges",privilegesTT:"Manage record privileges for Internet and all catalogue groups.",process:"Process",processParametersWindow:"Task parameters",projectionTitle:"Projection",publicationDate:"Publication date",publish:"Publish",publishError:"Publication failed.",publishErrorCode:"Error code:",publishLayerAdded:" Layer added to map preview.",publishSuccess:"Successful publication.",publishTooltip:"Publish current dataset to remote node. If dataset is already publish in that node, it will be updated.",publishing:"Publishing ...",rating:"Rating",record:"record",records:"records",recordsFound:" record(s) found",relatedResources:"Related resources",relatedchildren:"Children",relatedchildren:"Children",relateddatasets:"Related datasets",relatedfcats:"Related feature catalogue",relatedhasfeaturecat:"Datasets",relatedparent:"Parent",relatedrelated:"Feature catalogue/dataset link",relatedservices:"Related service",relatedservices:"Related services",relatedsources:"Source datasets",relationType:"Relation type",relevance:"Relevance",removeButtonText:"Remove",removeSelected:"Remove selected",reset:"Reset","reset.tooltip":"Remove the unsaved changes",resetSearchForm:"Reset search form values.",resourceType:"Resource type",restrictSearchToMap:"Restrict search to map extent",resultBy:" result(s) / ",rsIdentifier:"Resource identifier",save:"Save","save.tooltip":"Save the created metadata",saveAndCheck:"Save and check","saveAndCheck.tooltip":"Save the created metadata and perform validation",saveAndClose:"Save and close","saveAndClose.tooltip":"Save the created metadata and close the edit area",saveRdf:"Save as RDF","saveWMCFile.errorSaveWMC":"Could not save Web Map Context","saveWMCFile.windowTitle":"Save Web Map Context",saveXml:"Save as XML",savewmcTooltipText:"Saves web map context for current map",savewmcTooltipTitle:"Save web map context",scale:"Scale",scaleAsc:"Scale (asc)",scaleDesc:"Scale (desc)",scaleNominator:"1:",scaleTitle:"Scale",scalingFactor:"Scaling factor",search:"Search",searchOptionButton:"Search",searchResults:"Search results",searching:"Searching ...",select:"Select ",selectANode:"Select a node ...",selectExtentTooltipText:"Select extent for catalog searches and choose 1 of the area filters",selectExtentTooltipTitle:"Select extent",selectFile:"Select a file",selectImage:"Select an image",selectRegion:"Select a region ...",selectStyleButton:"Select style",selectWMCFile:" ","selectWMCFile.errorLoadingWMC":"Could not load Web Map Context","selectWMCFile.loadButtonText":"Load","selectWMCFile.mergeButtonText":"Merge","selectWMCFile.waitLoadingWMC":"Loading Web Map Context","selectWMCFile.windowTitle":"Load Web Map Context",selected:"selected",selectedCRS:"Selected coordinate systems",selectedContacts:"Selected contacts",selectedKeywords:"Selected keywords",series:"Series",service:"Service",serviceMd:"Service metadata",serviceType:"Service type",serviceType_discovery:"Discovery Service (discovery)",serviceType_download:"Download Service (download)",serviceType_invoke:"Invoke Spatial Data Service (invoke)",serviceType_other:"Other Services (other)",serviceType_transformation:"Transformation Service (transformation)",serviceType_view:"View Service (view)",setCategories:"Set categories",setPrivileges:"Set privileges",setStatus:"Metadata status",setVersioning:"Metadata versioning",similarity:"Search accuracy",simpleViewMode:"Simple view",small:"Small",smallScalingFactor:"Small scaling factor",sortBy:"Sort by",spatialRepType:"Spatial representation",spatialSearch:"Spatial criteria",status:"Status",statusInformation:"Status information.",statusTT:"Change the status of a record according to its life cycle phase",stereoModel:"Stereo model",subTemplateImport:"Directory entry import",success:"Success",suggestion:"Suggestion",suggestions:"Suggestions",tagName:"Element name:",tempExtent:"Temporal extent",textTable:"Text, table",thumbnailUploadWindow:"Upload thumbnail",thumbnails:"Thumbnails",tin:"Tin",title:"Title",to:"To",toggleLayerManager:"Display map layer manager",touches:"touches",tpl:"Template",tplTitle:"Template description",type:"Record type","type.tooltip":"Change record type to create a template",unpublish:"Unpublish",unpublishError:"Unpublication failed. ",unpublishSuccess:"Successful unpublication.",unpublishTooltip:"Remove current dataset from remote node.",upInPage:"Scroll up in the results",updateCategories:"Update categories",updateChildren:"Update children",updatePrivileges:"Update privileges",updateStatus:"Update status",updateVersion:"Activate versioning",upload:"Upload",uploading:"Uploading ...",username:"User name",valid:"Valid",validateWfs:"WFS validation",validateWms:"WMS validation",validationReport:"Validation report",validationStatus:"Validation status",validityInfo:"Validation status: ",vector:"Vector",versioning:"Start versioning",versioningTT:"Once activated, all changes in the metadata record will be recorded in SVN repository",video:"Video",view:"View",viewKml:"Open in GoogleEarth: ",viewMode:"View mode","viewMode.tooltip":"change the presentation of the metadata",visualization:"Visualization",webLink:"Web link: ",when:"When ?",within:"within",withoutWords:"Without the words",wkt:"WKT geometry",wmsTimeUpdateButtonText:"Apply",xTitle:"X",xmlData:"XML",yTitle:"Y",zoomTo:"Zoom to",zoomToMaxExtentTooltipText:"Use this button to go to the full extent of the map.",zoomToMaxExtentTooltipTitle:"Full extent",zoominTooltipText:"Draw a box in the map to zoom in. You can also click in the map and map will zoom in by a factor of 2.",zoominTooltipTitle:"Zoom in","zoomlayer.selectLayerText":"No layer selected","zoomlayer.selectLayerTitle":"Zoom to layer",zoomlayerTooltipText:"Use this button to go to the full extent of the selected layer.",zoomlayerTooltipTitle:"Zoom to layer",zoomoutTooltipText:"Click in the map or draw a box to zoom out.",zoomoutTooltipTitle:"Zoom out",runASearch:"Run a search.",focusOnAny:"Move focus to the full text search field.",hideSearchForm:"Hide or display search form.",switchMode:"Switch visualization mode.",focusOnLogin:"Focus on the login form to access catalogue administration or logout if already logged in.",openAdmin:"Go to administration",displayInfoPanel:"Display the information panel.",displayHelpPanel:"Display this help.",SelectionWindowTitle:"Select from directory",found:"Records found",selected:"Selected",create:"Create",feedbackcontactDetails:"Contact data",feedbacknameInitials:"Name, Initial(s)",feedbackmale:"male",feedbackfemale:"female",feedbackposition:"Position",feedbackorganization:"Organization",feedbackphone:"Phone",feedbackemail:"Email",feedbackfeedback:"Feedback",feedbackfunction:"Function",feedbackquestion:"Question",feedbackerror:"Error",feedbackremark:"Remark",feedbackcontact:"Contact",feedbackcategory:"Category",feedbackmetadataContent:"Metadata contents",feedbackdataContent:"Data contents",feedbackserviceContent:"Service contents",feedbacksupport:"Support",feedbackmapViewer:"Map viewer",feedbacksearch:"Search",feedbackorganizations:"Organizations",feedbackcontentManagement:"Content management",feedbackmetadataImport:"Metadata import",feedbackmetadataEdit:"Metadata editing",feedbackharvesting:"Harvesting",feedbackvalidator:"Validator",feedbackother:"Other",feedbackremarks:"Remarks",feedbackmetadataData:"Metadata data",feedbacktitle:"Title",feedbackPanelTitle:"With this form you can give feedback on metadata, data and/or services.",feedbacksubmit:"Send",feedbackerrorTitle:"Attention",feedbackerrorMsg:"An error has occurred when sending. Please try again later.",feedbackcancel:"Cancel",feedbackWindowTitle:"feedback","add-extent-from-geokeywordsreplace":"Replace existing extent","add-info-from-wmssetExtent":"Set extent","add-info-from-wmssetAndReplaceExtent":"Replace existing extent","add-info-from-wmssetCRS":"Set coordinate reference system","add-info-from-wmssetDynamicGraphicOverview":"Set graphic overview (using GetMap request URL)","add-info-from-wmswmsServiceUrl":"Service URL","linked-data-checkerlinkUrl":"URL to remove","related-metadata-checkeruuidToRemove":"Identifier to remove","add-service-info-from-wxssetAndReplaceOperations":"Replace existing operations","add-service-info-from-wxswxsServiceUrl":"Service URL",manageDirectories:"Manage directories",directory:"Directory",thesaurusManager:"Thesaurus manager",Theme:"Theme",thesaurusFilePath:"Thesaurus file (.rdf)",ThesaurusName:"Thesaurus name",createThesaurusFromURL:"from URL",createThesaurusFromRepository:"from thesaurus repository",creationMode:"Create",thesaurusFromRepository:"Thesaurus",externalThesaurusURL:"URL",thesaurusCreation:"Add a thesaurus",Type:"Type",Activated:"Activated",emptyThesaurus:"New empty thesaurus",thesaurusFromFile:"From local file",thesaurusFromURL:"From remote file (URL)",id:"Identifier",label:"Label",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Label",newDefinition:"Definition",selDirectoryTT:"Select a type of directory. A directory group all elements having the same root element name (eg. gmd:CI_ResponsibleParty is a contact directory)",privTplElTT:"Manage privileges for the current selection.",addTplElTT:"Add an element from an XML fragment to a directory. The destination directory is based on the root element name (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Create a new entry in the directory from the current selection.",delTplElTT:"Remove selected entry from the directory.",language:"Language",removeFilter:"Remove",metadataPOC:"metadata point of contact",metadataPOCs:"Metadata point of contact",spatialRepresentationType:"spatial type",spatialRepresentationTypes:"Spatial types",createDateYear:"year",createDateYears:"Years",denominator:"scale denominator",denominators:"Scale denominators",orgName:"organization",orgNames:"Organizations",types:"Resource types",serviceTypes:"Service types",Home:"Home",Map:"Map",Poweredby:"Powered by",About:"About",Searchforspatialdataon:"Search for spatial data on",Advanced:"Advanced",facetMore:"+ Show more",facetLess:"- Show less",org:"Organisation",When:"When",Where:"Where",E_geometry:"Where",What:"What",List:"List",extractorTitle:"Download data from ",defineExtractionArea:"Define extraction area",chooseALayer:"Choose a layer",outputFormat:"Output format",dataDownload:"Download data",wfsVersion:"Service version","wxs-extract-service-not-found":"Error connecting to the service http://geonetwork-opensource.org/geonetwork-client. ${misc}.","wxs-extract-layer-not-found":"Layer ${layer} not found in WFS (http://geonetwork-opensource.org/geonetwork-client).",GML2:"GML 2",GML3:"GML 3",CSV:"Text CSV","SHAPE-ZIP":"ESRI Shapefile",xsd:"ISO schema",rules:"rules",rule:"rule","schematron-rules-geonetwork":"GeoNetwork validation","schematron-rules-iso":"ISO validation","schematron-rules-inspire":"INSPIRE validation","linklabel-application/vnd.ogc.wms_xml":"Add to map","linklabel-download":"Web link","linklabel-OGC:WMS":"Add to map","linklabel-OGC:WFS":"WFS link","linklabel-application/vnd.google-earth.kml+xml":"View in Google Earth","linklabel-application/zip":"Download","linklabel-WWW:DOWNLOAD-1.0-http--download":"Download","linklabel-application/x-compressed":"Download","linklabel-text/html":"Web link","linklabel-text/plain":"Web link","linklabel-image/png":"Image link","linklabel-website":"Web link","linklabel-":"Link",BROWSE:"BROWSE","SEARCH RESULTS":"SEARCH RESULTS",Map:"MAP",cookies:"Cookies","cookies.warning":"<p>This website uses cookies. A cookie is a small file sent with the pages of this website and stored by your browser on your hard disk or in the memory of your computer.</p><p>Cookies on this website are used for login purposes and to analyze your use of our website, so we can customize functionalities thereon. They will never be used to track users.</p>","template.FULL":"Advanced View","template.THUMBNAIL":"Thumbnail View","template.SIMPLE":"Simple View",RatingText:"Add your review",addLayer:"Add layer to map","WMTS.error.message":"Can not add to map due to invalid capabilities document.","metadata.notFound":"The metadata you are trying to access does not exist or you don't have enough permission to visualize it.",E_any_OR_geokeyword_OR_title_OR_keyword:"Free text",inspirecategory:"Marked for INSPIRE",yes:"Yes",areafilter_only_regional:"Regional only",areafilter_regional_and_national:"Regional + national",areafilter_national:"National only",areafilter_label:"Area filter"};
OpenLayers.Util.extend(OpenLayers.Lang.en,GeoNetwork.Lang.en);
Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.es={previousPage:"Volver a la pgina anterior",nextPage:"Ir a la pgina siguiente",upInPage:"Desplazarse hacia arriba en los resultados",downInPage:"Desplcese hacia abajo en los resultados",example:"Ejemplo",helper:"Propuesta",toggleLayerManager:"Mostrar gestor de capas del mapa",tagName:"Nombre del elemento",enableTooltip:"Habilitar informacin sobre las herramientas para obtener informacin adicional.",connectIssue:"Problema en la conexin con el catlogo",connectIssueMsg:"Error 404. No se puede conectar con el catlogo de la URL",featureInfoTooltipTitle:"Propiedades de los objetos",featureInfoTooltipText:"Haga clic en el mapa para obtener informacin de todas las capas visibles en la actualidad de los datos a la consulta.",zoomToMaxExtentTooltipTitle:"Extensin total",zoomToMaxExtentTooltipText:"Utilice esta tecla para toda la extensin del mapa para ampliarlo.",zoominTooltipTitle:"Acercar",zoominTooltipText:"Arrastre un rectngulo en el mapa el mapa para acercar a esa zona. Un simple clic ampla la zona en un factor de 2",zoomoutTooltipTitle:"Reducir",zoomoutTooltipText:"Arrastre un rectngulo en el mapa el mapa para alejar a esta rea.",dragTooltipTitle:"Mover el mapa",dragTooltipText:"Mover el mapa con el botn izquierdo del ratn.",previousTooltipTitle:"Vista previa",previosTooltipText:"Haga clic en este botn para volver a la vista anterior del mapa.",nextTooltipTitle:"Vista siguiente",nextTooltipText:"Haga clic en el botn para ver la vista siguiente del mapa.",featureInfoTitle:"Propiedades de los objetos",layerManagerTabTitle:"Gestionar las capas de datos",legendTabTitle:"Leyenda",scaleTitle:"Escala",xTitle:"X",yTitle:"Y",projectionTitle:"Proyeccin",FeatureInfoNotQueryable:"No hay datos disponibles de la capas consultables",WMSBrowserTab1:"Seleccionar",WMSBrowserTab3:"Externo",WMSBrowserPreviewTitle:"Vista previa de datos de capa",WMSBrowserAddButton:"Aadir",WMSBrowserDuplicateMsg:"La capa que ya existe en el mapa",WMSBrowserPreviewWaitMsg:"Previsualizando imagen previa",WMSBrowserConnectButton:"Conectar",WMSBrowserConnectError:"Error al conectar con el servicio de mapas web, por favor verifique el URL.",infoTitle:"Informacin","mf.print.mapTitle":"Ttulo","mf.print.comment":"Comentario","mf.print.dpi":"Resolucin","mf.print.scale":"Escala","mf.print.rotation":"ngulo","mf.print.resetPos":"Limpiar","mf.print.print":"Imprimir","mf.print.generatingPDF":"Creando PDF","mf.print.unableToPrint":"No se pudo imprimir, por favor intntelo ms tarde","mf.error":"Error",selectExtentTooltipTitle:"Seleccionar extensin del mapa",selectExtentTooltipText:"Seleccionar la extensin del mapa para las bsquedas en el catlogo",printTooltipTitle:"Imprimir",printTooltipText:"Imprimir mapa actual",savewmcTooltipTitle:"Guardar el contexto de mapa web",savewmcTooltipText:"Guardar el contexto de mapa web en un archivo.","saveWMCFile.windowTitle":"Guardar el contexto de mapa web","saveWMCFile.errorSaveWMC":"No se pudo guardar el contexto de mapa web",loadwmcTooltipTitle:"Carga el contexto de mapa web",loadwmcTooltipText:"Carga el contexto de mapa web desde un archivo en el mapa actual.","selectWMCFile.windowTitle":"Contexto de mapa web",selectWMCFile:"Seleccionar archivo de contexto de mapa web ","selectWMCFile.waitLoadingWMC":"Web Map Context Laden","selectWMCFile.loadButtonText":"Tienda","selectWMCFile.mergeButtonText":"Resumir","selectWMCFile.errorLoadingWMC":"Web Map Context no se pudo cargar",opacityButtonText:"Opacidad",opacityWindowTitle:"Opacidad",metadataButtonText:"Metadatos",removeButtonText:"Quitar",addWMSButtonText:"Aadir WMS",addWMSWindowTitle:"Aadir WMS","layerInfoPanel.windowTitle ":"Los datos de metadatos capa de","layerInfoPanel.titleField ":"Ttulo","layerInfoPanel.descriptionField ":"Descripcin","layerInfoPanel.queryableField ":"Interrogable","layerList ":"Datos de la lista de capas",baseLayerList:"Las capas de datos bsicos","metadataResults.buttonText ":"Resultados de metadatos","metadataResults.tooltipTitle ":"Resultados de metadatos","metadataResults.tooltipText ":"Ir a la pgina de resultados de los metadatos","metadataResults.alertTitle ":"Resultados de metadatos","metadataResults.alertText ":"No hay resultados disponibles de metadatos","featureInfoWindow.windowTitle":"Propiedades de los objetos","mf.information":"Imprimir","mf.print.pdfReady":"PDF disponible","loadLayer.loadingMessage":"Datos de la capa de carga","loadLayer.error.title":"La capa de datos de carga de error","loadLayer.error.message":"La capa de datos no se pudo cargar","disclaimer.windowTitle":"Negativa","disclaimer.loading":"Rechazo de carga ...","disclaimer.buttonClose":"Cerrar",gazetteerAddressField1Label:"Cdigo postal",gazetteerAddressField2Label:"Carretera",gazetteerAddressField3Label:"Lugar",gazetteerAddressField4Label:"Comunidad",gazetteerAddressField5Label:"Nmero de la casa",searchOptionButton:"Buscar",GazetteerWindowTitle:"La direccin",searchResults:"Resultados de la bsqueda",errorTitle:"Error",SearchOptionLoadFailureMsg:"No hay resultados disponibles. \n Servicio de puede no estar disponible . \n",gazetteerTooltipTitle:"Bsqueda de direccin",gazetteerTooltipText:"Cdigo Postal Nombre de la calle local municipal o de bsqueda de empleo.",SearchOptionNoResults:"No se encontraron resultados",zoomlayerTooltipTitle:"Ver extensin de la capa",zoomlayerTooltipText:"Utilice esta tecla para ver toda la extensin de la capa de datos seleccionada.","zoomlayer.selectLayerTitle":"Ver extensin de la capa","zoomlayer.selectLayerText":"Ninguna capa seleccionada",layerStylesWindowTitle:"Datos de estilo de capa",layerStylesPreviewTitle:"Leyenda Prevista",selectStyleButton:"Elegir el estilo",WMSTimeWindowTitle:"WMS Temporal",WMSTimePositionTitle:"Seleccione una fecha",WMSTimeMovieTitle:"Ver animacin",wmsTimeUpdateButtonText:"Aplicar",WMSTimeAnimationCheckbox:"Reproducir la pelcula con los ltimos $ {} veces los pasos",fullTextSearch:"Bsqueda de texto completo",keyword:"Palabra clave",org:"Organizacin",mapTypes:"Tipos de mapas",rsIdentifier:"Identificador de recursos",inspireSearchOptions:"INSPIRE criterios",inspireannex:"Anexo INSPIRE",inspirerelated:"En cuanto a INSPIRE",inspirerelatedtt:"INSPIRE informe sobre el historial de cumplimiento con respecto a la especificacin de datos",inspiretheme:"Tema INSPIRE",inspireClassificationDataServices:"INSPIRE servicios de datos de clasificacin",serviceType:"Tipo de servicio",serviceType_discovery:"Servicio de Descubrimiento (Discovery)",serviceType_view:"Servicio de visualizacin (ver)",serviceType_transformation:"Servicio de Transformacin (transformacin)",serviceType_invoke:" Servicio de invocacin de datos espaciales (llamada)",serviceType_other:"Otros Servicios (otros)",similarity:"Buscar la precisin",wkt:"WKT la geometra",simpleViewMode:"Ver Mensaje Individual",spatialSearch:"Criterios espaciales",mdChangeDate:"Fecha de cambio de metadatos",tempExtent:"Medida temporal",creationDate:"Fecha de creacin",modificationDate:"Fecha de modificacin",publicationDate:"Fecha de publicacin",hitsPerPage:"Resultados por pgina",sortBy:"Ordenar por",relevance:"Relevantes",options:"Opciones",title:"Ttulo",changeDate:"Cambio de Fecha",rating:"Valoracin",popularity:"Popularidad",scaleDesc:"Escala (de)",scaleAsc:"Escala (ASC)","abstract":"Resumen",catalogue:"Catlogo",group:"Grupo",chooseGroup:"Seleccione un grupo de",md:"Metadatos",tpl:"Plantilla",category:"Categora",advTextSearch:"Opciones avanzadas de bsqueda",eitherWords:"Cualquiera de las palabras",exactPhrase:"Frase exacta",allWords:"Todas las palabras",withoutWords:"Sin las palabras",precise:"Preciso",imprecise:"Incorrecto",relationType:"Relacin",within:"Dentro de",touches:"Toque",crosses:"Cruza",fullyOutsideOf:"Completamente fuera de",encloses:"Encierra",overlaps:"Superposicin",intersection:"Interseccin",nearYou:"En su rea",from:"De",to:"A",scaleNominator:"A",scale:"Escala",digital:"Digital",hardCopy:"Hardcopy",download:"Descargar",downloadable:"Descargar",interactive:"Interactivo",resourceType:"Tipo de recurso",dataset:"Conjunto de datos",series:"Serie",service:"Servicio",spatialRepType:"La representacin espacial",video:"Vdeo",vector:"Vector",textTable:"Texto de la tabla",tin:"Estado",stereoModel:"Modelo de estreo",grid:"Red",kind:"Tipo",enterGetCapURL:"Introduzca una direccin URL para registrarse GetCapabilities a un nuevo servicio.",edit:"Editar",duplicate:"Duplicado","delete":"Borrar",createChild:"Crear infantil",privileges:"Privilegios",categories:"Categoras",otherActions:"Otras acciones",view:"Ver",zoomTo:"Ampliar",saveXml:"Guardar como XML",exportCsv:"Exportar (CSV)",exportZip:"Exportar (ZIP)",printSel:"Exportar (PDF)",printTT:"Imprimir. Abra una nueva pgina para la impresin.",newOwner:"El nuevo propietario",updateCategories:"Actualiza Categoras",updatePrivileges:"Actualizacin de los privilegios",noneSelected:"Ninguna seleccionada",none:"ninguno",all:"todo",allInPage:"todos en la pgina",select:"Seleccionar",username:"Nombre de usuario",password:"Contrasea",login:"Iniciar sesin",logout:"Acceder","Login.error":"Error al Iniciar Sesin","Login.error.message":"El login fall. Compruebe su nombre de usuario y contrasea.",administration:"Administracin",validationReport:"Informe de validacin",status:"Estado",items:"Artculo",item:"Artculo",thumbnails:"Miniaturas",noimages:"No hay imgenes disponibles",add:"Aadir",small:"Pequeo",large:"Grande",selectImage:"Seleccione una imagen",selectFile:"Seleccione un archivo",image:"Imagen",uploading:"Subiendo ...",upload:"Subir",success:"xito",failure:"Fracaso",error:"Error",save:"Ahorrar",reset:"Espalda",fileProcessedMsg:"File ${res} procesado en el servidor.",suggestion:"Propuesta",logoSelect:"Seleccione un logotipo",relatedResources:"Recursos relacionados",createLink:"Creacin de vnculos ...",featureCat:"Reportaje Catlogo",serviceMd:"Servicio de metadatos",datasetMd:"Conjunto de datos de metadatos",parentMd:"Padres de metadatos",updateChildren:"Actualizar hijo",records:"Archivos",record:"Registro",help:"Ayuda",publishError:"La publicacin fall.",outOfMemoryError:"Error de memoria.",publishErrorCode:"Cdigo de error",saveAndCheck:"Guardar y revisar",saveAndClose:"Guardar y cerrar",cancel:"Cancelar",layout:"Disposicin",collapseAll:"Ocultar todas las secciones",editAttributes:"Atributos de Gestin de",chooseAType:"Seleccione un tipo de",chooseAView:"Seleccione una vista",viewMode:"Modo de visualizacin",errorAndStatusMsg:"Errores. Estado $ {texto}. Intentelo de nuevo.,",mdEditor:"El Editor de Metadatos",minorEditTT:"No marca de tiempo de actualizacin en Guardar",editing:"Edicin de ${title} (${uuid})",GetCapabilitiesDocumentError:"Error al cargar documento GetCapabilities del servicio de la URL",maxResults:"Nmero de resultados",mdTitle:"Metadatos Ttulo",keywords:"Palabras clave",createRelation:"Crear la relacin",createIfNotExistButton:"Crear un nuevo conjunto de metadatos",getCapabilitiesLayer:"Capa GetCapabilities",layerName:"Nombre de la capa",searching:"Buscar ...",perThesaurus:"Por Tesauro",anyThesaurus:"Cualquier Tesauro",selectedKeywords:"Palabras clave seleccionadas",foundKeywords:"Palabras clave disponibles",clear:"Borrar",publish:"Publicar",publishTooltip:"Publicar los datos actuales de inventario para el nodo remoto. Si los datos ya est publicada en este nodo se actualiza.",publishSuccess:"El xito de la publicacin.",publishLayerAdded:"Capas aadido para asignar slo una vista previa.",unpublish:"No Publicar",unpublishTooltip:"Eliminar el registro actual del nodo remoto.",unpublishSuccess:"xito en la despublicacin.",unpublishError:"Fallo en la despublicacin.",check:"Comprobar",errorDatasetNotFound:"Anote que no se encuentra.",datasetFound:"Conjunto de datos encontrados se ha agregado a la vista previa del mapa.",checkFailure:"Fallo al revisar el conjunto de datos en el nodo remoto.",addOnlineSourceTitle:"Enlace de servicio para los metadatos",addOnlineSource:"Aadir enlaces",addOnlineSourceTT:"Agregar una fuente de la seccin en lnea de registro de metadatos actual que en los servicios WMS / WFS / WCS. Si el servicio es una capa WMS se puede mostrar en el Visualizador de Mapas.",statusInformation:"Informacin de estado.",publishing:"Publicando ...",mapPreview:"Mapa de vista previa",selectANode:"Seleccione un nodo ...",geoPublisherWindowTitle:"Geo-publicacin",keywordSelectionWindowTitle:"Seleccin de palabras clave",crsSelectionWindowTitle:"Coordinar la seleccin de referencia del sistema",linkedMetadataSelectionWindowTitle:"Seleccin de los metadatos relacionados",NotOwnerError:"Usted no tiene permiso para actualizar el registro relacionado.",ServiceUpdateError:"Error en la actualizacin de los metadatos de servicio",associateService:"Enlace de metadatos de servicio",associateDataset:"Enlace registro de metadatos",logoSelectionWindow:"Seleccione un logotipo",fileUploadWindow:"Carga de datos o documentos",selectedCRS:"Seleccin de los sistemas de coordenadas",foundCRS:"Disponibles sistemas de coordenadas",search:"Buscar",restrictSearchToMap:"Limitar el alcance de la bsqueda para reflexionar",selected:"seleccionado",selectRegion:"Elige una regin ...",drawRectangle:"Dibuja un rectngulo",drawPolygon:"Dibuja un polgono",drawPolygonTT:"Haga clic en el botn y dibujar un polgono haciendo clic en el mapa para cada punto. Haga doble clic en el ltimo punto del polgono para hacer.",drawCircle:"Dibuja un crculo",discovery:"Descubrimiento",visualization:"Visualizacin",when:"Cundo?",anyTime:"Cada vez",onSelection:"Despus de la seleccin",adminAction:"Otro",newMetadata:"Metadatos Nuevo",chooseTemplate:"Seleccione una plantilla",process:"Proceso",suggestions:"Propuestas",applySelected:"Introduzca tarea seleccionada",processParametersWindow:"Parmetros de la tarea",noSuggestion:"Ninguna propuesta.",thumbnailUploadWindow:"Miniatura de la foto",addThumbnail:"Aadir",createSmall:"Vista previa pequea Nueva",scalingFactor:"Factor de escala",smallScalingFactor:"Factor de escala pequea",type:"Tipo de registro",clickToClose:"Haga clic para cerrar",removeSelected:"Eliminar la seleccin",ownerName:"Propietario del registro de metadatos",setPrivileges:"Establecer privilegios",setCategories:"Establecer categoras",massiveOp:"Modo por lotes",prepareDownload:"Descarga de archivos",mdMenu:"Acciones",deleteRecord:"Eliminar los metadatos?",deleteConfirm:"Ests seguro de eliminar este registro de metadatos?",deleteRecordSuccess:"Los metadatos borrados.",deleteRecordFailure:"Error al eliminar los metadatos.",advancedSearchOptions:"Criterios avanzados",relatedservices:"Servicios relacionados con",relatedchildren:"Hijos",relatedfcats:"Catlogo de Funciones Relacionadas",relatedhasfeaturecat:"Conjuntos de datos",relatedsources:"Registros de origen",getMEF:"Exportaciones (ZIP)",metadataCategories:"El meta-categoras",validityInfo:"Estado de la validacin",lastUpdate:"ltima actualizacin",importMetadata:"Importar metadatos",validationStatus:"Estado de la validacin",valid:"Vlido",notValid:"No es vlido",notDetermined:"No se ha determinado",addToMap:"Aadir al mapa",downloadLink:"Descargar",webLink:"Weblink",viewKml:"Abrir en Google Earth",layerTree:"Gestor de capas",mdResultsLayer:"Resultados de la bsqueda",printLayer:"Imprimir esta pgina",relatedservices:"Servicios relacionados con",relatedparent:"Padre",relateddatasets:"Registros similares",relatedchildren:"Hijos",relatedrelated:"Caracterstica catalog / enlace de datos",delete19110Relation:"Retire relacin del catlogo de rasgos",newWindow:"Nueva ventana",addAsXLink:"Aadir un elemento vinculado",contactSelectionWindowTitle:"Seleccionar contacto",selectedContacts:"Contactos seleccionados",foundContacts:"Disponible",contactRole:"Rol de contacto",mapNearYou:"Centrar mapa en su ubicacin",errorChangeProtocol:"Elimine el fichero cargado  antes de cambiar el protocolo de un recurso en lnea.",resultBy:"Resultado (s) /",subTemplateImport:"Importacin de entradas de directorio",xmlData:"XML",minorEdit:"Correcciones menores",minorEditTT:"",runASearch:"Haga una bsqueda.",focusOnAny:"Mover el enfoque al campo de bsqueda de texto completo.",hideSearchForm:"Mostrar u ocultar el formulario de bsqueda.",switchMode:"Activar el modo de visualizacin.",resetSearchForm:"Restablecer el formulario de bsqueda.",focusOnLogin:"Centrarse en el acceso al formulario de acceso para administrar catlogo de la sesin o una cuenta",openAdmin:"Ir a administracin",displayInfoPanel:"Muestra el panel de informacin.",displayHelpPanel:"Muestra la ayuda.",SelectionWindowTitle:"Elija de la lista",found:"Registros encontrados",selected:"Seleccionado",create:"Crear",feedbackcontactDetails:"Los datos de contacto",feedbacknameInitials:"Nombre, Inicial (s)",feedbackmale:"Masculino",feedbackfemale:"Femenino",feedbackposition:"Posicin",feedbackorganization:"Organizacin",feedbackphone:"Telfono",feedbackemail:"Email",feedbackfeedback:"Reaccin",feedbackfunction:"Funcin",feedbackquestion:"Cuestin",feedbackerror:"Error",feedbackremark:"Observacin",feedbackcontact:"Contacto",feedbackcategory:"Categora",feedbackmetadataContent:"Contenido de metadatos",feedbackdataContent:"Contenido de dados",feedbackserviceContent:"Contenido de servicios",feedbacksupport:"Apoyo",feedbackmapViewer:"Map Viewer",feedbacksearch:"Buscar",feedbackorganizations:"Organizaciones",feedbackcontentManagement:"Content Management",feedbackmetadataImport:"Importacin de metadatos",feedbackmetadataEdit:"Edicin de metadatos",feedbackharvesting:"Cosecha",feedbackvalidator:"Validator",feedbackother:"De otra manera",feedbackremarks:"Notas",feedbackmetadataData:"Metadatos informacin",feedbacktitle:"Ttulo",feedbackPanelTitle:"Con este formulario puede dar su opinin sobre metadatos, datos y / o servicios.",feedbacksubmit:"Enviar",feedbackerrorTitle:"Precaucin",feedbackerrorMsg:"Se produjo un error durante el envo. Por favor, intntelo de nuevo ms tarde.",feedbackcancel:"Cancelar",feedbackWindowTitle:"Reaccin","add-extent-from-geokeywordsreplace":"Reemplazar la extensin existente","add-info-from-wmssetExtent":"Establecer extensin","add-info-from-wmssetAndReplaceExtent":"Reemplazar la extensin existente","add-info-from-wmssetCRS":"Establecer sistema de coordenadas de referencia","add-info-from-wmssetDynamicGraphicOverview":"Establecer grfico (usando la URL de la peticin GetMap )","add-info-from-wmswmsServiceUrl":"Servicio de URL","linked-data-checkerlinkUrl":"Eliminar URL","related-metadata-checkeruuidToRemove":"Retire los identificadores","add-service-info-from-wxssetAndReplaceOperations":"Reemplazar las operaciones existentes","add-service-info-from-wxswxsServiceUrl":"Servicio de URL","manageDirectories ":"Gestin de Directorios",directory:"Directorio",thesaurusManager:"Gestin de Tesauro",Theme:"Tema",thesaurusFilePath:"Archivo de tesauro (. RDF)",ThesaurusName:"Nombre de tesauro",createThesaurusFromURL:"desde URL",createThesaurusFromRepository:"desde repositorio de tesauro",creationMode:"Crear",thesaurusFromRepository:"Tesauro",externalThesaurusURL:"URL",thesaurusCreation:"Aadir un Tesauro",Type:"Tipo",Activated:"Habilitado",emptyThesaurus:"Nuevo tesauro vaco",thesaurusFromFile:"Desde el archivo local",thesaurusFromURL:"Archivo remoto (URL)",id:"Identificador",label:"Etiqueta",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Etiqueta",newDefinition:"Definicin",selDirectoryTT:"Seleccione un directorio. Un grupo de Directorio de todos los elementos que tienen el nombre de la raz mismo elemento (por ejemplo, GMD",privTplElTT:"Administracin de permisos para la seleccin actual.",addTplElTT:"Aadir un elemento de un fragmento de XML en un directorio. El directorio de destino es el nombre del elemento raz (por ejemplo, basada en GMD",copyTplElTT:"Crear una nueva entrada en el directorio de la seleccin actual.",delTplElTT:"Eliminar elemento seleccionado en la gua telefnica.",Home:"Inicio",Map:"Mapa",Poweredby:"Proporcionado por",About:"Acerca de",org:"Organizacin",keyword:"Palabra clave",When:"Cuando",Where:"Donde",What:"Qu",advancedSearchOptions:"Opciones avanzadas de bsqueda",hitsPerPage:"Resultados por pgina",Searchforspatialdataon:"Buscar los datos espaciales sobre",search:"Buscar",fullTextSearch:"bsqueda de texto completo",reset:"Limpiar",resetSearchForm:"Restablecer el formulario de bsqueda",Advanced:"Avanzado",newWindow:"Nueva ventana",mdEditor:"El Editor de Metadatos",List:"Lista","linklabel-application/vnd.ogc.wms_xml":"Add to map","linklabel-OGC:WMS":"Add to map","linklabel-application/vnd.google-earth.kml+xml":"View in Google Earth","linklabel-application/zip":"Download","linklabel-WWW:DOWNLOAD-1.0-http--download":"Download","linklabel-application/x-compressed":"Download","linklabel-text/html":"Web link","linklabel-text/plain":"Web link","linklabel-image/png":"Image link","linklabel-":"Link"};
OpenLayers.Util.extend(OpenLayers.Lang.es,GeoNetwork.Lang.es);
Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.fr={previousPage:"Page prcdente",nextPage:"Page suivante",upInPage:"Se dplacer vers le haut des rsultats",downInPage:"Se dplacer vers le bas des rsultats",example:"Exemple :",noInfo:"Aucune information",helper:"Suggestion :",toggleLayerManager:"Afficher le gestionnaire de couches",tagName:"Nom de l'lment :",enableTooltip:"Activer les info-bulles pour obtenir une description complte de chaque champs.",connectIssue:"chec de connexion au catalogue",connectIssueMsg:"Erreur 404. Impossible de se connecter  l'URL ",featureInfoTooltipTitle:"caractristique",featureInfoTooltipText:"Cliquer sur la carte pour obtenir des informations sur les donnes affichees.",zoomToMaxExtentTooltipTitle:"Zoom optimal",zoomToMaxExtentTooltipText:"Utiliser ce bouton pour tout afficher.",zoominTooltipTitle:"Zoomer",zoominTooltipText:"Dessiner un rectangle sur la carte pour zoomer. En cliquant sur la carte, le facteur de zoom est 2.",zoomoutTooltipTitle:"Dzoomer",zoomoutTooltipText:"Cliquer sur la carte ou dessiner un rectangle pour dzoomer.",dragTooltipTitle:"Main",dragTooltipText:"Appuyer sur le bouton gauche de la souris pour dplacer la carte.",previousTooltipTitle:"Revenir au zoom prcdant",previosTooltipText:"Cliquer ici pour revenir au zoom prcdant",nextTooltipTitle:"Zoom suivant",nextTooltipText:"Cliquer ici pour avancer au zoom suivant",featureInfoTitle:"Caractristique",layerManagerTabTitle:"Grer les couches",legendTabTitle:"Lgende",scaleTitle:"Echelle",xTitle:"X",yTitle:"Y",projectionTitle:"Projection",FeatureInfoNotQueryable:"Il n'existe pas de carte correspondant  la requte",WMSBrowserTab1:"Slectionner",WMSBrowserTab3:"Externe",WMSBrowserPreviewTitle:"Aperu de la couche",WMSBrowserAddButton:"Ajouter",WMSBrowserDuplicateMsg:"La couche est dj affiche",WMSBrowserPreviewWaitMsg:"Rcuprer l'image precedente",WMSBrowserConnectButton:"Connexion",WMSBrowserConnectError:"Erreur de connexion au service Web, merci de vrifier l'URL.",infoTitle:"Information","mf.print.mapTitle":"Titre","mf.print.comment":"Commentaire","mf.print.dpi":"Rsolution","mf.print.scale":"chelle","mf.print.rotation":"Angle","mf.print.resetPos":"Reset","mf.print.print":"Imprimer","mf.print.generatingPDF":"Gnrer PDF","mf.print.unableToPrint":"Impression impossible, essayer plus tard","mf.error":"Erreur",selectExtentTooltipTitle:"Dfinir une emprise",selectExtentTooltipText:"Dessiner une emprise  utiliser comme critre gographique",clearExtentTooltipTitle:"Supprimer l'emprise",clearExtentTooltipText:"Supprimer l'emprise (ie. aucun critre gographique)",printTooltipTitle:"Imprimer",printTooltipText:"Imprimer la carte actuelle",savewmcTooltipTitle:"Sauvegarder environnement (vue, paramtres,etc.)",savewmcTooltipText:"Sauvegarder environnement pour la carte actuelle","saveWMCFile.windowTitle":"Sauvegarder l'environnement","saveWMCFile.errorSaveWMC":"Sauvegarde de l'environnement impossible",loadwmcTooltipTitle:"Restaurer l'environnement",loadwmcTooltipText:"Restaurer l'environnement dans la carte actuelle","selectWMCFile.windowTitle":"Restaurer l'environnement",selectWMCFile:"Ouvrir un environnement","selectWMCFile.waitLoadingWMC":"Restauration de l'environnement en cours...","selectWMCFile.loadButtonText":"Charger","selectWMCFile.mergeButtonText":"Fusionner","selectWMCFile.errorLoadingWMC":"Chargement de l'environnement impossible",opacityButtonText:"Transparence",opacityWindowTitle:"Transparence",metadataButtonText:"Metadonnes",removeButtonText:"Supprimer",addWMSButtonText:"Ajouter WMS",addWMSWindowTitle:"Ajouter WMS","layerInfoPanel.windowTitle":"Couche metadata","layerInfoPanel.titleField":"Titre","layerInfoPanel.descriptionField":"Description","layerInfoPanel.queryableField":"Requte",layerList:"Liste des couches",baseLayerList:"Fond de carte",overlaysList:"Calques","metadataResults.buttonText":"Rsultats Metadata","metadataResults.tooltipTitle":"rsultats Metadata","metadataResults.tooltipText":"Aller a la page des rsultats Metadata","metadataResults.alertTitle":"Rsultats Metadata","metadataResults.alertText":"Pas de rsultats Metadata","mf.information":"Imprimer","mf.print.pdfReady":"PDF prt","loadLayer.loadingMessage":"Chargement de la couche","loadLayer.error.title":"Charger la couche","loadLayer.error.message":"La couche ne peut tre charge","disclaimer.windowTitle":"Disclaimer","disclaimer.loading":"Chargement...","disclaimer.buttonClose":"Fermer",gazetteerAddressField1Label:"Code postal",gazetteerAddressField2Label:"Street",gazetteerAddressField3Label:"Place",gazetteerAddressField4Label:"Municipalit",gazetteerAddressField5Label:"Numro",searchOptionButton:"Recherche",GazetteerWindowTitle:"Rsultat pour l'adresse",searchResults:"Recherche les rsultats",resetSearchForm:"Rinitialiser le formulaire de recherche.",errorTitle:"Erreur",SearchOptionLoadFailureMsg:"Pas de rsultats trouvs. \n Le serveur peut tre indisponible. \n",gazetteerTooltipTitle:"Recherche base sur l'adresse",gazetteerTooltipText:"Recherche du lieu, bas sur le code postal, la rue, la municipalit ou place.",SearchOptionNoResults:"Pas de rsultats trouvs.",zoomlayerTooltipTitle:"Zoom sur une couche",zoomlayerTooltipText:"Utilisez ce bouton pour accder  la pleine mesure de le calque slectionn.","zoomlayer.selectLayerTitle":"Zoom sur une couche","zoomlayer.selectLayerText":"No de calque slectionn",layerStylesWindowTitle:"Layer styles",layerStylesPreviewTitle:"Preview legend",selectStyleButton:"Select style",WMSTimeWindowTitle:"WMS Time",WMSTimePositionTitle:"Time position",WMSTimeMovieTitle:"Animation",wmsTimeUpdateButtonText:"Apply",WMSTimeAnimationCheckbox:"Play a movie loop spanning the last ${steps} time positions",fullTextSearch:"Rechercher ...",keyword:"Mots-cls",org:"Organisation",mapTypes:"Type de donnes",rsIdentifier:"Identifiant de la ressource",inspireSearchOptions:"INSPIRE",inspireannex:"Annexe",inspirerelated:"Donnes soumises  INSPIRE",inspirerelatedtt:"Donnes dcrivant un rapport sur la conformit vis--vis des spcifications sur les donnes INSPIRE.",inspiretheme:"Thme",inspireClassificationDataServices:"INSPIRE classification data services",serviceType:"Service type",serviceType_discovery:"Discovery Service (discovery)",serviceType_view:"View Service (view)",serviceType_transformation:"Transformation Service (transformation)",serviceType_invoke:"Invoke Spatial Data Service (invoke)",serviceType_other:"Other Services (other)",similarity:"Prcision",wkt:"Geomtrie WKT",spatialSearch:"Critres gographiques",mdChangeDate:"Date de mise  jour des mtadonnes",tempExtent:"tendue temporelle",creationDate:"Date de cration",modificationDate:"Date de modification",publicationDate:"Date de publication",hitsPerPage:"Nombre par page",sortBy:"Trier par",options:"Options",relevance:"Pertinence",title:"Titre",changeDate:"Date de mise  jour",rating:"Note",popularity:"Popularit",scaleDesc:"chelle (desc)",scaleAsc:"chelle (asc)","abstract":"Rsum",catalogue:"Catalogue",group:"Groupe",md:"Mtadonne",tpl:"Modle",category:"Catgorie",advTextSearch:"Options avances",eitherWords:"Tous - au moins un des mots suivants",exactPhrase:"Cette expression exacte",allWords:"Tous les mots suivants",withoutWords:"Aucun des mots suivants",precise:"Prcis",imprecise:"Flou",relationType:"Type de relation",within:" l'intrieur",touches:"Touche",crosses:"Travers",fullyOutsideOf:"En dehors",encloses:"Contient",overlaps:"Chevauche",intersection:"Intersecte",nearYou:" proximit",from:"du",to:"au",scaleNominator:"1/",scale:"chelle",digital:"Numrique",hardCopy:"Copie papier",download:"Tlcharger",downloadable:"Tlchargeable",interactive:"Interactive",resourceType:"Type de ressource",model:"Catalogue d'attributs",dataset:"Jeu de donnes",series:"Sries",service:"Service",spatialRepType:"Reprsentation spatiale",video:"Vido",vector:"Vecteur",textTable:"Tableau, Texte",tin:"Tin",stereoModel:"Vue 3D",grid:"Raster",kind:"Type",enterGetCapURL:"Saisir l'URL d'un GetCapabilities pour enregistrer un nouveau service",edit:"diter",duplicate:"Dupliquer","delete":"Supprimer",createChild:"Crer un enfant",privileges:"Privilges",privilegesTT:"Grer les privilges pour l'accs public et les divers groupes du catalogue.",categories:"Catgories",otherActions:"Autres actions",permalinkInfo:"Collez le lien suivant dans un e-mail<br/> ou dans un message instantan",view:"Consulter",zoomTo:"Zoomer vers",saveXml:"Export (XML)",saveRdf:"Export (RDF)",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Export (PDF)",printTT:"Imprimer. Ouvre une nouvelle page adapte  l'impression.",newOwner:"Associer un autre auteur",updateCategories:"Mettre  jour les catgories",updatePrivileges:"Mettre  jour les privilges",noneSelected:"Slection vide",none:"aucun",all:"tous",allInPage:"tous dans la page",select:"Selectionner ",username:"Identifiant",password:"Mot de passe",login:"Connexion",logout:"Dconnexion",administration:"Administration",validationReport:"Rapport de validation",setStatus:"tat de la mtadonne",status:"tat",updateStatus:"Mettre  jour l'tat",updateVersion:"Activer le suivi des versions",statusTT:"Modifier l'tat d'une mtadonne (eg. brouillon, valid, rejet).",setVersioning:"Suivi des versions",versioning:"Activer le suivi des versions",versioningTT:"Une fois activ, tous les changements raliss sur la fiche seront sauvegards dans le dpt SVN pour le suivi des versions.",items:"lments",item:"lment",thumbnails:"Aperus",noimages:"Aucun aperu disponible",add:"Ajouter",small:"Petit",large:"Grand",selectImage:"Slectionner une image",selectFile:"Slectionner un fichier",image:"Image",uploading:"Transfert en cours ...",upload:"Transfrer",success:"Succs",failure:"chec",error:"Erreur",save:"Sauver",reset:"Rinitialiser",fileProcessedMsg:"Traitement du fichier ${res} ralis sur le serveur",suggestion:"Suggestion",logoSelect:"Slectionner un logo",relatedResources:"Ressources associes",createLink:"Associer ...",featureCat:"Catalogue d'attributs",serviceMd:"Mtadonnes de service",datasetMd:"Mtadonnes de donnes",parentMd:"Parent",updateChildren:"Mettre  jour les enfants",records:"enregistrements",record:"enregistrement",recordsFound:" fiche(s)",help:"Aide",publishError:"chec lors de la publication.",outOfMemoryError:"rreur de dpassement de mmoire.",publishErrorCode:"Code rreur :",saveAndCheck:"Sauver et valider",saveAndClose:"Sauver et fermer",cancel:"Annuler",layout:"Mise en page",Resolution:"Rsolution",collapseAll:"Rduire les sections",editAttributes:"Grer les attributs",chooseAType:"Choisir un type",chooseAView:"Choisir une vue",viewMode:"Affichage",errorAndStatusMsg:"rreur. Status : ${status}, description : ${text}. Essayer  nouveau.",mdEditor:"Editeur de mtadonne",editing:"${title} (${uuid}) en cours d'dition",GetCapabilitiesDocumentError:"Erreur lors de la tentative de rcupration des informations du service (ie. GetCapabilities) avec l'adresse: ",maxResults:"Nombre de rsultats",mdTitle:"Titre de la mtadonne",keywords:"Mots-cls",createRelation:"Crer la relation",createIfNotExistButton:"Crer une nouvelle mtadonne",getCapabilitiesLayer:"Couches du GetCapabilities",layerName:"Nom de la couche",searching:"Recherche en cours ...",perThesaurus:" par thesaurus",anyThesaurus:"Tous les thsaurus",selectedKeywords:"Mots cls selectionns",foundKeywords:"Mots cls trouvs",clear:"Effacer",publish:"Publier",publishTooltip:"Publier le jeu de donnes en cours dans le nud distant. Si le jeu de donnes est prsent, il est mis  jour.",publishSuccess:"Publication effectue.",publishLayerAdded:" Couche ajoute  la carte.",unpublish:"Dpublier",unpublishTooltip:"Supprimer le jeu de donnes en cours dans le nud distant.",unpublishSuccess:"Dpublication effectue.",unpublishError:"Echec de la dpublication. ",check:"Vrifier",errorDatasetNotFound:"Jeu de donnes non trouv.",datasetFound:"Jeu de donnes trouv et ajout  la carte.",checkFailure:"Echec de la vrification de la prsence du jeu de donnes dans le nud distant.",addOnlineSourceTitle:"Lier le service  la fiche",addOnlineSource:"Ajouter les liens",addOnlineSourceTT:"Ajouter les informations pour faire la liaison avec la couche dans le service WMS/WFS/WCS.",statusInformation:"Status.",publishing:"Publication en cours ...",mapPreview:"Carte",selectANode:"Choisir un nud ...",geoPublisherWindowTitle:"Go-publication : ",keywordSelectionWindowTitle:"Slection de mots cls",crsSelectionWindowTitle:"Slection des systmes de coordonnes",linkedMetadataSelectionWindowTitle:"Slection des mtadonnes associes",NotOwnerError:"Vous n'avez pas les privilges pour mettre  jour la mtadonne associe.",ServiceUpdateError:"Erreur lors de la mise  jour de la mtadonne.",associateService:"Associer une mtadonne de service",associateDataset:"Associer une mtadonne de donnes",logoSelectionWindow:"Slectionner un logo",fileUploadWindow:"Ajouter des donnes ou des documents",selectedCRS:"Systmes slectionns",foundCRS:"Systmes disponibles",search:"Rechercher",restrictSearchToMap:"Restreindre la recherche  la carte",selected:"slectionn(s)",selectRegion:"Choisir une rgion ...",drawRectangle:"Crer un rectangle",drawPolygon:"Crer un polygone",drawCircle:"Crer un cercle",discovery:"Dcouverte",visualization:"Visualisation",when:"Critres temporels",anyTime:"N'importe quand",onSelection:"Sur la slection",adminAction:"Autres",newMetadata:"Nouvelle mtadonne",metadatatype:"Type de ressource",newMetadataTitle:"Pour crer une mtadonne, choisir un modle de saisie puis slectionner un groupe",tplTitle:"Modle de saisie",chooseGroup:"Selectionner un groupe",chooseTemplate:"Slectionner un modle",process:"Traiter",suggestions:"Suggestions",applySelected:"Appliquer le traitement slectionn",processParametersWindow:"Paramtres du traitement",noSuggestion:"Aucune suggestion.",thumbnailUploadWindow:"Ajouter un aperu",addThumbnail:"Ajouter",createSmall:"Crer un petit aperu",scalingFactor:"Facteur d'chelle",smallScalingFactor:"Facteur d'chelle",type:"Type de fiche",clickToClose:"Cliquer pour fermer",removeSelected:"Supprimer la slection","metadata.update.new":"Chargement en cours ...","metadata.update.forget.new":"R-initialisation en cours ...",ownerName:"Rdacteur de la mtadonne",setPrivileges:"Dfinir les privilges",setCategories:"Choisir les catgories",massiveOp:"Opration sur la slection",prepareDownload:"Tlcharger les fichiers",mdMenu:"Actions",simpleViewMode:"Vue simplifie",deleteRecord:"Supprimer la mtadonne ?",deleteConfirm:"Confirmez-vous la suppression de la mtadonne ?",deleteRecordSuccess:"Metadonne supprime",deleteRecordFailure:"chec lors de la suppression de la mtadonne",advancedSearchOptions:"Critres avancs",getMEF:"Export (ZIP)",metadataCategories:"Catgories",validityInfo:"Information sur la validation",lastUpdate:"Dernire mise  jour : ",importMetadata:"Import de mtadonnes",validationStatus:"Validation ",valid:"Valide",notValid:"Non valide",notDetermined:"Non dtermin",addToMap:"Ajouter  la carte : ",downloadLink:"Tlcharger : ",webLink:"Site web : ",viewKml:"Visualiser avec GoogleEarth : ",layerTree:"Gestion des couches",mdResultsLayer:"Rsultats de la recherche",printLayer:"Page de l'impression",relatedservices:"Services associs",relatedparent:"Mtadonne parent",relateddatasets:"Mtadonnes associes",relatedchildren:"Enfants",relatedrelated:"Relation catalogue d'attributs/donnes",relatedfcats:"Relation catalogue d'attributs/donnes",relatedhasfeaturecat:"Donne",relatedsources:"Donnes sources",delete19110Relation:"Supprimer le lien cat. d'attributs",newWindow:"Nouvelle fentre",addAsXLink:"Ajout d'un lment li",contactSelectionWindowTitle:"Slection des contacts",selectedContacts:"Contacts slectionns",foundContacts:"Contacts disponibles",contactRole:"Rle du contact",mapNearYou:"Centrer la carte sur votre position",create:"Crer",errorChangeProtocol:"Impossible de changer le protocol lorsqu'un fichier est attach. Supprimer le fichier.",resultBy:" resultat(s) / ",subTemplateImport:"Importer un lment dans un annuaire",xmlData:"XML",minorEdit:"Modif. mineure",minorEditTT:"Lorsque cette option est active, la date de mise  jour des mtadonnes n'est pas change. Lors de l'utilisation des suggestions, ou de la mise  jour d'une imagette, cette option est sans effet, la date est mise  jour.",runSearch:"Lancer la recherche.",focusOnAny:"Dplacer le curseur sur le critre plein texte.",hideSearchForm:"Afficher ou cacher le formulaire de recherche.",switchMode:"Changer de mode de visualisation.",focusOnLogin:"Dplacer le curseur sur le formulaire de connexion ou dconnexion si vous tes connect.",openAdmin:"Administrer le catalogue",displayInfoPanel:"Afficher la page d'information.",displayHelpPanel:"Afficher cette page d'aide.",SelectionWindowTitle:"Rechercher dans l'annuaire",found:"Enregistrements trouvs",feedbackcontactDetails:"Coordonnes",feedbacknameInitials:"Nom, Initiale (s)",feedbackmale:"Masculin",feedbackfemale:"Fminin",feedbackposition:"Position",feedbackorganization:"Organisation",feedbackphone:"Tlphone",feedbackemail:"E-mail",feedbackfeedback:"Raction",feedbackfunction:"Fonction",feedbackquestion:"Question",feedbackerror:"Erreur",feedbackremark:"Remarque",feedbackcontact:"Contacter",feedbackcategory:"Catgorie",feedbackmetadataContent:"Contenu des metadonnes",feedbackdataContent:"Contenu des donnes",feedbackserviceContent:"Contenu des services",feedbacksupport:"Soutenir",feedbackmapViewer:"Map Viewer",feedbacksearch:"Rechercher",feedbackorganizations:"Organisations",feedbackcontentManagement:"Gestion de contenu",feedbackmetadataImport:"Importation de mtadonnes",feedbackmetadataEdit:"Modification des mtadonnes",feedbackharvesting:"Moissonnage",feedbackvalidator:"Validator",feedbackother:"Autrement",feedbackremarks:"Remarques",feedbackmetadataData:"Les informations de mtadonnes",feedbacktitle:"Titre",feedbackPanelTitle:"Avec ce formulaire, vous pouvez amliorer les informations sur les mtadonnes, les donnes et / ou des services.",feedbacksubmit:"Envoyer",feedbackerrorTitle:"Attention",feedbackerrorMsg:"Une erreur s'est produite lors de l'envoi. S'il vous plat ressayer plus tard.",feedbackcancel:"Annuler",feedbackWindowTitle:"raction","add-extent-from-geokeywordsreplace":"Remplacer les tendues gographiques existantes","add-info-from-wmssetExtent":"Dfinir l'tendue","add-info-from-wmssetAndReplaceExtent":"Remplacer les tendues existantes","add-info-from-wmssetCRS":"Ajouter les systmes de coordonnes","add-info-from-wmssetDynamicGraphicOverview":"Dfinir l'aperu (en ajoutant une URL vers une requte GetMap)","add-info-from-wmswmsServiceUrl":"URL du service","linked-data-checkerlinkUrl":"Lien  supprimer","related-metadata-checkeruuidToRemove":"Identifiant  supprimer","add-service-info-from-wxssetAndReplaceOperations":"Remplacer les oprations existantes","add-service-info-from-wxswxsServiceUrl":"URL du service",manageDirectories:"Gestion des annuaires",directory:"Annuaire",thesaurusManager:"Gestion des thsaurus",Theme:"Thme",thesaurusFilePath:"Fichier (.rdf)",ThesaurusName:"Nom du thsaurus",createThesaurusFromURL:"A partir d'une URL",createThesaurusFromRepository:"A partir du dpt partag",creationMode:"Crer",thesaurusFromRepository:"Thsaurus",externalThesaurusURL:"URL",thesaurusCreation:"Ajout d'un thsaurus",Type:"Type",Activated:"Activ",emptyThesaurus:"Nouveau thsaurus vide",thesaurusFromFile:"A partir d'un fichier local",thesaurusFromURL:"A partir d'un fichier distant (URL)",id:"Identifiant",label:"Libell",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Libell",newDefinition:"Dfinition",selDirectoryTT:"Choisir un type d'annuaire. Un annuaire est constitu d'lments ayant la mme balise racine (eg. les lments gmd:CI_ResponsibleParty font partie de l'annuaire de contact)",privTplElTT:"Grer les privilges sur la slection.",addTplElTT:"Ajouter un lment  partir d'un fragment d'XML. L'annuaire cible est bas sur le nom de la balise racine (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Crer un nouvel lment dans l'annuaire  partir de l'lment slectionn.",delTplElTT:"Supprimer la slection.",language:"Langue",Home:"Accueil",Map:"Carte",Poweredby:"Propuls par",About:"Sur",When:"Quand",Where:"Ou",What:"Que",Searchforspatialdataon:"Rechercher des donnes spatiales sur les",Advanced:"Avances",metadataPOC:"point de contact",metadataPOCs:"Points de contact",spatialRepresentationType:"Type de donnes",spatialRepresentationTypes:"Types de donnes",createDateYear:"anne",createDateYears:"Annes",denominator:"Niveau d'chelle",denominators:"Niveaux d'chelle",orgName:"organisation",orgNames:"Organisations",serviceTypes:"Type de service",facetMore:"+ Voir tous les filtres",facetLess:"- Voir moins de filtres",List:"Liste",extractorTitle:"Tlchargement  partir de ",defineExtractionArea:"Dessiner la zone d'extraction",chooseALayer:"Slectionner une couche",outputFormat:"Format des donnes",dataDownload:"Tlcharger les donnes",wfsVersion:"Version","wxs-extract-service-not-found":"Erreur lors de la connexion au service http://geonetwork-opensource.org/geonetwork-client.","wxs-extract-layer-not-found":"La couche ${layer} n'a pas t trouve dans le service (http://geonetwork-opensource.org/geonetwork-client).",GML2:"GML 2",GML3:"GML 3",CSV:"Fichier texte CSV","SHAPE-ZIP":"ESRI Shapefile",xsd:"Modle ISO",rules:"rgles",rule:"rgle","schematron-rules-geonetwork":"Validation GeoNetwork","schematron-rules-iso":"Validation ISO","schematron-rules-inspire":"Validation INSPIRE","linklabel-application/vnd.ogc.wms_xml":"Visualiser","linklabel-OGC:WMS":"Visualiser","linklabel-application/vnd.google-earth.kml+xml":"KML","linklabel-application/zip":"Tlcharger","linklabel-WWW:DOWNLOAD-1.0-http--download":"Tlcharger","linklabel-application/x-compressed":"Tlcharger","linklabel-text/html":"Liens","linklabel-text/plain":"Liens","linklabel-image/png":"Images","linklabel-":"Liens"};
OpenLayers.Util.extend(OpenLayers.Lang.fr,GeoNetwork.Lang.fr);
Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.nl={Autofill:"Aanvullen elementen","Data for download":"Downloadbare data",E_inspireannex:"INSPIRE annex",E_inspirerelated:"Gerelateerd aan INSPIRE",E_inspiretheme:"INSPIRE thema",E_orgName:"Organisatie",E_serviceType:"Service type",E_template:"Soort",E_themekey:"Trefwoord",E__owner:"Eigenaar #",E_relation:"Ruimtelijke relatie",E__isHarvested:"Geharveste metadata",E_isPublishedToAll:"Gepubliceerd/ongepubliceerd metadata facet",FeatureInfoNotQueryable:"Er is geen bevraagbare kaartlaag",GazetteerWindowTitle:"Zoek adres",GetCapabilitiesDocumentError:"Fout laden service GetCapabilities document van URL: ","Login.error":"Error bij de Login","Login.error":"Login mislukt","Login.error.message":"Login mislukt. Controleer gebruikersnaam en wachtwoord.","Login.error.message":"U heeft een onjuiste gebruikersnaam of een onjuist wachtwoord ingevoerd.","No direct download":"Data op aanvraag",NotOwnerError:"U heeft geen rechten om dit gerelateerde record te wijzigen.","Online data":"Online kaarten",Preview:"Toon kaart",SearchOptionLoadFailureMsg:"Het is niet gelukt resultaten op te halen.\nMogelijk is de service tijdelijk niet beschikbaar.\n",SearchOptionNoResults:"Geen resultaten gevonden",SelectionWindowTitle:"Kies uit lijst",ServiceUpdateError:"Fout tijdens wijziging service metadata",WMSBrowserAddButton:"Voeg toe",WMSBrowserConnectButton:"Maak verbinding",WMSBrowserConnectError:"Er is een fout opgetreden bij het maken van de verbinding, controleer de URL.",WMSBrowserDuplicateMsg:"Kaartlaag is reeds aanwezig.",WMSBrowserPreviewTitle:"Voorbeeld kaartlaag",WMSBrowserPreviewWaitMsg:"Voorbeeld afbeelding ophalen",WMSBrowserTab1:"Selecteren",WMSBrowserTab3:"Extern",WMSTimeAnimationCheckbox:"Speel laatste ${steps} tijdstippen af",WMSTimeMovieTitle:"Speel een animatie af",WMSTimePositionTitle:"Kies een tijdstip",WMSTimeWindowTitle:"WMS Tijd","abstract":"Samenvatting",add:"Voeg toe",addAsXLink:"Voeg toe als gelinkt element",addOnlineSource:"Toevoegen links",addOnlineSourceTT:"Voeg een online bronsectie toe aan het huidige metadata record verwijzend naar de WMS/WFS/WCS services. Indien de service een WMS is, kan de laag getoond worden in de kaartviewer.",addOnlineSourceTitle:"Link service aan metadata",addThumbnail:"Voeg toe",addToMap:"Voeg toe aan kaart: ",addWMSButtonText:"Voeg WMS toe",addWMSWindowTitle:"Een WMS laag toevoegen",address:"Adres",adminAction:"Ander",administration:"Beheer",advTextSearch:"Geavanceerde tekst zoekmogelijkheden",advancedSearchOptions:"Geavanceerde zoek opties",all:"allen",allInPage:"alles in de pagina",allWords:"Alle woorden",anyThesaurus:"Elke thesaurus",anyTime:"Uit elke tijdsperiode",applySelected:"Pas geselecteerde taak toe",associateDataset:"Link dataset metadata",associateService:"Link service metadata","autofill.tooltip":"Vul conditionele en verplichtte elementen aan die niet in de metadata aanwezig zijn",baseLayerList:"Ondergrond",cancel:"Annuleer","cancel.tooltip":"Verlaat de edit omgeving zonder bewaren",catalogue:"Catalogus",categories:"Categorien",category:"Categorie",changeDate:"Wijzigingsdatum",check:"Check",checkFailure:"Check dataset in externe node is mislukt.",chooseAType:"Kies een type",chooseAView:"Kies een voorstelling",chooseGroup:"Selecteer een groep",clear:"Wis",clearExtentTooltipText:"Verwijder begrenzing (ie. geen ruimtelijke criteria).",clearExtentTooltipTitle:"Verwijder begrenzing",clickToClose:"Klik om te sluiten",collapseAll:"Klap alle secties in",connectIssue:"Connectie probleem",connectIssueMsg:"Fout 404. Kan geen connectie maken met de catalogus via deze url",contactRole:"Contact rol",contactSelectionWindowTitle:"Contact selectie",create:"Aanmaken",createChild:"Creer child document",createIfNotExistButton:"Maak een nieuw metadata record",createLink:"Creren links ...",createRelation:"Creer relatie",createSmall:"Maak kleine thumbnail",creationDate:"Creatiedatum",crosses:"kruist",crsSelectionWindowTitle:"Cordinaten referentie systeem selectie",dataset:"Dataset",datasetFound:"Dataset gevonden en toegevoegd aan het kaartvoorbeeld.",datasetMd:"Dataset metadata",dateType:"Datum selectie op","delete":"Verwijder",delete19110Relation:"Verwijder relatie met objectencatalogus",deleteConfirm:"Weet u zeker dat u dit metadata document wil verwijderen?",deleteRecord:"Verwijder metadata document?",deleteRecordFailure:"Fout bij het verwijderen van het metadata document.",deleteRecordSuccess:"Metadata verwijderd.",digital:"Digitaal","disclaimer.buttonClose":"Sluiten","disclaimer.loading":"Laden...","disclaimer.windowTitle":"Disclaimer",discovery:"Ontdekken",displayHelpPanel:"Toon het help scherm.",displayInfoPanel:"Toon het informatie scherm.",downInPage:"Scroll naar beneden in de resultaten",download:"Download",downloadLink:"Download: ",downloadable:"Download",dragTooltipText:"Houd de linker muisknop ingedrukt en versleep de kaart.",dragTooltipTitle:"Verschuif kaart",drawCircle:"Teken cirkel",drawPolygon:"Teken polygoon",drawPolygonTT:"Klik op de knop en teken een polygoon door het aanklikken van punten op de kaart. Dubbelklik voor het laatste punt om de polygoon af te sluiten.",drawRectangle:"Teken rechthoek",duplicate:"Dupliceer",edit:"Wijzigen",editAttributes:"Beheer attributen",editing:"Bewerken ${title} (${uuid})",eitherWords:"Elk van de woorden",enableTooltip:"Activeer tooltips om informatie te krijgen over parameters.",encloses:"omvat",enterGetCapURL:"Geef een GetCapabilities URL voor het registreren van een nieuwe service.",error:"Fout",errorAndStatusMsg:"Fout. Status: ${status}, tekst: ${text}. Probeer opnieuw.",errorChangeProtocol:"Verwijder geploade bestand voor het wijzigen van het protocol van de online bron.",errorDatasetNotFound:"Dataset niet gevonden.",errorTitle:"Fout",exactPhrase:"Exacte zin",example:"Voorbeeld:",exportCsv:"Exporteer (CSV)",exportZip:"Exporteer (ZIP)",facetprotocol:"Online Bron",facetprotocols:"Online Bronnen",failure:"Gefaald",featureCat:"objectencatalogus",featureInfoTitle:"Attribuut-informatie",featureInfoTooltipText:"Klik in de kaart om attribuut informatie op te vragen van alle zichtbare lagen.",featureInfoTooltipTitle:"Attribuut informatie","featureInfoWindow.windowTitle":"Attribuut informatie",fileProcessedMsg:"Behandelde bestanden ${res} op de server",fileUploadWindow:"Opladen data of document",focusOnAny:"Geef focus aan het vrij zoeken veld.",focusOnLogin:"Spring naar het login formulier om de beheeromgeving te openen of log uit.",found:"Gevonden records",foundCRS:"Beschikbare cordinaatsystemen",foundContacts:"Beschikbare",foundKeywords:"Gevonden trefwoorden",from:"Van",fullTextSearch:"Volledige tekst zoeken",fullyOutsideOf:"volledig buiten",gazetteerAddressField1Label:"Postcode",gazetteerAddressField2Label:"Straat",gazetteerAddressField3Label:"Plaats",gazetteerAddressField4Label:"Gemeente",gazetteerAddressField5Label:"Huisnummer",gazetteerTooltipText:"Zoek een locatie op basis van een postcode, straatnaam, gemeente en/of plaats.",gazetteerTooltipTitle:"Zoek op basis van een adres",geoPublisherWindowTitle:"Geo-publicatie: ",getCapabilitiesLayer:"GetCapabilities laag",getMEF:"Exporteer (ZIP)",grid:"Grid",group:"Groep",hardCopy:"Harde kopie",help:"Help",helper:"Suggestie:",hideBigMap:"Sluit kaart en toon zoekresultaten",hideSearchForm:"Toon of verberg het zoekformulier.",hitsPerPage:"Aantal resultaten per pagina",image:"Beeld",importMetadata:"Importeer metadata",imprecise:"Niet exact",infoTitle:"Informatie",inspireClassificationDataServices:"INSPIRE classificatie data services",inspireSearchOptions:"INSPIRE criteria",inspireannex:"INSPIRE annex",inspirerelated:"Gerelateerd aan INSPIRE",inspirerelatedtt:"INSPIRE dataset met rapport over de conformiteit volgens de data specificaties",inspiretheme:"INSPIRE thema",interactive:"Interactief",intersection:"doorsnijdt",item:"onderdeel",items:"onderdelen",keyword:"Trefwoord",keywordSelectionWindowTitle:"Trefwoord selectie",keywords:"Trefwoorden",kind:"Soort",large:"Groot",lastUpdate:"Laatste wijziging: ","layerInfoPanel.descriptionField":"Samenvatting","layerInfoPanel.queryableField":"Bevraagbaar","layerInfoPanel.titleField":"Titel","layerInfoPanel.windowTitle":"Metadata van de kaartlaag",layerList:"Kaartlagen",layerManagerTabTitle:"Kaartlagenbeheer",layerName:"Laagnaam",layerStylesPreviewTitle:"Maak een voorbeeld van de legenda",layerStylesWindowTitle:"Kaartlaag stijlen",layerTree:"Lagenbeheer",layout:"Layout",legendTabTitle:"Legenda",licenses:"Licenties",linkedMetadataSelectionWindowTitle:"Gerelateerde metadata selectie","loadLayer.error.message":"De kaartlaag kon niet worden geladen","loadLayer.error.title":"Ophalen kaartlaag","loadLayer.loadingMessage":"Ophalen kaartlaag",loadwmcTooltipText:"Opent een bestaand Web Map Context document in de kaart viewer",loadwmcTooltipTitle:"Open WMC",login:"Inloggen",logoSelect:"Selecteer een logo",logoSelectionWindow:"Kies een logo",logout:"Uitloggen",mapNearYou:"Centreer de kaart op uw locatie",mapPreview:"Kaartvoorbeeld",mapTypes:"Kaarttypes",massiveOp:"Bulk operatie",maxResults:"Aantal resultaten",md:"Metadata",mdChangeDate:"Metadata wijzigingsdatum",mdEditor:"Metadata editor",mdMenu:"Acties",mdResultsLayer:"Zoekresultaten",mdTitle:"Metadata titel",metadataButtonText:"Metadata",metadataCategories:"Metadata categorien","metadataResults.alertText":"Geen metadata resultaten om te tonen","metadataResults.alertTitle":"Metadata resultaten","metadataResults.buttonText":"Metadata resultaten","metadataResults.tooltipText":"Ga naar de metadata resultaatpagina","metadataResults.tooltipTitle":"Metadata resultaten",metadatatype:"Bron type","mf.error":"Fout","mf.information":"Afdrukken","mf.print.comment":"Opmerkingen","mf.print.dpi":"Resolutie","mf.print.generatingPDF":"Aanmaken PDF","mf.print.mapTitle":"Titel","mf.print.pdfReady":"PDF klaar","mf.print.print":"Print","mf.print.resetPos":"Terug naar begininstellingen","mf.print.rotation":"Rotatie","mf.print.scale":"Schaal","mf.print.unableToPrint":"Het printen is niet gelukt, probeer het later nogmaals.",minorEdit:"Kleine wijziging",minorEditTT:"Bewaar aangepaste metadata zonder verandering van metadata datum",minorEditTT:"Bewaar aangepaste metadata zonder verandering van metadata datum",model:"Feature catalogus",modificationDate:"Modificatiedatum",nearYou:"nabij",newMetadata:"Nieuwe metadata",newMetadataTitle:"Maak metadata aan opbasis van een gekozen template en groep",newOwner:"Nieuwe eigenaar",newWindow:"Nieuw venster",nextPage:"Volgende pagina",nextTooltipText:"Klik op deze knop om verder te gaan naar de volgende kaartbegrenzing",nextTooltipTitle:"Volgende kaartbegrenzing",noInfo:"Geen informatie",noSuggestion:"Geen suggestie.",noimages:"Geen afbeeldingen om te tonen",none:" ",noneSelected:"Niets geselecteerd",notDetermined:"Onbepaald",notValid:"Niet geldig",onSelection:"Bij selectie",opacityButtonText:"Transparantie",opacityWindowTitle:"Transparantie",openAdmin:"Ga naar beheer",options:"Opties",org:"Organisatie",otherActions:"Andere acties",outOfMemoryError:"Geheugen fout.",overlaps:"overlapt",overlaysList:"Kaartlagen",ownerName:"Metadata record eigenaar",parentMd:"Parent metadata",password:"Paswoord",perThesaurus:" per thesaurus",permalinkInfo:"Neem een link naar deze pagina over in een email of document",popularity:"Populariteit",precise:"Exact",prepareDownload:"Download bestanden",previosTooltipText:"Klik op deze knop om terug te gaan naar de vorige kaartbegrenzing",previousPage:"Vorige pagina",previousTooltipTitle:"Vorige kaartbegrenzing",printLayer:"Print pagina",printSel:"Exporteer (PDF)",printTT:"Print. Open een nieuwe pagina voor het printen.",printTooltipText:"Print de huidige kaart",printTooltipTitle:"Print",privileges:"Rechten",privilegesTT:"Beheer van record privileges voor de Internet en alle catalogus groepen.",process:"Behandeling",processParametersWindow:"Taak parameters",projectionTitle:"Projectie",publicationDate:"Publicatiedatum",publish:"Publiceer",publishError:"Publicatie gefaald.",publishErrorCode:"foutcode:",publishLayerAdded:" Laag toegevoegd aan het kaartvoorbeeld.",publishSuccess:"Publicatie geslaagd.",publishTooltip:"Publiceer de huidige dataset naar een externe node. Indien de dataset reeds bestaat in de node, wordt deze bijgewerkt.",publishing:"Publiceren ...",rating:"Score",record:"record",records:"records",recordsFound:" record(s) found",relatedResources:"Gerelateerde metadatarecords",relatedchildren:"Gerelateerd child document",relatedchildren:"Gerelateerde child documenten",relateddatasets:"Gerelateerde datasets",relatedfcats:"Gerelateerde objectencatalogus",relatedhasfeaturecat:"Datasets",relatedparent:"Gerelateerd parent document",relatedrelated:"Gerelateerd document",relatedservices:"Gerelateerde service",relatedservices:"Gerelateerde services",relatedsources:"Bron datasets",relationType:"Relatie type",relevance:"Relevantie",removeButtonText:"Verwijderen",removeSelected:"Verwijder selectie",reset:"Herstel","reset.tooltip":"Verwijder de niet opgeslagen aanpassingen",resetSearchForm:"Verwijder de zoekcriteria",resourceType:"Type",restrictSearchToMap:"Beperk zoekactie tot kaartbegrenzing",resultBy:" resultaat(en) / ",rsIdentifier:"Bronidentificator",runASearch:"Zoeken",save:"Bewaar","save.tooltip":"Bewaar de aangemaakte metadata",saveAndCheck:"Bewaar en controleer","saveAndCheck.tooltip":"Bewaar de aangemaakte metadata en voer validatie uit",saveAndClose:"Bewaar en sluit","saveAndClose.tooltip":"Bewaar de aangemaakte metadata en sluit de edit omgeving",saveRdf:"Save as RDF","saveWMCFile.errorSaveWMC":"Kon het WMC bestand niet opslaan","saveWMCFile.windowTitle":"Opslaan Web Map Context",saveXml:"Bewaar als XML",savewmcTooltipText:"Sla een Web Map Context document op",savewmcTooltipTitle:"Opslaan WMC",scale:"Schaal",scaleAsc:"Schaal (oplopend)",scaleDesc:"Schaal (aflopend)",scaleNominator:"1:",scaleTitle:"Schaal",scalingFactor:"Schaalfactor",search:"Zoeken",searchOptionButton:"Zoek",searchResults:"Zoekresultaten",searching:"Zoeken...",select:"Selecteer",selectANode:"Selecteer een node ...",selectExtentTooltipText:"Begrens het zoekgebied door in de kaart een kader te trekken en kies 1 van de gebiedsfilters.",selectExtentTooltipTitle:"Begrens zoekgebied",selectFile:"Selecteer een bestand",selectImage:"Selecteer een afbeelding",selectRegion:"Selecteer in een gebied...",selectStyleButton:"Selecteer kaartstijl",selectWMCFile:" ","selectWMCFile.errorLoadingWMC":"Kon het Web Map Context bestand niet openen","selectWMCFile.loadButtonText":"Openen","selectWMCFile.mergeButtonText":"Samenvoegen","selectWMCFile.waitLoadingWMC":"Laden Web Map Context","selectWMCFile.windowTitle":"Openen Web Map Context",selected:"geselecteerd",selected:"Geselecteerd",selectedCRS:"Geselecteerde cordinaatsystemen",selectedContacts:"Geselecteerder contacten",selectedKeywords:"Geselecteerde trefwoorden",series:"Datasetserie",service:"Service",serviceMd:"Service metadata",serviceType:"Service type",serviceType_discovery:"Discovery Service (ontdekken)",serviceType_download:"Download Service",serviceType_invoke:"Invoke Spatial Data Service (aanroepen)",serviceType_other:"Andere Services (ander)",serviceType_transformation:"Transformation Service (transformatie)",serviceType_view:"View Service (bekijken)",setCategories:"Stel categorien in",setPrivileges:"Stel rechten in",setStatus:"Metadata status",setVersioning:"Versies bijhouden van metadata",similarity:"Zoek nauwkeurigheid",simpleViewMode:"Eenvoudige voorstelling",small:"Klein",smallScalingFactor:"Kleine schaalfactor",sortBy:"Sorteer volgens",spatialRepType:"Ruimtelijke voorstelling",spatialSearch:"Ruimtelijke criteria",status:"Status",statusInformation:"Status informatie.",statusTT:"Verander de status van een record",stereoModel:"Stereo model",subTemplateImport:"Map importeren",success:"Succesvol",suggestion:"Suggestie",suggestions:"Suggesties",switchMode:"Wijzig de visualisatie modus.",tagName:"Element naam:",tempExtent:"Inhoudelijke geldigheid",textTable:"Tekst, tabel",thumbnailUploadWindow:"Oploaden thumbnail",thumbnails:"Thumbnails",tin:"Tin",title:"Titel",to:"Tot",toggleLayerManager:"Toon lagenbeheer",touches:"raakt aan",tpl:"Template",tplTitle:"Template omschrijving",type:"Recordtype","type.tooltip":"Verander recordtype voor het aanmaken van een template",unpublish:"Maak publicatie ongedaan",unpublishError:"Publicatie ongedaan maken is mislukt. ",unpublishSuccess:"Publicatie ongedaan maken geslaagd.",unpublishTooltip:"Verwijder huidige dataset van de externe node.",upInPage:"Scroll naar boven in de resultaten",updateCategories:"Wijzig categorien",updateChildren:"Wijzigen children",updatePrivileges:"Wijzig rechten",updateStatus:"Status bijwerken",updateVersion:"Bijhouden van versies activeren",upload:"Opladen",uploading:"Opladen...",username:"Gebruikersnaam",valid:"Geldig",validateWfs:"WFS validatie",validateWms:"WMS validatie",validationReport:"Validatierapport",validationStatus:"Validatie status",validityInfo:"Validatie status: ",vector:"Vector",versioning:"Start versie beheer",versioningTT:"Eenmaal geactiveerd, zullen alle wijzigingen bijgehouden worden in een Subversion repository",video:"Video",view:"Bekijk",viewKml:"Open in GoogleEarth: ",viewMode:"Voorstellingswijze","viewMode.tooltip":"verander de presentatie van de metadata",visualization:"Visualisatie",warning:"Waarschuwing",webLink:"Hyperlink: ",when:"Wanneer?",within:"binnen in",withoutWords:"Zonder de woorden",wkt:"WKT geometrie",wmsTimeUpdateButtonText:"Doorvoeren",xTitle:"X",xmlData:"XML",yTitle:"Y",zoomTo:"Zoom naar",zoomToMaxExtentTooltipText:"Klik op deze knop om naar het volledig kaartbeeld te zoomen.",zoomToMaxExtentTooltipTitle:"Volledig kaartbeeld",zoominTooltipText:"Trek een kader in kaart om in te zoomen. Ook kan er geklikt worden in de kaart waarna er met een factor 2 ingezoomd wordt.",zoominTooltipTitle:"Zoom in","zoomlayer.selectLayerText":"Geen laag geselecteerd","zoomlayer.selectLayerTitle":"Zoom naar laag",zoomlayerTooltipText:"Gebruik deze knop om naar de volledige begrenzing van de geselecteerde laag te zoomen.",zoomlayerTooltipTitle:"Zoom naar laag",zoomoutTooltipText:"Klik in de kaart om gecentreerd op dit punt met een factor 2 uit te zoomen. Ook kan er een kader in de kaart getrokken worden, hoe kleiner dit kader hoe verder er uitgezoomd zal worden.",zoomoutTooltipTitle:"Zoom uit",feedbackPanelTitle:"Met dit formulier kunt u feedback geven op metadata, data en/of services.",feedbackWindowTitle:"feedback",feedbackcancel:"Annuleren",feedbackcategory:"Categorie",feedbackcontact:"Contact",feedbackcontactDetails:"Contact gegevens",feedbackcontentManagement:"Contentbeheer",feedbackdataContent:"Data inhoud",feedbackemail:"E-mail",feedbackerror:"Fout",feedbackerrorMsg:"Er is een fout opgetreden bij het verzenden. Probeert u het later nog eens.",feedbackerrorTitle:"Opgelet",feedbackfeedback:"Feedback",feedbackfemale:"V",feedbackfunction:"Functie",feedbackharvesting:"Harvesting",feedbackmale:"M",feedbackmapViewer:"Kaartviewer",feedbackmetadataContent:"Metadata inhoud",feedbackmetadataData:"Metadata gegevens",feedbackmetadataEdit:"Metadata bewerken",feedbackmetadataImport:"Metadata importeren",feedbacknameInitials:"Naam, Voorletter(s)",feedbackorganization:"Organisatie",feedbackorganizations:"Organisaties",feedbackother:"Anders",feedbackphone:"Telefoon",feedbackposition:"Functie",feedbackquestion:"Vraag",feedbackremark:"Opmerking",feedbackremarks:"Opmerkingen",feedbacksearch:"Zoeken",feedbackserviceContent:"Service inhoud",feedbacksubmit:"Verzenden",feedbacksupport:"Support",feedbacktitle:"Titel",feedbackvalidator:"Validator","add-extent-from-geokeywordsreplace":"Vervang bestaande begrenzing","add-info-from-wmssetAndReplaceExtent":"Vervang bestaande begrenzing","add-info-from-wmssetCRS":"Stel het cordinaatreferentie systeem in","add-info-from-wmssetDynamicGraphicOverview":"Stel het grafisch overzicht in (gebruik makend van de GetMap request URL)","add-info-from-wmssetExtent":"Stel begrenzing in","add-info-from-wmswmsServiceUrl":"Service URL","add-service-info-from-wxssetAndReplaceOperations":"Vervang bestaande bewerkingen","add-service-info-from-wxswxsServiceUrl":"Service URL","linked-data-checkerlinkUrl":"URL om te verwijderen","related-metadata-checkeruuidToRemove":"Identificator om te verwijderen",Activated:"Geactiveerd",Theme:"Thema",ThesaurusName:"Thesaurus naam",Type:"Type",addTplElTT:"Voeg een element toe van een XML fragment aan een folder. De doelfolder is gebaseerd op de naam van het root element (eg. gmd:CI_ResponsibleParty).",copyTplElTT:"Maak een nieuw element in de folder voor de huidige selectie.",createDateYear:"Jaar",createDateYears:"Jaar",createThesaurusFromRepository:"van thesaurus bron",createThesaurusFromURL:"van URL",creationMode:"Maak",definition:"-",delTplElTT:"Verwijder geselecteerd element uit de folder.",denominator:"Schaal",denominators:"Schaal",directory:"Folder",emptyThesaurus:"Nieuwe lege thesaurus",externalThesaurusURL:"URL",id:"Identificator",label:"Label",language:"Taal",manageDirectories:"Beheer folders",metadataPOC:"metadata point of contact",metadataPOCs:"Metadata point of contact",newDefinition:"Definitie",newLabel:"Label",orgName:"organization",orgNames:"Organisaties",privTplElTT:"Beheer rechten voor de huidige selectie.",removeFilter:"Verwijderen",selDirectoryTT:"Selecteer een foldertype. Een folder groepeert alle elementen met dezelfde naam voor het root element (eg. gmd:CI_ResponsibleParty is een contact folder)",serviceTypes:"Servicetype",spatialRepresentationType:"spatial type",spatialRepresentationTypes:"Spatial types",thesaurusCreation:"Voeg een thesaurus toe",thesaurusFilePath:"Thesaurus bestand (.rdf)",thesaurusFromFile:"Van lokaal bestand",thesaurusFromRepository:"Thesaurus",thesaurusFromURL:"Van extern bestand (URL)",thesaurusManager:"Beheer Thesaurus",types:"Brontype",xmax:"X max",xmin:"X min",ymax:"Y max",ymin:"Y min",About:"Over",Advanced:"Geavanceerd",BROWSE:"Zoeken",CSV:"Text CSV",E_geometry:"Waar",GML2:"GML 2",GML3:"GML 3",Home:"Home",List:"Lijst",Map:"Kaart",Map:"Kaart",Poweredby:"Door","SEARCH RESULTS":"Zoekresultaten","SHAPE-ZIP":"ESRI Shapefile",Searchforspatialdataon:"Zoek ruimtelijke data over",What:"Wat",When:"Wanneer",Where:"Waar",chooseALayer:"Kies een kaartlaag",cookies:"Cookies","cookies.warning":"<p>Deze website maakt gebruik van cookies. Een cookie is een klein bestandje dat met paginas van deze website wordt meegestuurd en door uw browser wordt opgeslagen op uw harde schijf of in het geheugen van uw computer.</p><p>Cookies op deze website worden gebruikt voor login doeleinden en om uw gebruik van onze website te analyseren, zodat we functionaliteiten daarop kunnen aanpassen. Ze zullen nooit worden gebruikt om gebruikers te volgen.</p>",dataDownload:"Download data",defineExtractionArea:"Definieer extractie gebied",extractorTitle:"Download data van ",facetLess:"- Toon minder",facetMore:"+ Toon meer","linklabel-":"Link","linklabel-OGC:WFS":"WFS link","linklabel-OGC:WMS":"Aan kaart toevoegen","linklabel-WWW:DOWNLOAD-1.0-http--download":"Download","linklabel-application/vnd.google-earth.kml+xml":"Bekijk in Google Earth","linklabel-application/vnd.ogc.wms_xml":"Aan kaart toevoegen","linklabel-application/x-compressed":"Download","linklabel-application/zip":"Download","linklabel-download":"Link","linklabel-image/png":"Image link","linklabel-text/html":"Hyperlink","linklabel-text/plain":"Hyperlink",org:"Organisatie",outputFormat:"Output formaat",rule:"rule",rules:"rules","schematron-rules-geonetwork":"GeoNetwork validatie","schematron-rules-inspire":"INSPIRE validatie","schematron-rules-iso":"ISO validatie","template.FULL":"Verander de presentatie van de zoekresultaten, uitgebreide presentatie","template.SIMPLE":"Verander de presentatie van de zoekresultaten, eenvoudige presentatie","template.THUMBNAIL":"Verander de presentatie van de zoekresultaten, preview presentatie",wfsVersion:"Service versie","wxs-extract-layer-not-found":"Kaartlaag ${layer} niet gevonden in WFS (http://geonetwork-opensource.org/geonetwork-client).","wxs-extract-service-not-found":"Fout bij het verbinden met de service http://geonetwork-opensource.org/geonetwork-client. ${misc}.",xsd:"ISO schema","Add Bookmark":"Maak bladwijzer","Copy to Clipboard":"Kopieer naar klembord","Other Restrictions":"Toegangsrestricties","Public Domain":"Publiek domein verklaring","Creative Commons Attribution":"Creative Commons Naamsvermelding","Creative Commons Zero":"Vrij van auteursrechtelijke aanspraak",RatingText:"Voeg beoordeling toe",download:"Download data",E_any_OR_geokeyword_OR_title_OR_keyword:"Vrije tekst","WMTS.error.message":"Kan dese service niet toevoegen aan de kaart vanwege een ongeldig capabilities document.",addLayer:"Toon op kaart",inspirecategory:"Aangemerkt voor INSPIRE","metadata.notFound":"De metadata die u probeert te openen bestaat niet of u heeft onvoldoende rechten om deze te bekijken.",yes:"Ja",areafilter_label:"Gebiedsfilter",areafilter_national:"Alleen landsdekkend",areafilter_only_regional:"Alleen regionaal",areafilter_regional_and_national:"Regionaal + landsdekkend"};
OpenLayers.Util.extend(OpenLayers.Lang.nl,GeoNetwork.Lang.nl);
Ext.namespace("GeoNetwork","GeoNetwork.Lang");
GeoNetwork.Lang.pl={previousPage:"Przejd do poprzedniej strony",nextPage:"Przejd do nastpnej strony",upInPage:"Przewi w gr w wynikach",downInPage:"Przewi w d w wynikach",example:"Przykad:",noInfo:"Brak informacji",helper:"Sugestia:",toggleLayerManager:"Wywietl menagera warstw",tagName:"Nazwa elementu:",enableTooltip:"Wcz podpowiedzi, aby uzyska wicej informacji.",connectIssue:"Problem z poczeniem do katalogu",connectIssueMsg:"Bd 404. Nie mona poczy si z URL katalogu ",featureInfoTooltipTitle:"Informacje o obiekcie",featureInfoTooltipText:"Kliknij w oknie mapy, aby uzyska informacje o obiektach z wszystkich widocznych warstw.",zoomToMaxExtentTooltipTitle:"Peny zasig",zoomToMaxExtentTooltipText:"Uyj tego przycisku, aby wywietli peny zasig.",zoominTooltipTitle:"Zbli",zoominTooltipText:"Kliknij na mapie lub narysuj prostokt, aby zbliy.",zoomoutTooltipTitle:"Oddal",zoomoutTooltipText:"Kliknij na mapie lub narysuj prostokt, aby oddali.",dragTooltipTitle:"Przesu",dragTooltipText:"Wcinij lewy przycisk myszy, aby przesunc map.",previousTooltipTitle:"Poprzedni zakres mapy",previosTooltipText:"Kliknij ten przycisk, aby przej do poprzedniego zakresu mapy",nextTooltipTitle:"Nastpny zakres mapy",nextTooltipText:"Kliknij ten przycisk, aby przej do nastpnego zakresu mapy",featureInfoTitle:"Informacje o obiekcie",layerManagerTabTitle:"Manager warstw",legendTabTitle:"Legenda",scaleTitle:"Skala",xTitle:"X",yTitle:"Y",projectionTitle:"Odwzorowanie",FeatureInfoNotQueryable:"Brak warstw z informacjami o obiektach",WMSBrowserTab1:"Wybierz",WMSBrowserTab3:"Zdalny",WMSBrowserPreviewTitle:"Podgld",WMSBrowserAddButton:"Dodaj",WMSBrowserDuplicateMsg:"Warstwa jest ju na mapie",WMSBrowserPreviewWaitMsg:"Pobieranie miniaturki",WMSBrowserConnectButton:"Pocz",WMSBrowserConnectError:"Wystpi problem podczas czenia z usug WMS. Sprawd URL.",infoTitle:"Informacje","mf.print.mapTitle":"Tytu","mf.print.comment":"Komentarz","mf.print.dpi":"Rozdzielczo","mf.print.scale":"Skala","mf.print.rotation":"Kt","mf.print.resetPos":"Resetuj","mf.print.print":"Drukuj","mf.print.generatingPDF":"Generowanie PDF","mf.print.unableToPrint":"Drukowanie nie powiodo si, sprbuj ponownie pniej","mf.error":"Bd",selectExtentTooltipTitle:"Wska zakres",selectExtentTooltipText:"Wska zakres dla wyszukiwania",clearExtentTooltipTitle:"Usu zakres",clearExtentTooltipText:"Usu zakres (np. brak warunkw wyszukiwania przestrzennego)",printTooltipTitle:"Drukuj",printTooltipText:"Drukuj widoczn map",savewmcTooltipTitle:"Zapisz widok mapy",savewmcTooltipText:"Zapisuje aktualny widok mapy","saveWMCFile.windowTitle":"Zapisz widok mapy","saveWMCFile.errorSaveWMC":"Nie udao si zapisa mapy",loadwmcTooltipTitle:"Wczytaj widok mapy",loadwmcTooltipText:"Wczytuje widok mapy","selectWMCFile.windowTitle":"Wczytaj widok mapy",selectWMCFile:"Wska plik widoku mapy","selectWMCFile.waitLoadingWMC":"Wczytywanie widoku mapy","selectWMCFile.loadButtonText":"Wczytaj","selectWMCFile.mergeButtonText":"Pocz","selectWMCFile.errorLoadingWMC":"Nie udao si wczyta widoku mapy",opacityButtonText:"Przezroczysto",opacityWindowTitle:"Przezroczysto",metadataButtonText:"Metadane",removeButtonText:"Usu",addWMSButtonText:"Dodaj WMS",addWMSWindowTitle:"Dodaj warstw z WMS","layerInfoPanel.windowTitle":"Informacje o warstwie","layerInfoPanel.titleField":"Tytu","layerInfoPanel.descriptionField":"Opis","layerInfoPanel.queryableField":"Przeszukiwalna",layerList:"Lista warstw",baseLayerList:"Warstwy podstawowe",overlaysList:"Warstwy tematyczne","metadataResults.buttonText":"Wyniki wyszukiwania","metadataResults.tooltipTitle":"Wyniki wyszukiwania","metadataResults.tooltipText":"Przejd do strony wynikw wyszukiwania","metadataResults.alertTitle":"Wyniki wyszukiwania","metadataResults.alertText":"Brak wynikw do wywiewtlenia","featureInfoWindow.windowTitle":"Informacje o obiekcie","mf.information":"Drukuj","mf.print.pdfReady":"PDF gotowy","loadLayer.loadingMessage":"adowanie warstwy","loadLayer.error.title":"Wczytaj warstw","loadLayer.error.message":"Nie udao si wczyta warstwy","disclaimer.windowTitle":"Owiadczenie","disclaimer.loading":"Wczytywanie...","disclaimer.buttonClose":"Zamknij",gazetteerAddressField1Label:"Kod potowy",gazetteerAddressField2Label:"Ulica",gazetteerAddressField3Label:"Miejsce",gazetteerAddressField4Label:"'Miasto'",gazetteerAddressField5Label:"Numer budynku",searchOptionButton:"Szukaj",resetSearchForm:"Wyczyc formularz wyszukiwania.",GazetteerWindowTitle:"Znajd adres",searchResults:"Wyniki wyszukiwania",errorTitle:"Bd",SearchOptionLoadFailureMsg:"Brak wynikw. \n Usuga moe nie by dostpna. \n",gazetteerTooltipTitle:"Wyszukiwanie na podstawie adresu",gazetteerTooltipText:"Wyszukiwanie pooeniana podstaie kodu pocztowego, ulicy, miasta lub miejsca",SearchOptionNoResults:"Nie znaleziono wynikw",zoomlayerTooltipTitle:"Zbli do zasigu warstwy",zoomlayerTooltipText:"Uzyj tego przycisku, aby wywietli peny zakres warstwy.","zoomlayer.selectLayerTitle":"Zbli do warstwy","zoomlayer.selectLayerText":"NNie wybrano adnej warstwy",layerStylesWindowTitle:"Style",layerStylesPreviewTitle:"Podgld legendy",selectStyleButton:"Wybierz styl",WMSTimeWindowTitle:"Czas WMS",WMSTimePositionTitle:"Wybierz pooenie czasowe",WMSTimeMovieTitle:"Poka animacj",wmsTimeUpdateButtonText:"Zastosuj",WMSTimeAnimationCheckbox:"Odtwrz w ptli film obejmujcy ostatnie $ {kroki}",fullTextSearch:"Wyszukiwanie w caym tekcie",keyword:"Sowo kluczowe",org:"Organizacja",mapTypes:"Typ mapy",rsIdentifier:"Identyfikator zasobu",inspireSearchOptions:"Kryteria INSPIRE",inspireannex:"Aneks INSPIRE",inspirerelated:"Powizane z INSPIRE",inspirerelatedtt:"Zbir danych zawierajcy raport zgodnoci",inspiretheme:"Temat danych INSPIRE",inspireClassificationDataServices:"Klasyfikacja usug danych INSPIRE",serviceType:"Typ usugi",serviceType_discovery:"Usuga wyszukiwania (discovery)",serviceType_view:"Usuga wywietlania (view)",serviceType_transformation:" Usuga transformacji (transformation)",serviceType_invoke:"Usuga uruchamiania usug (invoke)",serviceType_other:"Inna usuga (other)",similarity:"Precyzja wyszukiwania",wkt:"Geometria WKT",simpleViewMode:"Widok podstawowy",spatialSearch:"Kryteria przestrzenne",mdChangeDate:"Data modyfikacji metadanych",tempExtent:"Zakres czasowy",creationDate:"Data utworzenia",modificationDate:"Data modyfikacji",publicationDate:"Data publikacji",hitsPerPage:"Liczba wynikw na stronie",sortBy:"Sortuj wg",relevance:"Trafno",options:"Opcje",title:"Tytu",changeDate:"Data modyfikacji",rating:"Ocena",popularity:"Popularno",scaleDesc:"Skala (malejco)",scaleAsc:"Skala (rosnco)","abstract":"Streszczenie",catalogue:"Katalog",group:"Grupa",chooseGroup:"Wybierz grup",md:"Metadane",tpl:"Wzorzec",category:"Kategoria",advTextSearch:"Opcje zaawansowanego wyszukiwania",eitherWords:"Jedno ze sw",exactPhrase:"Dokadne fraza",allWords:"Wszystkie sowa",withoutWords:"Bez tych sw",precise:"Precyzyjne",imprecise:"Nieprecyzyjne",relationType:"Typ relacji",within:"wewntrz",touches:"dotyka",crosses:"przecina",fullyOutsideOf:"cakowicie poza",encloses:"zawiera",overlaps:"nakada si",intersection:"przecicie",nearYou:"Blisko Ciebie",from:"od",to:"do",scaleNominator:"1:",scale:"Skala",digital:"Cyfrowy",hardCopy:"Twarda kopia",download:"Pobierz",downloadable:"Pobieralny",interactive:"Interaktywny",resourceType:"Typ zasobu",dataset:"Zbir danych",series:"Seria",service:"Usuga",model:"Feature catalogue",spatialRepType:"Reprezentacja przestrzenna",video:"Wideo",vector:"Wektor",textTable:"tekst, tabela",tin:"Tin",stereoModel:"Model stereo",grid:"Raster",kind:"Rodzaj",enterGetCapURL:"Wprowad URL GetCapabilities aby zarejestrowa now usug.",edit:"Edycja",duplicate:"Powiel","delete":"Usu",createChild:"Utwrz dziecko",privileges:"Uprawnienia",privilegesTT:"Zarzdzaj uprawnieniami dla Internetu i grup w katalogu.",categories:"Kategorie",otherActions:"Inne akcje",permalinkInfo:"Wklej link do e-maila lub komunikatora",view:"Wywietl",zoomTo:"Zbli do",saveXml:"Zapisz jako XML",exportCsv:"Export (CSV)",exportZip:"Export (ZIP)",printSel:"Export (PDF)",printTT:"Drukuj. Otwrz now strone wydruku.",newOwner:"Nowy waciciel",updateCategories:"Aktualizuj kategori",updatePrivileges:"Aktualizuj uprawnienia",noneSelected:"Nic nie wybrano",none:"adne",all:"Wszystkie",allInPage:"Wszystkie na stronie",select:"Wybierz ",username:"Nazwa uytkownika",password:"Haso",login:"Logowanie",logout:"Wylogowanie",administration:"Administracja",validationReport:"Raport walidacji",setStatus:"Status metadanych",status:"Status",updateStatus:"Zaktualizuj status",updateVersion:"Aktywuj wersjonowanie",statusTT:"Zmie status rekordu, zgodnie z jego faz cyklu ycia",setVersioning:"Wersjonowanie metadanych",versioning:"Rozpocznij wersjonowanie",versioningTT:"Uruchomienie wersjonowania pliku spowoduje zapis wszystkich zmian w pliku w repozytorium SVN",items:"Elementy",item:"Element",thumbnails:"Miniaturki",noimages:"Brak obrazw do wywietlenia",add:"Dodaj",small:"May",large:"Duy",selectImage:"Wska obraz",selectFile:"Wska plik",image:"Obraz",uploading:"Wysyanie ...",upload:"Wylij",success:"Powodzenie",failure:"Poraka",error:"Bd",save:"Zapisz",reset:"Resetuj",fileProcessedMsg:"Przetwarzanie pliku ${res} na serwerze",suggestion:"Sugestia",logoSelect:"Sybierz logo",relatedResources:"Powizanie zasoby",createLink:"Utrz cza ...",featureCat:"Katalog obiektw",serviceMd:"Metadane usugi",datasetMd:"Metadane zbioru danych",parentMd:"Metadane rodzica",updateChildren:"Aktualizuj dzieci",records:"Rekordy",record:"Rekord",help:"Pomoc",publishError:"Publikacja nieudana.",outOfMemoryError:"Brak pamici.",publishErrorCode:"Kod bedu:",saveAndCheck:"Zapisz i sprawd",saveAndClose:"Zapisz i zamknij",cancel:"Anuluj",layout:"Rozmieszczenie",collapseAll:"Zwi wszystkie sekcje",editAttributes:"Zarzdzaj atrybutani",chooseAType:"Wybierz typ",chooseAView:"Wybierz widok",viewMode:"Tryb widoku",errorAndStatusMsg:"Bd. Status: ${status}, tekst: ${text}. Sprbuj ponownie.",mdEditor:"Edytor metadanych",minorEditTT:"Nie aktualizuj stempla czasowego podczas zapisu",editing:"Edycja ${title} (${uuid})",GetCapabilitiesDocumentError:"Bd adowania dokumentu GetCapabilities usugi z URL: ",maxResults:"Ilo wynikw",mdTitle:"Tytu metadanych",keywords:"Sowa kluczowe",createRelation:"Dodaj relacj",createIfNotExistButton:"Create a new metadata recordUtwrz nowy plik metadanych",getCapabilitiesLayer:"GetCapabilities warstwy",layerName:"Nazwa warstwy",searching:"Wyszukiwanie ...",perThesaurus:" tezaurus",anyThesaurus:"Dowolny tezaurus",selectedKeywords:"Wybierz sowa kluczowe",foundKeywords:"Dostpne sowa kluczowe",clear:"Wyczy",publish:"Publikuj",publishTooltip:"Publikuj zbir na zdalnej usudze. Jeli zbir zosta ju opublikowany, zostanie zaktualizowany.",publishSuccess:"Publikacja zakoczona powodzeniem.",publishLayerAdded:" Warstwa dodana do podgldu.",unpublish:"Cofnij publikacj",unpublishTooltip:"Usu zbir ze zdalnej usugi.",unpublishSuccess:"Cofnicie publikacji zakoczone powodzeniem.",unpublishError:"Cofnicie publikacji nieudane. ",check:"Sprawd",errorDatasetNotFound:"Zbir danych nie zosta znaleziony.",datasetFound:"Odnaleziono zbir danych i dodano do podgldu.",checkFailure:"Nieudana kontrola zbioru w zdalnej usudze.",addOnlineSourceTitle:"Powi metadane usugi",addOnlineSource:"Dodaj cza",addOnlineSourceTT:"Dodaj sekcj rda w biecym rekordzie metadanych wskazujc na usug WMS/WFS/WCS services..",statusInformation:"Informacje o statusie.",publishing:"Publikowanie ...",mapPreview:"Podgld mapy",selectANode:"Wska wze ...",geoPublisherWindowTitle:"Geo-publikacja: ",keywordSelectionWindowTitle:"Sekcja sw kluczowych",crsSelectionWindowTitle:"Sekcja ukadw odniesienia",linkedMetadataSelectionWindowTitle:"Sekcja powizanych metadanych",NotOwnerError:"Nie masz uprawnie do edycji powizanego rekordu.",ServiceUpdateError:"Bd podczas aktualizacji metadanych usugi",associateService:"Pocz metadane usugi",associateDataset:"Poz metadane zbiorw",logoSelectionWindow:"Wybierz logo",fileUploadWindow:"Wylij dane lub metadane",selectedCRS:"Wybierz ukad odniesienia",foundCRS:"Dostpne ukady odniesienia",search:"Szukaj",restrictSearchToMap:"Ogranicz wyszukiwanie do zasigu mapy",selected:"Wybrane",selectRegion:"Wybierz region ...",drawRectangle:"Narysuj prostokt",drawPolygon:"Narysuj wielokt",drawPolygonTT:"Kliknij ma napie aby doda wierzchoek. Podwjne kliknicie koczy rysowanie wieloboku.",drawCircle:"Narysuj okrd",discovery:"Wyszukiwanie",visualization:"Wizualizacja",when:"Kiedy ?",anyTime:"Kiedykolwiek",onSelection:"Przy wyborze",adminAction:"Inne",newMetadata:"Nowe metadane",chooseTemplate:"Wybierz wzorzec",newMetadataTitle:"Create a metadata by choosing a template and selecting one group",tplTitle:"Template description",metadatatype:"Ressource type",process:"Przetwrz",suggestions:"Sugestie",applySelected:"Zastosuj wybrane zadanie",processParametersWindow:"Parametry zadania",noSuggestion:"Brak sugestii.",thumbnailUploadWindow:"Wylij miniaturk",addThumbnail:"Dodaj",createSmall:"Utwrz ma miniaturk",scalingFactor:"Wspczynnik skali",smallScalingFactor:"May wspczynnik skali",type:"typ elementu",clickToClose:"Kliknij aby zamkn",removeSelected:"Usu zaznaczone",ownerName:"Waciciel metadanych",setPrivileges:"Ustaw uprawnienia",setCategories:"Ustaw kategorie",massiveOp:"Masowa operacja ",prepareDownload:"Pobierz pliki",mdMenu:"Akcje",deleteRecord:"Usuna plik metadanych ?",deleteConfirm:"Jeste pewny, e chcesz usun wybrane metadane?",deleteRecordSuccess:"Usunito metadane.",deleteRecordFailure:"Bd podczas usuwania metadanych.",advancedSearchOptions:"Kryteria zaawansowane",relatedservices:"Powizane usugi",relatedchildren:"Dzieci",relatedfcats:"Powizany katalog obiektw",relatedhasfeaturecat:"Zbiory danych",relatedsources:"rdowe zbiory danych",getMEF:"Export (ZIP)",metadataCategories:"Kategorie metadanych",validityInfo:"Status walidacji: ",lastUpdate:"Ostatnia aktualizacja: ",importMetadata:"Importuj metadane",validationStatus:"Status walidacji",valid:"Poprawny",notValid:"Niepoprawny",notDetermined:"Nieokrelony",addToMap:"Dodaj do mapy: ",downloadLink:"Pobierz: ",webLink:"Link: ",viewKml:"Otwrz w GoogleEarth: ",layerTree:"Menager warstw",mdResultsLayer:"Wyniki wyszukiwania",printLayer:"Drukuj stron",relatedservices:"Powizane usugi",relatedparent:"Rodzic",relateddatasets:"Powizane zbiory danych",relatedchildren:"Dzieci",relatedrelated:"Link do zbioru/katalogu obiektw",delete19110Relation:"Usu relacj z katalogiem obiektw",newWindow:"Nowe okno",addAsXLink:"Dodaj jako powizany element",contactSelectionWindowTitle:"Sekacja informacji kontaktowych",selectedContacts:"Wybrane kontakty",foundContacts:"Dostpne",contactRole:"Rola",mapNearYou:"Wyrodkuj map na swoim pooeniu",errorChangeProtocol:"Usu wysany plik przed zmian protokou.",resultBy:" Wynik(i) / ",subTemplateImport:"Import wpisu",xmlData:"XML",minorEdit:"Drobna edycja",minorEditTT:"",runASearch:"Wyszukaj.",focusOnAny:"Przenie zaznaczenie do pola wyszukiwania w penym tekcie.",hideSearchForm:"Ukryj/poka formularz wyszukiwania.",switchMode:"Przecz widok.",resetSearchForm:"Wyczy formularz wyszukiwania.",focusOnLogin:"Przenie zaznaczenie do formularza logowania, aby uzyska dostp do narzdzi administracyjnych, lub wyloguj, jeli jeste zalogowany.",openAdmin:"Przejd do panelu administracyjnego",displayInfoPanel:"Pokarz panel informacji.",displayHelpPanel:"Poka pomoc.",SelectionWindowTitle:"Wybierz z katalogu",found:"Odnalezione rekordy",selected:"Zaznaczone",create:"Utwrz",feedbackcontactDetails:"Dane teleadresowe",feedbacknameInitials:"Imi i nazwisko, inicja (-y)",feedbackmale:"Mczyzna",feedbackfemale:"Kobieta",feedbackposition:"Stanowisko",feedbackorganization:"Organizacja",feedbackphone:"Telefon",feedbackemail:"Email",feedbackfeedback:"Sprzenie zwrotne",feedbackfunction:"Funkcja",feedbackquestion:"Pytanie",feedbackerror:"Bd",feedbackremark:"Uwaga",feedbackcontact:"Kontakt",feedbackcategory:"Kategoria",feedbackmetadataContent:"Content Metadata",feedbackdataContent:"Zawarto danych",feedbackserviceContent:"Zawarto usugi",feedbacksupport:"Wsparcie",feedbackmapViewer:"Map Viewer",feedbacksearch:"Szukaj",feedbackorganizations:"Organizacje",feedbackcontentManagement:"Content Management",feedbackmetadataImport:"Importowanie metadanych",feedbackmetadataEdit:"Edycja metadanych",feedbackharvesting:"Zbioru",feedbackvalidator:"Validator",feedbackother:"Inaczej",feedbackremarks:"Uwagi",feedbackmetadataData:"Metadanych",feedbacktitle:"Tytu",feedbackPanelTitle:"Za pomoc tego formularza moesz da komentarz na metadanych, danych i / lub usug.",feedbacksubmit:"Wysa",feedbackerrorTitle:"Zwraca uwag",feedbackerrorMsg:"Wystpi bd podczas wysyania. Prosimy sprbowa ponownie pniej.",feedbackcancel:"Anulowa",feedbackWindowTitle:"sprzenie zwrotne","add-extent-from-geokeywordsreplace":"Zastp bierzcy zakres","add-info-from-wmssetExtent":"Ustal zakres","add-info-from-wmssetAndReplaceExtent":"Zastp istniejcy zakres","add-info-from-wmssetCRS":"Ustaw ukad odniesienia","add-info-from-wmssetDynamicGraphicOverview":"Ustaw opis graficzny (na podstawie zapytania GetMap)","add-info-from-wmswmsServiceUrl":"URL Usugi","linked-data-checkerlinkUrl":"URL do usunicia","related-metadata-checkeruuidToRemove":"Identyfikator do usunicia","add-service-info-from-wxssetAndReplaceOperations":"Zastp istniejce operacje","add-service-info-from-wxswxsServiceUrl":"URL usugi",manageDirectories:"Zarzdzaj katalogami",directory:"Katalog",thesaurusManager:"Zarzdzaj tezaurusami",Theme:"Temat",thesaurusFilePath:"Plik tezaurusa (.rdf)",ThesaurusName:"Nazwa tezaurusa",createThesaurusFromURL:"z URL",createThesaurusFromRepository:"z repozytorium tezaurusa",creationMode:"Utwrz",thesaurusFromRepository:"Tezaurus",externalThesaurusURL:"URL",thesaurusCreation:"Dodaj tezaurus",Type:"Typ",Activated:"Aktywowany",emptyThesaurus:"Nowy, pusty tezaurus",thesaurusFromFile:"Z lokalnego pliku",thesaurusFromURL:"Ze zdalnedo pliku (URL)",id:"Identyfikator",label:"Etykieta",definition:"-",xmin:"X min",ymin:"Y min",xmax:"X max",ymax:"Y max",newLabel:"Etykieta",newDefinition:"Definicja",selDirectoryTT:"Wybierz typ katalogu. Katalog grupuje wszystkie elementy posiadajce wsplnego rodzica (np. gmd:CI_ResponsibleParty jest katalogiem dla informacji kontaktowych)",privTplElTT:"Zarzdzaj uprawnieniami dla zaznaczenia.",addTplElTT:"Dodaj fragment z XML. Katalog docelowy wybierany jest na podstawie gwnego elementu (np. gmd:CI_ResponsibleParty).",copyTplElTT:"Utrz nowy wpis na podstawie zaznaczenia.",delTplElTT:"Usu wpis z katalogu.",language:"Jzyk",metadataPOC:"metadata point of contact",metadataPOCs:"Metadata point of contact",spatialRepresentationType:"spatial type",spatialRepresentationTypes:"Spatial types",createDateYear:"year",createDateYears:"Years",denominator:"scale denominator",denominators:"Scale denominators",orgName:"organization",orgNames:"Organizations",serviceTypes:"Service types",facetMore:"+ Show more filters",facetLess:"- Show less filters",Home:"Strona startowa",Map:"Mapa",Poweredby:"Powered by",About:"O...",org:"Organizacja",keyword:"sowo kluczowe",when:"kiedy?",advancedSearchOptions:"Zaawansowane opcje wyszukiwania",hitsPerPage:"Liczba wynikw na stronie",Searchforspatialdataon:"Wyszukaj dane przestrzenne dla",search:"szukaj",fullTextSearch:"Wyszukiwanie w penym tekcie",reset:"czy",resetSearchForm:"Czy formularz wyszukiwania",Advanced:"Zaawansowane",newWindow:"Nowe okno",mdEditor:"Edytor metadanych",List:"Lista","linklabel-application/vnd.ogc.wms_xml":"Add to map","linklabel-OGC:WMS":"Add to map","linklabel-application/vnd.google-earth.kml+xml":"View in Google Earth","linklabel-application/zip":"Download","linklabel-WWW:DOWNLOAD-1.0-http--download":"Download","linklabel-application/x-compressed":"Download","linklabel-text/html":"Web link","linklabel-text/plain":"Web link","linklabel-image/png":"Image link","linklabel-":"Link"};
OpenLayers.Util.extend(OpenLayers.Lang.pl,GeoNetwork.Lang.pl);
Ext.namespace("GeoNetwork");
GeoNetwork.Lang={};
GeoNetwork.Util={defaultLocale:"eng",locales:[["en","English","eng"],["nl","Nederlands","dut"]],setLang:function(lang,baseUrl){lang=lang||GeoNetwork.Util.defaultLocale;
var openlayerLang=this.getISO2LangCode(lang);
OpenLayers.Lang.setCode(openlayerLang);
var s=document.createElement("script");
s.type="text/javascript";
s.src=baseUrl+"/js/ext/src/locale/ext-lang-"+openlayerLang+".js";
document.getElementsByTagName("head")[0].appendChild(s)
},getCatalogueLang:function(lang){var i;
for(i=0;
i<GeoNetwork.Util.locales.length;
i++){if(GeoNetwork.Util.locales[i][0]===lang){return GeoNetwork.Util.locales[i][2]
}}return"eng"
},getISO2LangCode:function(lang){var i;
for(i=0;
i<GeoNetwork.Util.locales.length;
i++){if(GeoNetwork.Util.locales[i][2]===lang){return GeoNetwork.Util.locales[i][0]
}}return"en"
},getParameters:function(url){var parameters=OpenLayers.Util.getParameters(url);
if(OpenLayers.String.contains(url,"#")){var start=url.indexOf("#")+1;
var end=url.length;
var paramsString=url.substring(start,end);
var pairs=paramsString.split(/[\/]/);
for(var i=0,len=pairs.length;
i<len;
++i){var keyValue=pairs[i].split("=");
var key=keyValue[0];
var value=keyValue[1]||"";
parameters[key]=value
}}return parameters
},getBaseUrl:function(url){return url.substring(0,url.indexOf("?")||url.indexOf("#")||url.length)
},protocolToCSS:{"application/vnd.ogc.wms_xml":"addLayerIcon","OGC:WMS":"addLayer","OGC:WMTS":"addLayer","OGC:WCS":"addLayer","OGC:WFS":"addLayer","OGC:KML":"addLayer","OGC:WFS-1.0.0-http-get-capabilities":"addLayer","OGC:WMS-1.1.1-http-get-capabilities":"addLayer","OGC:WMS-1.3.0-http-get-capabilities":"addLayer","OGC:WMS-1.1.1-http-get-map":"addLayer","OGC:WMS-1.3.0-http-get-map":"addLayer","application/vnd.google-earth.kml+xml":"md-mn-download","INSPIRE-ATOM":"md-mn-download","INSPIRE Atom":"md-mn-download","application/zip":"md-mn-download",download:"md-mn-download","WWW:DOWNLOAD-1.0-http--download":"md-mn-download","application/x-compressed":"md-mn-download","text/html":"md-mn-www","text/plain":"md-mn-www","WWW:LINK-1.0-http--ical":"md-mn-www","WWW:LINK-1.0-http--link":"md-mn-www","WWW:LINK-1.0-http--partners":"md-mn-www","WWW:LINK-1.0-http--related":"md-mn-www","WWW:LINK-1.0-http--rss":"md-mn-www","WWW:LINK-1.0-http--samples":"md-mn-www","DB:POSTGIS":"md-mn-hidden","DB:ORACLE":"md-mn-hidden","WWW:LINK-1.0-http--opendap":"md-mn-www","ESRI:AIMS--http--configuration":"md-mn-hidden","ESRI:AIMS--http-get-feature":"md-mn-hidden","ESRI:AIMS--http-get-image":"md-mn-hidden","GLG:KML-2.0-http-get-map":"md-mn-hidden","OGC:KML":"md-mn-download","OGC:GML":"md-mn-download","OGC:WPS":"md-mn-service","OGC:CSW":"md-mn-service","OGC:ODS":"md-mn-service","OGC:OGS":"md-mn-service","OGC:SOS":"md-mn-service","GLG:KML-2.0-http-get-map":"md-mn-hidden",validateWmsIcon:"validateWmsIcon",validateWfsIcon:"validateWfsIcon"},defaultColorMap:["#2205fd","#28bc03","#bc3303","#e4ff04","#ff04a0","#a6ff96","#408d5d","#7d253e","#2ce37e","#10008c","#ff9e05","#ff7b5d","#ff0000","#00FF00"],generateColorMap:function(classes){var colors=[];
for(var i=0;
i<classes;
i++){colors[i]="#"+("00000"+(Math.random()*(1<<24)|0).toString(16)).slice(-6)
}return colors
},updateHeadInfo:function(info){if(info&&info.title){document.title=info.title
}GeoNetwork.Util.removeMetaTags(info.tagsToRemove||{subject:true,author:true,keywords:true});
if(info){for(var key in info.meta){if(info.meta.hasOwnProperty(key)){var values=info.meta[key];
Ext.each(values,function(item){GeoNetwork.Util.addMetaTag(key,item)
})
}}}},addMetaTag:function(name,content){var meta=document.createElement("meta");
meta.name=name;
meta.content=content;
document.getElementsByTagName("head")[0].appendChild(meta)
},removeMetaTags:function(tagsToRemove){var metas=Ext.DomQuery.jsSelect("head > meta");
Ext.each(metas,function(meta){var name=meta.getAttribute("name");
if(tagsToRemove[name]){Ext.get(meta).remove()
}})
},buildPermalinkMenu:function(l,scope){var menu=new Ext.menu.Menu();
var permalinkMenu=new Ext.menu.TextItem({text:"<input/><br/><a>&nbsp;</a>"});
menu.add('<b class="menu-title">'+OpenLayers.i18n("permalinkInfo")+"</b>",permalinkMenu);
var updatePermalink=function(){var link=l;
if(typeof(l)=="function"){link=l.apply(scope)
}var id="permalink-"+permalinkMenu.getId();
permalinkMenu.update('<input id="'+id+'" value="'+link+'"/></br><a href="'+link+'">Link</a>',true,function(){if(!Ext.isIE8){setTimeout(function(){var e=Ext.get(id);
if(e){e.dom.select()
}},100)
}})
};
menu.on("show",updatePermalink,scope);
return new Ext.Button({iconCls:"linkIcon",menu:menu})
}};
Ext.namespace("GeoNetwork");
GeoNetwork.Message=function(){var msgCt;
function createBox(t,s,c){return['<div class="alert"><span class="label label-',c,'">',t,"</span><div>",s,"</div></div>"].join("")
}return{msg:function(config){var id="msg-div";
if(config.id){id=config.id
}if(!msgCt){msgCt=Ext.DomHelper.insertFirst(document.body,{id:id},true)
}msgCt.alignTo(config.target||document,"t-t");
var s=OpenLayers.String.format(config.msg,config.tokens);
var m=Ext.DomHelper.append(msgCt,{html:createBox(config.title,s,config.status)},true);
var seconds_to_wait=config.pause;
if(!seconds_to_wait||isNaN(seconds_to_wait)){seconds_to_wait=2
}m.slideIn("t").pause(seconds_to_wait).fadeOut({remove:true})
}}
};
Ext.namespace("GeoNetwork");
GeoNetwork.Catalogue=Ext.extend(Ext.util.Observable,{SERVERURL:null,URL:null,LANG:"en",DEFAULT_LANG:"en",EDITOR_MODE:{IN_OTHER_WINDOW:1,IN_EDITOR_POPUP:2},editMode:1,hostUrl:null,servlet:null,extentMap:null,services:{},windowOption:"menubar=no,location=no,toolbar=no,directories=no",windowName:"",startRecord:1,mdStore:null,summaryStore:null,statusBarId:null,mdDisplayPanelId:undefined,resultsView:undefined,mdOverlayedCmpId:undefined,identifiedUser:undefined,adminUser:false,metadataEditFn:undefined,adminAppUrl:"",selectedRecords:0,info:null,constructor:function(config){config=config||{};
Ext.apply(this,config);
if(this.hostUrl){if(this.hostUrl.indexOf("http")===-1){this.hostUrl=window.location.href.match(/http.*\//,"")+this.hostUrl
}this.SERVERURL=this.hostUrl
}else{this.SERVERURL="http://"+window.location.host+"/"
}if(this.hostUrl){this.URL=this.SERVERURL
}else{if(this.servlet){this.URL=this.SERVERURL+this.servlet
}else{this.URL=this.SERVERURL+"geonetwork"
}}this.LANG=(this.lang?this.lang:this.DEFAULT_LANG);
var serviceUrl=this.URL+"/srv/"+this.LANG+"/";
this.services={rootUrl:serviceUrl,csw:serviceUrl+"csw",feedback:serviceUrl+"feedback.send",xmlSearch:serviceUrl+"xml.search",mdSelect:serviceUrl+"metadata.select",mdView:serviceUrl+"view",mdXMLInsert:serviceUrl+"xml.metadata.insert",mdShow:serviceUrl+"metadata.show.embedded",mdMEF:serviceUrl+"mef.export",mdXMLGet:serviceUrl+"xml.metadata.get",mdRDFGet:serviceUrl+"rdf.metadata.get",mdXMLGet19139:serviceUrl+"xml_iso19139",mdXMLGetDC:serviceUrl+"xml_dublin-core",mdXMLGetFGDC:serviceUrl+"xml_fgdc-std",mdXMLGet19115:serviceUrl+"xml_iso19115to19139",mdDuplicate:serviceUrl+"metadata.duplicate.form",mdDelete:serviceUrl+"metadata.delete",mdPrint:serviceUrl+"pdf",mdEdit:serviceUrl+"edit",mdCreate:serviceUrl+"metadata.create.new",mdUpdate:serviceUrl+"metadata.update.new",mdProcessingXml:serviceUrl+"xml.metadata.processing",mdProcessing:serviceUrl+"metadata.processing.new",mdMassiveChildrenForm:serviceUrl+"metadata.batch.children.form",mdAdmin:serviceUrl+"metadata.admin.form",mdValidate:serviceUrl+"xml.metadata.validate",mdSuggestion:serviceUrl+"metadata.suggestion",mdCategory:serviceUrl+"metadata.category.form",mdRelationInsert:serviceUrl+"xml.relation.insert",mdRelationDelete:serviceUrl+"xml.relation.delete",mdRelation:serviceUrl+"xml.relation",mdGetThumbnail:serviceUrl+"metadata.thumbnail",mdSetThumbnail:serviceUrl+"metadata.thumbnail.set.new",mdUnsetThumbnail:serviceUrl+"metadata.thumbnail.unset.new",mdImport:serviceUrl+"metadata.xmlinsert.form",mdStatus:serviceUrl+"metadata.status.form",mdVersioning:serviceUrl+"metadata.version",subTemplateType:serviceUrl+"subtemplate.types",subTemplate:serviceUrl+"subtemplate",upload:serviceUrl+"resources.upload.new",prepareDownload:serviceUrl+"prepare.file.download",fileDisclaimer:serviceUrl+"file.disclaimer",fileDownload:serviceUrl+"file.download",geopublisher:serviceUrl+"geoserver.publisher",login:serviceUrl+"xml.user.login",logout:serviceUrl+"xml.user.logout",mef:serviceUrl+"mef.export?format=full&version=2",csv:serviceUrl+"csv.search",pdf:serviceUrl+"pdf.selection.search",harvestingStart:serviceUrl+"xml.harvesting.start",harvestingStop:serviceUrl+"xml.harvesting.stop",harvestingRun:serviceUrl+"xml.harvesting.run",harvestingAdd:serviceUrl+"xml.harvesting.add",harvestingUpdate:serviceUrl+"xml.harvesting.update",harvestingRemove:serviceUrl+"xml.harvesting.remove",thesaurusAdd:serviceUrl+"thesaurus.add",thesaurusActivate:serviceUrl+"thesaurus.activate",thesaurusDelete:serviceUrl+"thesaurus.delete",thesaurusUpload:serviceUrl+"xml.thesaurus.upload",thesaurusDownload:serviceUrl+"thesaurus.download",thesaurusConceptAdd:serviceUrl+"thesaurus.addelement",thesaurusConceptUpdate:serviceUrl+"thesaurus.updateelement",thesaurusConceptDelete:serviceUrl+"thesaurus.deleteelement",getIcons:serviceUrl+"xml.harvesting.info?type=icons",opensearchSuggest:serviceUrl+"main.search.suggest",massiveOp:{NewOwner:serviceUrl+"metadata.batch.newowner.form",Categories:serviceUrl+"metadata.batch.category.form",Delete:serviceUrl+"metadata.batch.delete",Privileges:serviceUrl+"metadata.batch.admin.form",Versioning:serviceUrl+"metadata.batch.version",Status:serviceUrl+"metadata.batch.status.form"},metadataMassiveUpdatePrivilege:serviceUrl+"metadata.batch.update.privileges",metadataMassiveUpdateCategories:serviceUrl+"metadata.batch.update.categories",metadataMassiveNewOwner:serviceUrl+"metadata.batch.newowner",getGroups:serviceUrl+"xml.info?type=groups",getRegions:serviceUrl+"xml.info?type=regions",getSources:serviceUrl+"xml.info?type=sources",getUsers:serviceUrl+"xml.info?type=users",getSiteInfo:serviceUrl+"xml.info?type=site",getInspireInfo:serviceUrl+"xml.info?type=inspire",getIsoLanguages:serviceUrl+"isolanguages",schemaInfo:serviceUrl+"xml.schema.info",getZ3950repositories:serviceUrl+"xml.info?type=z3950repositories",getCategories:serviceUrl+"xml.info?type=categories",getHarvesters:serviceUrl+"xml.harvesting.get",rate:serviceUrl+"xml.metadata.rate",xmlConfig:serviceUrl+"xml.config.get",admin:serviceUrl+"admin",xmlError:serviceUrl+"xml.main.error",searchKeyword:serviceUrl+"xml.search.keywords",getThesaurus:serviceUrl+"xml.thesaurus.getList",getStatus:serviceUrl+"xml.metadata.status.values.list",getKeyword:serviceUrl+"xml.keyword.get",searchCRS:serviceUrl+"crs.search",getCRSTypes:serviceUrl+"crs.types",logoAdd:serviceUrl+"logo.add",logoUrl:this.URL+"/images/logos/",imgUrl:this.URL+"/images/",harvesterLogoUrl:this.URL+"/images/harvesting/"};
this.extentMap=new GeoNetwork.map.ExtentMap();
this.addEvents("selectionchange","afterLogin","afterLogout","afterBadLogin","afterBadLogout","afterDelete");
GeoNetwork.Catalogue.superclass.constructor.call(this,config)
},setServiceUrl:function(serviceName,url){this.services[serviceName]=this.services.rootUrl+url
},isIdentified:function(){return !this.identifiedUser?false:true
},isAdmin:function(){return this.adminUser
},onAfterLogin:function(){this.fireEvent("afterLogin",this,this.isIdentified())
},onAfterBadLogin:function(){this.fireEvent("afterBadLogin",this,this.isIdentified())
},onAfterLogout:function(){this.fireEvent("afterLogout",this,this.isIdentified())
},onAfterBadLogout:function(){this.fireEvent("afterBadLogout",this,this.isIdentified())
},onAfterDelete:function(){this.fireEvent("afterDelete",this)
},onAfterRating:function(){this.fireEvent("afterRating",this)
},setSelectedRecords:function(nb){this.selectedRecords=parseInt(nb,10);
this.onSelectionChange()
},getSelectedRecords:function(){return this.selectedRecords
},onSelectionChange:function(){this.fireEvent("selectionchange",this,this.getSelectedRecords())
},getInfo:function(refresh){if(refresh||this.info===null){this.info={};
var properties=["name","organization","siteId"];
var request=OpenLayers.Request.GET({url:this.services.getSiteInfo,async:false});
if(request.responseXML){var xml=request.responseXML.documentElement;
Ext.each(properties,function(item,idx){var children=xml.getElementsByTagName(item)[0];
if(children){this.info[item]=children.childNodes[0].nodeValue
}},this)
}}return this.info
},getInspireInfo:function(){var info={};
var properties=["enable","enableSearchPanel"];
var request=OpenLayers.Request.GET({url:this.services.getInspireInfo,async:false});
if(request.responseXML){var xml=request.responseXML.documentElement;
Ext.each(properties,function(item,idx){var i=xml.getElementsByTagName(item)[0];
info[item]=i&&i.childNodes[0]&&i.childNodes[0].nodeValue
})
}return info
},updateStatus:function(msg){if(this.statusBarId){var el=Ext.getCmp(this.statusBarId);
if(el){el.update(msg);
return
}el=Ext.getDom(this.statusBarId);
if(el){el.innerHTML=msg;
return
}}},search:function(formOrParams,onSuccess,onFailure,startRecord,updateStore,metadataStore,summaryStore,async){var isCatalogueMdStore=this.metadataStore===metadataStore;
if(isCatalogueMdStore){this.updateStatus(OpenLayers.i18n("searching"))
}if(updateStore!==false){updateStore=true
}if(!startRecord){startRecord=this.startRecord
}if(!onSuccess){onSuccess=Ext.emptyFn
}if(!onFailure){onFailure=Ext.emptyFn
}if(metadataStore===undefined){metadataStore=this.metadataStore
}if(summaryStore===undefined){summaryStore=this.summaryStore
}if(updateStore){metadataStore.removeAll()
}if(typeof formOrParams==="object"){GeoNetwork.util.SearchTools.doQueryFromParams(formOrParams,this,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore,async)
}else{GeoNetwork.util.SearchTools.doQueryFromForm(formOrParams,this,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore,async)
}},kvpSearch:function(query,onSuccess,onFailure,startRecord,updateStore,metadataStore,summaryStore,async){if(updateStore!==false){updateStore=true
}if(!startRecord){startRecord=this.startRecord
}if(!onSuccess){onSuccess=Ext.emptyFn
}if(!onFailure){onFailure=Ext.emptyFn
}if(!metadataStore){metadataStore=this.metadataStore
}if(!summaryStore){summaryStore=this.summaryStore
}if(updateStore){metadataStore.removeAll()
}GeoNetwork.util.SearchTools.doQuery(query,this,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore,async)
},cswSearch:function(formId,onSuccess,onFailure,startRecord){this.metadataCSWStore.removeAll();
if(onSuccess){onSuccess=Ext.emptyFn
}if(onFailure){onFailure=Ext.emptyFn
}if(startRecord){startRecord=this.startRecord
}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(formId,this,startRecord,onSuccess,null,onFailure)
},metadataSelect:function(type,uuids){this.setSelectedRecords(0);
var app=this;
var i=0;
for(i=0;
i<uuids.length;
i++){OpenLayers.Request.GET({url:this.services.mdSelect,params:{id:uuids[i],selected:type},success:function(response){var nb=response.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;
if(nb){app.setSelectedRecords(nb)
}},failure:function(response){Ext.Msg.alert("Selection failed",response.responseText)
}})
}},metadataRate:function(uuid,rating,onSuccess){OpenLayers.Request.GET({url:this.services.rate,params:{uuid:uuid,rating:rating},success:function(response){var nb=response.responseXML.documentElement.childNodes[0].nodeValue;
if(onSuccess){onSuccess(nb)
}catalogue.onAfterRating();
return nb
},failure:function(response){Ext.Msg.alert("Rating failed",response.responseText)
}})
},metadataSelectAll:function(onSuccess){this.metadataSelection("add-all",onSuccess)
},metadataSelectNone:function(onSuccess){this.metadataSelection("remove-all",onSuccess)
},metadataSelection:function(type,onSuccess){var app=this;
OpenLayers.Request.GET({url:this.services.mdSelect,params:{selected:type},success:function(response){var nb=response.responseXML.documentElement.getElementsByTagName("Selected")[0].childNodes[0].nodeValue;
if(nb){app.setSelectedRecords(nb)
}if(onSuccess){onSuccess()
}},failure:function(response){}})
},csvExport:function(){window.open(this.services.csv,this.windowName,this.windowOption)
},mefExport:function(){location.replace(this.services.mef)
},pdfExport:function(sortField,sortOrder){var pdfExportUrl=this.services.pdf;
if(sortField!=undefined){pdfExportUrl=pdfExportUrl+"?sortBy="+sortField;
if(sortOrder!=undefined){pdfExportUrl=pdfExportUrl+"&sortOrder="+sortOrder
}}location.replace(pdfExportUrl)
},metadataShow:function(uuid,maximized,width,height){var url=this.services.mdView+"?uuid="+escape(uuid);
var bd=Ext.getBody();
if(this.resultsView){var record=this.metadataStore.getAt(this.metadataStore.find("uuid",uuid));
if(!record){var store=new GeoNetwork.data.MetadataResultsFastStore();
this.kvpSearch("fast=index&_uuid="+uuid,function(e){var record=store.getAt(store.find("uuid",uuid));
if(catalogue.metadataShowFn){catalogue.metadataShowFn(uuid,record,url,maximized,width,height)
}else{var win=new GeoNetwork.view.ViewWindow({serviceUrl:url,lang:catalogue.lang,currTab:GeoNetwork.defaultViewMode||"simple",printDefaultForTabs:GeoNetwork.printDefaultForTabs||false,printUrl:GeoNetwork.printUrl||"print.html",catalogue:catalogue,maximized:maximized||false,metadataUuid:uuid,record:record,resultsView:catalogue.resultsView});
win.show(catalogue.resultsView);
win.alignTo(bd,"tr-tr")
}},null,null,true,store,null,false)
}else{if(this.metadataShowFn){this.metadataShowFn(uuid,record,url,maximized,width,height)
}else{var win=new GeoNetwork.view.ViewWindow({serviceUrl:url,lang:this.lang,currTab:GeoNetwork.defaultViewMode||"simple",printDefaultForTabs:GeoNetwork.printDefaultForTabs||false,printUrl:GeoNetwork.printUrl||"print.html",catalogue:this,maximized:maximized||false,metadataUuid:uuid,record:record,resultsView:this.resultsView});
win.show(this.resultsView);
win.alignTo(bd,"tr-tr")
}}}},metadataShowById:function(id,maximized,width,height){var url=this.services.mdView+"?id="+id,record;
if(this.resultsView){if(!record){var store=new GeoNetwork.data.MetadataResultsFastStore();
this.kvpSearch("fast=index&_id="+id,null,null,null,true,store,null,false);
record=store.getAt(store.find("id",id))
}var win=new GeoNetwork.view.ViewWindow({serviceUrl:url,currTab:GeoNetwork.defaultViewMode||"simple",catalogue:this,maximized:maximized||false,record:record,metadataUuid:record?record.get("uuid"):undefined,resultsView:this.resultsView});
win.show(this.resultsView);
win.alignTo(Ext.getBody(),"r-r")
}},metadataXMLShow:function(uuid,schema,attach){var service=this.services.mdXMLGet;
if(schema==="iso19139"){service=this.services.mdXMLGet19139
}else{if(schema==="dublin-core"){service=this.services.mdXMLGetDC
}else{if(schema==="fgdc"){service=this.services.mdXMLGetFGDC
}else{if(schema==="iso19115"){service=this.services.mdXMLGet19115
}}}}var url=service+"?uuid="+uuid+"&attach="+attach;
location.replace(url,this.windowName,this.windowOption)
},metadataPrint:function(uuid){var url=this.services.mdPrint+"?uuid="+uuid;
location.replace(url)
},metadataMEF:function(uuid){var url=this.services.mdMEF+"?version=2&uuid="+uuid;
location.replace(url)
},metadataEdit:function(id,create,group,child,isTemplate){switch(this.editMode){case this.EDITOR_MODE.IN_EDITOR_POPUP:if(this.metadataEditFn){this.metadataEditFn(id,create,group,child,isTemplate)
}break;
default:window.open(this.services.mdEdit+"?id="+id,this.windowName,this.windowOption)
}},metadataDuplicate:function(uuid){window.open(this.services.mdDuplicate+"?uuid="+uuid,this.windowName,this.windowOption)
},metadataCreateChild:function(uuid){window.open(this.services.mdDuplicate+"?child=y&uuid="+uuid,this.windowName,this.windowOption)
},metadataDuplicateWithSchema:function(uuid,schema){window.open(this.services.mdDuplicate+"?uuid="+uuid+"&schema="+schema,this.windowName,this.windowOption)
},metadataDelete:function(uuid){Ext.Msg.confirm(OpenLayers.i18n("deleteRecord"),OpenLayers.i18n("deleteConfirm"),this.metadataDeleteDo,uuid)
},metadataDeleteDo:function(btn){if(btn==="yes"){var params={uuid:this};
catalogue.doAction(catalogue.services.mdDelete,params,OpenLayers.i18n("deleteRecordSuccess"),OpenLayers.i18n("deleteRecordFailure"),catalogue.onAfterDelete.bind(catalogue))
}},metadataAddToBookmarks:function(title,uuid){var url=this.metadataBookmarkURL(uuid);
if(!title){title=document.title
}var browser=navigator.userAgent.toLowerCase();
if(window.sidebar){window.sidebar.addPanel(title,url,"")
}else{if(window.external){if(browser.indexOf("chrome")==-1){window.external.AddFavorite(url,title)
}else{Ext.Msg.alert("Add to bookmarks","Please Press CTRL+D (or Command+D for macs) to bookmark this page")
}}else{if(window.opera&&window.print){return true
}else{if(browser.indexOf("konqueror")!=-1){Ext.Msg.alert("Add to bookmarks","Please press CTRL+B to bookmark this page.")
}else{if(browser.indexOf("webkit")!=-1){Ext.Msg.alert("Add to bookmarks","Please press CTRL+B (or Command+D for macs) to bookmark this page.")
}else{Ext.Msg.alert("Add to bookmarks","Your browser cannot add bookmarks using this link. Please add this link manually.")
}}}}}},metadataBookmarkURL:function(uuid){var bookmarkURL=this.services.xmlSearch+"?_uuid="+uuid;
return bookmarkURL
},doAction:function(url,params,msgSuccess,msgFailure,onSuccess,onFailure){if(url.indexOf("http")===-1){url=this.services.rootUrl+url
}OpenLayers.Request.GET({url:url,params:params,success:function(response){if(msgSuccess){Ext.Msg.alert(msgSuccess,response.responseText)
}if(onSuccess){onSuccess(response)
}},failure:function(response){if(msgFailure){Ext.Msg.alert(msgFailure,response.responseText)
}if(onFailure){onFailure(response)
}}})
},isLoggedIn:function(){var response=OpenLayers.Request.GET({url:this.services.admin,async:false}),exception;
exception=response.responseText.indexOf("Exception")!==-1;
if(response.status===200&&!exception){this.identifiedUser={firstName:"",surName:"",role:""};
this.onAfterLogin();
return true
}else{if(response.status===404){this.showError(OpenLayers.i18n("connectIssue"),OpenLayers.i18n("connectIssueMsg")+this.services.rootUrl+".")
}else{if(exception){this.checkError();
return false
}else{if(cookie){cookie.set("user",undefined)
}return false
}}}},login:function(username,password){var app=this,user;
OpenLayers.Request.GET({url:this.services.login,params:{username:username,password:password,info:"true"},success:function(response){user=response.responseXML.getElementsByTagName("record")[0];
var advUser=response.responseXML.getElementsByTagName("advancedUser")[0];
var surname=user.getElementsByTagName("surname")[0].firstChild;
if(surname==null){surname={nodeValue:"-"}
}var name=user.getElementsByTagName("name")[0].firstChild;
if(name==null){name={nodeValue:"-"}
}var username=user.getElementsByTagName("username")[0].firstChild;
if(username==null){username={nodeValue:"-"}
}var profile=user.getElementsByTagName("profile")[0].firstChild;
if(profile==null){profile={nodeValue:"guest"}
}app.identifiedUser={username:user?username.nodeValue:"-",name:user?name.nodeValue:"-",surname:user?surname.nodeValue:"-",role:user?profile.nodeValue:"guest",type:advUser?"advanced":"simple"};
app.onAfterLogin()
},failure:function(response){app.identifiedUser=undefined;
app.onAfterBadLogin()
}})
},logout:function(){var app=this;
OpenLayers.Request.GET({url:this.services.logout,success:function(response){app.identifiedUser=undefined;
app.onAfterLogout()
},failure:function(response){app.identifiedUser=undefined;
app.onAfterBadLogout()
}})
},checkError:function(successCb){var app=this,error,msg;
OpenLayers.Request.GET({url:this.services.xmlError,success:function(response){error=app.parseError(response.responseXML);
msg=error.info+" "+error.exc+"<br/>"+error.stack;
app.showError("Catalogue error",msg);
if(successCb){successCb(app,response)
}},failure:function(response){app.showError("Catalogue error",response.status)
}})
},showError:function(title,msg){Ext.MessageBox.show({title:title,msg:msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})
},parseError:function(xml){var error=xml.getElementsByTagName("error")[0];
return{stack:error.getElementsByTagName("Stack")[0].firstChild.nodeValue,exc:error.getElementsByTagName("Exception")[0].firstChild.nodeValue,resource:error.getElementsByTagName("Resource")[0].firstChild.nodeValue,msg:error.getElementsByTagName("Message")[0].firstChild.nodeValue,provider:error.getElementsByTagName("Provider")[0].firstChild.nodeValue,info:error.getElementsByTagName("Error")[0].firstChild.nodeValue}
},admin:function(){location.replace(this.adminAppUrl)
},metadataImport:function(){location.replace(this.services.mdImport)
},massiveOp:function(type,cb){var url=this.services.massiveOp[type];
this.modalAction(OpenLayers.i18n("massiveOp")+" - "+type,url,cb)
},modalAction:function(title,url,cb){if(url){var app=this,win,defaultCb=function(el,success,response,options){if(!success){app.showError("Catalogue error",title);
win.close()
}};
win=new Ext.Window({id:"modalWindow",layout:"fit",width:700,height:400,closeAction:"destroy",plain:true,modal:true,draggable:false,title:title,items:new Ext.Panel({autoLoad:{url:url,callback:cb||defaultCb,scope:win},border:false,frame:false,autoScroll:true})});
win.show(this);
win.alignTo(Ext.getBody(),"t-t")
}},metadataAdmin:function(id){var url=this.services.mdAdmin+"?id="+id;
this.modalAction(OpenLayers.i18n("setPrivileges"),url)
},metadataStatus:function(id){var url=this.services.mdStatus+"?id="+id;
this.modalAction(OpenLayers.i18n("setStatus"),url)
},metadataVersioning:function(id){var url=this.services.mdVersioning+"?id="+id;
this.modalAction(OpenLayers.i18n("setVersioning"),url)
},metadataCategory:function(id){var url=this.services.mdCategory+"?id="+id;
this.modalAction(OpenLayers.i18n("setCategories"),url)
},metadataPrepareDownload:function(id){var url=this.services.prepareDownload+"?id="+id;
this.modalAction(OpenLayers.i18n("prepareDownload"),url)
}});
Ext.reg("gn_catalogue",GeoNetwork.Catalogue);
Ext.namespace("GeoNetwork.util");
GeoNetwork.util.HelpTools={fields:[{name:"name",mapping:"@name"},{name:"id",mapping:"@id"},{name:"label"},{name:"description"},{name:"help",convert:function(v,record){var descs=[],i,j;
var n=record.getElementsByTagName("help");
for(i=0;
i<n.length;
i++){var p=n[i].getElementsByTagName("p");
if(p.length!==0){for(j=0;
j<n.length;
j++){descs.push(p[j].firstChild.nodeValue)
}}else{if(n[i].firstChild){descs.push(n[i].firstChild.nodeValue)
}}}return descs
}},{name:"example"},{name:"helper",convert:function(v,record){var helpers=[],title,i;
var nodes=record.getElementsByTagName("helper");
if(nodes.length===1){var n=nodes[0].getElementsByTagName("option");
for(i=0;
i<n.length;
i++){helpers.push({title:n[i].getAttribute("title"),label:n[i].firstChild.nodeValue,value:n[i].getAttribute("value")})
}}return helpers
}}],Templates:{SIMPLE:['<div class="help">{description}',"<tpl if=\"values.example != ''\">","<div><span>"+OpenLayers.i18n("example")+"</span> {example}</div>","</tpl></div>"],COMPLETE:['<div class="help"><span class="title">{label}</span>',"<div>{description}</div>",'<tpl for="help">',"<div>{.}</div>","</tpl>","<tpl if=\"values.example != ''\">","<div><span>"+OpenLayers.i18n("example")+"</span> {example}</div>","</tpl>","<tpl if=\"values.helper != ''\">","<div><span>"+OpenLayers.i18n("helper")+"</span><ul>",'<tpl for="helper">','<li title="{values.title}">{values.label}</li>',"</tpl>","</ul></div>","</tpl>","<div>"+OpenLayers.i18n("tagName")+" {name}</div>","</div>"]},get:function(helpId,schema,url,cb){var info=helpId.split("|"),requestBody='<request><element schema="'+schema+'" name="'+info[1]+'" context="'+info[2]+'" fullContext="'+info[3]+'" isoType="'+info[4]+'" /></request>';
schema=schema||info[0].split(".")[1]||"iso19139";
OpenLayers.Request.POST({url:url,data:requestBody,success:function(response){var el=response.responseXML.getElementsByTagName("element");
if(el[0]&&el[0].getAttribute("error")==="not-found"){return
}var pReader=new Ext.data.XmlReader({record:"element",fields:GeoNetwork.util.HelpTools.fields});
var r=pReader.readRecords(response.responseXML);
if(cb){cb(r)
}}})
}};
Ext.namespace("GeoNetwork.util");
GeoNetwork.util.SearchTools={fast:"false",output:"full",sortBy:"relevance",hitsPerPage:"50",doQuery:function(query,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore,async){OpenLayers.Request.GET({url:cat.services.rootUrl+metadataStore.service+"?"+query,async:async===false?false:true,success:function(result){if(updateStore){var getRecordsFormat=new OpenLayers.Format.GeoNetworkRecords();
var currentRecords=getRecordsFormat.read(result.responseText);
var values=currentRecords.records;
var isCatalogueMdStore=cat.metadataStore===metadataStore,isCatalogueSStore=cat.summaryStore===summaryStore;
if(values.length>0){metadataStore.loadData(currentRecords)
}if(isCatalogueSStore){var summary=currentRecords.summary;
if(summary&&summary.count>0&&summary.keywords&&summary.keywords.keyword&&summaryStore){summaryStore.loadData(summary)
}}if(cat&&isCatalogueMdStore){cat.updateStatus(currentRecords.from+"-"+currentRecords.to+OpenLayers.i18n("resultBy")+summary.count)
}}if(onSuccess){onSuccess(result,query)
}},failure:function(response){if(onFailure){onFailure(response)
}}})
},doQueryFromForm:function(formId,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore,async){var query=GeoNetwork.util.SearchTools.buildQueryFromForm(Ext.getCmp(formId),startRecord,GeoNetwork.util.SearchTools.sortBy,metadataStore.fast);
GeoNetwork.util.SearchTools.doQuery(query,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore,async)
},doQueryFromParams:function(params,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore,async){var filters=[],query;
GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(params,filters,startRecord);
query=GeoNetwork.util.SearchTools.buildQueryGET(filters,startRecord,GeoNetwork.util.SearchTools.sortBy,metadataStore.fast);
GeoNetwork.util.SearchTools.doQuery(query,cat,startRecord,onSuccess,onFailure,updateStore,metadataStore,summaryStore,async)
},buildQueryFromForm:function(form,startRecord,sortBy,fast){var values=GeoNetwork.util.SearchTools.getFormValues(form);
var filters=[];
GeoNetwork.util.SearchTools.addFiltersFromPropertyMap(values,filters,startRecord);
return GeoNetwork.util.SearchTools.buildQueryGET(filters,startRecord,sortBy,fast)
},populateFormFromParams:function(form,map,createNewField){form.cascade(function(cur){if(cur.getName){var name=cur.getName();
if(map[name]){var value=map[name];
delete map[name];
if(cur.getXType()==="superboxselect"){if(value.indexOf(" or ")!==-1){value=value.split(" or ")
}if(cur.mode==="local"){cur.getStore().on("load",function(){cur.setValue(value)
});
cur.setValue(value)
}else{cur.setValue(value,true)
}}else{if(name==="E_sortBy"){var cb=cur.linkedCombo;
if(map.E_sortOrder){cb.setValue(value+"#"+map.E_sortOrder)
}else{var idx=cb.getStore().find("id",new RegExp(value+"*"));
if(idx!==-1){cb.setValue(cb.getStore().getAt(idx).id)
}}}else{cur.setValue(value)
}}Ext.each(cur.findParentByType("fieldset"),function(f){if(f.rendered&&f.collapsed){f.expand()
}})
}}});
if(createNewField){for(var searchCriteria in map){if(map.hasOwnProperty(searchCriteria)&&map[searchCriteria]!==""){form.insert(form.items.length++,new Ext.form.TextField({name:searchCriteria,fieldLabel:OpenLayers.i18n(searchCriteria.substring(searchCriteria.indexOf("_")+1)),value:map[searchCriteria],inputType:"text"}))
}}}},addFiltersFromPropertyMap:function(values,filters,startRecord){var defaultSimilarity=".8",key,similarity=values.E_similarity,hits=values.E_hitsperpage;
if(similarity!==undefined){defaultSimilarity=values.E_similarity;
GeoNetwork.util.SearchTools.addFilter(filters,"E_similarity",defaultSimilarity)
}if(!hits){hits=GeoNetwork.util.SearchTools.hitsPerPage
}var to=parseInt(startRecord,10)+parseInt(hits,10)-1;
GeoNetwork.util.SearchTools.addFilter(filters,"E_from",startRecord);
GeoNetwork.util.SearchTools.addFilter(filters,"E_to",to);
for(key in values){if(values.hasOwnProperty(key)){var value=values[key];
if(value!==""&&key!=="E_similarity"){GeoNetwork.util.SearchTools.addFilter(filters,key,value)
}}}},addFilter:function(filters,key,value){var field=key.match("^(\\[?)([^_]+)_(.*)$"),i,or=[];
if(field){var list=field[3].split("|");
for(i=0;
i<list.length;
++i){GeoNetwork.util.SearchTools.addFilterImpl(filters,field[2],list[i],value)
}}},addFilterImpl:function(filters,type,name,value){if(type.charAt(0)==="E"){if(typeof(value)=="object"){for(var i=0;
i<value.length;
i++){filters.push(name+"="+encodeURIComponent(value[i])+"")
}}else{filters.push(name+"="+encodeURIComponent(value)+"")
}}else{if(type==="B"){filters.push(name+"="+(value?"true":"false")+"")
}else{if(type==="O"){if(value){filters.push(name+"=true")
}}else{if(console&&console.log){console.log("Cannot parse "+type)
}}}}},sortByMappings:{relevance:{name:"relevance",order:""},rating:{name:"changeDate",order:""},popularity:{name:"popularity",order:""},date:{name:"date",order:""},title:{name:"title",order:"reverse"}},buildQueryGET:function(filter,startRecord,sortBy,fast){var query="fast="+(fast?fast:GeoNetwork.util.SearchTools.fast)+"&";
if(filter){query+=filter.join("&")
}return query
},getFormValues:function(form){var result={};
form.cascade(function(cur){if(cur.disabled!==true&&!cur.isXType("displayfield")&&!(cur.getName&&OpenLayers.String.startsWith(cur.getName(),"ext-comp"))){if(cur.isXType("boxselect")||cur.isXType("combo")){if(cur.getValue&&cur.getValue()&&cur.getValue()!==""){result[cur.getName()]=cur.getValue()
}}else{if(cur.isXType("fieldset")){if(cur.checkbox){result[cur.checkboxName]=!cur.collapsed
}}else{if(cur.isXType("radiogroup")){var first=cur.items.get(0);
result[first.getName()]=first.getGroupValue()
}else{if(cur.isXType("checkbox")){result[cur.getName()]=cur.getValue()
}else{if(cur.isXType("datefield")){if(cur.getValue()!==""){result[cur.getName()]=cur.getValue().format("Y-m-d")+(cur.postfix?cur.postfix:"")
}}else{if(cur.isXType("multislider")){}else{if(cur.getValue&&cur.getValue()&&cur.getValue()!==""){GeoNetwork.util.SearchTools.addFieldValue(result,cur.getName(),cur.getValue())
}else{}}}}}}}}return true
});
return result
},addFieldValue:function(result,name,value){if(result[name]===undefined){result[name]=new Array(value)
}else{result[name].push(value)
}},parseFacets:function(response){var facets=response.responseXML.childNodes[0].childNodes[1];
var store=new Ext.data.ArrayStore({autoDestroy:true,storeId:"myStore",idIndex:0,fields:["facet","name","count"]});
if(facets.nodeName==="summary"){Ext.each(facets.childNodes,function(facet){if(facet.nodeName!="#text"&&facet.childNodes.length>0){Ext.each(facet.childNodes,function(node){if(node.getAttribute){var data={facet:node.nodeName,name:node.getAttribute("name"),count:node.getAttribute("count")};
var r=new store.recordType(data);
store.add(r)
}})
}})
}return store
}};
var translations={};
function translate(text){return translations[text]||text
}function checkAllInputsIn(id,checked){var list=Ext.getDom(id).getElementsByTagName("input"),i;
for(i=0;
i<list.length;
i++){list[i].checked=checked
}}function setAll(id){checkAllInputsIn(id,true)
}function clearAll(id){checkAllInputsIn(id,false)
}function checkBoxModalUpdate(div,service,modalbox,title){var boxes=Ext.DomQuery.select('input[type="checkbox"]');
var pars="?";
if(service==="metadata.admin"||service==="metadata.category"){pars+="id="+Ext.getDom("metadataid").value
}Ext.each(boxes,function(s){if(s.checked&&s.name!=""){pars+="&"+s.name+"=on"
}});
catalogue.doAction(service+pars,null,null,title,function(response){Ext.getDom(div).innerHTML=response.responseText;
if(service==="metadata.admin"||service==="metadata.category"){Ext.getCmp("modalWindow").close()
}},null)
}function radioModalUpdate(div,service,modalbox,title){var pars="?";
var inputs=Ext.DomQuery.select('input[type="hidden"],textarea,select',div);
Ext.each(inputs,function(s){pars+="&"+s.name+"="+s.value
});
var radios=Ext.DomQuery.select('input[type="radio"]',div);
Ext.each(radios,function(s){if(s.checked){pars+="&"+s.name+"="+s.value
}});
catalogue.doAction(service+pars,null,null,title,function(response){Ext.getDom(div).innerHTML=response.responseText;
if(service==="metadata.status"){Ext.getCmp("modalWindow").close()
}},null)
}function addGroups(xmlRes){var list=xmlRes.getElementsByTagName("group"),i;
Ext.getDom("group").options.length=0;
for(i=0;
i<list.length;
i++){var id=list[i].getElementsByTagName("id")[0].firstChild.nodeValue;
var name=list[i].getElementsByTagName("name")[0].firstChild.nodeValue;
var opt=document.createElement("option");
opt.text=name;
opt.value=id;
if(list.length===1){opt.selected=true
}Ext.getDom("group").options.add(opt)
}}function doGroups(userid){catalogue.doAction("xml.usergroups.list?id="+userid,null,null,"Error retrieving groups",function(xmlRes){if(xmlRes.nodeName==="error"){Ext.getDom("group").options.length=0;
Ext.getDom("group").value="";
var user=Ext.getDom("user");
for(i=0;
i<user.options.length;
i++){user.options[i].selected=false
}}else{addGroups(xmlRes.responseXML)
}})
}function checkMassiveNewOwner(action,title){var user=Ext.getDom("user").value;
var group=Ext.getDom("group").value;
if(user===""){Ext.Msg.alert(title,"selectNewOwner");
return false
}if(group.value===""){Ext.Msg.alert(title,"selectOwnerGroup");
return false
}catalogue.doAction(action+"?user="+user+"&group="+group,null,null,null,function(response){Ext.getDom("massivenewowner").parentNode.innerHTML=response.responseText
})
}function doDownload(id,all){var list=Ext.getDom("downloadlist").getElementsByTagName("INPUT"),pars="&id="+id+"&access=private",selected=false;
for(var i=0;
i<list.length;
i++){if(list[i].checked||all!==null){selected=true;
var name=list[i].getAttribute("name");
pars+="&fname="+name
}}if(!selected){Ext.Msg.alert("Alert",OpenLayers.i18n("selectOneFile"));
return
}catalogue.doAction(catalogue.services.fileDisclaimer+"?"+pars,null,null,null,function(response){Ext.getDom("downloadlist").parentNode.innerHTML=response.responseText
})
}function feedbackSubmit(){var f=Ext.getDom("feedbackf");
catalogue.doAction(catalogue.services.fileDownload+"?"+Ext.Ajax.serializeForm(f),null,null,null,function(response){Ext.getDom("feedbackf").parentNode.innerHTML=response.responseText
})
}function goSubmit(form_name){document.forms[form_name].submit()
}function checkBatchNewOwner(action,title){if(Ext.getDom("user").value==""){Ext.Msg.alert(title,"selectNewOwner");
return false
}if(Ext.getDom("group").value==""){Ext.Msg.alert(title,"selectOwnerGroup");
return false
}catalogue.doAction(catalogue.services.metadataMassiveNewOwner+"?"+Ext.Ajax.serializeForm(Ext.getDom("batchnewowner")),null,null,null,function(response){Ext.getDom("batchnewowner").parentNode.innerHTML=response.responseText
})
}Ext.namespace("GeoNetwork.util");
GeoNetwork.util.INSPIRESearchFormTools={getServiceTypeField:function(multi){var serviceTypes=[["discovery",OpenLayers.i18n("serviceType_discovery")],["view",OpenLayers.i18n("serviceType_view")],["download",OpenLayers.i18n("serviceType_download")],["transformation",OpenLayers.i18n("serviceType_transformation")],["invoke",OpenLayers.i18n("serviceType_invoke")],["other",OpenLayers.i18n("serviceType_other")]];
config={id:"serviceType",name:"E_serviceType",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("serviceType"),store:new Ext.data.ArrayStore({id:0,fields:["id","label"],data:serviceTypes}),valueField:"id",displayField:"label"};
if(multi){Ext.apply(config,{valueDelimiter:" or "});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getAnnexField:function(multi){var annexes=[["i","I"],["ii","II"],["iii","III"]],config={id:"inspireannex",name:"E_inspireannex",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("inspireannex"),store:new Ext.data.ArrayStore({id:0,fields:["id","label"],data:annexes}),valueField:"id",displayField:"label"};
if(multi){Ext.apply(config,{valueDelimiter:" or "});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getRelatedField:function(){var inspirerelated=new Ext.form.Checkbox({hideLabel:true,boxLabel:OpenLayers.i18n("inspirerelated"),tabTip:OpenLayers.i18n("inspirerelatedtt"),name:"O_inspirerelated"});
return inspirerelated
},getInspireCategoryField:function(){var inspireInspireCategory=new Ext.ux.form.SuperBoxSelect({id:"inspirecategory",name:"E_category",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("Aangemerkt voor INSPIRE"),store:new Ext.data.ArrayStore({id:0,fields:["id","label"],data:[["inspire","Ja"]]}),valueField:"id",displayField:"label",valueDelimiter:" or ",stackItems:true,value:"inspire"});
return inspireInspireCategory
},getThemesFieldWithSuggestion:function(services){var inspiretheme=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:services.opensearchSuggest,field:"inspiretheme",name:"E_inspiretheme",id:"inspiretheme",fieldLabel:OpenLayers.i18n("inspiretheme")});
return inspiretheme
},getThemesField:function(services,multi){var Keyword,themesStore,inspiretheme;
Keyword=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"definition"},{name:"uri"}]);
themesStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pKeyword:"*",pThesauri:"external.theme.inspire-theme",pMode:"searchBox",maxResults:"35"},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},Keyword),fields:["id","value","definition","uri"],sortInfo:{field:"value"}});
themesStore.load();
var config={id:"inspiretheme",name:"E_inspiretheme",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("inspiretheme"),store:themesStore,valueField:"value",displayField:"value"};
if(multi){Ext.apply(config,{valueDelimiter:" or ",stackItems:true});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getClassificationDataServicesField:function(services,multi){var Keyword,classificationDataServicesStore;
Keyword=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"definition"},{name:"uri"}]);
classificationDataServicesStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pKeyword:"*",pThesauri:"external.theme.inspire-service-taxonomy",pMode:"searchBox",maxResults:"35"},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},Keyword),fields:["id","value","definition","uri"],sortInfo:{field:"value"}});
classificationDataServicesStore.load();
var config={id:"keyword",name:"E_keyword",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("inspireClassificationDataServices"),store:classificationDataServicesStore,valueField:"value",displayField:"value"};
if(multi){Ext.apply(config,{valueDelimiter:" or ",stackItems:true});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getINSPIREFields:function(services,multi,config){if(!config){return[this.getAnnexField(multi),this.getServiceTypeField(multi),this.getClassificationDataServicesField(services,multi),this.getThemesField(services,multi),this.getRelatedField()]
}else{var f=[];
config.withAnnex&&f.push(this.getAnnexField(multi));
config.withDataService&&f.push(this.getClassificationDataServicesField(services,multi));
config.withTheme&&f.push(this.getThemesField(services,multi));
config.withRelated&&f.push(this.getRelatedField());
config.withCategory&&f.push(this.getInspireCategoryField());
config.withServiceType&&f.push(this.getServiceTypeField(multi));
return f
}}};
Ext.namespace("GeoNetwork.util");
GeoNetwork.util.SearchFormTools={groupField:null,getSimpleFormFields:function(services,layers,mapOptions,withTypes,activeMapControlExtent,typeCodelist,mapPanelOptions,withRelation,optionsConfig){var fields=[];
if(services){fields.push(new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:services.opensearchSuggest,listeners:{}}))
}else{fields.push(GeoNetwork.util.SearchFormTools.getFullTextField())
}if(withTypes){fields.push(GeoNetwork.util.SearchFormTools.getTypesField(typeCodelist,true))
}if(layers){fields.push(GeoNetwork.util.SearchFormTools.getSimpleMap(layers,mapOptions,activeMapControlExtent,mapPanelOptions,withRelation))
}if(optionsConfig){fields.push(GeoNetwork.util.SearchFormTools.getOptions(services,optionsConfig))
}return fields
},getAdvancedFormFields:function(services,layers,mapOptions){var fields=[],fullTextField,themekeyField,orgNameField;
if(services){fullTextField=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,width:285,minChars:2,loadingText:"...",hideTrigger:true,url:services.opensearchSuggest});
orgNameField=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:services.opensearchSuggest,field:"orgName",name:"E_orgName",fieldLabel:OpenLayers.i18n("org")});
themekeyField=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:services.opensearchSuggest,field:"keyword",name:"E_themekey",fieldLabel:OpenLayers.i18n("keyword")})
}else{fullTextField=GeoNetwork.util.SearchFormTools.getFullTextField();
themekeyField=GeoNetwork.util.SearchFormTools.getKeywordsField();
orgNameField=GeoNetwork.util.SearchFormTools.getOrgNameField()
}var advancedTextField=GeoNetwork.util.SearchFormTools.getAdvancedTextFields();
var titleField=GeoNetwork.util.SearchFormTools.getTitleField();
var abstractField=GeoNetwork.util.SearchFormTools.getAbstractField();
var types=GeoNetwork.util.SearchFormTools.getTypesField();
var mapTypes={xtype:"fieldset",title:OpenLayers.i18n("mapTypes"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"checkbox",defaults:{width:160},items:GeoNetwork.util.SearchFormTools.getMapTypesField()};
var accuracySettings={xtype:"fieldset",title:OpenLayers.i18n("similarity"),autoHeight:true,autoWidth:true,layout:"column",collapsible:true,collapsed:true,items:[GeoNetwork.util.SearchFormTools.getSimilarityField()]};
var geomField=new Ext.form.TextField({name:"E_geometry",id:"geometry",fieldLabel:OpenLayers.i18n("wkt"),hideLabel:false});
var mapLayers=[],i;
for(i=0;
i<layers.length;
i++){mapLayers.push(layers[i].clone())
}var geomWithMapField={xtype:"gn_geometrymapfield",geometryFieldId:"geometry",id:"geometryMap",layers:mapLayers,mapOptions:mapOptions};
var nearYouButton=GeoNetwork.util.SearchFormTools.getNearYouButton("geometry");
var geoRelationField=GeoNetwork.util.SearchFormTools.getRelationField();
var denominatorField=GeoNetwork.util.SearchFormTools.getScaleDenominatorField(true);
var geoFields=new Ext.form.FieldSet({title:OpenLayers.i18n("spatialSearch"),autoWidth:true,collapsible:true,collapsed:true,items:[geomField,nearYouButton,geomWithMapField,geoRelationField]});
var when=new Ext.form.FieldSet({title:OpenLayers.i18n("when"),autoWidth:true,defaultType:"datefield",collapsible:true,collapsed:true,items:GeoNetwork.util.SearchFormTools.getWhen()});
var catalogueField=GeoNetwork.util.SearchFormTools.getCatalogueField(services.getSources,services.logoUrl);
this.groupField=GeoNetwork.util.SearchFormTools.getGroupField(services.getGroups);
var metadataTypeField=GeoNetwork.util.SearchFormTools.getMetadataTypeField();
var categoryField=GeoNetwork.util.SearchFormTools.getCategoryField(services.getCategories,null,true);
var options=GeoNetwork.util.SearchFormTools.getOptions(services);
fields.push(fullTextField,advancedTextField,titleField,abstractField,themekeyField,orgNameField,geoFields,types,mapTypes,denominatorField,when,catalogueField,this.groupField,metadataTypeField,categoryField,options,accuracySettings);
return fields
},getSimpleMap:function(layers,mapOptions,activeMapControlExtent,panelConfig,withRelation){var fields=[],mapLayers=[],i;
for(i=0;
i<layers.length;
i++){mapLayers.push(layers[i].clone())
}var geomWithMapField={xtype:"gn_geometrymapfield",id:"geometryMap",layers:mapLayers,mapOptions:mapOptions,activated:activeMapControlExtent};
if(panelConfig){Ext.applyIf(geomWithMapField,panelConfig)
}fields.push(geomWithMapField);
if(withRelation){fields.push(GeoNetwork.util.SearchFormTools.getRelationField())
}return fields
},getOptions:function(services,cfg){var config={};
Ext.applyIf(config,cfg);
var hitsPerPage=config.hitsPerPage||[["10"],["20"],["50"],["100"]],items=[];
if(config.withLanguage){items.push(GeoNetwork.util.SearchFormTools.getRequestedLanguageCombo(services.getIsoLanguages))
}items.push(GeoNetwork.util.SearchFormTools.getSortByCombo());
items.push(new Ext.form.ComboBox({id:"E_hitsperpage",name:"E_hitsperpage",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("hitsPerPage"),value:hitsPerPage[1],store:new Ext.data.ArrayStore({id:0,fields:["id"],data:hitsPerPage}),valueField:"id",displayField:"id"}));
var options=new Ext.form.FieldSet({title:OpenLayers.i18n("options"),autoWidth:true,collapsible:true,collapsed:true,defaults:{width:160},items:items});
return options
},getRequestedLanguageCombo:function(url){var lang=GeoNetwork.Util.getCatalogueLang(OpenLayers.Lang.getCode()),languageStore=GeoNetwork.data.LanguageStore(url,lang),tpl='<tpl for="."><div class="x-combo-list-item">{[values.label.'+lang+"]}</div></tpl>",c=new Ext.form.ComboBox({name:"E_requestedLanguage",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("language"),store:languageStore,valueField:"code",displayField:"name",tpl:tpl});
languageStore.on("load",function(){c.setValue(lang)
});
languageStore.load();
return c
},getSortByCombo:function(defaultValue){var store=GeoNetwork.util.SearchFormTools.getSortByStore();
var combo=new Ext.form.ComboBox({mode:"local",fieldLabel:OpenLayers.i18n("sortBy"),triggerAction:"all",store:store,valueField:"id",displayField:"name",listeners:{change:function(cb,newValue,oldValue){var tokens=newValue.split("#");
sortByField.setValue(tokens[0]);
sortOrderField.setValue(tokens[1])
}}});
var sortByField=new Ext.form.TextField({name:"E_sortBy",id:"E_sortBy",inputType:"hidden",linkedCombo:combo});
var sortOrderField=new Ext.form.TextField({name:"E_sortOrder",id:"sortOrder",inputType:"hidden",linkedCombo:combo});
combo.setValue(defaultValue||"relevance#");
return[sortByField,sortOrderField,combo]
},getSortByStore:function(defaultValue){return new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["relevance#",OpenLayers.i18n("relevance")],["title#reverse",OpenLayers.i18n("title")],["changeDate#",OpenLayers.i18n("changeDate")],["rating#",OpenLayers.i18n("rating")],["popularity#",OpenLayers.i18n("popularity")],["denominator#",OpenLayers.i18n("scaleDesc")],["denominator#reverse",OpenLayers.i18n("scaleAsc")]]})
},getFullTextField:function(){return new Ext.form.TextField({name:"E_any",id:"E_any",fieldLabel:OpenLayers.i18n("fullTextSearch"),hideLabel:false})
},getTitleField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_title",OpenLayers.i18n("title"))
},getAbstractField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_abstract",OpenLayers.i18n("abstract"))
},getKeywordsField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_themekey",OpenLayers.i18n("keyword"))
},getOrgNameField:function(){return GeoNetwork.util.SearchFormTools.getTextField("E_orgName",OpenLayers.i18n("org"))
},getTextField:function(name,fieldLabel){return new Ext.form.TextField({name:name,fieldLabel:fieldLabel,hideLabel:false})
},getCatalogueField:function(url,logoUrl,multi){var catStore=GeoNetwork.data.CatalogueSourceStore(url),tpl='<tpl for="."><div class="x-combo-list-item logo"><img src="'+logoUrl+'{id}.gif"/>{name}</div></tpl>';
catStore.load();
var config={name:"E_siteId",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("catalogue"),store:catStore,valueField:"id",displayField:"name",tpl:tpl};
if(multi){Ext.apply(config,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:'<img style="max-width:16px;" src="'+logoUrl+'{id}.gif"/>{name}'});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getGroupField:function(url,multi){if(this.groupField!=null){return this.groupField
}var lang=GeoNetwork.Util.getCatalogueLang(OpenLayers.Lang.getCode());
var groupStore=GeoNetwork.data.GroupStore(url),tpl='<tpl for="."><div class="x-combo-list-item">{[values.label.'+lang+"]}</div></tpl>";
groupStore.load();
var config={name:"E_group",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:groupStore,valueField:"id",displayField:"name",tpl:tpl};
if(multi){Ext.apply(config,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:"{[values.label."+lang+"]}"});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},refreshGroupFieldValues:function(){if(this.groupField!=null){this.groupField.store.removeAll();
this.groupField.store.reload()
}},getMetadataTypeField:function(multi){var config={id:"E_template",name:"E_template",mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("kind"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["n",OpenLayers.i18n("md")],["y",OpenLayers.i18n("tpl")]]}),valueField:"id",displayField:"name"};
if(multi){Ext.apply(config,{valueDelimiter:" or "});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getCategoryField:function(url,imgUrl,multi){var lang=GeoNetwork.Util.getCatalogueLang(OpenLayers.Lang.getCode());
var store=GeoNetwork.data.CategoryStore(url);
store.load();
var tpl=(imgUrl?'<tpl for="."><div class="x-combo-list-item"><img src="'+imgUrl+'{name}.png"/>{[values.label.'+lang+"]}</div></tpl>":'<tpl for="."><div class="x-combo-list-item">{[values.label.'+lang+"]}</div></tpl>");
var config={name:"E_category",mode:"local",fieldLabel:OpenLayers.i18n("category"),triggerAction:"all",store:store,valueField:"name",displayField:"name",tpl:tpl};
if(multi){var displaytpl=(imgUrl?'<img src="'+imgUrl+'{name}.png"/>{[values.label.'+lang+" || values]}":"{[values.label."+lang+"]}");
Ext.apply(config,{valueDelimiter:" or ",stackItems:true,displayFieldTpl:displaytpl});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getAdvancedTextFields:function(){return{xtype:"fieldset",title:OpenLayers.i18n("advTextSearch"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:true,defaultType:"textfield",items:[{name:"E_or",fieldLabel:OpenLayers.i18n("eitherWords"),hideLabel:false},{name:"E_phrase",fieldLabel:OpenLayers.i18n("exactPhrase"),hideLabel:false},{name:"E_all",fieldLabel:OpenLayers.i18n("allWords"),hideLabel:false},{name:"E_without",fieldLabel:OpenLayers.i18n("withoutWords"),hideLabel:false}]}
},getSimilarityField:function(){return{xtype:"radiogroup",items:[{xtype:"label",text:OpenLayers.i18n("precise")},{name:"E_similarity",inputValue:1},{name:"E_similarity",inputValue:0.8,checked:true},{name:"E_similarity",inputValue:0.6},{name:"E_similarity",inputValue:0.4},{name:"E_similarity",inputValue:0.2},{xtype:"label",text:OpenLayers.i18n("imprecise")}]}
},getRelationField:function(){return new Ext.form.ComboBox({name:"E_relation",mode:"local",width:150,triggerAction:"all",fieldLabel:OpenLayers.i18n("relationType"),store:new Ext.data.ArrayStore({id:0,fields:["relation","label"],data:[["",""],["intersection",OpenLayers.i18n("intersection")],["overlaps",OpenLayers.i18n("overlaps")],["encloses",OpenLayers.i18n("encloses")],["fullyOutsideOf",OpenLayers.i18n("fullyOutsideOf")],["crosses",OpenLayers.i18n("crosses")],["touches",OpenLayers.i18n("touches")],["within",OpenLayers.i18n("within")]]}),valueField:"relation",displayField:"label"})
},getNearYouButton:function(geomFieldId){return new Ext.Button({text:OpenLayers.i18n("nearYou"),iconCls:"md-mn mn-user-location",iconAlign:"right",listeners:{click:function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){Ext.getCmp(geomFieldId).setValue("POINT("+position.coords.latitude+" "+position.coords.longitude+")")
})
}}}})
},registerDateVtype:function(){if(Ext.form.VTypes.daterange){return
}Ext.apply(Ext.form.VTypes,{daterange:function(val,field){var date=field.parseDate(val);
if(!date){return false
}if(field.startDateField&&(!this.dateRangeMax||(date.getTime()!==this.dateRangeMax.getTime()))){var start=Ext.getCmp(field.startDateField);
start.setMaxValue(date);
start.validate();
this.dateRangeMax=date
}else{if(field.endDateField&&(!this.dateRangeMin||(date.getTime()!==this.dateRangeMin.getTime()))){var end=Ext.getCmp(field.endDateField);
end.setMinValue(date);
end.validate();
this.dateRangeMin=date
}}return true
}})
},getWhen:function(){var anyTime=new Ext.form.Checkbox({name:"timeType",checked:true,fieldLabel:OpenLayers.i18n("anyTime"),handler:function(ck,checked){ck.ownerCt.items.each(function(item,index,length){if(checked&&item.getXType()==="datefield"){item.setValue("")
}})
}});
var items=[anyTime];
items.push({xtype:"label",text:OpenLayers.i18n("tempExtent")});
items.push(GeoNetwork.util.SearchFormTools.getTemporalExtentField(anyTime));
var dateTypes=[["noneDate",OpenLayers.i18n("none")],["creation",OpenLayers.i18n("creationDate")],["modification",OpenLayers.i18n("modificationDate")],["publication",OpenLayers.i18n("publicationDate")]];
var fieldNames={creation:["creationDateFrom","creationDateTo"],modification:["revisionDateFrom","revisionDateTo"],publication:["publicationDateFrom","publicationDateTo"]};
items.push(new Ext.form.ComboBox({mode:"local",triggerAction:"all",fieldLabel:OpenLayers.i18n("dateType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:dateTypes}),valueField:"id",width:120,displayField:"name",listeners:{change:function(field,newvalue,oldvalue){for(var field in fieldNames){if(fieldNames.hasOwnProperty(field)){Ext.getCmp(fieldNames[field][0]).setVisible(field===newvalue);
Ext.getCmp(fieldNames[field][1]).setVisible(field===newvalue);
if(field!==newvalue){Ext.getCmp(fieldNames[field][0]).setValue("");
Ext.getCmp(fieldNames[field][1]).setValue("")
}}}},beforeselect:function(field,newvalue,oldvalue){for(var field in fieldNames){if(fieldNames.hasOwnProperty(field)){Ext.getCmp(fieldNames[field][0]).setVisible(field===newvalue.id);
Ext.getCmp(fieldNames[field][1]).setVisible(field===newvalue.id);
if(field!==newvalue){Ext.getCmp(fieldNames[field][0]).setValue("");
Ext.getCmp(fieldNames[field][1]).setValue("")
}}}},afterrender:function(){Ext.getCmp("creationDateFrom").setVisible(true);
Ext.getCmp("creationDateTo").setVisible(true);
Ext.getCmp("revisionDateFrom").setVisible(false);
Ext.getCmp("revisionDateTo").setVisible(false);
Ext.getCmp("publicationDateFrom").setVisible(false);
Ext.getCmp("publicationDateTo").setVisible(false)
}}}));
items.push(GeoNetwork.util.SearchFormTools.getCreationDateField(anyTime));
items.push(GeoNetwork.util.SearchFormTools.getModificationDateField(anyTime));
items.push(GeoNetwork.util.SearchFormTools.getPublicationDateField(anyTime));
return items
},getMetadataDateField:function(anyTime){GeoNetwork.util.SearchFormTools.registerDateVtype();
return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_dateFrom","from","dateFrom","E_dateTo","to","dateTo",anyTime)
},getTemporalExtentField:function(anyTime){GeoNetwork.util.SearchFormTools.registerDateVtype();
return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_extFrom","from","extFrom","E_extTo","to","extTo",anyTime)
},getCreationDateField:function(anyTime){GeoNetwork.util.SearchFormTools.registerDateVtype();
return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_creationDateFrom","from","creationDateFrom","E_creationDateTo","to","creationDateTo",anyTime)
},getModificationDateField:function(anyTime){GeoNetwork.util.SearchFormTools.registerDateVtype();
return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_revisionDateFrom","from","revisionDateFrom","E_revisionDateTo","to","revisionDateTo",anyTime)
},getPublicationDateField:function(anyTime){GeoNetwork.util.SearchFormTools.registerDateVtype();
return GeoNetwork.util.SearchFormTools.getDateRangeFields("E_publicationDateFrom","from","publicationDateFrom","E_publicationDateTo","to","publicationDateTo",anyTime)
},getDateRangeFields:function(nameFrom,labelFrom,idFrom,nameTo,labelTo,idTo,anyTime){GeoNetwork.util.SearchFormTools.registerDateVtype();
var changeCb=function(field,newValue,oldValue){if(this&&newValue!==""){this.setValue(false)
}};
return[{fieldLabel:OpenLayers.i18n(labelFrom),name:nameFrom,id:idFrom,width:120,vtype:"daterange",endDateField:idTo,format:"d/m/Y",listeners:{change:changeCb,scope:anyTime}},{fieldLabel:OpenLayers.i18n(labelTo),name:nameTo,id:idTo,width:120,vtype:"daterange",startDateField:idFrom,format:"d/m/Y",listeners:{change:changeCb,scope:anyTime}}]
},getScaleDenominatorField:function(disabled,min,max,increment,width){min=min||1000;
max=max||1000000;
increment=increment||1000;
width=width||230;
var tip=new Ext.slider.Tip({getText:function(thumb){return String.format("<b>"+OpenLayers.i18n("scaleNominator")+"{0}</b>",thumb.value)
}});
var denominatorFrom=new Ext.form.Field({name:"E_denominatorFrom",value:"",hidden:true});
var denominatorTo=new Ext.form.Field({name:"E_denominatorTo",value:"",hidden:true});
var middle=min+max/2;
var slider=new Ext.slider.MultiSlider({hidden:disabled?true:false,initialized:false,width:width,minValue:min,maxValue:max,increment:increment,values:[middle,middle],formFields:[denominatorFrom,denominatorTo],plugins:tip,listeners:{show:function(cmp){if(!cmp.initialized){cmp.setValue(0,min,false);
cmp.setValue(1,max,false);
cmp.initialized=true
}},change:function(sliders,newValue,thumb){sliders.formFields[thumb.index].setValue(newValue)
}}});
var scaleCk=new Ext.form.Checkbox({fieldLabel:OpenLayers.i18n("scale"),name:"scaleOn",value:disabled?true:false,handler:function(ch,checked){slider.setVisible(checked);
if(!checked){denominatorFrom.setValue("");
denominatorTo.setValue("")
}else{denominatorFrom.setValue(slider.getValues()[0]);
denominatorTo.setValue(slider.getValues()[1])
}}});
return[denominatorFrom,denominatorTo,scaleCk,slider]
},getMapTypesField:function(){var spatialTypes=GeoNetwork.util.SearchFormTools.getSpatialRepresentationTypeField(null,true);
return[{hideLabel:true,boxLabel:OpenLayers.i18n("digital"),name:"B_digital"},{hideLabel:true,boxLabel:OpenLayers.i18n("hardCopy"),name:"B_paper"},{hideLabel:true,boxLabel:OpenLayers.i18n("downloadable"),name:"B_download"},{hideLabel:true,boxLabel:OpenLayers.i18n("interactive"),name:"B_dynamic"},spatialTypes]
},getValidField:function(multi){var config={name:"E__valid",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("validationStatus"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:[["1",OpenLayers.i18n("valid")],["0",OpenLayers.i18n("notValid")],["-1",OpenLayers.i18n("notDetermined")]]}),valueField:"id",displayField:"name"};
if(multi){Ext.apply(config,{valueDelimiter:" or "});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getStatusField:function(url,multi){var lang=GeoNetwork.Util.getCatalogueLang(OpenLayers.Lang.getCode());
var store=GeoNetwork.data.StatusStore(url);
store.load();
var tpl='<tpl for="."><div class="x-combo-list-item">{[values.label.'+lang+"]}</div></tpl>";
var config={id:"E__status",name:"E__status",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("status"),store:store,valueField:"id",displayField:"label",tpl:tpl};
if(multi){Ext.apply(config,{valueDelimiter:" or ",displayFieldTpl:"{[values.label."+lang+"]}"});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getTypesField:function(codeList,multi){var defaultCodeList=[["dataset",OpenLayers.i18n("dataset")],["series",OpenLayers.i18n("series")],["service",OpenLayers.i18n("service")],["model",OpenLayers.i18n("featureCat")]],config={name:"E_type",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("resourceType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:codeList||defaultCodeList}),valueField:"id",displayField:"name"};
if(multi){Ext.apply(config,{valueDelimiter:" or ",allowAddNewData:true});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}},getSpatialRepresentationTypeField:function(codeList,multi){var defaultCodeList=[["grid",OpenLayers.i18n("grid")],["stereoModel",OpenLayers.i18n("stereoModel")],["tin",OpenLayers.i18n("tin")],["textTabled",OpenLayers.i18n("textTable")],["vector",OpenLayers.i18n("vector")],["video",OpenLayers.i18n("video")]],config={name:"E_spatialRepresentationType",mode:"local",autoSelect:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("spatialRepType"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:codeList||defaultCodeList}),valueField:"id",displayField:"name"};
if(multi){Ext.apply(config,{valueDelimiter:" or "});
return new Ext.ux.form.SuperBoxSelect(config)
}else{return new Ext.form.ComboBox(config)
}}};
Ext.namespace("GeoNetwork.util");
GeoNetwork.util.CSWSearchTools={cswMethod:"POST",resultsMode:"results_with_summary",sortBy:"",maxRecords:"50",doCSWQueryFromForm:function(formId,cat,recordNum,onSuccess,onFailure,addFilters){var url=cat.services.csw;
var query=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm(GeoNetwork.util.CSWSearchTools.cswMethod,Ext.getCmp(formId),recordNum,GeoNetwork.util.CSWSearchTools.sortBy,addFilters);
if(GeoNetwork.util.CSWSearchTools.cswMethod==="POST"){var getQuery=GeoNetwork.util.CSWSearchTools.buildCSWQueryFromForm("GET",Ext.getCmp(formId),recordNum,GeoNetwork.util.CSWSearchTools.sortBy,addFilters);
OpenLayers.Request.POST({url:url,data:query,success:function(result){var getRecordsFormat=new OpenLayers.Format.CSWGetRecords.v2_0_2();
cat.currentRecords=getRecordsFormat.read(result.responseText);
var values=cat.currentRecords.records;
if(values.length>0){cat.metadataCSWStore.loadData(cat.currentRecords)
}if(onSuccess){onSuccess(result,getQuery)
}},failure:onFailure})
}else{OpenLayers.Request.GET({url:url,params:query,success:function(result){onSuccess(result,query)
},failure:onFailure})
}},buildCSWQueryFromForm:function(method,form,startRecord,sortBy,addFilters){var values=GeoNetwork.util.CSWSearchTools.getFormValues(form);
var filters=[];
GeoNetwork.util.CSWSearchTools.addFiltersFromPropertyMap(values,filters);
addFilters(values,filters);
if(filters.length===0){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:"anyText",value:".*"}))
}var and=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:filters});
if(method==="POST"){return GeoNetwork.util.CSWSearchTools.buildCSWQueryPOST(and,startRecord,sortBy)
}else{return GeoNetwork.util.CSWSearchTools.buildCSWQueryGET(and,startRecord,sortBy)
}},addFiltersFromPropertyMap:function(values,filters){var defaultSimilarity=".8",similarity=values.E_similarity,key;
if(similarity!==null&&similarity!==undefined){defaultSimilarity=values.E_similarity;
GeoNetwork.util.CSWSearchTools.addFilter(filters,"E_similarity",defaultSimilarity,defaultSimilarity)
}for(key in values){if(values.hasOwnProperty(key)){var value=values[key];
if(value!==""&&key!=="E_similarity"){GeoNetwork.util.CSWSearchTools.addFilter(filters,key,value,defaultSimilarity)
}}}},addFilter:function(filters,key,value,defaultSimilarity){var field=key.match("^(\\[?)([^_]+)_(.*)$"),or=[],i;
if(field){if(field[1]==="["){var values=value.split(",");
for(i=0;
i<values.length;
++i){GeoNetwork.util.CSWSearchTools.addFilterImpl(values.length>1?or:filters,field[2],field[3],values[i],defaultSimilarity)
}if(values.length>1){filters.push(new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:or}))
}}else{GeoNetwork.util.CSWSearchTools.addFilterImpl(filters,field[2],field[3],value,defaultSimilarity)
}}},addFilterImpl:function(filters,type,name,value,defaultSimilarity){var i;
if(type==="S"){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:name,value:value+".*"}))
}else{if(type==="C"){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:name,value:".*"+value+".*"}))
}else{if(type.charAt(0)==="E"){if(type.length>1){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:type.substring(1)}))
}filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:name,value:value}));
if(type.length>1){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:defaultSimilarity}))
}}else{if(type===">="){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:name,value:value}))
}else{if(type==="<="){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:name,value:value}))
}else{if(type==="T"){var splitted=value.split(" ");
for(i=0;
i<splitted.length;
++i){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:name,value:splitted[i]}))
}}else{if(type==="B"){filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:name,value:value?1:0}))
}else{if(type==="V"){var subField=value.match("^([^/]+)/(.*)$");
filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:"1.0"}));
filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:subField[1],value:subField[2]}));
filters.push(new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"similarity",value:defaultSimilarity}))
}else{alert("Cannot parse "+type)
}}}}}}}}},sortByMappings:{relevance:{name:"relevance",order:"D"},rating:{name:"rating",order:"D"},popularity:{name:"popularity",order:"D"},date:{name:"date",order:"D"},title:{name:"title",order:"A"}},buildCSWQueryPOST:function(filter,startRecord,sortBy){var result='<?xml version="1.0" encoding="UTF-8"?>\n<csw:GetRecords xmlns:csw="http://www.opengis.net/cat/csw/2.0.2" service="CSW" version="2.0.2" resultType="'+this.resultsMode+'" startPosition="'+startRecord+'" maxRecords="'+this.maxRecords+'">\n  <csw:Query typeNames="csw:Record">\n    <csw:ElementSetName>full</csw:ElementSetName>\n';
if(sortBy){var searchInfo=GeoNetwork.util.CSWSearchTools.sortByMappings[sortBy];
result+='    <ogc:SortBy xmlns:ogc="http://www.opengis.net/ogc">\n      <ogc:SortProperty>\n        <ogc:PropertyName>'+searchInfo.name+"</ogc:PropertyName>\n        <ogc:SortOrder>"+searchInfo.order+"</ogc:SortOrder>\n      </ogc:SortProperty>\n    </ogc:SortBy>\n"
}if(filter){var filterXML=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(filter));
filterXML=filterXML.replace(/^<\?xml[^?]*\?>/,"");
result+='    <csw:Constraint version="1.0.0">\n';
result+=filterXML;
result+="    </csw:Constraint>\n"
}result+="  </csw:Query>\n</csw:GetRecords>";
return result
},buildCSWQueryGET:function(filter,startRecord,sortBy){var result={request:"GetRecords",service:"CSW",version:"2.0.2",resultType:this.resultsMode,namespace:"csw:http://www.opengis.net/cat/csw/2.0.2",typeNames:"csw:Record",constraintLanguage:"FILTER",constraint_language_version:"1.1.0",elementSetName:"full",startPosition:startRecord,maxRecords:this.maxRecords};
if(sortBy){var searchInfo=GeoNetwork.util.CSWSearchTools.sortByMappings[sortBy];
result.sortBy=searchInfo.name+":"+searchInfo.order
}if(filter){var filterXML=new OpenLayers.Format.XML().write(new OpenLayers.Format.Filter().write(filter));
filterXML=filterXML.replace(/^<\?xml[^?]*\?>/,"");
result.constraint=filterXML
}return result
},getFormValues:function(form){var result=form.getForm().getValues()||{};
form.cascade(function(cur){if(cur.disabled!==true){if(cur.isXType("boxselect")){if(cur.getValue&&cur.getValue()){result[cur.getName()]=cur.getValue()
}}else{if(cur.isXType("combo")){if(cur.getValue&&cur.getValue()){result[cur.getName()]=cur.getValue()
}}else{if(cur.isXType("fieldset")){if(cur.checkbox){result[cur.checkboxName]=!cur.collapsed
}}else{if(cur.isXType("radiogroup")){var first=cur.items.get(0);
result[first.getName()]=first.getGroupValue()
}else{if(cur.isXType("checkbox")){result[cur.getName()]=cur.getValue()
}else{if(cur.isXType("datefield")){if(cur.getValue()!==""){result[cur.getName()]=cur.getValue().format("Y-m-d")+(cur.postfix?cur.postfix:"")
}}else{if(cur.getName){if(cur.getValue&&cur.getValue()!==""){result[cur.getName()]=cur.getValue()
}}}}}}}}}return true
});
return result
}};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.CatalogueSourceStore=function(url){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"source",idPath:"id",fields:[{name:"id",mapping:"uuid"},{name:"name"}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.CategoryStore=function(url){function getLabel(v,record){var labels={};
var label=record.getElementsByTagName("label");
var i;
if(label.length===1){var children=label[0].childNodes;
var child;
for(i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType===1){labels[child.nodeName]=child.firstChild.nodeValue
}}}return labels
}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"category",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"label",convert:getLabel}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.CodeListStore=function(config){var schema=config.schema||"iso19139";
var requestBody='<request><codelist schema="'+schema+'" name="'+config.codeListName+'" /></request>';
var model=[{name:"code"},{name:"label"},{name:"description"}];
var DataRecord=Ext.data.Record.create(model);
var store=new Ext.data.Store({fields:model});
OpenLayers.Request.POST({url:config.url,data:requestBody,success:function(response){var help=response.responseXML.getElementsByTagName("entry");
for(var i=0;
i<help.length;
i++){var record=new DataRecord({code:help[i].getElementsByTagName("code")[0].firstChild.nodeValue,label:help[i].getElementsByTagName("label")[0].firstChild.nodeValue,description:help[i].getElementsByTagName("description")[0].firstChild.nodeValue});
store.add(record)
}}});
return store
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.GroupStore=function(url){function getLabel(v,record){var labels={};
var i;
var label=record.getElementsByTagName("label");
if(label.length===1){var children=label[0].childNodes;
var child;
for(i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType===1){labels[child.nodeName]=child.firstChild.nodeValue
}}}return labels
}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"group",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"name"},{name:"description"},{name:"email"},{name:"referrer"},{name:"label",convert:getLabel}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.HarvesterStore=function(url){function getCategories(v,record){var categories=[],i,catNode=record.getElementsByTagName("categories");
if(catNode.length===1){var cats=catNode[0].getElementsByTagName("category");
for(i=0;
i<cats.length;
i++){categories.push(cats[i].getAttribute("id"))
}}return categories
}function getOperation(v,record){var operation=[],i,ops=record.getElementsByTagName("operation");
for(i=0;
i<ops.length;
i++){var op=ops[i];
operation.push(op.getAttribute("name"))
}return operation
}function getPrivileges(v,record){var Privilege=Ext.data.Record.create([{name:"group_id",mapping:"@id"},{name:"operation",convert:getOperation}]);
var pReader=new Ext.data.XmlReader({record:"group"},Privilege);
var r=pReader.readRecords(record);
return r
}return new Ext.data.XmlStore({autoDestroy:true,url:url,record:"node",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"type",mapping:"@type"},{name:"site_name",mapping:"site/name"},{name:"site_uuid",mapping:"site/uuid"},{name:"site_host",mapping:"site/host"},{name:"site_servlet",mapping:"site/servlet"},{name:"site_port",mapping:"site/port"},{name:"site_url",mapping:"site/url"},{name:"site_icon",mapping:"site/icon"},{name:"site_ogctype",mapping:"site/ogctype"},{name:"options_lang",mapping:"options/lang"},{name:"options_topic",mapping:"options/topic"},{name:"options_createthumbnails",mapping:"options/createthumbnails"},{name:"options_uselayer",mapping:"options/uselayer"},{name:"options_uselayermd",mapping:"options/uselayermd"},{name:"options_datasetcategory",mapping:"options/datasetcategory"},{name:"privileges",convert:getPrivileges},{name:"categories",convert:getCategories},{name:"site_account_use",mapping:"site/account/use"},{name:"site_account_username",mapping:"site/account/username"},{name:"site_account_password",mapping:"site/account/password"},{name:"options_every",mapping:"options/every"},{name:"options_onerunonly",mapping:"options/onerunonly"},{name:"options_status",mapping:"options/status"},{name:"info_lastrun",mapping:"info/lastRun"},{name:"info_running",mapping:"info/running"},{name:"info_result_total",mapping:"info/result/total"},{name:"info_result_added",mapping:"info/result/added"},{name:"info_result_layer",mapping:"info/result/layer"},{name:"info_result_layerUuidExist",mapping:"info/result/layerUuidExist"},{name:"info_result_layerUsingMdUrl",mapping:"info/result/layerUsingMdUrl"},{name:"info_result_unknownSchema",mapping:"info/result/unknownSchema"},{name:"info_result_removed",mapping:"info/result/removed"},{name:"info_result_unretrievable",mapping:"info/result/unretrievable"},{name:"info_result_badFormat",mapping:"info/result/badFormat"},{name:"info_result_doesNotValidate",mapping:"info/result/doesNotValidate"},{name:"info_result_thumbnails",mapping:"info/result/thumbnails"},{name:"info_result_thumbnailsFailed",mapping:"info/result/thumbnailsFailed"},{name:"error_message",mapping:"error/message"},{name:"error_class",mapping:"error/class"},{name:"error_stack"}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.LanguageStore=function(url,lang){var ln=lang;
function getLabel(v,record){var labels={};
var i;
var label=record.getElementsByTagName("label");
if(label.length===1){var children=label[0].childNodes;
var child;
for(i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType===1){labels[child.nodeName]=child.firstChild.nodeValue
}}}return labels
}function getName(v,record){var labels={};
var i;
var label=record.getElementsByTagName("label");
if(label.length===1){var children=label[0].childNodes;
var child;
for(i=0,len=children.length;
i<len;
++i){child=children[i];
if((child.nodeType===1)&&(child.nodeName==ln)){return child.firstChild.nodeValue
}}}return""
}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"record ",idPath:"id",fields:[{name:"id"},{name:"code"},{name:"label",convert:getLabel},{name:"name",convert:getName}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataCSWResultsStore=function(){function getThumbnails(v,record){var i,uri;
if(record.URI){for(i=0;
i<record.URI.length;
i++){uri=record.URI[i];
if(uri.name==="thumbnail"){if(uri.value.indexOf("http")===-1){return GeoNetwork.Catalogue.URL+"/srv/en/"+uri.value
}else{return uri.value
}}}}return""
}function getCapabilitiesUrl(v,record){var i,uri;
if(record.URI){for(i=0;
i<record.URI.length;
i++){uri=record.URI[i];
if(uri.protocol&&uri.protocol.indexOf("http-get-capabilities")!==-1){return uri.value
}}}return""
}function getSource(v,record){if(record.geonet_info){return record.geonet_info.source[0]
}else{return""
}}function getPopularity(v,record){if(record.geonet_info){return record.geonet_info.popularity[0]
}else{return""
}}function getRating(v,record){if(record.geonet_info){return record.geonet_info.rating[0]
}else{return""
}}function getDownload(v,record){if(record.geonet_info){return record.geonet_info.download[0]
}else{return""
}}function getOwnerName(v,record){if(record.geonet_info){return record.geonet_info.ownername[0]
}else{return""
}}function getIsHarvested(v,record){if(record.geonet_info&&record.geonet_info.is_harvested){return record.geonet_info.is_harvested[0]
}else{return""
}}function getEdit(v,record){if(record.geonet_info&&record.geonet_info.edit){return record.geonet_info.edit
}else{return"false"
}}return new Ext.data.JsonStore({totalProperty:"SearchResults.numberOfRecordsMatched",root:"records",fields:[{name:"title",mapping:"title[0].value",defaultValue:""},{name:"abstract",mapping:"abstract",defaultValue:""},{name:"subject",mapping:"subject"},{name:"uuid",mapping:"identifier[0].value",defaultValue:""},{name:"thumbnail",convert:getThumbnails},{name:"uri",mapping:"uri",defaultValue:""},{name:"getCapabilitiesUrl",convert:getCapabilitiesUrl},{name:"isharvested",convert:getIsHarvested},{name:"source",convert:getSource},{name:"rating",convert:getRating},{name:"popularity",convert:getPopularity},{name:"download",convert:getDownload},{name:"ownername",convert:getOwnerName},{name:"edit",convert:getEdit},{name:"bbox",mapping:"BoundingBox",defaultValue:""}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataRelationStore=function(url,params,grouping){var fields=[{name:"id"},{name:"uuid"},{name:"title"},{name:"abstract"},{name:"keyword"},{name:"type",mapping:"@type"}];
if(grouping){var reader=new Ext.data.XmlReader({record:"relation",idProperty:"uuid"},fields);
return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:url,params:params,disableCaching:false}),reader:reader,groupField:"type",sortInfo:{field:"type",direction:"ASC"}})
}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"relation",idPath:"uuid",fields:fields})
}};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataResultsStore=Ext.extend(Ext.data.JsonStore,{getTitle:function(v,record){if(record.title&&record.title[0]){return record.title[0].value
}else{if(record.defaultTitle&&record.defaultTitle[0]){return record.defaultTitle[0].value
}else{return""
}}},getValidationInfo:function(v,record){var i,validity=[],validInfo;
if(record.geonet_info&&record.geonet_info.valid_details){validInfo=record.geonet_info.valid_details;
for(i=0;
i<validInfo.length;
i++){validity.push({valid:validInfo.status[i].value,type:validInfo.type[i].value,ratio:validInfo.ratio[i].value})
}}return validity
},getThumbnails:function(v,record){var i;
var uri="";
var currentUri;
if(record.image){for(i=0;
i<record.image.length;
i++){currentUri=record.image[i].value;
if(currentUri.indexOf("http")!==-1||i===0){uri=currentUri
}}}return uri
},getContact:function(v,record){var i,contact=[],el,name;
if(record.responsibleParty){for(i=0;
i<record.responsibleParty.length;
i++){el=record.responsibleParty[i];
name=(record.responsibleParty.organisationName&&record.responsibleParty.organisationName[i]?record.responsibleParty.organisationName[i].value:"");
contact.push({applies:el.appliesTo,logo:el.logo,role:el.role,name:name})
}}return contact
},getLinks:function(v,record){if(record.link){return record.link
}return[]
},getSource:function(v,record){if(record.geonet_info&&record.geonet_info.source){return record.geonet_info.source[0].value
}else{return""
}},getPopularity:function(v,record){if(record.geonet_info&&record.geonet_info.popularity){return record.geonet_info.popularity[0].value
}else{return""
}},getRating:function(v,record){if(record.geonet_info&&record.geonet_info.rating){return record.geonet_info.rating[0].value
}else{return""
}},getDownload:function(v,record){if(record.geonet_info&&record.geonet_info.download){return record.geonet_info.download[0].value
}else{return""
}},getOwnerName:function(v,record){if(record.geonet_info&&record.geonet_info.ownername){return record.geonet_info.ownername[0].value
}else{return""
}},getChangeDate:function(v,record){if(record.geonet_info&&record.geonet_info.changeDate){return record.geonet_info.changeDate[0].value
}else{return""
}},getPublicationDate:function(v,record){if(record.geonet_info&&record.geonet_info.publicationDate){return record.geonet_info.publicationDate[0].value
}else{return""
}},getIsHarvested:function(v,record){if(record.geonet_info&&record.geonet_info.isHarvested){return record.geonet_info.isHarvested[0].value
}else{return""
}},getHarvesterType:function(v,record){if(record.geonet_info&&record.geonet_info.harvestInfo&&record.geonet_info.harvestInfo.type){return record.geonet_info.harvestInfo.type[0].value
}else{return""
}},getCategory:function(v,record){if(record.geonet_info&&record.geonet_info.category){return record.geonet_info.category
}else{return""
}},getCreateDate:function(v,record){if(record.geonet_info&&record.geonet_info.createDate){return record.geonet_info.createDate[0].value
}else{return""
}},getSelected:function(v,record){if(record.geonet_info&&record.geonet_info.selected){return record.geonet_info.selected[0].value
}else{return""
}},getAbstract:function(v,record){if(record["abstract"]&&record["abstract"][0]){return record["abstract"][0].value
}else{return""
}},getType:function(v,record){if(record.type){return record.type[0].value
}else{return""
}},getEdit:function(v,record){if(record.geonet_info&&record.geonet_info.edit){return record.geonet_info.edit[0].value
}else{return"false"
}},getDisplayOrder:function(v,record){if(record.geonet_info&&record.geonet_info.displayOrder){return record.geonet_info.displayOrder[0].value
}else{return 0
}},constructor:function(args){args=Ext.apply({totalProperty:"summary.count",root:"records",fast:"false",service:"xml.search",fields:[{name:"title",convert:this.getTitle},{name:"abstract",convert:this.getAbstract},{name:"type",convert:this.getType},{name:"subject",mapping:"keyword",defaultValue:""},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"groupName",mapping:"geonet_info.groupName[0].value",defaultValue:""},{name:"contact",convert:this.getContact},{name:"thumbnail",convert:this.getThumbnails},{name:"links",convert:this.getLinks},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:this.getIsHarvested},{name:"harvestertype",convert:this.getHarvesterType},{name:"createdate",convert:this.getCreateDate},{name:"changedate",convert:this.getChangeDate},{name:"publicationdate",convert:this.getPublicationDate},{name:"selected",convert:this.getSelected},{name:"source",convert:this.getSource},{name:"category",convert:this.getCategory},{name:"rating",convert:this.getRating},{name:"popularity",convert:this.getPopularity},{name:"download",convert:this.getDownload},{name:"ownername",convert:this.getOwnerName},{name:"edit",convert:this.getEdit},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"displayOrder",convert:this.getDisplayOrder,sortType:"asInt"},{name:"valid",mapping:"geonet_info.valid[0].value",defaultValue:"-1"},{name:"valid_details",convert:this.getValidationInfo}]},args);
GeoNetwork.data.MetadataResultsStore.superclass.constructor.call(this,args)
},onDestroy:function(config){GeoNetwork.data.MetadataResultsStore.superclass.onDestroy.apply(this,config)
}});
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataResultsFastStore=Ext.extend(GeoNetwork.data.MetadataResultsStore,{getValidationInfo:function(v,record){if(record.valid){return record.valid[0].value
}else{return"-1"
}},getIdxMsg:function(v,record){if(record.idxMsg){var info=record.idxMsg[0].value.split("|");
return info
}else{return""
}},getValidationDetails:function(v,record){var i,validity=[],validInfo;
for(var key in record){if(record.hasOwnProperty(key)&&key.indexOf("valid_")!==-1){var obj=record[key];
validity.push({valid:obj[0].value,type:key.split("_")[1],ratio:""})
}}return validity
},getThumbnails:function(v,record){var i;
var uri="";
var currentUri;
if(record.image){for(i=0;
i<record.image.length;
i++){var tokens=record.image[i].value.split(GeoNetwork.data.MetadataResultsFastStore.separator);
currentUri=tokens[1];
if(currentUri.indexOf("http")!==-1||i===0){uri=currentUri
}}}return uri
},getContact:function(v,record){var i,contact=[],el,name;
if(record.responsibleParty){for(i=0;
i<record.responsibleParty.length;
i++){var tokens=record.responsibleParty[i].value.split(GeoNetwork.data.MetadataResultsFastStore.separator);
contact.push({applies:tokens[1],logo:tokens[3],role:tokens[0],name:tokens[2]});
break
}}return contact
},getOrganization:function(v,record){var orgName,el;
if(record.responsibleParty){for(i=0;
i<record.responsibleParty.length;
i++){var tokens=record.responsibleParty[i].value.split(GeoNetwork.data.MetadataResultsFastStore.separator);
if(tokens[2]){orgName=tokens[2];
break
}}}return orgName
},getEmail:function(v,record){var email,el;
if(record.responsibleParty){for(i=0;
i<record.responsibleParty.length;
i++){var tokens=record.responsibleParty[i].value.split(GeoNetwork.data.MetadataResultsFastStore.separator);
if(tokens[4]){email=tokens[4];
break
}}}return email
},getLinks:function(v,record){var links=[];
if(record.link){for(i=0;
i<record.link.length;
i++){var tokens=record.link[i].value.split(GeoNetwork.data.MetadataResultsFastStore.separator);
links.push({name:tokens[0],title:tokens[1],href:tokens[2],protocol:tokens[3],type:tokens[4]})
}}return links
},getCredit:function(v,record){if(record.credit){return record.credit
}else{return""
}},getPopularity:function(v,record){if(record.popularity){return record.popularity[0].value
}else{return""
}},getRating:function(v,record){if(record.rating){return record.rating[0].value
}else{return""
}},getDownload:function(v,record){if(record.geonet_info&&record.geonet_info.download){return(record.geonet_info.download[0].value==="true")
}else{return false
}},getDynamic:function(v,record){if(record.geonet_info&&record.geonet_info.dynamic){return(record.geonet_info.dynamic[0].value==="true")
}else{return false
}},getOwnerName:function(v,record){if(record.userinfo&&record.userinfo[0].value){var userinfo=record.userinfo[0].value.split(GeoNetwork.data.MetadataResultsFastStore.separator);
try{return userinfo[2]+" "+userinfo[1]
}catch(e){return""
}}else{return""
}},getIsHarvested:function(v,record){if(record.isHarvested){return record.isHarvested[0].value
}else{return""
}},getCategory:function(v,record){if(record.category){return record.category
}else{return""
}},getLicense:function(v,record){var license="";
if(record.license){Ext.each(record.license,function(l){if(l.value==="Public Domain"){license=l.value
}});
if(license===""&&record.license[0]){license=record.license[0]
}}return license
},getLicenseLink:function(v,record){var id=0;
var idx=0;
if(record.license){Ext.each(record.license,function(l){if(l.value==="Public Domain"){id=idx
}idx=idx+1
})
}if(record.licenseLink&&record.licenseLink[id]){return record.licenseLink[id].value
}else{return""
}},getSpatialRepresentationType:function(v,record){if(record.spatialRepresentationType&&record.spatialRepresentationType[0]){return record.spatialRepresentationType[0].value
}else{return""
}},getStatusIcons:function(v,record){var icons={useRestrictionsIcon:"../../apps/ngr2/img/icon_use-restrictions.png",accessRestrictionsIcon:"../../apps/ngr2/img/icon_access-restrictions.png",priceInformationIcon:"../../apps/ngr2/img/icon_euro.png",inspireDataIcon:"../../apps/ngr2/img/inspire-logo.gif",addToBookmarksIcon:"../../apps/ngr2/img/bookmark-add-icon.png"};
Ext.each(record.Constraints,function(constraint){var c=constraint.value;
if(c.match(/gebruiksbeperkingen/i)){icons.useRestrictions=c
}if(c.match(/toegang/i)){icons.accessRestrictions=c
}});
Ext.each(record.payment,function(fee){var c=fee.value;
icons.priceInformation=c
});
Ext.each(record.category,function(cat){var c=cat.value;
if(c.match(/inspire/i)){icons.inspireData=c
}});
icons.addToBookmarks="Add to bookmarks";
return icons
},constructor:function(args){args=Ext.apply({totalProperty:"summary.count",root:"records",fast:"index",service:"q",fields:[{name:"title",convert:this.getTitle},{name:"abstract",convert:this.getAbstract},{name:"type",convert:this.getType},{name:"subject",mapping:"keyword",defaultValue:""},{name:"spatialRepresentationType",convert:this.getSpatialRepresentationType},{name:"uuid",mapping:"geonet_info.uuid[0].value",defaultValue:""},{name:"id",mapping:"geonet_info.id[0].value",defaultValue:""},{name:"schema",mapping:"geonet_info.schema[0].value",defaultValue:""},{name:"groupName",mapping:"geonet_info.groupName[0].value",defaultValue:""},{name:"contact",convert:this.getContact},{name:"organization",convert:this.getOrganization},{name:"email",convert:this.getEmail},{name:"credit",convert:this.getCredit},{name:"thumbnail",convert:this.getThumbnails},{name:"links",convert:this.getLinks},{name:"uri",mapping:"uri",defaultValue:""},{name:"isharvested",convert:this.getIsHarvested},{name:"harvestertype",convert:this.getHarvesterType},{name:"createdate",convert:this.getCreateDate},{name:"changedate",convert:this.getChangeDate},{name:"selected",convert:this.getSelected},{name:"source",convert:this.getSource},{name:"category",convert:this.getCategory},{name:"rating",convert:this.getRating},{name:"popularity",convert:this.getPopularity},{name:"download",convert:this.getDownload},{name:"dynamic",convert:this.getDynamic},{name:"ownername",convert:this.getOwnerName},{name:"edit",convert:this.getEdit},{name:"bbox",mapping:"BoundingBox",defaultValue:""},{name:"license",convert:this.getLicense,defaultValue:""},{name:"licenseLink",convert:this.getLicenseLink,defaultValue:""},{name:"displayOrder",convert:this.getDisplayOrder,sortType:"asInt"},{name:"valid",convert:this.getValidationInfo},{name:"valid_details",convert:this.getValidationDetails},{name:"idxMsg",convert:this.getIdxMsg},{name:"status_icons",convert:this.getStatusIcons}]},args);
GeoNetwork.data.MetadataResultsFastStore.superclass.constructor.call(this,args)
},onDestroy:function(config){GeoNetwork.data.MetadataResultsFastStore.superclass.onDestroy.apply(this,config)
}});
GeoNetwork.data.MetadataResultsFastStore.separator="|";
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataSummaryStore=function(){return new Ext.data.JsonStore({totalProperty:"count",root:"keywords.keyword",listeners:{load:function(store,records,opt){var valueField="count";
var normalizedField="class";
var typeField="type";
var params={};
var maxBound=6;
store.each(function(v){v.set(typeField,store.root);
var type=v.get(typeField);
if(typeof params.type!=="object"){params.type={maxValue:0,minValue:1}
}params.type.maxValue=Math.max(v.get(valueField),params.type.maxValue);
params.type.minValue=Math.min(v.get(valueField),params.type.minValue)
});
store.each(function(v){var type=v.get(typeField);
var normalizedValue=0;
if(params.type.maxValue!==params.type.minValue){normalizedValue=(v.get(valueField)-params.type.minValue)/(params.type.maxValue-params.type.minValue)*maxBound
}v.set(normalizedField,Math.round(normalizedValue))
})
}},sortInfo:{field:"value",direction:"ASC"},fields:[{name:"type",defaultValue:null},{name:"value",mapping:"name",defaultValue:""},{name:"count",mapping:"count",defaultValue:""},{name:"class",defaultValue:"0"}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.MetadataThumbnailStore=function(url,params){var fields=[{name:"href"},{name:"desc"},{name:"type"},{name:"mimetype"}];
return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:url,params:params,disableCaching:false}),record:"thumbnail",idPath:"href",fields:fields})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.OpenSearchSuggestionReader=function(meta,recordType){meta=meta||{};
GeoNetwork.data.OpenSearchSuggestionReader.superclass.constructor.call(this,meta,recordType||meta.fields)
};
Ext.extend(GeoNetwork.data.OpenSearchSuggestionReader,Ext.data.JsonReader,{rootId:undefined,readRecords:function(o){this.arrayData=o;
var i,j;
var s=this.meta,sid=s?Ext.num(s.idIndex,s.id):null,recordType=this.recordType,fields=recordType.prototype.fields,records=[],success=true,v;
this.rootId=1;
var root=(!this.rootId?this.getRoot(o):o[this.rootId]);
for(i=0,len=root.length;
i<len;
i++){var n=root[i],values={},id=((sid||sid===0)&&n[sid]!==undefined&&n[sid]!==""?n[sid]:null);
for(j=0,jlen=fields.length;
j<jlen;
j++){var f=fields.items[j],k=f.mapping!==undefined&&f.mapping!==null?f.mapping:j;
v=n[k]!==undefined?n[k]:f.defaultValue;
v=f.convert(v,n);
values[f.name]=n
}var record=new recordType(values,id);
record.json=n;
records[records.length]=record
}var totalRecords=records.length;
if(s.totalProperty){v=parseInt(this.getTotal(o),10);
if(!isNaN(v)){totalRecords=v
}}if(s.successProperty){v=this.getSuccess(o);
if(v===false||v==="false"){success=false
}}return{success:true,records:records,totalRecords:records.length}
}});
Ext.namespace("GeoNetwork.data");
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.OpenSearchSuggestionStore=function(c){c=c||{};
GeoNetwork.data.OpenSearchSuggestionStore.superclass.constructor.call(this,Ext.apply(c,{proxy:c.proxy||(!c.data?new Ext.data.HttpProxy({url:c.url,disableCaching:false,method:"GET"}):undefined),reader:new GeoNetwork.data.OpenSearchSuggestionReader(c,c.fields||["value"])}))
};
Ext.extend(GeoNetwork.data.OpenSearchSuggestionStore,Ext.data.Store);
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.RegionStore=function(url){function getLabel(v,record){var labels={};
var i;
var label=record.getElementsByTagName("label");
if(label.length===1){var children=label[0].childNodes;
var child;
for(i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType===1){labels[child.nodeName]=child.firstChild.nodeValue
}}}return labels
}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"region",idPath:"@id",fields:[{name:"id",mapping:"@id"},{name:"north"},{name:"south"},{name:"east"},{name:"west"},{name:"label",convert:getLabel}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.StatusStore=function(url){function getLabel(v,record){var labels={};
var label=record.getElementsByTagName("label");
var i;
if(label.length===1){var children=label[0].childNodes;
var child;
for(i=0,len=children.length;
i<len;
++i){child=children[i];
if(child.nodeType===1){labels[child.nodeName]=child.firstChild.nodeValue
}}}return labels
}return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"record",idPath:"id",fields:[{name:"id"},{name:"name"},{name:"reserved"},{name:"label",convert:getLabel}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.SubTemplateTypeStore=function(url){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"record",idPath:"type",fields:[{name:"type"},{name:"schema"},{name:"label"},{name:"description"}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.SuggestionStore=function(url,params,grouping){function getStatusIcon(v,record){var status=record.getAttribute("type");
return'<span class="'+status+'">&#160;</span>'
}var fields=[{name:"id",mapping:"@id"},{name:"name",mapping:"@process"},{name:"target",mapping:"@target"},{name:"category",mapping:"@category"},{name:"desc",mapping:"name"},{name:"params",mapping:"params"},{name:"operational",mapping:"operational"}];
if(grouping){var reader=new Ext.data.XmlReader({record:"suggestion",idProperty:"@id"},fields);
return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:url,params:params,disableCaching:false}),reader:reader,groupField:"category",sortInfo:{field:"target",direction:"ASC"}})
}else{return new Ext.data.XmlStore({autoDestroy:true,baseParams:params,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"suggestion",idPath:"@id",fields:fields})
}};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.ThesaurusFeedStore=function(feed){var defaultFeed="http://geonetwork.svn.sourceforge.net/svnroot/geonetwork/utilities/repository/thesaurus.xml";
var store=new Ext.data.XmlStore({autoDestroy:true,autoLoad:true,proxy:new Ext.data.HttpProxy({method:"GET",url:feed||defaultFeed,disableCaching:false}),record:"entry",idPath:"id",fields:[{name:"id"},{name:"title"},{name:"link",mapping:"link/@href"},{name:"updated"},{name:"summary"},{name:"category"}]});
return store
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.ThesaurusStore=function(config){var DataRecord=Ext.data.Record.create([{name:"filename"},{name:"title"},{name:"theme",mapping:"dname"},{name:"id",mapping:"key"},{name:"type"},{name:"activated"}]);
var store=new Ext.data.Store({url:config.url,reader:new Ext.data.XmlReader({record:"thesaurus"},DataRecord),sortInfo:{field:"id",direction:"ASC"},fields:["filename","theme","id","title","type","activated"]});
if(config.allOption){var record=new DataRecord({filename:OpenLayers.i18n("anyThesaurus"),activated:"y"});
record.set("id","");
store.add(record)
}if(config.activatedOnly){store.on("load",function(){var coll=this.query("activated","n");
coll.each(function(item,idx){this.removeAt(this.indexOf(item))
},store)
},store)
}store.load({add:true});
return store
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.UserStore=function(url){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"user",idPath:"id",fields:[{name:"id"},{name:"username"},{name:"surname"},{name:"name"},{name:"profile"},{name:"address"},{name:"email"},{name:"city"},{name:"state"},{name:"zip"},{name:"country"},{name:"organisation"},{name:"kind"}]})
};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.ValidationRuleStore=function(url,params,grouping){function getStatusIcon(v,record){var status=record.getAttribute("type");
return'<span class="badge badge-'+status+'">&#160;</span>'
}var fields=[{name:"id",mapping:"@id"},{name:"group",mapping:"@group"},{name:"status",mapping:"@type"},{name:"statusIcon",convert:getStatusIcon},{name:"title"},{name:"details"},{name:"msg"}];
if(grouping){var reader=new Ext.data.XmlReader({record:"rule",idProperty:"id"},fields);
return new Ext.data.GroupingStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"POST",url:url,params:params,disableCaching:false}),reader:reader,groupField:"group",sortInfo:{field:"status",direction:"ASC"}})
}else{return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,params:params,disableCaching:false}),record:"rule",idPath:"@id",fields:fields})
}};
Ext.namespace("GeoNetwork.data");
GeoNetwork.data.Z3950RepositoryStore=function(url){return new Ext.data.XmlStore({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:url,disableCaching:false}),record:"repository",idPath:"id",fields:[{name:"id",mapping:"@id"},{name:"code",mapping:"id/@code"},{name:"name",mapping:"label"}]})
};
Ext.namespace("GeoNetwork.form");
GeoNetwork.form.GeometryMapField=Ext.extend(GeoExt.MapPanel,{nativeProjection:"EPSG:4326",serverProjection:"EPSG:4326",layer_style:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),geometryFieldId:undefined,geometryField:undefined,mapOptions:undefined,extentBox:undefined,vectorLayer:undefined,nearYou:undefined,initStyle:function(){this.layer_style.fillOpacity=0;
this.layer_style.strokeOpacity=0.8;
this.layer_style.strokeDashstyle="dash";
this.layer_style.strokeWidth=4
},createExtentControl:function(){var action;
if(this.restrictToMapExtent){action=new Ext.form.Checkbox({boxLabel:OpenLayers.i18n("restrictSearchToMap"),checked:this.activated?true:false,listeners:{check:function(cb,checked){this.geometryField.setValue("");
this.nearYou.toggle(false);
if(checked){this.on("aftermapmove",this.setField,this);
this.fireEvent("aftermapmove")
}else{this.un("aftermapmove",this.setField,this)
}},scope:panel}});
this.getTopToolbar().add(action);
if(this.activated){this.on("aftermapmove",this.setField,this)
}}else{this.initStyle();
this.extentBox=new GeoNetwork.Control.ExtentBox({wktelement:this.geometryField,vectorLayerStyle:this.layer_style});
action=new GeoExt.Action({control:this.extentBox,toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?true:false,map:this.map,tooltip:{title:OpenLayers.i18n("selectExtentTooltipTitle"),text:OpenLayers.i18n("selectExtentTooltipText")},iconCls:"selextent"});
this.vectorLayer=this.extentBox.getOrCreateLayer();
var clearAction=new GeoExt.Action({iconCls:"clearPolygon",tooltip:{title:OpenLayers.i18n("clearExtentTooltipTitle"),text:OpenLayers.i18n("clearExtentTooltipText")},handler:function(){this.vectorLayer.destroyFeatures();
this.geometryField.setValue("")
},scope:this});
this.getTopToolbar().add(action,clearAction)
}if(this.nearYouControl){this.getTopToolbar().add(this.nearYou)
}return action
},createNavBar:function(){var items=[];
var panel=this;
this.nearYou=new Ext.Button({iconCls:"md-mn mn-user-location",iconAlign:"right",tooltip:OpenLayers.i18n("mapNearYou"),enableToggle:true,toggleGroup:this.map.id+"move",listeners:{toggle:function(bt,pressed){var o=this;
if(pressed){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){o.map.panTo(new OpenLayers.LonLat(position.coords.longitude,position.coords.latitude));
o.geometryField.setValue("POINT("+position.coords.latitude+" "+position.coords.longitude+")")
})
}}else{o.geometryField.setValue("")
}},scope:panel}});
var zoomAllAction=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:this.map,iconCls:"zoomfull",tooltip:{title:OpenLayers.i18n("zoomToMaxExtentTooltipTitle"),text:OpenLayers.i18n("zoomToMaxExtentTooltipText")}});
var zoomInAction=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,iconCls:"zoomin",tooltip:{title:OpenLayers.i18n("zoominTooltipTitle"),text:OpenLayers.i18n("zoominTooltipText")}});
var zoomOutAction=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),map:this.map,toggleGroup:this.map.id+"move",allowDepress:false,tooltip:{title:OpenLayers.i18n("zoomoutTooltipTitle"),text:OpenLayers.i18n("zoomoutTooltipText")},iconCls:"zoomout"});
var panAction=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:this.map.id+"move",allowDepress:false,pressed:this.activated?false:true,map:this.map,iconCls:"pan",tooltip:{title:OpenLayers.i18n("dragTooltipTitle"),text:OpenLayers.i18n("dragTooltipText")}});
items.push(zoomAllAction,zoomInAction,zoomOutAction,panAction,"->");
return items
},defaultConfig:{id:"geometryMap",width:290,height:180,stateful:false,border:false,activated:true,restrictToMapExtent:false,nearYouControl:true},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.nativeProjection=GeoNetwork.map.PROJECTION||this.nativeProjection;
var options=this.mapOptions||{projection:this.nativeProjection,units:"degrees",maxExtent:GeoNetwork.map.MAXEXTENT||new OpenLayers.Bounds(-180,-90,180,90),restrictedExtent:GeoNetwork.map.EXTENT||new OpenLayers.Bounds(-180,-90,180,90),controls:[]};
if(!options.controls){options.controls=[]
}this.map=new OpenLayers.Map("search_map",options);
this.map.addControl(new GeoNetwork.Control.ZoomWheel());
this.map.addControl(new OpenLayers.Control.LoadingPanel());
this.map.addControl(new OpenLayers.Control.MousePosition());
this.tbar=this.createNavBar();
if(this.geometryFieldId){this.geometryField=Ext.getCmp(this.geometryFieldId)
}else{var gmf=this;
this.geometryField=new Ext.form.TextField({name:"E_geometry",inputType:"hidden",listeners:{valid:function(cpt){if(cpt.getValue()!==""&&this.extentBox.getOrCreateLayer().features.length===0){this.extentBox.updateFieldsWKT(cpt.getValue())
}},scope:gmf}})
}GeoNetwork.form.GeometryMapField.superclass.initComponent.call(this);
this.add(this.geometryField);
this.createExtentControl()
},setExtent:function(bounds){if(bounds){this.extentBox.updateFields(bounds)
}else{this.extentBox.updateFields(this.map.getMaxExtent())
}},setField:function(){if(this.geometryField!==undefined){var bounds=this.map.getExtent().toArray();
this.extentBox.updateFields(bounds);
this.geometryField.fireEvent("change")
}}});
Ext.reg("gn_geometrymapfield",GeoNetwork.form.GeometryMapField);
Ext.namespace("GeoNetwork.form");
GeoNetwork.form.OpenSearchSuggestionTextField=Ext.extend(Ext.form.ComboBox,{defaultConfig:{hideLabel:true,width:400,minChars:2,loadingText:"...",hideTrigger:true,field:"any",name:"E_any",forceLowerCase:true},url:undefined,fieldLabel:undefined,displayField:"value",tpl:undefined,mode:"remote",store:undefined,queryParam:"q",autoSelect:false,itemSelector:"div.search-item",initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.id=this.name;
GeoNetwork.form.OpenSearchSuggestionTextField.superclass.initComponent.call(this);
if(!this.tpl){var tpl='<tpl for="."><div class="search-item"><h3>{[values.value.replace(Ext.getDom(\''+this.id+"').value, '<span>' + Ext.getDom('"+this.id+"').value + '</span>')]}</h3></div></tpl>";
this.tpl=new Ext.XTemplate(tpl)
}if(this.forceLowerCase){this.on("beforequery",function(q){q.query=q.query.toLowerCase()
})
}this.store=new GeoNetwork.data.OpenSearchSuggestionStore({url:this.url,rootId:1,baseParams:{field:this.field}})
}});
Ext.reg("gn_opensearchsuggestiontextfield",GeoNetwork.form.OpenSearchSuggestionTextField);
Ext.namespace("GeoNetwork.form");
GeoNetwork.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){if(!this.store.baseParams){this.store.baseParams={}
}GeoNetwork.form.SearchField.superclass.initComponent.call(this);
this.on("specialkey",function(f,e){if(e.getKey()===e.ENTER){this.onTrigger2Click()
}},this)
},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.store.baseParams[this.paramName]="";
this.store.removeAll();
this.el.dom.value="";
this.triggers[0].hide();
this.hasSearch=false;
this.focus()
}},onTrigger2Click:function(){var v=this.getRawValue();
if(v.length<1){this.store.baseParams[this.paramName]="*"
}else{this.store.baseParams[this.paramName]=v
}if(this.triggerAction){this.triggerAction(this.scope,v)
}else{this.store.reload()
}this.hasSearch=true;
this.triggers[0].show();
this.focus()
}});
Ext.reg("gn_searchfield",GeoNetwork.form.SearchField);
Ext.namespace("GeoNetwork");
GeoNetwork.FacetsPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,searchForm:null,breadcrumb:null,facetListConfig:[],maxDisplayedItem:undefined,autoScroll:true,switchFacetsMenu:true},facetsStore:new Ext.data.JsonStore({fields:["facet","node","count"]}),startFacetsStore:new Ext.data.JsonStore({fields:["facet","node","count"]}),currentFilterStore:null,counter:0,afterFacetClick:function(){},mask:undefined,refresh:function(response){var facets=response.responseXML.getElementsByTagName("summary")[0],zappette="",panel=this,store=this.facetsStore,moreBt="<li class='facet-more-bt'><a href='javascript:void(0);'>"+OpenLayers.i18n("facetMore")+"</a></li>",lessBt="<li class='facet-less-bt' style='display:none;'><a href='javascript:void(0);'>"+OpenLayers.i18n("facetLess")+"</a></li>";
store.removeAll();
if(facets.nodeName==="summary"){if(this.facetListConfig.length>0){Ext.each(this.facetListConfig,function(facetToDisplay){Ext.each(facets.getElementsByTagName(facetToDisplay.name),function(facet){if(facet.nodeName!=="#text"){facet.setAttribute("moreAction","false");
if(facet.nodeName!=="#text"&&facet.childNodes.length>0){var nodeCount=0;
var facetList="";
Ext.each(facet.childNodes,function(node){if(node.nodeName!=="#text"){var visible=(nodeCount<this.count)||(nodeCount<panel.maxDisplayedItems);
if(facet.getAttribute("moreAction")==="false"&&!visible){facet.setAttribute("moreAction","true");
facetList+=moreBt
}facetList+=panel.displayFacetValue(node,visible);
nodeCount++
}},this);
if(facetList!==""){zappette+="<li>"+OpenLayers.i18n(facet.nodeName)+"</li><ul>";
zappette+=facetList;
if(facet.getAttribute("moreAction")==="true"){zappette+=lessBt
}zappette+="</ul>"
}}}},facetToDisplay)
})
}else{Ext.each(facets.childNodes,function(facet){if(facet.nodeName!=="#text"){facet.setAttribute("moreAction","false");
if(facet.nodeName!=="#text"&&facet.childNodes.length>0){var facetList="";
var nodeCount=0;
Ext.each(facet.childNodes,function(node){if(node.nodeName!=="#text"){var visible=(nodeCount<panel.maxDisplayedItems);
if(facet.getAttribute("moreAction")==="false"&&!visible){facet.setAttribute("moreAction","true");
facetList+=moreBt
}facetList+=panel.displayFacetValue(node,visible);
nodeCount++
}});
if(facetList!==""){zappette+="<li>"+OpenLayers.i18n(facet.nodeName)+"</li><ul>";
zappette+=facetList;
if(facet.getAttribute("moreAction")==="true"){zappette+=lessBt
}zappette+="</ul>"
}}}})
}}Ext.getDom("facets").innerHTML="<ul>"+zappette+"</ul>";
var items=Ext.DomQuery.select("a.facet-link");
var scope=this;
Ext.each(items,function(input){Ext.get(input).on("click",function(){scope.addFacet(this.id)
})
});
items=Ext.DomQuery.select("li.facet-more-bt");
scope=this;
Ext.each(items,function(input){Ext.get(input).on("click",function(){scope.displayMoreFacet(this,true)
})
});
items=Ext.DomQuery.select("li.facet-less-bt");
scope=this;
Ext.each(items,function(input){Ext.get(input).on("click",function(){scope.displayMoreFacet(this,false)
})
});
if(this.currentFilterStore.getCount()===0){var records=[];
store.each(function(r){records.push(r.copy())
});
this.startFacetsStore=new Ext.data.JsonStore({recordType:store.recordType});
this.startFacetsStore.add(records)
}if(this.mask){this.mask.hide()
}},displayFacetValue:function(node,visible){var data={facet:node.nodeName,node:node.getAttribute("name"),count:node.getAttribute("count")};
if(this.currentFilterStore.getCount()===0||this.currentFilterStore.query("value",data.node).length===0){var recId=this.facetsStore.getCount()+1,r=new this.facetsStore.recordType(data,recId);
this.facetsStore.add(r);
return"<li class='"+(visible?"":"facet-more")+"' style='"+(visible?"":"display:none;")+"'><a href='javascript:void(0);' class='facet-link' id='"+recId+"'>"+data.node+"<span class='facet-count'>("+data.count+")</span></a></li>"
}return""
},displayMoreFacet:function(li,more){var el=Ext.get(li);
el.setVisibilityMode(Ext.Element.DISPLAY);
el.setVisible(false);
Ext.each(li.parent().query("[class=facet-more]"),function(item){var node=Ext.get(item);
node.setVisibilityMode(Ext.Element.DISPLAY);
node.setVisible(more,true)
});
if(more){li.next("[class=facet-less-bt]").setVisible(true,true)
}else{li.prev("[class=facet-more-bt]").setVisible(true,true)
}},addFacet:function(recordId,stopSearch){if(!this.mask){this.mask=this.el.mask()
}else{this.mask.show()
}var r=this.facetsStore.getById(recordId),form=this.searchForm,id="facet_"+this.counter++;
var data={id:id,facet:r.get("facet"),value:r.get("node"),bcid:"bc_"+id,fieldid:"field_"+id};
var filter=new this.currentFilterStore.recordType(data,this.currentFilterStore.getCount()+1);
this.currentFilterStore.insert(0,filter);
form.insert(0,new Ext.form.TextField({id:data.fieldid,name:"E_"+data.facet,value:data.value,inputType:"hidden"}));
if(this.breadcrumb){var panel=this;
var scrollMenu=new Ext.menu.Menu({cls:"breadcrumb-mn"});
scrollMenu.add({text:OpenLayers.i18n("removeFilter")+" "+OpenLayers.i18n(r.get("facet")),iconCls:"md-mn-reset",handler:function(b,e){this.removeFacet(data.id)
},scope:panel});
if(this.switchFacetsMenu){scrollMenu.add("-");
var i=0;
this.startFacetsStore.query("facet",data.facet).each(function(item,idx){scrollMenu.add({group:data.id+"#",id:data.id+"#"+i++,altText:item.get("node"),checked:item.get("node")===r.get("node")?true:false,text:item.get("node"),handler:function(b,e){this.switchFacet(b)
},scope:panel})
})
}this.breadcrumb.add(new Ext.Button({id:data.bcid,text:data.value,menu:scrollMenu}));
this.breadcrumb.doLayout()
}if(!stopSearch){this.searchForm.fireEvent("search")
}},addFakeFacet:function(type,name,value){var id="facet_"+this.counter++;
var data={id:"fake_"+name,facet:name,value:value,bcid:"bc_"+id+"fake_"+name,type:type};
if(this.breadcrumb){var panel=this;
var scrollMenu=new Ext.menu.Menu({cls:"breadcrumb-mn"});
scrollMenu.add({text:OpenLayers.i18n("removeFilter")+" "+OpenLayers.i18n(type),iconCls:"md-mn-reset",handler:function(b,e){var switcher=Ext.getCmp(data.bcid);
this.breadcrumb&&this.breadcrumb.remove(switcher);
var field=Ext.getCmp(data.facet);
if(!field&&data.facet&&data.facet.indexOf("E_")==0){field=Ext.getCmp(data.facet.substring(2))
}if(!field&&data.facet&&data.facet.indexOf("geometry")>0){field=Ext.getCmp("geometryMap")
}if(!field&&data.facet&&data.facet.indexOf("E_any")==0){field=Ext.getCmp("fullTextField")
}if(field){if(field instanceof Ext.ux.form.SuperBoxSelect){var elements=field.getValueEx();
Ext.each(elements,function(el){if(el.value==data.value||el.id==data.value){elements.splice(elements.indexOf(el),1);
return false
}});
field.setValueEx(elements)
}else{if(field.getXType&&field.getXType()=="gn_geometrymapfield"){Ext.each(field.getTopToolbar().items.items,function(e){if(e.iconCls=="clearPolygon"){e.baseAction.uHandler.apply(e.baseAction.uScope)
}})
}else{if(field.getXType&&field.getXType()=="datefield"){field.setValue("")
}else{if(field.setValue&&field.getValue){if(data.value.length==data.value.indexOf("*")+1){field.setValue((field.getValue()+"*").replace(data.value,""))
}field.setValue((field.getValue()+"").replace(data.value,""));
if(field.fireEvent){field.fireEvent("change")
}}}}}}if(this.searchForm){this.searchForm.fireEvent("search")
}},scope:panel});
var text=data.value;
var maxChar=25;
if(text.length>maxChar){text=text.substring(0,maxChar-5)+"..."
}if(data.id=="fake_E__isHarvested"){this.breadcrumb.add(new Ext.Button({id:data.bcid,text:"harvested metadata",tooltip:"harvested metadata",menu:scrollMenu}))
}else{if(data.id=="fake_E__owner"){this.breadcrumb.add(new Ext.Button({id:data.bcid,text:"my metadata",tooltip:"my metadata",menu:scrollMenu}))
}else{this.breadcrumb.add(new Ext.Button({id:data.bcid,text:text,tooltip:data.value,menu:scrollMenu}))
}}this.breadcrumb.doLayout()
}},switchFacet:function(elem){if(!this.mask){this.mask=this.el.mask()
}else{this.mask.show()
}var elemId=elem.getId(),filterKey=elemId.split("#")[0],newValue=elem.text;
var filter=this.currentFilterStore.query("id",filterKey).get(0);
var field=Ext.getCmp(filter.get("fieldid")),switcher=Ext.getCmp(filter.get("bcid"));
filter.set("value",newValue);
field.setValue(newValue);
switcher.setText(newValue);
this.searchForm.fireEvent("search")
},removeFacet:function(filterKey,silent){if(!this.mask){this.mask=this.el.mask()
}else{this.mask.show()
}var filter=this.currentFilterStore.query("id",filterKey).get(0);
var field=Ext.getCmp(filter.get("fieldid")),switcher=Ext.getCmp(filter.get("bcid"));
this.searchForm.remove(field);
this.breadcrumb&&this.breadcrumb.remove(switcher);
this.currentFilterStore.remove(filter);
if(!silent){this.searchForm.fireEvent("search")
}},reset:function(){this.currentFilterStore.each(function(r){this.removeFacet(r.get("id"),true)
},this)
},init:function(){this.currentFilterStore=new Ext.data.ArrayStore({fields:["id","facet","value","fieldid","bcid"],idIndex:0});
this.update('<div id="facets" class="facets"></div>')
},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
GeoNetwork.FacetsPanel.superclass.initComponent.call(this);
this.on({render:this.init,scope:this})
}});
Ext.reg("gn_facetspanel",GeoNetwork.FacetsPanel);
Ext.namespace("GeoNetwork");
var generalFeedbackItemsInit=function(){return[new Ext.form.FieldSet({title:OpenLayers.i18n("feedbackcontactDetails"),collapsible:true,height:200,items:[{xtype:"textfield",fieldLabel:OpenLayers.i18n("feedbacknameInitials"),name:"name",allowBlank:false,emptyText:""},{xtype:"radiogroup",width:100,items:[{boxLabel:OpenLayers.i18n("feedbackmale"),name:"sex",inputValue:"m",checked:true},{boxLabel:OpenLayers.i18n("feedbackfemale"),name:"sex",inputValue:"f"}]},{xtype:"textfield",fieldLabel:OpenLayers.i18n("feedbackposition"),name:"function",allowBlank:false,emptyText:""},{xtype:"textfield",fieldLabel:OpenLayers.i18n("feedbackorganization"),name:"organization",allowBlank:false,emptyText:""},{xtype:"textfield",fieldLabel:OpenLayers.i18n("feedbackphone"),name:"phone",allowBlank:false,emptyText:""},{xtype:"textfield",fieldLabel:OpenLayers.i18n("feedbackemail"),name:"email",vtype:"email",allowBlank:false,emptyText:""}]}),new Ext.form.FieldSet({title:OpenLayers.i18n("feedbackfeedback"),collapsible:true,height:180,items:[new Ext.form.ComboBox({fieldLabel:OpenLayers.i18n("feedbackfunction"),hiddenName:"feedback-function",store:new Ext.data.SimpleStore({fields:["feedback-function"],data:[[OpenLayers.i18n("feedbackquestion")],[OpenLayers.i18n("feedbackerror")],[OpenLayers.i18n("feedbackremark")],[OpenLayers.i18n("feedbackcontact")]]}),displayField:"feedback-function",valueField:"feedback-function",value:OpenLayers.i18n("feedbackquestion"),typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true}),new Ext.form.ComboBox({fieldLabel:OpenLayers.i18n("feedbackcategory"),hiddenName:"category",store:new Ext.data.SimpleStore({fields:["category"],data:[[OpenLayers.i18n("feedbackmetadataContent")],[OpenLayers.i18n("feedbackdataContent")],[OpenLayers.i18n("feedbackserviceContent")],[OpenLayers.i18n("feedbacksupport")],[OpenLayers.i18n("feedbackmapViewer")],[OpenLayers.i18n("feedbacksearch")],[OpenLayers.i18n("feedbackorganizations")],[OpenLayers.i18n("feedbackcontentManagement")],[OpenLayers.i18n("feedbackmetadataImport")],[OpenLayers.i18n("feedbackmetadataEdit")],[OpenLayers.i18n("feedbackharvesting")],[OpenLayers.i18n("feedbackvalidator")],[OpenLayers.i18n("feedbackother")]]}),displayField:"category",valueField:"category",value:OpenLayers.i18n("feedbackmetadataContent"),typeAhead:true,mode:"local",triggerAction:"all",selectOnFocus:true}),{xtype:"textarea",fieldLabel:OpenLayers.i18n("feedbackremarks"),name:"remarks",allowBlank:false,emptyText:"",width:300}]})]
};
var metadataFeedbackItemsInit=function(record){return[new Ext.form.FieldSet({title:OpenLayers.i18n("feedbackmetadataData"),collapsible:true,height:80,items:[{xtype:"displayfield",fieldLabel:OpenLayers.i18n("feedbacktitle"),name:"title",value:record.get("title")},{xtype:"hidden",name:"title",value:record.get("title")},{xtype:"hidden",name:"date",value:record.get("changedate")},{xtype:"hidden",name:"uuid",value:record.get("uuid")},{xtype:"displayfield",fieldLabel:OpenLayers.i18n("feedbackorganization"),name:"metadataorganisation",value:record.get("organization")},{xtype:"hidden",name:"metadataorganisation",value:record.get("organization")},{xtype:"hidden",name:"metadataemail",value:record.get("email")}]})]
};
var feedbackPanelInit=function(record){var metadataFeedbackItems=[];
if(record){metadataFeedbackItems=metadataFeedbackItemsInit(record)
}var generalFeedbackItems=generalFeedbackItemsInit();
var feedbackItems=metadataFeedbackItems.concat(generalFeedbackItems);
return new Ext.form.FormPanel({id:"feedbackPanel",xtype:"form",width:600,height:600,title:OpenLayers.i18n("feedbackPanelTitle"),frame:true,bodyStyle:"padding: 6px",labelWidth:200,defaults:{msgTarget:"under"},items:[feedbackItems],buttons:[{text:OpenLayers.i18n("feedbacksubmit"),handler:function(){if(feedbackPanel.getForm().isValid()){feedbackPanel.getForm().submit({url:catalogue.services.feedback,scope:this,success:function(fp,action){Ext.getCmp("feedbackWin").destroy()
},failure:function(response){Ext.Msg.show({title:OpenLayers.i18n("feedbackerrorTitle"),msg:OpenLayers.i18n("feedbackerrorMsg"),width:300,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});
Ext.getCmp("feedbackWin").destroy()
}})
}}},{text:OpenLayers.i18n("feedbackcancel"),handler:function(){Ext.getCmp("feedbackWin").destroy()
}}]})
};
var feedbackPanel;
GeoNetwork.FeedbackForm=function(config,record){var config=config||{};
feedbackPanel=feedbackPanelInit(record);
Ext.applyIf(config,{title:OpenLayers.i18n("feedbackWindowTitle"),closeAction:"hide",id:"feedbackWin",width:620,constrain:true,items:[feedbackPanel]});
GeoNetwork.FeedbackForm.superclass.constructor.call(this,config);
this.window=this
};
Ext.extend(GeoNetwork.FeedbackForm,Ext.Window);
Ext.reg("gn_feedbackform",GeoNetwork.FeedbackForm);
Ext.namespace("GeoNetwork");
GeoNetwork.LoginForm=Ext.extend(Ext.FormPanel,{url:"",catalogue:undefined,defaultConfig:{border:false,layout:"form",id:"loginForm",hideLoginLabels:true,width:340},defaultType:"textfield",userInfo:undefined,username:undefined,password:undefined,toggledFields:[],toggledFieldsOff:[],keys:[{key:[Ext.EventObject.ENTER],handler:function(){Ext.getCmp("btnLoginForm").fireEvent("click")
}}],initComponent:function(){Ext.applyIf(this,this.defaultConfig);
var form=this;
var loginBt=new Ext.Button({width:50,text:OpenLayers.i18n("login"),iconCls:"md-mn mn-login",id:"btnLoginForm",listeners:{click:function(){this.catalogue.login(this.username.getValue(),this.password.getValue())
},scope:form}}),adminBt=new Ext.Button({width:80,text:OpenLayers.i18n("administration"),listeners:{click:function(){this.catalogue.admin()
},scope:this}}),logoutBt=new Ext.Button({width:80,text:OpenLayers.i18n("logout"),iconCls:"md-mn mn-logout",listeners:{click:function(){this.catalogue.logout()
},scope:this}});
this.username=new Ext.form.TextField({id:"username",name:"username",width:70,autoCreate:{tag:"input"},hideLabel:false,allowBlank:false,fieldLabel:OpenLayers.i18n("username"),emptyText:OpenLayers.i18n("username")});
this.password=new Ext.form.TextField({name:"password",width:70,hideLabel:false,allowBlank:false,fieldLabel:OpenLayers.i18n("password"),emptyText:OpenLayers.i18n("password"),inputType:"password"});
this.userInfo=new Ext.form.Label({width:170,text:"",cls:"loginInfo"});
if(this.hideLoginLabels){this.toggledFields.push(this.username,this.password,loginBt)
}else{var usernameLb=new Ext.form.Label({html:OpenLayers.i18n("username")}),passwordLb=new Ext.form.Label({html:OpenLayers.i18n("password")});
this.toggledFields.push(usernameLb,this.username,passwordLb,this.password,loginBt)
}this.toggledFieldsOff.push(this.userInfo,logoutBt);
if(this.catalogue.adminAppUrl!==""){this.toggledFieldsOff.push(adminBt)
}this.items=[this.toggledFields,this.toggledFieldsOff];
GeoNetwork.LoginForm.superclass.initComponent.call(this);
var loggedIn=this.catalogue.isLoggedIn();
this.login(this.catalogue,loggedIn);
this.catalogue.on("afterLogin",this.login,this);
this.catalogue.on("afterLogout",this.login,this)
},login:function(cat,user){var status=user?true:false;
Ext.each(this.toggledFields,function(item){item.setVisible(!status)
});
Ext.each(this.toggledFieldsOff,function(item){item.setVisible(status)
});
if(cat.identifiedUser&&cat.identifiedUser.username){this.userInfo.setText(cat.identifiedUser.name+" "+cat.identifiedUser.surname+" <br/>("+cat.identifiedUser.role+")",false)
}else{this.userInfo.setText("")
}this.doLayout(false,true)
}});
Ext.reg("gn_loginform",GeoNetwork.LoginForm);
Ext.namespace("GeoNetwork");
GeoNetwork.MetadataMenu=Ext.extend(Ext.menu.Menu,{record:undefined,setRecord:function(record){this.record=record;
this.updateMenu()
},resultsView:undefined,catalogue:undefined,editAction:undefined,deleteAction:undefined,zoomToAction:undefined,otherActions:undefined,adminMenuSeparator:undefined,duplicateAction:undefined,createChildAction:undefined,statusAction:undefined,versioningAction:undefined,adminAction:undefined,categoryAction:undefined,viewAction:undefined,printAction:undefined,viewXMLAction:undefined,getMEFAction:undefined,ratingWidget:undefined,defaultConfig:{},create:function(){this.editAction=new Ext.Action({text:OpenLayers.i18n("edit"),iconCls:"md-mn-edit",handler:function(){var id=this.record.get("id");
this.catalogue.metadataEdit(id)
},scope:this});
this.add(this.editAction);
this.deleteAction=new Ext.Action({text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var id=this.record.get("uuid");
this.catalogue.metadataDelete(id)
},scope:this});
this.add(this.deleteAction);
this.duplicateAction=new Ext.Action({text:OpenLayers.i18n("duplicate"),iconCls:"md-mn-copy",handler:function(){var id=this.record.get("id");
GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,id,OpenLayers.i18n("duplicate"),false)
},scope:this});
this.createChildAction=new Ext.Action({text:OpenLayers.i18n("createChild"),iconCls:"childIcon",handler:function(){var id=this.record.get("id");
GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,id,OpenLayers.i18n("createChild"),true)
},scope:this});
this.adminAction=new Ext.Action({text:OpenLayers.i18n("privileges"),tooltip:OpenLayers.i18n("privilegesTT"),iconCls:"privIcon",handler:function(){var id=this.record.get("id");
this.catalogue.metadataAdmin(id)
},scope:this});
this.statusAction=new Ext.Action({text:OpenLayers.i18n("status"),tooltip:OpenLayers.i18n("statusTT"),iconCls:"statusIcon",handler:function(){var id=this.record.get("id");
this.catalogue.metadataStatus(id)
},scope:this});
this.versioningAction=new Ext.Action({text:OpenLayers.i18n("versioning"),tooltip:OpenLayers.i18n("versioningTT"),iconCls:"versioningIcon",handler:function(){var id=this.record.get("id");
this.catalogue.metadataVersioning(id)
},scope:this});
this.categoryAction=new Ext.Action({text:OpenLayers.i18n("categories"),handler:function(){var id=this.record.get("id");
this.catalogue.metadataCategory(id)
},scope:this});
this.otherActions=new Ext.menu.Item({text:OpenLayers.i18n("otherActions"),menu:{items:[this.duplicateAction,this.createChildAction,this.adminAction,this.statusAction,this.versioningAction,this.categoryAction]}});
this.add(this.otherActions);
this.adminMenuSeparator=new Ext.menu.Separator();
this.add(this.adminMenuSeparator);
this.viewXMLAction=new Ext.Action({text:OpenLayers.i18n("saveXml"),iconCls:"xmlIcon",handler:function(){var id=this.record.get("uuid");
var schema=this.record.get("schema");
this.catalogue.metadataXMLShow(id,schema,"true")
},scope:this});
this.add(this.viewXMLAction);
this.printAction=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){this.catalogue.metadataPrint(this.record.get("uuid"))
},scope:this});
this.add(this.printAction);
if(Ext.ux.RatingItem){this.ratingWidget=new Ext.ux.RatingItem(null,{canReset:false,name:"rating",disabled:true,nbStars:5,cls:"ux-menu-rating-item",listeners:{change:function(e,value,star){if(value){var uuid=this.record.get("uuid");
this.catalogue.metadataRate(uuid,value,this.hide());
this.ratingWidget.reset()
}},scope:this}});
this.add(this.ratingWidget)
}this.updateMenu()
},updateMenu:function(){if(!this.record){if(!identified){this.editAction.hide();
this.deleteAction.hide()
}return
}var isEditable=this.record.get("edit")==="true"?(this.record.get("isharvested")==="y"?GeoNetwork.Settings.editor.editHarvested||false:true):false,isHarvested=this.record.get("isharvested")==="y"?true:false,harvesterType=this.record.get("harvestertype"),identified=this.catalogue.isIdentified();
if(!identified){this.editAction.hide();
this.deleteAction.hide()
}else{this.editAction.show();
this.deleteAction.show()
}this.otherActions.setVisible(identified);
this.adminMenuSeparator.setVisible(identified);
this.editAction.setDisabled(!isEditable);
this.adminAction.setDisabled(!isEditable&&!isHarvested);
this.statusAction.setDisabled(!isEditable&&!isHarvested);
this.versioningAction.setDisabled(!isEditable&&!isHarvested);
this.categoryAction.setDisabled(!isEditable&&!isHarvested);
this.deleteAction.setDisabled(!isEditable&&!isHarvested);
if(this.ratingWidget){this.ratingWidget.reset();
if(isHarvested&&harvesterType!=="geonetwork"){this.ratingWidget.disable()
}else{this.ratingWidget.enable()
}}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
GeoNetwork.MetadataMenu.superclass.initComponent.call(this);
this.create()
}});
Ext.reg("gn_metadatamenu",GeoNetwork.MetadataMenu);
Ext.namespace("GeoNetwork");
GeoNetwork.MetadataResultsView=Ext.extend(Ext.DataView,{catalogue:undefined,templates:null,overClass:"md-over",itemSelector:"li.md",emptyText:"",autoWidth:true,maps:[],mapsProjection:"EPSG:4326",projectionFrom:undefined,projectionTo:undefined,styleInitialized:false,mdSelectionUuids:[],layer_style_selected:OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),defaultConfig:{featurecolor:"#ee9900",colormap:undefined,layer_style:new OpenLayers.Style({strokeOpacity:1,strokeWidth:1,fillOpacity:0,strokeColor:"${featurecolor}",fillColor:"${featurecolor}"}),layer_style_hover:new OpenLayers.Style({strokeOpacity:1,strokeWidth:3,fillOpacity:0.3,strokeColor:"${featurecolor}",fillColor:"${featurecolor}"})},features:[],hover_feature:[],displayContextualMenu:true,contextMenu:undefined,contextMenuNodeId:undefined,acMenu:undefined,displaySerieMembers:false,maxOfMembers:50,relatedTpl:undefined,newMetadataWindow:undefined,plugins:[],listeners:{dblclick:{fn:function(dv,idx,node,e){if(this.maps.length!==0){var record=this.getStore().getAt(idx);
var uuid=record.get("uuid");
this.zoomTo(uuid)
}}},mouseenter:{fn:function(dv,idx,node,e){var i,j;
if(this.maps.length!==0){var record=this.getStore().getAt(idx);
var uuid=record.get("uuid");
for(j=0;
j<this.maps.length;
j++){var l=this.maps[j].layer;
if(l.features){for(i=0;
i<l.features.length;
i++){if(uuid===l.features[i].attributes.id){if(!this.hover_feature[j]){l.drawFeature(l.features[i],"hover");
this.hover_feature[j]=l.features[i]
}}}}}}this.actionMenuInit(idx,node)
}},mouseleave:{fn:function(dv,idx,node,e){var i;
if(this.acMenu){this.acMenu.hide()
}this.acMenu=undefined;
for(i=0;
i<this.maps.length;
i++){if(this.hover_feature[i]){var l=this.maps[i].layer;
l.drawFeature(this.hover_feature[i],"default");
this.hover_feature[i]=null
}}}},contextmenu:{fn:function(dv,idx,node,e){if(this.displayContextualMenu){this.contextMenuNodeId=idx;
this.createMenu(idx,dv);
this.contextMenu.showAt(e.getXY());
e.stopEvent()
}}}},actionMenuInit:function(idx,node){this.acMenu=Ext.get(Ext.DomQuery.selectNode("span.md-action-menu",node));
if(this.acMenu){this.acMenu.on("click",function(){this.createMenu(idx,this);
this.contextMenu.showAt([this.acMenu.getX(),this.acMenu.getY()+this.acMenu.getHeight()])
},this);
this.acMenu.show()
}},createMenu:function(id,dv){var record=this.getStore().getAt(id);
if(!this.contextMenu){this.contextMenu=new GeoNetwork.MetadataMenu({floating:true,catalogue:catalogue,record:record,resultsView:dv})
}else{this.contextMenu.setRecord(record)
}},zoomTo:function(uuid){var i,j;
for(j=0;
j<this.maps.length;
j++){var l=this.maps[j].layer;
if(l.features){for(i=0;
i<l.features.length;
i++){if(uuid===l.features[i].attributes.id){var bounds=l.features[i].geometry.getBounds();
if(bounds){this.maps[j].map.zoomToExtent(bounds)
}break
}}}}},initComponent:function(){var i;
this.templates=this.templates||{SIMPLE:GeoNetwork.Templates.SIMPLE,THUMBNAIL:GeoNetwork.Templates.THUMBNAIL,FULL:GeoNetwork.Templates.FULL};
if(cookie&&cookie.get("user")){var cookiedTemplate=cookie.get("user").searchTemplate;
if(cookiedTemplate){var temp=this.templates[cookiedTemplate];
if(temp){this.tpl=temp
}}else{this.tpl=this.templates.THUMBNAIL
}}else{this.tpl=this.templates.THUMBNAIL
}Ext.applyIf(this,this.defaultConfig);
GeoNetwork.MetadataResultsView.superclass.initComponent.call(this);
this.setStore(this.catalogue.metadataStore);
this.relatedTpl=new Ext.XTemplate(this.relatedTpl||GeoNetwork.Templates.Relation.SHORT);
if(this.maps){if(this.maps instanceof OpenLayers.Map){var map=this.maps;
this.maps=[];
this.addMap(map)
}else{Ext.each(this.maps,function(m){this.initMap(m)
})
}}else{this.maps=[]
}var afterrender=function(e){if(Ext.isIE7){var resultsPanel=Ext.get("resultsPanel");
if(resultsPanel&&resultsPanel.dom.childNodes&&resultsPanel.dom.childNodes.length){resultsPanel=resultsPanel.dom;
var obj=resultsPanel.childNodes[0].childNodes[1].childNodes[0];
obj=Ext.get(obj);
obj.setHeight("auto")
}else{setTimeout(afterrender,1000)
}}};
this.on("selectionchange",this.selectionChange);
this.on("afterrender",afterrender)
},setStore:function(store){if(this.getStore()){this.getStore().un("load",this.resultsLoaded,this);
this.getStore().un("clear",this.destroyMetadataBbox,this)
}this.store=store;
this.getStore().on({load:this.resultsLoaded,clear:this.destroyMetadataBbox,scope:this})
},addMap:function(map,zoomToExtentOnSearch){var found=false,i;
for(i=0;
i<this.maps.length;
i++){if(this.maps[i].map.id===map.id){found=true;
break
}}if(!found){var m={map:map,zoomToExtentOnSearch:zoomToExtentOnSearch||false};
this.mapsProjection=map.projection;
this.projectionFrom=new OpenLayers.Projection("EPSG:4326");
this.projectionTo=new OpenLayers.Projection(this.mapsProjection);
this.maps.push(m);
this.initMap(m)
}},initMap:function(map){if(!this.styleInitialized){this.initStyle();
this.styleInitialized=true
}var l=new OpenLayers.Layer.Vector(OpenLayers.i18n("mdResultsLayer"),{styleMap:new OpenLayers.StyleMap({"default":this.layer_style,hover:this.layer_style_hover})});
this.addCurrentFeatures(l);
map.layer=l;
map.map.addLayer(l)
},removeMap:function(mapId){this.maps.splice(mapId,1)
},getTemplates:function(){return this.templates
},removeTemplate:function(name){delete this.templates[name]
},addTemplate:function(name,template){this.templates[name]=template
},applyTemplate:function(name){this.tpl=this.templates[name];
this.refresh();
this.dislayLinks(this.records);
var user=cookie.get("user");
if(user){user.searchTemplate=name;
cookie.set("user",user)
}},initStyle:function(){if(!this.colormap){this.colormap=[this.featurecolor]
}if(this.colormap.length>1){this.featurecolorCSS=this.featurecolorCSS||"border-left-width: 3px;border-left-style: solid; border-left-color: ${featurecolor}"
}else{this.featurecolorCSS=undefined
}},destroyMetadataBbox:function(){var i;
for(i=0;
i<this.maps.length;
i++){var l=this.maps[i].layer;
if(l.features){if(l.features.length>0){this.features=[];
l.destroyFeatures()
}}}},resultsLoaded:function(view,records,options){this.autoSelectTemplate();
this.records=records;
this.drawMetadataBbox(view,records,options);
this.contextMenu=undefined;
this.initRatingWidget();
this.dislayLinks(records);
this.dislayRelations(records)
},autoSelectTemplate:function(){if(cookie&&cookie.get("user")){var cookiedTemplate=cookie.get("user").searchTemplate;
if(cookiedTemplate){var temp=this.templates[cookiedTemplate];
if(temp&&Ext.getCmp(cookiedTemplate)&&!Ext.getCmp(cookiedTemplate).pressed){Ext.getCmp(cookiedTemplate).toggle()
}}}},dislayLinks:function(records){var view=this;
Ext.each(records,function(r){var links=r.get("links"),id=r.get("id"),uuid=r.get("uuid");
if(Ext.ux.RatingItem&&!catalogue.identifiedUser){var div=Ext.query("#rating-"+id,view.el.dom.body);
if(div.length>0){div=Ext.get(div[0]);
var ratingWidget=new Ext.ux.RatingItem(null,{canReset:false,name:"rating"+id,disabled:false,nbStars:5,cls:"ux-menu-rating-item",listeners:{change:function(e,value,star){if(value){var uuid=r.get("uuid");
this.catalogue.metadataRate(uuid,value,null);
ratingWidget.reset()
}},scope:this}});
div.insertFirst(ratingWidget.el)
}}if(links.length>0){var div=Ext.query("#md-links-"+id,view.el.dom.body),el=Ext.get(div[0]);
if(el){var store=new Ext.data.ArrayStore({autoDestroy:true,idIndex:0,fields:[{name:"href",mapping:"href"},{name:"name",mapping:"name"},{name:"protocol",mapping:"protocol"},{name:"title",mapping:"title"},{name:"type",mapping:"type"}],data:links});
store.sort("type");
var linkButton=[],label=null,currentType=null,bt,allowDynamic=r.get("dynamic"),allowDownload=r.get("download"),hasDownloadAction=false,wmsUrl=[],wfsUrl=[];
store.each(function(record){if(record.get("href")!==""){if(currentType===null||currentType!==record.get("type")){if(linkButton.length!==0){view.addLinkMenu(linkButton,label,currentType,el)
}linkButton=[];
currentType=record.get("type");
label="";
if(currentType==="application/x-compressed"){hasDownloadAction=true
}}var text=null,handler=null;
if((currentType==="application/vnd.ogc.wms_xml"||currentType.toUpperCase().indexOf("OGC:WMS")>=0)){if(allowDynamic){linkButton.push({text:OpenLayers.i18n("addLayer")+" "+record.get("name"),handler:function(b,e){if(app.switchMode){app.switchMode("1",true)
}app.getIMap().addWMSLayer([[record.get("title"),record.get("href"),record.get("name"),uuid]])
}});
wmsUrl.push(record.get("href"))
}}else{if((currentType==="application/vnd.ogc.wmts_xml"||currentType.toUpperCase().indexOf("OGC:WMTS")>=0)){if(allowDynamic){linkButton.push({text:OpenLayers.i18n("addLayer")+" "+record.get("name"),handler:function(b,e){if(app.switchMode){app.switchMode("1",true)
}app.getIMap().addWMTSLayer([[record.get("title"),record.get("href"),record.get("name"),uuid]])
}})
}}else{if((currentType==="application/vnd.ogc.wfs_xml"||currentType.toUpperCase().indexOf("OGC:WFS")>=0)){wfsUrl.push(record.get("href"))
}else{var displayLink=true;
if(record.get("href").indexOf("resources.get")!==-1){displayLink=allowDownload
}else{if(currentType==="application/vnd.google-earth.kml+xml"){displayLink=allowDynamic
}}if(displayLink){linkButton.push({text:(record.get("title")||record.get("name")),href:record.get("href")})
}}}}}});
if(linkButton!==null){view.addLinkMenu(linkButton,label,currentType,el)
}if(catalogue.resultsView.tpl!==catalogue.resultsView.templates.THUMBNAIL){if(wmsUrl.length!==0){var validateWxS=function(){validateWMSWFS(wmsUrl[0],el,"WMS")
};
view.addLinkMenu([{text:OpenLayers.i18n("validateWms")+": "+wmsUrl[0],handler:validateWxS}],"","validateWmsIcon",el)
}if(wfsUrl.length!==0){var validateWxS=function(){validateWMSWFS(wfsUrl[0],el,"WFS")
};
view.addLinkMenu([{text:OpenLayers.i18n("validateWfs")+": "+wfsUrl[0],handler:validateWxS}],"","validateWfsIcon",el)
}}if(hasDownloadAction){view.addLinkMenu([{text:OpenLayers.i18n("download")+" "+record.get("name"),handler:function(){catalogue.metadataPrepareDownload(id)
}}],OpenLayers.i18n("prepareDownload"),"downloadAllIcon",el)
}}}},this)
},addLinkMenu:function(linkButton,label,currentType,el,alt){if(linkButton.length===0){return
}if(linkButton.length===1){var handler=linkButton[0].handler||function(){window.open(linkButton[0].href)
};
bt=new Ext.Button({text:label,tooltip:linkButton[0].text,handler:handler,iconCls:GeoNetwork.Util.protocolToCSS[currentType]||"md-mn-hidden",renderTo:el})
}else{bt=new Ext.Button({text:label,menu:new Ext.menu.Menu({cls:"links-mn",items:linkButton}),iconCls:GeoNetwork.Util.protocolToCSS[currentType]||"md-mn-hidden",renderTo:el})
}},dislayRelations:function(records){var relationTypes="children";
var view=this;
if(this.displaySerieMembers){Ext.each(records,function(r){var isSerie=r.get("type")==="series",id=r.get("id");
if(isSerie){var store=new GeoNetwork.data.MetadataRelationStore(this.catalogue.services.mdRelation+"?type="+relationTypes+"&fast=false&uuid="+escape(r.get("uuid")),null,true);
store.load();
store.on("load",function(store,records){Ext.each(records,function(md){if(view.el){var div=Ext.query("#md-relation-"+id,view.el.dom.body),el=Ext.get(div[0]),container=el.parent();
if(container&&container.isScrollable()){container.addClass("more")
}if(el){el.insertHtml("beforeEnd",view.relatedTpl.apply(md.data));
container.setVisible(true)
}}},this)
})
}},this)
}},drawMetadataBbox:function(view,records,options){var i,j;
if(this.maps.length===0){return
}this.features=[];
Ext.each(records,function(r,idx){var featurecolor=this.colormap&&this.colormap[idx%this.colormap.length];
r.set("featurecolor",featurecolor);
r.set("featurecolorCSS",this.featurecolorCSS?OpenLayers.String.format(this.featurecolorCSS,{featurecolor:featurecolor}):"");
var bboxes=r.get("bbox");
if(bboxes){var polygons=[];
for(j=0;
j<bboxes.length;
j++){var bbox=bboxes[j].value;
var p1=new OpenLayers.Geometry.Point(bbox[2],bbox[1]);
var p2=new OpenLayers.Geometry.Point(bbox[2],bbox[3]);
var p3=new OpenLayers.Geometry.Point(bbox[0],bbox[3]);
var p4=new OpenLayers.Geometry.Point(bbox[0],bbox[1]);
if(this.mapsProjection!=="EPSG:4326"){p1.transform(this.projectionFrom,this.projectionTo);
p2.transform(this.projectionFrom,this.projectionTo);
p3.transform(this.projectionFrom,this.projectionTo);
p4.transform(this.projectionFrom,this.projectionTo)
}var pointList=[p1,p2,p3,p4,p1];
var linearRing=new OpenLayers.Geometry.LinearRing(pointList);
var polygon=new OpenLayers.Geometry.Polygon([linearRing]);
polygons.push(polygon.clone())
}var multipolygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(polygons),{id:r.get("uuid"),featurecolor:featurecolor});
this.features.push(multipolygon.clone())
}},this);
for(i=0;
i<this.maps.length;
i++){this.addCurrentFeatures(this.maps[i].layer)
}if(this.features.length>0){for(i=0;
i<this.maps.length;
i++){var m=this.maps[i];
if(m.zoomToExtentOnSearch){m.map.zoomToExtent(m.layer.getDataExtent())
}}}},initRatingWidget:function(){var ratingWidgets=Ext.DomQuery.select("div.rating"),idx;
for(idx=0;
idx<ratingWidgets.length;
++idx){if(Ext.ux.RatingItem){var ri=new Ext.ux.RatingItem(ratingWidgets[idx],{disabled:true,name:"rating"+idx})
}else{ratingWidgets[idx].style.display="none"
}}},selectAll:function(){var checkboxes=Ext.DomQuery.select("input.selector"),idx;
for(idx=0;
idx<checkboxes.length;
++idx){checkboxes[idx].checked=true
}},selectAllInPage:function(){var checkboxes=Ext.DomQuery.select("input.selector"),idx;
for(idx=0;
idx<checkboxes.length;
++idx){checkboxes[idx].checked=true;
Ext.each(this.getRecords(this.getNodes()),function(r){var uuid=r.get("uuid");
this.catalogue.metadataSelect("add",[uuid])
},this)
}},selectNone:function(){var checkboxes=Ext.DomQuery.select("input.selector"),idx;
for(idx=0;
idx<checkboxes.length;
++idx){checkboxes[idx].checked=false
}},selectionChange:function(dv,nodes){if(this.catalogue){var records=this.getRecords(nodes);
var selected={};
var toAdd=[];
var toRemove=[];
var i;
var uuid;
for(i=0;
i<records.length;
i++){uuid=records[i].get("uuid");
selected[uuid]=true
}for(i=0;
i<this.mdSelectionUuids.length;
i++){uuid=this.mdSelectionUuids[i];
if(selected[uuid]){toAdd.push(uuid)
}else{toRemove.push(uuid)
}}for(uuid in selected){if(selected.hasOwnProperty(uuid)&&!this.mdSelectionUuids[uuid]){toAdd.push(uuid)
}}this.catalogue.metadataSelect("add",toAdd);
this.catalogue.metadataSelect("remove",toRemove);
this.mdSelectionUuids=toAdd
}},addCurrentFeatures:function(layer){var len=this.features.length,j;
if(len>0){var clones=[];
clones=[];
var orig,clone;
for(j=0;
j<len;
j++){orig=this.features[j];
clone=orig.clone();
clones[j]=clone
}layer.addFeatures(clones)
}},onDestroy:function(){GeoNetwork.MetadataResultsView.superclass.onDestroy.apply(this,arguments)
}});
Ext.reg("gn_metadataresultsview",GeoNetwork.MetadataResultsView);
Ext.namespace("GeoNetwork");
GeoNetwork.MetadataResultsToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,metadataResultsView:undefined,mdSelectionInfoCmp:undefined,mdSelectionAsMenu:true,searchBtCmp:undefined,searchFormCmp:undefined,sortByCmp:undefined,sortByCombo:undefined,mdSelectionInfo:"md-selection-info",selectionActions:[],deleteAction:undefined,otherItem:undefined,ownerAction:undefined,updateCategoriesAction:undefined,updatePrivilegesAction:undefined,updateStatusAction:undefined,updateVersionAction:undefined,createMetadataAction:undefined,newMetadataWindow:undefined,mdImportAction:undefined,adminAction:undefined,permalinkProvider:undefined,actionMenu:undefined,item:null,actionOnSelectionMenu:undefined,admin:false,selectionToolBar:undefined,initComponent:function(){var cmp=[];
this.selectionToolBar=this.createSelectionToolBar();
cmp.push(this.selectionToolBar);
var previousAction=new Ext.Action({id:"previousBt_up",text:"&lt;&lt;",handler:function(){var from=catalogue.startRecord-50;
if(from>0){catalogue.startRecord=from;
catalogue.search("advanced-search-options-content-form",app.searchApp.loadResults,null,catalogue.startRecord,true)
}},scope:this});
cmp.push(previousAction);
cmp.push({xtype:"tbtext",text:"",id:"info_up"});
var nextAction=new Ext.Action({id:"nextBt_up",text:"&gt;&gt;",handler:function(){catalogue.startRecord+=50;
catalogue.search("advanced-search-options-content-form",app.searchApp.loadResults,null,catalogue.startRecord,true)
},scope:this});
cmp.push(nextAction);
cmp.push(["->"]);
var sortOption=this.getSortByCombo(OpenLayers.i18n("relevance"));
cmp.push(OpenLayers.i18n("sortBy"),sortOption,"|");
cmp.push(this.createTemplateMenu());
cmp.push(this.createOtherActionMenu());
if(this.permalinkProvider){var l=this.permalinkProvider.getLink;
cmp.push(GeoNetwork.Util.buildPermalinkMenu(l,this.permalinkProvider))
}GeoNetwork.MetadataResultsToolbar.superclass.initComponent.call(this);
this.add(cmp);
this.catalogue.on("selectionchange",this.updateSelectionInfo,this);
this.catalogue.on("afterLogin",this.updatePrivileges,this);
this.catalogue.on("afterLogout",this.updatePrivileges,this);
this.updateSelectionInfo(this.catalogue,0)
},getSortByCombo:function(){var tb=this;
this.sortByCmp=Ext.getCmp("E_sortBy");
this.sortByCombo=new Ext.form.ComboBox({mode:"local",id:"sortByToolBar",triggerAction:"all",value:OpenLayers.i18n("relevance"),width:130,store:GeoNetwork.util.SearchFormTools.getSortByStore(),valueField:"id",displayField:"name",listeners:{select:function(cb,record,idx){if(this.sortByCmp){this.sortByCmp.setValue(cb.getValue());
var tokens=cb.getValue().split("#");
Ext.getCmp("E_sortBy").setValue(tokens[0]);
if(tokens.length>1){Ext.getCmp("E_orderBy").setValue(tokens[1])
}else{Ext.getCmp("E_orderBy").setValue("")
}}if(this.searchFormCmp){this.searchFormCmp.fireEvent("search")
}else{if(this.searchBtCmp){this.searchBtCmp.fireEvent("click")
}}},scope:tb}});
return this.sortByCombo
},clickTemplateMenu:function(item,pressed){if(pressed){this.applyTemplate(item.getId())
}this.initRatingWidget()
},createMassiveActionMenu:function(hide){this.deleteAction=new Ext.menu.Item({text:OpenLayers.i18n("delete"),iconCls:"cancel",id:"deleteAction",handler:function(){this.catalogue.massiveOp("Delete",function(){this.catalogue.metadataSelectNone()
})
},scope:this,hidden:hide});
this.ownerAction=new Ext.menu.Item({text:OpenLayers.i18n("newOwner"),id:"ownerAction",handler:function(){this.catalogue.massiveOp("NewOwner")
},scope:this,hidden:hide});
this.updateCategoriesAction=new Ext.menu.Item({text:OpenLayers.i18n("updateCategories"),id:"updateCategoriesAction",handler:function(){this.catalogue.massiveOp("Categories")
},scope:this,hidden:hide});
this.updatePrivilegesAction=new Ext.menu.Item({text:OpenLayers.i18n("updatePrivileges"),id:"updatePrivilegesAction",iconCls:"privIcon",handler:function(){this.catalogue.massiveOp("Privileges")
},scope:this,hidden:hide});
this.updateStatusAction=new Ext.menu.Item({text:OpenLayers.i18n("updateStatus"),id:"updateStatusAction",iconCls:"statusIcon",handler:function(){this.catalogue.massiveOp("Status")
},scope:this,hidden:hide});
this.updateVersionAction=new Ext.menu.Item({text:OpenLayers.i18n("updateVersion"),id:"updateVersionAction",iconCls:"versioningIcon",handler:function(){this.catalogue.massiveOp("Versioning")
},scope:this,hidden:hide});
this.selectionActions.push(this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction,this.updateStatusAction,this.updateVersionAction);
this.actionMenu.addItem(this.deleteAction);
this.actionMenu.addItem(this.ownerAction);
this.actionMenu.addItem(this.updateCategoriesAction);
this.actionMenu.addItem(this.updatePrivilegesAction);
this.actionMenu.addItem(this.updateStatusAction);
this.actionMenu.addItem(this.updateVersionAction)
},createAdminMenu:function(hide){this.actionMenu.addItem("-");
this.otherItem=new Ext.menu.TextItem({html:'<b class="menu-title">'+OpenLayers.i18n("adminAction")+"</b>",hidden:true});
this.actionMenu.addItem(this.otherItem);
this.createMetadataAction=new Ext.menu.Item({text:OpenLayers.i18n("newMetadata"),iconCls:"addIcon",handler:function(){if(this.newMetadataWindow){this.newMetadataWindow.close();
this.newMetadataWindow=undefined
}if(!this.newMetadataWindow){var newMetadataPanel=new GeoNetwork.editor.NewMetadataPanel({getGroupUrl:this.catalogue.services.getGroups,catalogue:this.catalogue});
this.newMetadataWindow=new Ext.Window({title:OpenLayers.i18n("newMetadataTitle"),width:600,height:420,layout:"fit",modal:true,items:newMetadataPanel,closeAction:"hide",constrain:true,iconCls:"addIcon"})
}this.newMetadataWindow.show()
},scope:this,hidden:hide});
this.actionMenu.addItem(this.createMetadataAction);
this.mdImportAction=new Ext.menu.Item({text:OpenLayers.i18n("importMetadata"),handler:function(){this.catalogue.metadataImport()
},scope:this,hidden:hide});
this.actionMenu.addItem(this.mdImportAction);
this.adminAction=new Ext.menu.Item({text:OpenLayers.i18n("administration"),handler:function(){this.catalogue.admin()
},scope:this,hidden:hide});
this.actionMenu.addItem(this.adminAction)
},createTemplateMenu:function(){var tpls=this.metadataResultsView.getTemplates();
var data=[];
var t;
var defaultTpl="THUMBNAIL";
if(cookie.get("user")&&cookie.get("user").searchTemplate){defaultTpl=cookie.get("user").searchTemplate
}for(t in tpls){if(tpls.hasOwnProperty(t)){var tg=new Ext.Button({text:"",tooltip:OpenLayers.i18n("template."+t),enableToggle:true,toggleGroup:"tpl",id:t,iconCls:"mn-view-"+t.toLowerCase(),toggleHandler:this.clickTemplateMenu,scope:this.metadataResultsView,pressed:(t===defaultTpl?true:false)});
data.push(tg)
}}return[data,"|"]
},createOtherActionMenu:function(){this.actionMenu=new Ext.menu.Menu();
var csvExportAction=new Ext.Action({text:OpenLayers.i18n("exportCsv"),handler:function(){this.catalogue.csvExport()
},scope:this});
var mefExportAction=new Ext.Action({text:OpenLayers.i18n("exportZip"),iconCls:"md-mn-zip",handler:function(){this.catalogue.mefExport()
},scope:this});
var printAction=new Ext.Action({text:OpenLayers.i18n("printSel"),iconCls:"md-mn-pdf",handler:function(){var sortField;
var sortFieldOrder;
var sortByEl=Ext.getCmp("E_sortBy");
if(sortByEl){sortField=sortByEl.getValue();
var sortByOrderEl=Ext.getCmp("sortOrder");
if(sortByOrderEl){sortFieldOrder=sortByOrderEl.getValue()
}}this.catalogue.pdfExport(sortField,sortFieldOrder)
},scope:this});
this.selectionActions.push(mefExportAction,csvExportAction,printAction);
this.actionMenu.add('<b class="menu-title">'+OpenLayers.i18n("onSelection")+"</b>",mefExportAction,csvExportAction,printAction);
this.createMassiveActionMenu(!this.catalogue.isIdentified());
this.createAdminMenu(!this.catalogue.isIdentified());
this.actionOnSelectionMenu=new Ext.Button({text:OpenLayers.i18n("otherActions"),menu:this.actionMenu,id:"other-actions-mdrv"});
if(catalogue.identifiedUser==null){this.actionOnSelectionMenu.hide()
}return this.actionOnSelectionMenu
},createSelectionToolBar:function(){var selectAllInPageAction=new Ext.Action({text:OpenLayers.i18n("allInPage"),handler:function(){this.catalogue.metadataSelectNone();
this.metadataResultsView.selectAllInPage()
},scope:this});
var selectAllAction=new Ext.Action({text:OpenLayers.i18n("all"),handler:function(){this.catalogue.metadataSelectAll();
this.metadataResultsView.selectAll()
},scope:this});
var selectNoneAction=new Ext.Action({text:OpenLayers.i18n("none"),handler:function(){this.catalogue.metadataSelectNone();
this.metadataResultsView.selectNone()
},scope:this});
this.catalogue.on("selectionchange",this.updateSelectionInfo,this);
if(this.mdSelectionAsMenu){return[{hidden:catalogue.identifiedUser==null,id:"md-selection-info",text:OpenLayers.i18n("noneSelected"),menu:{xtype:"menu",items:['<b class="menu-title">'+OpenLayers.i18n("select")+"</b>",selectAllAction,selectAllInPageAction,selectNoneAction]}}]
}else{return[{hidden:catalogue.identifiedUser==null,id:"md-selection-info",xtype:"tbtext",text:OpenLayers.i18n("noneSelected")},"|",{xtype:"tbtext",text:OpenLayers.i18n("select")},selectAllInPageAction,{xtype:"tbtext",text:", "},selectAllAction,{xtype:"tbtext",text:", "},selectNoneAction]
}},updateSelectionInfo:function(catalogue,nb){if(!this.mdSelectionInfoCmp){this.mdSelectionInfoCmp=Ext.getCmp(this.mdSelectionInfo)
}Ext.each(this.selectionActions,function(e){if(nb===0){e.disable()
}else{e.enable()
}});
this.mdSelectionInfoCmp&&this.mdSelectionInfoCmp.setText(nb+" "+OpenLayers.i18n("selected"))
},updatePrivileges:function(catalogue,user){var actions=[this.deleteAction,this.ownerAction,this.updateCategoriesAction,this.updatePrivilegesAction,this.createMetadataAction,this.mdImportAction,this.mdImportAction,this.adminAction,this.otherItem];
Ext.each(actions,function(){this.setVisible(user)
})
},onDestroy:function(){GeoNetwork.MetadataResultsToolbar.superclass.onDestroy.apply(this,arguments)
}});
Ext.reg("gn_metadataresultstoolbar",GeoNetwork.MetadataResultsToolbar);
Ext.namespace("GeoNetwork");
GeoNetwork.TagCloudView=Ext.extend(Ext.DataView,{catalogue:undefined,multiSelect:true,root:"keywords.keyword",qurey:undefined,searchField:"themekey",onSuccess:null,onFailure:null,overClass:"tag-cloud-hover",itemSelector:"li.tag-cloud",emptyText:"",autoWidth:true,initComponent:function(){GeoNetwork.TagCloudView.superclass.initComponent.call(this);
this.tpl=this.tpl||new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="tag-cloud tag-cloud-{class}">',"<a href=\"#\" onClick=\"javascript:Ext.getCmp('E_trueany').setValue('{value}');Ext.getCmp('fullTextField').setValue('{value}');app.searchApp.firstSearch=true;Ext.getCmp('advanced-search-options-content-form').fireEvent('search');showSearch();\" alt=\"{value}\" title=\"{count} records\">{value}({count})</a>","</li>","</tpl>","</ul>");
this.store=this.catalogue.summaryStore;
if(this.query){this.catalogue.kvpSearch(this.query,null,null,null,true)
}}});
Ext.reg("gn_tagcloudview",GeoNetwork.TagCloudView);
Ext.namespace("GeoNetwork");
GeoNetwork.Templates=Ext.extend(Ext.XTemplate,{compiled:false,disableFormats:false,catalogue:null,sortOrder:0,abstractMaxSize:50,xmlTplMarkup:['<?xml version="1.0" encoding="UTF-8"?>','<node id="{id}" type="{type}">',"<site>","<name>{site_name}</name>",'<tpl if="values.site_ogctype">',"<ogctype>{site_ogctype}</ogctype>","</tpl>",'<tpl if="values.site_url">',"<url>{site_url}</url>","</tpl>",'<tpl if="values.site_icon">',"<icon>{site_icon}</icon>","</tpl>",'<tpl if="values.site_account_use">',"<account>","<use>{site_account_use}</use>","<username>{site_account_username}</username>","<password>{site_account_password}</password>","</account>","</tpl>","</site>","<options>",'<tpl if="values.options_every">',"<every>{options_every}</every>","</tpl>",'<tpl if="values.options_onerunonly">',"<oneRunOnly>{options_onerunonly}</oneRunOnly>","</tpl>",'<tpl if="values.options_lang">',"<lang>{options_lang}</lang>","</tpl>",'<tpl if="values.options_topic">',"<topic>{options_topic}</topic>","</tpl>",'<tpl if="values.options_createthumbnails">',"<createThumbnails>{options_createthumbnails}</createThumbnails>","</tpl>",'<tpl if="values.options_uselayer">',"<useLayer>{options_uselayer}</useLayer>","</tpl>",'<tpl if="values.options_uselayermd">',"<useLayerMd>{options_uselayermd}</useLayerMd>","</tpl>",'<tpl if="values.options_datasetcategory">',"<datasetcategory>{options_datasetcategory}</datasetcategory>","</tpl>","</options>","<content>","</content>","<privileges>","</privileges>",'<group id="1">','<operation name="view" />','<operation name="dynamic" />',"</group>","<categories>","</categories>",'<tpl if="values.info_result_total">',"</tpl>","</node>"],initComponent:function(){GeoNetwork.Templates.superclass.initComponent.call(this)
},getHarvesterTemplate:function(){return new Ext.XTemplate(this.xmlTplMarkup)
}});
GeoNetwork.Templates.TITLE='<h1><input type="checkbox" <tpl if="selected==\'true\'">checked="true"</tpl> class="selector" onclick="javascript:catalogue.metadataSelect((this.checked?\'add\':\'remove\'), [\'{uuid}\']);"/><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');return false;">{title}</a><span class="md-action-menu"> - <a rel="mdMenu">'+OpenLayers.i18n("mdMenu")+"</a></span></h1>";
GeoNetwork.Templates.RATING_TPL='<tpl if="isharvested==\'n\' || harvestertype==\'geonetwork\'"><div class="rating"><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'1\'">checked="true"</tpl> value="1"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'2\'">checked="true"</tpl> value="2"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'3\'">checked="true"</tpl> value="3"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'4\'">checked="true"</tpl> value="4"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'5\'">checked="true"</tpl> value="5"/></div></tpl>';
GeoNetwork.Templates.LOGO='<div class="md-logo"><img src="{[catalogue.URL]}/images/harvesting/{groupName}.png"/></div>';
GeoNetwork.Templates.SIMPLE=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-simple" title="{abstract}" style="{featurecolorCSS}">','<table><tr><td style="width:30px;">',GeoNetwork.Templates.LOGO,'</td><td id="{uuid}">',GeoNetwork.Templates.TITLE,'<tpl if="subject">','<span class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></span>","</tpl>","</td></tr></table>","</li>","</tpl>","</ul>");
GeoNetwork.Templates.THUMBNAIL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-thumbnail" style="{featurecolorCSS}">','<div class="md-wrap" id="{uuid}" title="{abstract}">',GeoNetwork.Templates.TITLE,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="javascript:catalogue.metadataShow(\'{uuid}\');"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>","</div>","</li>","</tpl>","</ul>");
GeoNetwork.Templates.FULL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-full" style="{featurecolorCSS}">',"<table><tr>",'<td class="left">',GeoNetwork.Templates.LOGO,"</td>",'<td id="{uuid}">',GeoNetwork.Templates.TITLE,'<p class="abstract">{[values.abstract.substring(0, 350)]} ...</p>','<tpl if="subject">','<p class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></p>","</tpl>",'<div class="md-links" id="md-links-{id}">',"</div>",'</td><td class="thumb">',GeoNetwork.Templates.RATING_TPL,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="javascript:catalogue.metadataShow(\'{uuid}\');"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'</td><td class="icon">',"<tpl if=\"valid != '-1'\">",'<span class="badge badge-',"<tpl if=\"valid == '1'\">success</tpl>","<tpl if=\"valid == '0'\">error</tpl>",'" title="'+OpenLayers.i18n("validityInfo"),'<tpl for="valid_details">',"{values.type}: ","<tpl if=\"values.valid == '1'\">"+OpenLayers.i18n("valid")+"</tpl>","<tpl if=\"values.valid == '0'\">"+OpenLayers.i18n("notValid")+"</tpl>","<tpl if=\"values.valid == '-1'\">"+OpenLayers.i18n("notDetermined")+"</tpl>","<tpl if=\"values.ratio != ''\"> ({values.ratio}) </tpl> - ","</tpl>",'">&nbsp;</span>',"</tpl>",'</td><td class="icon" title="'+OpenLayers.i18n("metadataCategories")+'">','<tpl for="category">','<div class="md-mn cat-{value}" title="{value}">&nbsp;</div>',"</tpl>","</td></tr></table>",'<div class="relation" title="'+OpenLayers.i18n("relateddatasets")+'"><span></span><ul id="md-relation-{id}"></ul></div>','<div class="md-contact">','<tpl for="contact">',"<tpl if=\"applies=='resource'\">",'<span title="{role} - {applies}"><tpl if="values.logo !== undefined && values.logo !== \'\'">','<img src="{logo}" class="orgLogo"/>',"</tpl>","{name}&nbsp;&nbsp;</span>","</tpl>","</tpl>","<tpl if=\"edit=='true' && isharvested!='y'\">",'<br/><span class="md-mn md-mn-user" title="'+OpenLayers.i18n("ownerName")+'">{ownername} - '+OpenLayers.i18n("lastUpdate")+"{[values.changedate.split('T')[0]]}</span>","</tpl>","</div>","</li>","</tpl>","</ul>",{hasDownloadLinks:function(values){var i;
for(i=0;
i<values.length;
i++){if(values[i].type==="application/x-compressed"){return true
}}return false
}});
GeoNetwork.Templates.Relation={SHORT:['<li class="{type}">','<a href="javascript:void(app.searchApp.addMetadata(\'{uuid}\',true));" title="{abstract}">{title}</a><span class="badge relation-type">{subType}</span>',"</li>"]};
Ext.namespace("GeoNetwork");
GeoNetwork.CategoryView=Ext.extend(Ext.DataView,{catalogue:undefined,url:"xml.info?type=categories",imgUrl:"",searchField:"category",onSuccess:null,onFailure:null,emptyText:"",autoWidth:true,initComponent:function(){GeoNetwork.CategoryView.superclass.initComponent.call(this);
this.tpl=this.tpl||new Ext.XTemplate('<tpl for="."><div class="category-view-item">',"<a href=\"javascript:void(catalogue.kvpSearch('fast="+this.catalogue.metadataStore.fast+"&summaryOnly=0&from=1&to=20&hitsPerPage=20&"+this.searchField+"={name}', "+this.onSuccess+","+this.onFailure+', null));" alt="{name}">',this.imgUrl?'<img src="'+this.imgUrl+'{name}.png" border="0" />':"","{[values.label."+OpenLayers.Lang.getCode()+"]}</a></div></tpl>");
this.store=GeoNetwork.data.CategoryStore(this.url);
this.store.load()
}});
Ext.reg("gn_categoryview",GeoNetwork.CategoryView);
Ext.namespace("GeoNetwork");
GeoNetwork.SearchFormPanel=Ext.extend(Ext.FormPanel,{searchTriggered:false,defaultConfig:{border:false,stateful:true,searchCb:undefined,searchBt:new Ext.Button({text:OpenLayers.i18n("search"),iconCls:"md-mn-find",iconAlign:"right"}),resetCb:function(){this.getForm().reset();
if(Ext.get("E_any")){Ext.get("E_any").dom.value=""
}if(Ext.get("o_dynamic")){Ext.getCmp("o_dynamic").el.dom.checked=false
}if(Ext.get("o_download")){Ext.getCmp("o_download").el.dom.checked=false
}if(Ext.get("o_nodynamicdownload")){Ext.getCmp("o_nodynamicdownload").el.dom.checked=false
}},resetBt:new Ext.Button({tooltip:OpenLayers.i18n("resetSearchForm"),iconCls:"md-mn-reset",id:"button-reset-search"}),buttonAlign:"left"},getSearchBt:function(){return this.searchBt
},stateEvents:["onsearch","onreset"],applyState:function(state){this.on("afterrender",function(){this.doLayout(false,true);
GeoNetwork.util.SearchTools.populateFormFromParams(this,state,true)
},this)
},getState:function(){var state={};
if(this.searchTriggered){state.search=""
}var parameters=GeoNetwork.util.SearchTools.getFormValues(this);
Ext.apply(state,parameters);
return state
},search:function(){this.searchTriggered=true;
this.searchCb();
this.fireEvent("onsearch")
},reset:function(){this.searchTriggered=false;
this.resetCb();
this.fireEvent("onreset")
},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
GeoNetwork.SearchFormPanel.superclass.initComponent.call(this);
if(Ext.isIE){this.addButton({id:"advSearchBtnBlank",text:"&nbsp;"},null,this)
}if(this.resetBt){this.addButton(this.resetBt,this.reset,this)
}if(this.searchBt){this.addButton(this.searchBt,this.search,this)
}this.addEvents("search","reset");
this.on({search:this.search,scope:this});
this.on({reset:this.reset,scope:this})
}});
Ext.reg("gn_searchformpanel",GeoNetwork.SearchFormPanel);
Ext.namespace("GeoNetwork.view");
GeoNetwork.view.ViewWindow=Ext.extend(Ext.Window,{defaultConfig:{layout:"fit",width:700,height:740,border:false,lang:"eng",closeAction:"destroy",currTab:"simple",displayTooltip:true,printDefaultForTabs:false,printMode:undefined,printUrl:"print.html",relationTypes:"service|children|related|parent|dataset|fcat",maximizable:true,maximized:false,collapsible:true,collapsed:false,permalink:true},serviceUrl:undefined,catalogue:undefined,metadataUuid:undefined,record:undefined,resultsView:undefined,actionMenu:undefined,tipTpl:undefined,panel:undefined,metadataSchema:undefined,cache:{},tooltips:[],relatedTpl:undefined,getPanel:function(){return this.panel
},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.tools=[{id:"newwindow",qtip:OpenLayers.i18n("newWindow"),handler:function(e,toolEl,panel,tc){window.open(GeoNetwork.Util.getBaseUrl(location.href)+"?uuid="+this.metadataUuid);
this.hide()
},scope:this}];
GeoNetwork.view.ViewWindow.superclass.initComponent.call(this);
this.setTitle(this.record?this.record.get("title"):"");
this.panel=new GeoNetwork.view.ViewPanel({serviceUrl:this.serviceUrl,lang:this.lang,currTab:GeoNetwork.defaultViewMode||"simple",printDefaultForTabs:GeoNetwork.printDefaultForTabs||false,printUrl:this.printUrl,catalogue:this.catalogue,metadataUuid:this.metadataUuid,record:this.record,resultsView:this.resultsView,border:false,frame:false,autoScroll:true,permalink:this.permalink});
this.add(this.panel);
this.on("beforeshow",function(el){el.setSize(el.getWidth()>Ext.getBody().getWidth()?Ext.getBody().getWidth():el.getWidth(),el.getHeight()>Ext.getBody().getHeight()?Ext.getBody().getHeight():el.getHeight())
})
}});
Ext.reg("gn_view_viewwindow",GeoNetwork.view.ViewWindow);
Ext.namespace("GeoNetwork.view");
GeoNetwork.view.ViewPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,lang:"en",autoScroll:true,currTab:"simple",displayTooltip:true,printDefaultForTabs:false,printMode:undefined,printUrl:"print.html",permalink:false,relationTypes:encodeURIComponent("service|children|related|parent|dataset")},serviceUrl:undefined,catalogue:undefined,metadataUuid:undefined,record:undefined,resultsView:undefined,actionMenu:undefined,permalinkMenu:undefined,tipTpl:undefined,metadataSchema:undefined,cache:{},tooltips:[],getLinkedData:function(){var store=new GeoNetwork.data.MetadataRelationStore(this.catalogue.services.mdRelation+"?type="+this.relationTypes+"&fast=false&uuid="+escape(this.metadataUuid),null,true),view=this;
store.on("load",function(){this.each(view.displayLinkedData,view)
});
store.load()
},displayLinkedData:function(record){var table=Ext.query("table.related",this.body.dom),type=record.get("type");
if(table==null||table.length<0){return
}var el=Ext.get(table[0]);
if(!el){return
}var exist=el.child("tr td[class*=__"+type+"]");
var link=this.relatedTpl.apply(record.data);
if(exist!==null){exist.parent().next().child("td").child("li").insertHtml("afterEnd",link)
}else{el.child("tr").insertHtml("beforeBegin",'<tr><td class="main title __'+type+'"><span>'+OpenLayers.i18n("related"+type)+"</span></td></tr><tr><td><ul>"+link+"</ul></td></tr>")
}},extractorWindow:null,extractorPanel:null,showExtractor:function(url,layer,version,type){var options=GeoNetwork.map.MAP_OPTIONS;
var map=new OpenLayers.Map(options);
map.addLayers(GeoNetwork.map.BACKGROUND_LAYERS);
this.extractorPanel=new GeoNetwork.WxSExtractor({url:url,version:version||"1.1.0",layer:layer,map:map,type:type||"WFS",split:true,region:"center",id:"wxsExtractor"});
this.extractorWindow=new Ext.Window({title:OpenLayers.i18n("extractorTitle")+url,width:600,height:350,plain:true,layout:"border",modal:true,items:[this.extractorPanel,new GeoExt.MapPanel({border:false,map:map,region:"west",split:true,width:200})],closeAction:"destroy",constrain:true,iconCls:"WFSDownloadIcon",listeners:{afterrender:function(f){Ext.getCmp("wxsExtractor").updateExtent()
}}});
this.extractorWindow.setTitle(OpenLayers.i18n("extractorTitle")+url);
this.extractorWindow.show()
},createExtractor:function(){var rows=Ext.query("table.related tr",this.body.dom);
var panel=this;
Ext.each(rows,function(item){var cols=Ext.get(item).select("td");
var label=cols.item(0).child("span");
if(label!==null&&label.dom.innerHTML.indexOf("WFS")!==-1){var layers=Ext.query("li",cols.item(0).parent().next().dom);
Ext.each(layers,function(layer){var el=Ext.get(layer);
var url=el.child("a").getAttribute("href");
layer=el.child("a").dom.innerHTML;
el.insertHtml("beforeEnd",'<span id="wfs-download-'+layer+'">');
var downloadBt=new Ext.Button({text:OpenLayers.i18n("dataDownload"),iconCls:"WFSDownloadIcon",renderTo:"wfs-download-"+layer,handler:function(){panel.showExtractor(url,layer)
}})
})
}else{if(label!==null&&label.dom.innerHTML.indexOf("WCS")!==-1){var layers=Ext.query("li",cols.item(0).parent().next().dom);
Ext.each(layers,function(layer){var el=Ext.get(layer);
var url=el.child("a").getAttribute("href");
layer=el.child("a").dom.innerHTML;
el.insertHtml("beforeEnd",'<span id="wcs-download-'+layer+'">');
var downloadBt=new Ext.Button({text:OpenLayers.i18n("dataDownload"),iconCls:"WCSDownloadIcon",renderTo:"wcs-download-"+layer,handler:function(){panel.showExtractor(url,layer,"1.1.1","WCS")
}})
})
}}})
},createActionMenu:function(){if(!this.actionMenu){this.actionMenu=new GeoNetwork.MetadataMenu({catalogue:this.catalogue,record:this.record,resultsView:this.resultsView})
}var actionButton={text:OpenLayers.i18n("mdMenu"),menu:this.actionMenu};
return actionButton
},createViewMenu:function(modes){var items=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];
this.viewMenu=new Ext.menu.Menu({items:items});
var viewButton={text:OpenLayers.i18n("viewMode"),iconCls:"viewModeIcon",menu:this.viewMenu};
return viewButton
},updateViewMenu:function(){var modes=Ext.query("span.mode",this.body.dom),menu=[],i,j,e,cmpId=this.getId(),isSimpleModeActive=true;
menu.push([OpenLayers.i18n("simpleViewMode"),"view-simple",isSimpleModeActive]);
this.printMode=this.currTab;
for(i=0;
i<modes.length;
i++){if(modes[i].firstChild){var id=modes[i].getAttribute("id");
var label=modes[i].innerHTML;
var next=Ext.get(modes[i]).next();
var tabs=next.query("LI");
var current=next.query("LI[id="+this.currTab+"]");
var activeMode=current.length===1;
if(!activeMode){Ext.get(modes[i]).parent().remove()
}else{if(next&&tabs.length===1){next.remove()
}else{for(j=0;
j<tabs.length;
j++){e=Ext.get(tabs[j]);
if(this.printDefaultForTabs){this.printMode="default"
}e.on("click",function(){Ext.getCmp(cmpId).switchToTab(this.getAttribute("id"))
})
}}}menu.push([label,id,activeMode]);
if(activeMode===true){isSimpleModeActive=false
}}}menu[0][2]=isSimpleModeActive;
this.updateToolbar(menu)
},updateToolbar:function(modes){var i,m;
this.viewMenu.removeAll();
for(i=0;
i<modes.length;
i++){m=modes[i];
this.viewMenu.add({text:m[0],checked:false,disabled:m[2],group:"mode",value:m[1],listeners:{checkchange:this.onViewCheck,scope:this}})
}this.viewMenu.doLayout()
},switchToTab:function(tab){this.currTab=tab;
this.onViewCheck({value:this.currTab},true)
},onViewCheck:function(item,checked){if(checked){this.removeAll();
this.currTab=item.value;
this.load({url:this.serviceUrl+"&currTab="+this.currTab,callback:function(){this.fireEvent("aftermetadataload",this)
},scope:this})
}},afterMetadataLoad:function(){this.cache={};
this.tooltips=[];
this.updateViewMenu();
this.catalogue.extentMap.initMapDiv();
if(this.currTab==="view-simple"||this.currTab==="inspire"||this.currTab==="simple"){this.createExtractor();
this.getLinkedData()
}this.registerTooltip();
this.fireEvent("afterrender",this);
this.compressRelated()
},showMore:function(id){var u=Ext.get(id);
var function_='var view = Ext.getCmp("'+this.id+'"); view.showLess("'+u.id+'");';
var c=u.dom.childNodes[u.dom.childNodes.length-1];
Ext.DomHelper.insertAfter(c,"<li><a href='javascript:"+function_+"'>"+OpenLayers.i18n("facetLess")+"</a></li>");
for(var i=0;
i<u.dom.childNodes.length;
i++){show(Ext.get(u.dom.childNodes[i]))
}u.dom.removeChild(u.dom.childNodes[9])
},showLess:function(id){var u=Ext.get(id);
var function_='var view = Ext.getCmp("'+this.id+'"); view.showMore("'+u.id+'");';
var c=u.dom.childNodes[9];
Ext.DomHelper.insertBefore(c,"<li><a href='javascript:"+function_+"'>"+OpenLayers.i18n("facetMore")+"</a></li>");
for(var i=10;
i<u.dom.childNodes.length;
i++){hide(Ext.get(u.dom.childNodes[i]))
}u.dom.removeChild(u.dom.childNodes[u.dom.childNodes.length-1])
},compressRelated:function(){var related=Ext.query("table.related");
var uls=Ext.query("ul",related);
var id=this.id;
Ext.each(uls,function(ul){if(ul.childNodes.length>10){var u=Ext.get(ul);
var function_='var view = Ext.getCmp("'+id+'"); view.showMore("'+u.id+'");';
var c=ul.childNodes[9];
Ext.DomHelper.insertBefore(c,"<li><a href='javascript:"+function_+"'>"+OpenLayers.i18n("facetMore")+"</a></li>");
for(var i=10;
i<ul.childNodes.length;
i++){hide(Ext.get(ul.childNodes[i]))
}}})
},createPrintMenu:function(){return new Ext.Button({iconCls:"print",tooltip:OpenLayers.i18n("printTT"),listeners:{click:function(c,pressed){window.open(this.printUrl+"?uuid="+this.metadataUuid+"&currTab="+this.printMode+"&hl="+this.lang)
},scope:this}})
},createTooltipMenu:function(){return new Ext.Button({enableToggle:true,pressed:this.displayTooltip,iconCls:"book",tooltip:OpenLayers.i18n("enableTooltip"),listeners:{toggle:function(c,pressed){this.displayTooltip=pressed;
this.enableTooltip()
},scope:this}})
},enableTooltip:function(){Ext.each(this.tooltips,function(item,idx){if(this.displayTooltip){item.enable()
}else{item.disable()
}},this)
},registerTooltip:function(){var formElements=Ext.query("th[id]",this.body.dom);
formElements=formElements.concat(Ext.query("legend[id]",this.body.dom));
Ext.each(formElements,function(item,index,allItems){var e=Ext.get(item);
var id=e.getAttribute("id");
if(e.is("TH")){var section=e.up("FIELDSET");
var f=function(){if(this.displayTooltip){this.loadHelp(id,section)
}};
e.parent().on("mouseover",f,this)
}else{var f=function(){if(this.displayTooltip){this.loadHelp(id)
}};
e.on("mouseover",f,this)
}},this)
},loadHelp:function(id,sectionId){if(!this.cache[id]){var panel=this;
GeoNetwork.util.HelpTools.get(id,this.metadataSchema,this.catalogue.services.schemaInfo,function(r){panel.cache[id]=panel.tipTpl.apply(r.records[0].data);
var t=new Ext.ToolTip({target:id,title:r.records[0].get("label"),anchor:sectionId?"top":"bottom",anchorOffset:35,html:panel.cache[id]});
panel.tooltips.push(t)
})
}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.tipTpl=new Ext.XTemplate(GeoNetwork.util.HelpTools.Templates.SIMPLE);
this.relatedTpl=new Ext.XTemplate(this.relatedTpl||GeoNetwork.Ngr.Templates.Relation.SHORT);
this.tbar=[this.createViewMenu(),this.createActionMenu(),"->",this.createPrintMenu(),this.createTooltipMenu()];
GeoNetwork.view.ViewPanel.superclass.initComponent.call(this);
this.metadataSchema=this.record?this.record.get("schema"):"";
this.add(new Ext.Panel({autoLoad:{url:this.serviceUrl+"&currTab="+this.currTab,callback:function(){this.fireEvent("aftermetadataload",this)
},scope:this},border:false,frame:false,autoScroll:true}));
if(this.permalink){var l=GeoNetwork.Util.getBaseUrl(location.href)+"?uuid="+this.metadataUuid;
this.getTopToolbar().add(GeoNetwork.Util.buildPermalinkMenu(l))
}this.addEvents("aftermetadataload");
this.on({aftermetadataload:this.afterMetadataLoad,scope:this})
}});
Ext.reg("gn_view_viewpanel",GeoNetwork.view.ViewPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.SubTemplateSelectionPanel=Ext.extend(Ext.FormPanel,{border:false,catalogue:undefined,namespaces:{xlink:"http://www.w3.org/1999/xlink",gmd:"http://www.isotc211.org/2005/gmd",gmx:"http://www.isotc211.org/2005/gmx",gco:"http://www.isotc211.org/2005/gco",gts:"http://www.isotc211.org/2005/gts",gml:"http://www.opengis.net/gml"},id:"subTemplateSearchForm",contact:Ext.data.Record.create([{name:"xlink"},{name:"name"}]),subTemplateStore:undefined,codeListStore:undefined,subTplTypeField:undefined,addAsXLink:false,itemSelector:null,loadingMask:null,subTemplateCount:null,ref:null,name:null,elementName:null,codeListConfig:{"gmd:CI_ResponsibleParty":{xpath:"gmd:role/gmd:CI_RoleCode/@codeListValue",url:"",label:OpenLayers.i18n("contactRole"),code:"gmd:CI_RoleCode"}},codeListCombo:null,role:"",defaultRole:"pointOfContact",SubTemplateSelected:[],initComponent:function(){this.subTemplateStore=new GeoNetwork.data.MetadataResultsStore();
this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,items:[this.getSearchField(),this.getSubTemplateItemSelector()]}];
this.subTemplateStore.on({loadexception:function(){},beforeload:function(store,options){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show()
},load:function(){this.loadingMask.hide()
},scope:this});
this.addEvents("subTemplateSelected");
this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(c,checked){this.addAsXLink=checked
},scope:this}},this.getCodeListCombo()," ",{id:"SubTemplateSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildSubTemplateXmlList()
},scope:this}];
GeoNetwork.editor.SubTemplateSelectionPanel.superclass.initComponent.call(this)
},getSearchField:function(){this.subTplTypeField=new Ext.form.TextField({name:"E__root",hidden:true,value:""});
return[new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(scope){scope.doSearch()
},scope:this}),this.subTplTypeField,{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"}]
},setRef:function(ref){this.ref=ref
},setName:function(name){this.name=name
},setElementName:function(name){this.elementName=name;
this.subTplTypeField.setValue(name);
if(this.codeListConfig[name]){this.codeListCombo.setVisible(true)
}else{this.codeListCombo.setVisible(false)
}},setAddAsXLink:function(xlink){this.addAsXLink=xlink||false;
Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink)
},getCodeListCombo:function(){this.codeListStore=GeoNetwork.data.CodeListStore({url:this.catalogue.services.schemaInfo,codeListName:"gmd:CI_RoleCode"});
this.codeListCombo=new Ext.form.ComboBox({id:"codeList",store:this.codeListStore,triggerAction:"all",mode:"local",fieldLabel:"",displayField:"label",valueField:"code"});
this.codeListStore.on({load:function(){Ext.getCmp("codeList").setValue(this.defaultRole)
},scope:this});
return this.codeListCombo
},getSubTemplateItemSelector:function(){var tpl='<tpl for="."><div class="ux-mselect-item';
if(Ext.isIE||Ext.isIE7){tpl+='" unselectable=on'
}else{tpl+=' x-unselectable"'
}tpl+=">{title}</div></tpl>";
this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["uuid","title"],toData:[],msWidth:320,msHeight:230,valueField:"uuid",fromTpl:tpl,toTpl:tpl,toLegend:OpenLayers.i18n("selected"),fromLegend:OpenLayers.i18n("found"),fromStore:this.subTemplateStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../js/ext-ux/images",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var i=this.getForm().findField("itemselector");
i.reset.call(i)
},scope:this}]});
this.itemSelector.on({change:function(component){Ext.getCmp("SubTemplateSearchValidateButton").setDisabled(component.toStore.getCount()<1)
}});
return this.itemSelector
},buildSubTemplateXmlList:function(){if(!this.elementName){alert("Error: sub template root element name is not defined!");
return
}var processParameter="";
var processParameterSeparator="~";
var store=this.itemSelector.toMultiselect.store;
this.SubTemplateSelected=[];
this.codeListValue="";
this.subTemplateCount=0;
if(this.codeListConfig[this.elementName]&&this.codeListConfig[this.elementName].xpath){processParameter="&process="+this.codeListConfig[this.elementName].xpath+processParameterSeparator+Ext.getCmp("codeList").getValue()
}var self=this;
xlinkCollection=store.collect("uuid");
Ext.each(xlinkCollection,function(uuid,index,xlinks){var inputValue=self.catalogue.services.subTemplate+"?uuid="+uuid+processParameter;
++self.subTemplateCount;
if(self.addAsXLink){var tpl="<"+self.name+self.generateNamespaceDeclaration()+" xlink:href='"+inputValue+"'/>";
self.SubTemplateSelected.push(tpl)
}else{self.retrieveSubTemplate(inputValue)
}});
if(this.addAsXLink){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);
this.ownerCt.hide()
}store.clearFilter()
},retrieveSubTemplate:function(url){Ext.getCmp("SubTemplateSearchValidateButton").disable();
Ext.Ajax.request({url:url,method:"GET",scope:this,success:function(response){var st=response.responseText;
if(st.indexOf(this.elementName)!==-1){this.SubTemplateSelected.push("<"+this.name+this.generateNamespaceDeclaration()+">"+response.responseText+"</"+this.name+">")
}Ext.getCmp("SubTemplateSearchValidateButton").enable();
this.subTemplateCount-=1;
if(this.subTemplateCount===0){this.fireEvent("subTemplateSelected",this,this.SubTemplateSelected);
this.ownerCt.hide()
}}})
},generateNamespaceDeclaration:function(onlyThoseNamespaces){var ns="";
for(var n in this.namespaces){if((onlyThoseNamespaces&&onlyThoseNamespaces[n])||!onlyThoseNamespaces){ns+=" xmlns:"+n+'="'+this.namespaces[n]+'"'
}}return ns
},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show();
GeoNetwork.util.SearchTools.doQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,false,this.subTemplateStore)
},showResults:function(response){var getRecordsFormat=new OpenLayers.Format.GeoNetworkRecords();
var r=getRecordsFormat.read(response.responseText);
var values=r.records;
if(values.length>0){this.subTemplateStore.loadData(r)
}}});
Ext.reg("gn_editor_subtemplateselectionpanel",GeoNetwork.editor.SubTemplateSelectionPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.CRSSelectionPanel=Ext.extend(Ext.FormPanel,{CRS:Ext.data.Record.create([{name:"authority"},{name:"code"},{name:"version"},{name:"codeSpace"},{name:"description"}]),crsStore:undefined,catalogue:undefined,border:false,first:null,itemSelector:null,loadingMask:null,crsCount:null,ref:null,crsSelected:"",initComponent:function(){this.crsStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchCRS,method:"GET"}),baseParams:{name:"",type:"",maxResults:50},reader:new Ext.data.XmlReader({record:"crs",id:"code"},this.CRS),fields:["code","codeSpace","authority","description","version"],sortInfo:{field:"description"}});
this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:{enableOverflow:true,items:[this.getCRSTypeCombo()," ",this.getCRS(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()]},items:[this.getCRSItemSelector()]}];
this.crsStore.on({loadexception:function(){},beforeload:function(store,options){if(Ext.getCmp("maxResults")){store.baseParams.maxResults=Ext.getCmp("maxResults").getValue()
}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show()
},load:function(){this.loadingMask.hide()
},scope:this});
this.addEvents("crsSelected");
this.bbar=["->",{id:"crsSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildCRSXmlList()
},scope:this}];
GeoNetwork.editor.CRSSelectionPanel.superclass.initComponent.call(this)
},getCRS:function(){return new GeoNetwork.form.SearchField({id:"crsSearchField",width:240,store:this.crsStore,paramName:"name"})
},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40}
},getCRSTypeCombo:function(){var CRSType=Ext.data.Record.create([{name:"id"}]);
var crsTypeStore=new Ext.data.Store({url:this.catalogue.services.getCRSTypes,reader:new Ext.data.XmlReader({record:"type"},CRSType),fields:["id"]});
var record=new CRSType({filename:OpenLayers.i18n("any")});
record.set("id","");
crsTypeStore.add(record);
crsTypeStore.load({add:true});
return{xtype:"combo",width:150,id:"search-crs",value:0,store:crsTypeStore,triggerAction:"all",mode:"local",displayField:"id",valueField:"id",listWidth:250,listeners:{select:function(combo,record,index){this.crsStore.removeAll();
this.crsStore.baseParams.type=combo.getValue();
var value=Ext.getCmp("crsSearchField").getValue();
if(value.length<1){this.crsStore.baseParams.name=""
}else{this.crsStore.baseParams.name=value
}this.crsStore.reload()
},clear:function(combo){this.crsStore.load()
},scope:this}}
},getCRSItemSelector:function(){var tpl='<tpl for="."><div class="ux-mselect-item';
if(Ext.isIE||Ext.isIE7){tpl+='" unselectable=on'
}else{tpl+=' x-unselectable"'
}tpl+=">{description}</div></tpl>";
this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["code","codeSpace","authority","description","version"],toData:[],msWidth:320,msHeight:230,valueField:"code",fromTpl:tpl,toTpl:tpl,toLegend:OpenLayers.i18n("selectedCRS"),fromLegend:OpenLayers.i18n("foundCRS"),fromStore:this.crsStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../../apps/js/ext-ux/images",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var i=this.getForm().findField("itemselector");
i.reset.call(i)
},scope:this}]});
this.itemSelector.on({change:function(component){Ext.getCmp("crsSearchValidateButton").setDisabled(component.toStore.getCount()<1)
}});
return this.itemSelector
},setRef:function(ref){this.ref=ref
},buildCRSXmlList:function(){this.crsSelected="";
var store=this.itemSelector.toMultiselect.store;
this.first=true;
store.each(function(record){var tpl="<gmd:referenceSystemInfo xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco'><gmd:MD_ReferenceSystem><gmd:referenceSystemIdentifier><gmd:RS_Identifier><gmd:code><gco:CharacterString>"+record.data.description+"</gco:CharacterString></gmd:code><gmd:codeSpace><gco:CharacterString>"+record.data.codeSpace+"</gco:CharacterString></gmd:codeSpace><gmd:version><gco:CharacterString>"+record.data.version+"</gco:CharacterString></gmd:version></gmd:RS_Identifier></gmd:referenceSystemIdentifier></gmd:MD_ReferenceSystem></gmd:referenceSystemInfo>";
this.crsSelected+=(this.first?"":"&amp;&amp;&amp;")+tpl;
this.first=false
},this);
if(this.crsSelected!==""){this.fireEvent("crsSelected",this.crsSelected);
this.ownerCt.hide()
}}});
Ext.reg("gn_editor_crsselectionpanel",GeoNetwork.editor.CRSSelectionPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.EditorPanel=Ext.extend(Ext.Panel,{border:false,editUrl:undefined,updateUrl:undefined,frame:false,tbarConfig:undefined,id:"editorPanel",defaultConfig:{defaultViewMode:"simple",layout:"border",height:800,xlinkOptions:{},utilityPanelCollapsed:false,utilityPanelConfig:{thumbnailPanel:{collapsed:false},relationPanel:{collapsed:true},validationPanel:{collapsed:true},suggestionPanel:{collapsed:true},helpPanel:{collapsed:false}}},catalogue:undefined,toolbar:undefined,validationPanel:undefined,relationPanel:undefined,helpPanel:undefined,suggestionPanel:undefined,thumbnailPanel:undefined,editorMainPanel:undefined,metadataId:undefined,versionId:undefined,metadataMode:undefined,metadataSchema:undefined,metadataType:undefined,position:undefined,relatedMetadataStore:undefined,keywordSelectionWindow:undefined,contactSelectionWindow:undefined,subTemplateSelectionWindow:undefined,crsSelectionWindow:undefined,logoSelectionWindow:undefined,linkedMetadataSelectionWindow:undefined,geoPublisherWindow:undefined,lang:undefined,fileUploadWindow:undefined,mask:undefined,managerInitialized:false,container:undefined,setContainer:function(el){if(!this.container){this.container=el
}},showLogoSelectionPanel:function(ref){if(!this.logoSelectionWindow){var logoSelectionPanel=new GeoNetwork.editor.LogoSelectionPanel({ref:ref,serviceUrl:this.catalogue.services.getIcons,logoAddUrl:this.catalogue.services.logoAdd,logoUrl:this.catalogue.services.harvesterLogoUrl,listeners:{logoselected:function(panel,idx){var record=panel.store.getAt(idx);
Ext.getDom(panel.ref).value=panel.logoUrl+record.get("name")
}}});
this.logoSelectionWindow=new Ext.Window({title:OpenLayers.i18n("logoSelectionWindow"),width:300,height:300,layout:"fit",modal:true,items:logoSelectionPanel,closeAction:"destroy",constrain:true,iconCls:"attached"})
}this.logoSelectionWindow.items.get(0).setRef(ref);
this.logoSelectionWindow.show();
var removeZeroWidth=function(el){if(Ext.get(el).getWidth()==0){Ext.get(el).setWidth("auto")
}Ext.each(el.children,function(e){removeZeroWidth(e)
})
};
removeZeroWidth(Ext.get(this.linkedMetadataSelectionWindow.id).dom)
},showFileUploadPanel:function(id,ref){var panel=this;
if(this.fileUploadWindow){this.fileUploadWindow.close();
this.fileUploadWindow=undefined
}if(!this.fileUploadWindow){var fileUploadPanel=new Ext.form.FormPanel({fileUpload:true,defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"access",allowBlank:false,hidden:true,value:"private"},{name:"ref",allowBlank:false,hidden:true,value:ref},{name:"proto",hidden:true,value:""},{name:"overwrite",fieldLabel:"Overwrite",checked:true,xtype:"checkbox"},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectFile"),fieldLabel:"File",allowBlank:false,name:"f_"+ref,buttonText:"",buttonCfg:{iconCls:"uploadIconAdd"}}],buttons:[{text:OpenLayers.i18n("upload"),iconCls:"attachedAdd",handler:function(){if(fileUploadPanel.getForm().isValid()){fileUploadPanel.getForm().submit({url:panel.catalogue.services.upload,waitMsg:OpenLayers.i18n("uploading"),success:function(fileUploadPanel,o){var fname=o.result.fname;
var name=Ext.getDom("_"+ref);
if(name){name.value=fname
}panel.save();
panel.fileUploadWindow.hide()
}})
}}},{text:OpenLayers.i18n("reset"),handler:function(){fileUploadPanel.getForm().reset()
}}]});
this.fileUploadWindow=new Ext.Window({title:OpenLayers.i18n("fileUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:fileUploadPanel,closeAction:"hide",constrain:true,iconCls:"attached"})
}this.fileUploadWindow.show()
},showGeoPublisherPanel:function(id,uuid,title,name,accessStatus,nodeName,insertNodeRef,extent){var editorPanel=this;
if(this.geoPublisherWindow){this.geoPublisherWindow.close();
this.geoPublisherWindow=undefined
}if(!this.geoPublisherWindow){var geoPublisherPanel=new GeoNetwork.editor.GeoPublisherPanel({width:650,height:300,layers:GeoNetwork.map.BACKGROUND_LAYERS,extent:extent,serviceUrl:this.catalogue.services.geopublisher,listeners:{addOnLineSource:function(panel,node,protocols){var p;
var xml="";
var layerName=(node.get("id").indexOf("mapserver")===-1?node.get("namespacePrefix")+":":"")+this.layerName;
var id="_X"+insertNodeRef+"_"+nodeName.replace(":","COLON");
var wxsOnlineSource="<gmd:onLine xmlns:gmd=&quot;http://www.isotc211.org/2005/gmd&quot; xmlns:gco=&quot;http://www.isotc211.org/2005/gco&quot;><gmd:CI_OnlineResource><gmd:linkage><gmd:URL>${ogcurl}</gmd:URL></gmd:linkage><gmd:protocol><gco:CharacterString>${protocol}</gco:CharacterString></gmd:protocol><gmd:name><gco:CharacterString>${layerName}</gco:CharacterString></gmd:name><gmd:description><gco:CharacterString>${metadataTitle}</gco:CharacterString></gmd:description></gmd:CI_OnlineResource></gmd:onLine>";
for(p in protocols){if(protocols.hasOwnProperty(p)&&protocols[p].checked===true){xml+=OpenLayers.String.format(wxsOnlineSource,{ogcurl:node.get(p+"Url"),protocol:protocols[p].label,layerName:layerName,metadataTitle:this.metadataTitle+"("+protocols[p].label+")"})+"&&&"
}}GeoNetwork.editor.EditorTools.addHiddenFormField(id,xml);
editorPanel.save();
editorPanel.geoPublisherWindow.hide()
}}});
this.geoPublisherWindow=new Ext.Window({title:OpenLayers.i18n("geoPublisherWindowTitle"),layout:"fit",modal:true,items:geoPublisherPanel,closeAction:"hide",constrain:true,iconCls:"repository"})
}this.geoPublisherWindow.items.get(0).setRef(id,uuid,title,name,accessStatus);
this.geoPublisherWindow.setTitle(OpenLayers.i18n("geoPublisherWindowTitle")+" "+name);
this.geoPublisherWindow.show()
},showSubTemplateSelectionPanel:function(ref,name,elementName){var editorPanel=this;
if(this.subTemplateSelectionWindow){this.subTemplateSelectionWindow.close();
this.subTemplateSelectionWindow=undefined
}if(!this.subTemplateSelectionWindow){var selectionPanel=new GeoNetwork.editor.SubTemplateSelectionPanel({width:620,height:300,catalogue:this.catalogue,listeners:{subTemplateSelected:function(panel,subtemplates){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(panel,subtemplates,editorPanel)
}}});
this.subTemplateSelectionWindow=new Ext.Window({title:OpenLayers.i18n("SelectionWindowTitle"),layout:"fit",items:selectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"})
}this.subTemplateSelectionWindow.items.get(0).setRef(ref);
this.subTemplateSelectionWindow.items.get(0).setName(name);
this.subTemplateSelectionWindow.items.get(0).setElementName(elementName);
this.subTemplateSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.CONTACT);
this.subTemplateSelectionWindow.show()
},showKeywordSelectionPanel:function(ref){var editorPanel=this;
if(this.keywordSelectionWindow){this.keywordSelectionWindow.close();
this.keywordSelectionWindow=undefined
}if(!this.keywordSelectionWindow){this.keywordSelectionPanel=new GeoNetwork.editor.KeywordSelectionPanel({catalogue:this.catalogue,listeners:{keywordselected:function(panel,keywords){GeoNetwork.editor.EditorTools.addHiddenFormFieldForFragment(panel,keywords,editorPanel)
}}});
this.keywordSelectionWindow=new Ext.Window({title:OpenLayers.i18n("keywordSelectionWindowTitle"),width:620,height:300,layout:"fit",modal:true,items:this.keywordSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"})
}this.keywordSelectionWindow.items.get(0).setRef(ref);
this.keywordSelectionWindow.items.get(0).setAddAsXLink(this.xlinkOptions.KEYWORD);
this.keywordSelectionWindow.show();
var h=this.keywordSelectionWindow.getHeight();
this.keywordSelectionWindow.setHeight(h+30)
},showCRSSelectionPanel:function(ref,name){var editorPanel=this;
if(!this.crsSelectionWindow){this.crsSelectionPanel=new GeoNetwork.editor.CRSSelectionPanel({catalogue:this.catalogue,listeners:{crsSelected:function(xml){var id="_X"+ref+"_"+name.replace(":","COLON");
GeoNetwork.editor.EditorTools.addHiddenFormField(id,xml);
editorPanel.save()
}}});
this.crsSelectionWindow=new Ext.Window({title:OpenLayers.i18n("crsSelectionWindowTitle"),layout:"fit",width:620,height:300,modal:true,items:this.crsSelectionPanel,closeAction:"hide",constrain:true,iconCls:"searchIcon"})
}this.crsSelectionWindow.items.get(0).setRef(ref);
this.crsSelectionWindow.show()
},showLinkedMetadataSelectionPanel:function(ref,name,mode){var mode=mode||name;
var single=((mode==="uuidref"||mode==="iso19110"||mode==="")?true:false);
var editorPanel=this;
this.linkedMetadataSelectionPanel=new GeoNetwork.editor.LinkedMetadataSelectionPanel({ref:ref,catalogue:this.catalogue,singleSelect:single,mode:mode,listeners:{linkedmetadataselected:function(panel,metadata){if(single){if(this.ref!==null){Ext.get("_"+this.ref+(name!==""?"_"+name:"")).dom.value=metadata[0].data.uuid
}else{if(this.mode==="iso19110"){var url=panel.catalogue.services.mdRelationInsert+"?parentId="+document.mainForm.id.value+"&childUuid="+metadata[0].data.uuid;
var request=Ext.Ajax.request({url:url,method:"GET",success:function(result,request){var urlProcessing=panel.catalogue.services.mdProcessing+"?uuidref="+metadata[0].data.uuid+"&id="+document.mainForm.id.value+"&process=update-attachFeatureCatalogue";
editorPanel.process(urlProcessing)
},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.String.format(OpenLayers.i18n("errorAndStatusMsg"),{status:result.status,text:result.statusText}));
setBunload(true)
}})
}}}else{var inputs=[];
var multi=metadata.length>1?true:false;
Ext.each(metadata,function(md,index){if(multi){name=name+"_"+index
}inputs.push({tag:"input",type:"hidden",id:name,name:name,value:md.data.uuid})
});
var dh=Ext.DomHelper;
dh.append(Ext.get("hiddenFormElements"),inputs)
}}}});
this.linkedMetadataSelectionWindow=new Ext.Window({title:OpenLayers.i18n("linkedMetadataSelectionWindowTitle"),width:620,height:420,layout:"fit",items:this.linkedMetadataSelectionPanel,closeAction:"destroy",constrain:true,iconCls:"linkIcon",modal:true});
this.linkedMetadataSelectionWindow.show()
},showLinkedServiceMetadataSelectionPanel:function(name,serviceUrl,uuid){var editorPanel=this;
serviceUrl=Ext.getDom("serviceUrl")&&Ext.getDom("serviceUrl").value;
var linkedMetadataSelectionPanel=new GeoNetwork.editor.LinkedMetadataSelectionPanel({mode:name,ref:null,serviceUrl:serviceUrl,catalogue:this.catalogue,uuid:uuid,singleSelect:true,listeners:{linkedmetadataselected:function(panel,metadata){var layerName=Ext.getCmp("getCapabilitiesLayerName").getValue();
if(name==="attachService"){var serviceUpdateUrl=editorPanel.catalogue.services.mdProcessingXml+"?uuid="+metadata[0].data.uuid+"&process=update-srv-attachDataset&uuidref="+document.mainForm.uuid.value+"&scopedName="+layerName;
Ext.Ajax.request({url:serviceUpdateUrl,method:"GET",success:function(result,request){var response=result.responseText;
if(response.indexOf("Not owner")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("NotOwnerError"))
}else{if(response.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+response)
}}var datasetUpdateUrl=editorPanel.catalogue.services.mdProcessing+"?id="+editorPanel.metadataId+"&process=update-onlineSrc&desc="+layerName+"&url="+escape(metadata[0].data.uri)+"&scopedName="+layerName;
Ext.Ajax.request({url:datasetUpdateUrl,method:"GET",success:function(result,request){editorPanel.updateEditor(result)
},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.i18n("datasetUpdateError"));
setBunload(true)
}})
},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));
setBunload(true)
}})
}else{var datasetUpdateUrl=editorPanel.catalogue.services.mdProcessingXml+"?uuid="+metadata[0].data.uuid+"&process=update-onlineSrc&desc="+layerName+"&url="+serviceUrl+"&scopedName="+layerName;
Ext.Ajax.request({url:datasetUpdateUrl,method:"GET",success:function(result,request){var response=result.responseText;
if(response.indexOf("Not owner")!==-1){Ext.MeafterRenderssageBox.alert(OpenLayers.i18n("NotOwnerError"))
}else{if(response.indexOf("error")!==-1){Ext.MessageBox.alert(OpenLayers.i18n("error")+response)
}}editorPanel.process(editorPanel.catalogue.services.mdProcessing+"?uuid="+document.mainForm.uuid.value+"&process=update-srv-attachDataset&uuidref="+metadata[0].data.uuid+"&scopedName="+layerName)
},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.i18n("ServiceUpdateError"));
setBunload(true)
}})
}},scope:this}});
this.linkedMetadataSelectionWindow=new Ext.Window({title:(name==="attachService"?OpenLayers.i18n("associateService"):OpenLayers.i18n("associateDataset")),layout:"fit",width:620,height:420,items:linkedMetadataSelectionPanel,closeAction:"destroy",constrain:true,iconCls:"linkIcon",modal:true});
this.linkedMetadataSelectionWindow.show()
},switchToTab:function(tab){Ext.getDom("currTab").value=tab;
this.save()
},finish:function(){this.loadUrl("metadata.update.finish",undefined,this.closeCallback)
},save:function(){this.loadUrl("metadata.update.new",undefined,this.loadCallback)
},saveMissingElements:function(){this.loadUrl("metadata.update.insertmissing",undefined,this.loadCallback)
},callAction:function(action){this.loadUrl(action,undefined,this.loadCallback)
},validate:function(){this.loadUrl("metadata.update.new","validate",this.loadCallback)
},reset:function(){this.loadUrl("metadata.update.forget.new",undefined,this.loadCallback)
},cancel:function(){this.loadUrl("metadata.update.forgetandfinish",undefined,this.closeCallback)
},process:function(action){this.loadUrl(action,undefined,this.loadCallback,true)
},init:function(metadataId,create,group,child,isTemplate){var url;
this.metadataId=metadataId;
if(create){url=this.createUrl+"?id="+this.metadataId+"&group="+group;
if(child){url+="&child=y"
}if(isTemplate){url+="&isTemplate="+isTemplate
}}else{url=this.editUrl+"?id="+this.metadataId
}url+="&currTab="+(document.mainForm?document.mainForm.currTab.value:this.defaultViewMode);
this.loadUrl(url,undefined,this.loadCallback);
if(this.disabled){this.setDisabled(false)
}this.container.show();
this.ownerCt&&this.ownerCt.show()
},loadUrl:function(action,validate,cb,noPostParams){this.toolbar&&this.toolbar.setDisabled(true);
if(document.mainForm){if(typeof validate!=="undefined"){document.mainForm.showvalidationerrors.value="true"
}else{document.mainForm.showvalidationerrors.value="false"
}}var mgr=this.editorMainPanel.getUpdater();
mgr.update({url:(action.indexOf("/")!==-1?action:this.catalogue.services.rootUrl+action),params:!noPostParams&&document.mainForm&&Ext.fly("editForm")!==null?Ext.Ajax.serializeForm("editForm"):undefined,callback:cb,scope:this,loadScripts:true,text:OpenLayers.i18n(action)+" ("+action+")"})
},closeCallback:function(){this.onEditorClosed();
this.ownerCt&&this.ownerCt.hide();
this.toolbar&&this.toolbar.setDisabled(false);
catalogue.search("advanced-search-options-content-form",app.searchApp.loadResults,null,catalogue.startRecord,true)
},loadCallback:function(el,success,response,options){if(!this.managerInitialized){this.initManager()
}if(success){if(options.url.indexOf("metadata.update.new")!=-1){if(this.validationPanel.collapsed){this.validationPanel.toggleCollapse()
}}this.metadataLoaded()
}else{this.getError(response)
}this.toolbar&&this.toolbar.setDisabled(false)
},getError:function(response){if(response&&response.responseText){var errorPage=response.responseText,errorTitle1,errorTitle,errorMsg,errorMsg1,errorMsg2;
errorTitle=errorPage.match(/<h2 class=\"error\"\>(.*)<\/h2\>/);
errorTitle1=errorTitle||errorPage.match(/<div id=\"error\"\>\n[ ]*<h2>(.*)<\/h2\>/);
errorMsg=errorPage.match(/<\/h2\>\n[ ]*<p\><\/p\>(.*)/);
if(!errorMsg){errorMsg1=errorPage.match(/<p id=\"error\">(.*)<\/p\>/);
errorMsg2=errorPage.match(/<p id=\"stacktrace\">(.*)<\/p\>/);
errorMsg=errorMsg1[1]+errorMsg2[1]
}else{errorMsg=errorMsg[1]
}if(errorTitle1){Ext.Msg.alert(errorTitle1[1],(errorMsg?errorMsg:""),function(){this.ownerCt.hide()
},this)
}}},updateEditor:function(html){this.editorMainPanel.update(html,false,this.metadataLoaded.bind(this))
},metadataLoaded:function(){this.metadataSchema=document.mainForm.schema.value;
this.metadataType=Ext.getDom("template");
this.metadataId=document.mainForm.id.value;
this.versionId=document.mainForm.version.value;
this.toolbar.setIsMinor(document.mainForm.minor.value);
this.toolbar.setIsTemplate(this.metadataType.value);
if(this.disabled){this.setDisabled(false)
}this.onMetadataUpdated();
this.initCalendar();
this.initMultipleSelect();
this.validateMetadataFields();
this.catalogue.extentMap.initMapDiv();
var formElements=Ext.query("th[id]",this.body.dom);
formElements=formElements.concat(Ext.query("legend[id]",this.body.dom));
Ext.each(formElements,function(item,index,allItems){var e=Ext.get(item);
var id=e.getAttribute("id");
if(e.is("TH")){var section=e.up("FIELDSET");
e.parent().on("mouseover",function(){this.helpPanel.updateHelp(id,section)
},this)
}else{e.on("mouseover",function(){this.helpPanel.updateHelp(id)
},this)
}},this);
this.updateViewMenu()
},validateMetadataField:function(input){var ch=input.getAttribute("onchange");
var ku=input.getAttribute("onkeyup");
if(typeof ch==="function"){ch=ch.toString()
}if(typeof ku==="function"){ku=ku.toString()
}if(!input||(ch!==null&&ch.indexOf("validate")===-1)||(ku!==null&&ku.indexOf("validate")===-1)){return
}if(input.onkeyup){try{input.onkeyup()
}catch(e){if(!Ext.isIE8&&!Ext.isIE9){console.log(e)
}}}if(input.onchange){try{input.onchange()
}catch(e){if(!Ext.isIE8&&!Ext.isIE9){console.log(e)
}}}},validateMetadataFields:function(){var items=Ext.DomQuery.select("select.lang_selector");
Ext.each(items,function(input){for(i=0;
i<input.options.length;
i++){if(input.options[i].getAttribute("code").toLowerCase()===this.lang){input.options[i].selected=true;
i=input.options.length
}}},this);
items=Ext.DomQuery.select("input,textarea,select");
Ext.each(items,function(input){this.validateMetadataField(input)
},this)
},initCalendar:function(){var calendars=Ext.DomQuery.select("div.cal"),i;
for(i=0;
i<calendars.length;
i++){var cal=calendars[i];
var id=cal.id;
cal.id=id+"Id";
if(cal.firstChild===null||cal.childNodes.length===0){var format="Y-m-d";
var formatEl=Ext.getDom(id+"_format",this.editorMainPanel.dom);
if(formatEl){format=formatEl.value
}var valueEl=Ext.getDom(id+"_cal",this.editorMainPanel.dom);
var value=(valueEl?valueEl.value:"");
var showTime=format.indexOf("T")===-1?false:true;
if(showTime){var dtCal=new Ext.ux.form.DateTime({renderTo:cal.id,name:id,id:id,value:value,dateFormat:"Y-m-d",timeFormat:"H:i",hiddenFormat:"Y-m-d\\TH:i:s",dtSeparator:"T"})
}else{var dCal=new Ext.form.DateField({renderTo:cal,name:id,id:id,width:160,value:value,format:"Y-m-d"});
if(Ext.isChrome){dCal.getEl().parent().setHeight("18")
}}}}},initMultipleSelect:function(){var selects=Ext.DomQuery.select("select.codelist_multiple"),i;
Ext.each(selects,function(select){var input=Ext.get("X"+select.id);
var tpl=input.dom.innerHTML;
onchangeEvent=function(){input.dom.innerHTML="";
Ext.each(this.options,function(option){if(option.selected){input.dom.innerHTML+=(input.dom.innerHTML===""?"":"&&&")+tpl.replace(new RegExp('codeListValue=".*"'),'codeListValue="'+option.value+'"')
}})
};
select.onchange=onchangeEvent
})
},updateViewMenu:function(){var modes=Ext.query("span.mode",this.body.dom),menu=[],i,j,e;
for(i=0;
i<modes.length;
i++){if(modes[i].firstChild){var id=modes[i].getAttribute("id");
var next=Ext.get(modes[i]).next();
var label=modes[i].innerHTML;
var tabs=next.query("LI");
var current=next.query("LI[id="+document.mainForm.currTab.value+"]");
var activeMode=current.length===1;
if(!activeMode){Ext.get(modes[i]).parent().remove()
}else{if(next&&tabs.length===1){next.remove()
}else{for(j=0;
j<tabs.length;
j++){e=Ext.get(tabs[j]);
e.on("click",function(){Ext.getCmp("editorPanel").switchToTab(this)
},e.getAttribute("id"))
}}}menu.push([label,id,activeMode])
}}this.toolbar.updateViewMenu(menu)
},onMetadataUpdated:function(){this.fireEvent("metadataUpdated",this,this.metadataId,this.metadataSchema,this.versionId)
},onEditorClosed:function(){this.fireEvent("editorClosed",this)
},initManager:function(){var mgr=this.editorMainPanel.getUpdater();
mgr.on("beforeupdate",function(el,url,params){this.position=this.editorMainPanel.getEl().parent().dom.scrollTop
},this);
mgr.on("update",function(el,response){this.editorMainPanel.getEl().parent().dom.scrollTop=this.position
},this);
this.managerInitialized=true
},initPanelLayout:function(){if(this.container){if(this.container.setIconClass){this.container.setIconClass("editing")
}if(this.container.setTitle){if(this.metadataId){this.container.setTitle(OpenLayers.String.format(OpenLayers.i18n("editing"),{title:"",uuid:this.metadataId}))
}else{}}}},initComponent:function(){var optionsPanel;
Ext.applyIf(this,this.defaultConfig);
this.disabled=(this.metadataId?false:true);
this.lang=(this.catalogue.lang?this.catalogue.lang:"eng");
this.editUrl=this.catalogue.services.mdEdit;
this.createUrl=this.catalogue.services.mdCreate;
this.updateUrl=this.catalogue.services.mdUpdate;
GeoNetwork.editor.EditorPanel.superclass.initComponent.call(this);
panel=this;
this.editorMainPanel=new Ext.Panel({border:false,frame:false,id:"editorMainPanel"});
var tbarConfig={editor:panel};
Ext.apply(tbarConfig,this.tbarConfig);
this.toolbar=new GeoNetwork.editor.EditorToolbar(tbarConfig);
var editorPanel={region:"center",split:true,autoScroll:true,tbar:this.toolbar,minHeigth:400,items:[this.editorMainPanel]};
this.add(editorPanel);
this.validationPanel=new GeoNetwork.editor.ValidationPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,serviceUrl:this.catalogue.services.mdValidate},this.utilityPanelConfig.validationPanel));
this.helpPanel=new GeoNetwork.editor.HelpPanel(Ext.applyIf({editor:this,html:""},this.utilityPanelConfig.helpPanel));
this.relationPanel=new GeoNetwork.editor.LinkedMetadataPanel(Ext.applyIf({editor:this,metadataId:this.metadataId,metadataSchema:this.metadataSchema,serviceUrl:this.catalogue.services.mdRelation},this.utilityPanelConfig.relationPanel));
this.thumbnailPanel=new GeoNetwork.editor.ThumbnailPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,getThumbnail:this.catalogue.services.mdGetThumbnail,setThumbnail:this.catalogue.services.mdSetThumbnail,unsetThumbnail:this.catalogue.services.mdUnsetThumbnail},this.utilityPanelConfig.thumbnailPanel));
this.suggestionPanel=new GeoNetwork.editor.SuggestionsPanel(Ext.applyIf({metadataId:this.metadataId,editor:this,catalogue:this.catalogue},this.utilityPanelConfig.suggestionPanel));
optionsPanel={region:"east",split:true,collapsible:true,collapsed:this.utilityPanelCollapsed,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:280,width:280,items:[this.thumbnailPanel,this.relationPanel,this.suggestionPanel,this.validationPanel,this.helpPanel]};
this.add(optionsPanel);
this.addEvents("metadataUpdated","editorClosed");
this.on("added",function(el,container,index){if(container){this.setContainer(container)
}this.initPanelLayout()
},this)
}});
Ext.reg("gn_editor_editorpanel",GeoNetwork.editor.EditorPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.EditorToolbar=Ext.extend(Ext.Toolbar,{catalogue:undefined,editor:undefined,enableOverflow:true,defaultConfig:{isTemplate:false,hideTypeMenu:false,editAttributes:false},mapOptions:undefined,layers:undefined,typeMenu:undefined,configMenu:undefined,viewMenu:undefined,saveAction:undefined,saveAndCloseAction:undefined,checkAction:undefined,insertMissingAction:undefined,resetAction:undefined,cancelAction:undefined,minorCheckbox:undefined,minorEdit:false,initComponent:function(){Ext.applyIf(this,this.defaultConfig);
var cmp=[];
if(!this.hideTypeMenu){cmp.push(this.createTypeMenu());
cmp.push(["-"])
}this.saveAction=new Ext.Action({text:OpenLayers.i18n("save"),tooltip:OpenLayers.i18n("save.tooltip"),iconCls:"saveMetadata",handler:function(){this.save()
},scope:this.editor});
this.checkAction=new Ext.Action({text:OpenLayers.i18n("saveAndCheck"),tooltip:OpenLayers.i18n("saveAndCheck.tooltip"),iconCls:"validateMetadata",handler:function(){this.validationPanel.validate()
},scope:this.editor});
this.saveAndCloseAction=new Ext.Action({text:OpenLayers.i18n("saveAndClose"),tooltip:OpenLayers.i18n("saveAndClose.tooltip"),iconCls:"quitMetadata",handler:function(){this.finish()
},scope:this.editor});
this.minorCheckbox=new Ext.Button({enableToggle:true,text:OpenLayers.i18n("minorEdit"),tooltip:OpenLayers.i18n("minorEditTT"),listeners:{toggle:function(c,pressed){document.mainForm.minor.value=this.minorEdit=pressed
},scope:this}});
this.insertMissingAction=new Ext.Action({id:"insert-missing-elements",width:20,height:14,iconCls:"insert-missing-elements",handler:function(){this.insertMissingElements()
},text:OpenLayers.i18n("Autofill"),tooltip:OpenLayers.i18n("autofill.tooltip"),type:"submit",scope:this});
this.resetAction=new Ext.Action({text:OpenLayers.i18n("reset"),tooltip:OpenLayers.i18n("reset.tooltip"),iconCls:"refreshMetadata",handler:function(){this.reset()
},scope:this.editor});
this.cancelAction=new Ext.Action({text:OpenLayers.i18n("cancel"),tooltip:OpenLayers.i18n("cancel.tooltip"),iconCls:"cancel",handler:function(){this.cancel()
},scope:this.editor});
cmp.push(this.createViewMenu(),["-"],this.saveAction,this.checkAction,this.saveAndCloseAction,this.minorCheckbox,["->"],this.insertMissingAction,this.resetAction,this.cancelAction);
GeoNetwork.editor.EditorToolbar.superclass.initComponent.call(this);
this.add(cmp)
},insertMissingElements:function(){this.editor.saveMissingElements()
},setIsTemplate:function(is){if(!this.hideTypeMenu){var isTemplate=is==="y";
Ext.getCmp("type_y").setChecked(isTemplate);
Ext.getCmp("type_n").setChecked(!isTemplate)
}},setIsMinor:function(minor){var state=true;
if(minor===""||minor==="false"){state=false
}this.minorCheckbox.toggle(state)
},createTypeMenu:function(){this.typeMenu={text:OpenLayers.i18n("type"),tooltip:OpenLayers.i18n("type.tooltip"),menu:{items:['<b class="menu-title">'+OpenLayers.i18n("chooseAType")+"</b>",{text:OpenLayers.i18n("md"),checked:true,value:"n",id:"type_n",group:"type",checkHandler:this.onTypeCheck},{text:OpenLayers.i18n("tpl"),checked:true,id:"type_y",group:"type",value:"y",checkHandler:this.onTypeCheck}]}};
return this.typeMenu
},configMenu:function(){this.configMenu={iconCls:"configIcon",menu:{items:[{text:OpenLayers.i18n("collapseAll"),checked:false,checkHandler:function(){Ext.each(Ext.DomQuery.select("div.toggle"),function(i){if(i.onclick){i.onclick()
}})
}},{text:OpenLayers.i18n("editAttributes"),checked:this.editAttributes,checkHandler:function(item,checked){this.editAttributes=checked;
this.editAttributesVisibility()
},scope:this}]}};
this.editor.on("metadataUpdated",function(){this.editAttributesVisibility()
},this);
return this.configMenu
},editAttributesVisibility:function(){Ext.each(Ext.select("div.toggle-attr"),function(i){i.setVisibilityMode(Ext.Element.DISPLAY);
i.setVisible(this.editAttributes)
},this)
},createViewMenu:function(modes){var items=['<b class="menu-title">'+OpenLayers.i18n("chooseAView")+"</b>"];
this.viewMenu=new Ext.menu.Menu({items:items});
var viewButton={text:OpenLayers.i18n("viewMode"),tooltip:OpenLayers.i18n("viewMode.tooltip"),iconCls:"viewModeIcon",menu:this.viewMenu};
return viewButton
},updateViewMenu:function(modes){var i,m;
this.viewMenu.removeAll();
for(i=0;
i<modes.length;
i++){m=modes[i];
this.viewMenu.add({text:m[0],checked:false,disabled:m[2],group:"mode",value:m[1],listeners:{checkchange:this.onViewCheck,scope:this}})
}this.viewMenu.doLayout()
},onViewCheck:function(item,checked){if(checked){this.editor.editorMainPanel.getEl().parent().scrollTo("top",0);
document.mainForm.currTab.value=item.value;
this.saveAction.execute()
}},onTypeCheck:function(item,checked){if(checked){Ext.get("template").dom.value=item.value
}},onDestroy:function(){}});
Ext.reg("gn_editor_editortoolbar",GeoNetwork.editor.EditorToolbar);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.EditorTools={addHiddenFormFieldForFragment:function(panel,xmlFragments,editorPanel){var id="_X"+panel.ref+"_"+panel.name.replace(":","COLON");
var xml;
var first=true;
Ext.each(xmlFragments,function(item,index){xmlFragments[index]=item.replace('<?xml version="1.0" encoding="UTF-8"?>',"").replace(/\&/g,"&amp;amp;").replace(/\"/g,"&quot;").replace(/\r\n/g,"");
if(first){xml=xmlFragments[index];
first=false
}else{xml+="&amp;&amp;&amp;"+xmlFragments[index]
}});
GeoNetwork.editor.EditorTools.addHiddenFormField(id,xml);
if(editorPanel){editorPanel.save()
}},addHiddenFormField:function(fieldId,fieldValue){var input={tag:"input",type:"hidden",id:fieldId,name:fieldId,value:fieldValue};
var dh=Ext.DomHelper;
dh.append(Ext.get("hiddenFormElements"),input)
},showNewMetadataWindow:function(scope,id,title,isChild,filter){if(scope.newMetadataWindow){scope.newMetadataWindow.close();
scope.newMetadataWindow=undefined
}if(!scope.newMetadataWindow){var newMetadataPanel=new GeoNetwork.editor.NewMetadataPanel({selectedTpl:id,isChild:isChild,filter:filter,getGroupUrl:scope.catalogue.services.getGroups,catalogue:scope.catalogue});
scope.newMetadataWindow=new Ext.Window({title:title===undefined?OpenLayers.i18n("newMetadata"):title,width:300,height:100,layout:"fit",modal:true,items:newMetadataPanel,closeAction:"destroy",constrain:true,iconCls:"addIcon"})
}scope.newMetadataWindow.show()
}};
lastclick=0;
Checks={message:translate("loseYourChange"),_setMessage:function(str){this.message=str
},_onbeforeunload:function(e){}};
function unloadMess(){mess=translate("loseYourChange");
return mess
}function doEditorAlert(divId,imgId){$(divId).style.display="block"
}function setBunload(on){if(on){Checks._setMessage(unloadMess())
}else{Checks._setMessage(null)
}}function noDoubleClick(){var now=(new Date()).valueOf();
if((now-lastclick)>500){setBunload(false);
lastclick=now;
return true
}else{return false
}}function doNewElementAction(action,ref,name,id,what,max){var child=null;
var orElement=false;
doNewElementAjax(action,ref,name,child,id,what,max,orElement)
}function doNewORElementAction(action,ref,name,child,id,what,max){var orElement=true;
doNewElementAjax(action,ref,name,child,id,what,max,orElement)
}function doNewAttributeAction(action,ref,name,id,what){var child="geonet:attribute";
var max=null;
var orElement=false;
doNewElementAjax(action,ref,name,child,id,what,max,orElement)
}function doNewElementAjax(action,ref,name,child,id,what,max,orElement){var metadataId=document.mainForm.id.value;
var pars="&id="+metadataId+"&ref="+ref+"&name="+name;
if(child!=null){pars+="&child="+child
}var thisElement=Ext.get(id);
Ext.Ajax.request({url:catalogue.services.rootUrl+action,method:"GET",params:pars,success:function(result,request){var html=result.responseText;
if(child=="geonet:attribute"){Ext.getCmp("editorPanel").save();
return
}if(what=="replace"){Ext.DomHelper.insertHtml("afterEnd",thisElement.dom,html);
thisElement.remove()
}else{if(what=="add"||what=="after"){var el=thisElement.insertHtml("afterEnd",html,true);
setAddControls(el,orElement)
}else{if(what=="before"){var el=thisElement.insertHtml("beforeBegin",html,true);
setAddControls(el,orElement)
}else{Ext.MessageBox.alert("doNewElementAjax: invalid what: "+what+" should be one of replace, after or before.")
}}}Ext.getCmp("editorPanel").metadataLoaded();
setBunload(true)
},onFailure:function(req){Ext.MessageBox.alert(translate("errorAddElement")+name+translate("errorFromDoc")+" / status "+req.status+" text: "+req.statusText+" - "+translate("tryAgain"));
setBunload(true)
}})
}function doRemoveElementAction(action,ref,parentref,id,min){var metadataId=document.mainForm.id.value;
var thisElement=Ext.get(id);
var nextElement=thisElement.next();
var prevElement=thisElement.prev();
Ext.Ajax.request({url:catalogue.services.rootUrl+action,method:"GET",params:{id:metadataId,ref:ref,parent:parentref},success:function(result,request){var html=result.responseText;
if(html==""){var originalElementType=id.split("_")[0];
var prevElementType=((prevElement==null)?"":prevElement.id.split("_")[0]);
var nextElementType=((nextElement==null)?"":nextElement.id.split("_")[0]);
if(bottomElement(thisElement)){var doSwapControls=true;
if(document.mainForm.currTab.value==="simple"){doSwapControls=(originalElementType===prevElementType)
}if(doSwapControls){swapControls(thisElement,prevElement);
thisElement.remove();
thisElement=prevElement;
if(originalElementType===prevElementType){if(topElement(thisElement)){topControls(thisElement,min)
}}}else{thisElement.remove();
thisElement=nextElement;
if(originalElementType===nextElementType){if(topElement(thisElement)){topControls(thisElement,min)
}}}}else{thisElement.remove();
thisElement=nextElement;
if(originalElementType===nextElementType){if(topElement(thisElement)){topControls(thisElement,min)
}}}}else{if(orElement(thisElement)){thisElement.remove()
}else{Ext.DomHelper.insertHtml("afterEnd",thisElement.dom,html);
thisElement.remove()
}}setBunload(true)
},failure:function(result,request){Ext.MessageBox.alert(translate("errorDeleteElement")+name+" "+translate("errorFromDoc")+" / status "+result.status+" text: "+result.statusText+" - "+translate("tryAgain"));
setBunload(true)
}})
}function doRemoveAttributeAction(action,ref,parentref){var metadataId=document.mainForm.id.value;
var thisElement=Ext.get(ref+"_block");
Ext.Ajax.request({url:catalogue.services.rootUrl+action,method:"GET",params:{id:metadataId,ref:ref},success:function(result,request){var html=result.responseText;
var editor=Ext.getCmp("editorPanel");
editor.save();
setBunload(true)
},failure:function(result,request){Ext.MessageBox.alert(translate("errorDeleteAttribute")+name+" "+translate("errorFromDoc")+" / status "+result.status+" text: "+result.statusText+" - "+translate("tryAgain"));
setBunload(true)
}})
}function updateEditorContent(result,request){var editor=Ext.getCmp("editorPanel");
editor.updateEditor(result.responseText);
setBunload(true)
}function doProcessing(config,cb){config.id=document.mainForm.id.value;
config.remote="true";
Ext.Ajax.request({url:catalogue.services.rootUrl+"metadata.processing",method:"POST",params:config,success:function(result,request){updateEditorContent(result,request);
if(cb){cb()
}},failure:function(req){Ext.MessageBox.alert(translate("errorSaveFailed")+"/ status "+req.status+" text: "+req.statusText+" - "+translate("tryAgain"));
setBunload(true)
}})
}function doMoveElementAction(action,ref,id){var thisElement=Ext.get(id);
var config={id:document.mainForm.id.value,ref:ref};
Ext.Ajax.request({url:catalogue.services.rootUrl+action,method:"POST",params:config,success:function(req){if(action.indexOf("elem.up")!=-1){var upElement=thisElement.prev();
thisElement.insertSibling(upElement,"after");
swapControls(thisElement,upElement)
}else{var downElement=thisElement.next();
thisElement.insertSibling(downElement,"before");
swapControls(thisElement,downElement)
}setBunload(true)
},failure:function(req){Ext.MessageBox.alert(translate("errorMoveElement")+ref+" / status "+req.status+" text: "+req.statusText+" - "+translate("tryAgain"));
setBunload(true)
}})
}function doFileRemoveAction(action,ref,access,id){setBunload(false);
document.mainForm.access.value=access;
document.mainForm.ref.value=ref;
document.mainForm.action=action;
Ext.getCmp("editorPanel").callAction(action)
}function checkForFileUpload(fref,pref,protocolBeforeEdit){var fileName=Ext.getDom("_"+fref);
var protoSelect=Ext.getDom("s_"+pref);
var protoIn=Ext.getDom("_"+pref);
var fileUploaded=OpenLayers.String.startsWith(protocolBeforeEdit,"WWW:DOWNLOAD");
var protocol=protoSelect.value;
var protocolDownload=(OpenLayers.String.startsWith(protocol,"WWW:DOWNLOAD")&&protocol.indexOf("http")>0);
if(fileUploaded){if(!protocolDownload){alert(OpenLayers.i18n("errorChangeProtocol"));
protoSelect.value=protoIn.value
}else{protoIn.value=protoSelect.value
}return
}var finput=Ext.get("di_"+fref);
var fbuttn=Ext.get("db_"+fref);
protoIn.value=protoSelect.value;
if(protocolDownload){if(finput!==null){finput.hide()
}if(fbuttn!==null){fbuttn.show()
}Ext.getCmp("editorPanel").callAction("metadata.update.new")
}else{if(finput!==null){finput.show()
}if(fbuttn!==null){fbuttn.hide()
}}}function handleCheckboxAsBoolean(input,ref){if(input.checked){Ext.getDom(ref).value="true"
}else{Ext.getDom(ref).value="false"
}}function swapControls(el1,el2){var el1Descs=getControlsFromElement(el1);
var el2Descs=getControlsFromElement(el2);
for(var index=0;
index<el1Descs.length;
++index){var visible1=el1Descs[index].isVisible();
var visible2=el2Descs[index]?el2Descs[index].isVisible():false;
if(el2Descs[index]){if(visible1){el2Descs[index].show()
}else{el2Descs[index].hide()
}}if(visible2){el1Descs[index].show()
}else{el1Descs[index].hide()
}}}function getControlsFromElement(el){if(el===null){return[]
}var id=el.getAttribute("id");
var controls=Ext.get("buttons_"+id).query("a");
for(var i=0;
i<controls.length;
i++){controls[i]=Ext.get(controls[i]).setVisibilityMode(Ext.Element.DISPLAY)
}return controls
}function topElement(el){if(el.prev()==undefined){return true
}else{return(!isSameElement(el.prev(),el))
}}function bottomElement(el){if(el.next()==undefined){return true
}else{return(!isSameElement(el.next(),el))
}}function getIdSplit(el){var id=el.getAttribute("id");
if(id==null){return null
}return id.split("_")
}function orElement(el){if(el.next()==undefined){return false
}else{var nextEl=getIdSplit(el.next());
var thisEl=getIdSplit(el);
if(nextEl==null||thisEl==null){return false
}if(nextEl[0]=="child"&&nextEl[1]==thisEl[0]){return true
}else{return false
}}}function isSameElement(el1,el2){var i1=getIdSplit(el1);
var i2=getIdSplit(el2);
if(i1==null||i2==null){return false
}if(i1[0]==i2[0]){return true
}else{return false
}}function topControls(el,min){var elDescs=getControlsFromElement(el);
var index=0;
if(elDescs.length==5){index=1
}if(bottomElement(el)&&!orElement(el)){elDescs[0].show()
}else{elDescs[0].hide()
}if(index==1){if(bottomElement(el)&&!orElement(el)){elDescs[index].show()
}else{elDescs[index].hide()
}}if(bottomElement(el)){if(min==0){elDescs[1+index].show()
}else{elDescs[1+index].hide()
}}else{elDescs[1+index].show()
}elDescs[2+index].hide();
if(bottomElement(el)){elDescs[3+index].hide()
}else{elDescs[3+index].show()
}}function setAddControls(el,orElement){elDescs=getControlsFromElement(el);
var index=0;
if(elDescs.length==5){index=1
}if(orElement){elDescs[0].hide()
}else{elDescs[0].show()
}if(index==1){if(orElement){elDescs[index].hide()
}else{elDescs[index].show()
}}elDescs[1+index].show();
elDescs[2+index].show();
if(elDescs[3+index]){elDescs[3+index].hide()
}if(topElement(el)){elDescs[2+index].hide()
}else{var prevEl=el.prev();
var prevDescs=getControlsFromElement(prevEl);
var prevIndex=0;
if(prevDescs.length==5){prevIndex=1
}prevDescs[0].hide();
if(prevIndex==1){prevDescs[prevIndex].hide()
}prevDescs[1+prevIndex].show();
if(topElement(prevEl)){prevDescs[2+prevIndex].hide()
}else{prevDescs[2+prevIndex].show()
}var el=prevDescs[3+prevIndex];
if(el){el.show()
}}}function validateNumber(input,nullValue,decimals){var text=input.value;
var validChars="0123456789";
if(!nullValue){if(!validateNonEmpty(input)){return false
}}if(decimals){validChars+="."
}var isNumber=true;
var c;
for(i=0;
i<text.length&&isNumber;
i++){c=text.charAt(i);
if(c=="-"||c=="+"){if(i<0){isNumber=false
}}else{if(validChars.indexOf(c)==-1){isNumber=false
}}}if(!isNumber){Ext.get(input).addClass("error");
return false
}else{Ext.get(input).removeClass("error");
return true
}}function validateNonEmpty(input){if(input.value.length<1){Ext.get(input).addClass("error");
if(Ext.get(input).parent()){Ext.get(input).parent().addClass("mandatory-alert")
}return false
}else{Ext.get(input).removeClass("error");
if(Ext.get(input).parent()){Ext.get(input).parent().removeClass("mandatory-alert")
}return true
}}function validateEmail(input){if(!Ext.form.VTypes.email(input.value)){Ext.get(input).addClass("error");
return false
}else{Ext.get(input).removeClass("error");
return true
}}function toggleFieldset(btn,elem){var b=Ext.get(btn);
if(b.hasClass("tgDown")){b.removeClass("tgDown");
elem.style.display="none";
b.addClass("tgRight")
}else{b.removeClass("tgRight");
elem.style.display="block";
b.addClass("tgDown")
}}function enableLocalInput(node,focus){var ref=node.value;
var parent=node.parentNode.parentNode;
var nodes=parent.getElementsByTagName("input");
var textarea=parent.getElementsByTagName("textarea");
showLocalInput(nodes,ref,focus);
showLocalInput(textarea,ref,focus)
}function showLocalInput(nodes,ref,focus){for(index in nodes){var input=nodes[index];
if(input.style!=null&&input.style.display!="none"){input.style.display="none"
}}for(index in nodes){var input=nodes[index];
if(input.name==ref){input.style.display="block";
if(focus){input.focus()
}}}}function clearSuggestion(divSuggestion){if($(divSuggestion)!=null){$(divSuggestion).innerHTML=""
}}function googleTranslate(ref,divSuggestion,target,fromLang,toLang){var map={GE:"de",SP:"es",CH:"zh"};
if(map[fromLang]){fromLang=map[fromLang]
}if(map[toLang]){toLang=map[toLang]
}if($(ref).value==""){Ext.Msg.alert(translate("translateWithGoogle.emptyInput"));
return
}if($(ref).value.length>5000){Ext.Msg.alert(translate("translateWithGoogle.maxSize"));
return
}if($(divSuggestion)!=null){$(divSuggestion).innerHTML=""
}try{google.language.translate($(ref).value,fromLang,toLang,function(result){if(!result.error){var suggestion=result.translation.replace(/&#39;/g,"'").replace(/&quot;/g,'"');
if($(target)!=null){$(target).value=suggestion
}if($(divSuggestion)!=null){$(divSuggestion).innerHTML=suggestion;
$(divSuggestion).style.display="block"
}}else{Ext.Msg.alert(result.error.message+" ("+result.error.code+")")
}validateMetadataField($(target))
})
}catch(err){Ext.Msg.alert("Translation service error","Check google translation API is loaded: "+err)
}}function updateChildren(div,url,onFailureMsg){var pars="&id="+document.mainForm.id.value+"&parentUuid="+Ext.getDom("parentUuid").value+"&schema="+Ext.getDom("schema").value+"&childrenIds="+Ext.getDom("childrenIds").value;
var boxes=Ext.get(div).select('input[type="checkbox"]');
boxes.each(function(s){var e=Ext.getDom(s);
if(e.checked){pars+="&"+e.name+"=true"
}});
var radios=Ext.get(div).select('input[type="radio"]');
radios.each(function(radio){var e=Ext.getDom(radio);
if(radio.checked){pars+="&"+e.name+"="+e.value
}});
Ext.Ajax.request({url:catalogue.services.rootUrl+url,method:"GET",params:pars,success:function(result,request){var xmlNode=result.responseXML;
if(xmlNode.childNodes.length!==0&&xmlNode.childNodes[0].localName=="response"){var response=xmlNode.childNodes[0].childNodes[0].nodeValue;
Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),response);
Ext.get(div).hide()
}else{Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),onFailureMsg)
}},failure:function(result,request){Ext.MessageBox.alert(OpenLayers.i18n("updateChildren"),onFailureMsg)
}})
}Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.HelpPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"book",title:undefined,collapsible:true,collapsed:false},editor:undefined,tipTpl:undefined,cache:{},loadHelp:function(id,sectionId,updateMessage,cb){if(!this.cache[id]){var panel=this;
GeoNetwork.util.HelpTools.get(id,this.editor.metadataSchema,this.editor.catalogue.services.schemaInfo,function(r){panel.cache[id]=panel.tipTpl.apply(r.records[0].data);
panel.update(panel.cache[id])
})
}},updateHelp:function(id,section){if(this.collapsed){return
}var key=id;
var msg="";
var sectionId;
var panel=this;
if(section){sectionId=section.first().getAttribute("id")
}if(this.cache[id]&&this.cache[sectionId]){this.update(this.cache[id]+this.cache[sectionId])
}else{if(sectionId){this.loadHelp(sectionId,null,false,panel.loadHelp(id,sectionId,true))
}else{this.loadHelp(id,null,true)
}}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.tipTpl=new Ext.XTemplate(GeoNetwork.util.HelpTools.Templates.COMPLETE);
this.title=OpenLayers.i18n("help");
GeoNetwork.editor.HelpPanel.superclass.initComponent.call(this);
panel=this
}});
Ext.reg("gn_editor_helppanel",GeoNetwork.editor.HelpPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.keyword={};
GeoNetwork.editor.KeywordSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,Keyword:Ext.data.Record.create([{name:"value"},{name:"thesaurus"},{name:"uri"}]),keywordStore:undefined,border:false,addAsXLink:false,itemSelector:null,loadingMask:null,ThesaurusCount:null,ref:null,name:"gmd:descriptiveKeywords",keywordsSelected:[],initComponent:function(){this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox"},reader:new Ext.data.XmlReader({record:"keyword",id:"uri"},this.Keyword),fields:["value","thesaurus","uri"],sortInfo:{field:"thesaurus"}});
this.items=[{xtype:"panel",layout:"fit",bodyStyle:"padding: 5px;",border:false,tbar:{enableOverflow:true,items:[this.getThesaurusCombo()," ",this.getKeyword(),"->",OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()]},items:[this.getKeywordsItemSelector()]}];
this.keywordStore.on({loadexception:function(){},beforeload:function(store,options){if(Ext.getCmp("maxResults")){store.baseParams.maxResults=Ext.getCmp("maxResults").getValue()
}if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.itemSelector.fromMultiselect.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show()
},load:function(){this.loadingMask.hide()
},scope:this});
this.addEvents("keywordselected");
this.bbar=["->",{id:"addAsXLinkCheckBox",xtype:"checkbox",checked:false,boxLabel:OpenLayers.i18n("addAsXLink"),listeners:{check:function(c,checked){this.addAsXLink=checked
},scope:this}},{id:"keywordSearchValidateButton",iconCls:"addIcon",disabled:true,text:OpenLayers.i18n("add"),handler:function(){this.buildKeywordXmlList()
},scope:this}];
GeoNetwork.editor.KeywordSelectionPanel.superclass.initComponent.call(this)
},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"})
},setRef:function(ref){this.ref=ref
},setAddAsXLink:function(xlink){this.addAsXLink=xlink||false;
Ext.getCmp("addAsXLinkCheckBox").setValue(this.addAsXLink)
},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:50,width:40}
},getThesaurusCombo:function(){GeoNetwork.editor.keyword.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus,allOption:true,activatedOnly:true});
return{xtype:"combo",width:150,id:"search-thesauri",value:0,store:GeoNetwork.editor.keyword.thesaurusStore,triggerAction:"all",mode:"local",displayField:"title",valueField:"id",listWidth:250,listeners:{select:function(combo,record,index){this.keywordStore.removeAll();
this.keywordStore.baseParams.pThesauri=combo.getValue();
var value=Ext.getCmp("keywordSearchField").getValue();
if(value.length<1){this.keywordStore.baseParams.pKeyword="*"
}else{this.keywordStore.baseParams.pKeyword=value
}this.keywordStore.reload()
},clear:function(combo){this.keywordStore.load()
},scope:this}}
},getKeywordsItemSelector:function(){var tpl='<tpl for="."><div class="ux-mselect-item';
if(Ext.isIE||Ext.isIE7){tpl+='" unselectable=on'
}else{tpl+=' x-unselectable"'
}tpl+='>{id} {value} <span class="ux-mselect-item-thesaurus">({thesaurus})</span></div></tpl>';
this.itemSelector=new Ext.ux.ItemSelector({name:"itemselector",fieldLabel:"ItemSelector",dataFields:["value","thesaurus"],toData:[],msWidth:320,msHeight:230,valueField:"value",toSortField:undefined,fromTpl:tpl,toTpl:tpl,toLegend:OpenLayers.i18n("selectedKeywords"),fromLegend:OpenLayers.i18n("foundKeywords"),fromStore:this.keywordStore,fromAllowTrash:false,fromAllowDup:true,toAllowDup:false,drawUpIcon:false,drawDownIcon:false,drawTopIcon:false,drawBotIcon:false,imagePath:"../../apps/js/ext-ux/images",toTBar:[{text:OpenLayers.i18n("clear"),handler:function(){var i=this.getForm().findField("itemselector");
i.reset.call(i)
},scope:this}]});
this.itemSelector.on({change:function(component){Ext.getCmp("keywordSearchValidateButton").setDisabled(component.toStore.getCount()<1)
}});
return this.itemSelector
},buildKeywordXmlList:function(){this.keywordsSelected=[];
var self=this;
this.ThesaurusCount=0;
var thesaurusCollection=[];
var store=this.itemSelector.toMultiselect.store;
thesaurusCollection=store.collect("thesaurus");
Ext.each(thesaurusCollection,function(thesaurus,index,thesauri){store.filter("thesaurus",thesaurus);
var values=store.collect("uri");
Ext.each(values,function(item,index){values[index]=item.replace("#","%23")
});
var serviceUrl=self.catalogue.services.getKeyword;
var multiple=values.length>1?true:false;
var inputValue=serviceUrl+"?thesaurus="+thesaurus+"&id="+values.join(",")+"&multiple="+multiple;
++self.ThesaurusCount;
if(self.addAsXLink){var tpl="<gmd:descriptiveKeywords xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:gmd='http://www.isotc211.org/2005/gmd'  xmlns:gco='http://www.isotc211.org/2005/gco' xlink:href='"+inputValue+"'/>";
self.keywordsSelected.push(tpl)
}else{self.retrieveKeywordData(inputValue)
}});
if(this.addAsXLink){this.fireEvent("keywordselected",this,this.keywordsSelected);
this.ownerCt.hide()
}store.clearFilter()
},retrieveKeywordData:function(url){Ext.getCmp("keywordSearchValidateButton").disable();
Ext.Ajax.request({url:url,method:"GET",scope:this,success:function(response){var keyword=response.responseText;
if(keyword.indexOf("<gmd:MD_Keywords")!==-1){this.keywordsSelected.push("<gmd:descriptiveKeywords xmlns:gmd='http://www.isotc211.org/2005/gmd'>"+response.responseText+"</gmd:descriptiveKeywords>")
}Ext.getCmp("keywordSearchValidateButton").enable();
this.ThesaurusCount-=1;
if(this.ThesaurusCount===0){this.fireEvent("keywordselected",this,this.keywordsSelected);
this.ownerCt.hide()
}}})
}});
Ext.reg("gn_editor_keywordselectionpanel",GeoNetwork.editor.KeywordSelectionPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.LinkedMetadataPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,selectedUuid:undefined,selectedType:undefined,metadataSchema:undefined,serviceUrl:undefined,store:undefined,parentAction:undefined,datasetAction:undefined,serviceAction:undefined,featureCatAction:undefined,delFeatureCatAction:undefined,updateChildrenAction:undefined,colModel:undefined,expander:undefined,defaultConfig:{border:false,frame:false,iconCls:"linkIcon",collapsible:true,collapsed:false},createColumnDef:function(){this.expander=new Ext.grid.RowExpander({tpl:new Ext.XTemplate('<div title=""><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');">{title}</a></div>{msg}')});
return[this.expander,{id:"type",header:OpenLayers.i18n("type"),width:60,sortable:true,hidden:true,dataIndex:"type"},{header:OpenLayers.i18n("title"),hidden:false,dataIndex:"title"}]
},createColumnModel:function(){this.colModel=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:this.createColumnDef()});
return this.colModel
},updatePanel:function(){this.reload()
},clear:function(){if(this.store){try{this.store.removeAll()
}catch(e){}}this.remove()
},reload:function(e,id,schema){this.metadataId=id||this.metadataId;
this.metadataSchema=schema||this.metadataSchema;
if(this.collapsed){return
}this.colModel.setConfig(this.createColumnDef());
var isIso=this.metadataSchema.indexOf("iso19139")!==-1;
var isIso19110=this.metadataSchema==="iso19110";
this.parentAction.setDisabled(!isIso);
this.serviceAction.setDisabled(!isIso);
this.datasetAction.setDisabled(!isIso);
this.featureCatAction.setDisabled(isIso19110);
this.store.reload({params:{id:this.metadataId,fast:"false"}})
},updateStatus:function(store,records,options){var children=store.find("type","children");
this.updateChildrenAction.setDisabled(children===-1);
var iso19110=store.find("type","related");
this.delFeatureCatAction.setDisabled(iso19110===-1)
},selectionChangeEvent:function(g,idx,e){var record=g.getStore().getAt(idx);
this.selectedUuid=record.get("uuid");
this.selectedType=record.get("type");
this.delFeatureCatAction.setDisabled(this.selectedType!=="related")
},getChildrenIds:function(){var uuidList=[];
this.store.each(function(record){if(record.get("type")==="children"){this.push(record.get("id"))
}},uuidList);
return uuidList
},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.title=OpenLayers.i18n("relatedResources");
this.tools=[{id:"refresh",handler:function(e,toolEl,panel,tc){panel.reload(panel,panel.metadataId)
}}];
this.parentAction=new Ext.Action({text:OpenLayers.i18n("parentMd"),iconCls:"cat-parent",handler:function(){this.switchToTab("metadata")
},scope:this.editor});
this.datasetAction=new Ext.Action({text:OpenLayers.i18n("datasetMd"),iconCls:"cat-dataset",handler:function(){this.showLinkedServiceMetadataSelectionPanel("coupledResource","","")
},scope:this.editor});
this.serviceAction=new Ext.Action({text:OpenLayers.i18n("serviceMd"),iconCls:"cat-service",handler:function(){this.showLinkedServiceMetadataSelectionPanel("attachService","","")
},scope:this.editor});
this.featureCatAction=new Ext.Action({text:OpenLayers.i18n("featureCat"),iconCls:"cat-featureCatalogue",handler:function(){this.showLinkedMetadataSelectionPanel(null,"iso19110")
},scope:this.editor});
this.delFeatureCatAction=new Ext.Action({text:OpenLayers.i18n("delete19110Relation"),handler:function(){this.editor.catalogue.doAction(this.editor.catalogue.services.mdRelationDelete,{childUuid:this.selectedUuid,parentId:this.metadataId},null,null,this.reload.bind(this),null);
var urlProcessing=this.editor.catalogue.services.mdProcessing+"?uuidref="+this.selectedUuid+"&id="+this.metadataId+"&process=update-detachFeatureCatalogue";
this.editor.process(urlProcessing)
},scope:this,disabled:true});
this.updateChildrenAction=new Ext.Action({text:OpenLayers.i18n("updateChildren"),handler:function(){this.editor.catalogue.modalAction(OpenLayers.i18n("updateChildren"),this.editor.catalogue.services.mdMassiveChildrenForm+"?parentUuid="+document.mainForm.uuid.value+"&schema="+document.mainForm.schema.value+"&childrenIds="+this.getChildrenIds().join(","))
},scope:this,disabled:true});
this.bbar=new Ext.Toolbar({items:[{text:OpenLayers.i18n("createLink"),iconCls:"relatedAddIcon",menu:new Ext.menu.Menu({items:[this.parentAction,this.datasetAction,this.serviceAction,this.featureCatAction]})},{text:OpenLayers.i18n("otherActions"),menu:new Ext.menu.Menu({items:[this.updateChildrenAction,this.delFeatureCatAction]})}]});
GeoNetwork.editor.LinkedMetadataPanel.superclass.initComponent.call(this);
this.store=new GeoNetwork.data.MetadataRelationStore(this.serviceUrl,{fast:false,id:this.metadataId},true);
var panel=this;
var grid=new Ext.grid.GridPanel({store:this.store,colModel:this.createColumnModel(),loadMask:true,plugins:this.expander,view:new Ext.grid.GroupingView({forceFit:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+OpenLayers.i18n("records")+'" : "'+OpenLayers.i18n("record")+'"]})'}),frame:false,height:150,autoWidth:true,listeners:{rowclick:this.selectionChangeEvent,scope:panel}});
this.add(grid);
if(this.metadataId){this.reload()
}this.editor.on("editorClosed",this.clear,this);
this.editor.on("metadataUpdated",this.reload,this);
this.on("expand",this.reload);
this.store.on("load",this.updateStatus,this)
}});
Ext.reg("gn_editor_linkedmetadatapanel",GeoNetwork.editor.LinkedMetadataPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.Filter={SERVICE:[{name:"E_type",value:"service"}],DATASET:[{name:"E_type",value:"dataset"}],FEATURE_CATALOGUE:[{name:"E__schema",value:"iso19110"}]};
GeoNetwork.editor.linkedMetadata={};
GeoNetwork.editor.LinkedMetadataSelectionPanel=Ext.extend(Ext.FormPanel,{catalogue:undefined,border:false,layout:"fit",createIfNotExistURL:null,hiddenParameters:undefined,singleSelect:true,loadingMask:null,mdStore:null,ref:null,proxy:null,mode:null,serviceUrl:null,capabilitiesStore:null,linkedMetadataStore:undefined,initComponent:function(){this.addEvents("linkedmetadataselected");
this.mdStore=new GeoNetwork.data.MetadataResultsStore();
this.linkedMetadataStore=GeoNetwork.data.MetadataCSWResultsStore();
if(this.mode==="attachService"||this.mode==="coupledResource"){this.capabilitiesStore=new GeoExt.data.WMSCapabilitiesStore({url:this.serviceUrl,id:"capabilitiesStore",listeners:{exception:function(proxy,type,action,options,res,arg){Ext.MessageBox.alert(OpenLayers.i18n("error"))
},beforeload:function(){if(this.mode==="attachService"){var selected=Ext.getCmp("linkedMetadataGrid").getSelectionModel().getSelections();
if(selected===undefined||selected[0].data.uri===""){Ext.MessageBox.alert(OpenLayers.i18n("noServiceURLError"))
}this.capabilitiesStore.baseParams.url=selected[0].data.uri+"?&SERVICE=WMS&REQUEST=GetCapabilities&VERSION=1.1.1"
}else{if(this.mode==="coupledResource"){this.capabilitiesStore.baseParams.url=this.serviceUrl
}}},loadexception:function(){Ext.MessageBox.alert(OpenLayers.i18n("GetCapabilitiesDocumentError")+this.capabilitiesStore.baseParams.url)
},scope:this}})
}if(this.mode==="attachService"){this.hiddenParameters=GeoNetwork.editor.Filter.SERVICE
}else{if(this.mode==="iso19110"){this.hiddenParameters=GeoNetwork.editor.Filter.FEATURE_CATALOGUE
}}var checkboxSM=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:"",listeners:{selectionchange:function(){Ext.getCmp("linkedMetadataValidateButton").setDisabled(this.getSelections().length<1)
}}});
var tbarItems=[this.getSearchInput(),"->",OpenLayers.i18n("maxResults"),this.getLimitInput()];
this.addHiddenFormInput(tbarItems);
var grid=new Ext.grid.GridPanel({id:"linkedMetadataGrid",xtype:"grid",layout:"fit",height:280,bodyStyle:"padding: 0px;",border:true,loadMask:true,tbar:{enableOverflow:true,items:tbarItems},store:this.linkedMetadataStore,columns:[checkboxSM,{id:"title",header:OpenLayers.i18n("mdTitle"),dataIndex:"title"},{id:"subject",header:OpenLayers.i18n("keywords"),dataIndex:"subject",hidden:true},{id:"uri",header:OpenLayers.i18n("uri"),dataIndex:"getCapabilitiesUrl"}],sm:checkboxSM,autoExpandColumn:"title",listeners:{rowclick:function(grid,rowIndex,e){if(this.capabilitiesStore!==null&&this.mode!=="coupledResource"){this.serviceUrl=grid.getStore().getAt(rowIndex).data.uri;
if(this.serviceUrl===""){this.capabilitiesStore.removeAll()
}else{this.capabilitiesStore.baseParams.url=this.serviceUrl;
this.capabilitiesStore.reload()
}}},scope:this}});
if(this.mode==="attachService"||this.mode==="coupledResource"){this.items=this.getScopedNamePanel(grid)
}else{this.items=grid
}var panel=this;
this.bbar=["->",{id:"linkedMetadataValidateButton",iconCls:"relatedAddIcon",text:OpenLayers.i18n("createRelation"),disabled:true,handler:function(){var selected=grid.getSelectionModel().getSelections();
this.fireEvent("linkedmetadataselected",this,selected);
this.ownerCt.close()
},scope:panel}];
this.linkedMetadataStore.on({load:function(){if(this.loadingMask!==null){this.loadingMask.hide()
}},scope:this});
GeoNetwork.editor.LinkedMetadataSelectionPanel.superclass.initComponent.call(this)
},getCreateIfNotExistButton:function(){if(!this.createIfNotExistURL){return""
}return{id:"createIfNotExistButton",iconCls:"addIcon",text:OpenLayers.i18n("createIfNotExistButton"),handler:function(){window.location.replace(this.createIfNotExistURL)
},scope:this}
},setRef:function(ref){this.ref=ref
},addHiddenFormInput:function(items){var i;
if(this.hiddenParameters){for(i=0;
i<this.hiddenParameters.length;
i++){items.push({xtype:"textfield",fieldLabel:this.hiddenParameters[i].name,name:this.hiddenParameters[i].name,value:this.hiddenParameters[i].value,hidden:true})
}}return items
},getSearchInput:function(){return new GeoNetwork.form.SearchField({name:"E.8_AnyText",width:240,store:this.linkedMetadataStore,triggerAction:function(scope){scope.doSearch()
},scope:this})
},getLimitInput:function(){return{xtype:"textfield",name:"nbResultPerPage",id:"nbResultPerPage",value:20,width:40}
},getScopedNamePanel:function(grid){var combo={xtype:"combo",id:"getCapabilitiesLayerNameCombo",fieldLabel:OpenLayers.i18n("getCapabilitiesLayer"),store:this.capabilitiesStore,valueField:"name",displayField:"title",triggerAction:"all",listeners:{select:function(combo,record,index){Ext.getCmp("getCapabilitiesLayerName").setValue(combo.getValue())
}}};
var layerName={xtype:"textfield",id:"getCapabilitiesLayerName",fieldLabel:OpenLayers.i18n("layerName"),valueField:"name",displayField:"title"};
var panel={xtype:"panel",layout:"form",bodyStyle:"padding: 2px;",border:true,items:[grid,combo,layerName]};
return panel
},doSearch:function(){if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("searching")})
}this.loadingMask.show();
GeoNetwork.editor.nbResultPerPage=20;
if(Ext.getCmp("nbResultPerPage")){GeoNetwork.editor.nbResultPerPage=Ext.getCmp("nbResultPerPage").getValue()
}GeoNetwork.util.CSWSearchTools.doCSWQueryFromForm(this.id,this.catalogue,1,this.showResults.bind(this),null,Ext.emptyFn)
},showResults:function(response){var getRecordsFormat=new OpenLayers.Format.CSWGetRecords.v2_0_2();
var r=getRecordsFormat.read(response.responseText);
var values=r.records;
if(values.length>0){this.linkedMetadataStore.loadData(r)
}if(this.loadingMask!==null){this.loadingMask.hide()
}}});
Ext.reg("gn_editor_linkedmetadataselectionpanel",GeoNetwork.editor.LinkedMetadataSelectionPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.LogoSelectionPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,logoAddUrl:undefined,ref:undefined,setRef:function(ref){this.ref=ref
},getUploadForm:function(){this.uploadForm=new Ext.form.FormPanel({fileUpload:true,region:"south",height:80,split:true,items:{xtype:"fileuploadfield",allowBlank:false,emptyText:OpenLayers.i18n("logoSelect"),hideLabel:true,name:"fname",buttonCfg:{iconCls:"thumbnailAddIcon"}},buttons:[{text:OpenLayers.i18n("upload"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:this.logoAddUrl,scope:this,success:function(fp,action){this.store.reload()
},failure:function(response){Ext.Msg.alert(OpenLayers.i18n("failure"),response.responseText)
}})
}}}]});
return this.uploadForm
},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
var tpl=new Ext.XTemplate('<tpl for="."><div class="logo-wrap"><div id="{name}" class="logo">','<img src="'+this.logoUrl+'{name}" title="{name}"/><span>{name}</span></div></div>',"</tpl>");
var logo=Ext.data.Record.create([{name:"name",mapping:""}]);
this.store=new Ext.data.Store({autoDestroy:true,proxy:new Ext.data.HttpProxy({method:"GET",url:this.serviceUrl,disableCaching:false}),reader:new Ext.data.XmlReader({record:"icon",id:"icon"},logo),fields:["name"]});
this.view=new Ext.DataView({store:this.store,tpl:tpl,singleSelect:true,selectedClass:"logo-selected",overClass:"logo-over",itemSelector:"div.logo-wrap",autoScroll:true,listeners:{selectionchange:function(dv,selections){var idx=this.view.getSelectedIndexes();
if(selections){this.fireEvent("logoselected",this,idx);
this.ownerCt.hide()
}},scope:this}});
this.items=[new Ext.Panel({region:"center",split:true,border:true,autoScroll:true,items:[this.view]}),this.getUploadForm()];
GeoNetwork.editor.LogoSelectionPanel.superclass.initComponent.call(this);
this.addEvents("logoselected");
this.store.load()
}});
Ext.reg("gn_editor_logoselectionpanel",GeoNetwork.editor.LogoSelectionPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.NewMetadataPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,isTemplate:"n",singleSelect:true,layout:"anchor"},editor:undefined,combo:undefined,getGroupUrl:undefined,groupStore:undefined,catalogue:undefined,tplStore:undefined,selectedGroup:undefined,selectedTpl:undefined,isChild:undefined,filter:undefined,createBt:undefined,validate:function(){if(this.selectedGroup!==undefined&&this.selectedTpl!==undefined){this.createBt.setDisabled(false)
}else{this.createBt.setDisabled(true)
}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
var checkboxSM,colModel;
this.createBt=new Ext.Button({text:OpenLayers.i18n("create"),iconCls:"addIcon",ctCls:"gn-bt-main",disabled:true,handler:function(){this.catalogue.metadataEdit(this.selectedTpl,true,this.selectedGroup,this.isChild,this.isTemplate);
this.ownerCt.hide()
},scope:this});
this.buttons=[this.createBt,{text:OpenLayers.i18n("cancel"),iconCls:"cancel",handler:function(){this.ownerCt.hide()
},scope:this}];
GeoNetwork.editor.NewMetadataPanel.superclass.initComponent.call(this);
this.groupStore=GeoNetwork.data.GroupStore(this.getGroupUrl);
var cmp=[];
if(!this.selectedTpl){this.tplStore=GeoNetwork.Settings.mdStore?new GeoNetwork.Settings.mdStore():new GeoNetwork.data.MetadataResultsFastStore();
this.tplStore.setDefaultSort("displayOrder");
checkboxSM=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:""});
var tplDescription=function(value,p,record){return String.format('<span class="tplTitle">{0}</span><div class="tplDesc">{1}</div>',record.data.title,record.data["abstract"])
};
var tplType=function(value,p,record){var label=OpenLayers.i18n(record.data.type)||"";
if(record.data.spatialRepresentationType){label+=" / "+OpenLayers.i18n(record.data.spatialRepresentationType)
}return String.format("{0}",label)
};
colModel=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[checkboxSM,{header:OpenLayers.i18n("metadatatype"),renderer:tplType,dataIndex:"type"},{id:"title",header:OpenLayers.i18n("tplTitle"),renderer:tplDescription,dataIndex:"title"},{header:"Schema",dataIndex:"schema"},{header:"Order",hidden:true,dataIndex:"displayOrder"}]});
var grid=new Ext.grid.GridPanel({border:false,anchor:"100% -30",store:this.tplStore,colModel:colModel,sm:checkboxSM,autoExpandColumn:"title"});
grid.getSelectionModel().on("rowselect",function(sm,rowIndex,r){if(sm.getCount()!==0){this.selectedTpl=r.data.id
}else{this.selectedTpl=undefined
}this.validate()
},this);
grid.getStore().on("load",function(store){grid.getSelectionModel().selectFirstRow();
grid.getView().focusEl.focus()
},grid);
cmp.push(grid);
this.catalogue.search({E_template:"y"},null,null,1,true,this.tplStore,null)
}this.combo=new Ext.form.ComboBox({name:"E_group",mode:"local",anchor:"100%",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:this.groupStore,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+GeoNetwork.Util.getCatalogueLang(OpenLayers.Lang.getCode())+"]}</div></tpl>",listeners:{select:function(field,record,idx){this.selectedGroup=record.get("id");
this.validate()
},scope:this}});
cmp.push(this.combo);
cmp.push({xtype:"textfield",name:"isTemplate",hidden:true,value:this.isTemplate});
this.add(cmp);
this.groupStore.load({callback:function(){this.groupStore.each(function(record){if((record.get("id")=="-1")||(record.get("id")=="0")||(record.get("id")=="1")){this.remove(record)
}},this.groupStore);
if(this.groupStore.getCount()>0){var recordSelected=this.groupStore.getAt(0);
if(recordSelected){this.selectedGroup=recordSelected.get("id");
this.combo.setValue(recordSelected.data.label[GeoNetwork.Util.getCatalogueLang(OpenLayers.Lang.getCode())]);
this.validate()
}}},scope:this})
}});
Ext.reg("gn_editor_newmetadatapanel",GeoNetwork.editor.NewMetadataPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.GeoPublisherPanel=Ext.extend(Ext.form.FormPanel,{border:false,serviceUrl:undefined,itemSelector:null,geoserverStore:undefined,loadingMask:null,metadataId:null,metadataUuid:null,metadataTitle:null,fileName:null,layerName:null,accessStatus:null,nodeId:null,geoPublicationMap:null,geoPublicationMapPanel:null,geoPublicationTb:null,layers:null,extent:null,stylerBt:null,publishBt:null,unpublishBt:null,checkBt:null,protocols:{wms:{checked:true,label:"OGC:WMS"},wfs:{checked:false,label:"OGC:WFS"},wcs:{checked:false,label:"OGC:WCS"}},addOnLineSourceBt:null,addOnLineSourceMenu:null,enableStyler:false,statusBar:null,layerPreviewName:"DatasetPreview",initComponent:function(){var panel=this;
var record=Ext.data.Record.create([{name:"id"},{name:"name"},{name:"adminUrl"},{name:"wmsUrl"},{name:"wfsUrl"},{name:"wcsUrl"},{name:"stylerUrl"},{name:"namespacePrefix"}]);
this.geoserverStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:panel.serviceUrl+"?action=LIST",method:"GET"}),baseParams:{action:"LIST"},reader:new Ext.data.XmlReader({record:"node",id:"id"},record),sortInfo:{field:"name"}});
this.publishBt=new Ext.Button({text:OpenLayers.i18n("publish"),tooltip:OpenLayers.i18n("publishTooltip"),iconCls:"addVector",handler:function(){this.statusBar.setText("");
this.loadingMask.show();
Ext.Ajax.request({url:panel.serviceUrl,params:{metadataId:this.metadataId,metadataUuid:this.metadataUuid,metadataTitle:this.metadataTitle,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"CREATE"},method:"GET",success:function(result,request){if(result.responseText.indexOf("OutOfMemoryError")!==-1){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("outOfMemoryError"));
this.loadingMask.hide();
return
}var root=result.responseXML.getElementsByTagName("Exception").item(0);
if(root!==null){this.statusBar.setText(OpenLayers.i18n("publishError")+OpenLayers.i18n("publishErrorCode")+root.getAttribute("status"));
this.loadingMask.hide();
return
}this.statusBar.setText(OpenLayers.i18n("publishSuccess"));
this.updatePrivileges(1);
this.addLayer(this.layerPreviewName,this.layerName);
this.statusBar.setText(this.statusBar.text+OpenLayers.i18n("publishLayerAdded"));
this.loadingMask.hide()
},failure:function(result,request){this.statusBar.setText(OpenLayers.i18n("publishError"));
this.loadingMask.hide()
},scope:this})
},scope:this});
this.unpublishBt=new Ext.Button({text:OpenLayers.i18n("unpublish"),tooltip:OpenLayers.i18n("unpublishTooltip"),iconCls:"delVector",handler:function(){this.statusBar.setText("");
this.cleanLayerPreview();
Ext.Ajax.request({url:panel.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"DELETE"},method:"GET",success:function(result,request){this.statusBar.setText(OpenLayers.i18n("unpublishSuccess"));
this.updatePrivileges(0)
},failure:function(result,request){this.statusBar.setText(OpenLayers.i18n("unpublishError"))
},scope:this})
},scope:this});
this.checkBt=new Ext.Button({text:OpenLayers.i18n("check"),iconCls:"connect",listeners:{click:function(){this.statusBar.setText("");
Ext.Ajax.request({url:panel.serviceUrl,params:{metadataId:this.metadataId,nodeId:this.nodeId,file:this.fileName,access:this.accessStatus,action:"GET"},method:"GET",success:function(result,request){var root=result.responseXML.getElementsByTagName("Exception").item(0);
if(root!==null){var status=root.getAttribute("status");
this.statusBar.setText(OpenLayers.i18n("errorDatasetNotFound")+status);
if(status.indexOf("No vector layer")!==-1||status.indexOf("404")!==-1){this.updatePrivileges(0)
}else{this.updatePrivileges()
}return
}this.statusBar.setText(OpenLayers.i18n("datasetFound"));
this.updatePrivileges(1);
this.addLayer(this.layerPreviewName,this.layerName)
},failure:function(result,request){this.statusBar.setText(OpenLayers.i18n("checkFailure"));
this.updatePrivileges()
},scope:this})
},scope:this}});
this.addOnLineSourceBt={text:OpenLayers.i18n("addOnlineSource"),tooltip:"",iconCls:"processMetadata",handler:function(){var node=this.geoserverStore.getById(this.nodeId);
this.fireEvent("addOnLineSource",this,node,this.protocols)
},scope:this};
var items=[];
for(p in this.protocols){if(this.protocols.hasOwnProperty(p)){var item=this.protocols[p];
items.push({text:item.label,canActivate:false,hideOnClick:false,checked:item.checked,checkHandler:this.protocolChecked,scope:item})
}}items.push("-",this.addOnLineSourceBt);
this.addOnLineSourceMenu=new Ext.Button({iconCls:"processMetadata",text:OpenLayers.i18n("addOnlineSourceTitle"),tooltip:OpenLayers.i18n("addOnlineSourceTT"),menu:new Ext.menu.Menu({items:items})});
this.stylerBt=new Ext.Button({text:OpenLayers.i18n("Style"),iconCls:"styler",id:"stylerBt",tooltip:"",handler:function(){var node=this.geoserverStore.getById(this.nodeId);
var url=node.get("stylerUrl")+"?namespace="+node.get("namespacePrefix")+"&layer="+node.get("namespacePrefix")+":"+this.layerName;
window.open(url,"","toolbar=no,menubar=no,width=600,height=500")
},scope:this});
this.geoPublicationTb=new Ext.Toolbar({items:[this.getGeoserverCombo(),this.checkBt,this.publishBt,this.unpublishBt,this.addOnLineSourceMenu,this.stylerBt]});
this.statusBar=new Ext.form.Label({id:"statusBar",html:OpenLayers.i18n("statusInformation")});
var tb=new Ext.Toolbar({items:[this.statusBar]});
this.geoserverStore.load({add:false});
this.tbar=this.geoPublicationTb;
this.bbar=tb;
this.items=this.getGeoPublicationMapPanel();
this.addEvents("addOnLineSource");
GeoNetwork.editor.GeoPublisherPanel.superclass.initComponent.call(this);
this.on("resize",function(el,w,h){el.geoPublicationMapPanel.setSize(w,h)
});
if(!this.loadingMask){this.loadingMask=new Ext.LoadMask(Ext.getBody(),{msg:OpenLayers.i18n("publishing")})
}},getGeoPublicationMapPanel:function(){var options={projection:GeoNetwork.map.PROJECTION,theme:null,maxExtent:GeoNetwork.map.EXTENT};
var map=new OpenLayers.Map(options),i;
this.geoPublicationMapPanel=new GeoExt.MapPanel({id:"mapPanel",layers:GeoNetwork.map.BACKGROUND_LAYERS||[],map:map,width:this.width,height:this.height});
return this.geoPublicationMapPanel
},addLayer:function(title,name){var map=Ext.getCmp("mapPanel").map;
var extent=new OpenLayers.Bounds.fromArray(this.extent);
if(GeoNetwork.map.PROJECTION!=="EPSG:4326"){extent.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection(GeoNetwork.map.PROJECTION))
}map.zoomToExtent(extent||GeoNetwork.map.EXTENT);
this.cleanLayerPreview();
var layer=new OpenLayers.Layer.WMS(title,this.geoserverStore.getById(this.nodeId).get("wmsUrl"),{transparent:"true",layers:name},{singleTile:true});
map.addLayer(layer)
},cleanLayerPreview:function(){var map=Ext.getCmp("mapPanel").map;
var currentLayers=map.getLayersByName(this.layerPreviewName);
if(currentLayers.length>0){currentLayers[0].destroy()
}},getGeoserverCombo:function(){return{xtype:"combo",tpl:'<tpl for="."><div ext:qtip="{name}. {adminUrl}" class="x-combo-list-item">{name}</div></tpl>',store:this.geoserverStore,displayField:"name",autoSelect:true,forceSelection:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectANode"),id:"geoserverNode",listeners:{select:function(combo,record,index){this.nodeId=record.get("id");
this.cleanLayerPreview();
this.enableStyler=(record.get("stylerUrl")===""?false:true);
this.checkBt.fireEvent("click")
},scope:this}}
},setRef:function(id,uuid,title,fileName,accessStatus){this.metadataId=id;
this.metadataUuid=uuid;
this.metadataTitle=title;
this.fileName=fileName;
this.accessStatus=accessStatus;
if(this.fileName.indexOf("jdbc")!==-1){this.layerName=this.fileName.substr(this.fileName.indexOf("#")+1,this.fileName.length)
}else{if(this.accessStatus==="fileOrUrl"){var from=this.fileName.lastIndexOf("/")+1;
var to=this.fileName.lastIndexOf(".");
this.layerName=this.fileName.substr(from,to-from)
}else{this.layerName=this.fileName.substr(0,this.fileName.indexOf("."))
}}this.cleanLayerPreview();
this.updatePrivileges();
if(this.nodeId!==null){this.checkBt.fireEvent("click")
}},protocolChecked:function(item,checked){this.checked=checked
},updatePrivileges:function(step){if(this.nodeId===null){this.checkBt.disable()
}else{this.checkBt.enable()
}this.publishBt.disable();
this.unpublishBt.disable();
this.addOnLineSourceMenu.disable();
this.stylerBt.disable();
switch(step){case 0:this.publishBt.enable();
break;
case 1:this.publishBt.enable();
this.unpublishBt.enable();
this.addOnLineSourceMenu.enable();
if(this.fileName.indexOf("tif")!==-1||!this.enableStyler){this.stylerBt.disable()
}else{this.stylerBt.enable()
}break
}}});
Ext.reg("gn_editor_geopublisherpanel",GeoNetwork.editor.GeoPublisherPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.SuggestionsPanel=Ext.extend(Ext.Panel,{defaultConfig:{border:false,frame:false,iconCls:"suggestionIcon",title:undefined,collapsible:true,collapsed:true},metadataId:undefined,processName:undefined,processParams:undefined,processParametersWindow:undefined,catalogue:undefined,editor:undefined,store:undefined,clear:function(){try{this.store.removeAll()
}catch(e){}},reload:function(e,id){this.metadataId=id||this.metadataId;
if(this.collapsed){return
}this.store.reload({params:{id:this.metadataId}})
},runSuggestedProcess:function(){if(this.processName){if(this.processParams){this.generateForm()
}else{var action=this.catalogue.services.mdProcessing+"?id="+this.metadataId+"&process="+this.processName;
this.run(action)
}}},run:function(action){this.editor.process(action);
if(this.processParametersWindow){this.processParametersWindow.hide();
this.processParametersWindow.destroy();
this.processParametersWindow=undefined
}},selectionChangeEvent:function(dv,selections){var records=dv.getRecords(selections);
if(records[0]){this.getBottomToolbar().setDisabled(false);
this.processName=records[0].get("name");
this.processParams=records[0].get("params")
}else{this.getBottomToolbar().setDisabled(true);
this.processName=undefined;
this.processParams=undefined
}},generateForm:function(){this.processParametersWindow=undefined;
if(!this.processParametersWindow){var processParametersPanel=new Ext.form.FormPanel({defaultType:"textfield",items:[{name:"id",allowBlank:false,hidden:true,value:this.metadataId},{name:"process",allowBlank:false,hidden:true,value:this.processName}],buttons:[{text:OpenLayers.i18n("process"),iconCls:"suggestionRunIcon",handler:function(){if(processParametersPanel.getForm().isValid()){var action=this.catalogue.services.mdProcessing+"?"+processParametersPanel.getForm().getValues(true);
this.run(action)
}},scope:this},{text:OpenLayers.i18n("reset"),iconCls:"cancel",handler:function(){processParametersPanel.getForm().reset()
}}]});
var config=Ext.util.JSON.decode(this.processParams),xtype,defaultValue="",hide=false,c;
for(c in config){if(config.hasOwnProperty(c)){if(config[c].type==="boolean"){xtype="checkbox"
}else{xtype="textfield"
}if(c==="gurl"&&this.catalogue.URL){defaultValue=this.catalogue.URL;
hide=true
}else{if(c==="lang"&&this.catalogue.LANG){defaultValue=this.catalogue.LANG;
hide=true
}else{hide=false;
defaultValue=config[c].defaultValue
}}processParametersPanel.add({xtype:xtype,name:c,fieldLabel:OpenLayers.i18n(this.processName+c),hidden:hide,value:defaultValue})
}}this.processParametersWindow=new Ext.Window({title:OpenLayers.i18n("processParametersWindow"),width:300,height:300,layout:"fit",modal:true,items:processParametersPanel,closeAction:"destroy",constrain:true,iconCls:"suggestionIcon"})
}this.processParametersWindow.show()
},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.title=OpenLayers.i18n("suggestions");
this.tools=[{id:"refresh",handler:function(e,toolEl,panel,tc){panel.reload(panel,panel.metadataId)
}}];
this.bbar=new Ext.Toolbar({disabled:true,items:[{text:OpenLayers.i18n("applySelected"),iconCls:"suggestionRunIcon",handler:this.runSuggestedProcess,scope:this}]});
var tpl=new Ext.XTemplate('<ul><tpl for=".">','<li class="suggestion" title="{name}">{desc}','<span class="suggestion-{operational}"></span></li>',"</tpl></ul>");
this.store=new GeoNetwork.data.SuggestionStore(this.catalogue.services.mdSuggestion,{action:"analyze",id:this.metadataId},false);
var grid=new Ext.DataView({store:this.store,tpl:tpl,singleSelect:true,autoHeight:true,loadingText:"...",selectedClass:"suggestion-selected",overClass:"suggestion-over",itemSelector:"li.suggestion",emptyText:OpenLayers.i18n("noSuggestion"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});
GeoNetwork.editor.SuggestionsPanel.superclass.initComponent.call(this);
this.add(grid);
this.editor.on("editorClosed",this.clear,this);
this.editor.on("metadataUpdated",this.reload,this);
this.on("expand",this.reload)
}});
Ext.reg("gn_editor_suggestionspanel",GeoNetwork.editor.SuggestionsPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.ThumbnailPanel=Ext.extend(Ext.Panel,{title:undefined,metadataId:undefined,versionId:undefined,setThumbnail:undefined,unsetThumbnail:undefined,getThumbnail:undefined,uploadForm:undefined,idField:undefined,versionField:undefined,thumbnail:undefined,editor:undefined,dataView:undefined,store:undefined,thumbnailUploadWindow:undefined,addButton:undefined,delButton:undefined,defaultConfig:{border:false,frame:false,iconCls:"thumbnailIcon",collapsible:true,collapsed:false,autoScroll:true},clear:function(){try{this.store.removeAll()
}catch(e){}},reload:function(e,id,schema,version){this.metadataId=id||this.metadataId;
this.versionId=version||this.metadataId;
if(this.collapsed){return
}this.idField.setValue(this.metadataId);
this.versionField.setValue(this.versionId);
this.store.reload({params:{id:this.metadataId}})
},uploadThumbnail:function(){if(!this.thumbnailUploadWindow){this.thumbnailUploadWindow=new Ext.Window({title:OpenLayers.i18n("thumbnailUploadWindow"),width:300,height:300,layout:"fit",modal:true,items:this.uploadForm,closeAction:"hide",constrain:true,iconCls:"thumbnailAddIcon"})
}this.thumbnailUploadWindow.show()
},removeThumbnail:function(){var panel=this,url=this.unsetThumbnail+"?id="+this.metadataId+"&version="+this.versionId+"&type="+(this.thumbnail==="thumbnail"?"small":"large");
OpenLayers.Request.GET({url:url,success:function(response){panel.editor.init(panel.metadataId)
},failure:function(response){}})
},selectionChangeEvent:function(dv,selections){var records=selections?dv.getRecords(selections):[],allInternal=this.dataView.getStore().query("desc",/thumbnail|large_thumbnail/).length==2;
if(records[0]){this.thumbnail=records[0].get("desc");
if(this.thumbnail==="thumbnail"||this.thumbnail==="large_thumbnail"){this.delButton.setDisabled(false)
}else{this.delButton.setDisabled(true)
}}else{this.delButton.setDisabled(true);
this.thumbnail=undefined
}this.addButton.setDisabled(allInternal)
},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.title=OpenLayers.i18n("thumbnails");
this.tools=[{id:"refresh",handler:function(e,toolEl,panel,tc){panel.reload(panel,panel.metadataId)
}}];
var tpl=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="thumbnail">','<img class="thumb-small" src="{href}" title="{desc}"><br/>',"<span>{desc}</span>","</li>","</tpl>","</ul>");
this.addButton=new Ext.Button({text:OpenLayers.i18n("addThumbnail"),iconCls:"thumbnailAddIcon",handler:this.uploadThumbnail,scope:this});
this.delButton=new Ext.Button({text:OpenLayers.i18n("removeSelected"),iconCls:"thumbnailDelIcon",disabled:true,handler:this.removeThumbnail,scope:this});
this.bbar=new Ext.Toolbar({items:[this.addButton,this.delButton]});
this.store=new GeoNetwork.data.MetadataThumbnailStore(this.getThumbnail,{id:this.metadataId});
this.store.on("load",function(){this.dataView.fireEvent("selectionchange",this)
},this);
this.idField=new Ext.form.TextField({xtype:"textfield",name:"id",value:this.metadataId,hidden:true});
this.versionField=new Ext.form.TextField({name:"version",value:this.versionId,hidden:true});
var tip=new Ext.slider.Tip({getText:function(thumb){return String.format("<b>{0} px</b>",thumb.value)
}});
this.uploadForm=new Ext.form.FormPanel({fileUpload:true,items:[this.idField,this.versionField,{xtype:"textfield",name:"scalingDir",value:"width",hidden:true},{xtype:"textfield",name:"smallScalingDir",value:"width",hidden:true},{xtype:"fileuploadfield",emptyText:OpenLayers.i18n("selectImage"),fieldLabel:OpenLayers.i18n("image"),name:"fname",allowBlank:false,buttonText:"",buttonCfg:{iconCls:"thumbnailAddIcon"}},{xtype:"radio",checked:true,fieldLabel:"Type",boxLabel:OpenLayers.i18n("large"),name:"type",inputValue:"large"},{xtype:"radio",fieldLabel:"",boxLabel:OpenLayers.i18n("small"),name:"type",inputValue:"small"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("scalingFactor"),name:"scalingFactor",value:1000,minValue:400,maxValue:1800,increment:200},{xtype:"checkbox",checked:true,hideLabel:true,fieldLabel:"",labelSeparator:"",boxLabel:OpenLayers.i18n("createSmall"),name:"createSmall",value:"true"},{xtype:"sliderfield",fieldLabel:OpenLayers.i18n("smallScalingFactor"),name:"smallScalingFactor",value:180,minValue:100,maxValue:220,increment:20}],buttons:[{text:OpenLayers.i18n("upload"),formBind:true,iconCls:"thumbnailGoIcon",scope:this,handler:function(){if(this.uploadForm.getForm().isValid()){var panel=this;
this.uploadForm.getForm().submit({url:this.setThumbnail,waitMsg:OpenLayers.i18n("uploading"),success:function(fp,o){panel.editor.init(panel.metadataId);
panel.thumbnailUploadWindow.hide()
}})
}}},{text:OpenLayers.i18n("reset"),iconCls:"cancel",scope:this,handler:function(){this.uploadForm.getForm().reset()
}}]});
GeoNetwork.editor.ThumbnailPanel.superclass.initComponent.call(this);
this.dataView=new Ext.DataView({autoHeight:true,autoWidth:true,store:this.store,tpl:tpl,singleSelect:true,selectedClass:"thumbnail-selected",overClass:"thumbnail-over",itemSelector:"li.thumbnail",emptyText:OpenLayers.i18n("noimages"),listeners:{selectionchange:this.selectionChangeEvent,scope:this}});
this.add(this.dataView);
if(this.metadataId){this.reload(this,this.metadataId)
}this.editor.on("editorClosed",this.clear,this);
this.editor.on("metadataUpdated",this.reload,this);
this.on("expand",this.reload)
}});
Ext.reg("gn_editor_thumbnailpanel",GeoNetwork.editor.ThumbnailPanel);
Ext.namespace("GeoNetwork.editor");
GeoNetwork.editor.ValidationPanel=Ext.extend(Ext.Panel,{title:undefined,editor:undefined,metadataId:undefined,serviceUrl:undefined,store:undefined,defaultConfig:{border:false,frame:false,collapsible:true,collapsed:true,iconCls:"validateMetadata",cls:"validatePanel"},validate:function(){this.editor.validate(function(){this.updateValidationReport()
}.bind(this))
},updateValidationReport:function(){if(this.collapsed){this.toggleCollapse()
}this.reload(this)
},clear:function(){if(this.store.data){this.store.removeAll()
}},reload:function(e,id){this.metadataId=id||this.metadataId;
if(this.collapsed){return
}this.store.reload({params:{id:this.metadataId}})
},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.title=OpenLayers.i18n("validationReport");
this.tools=[{id:"refresh",handler:function(e,toolEl,panel,tc){panel.reload(panel,panel.metadataId)
}}];
GeoNetwork.editor.ValidationPanel.superclass.initComponent.call(this);
this.store=new GeoNetwork.data.ValidationRuleStore(this.serviceUrl,{id:this.metadataId},true);
var xg=Ext.grid;
var groupTpl=function(value,p,record){var rules=record.store.query("group",record.data.group);
return String.format("{0} ({1} {2})",OpenLayers.i18n(record.data.group),rules.getCount(),(rules.getCount()>1?OpenLayers.i18n("rules"):OpenLayers.i18n("rule")))
};
var tpl=function(value,p,record){return String.format('<h3 title="{2}">{0} {1}</h3><div>{3}</div>',record.data.statusIcon,record.data.title,record.data.details,record.data.msg)
};
var colModel=new Ext.grid.ColumnModel({defaults:{width:120,sortable:true},columns:[{id:"group",header:OpenLayers.i18n("group"),width:60,sortable:true,hidden:true,renderer:groupTpl,dataIndex:"group"},{header:OpenLayers.i18n("status"),width:18,resizable:false,sortable:true,hidden:true,dataIndex:"statusIcon"},{header:OpenLayers.i18n("title"),hidden:false,renderer:tpl,dataIndex:"title"}]});
var grid=new xg.GridPanel({store:this.store,colModel:colModel,loadMask:true,view:new Ext.grid.GroupingView({forceFit:true,groupRenderer:groupTpl}),frame:false,height:300,autoWidth:true});
this.add(grid);
this.editor.on("editorClosed",this.clear,this);
this.editor.on("metadataUpdated",this.reload,this);
this.on("expand",this.reload)
}});
Ext.reg("gn_editor_validationpanel",GeoNetwork.editor.ValidationPanel);
Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.AdminTools={showImportMetadataWindow:function(metadataType,windowTitle){var metadataPanel=new GeoNetwork.admin.MetadataInsertPanel({metadataType:metadataType});
var newMetadataWindow=new Ext.Window({title:windowTitle||OpenLayers.i18n("importMetadata"),width:450,height:450,layout:"fit",modal:true,items:metadataPanel,closeAction:"destroy",constrain:true,iconCls:"addIcon"});
newMetadataWindow.show()
}};
Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.HarvesterPanel=Ext.extend(Ext.Panel,{border:false,frame:false,layout:"border",height:800,catalogue:undefined,harvesterStore:undefined,harvesterTplMarkup:["Information: {site_name}<br/>","Last run: {info_lastrun}<br/>",'<tpl if="info_result_total">',"Total: {info_result_total}<br/>","Added: {info_result_added}<br/>","Removed: {info_result_removed}<br/>","Schema unknwon: {info_result_unknowSchema}<br/>","</tpl>"],harvesterTpl:undefined,xmlTpl:undefined,harvesterGrid:undefined,currentHarvester:undefined,initComponent:function(){GeoNetwork.admin.HarvesterPanel.superclass.initComponent.call(this);
panel=this;
this.createGrid();
this.harvesterTpl=new Ext.XTemplate(this.harvesterTplMarkup);
this.xmlTpl=new GeoNetwork.Templates().getHarvesterTemplate();
this.harvesterGrid.getSelectionModel().on("rowselect",function(sm,rowIdx,r){var detailPanel=Ext.getCmp("harvesterDetailPanel");
this.harvesterTpl.overwrite(detailPanel.body,r.data)
},this);
var infoPanel={id:"harvesterDetailPanel",region:"east",split:true,minWidth:200,width:200,collapsible:true,hideCollapseTool:true,collapseMode:"mini",bodyStyle:{background:"#ffffff",padding:"7px"},html:"Please select a harvester to see additional details."};
this.add(infoPanel);
var editorPanel={id:"harvesterEditorPanel",region:"south",title:"Harvester configuration",split:true,autoScroll:true,minHeigth:400,items:[new Ext.FormPanel({border:false,frame:false,maxHeight:600,id:"harvesterEditorForm",items:[this.getHarvesterTypeField(),this.getSiteFields("geonetwork"),this.getOptionsFields("geonetwork")],buttons:[{text:"Save",listeners:{click:function(){var form=Ext.getCmp("harvesterEditorForm").getForm();
if(form.isValid()){form.updateRecord(this.currentHarvester);
var xml=this.xmlTpl.apply(this.currentHarvester.data);
this.addHarvester(this.catalogue.services.harvestingAdd,xml)
}},scope:panel}}]})]};
this.add(editorPanel)
},harvesterType:[["geonetwork","GeoNetwork"],["geonetwork20","GeoNetwork 2.0"],["webdav","webdav"],["csw","csw"],["ogcwxs","OGC WxS"],["thredds","thredds"],["z3950","z3950"],["oaipmh","oaipmh"],["metadatafragments","metadatafragments"],["arcsde","arcsde"],["filesystem","filesystem"]],switchMode:function(type){this.switchElement("site_servlet",false);
this.switchElement("site_port",false);
this.switchElement("site_host",false);
this.switchElement("site_url",false);
if(type=="geonetwork"||type=="geonetwork20"){this.switchElement("site_servlet",true);
this.switchElement("site_port",true);
this.switchElement("site_host",true)
}else{this.switchElement("site_url",true)
}if(type=="ogcwxs"){}},switchElement:function(el,on){var e=Ext.getCmp(el);
var form=Ext.getCmp("harvesterEditorForm");
var f=form.getForm().findField(el);
if(on){f.container.up("div.x-form-item").show();
e.enable()
}else{f.container.up("div.x-form-item").hide();
e.disable()
}form.doLayout(false,true)
},getHarvesterTypeField:function(){return new Ext.form.ComboBox({id:"type",name:"type",mode:"local",triggerAction:"all",fieldLabel:"Harvester type",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.harvesterType}),valueField:"id",displayField:"name",listeners:{change:function(field,newValue,oldValue){this.switchMode(newValue)
},scope:this}})
},ogcwxsType:[["WMS1.0.0","WMS 1.0.0"],["WMS1.1.1","WMS 1.1.1"],["WFS1.0.0","WFS 1.0.0"],["WFS1.1.0","WFS 1.1.0"],["WCS1.0.0","WCS 1.0.0"],["WPS0.4.0","WPS 0.4.0"],["WPS1.0.0","WPS 1.0.0"]],getSiteFields:function(type){var items=[];
var id=new Ext.form.TextField({id:"id",name:"id",mode:"local",hidden:true});
var name=new Ext.form.TextField({name:"site_name",mode:"local",fieldLabel:"Name"});
items.push(id,name);
var url=new Ext.form.TextField({id:"site_url",name:"site_url",mode:"local",fieldLabel:"URL"});
var ogctype=new Ext.form.ComboBox({id:"site_ogctype",name:"site_ogctype",mode:"local",fieldLabel:"Type of service",store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.ogcwxsType}),valueField:"id",displayField:"name"});
items.push(url,ogctype);
var servlet=new Ext.form.TextField({id:"site_servlet",name:"site_servlet",mode:"local",fieldLabel:"Servlet"});
var host=new Ext.form.TextField({id:"site_host",name:"site_host",mode:"local",fieldLabel:"Host"});
var port=new Ext.form.TextField({id:"site_port",name:"site_port",mode:"local",fieldLabel:"Port"});
items.push(host,port,servlet);
var site_account_use=new Ext.form.Checkbox({id:"site_account_use",name:"site_account_use",mode:"local",fieldLabel:"Use account"});
var site_account_username=new Ext.form.TextField({id:"site_account_username",name:"site_account_username",mode:"local",fieldLabel:"Username"});
var site_account_password=new Ext.form.TextField({id:"site_account_password",name:"site_account_password",mode:"local",fieldLabel:"Password"});
items.push(site_account_use,site_account_username,site_account_password);
return{xtype:"fieldset",title:"Harvester main information",collapsible:true,items:items}
},getOptionsFields:function(){var items=[];
var options_createThumbnails=new Ext.form.Checkbox({id:"options_createthumbnails",name:"options_createthumbnails",mode:"local",fieldLabel:"Create thumbnail for WMS layers"});
var options_useLayer=new Ext.form.Checkbox({id:"options_uselayer",name:"options_uselayer",mode:"local",fieldLabel:"Create metadata for layer elements using GetCapabilities information"});
var options_uselayermd=new Ext.form.Checkbox({id:"options_uselayermd",name:"options_uselayermd",mode:"local",fieldLabel:"Create metadata for layer elements using MetadataURL attributes (if existing, if not use GetCapabilities)"});
var options_lang=new Ext.form.TextField({id:"options_lang",name:"options_lang",mode:"local",defaultValue:"eng",fieldLabel:"Language"});
var options_topic=new Ext.form.TextField({id:"options_topic",name:"options_topic",mode:"local",defaultValue:"",fieldLabel:"Topic category"});
items.push(options_createThumbnails,options_useLayer,options_uselayermd,options_lang,options_topic);
var options_oneRunOnly=new Ext.form.Checkbox({id:"options_onerunonly",name:"options_onerunonly",mode:"local",fieldLabel:"One run only"});
var options_every=new Ext.form.TextField({id:"options_every",name:"options_every",mode:"local",defaultValue:"90",fieldLabel:"Every"});
items.push(options_oneRunOnly,options_every);
return{xtype:"fieldset",title:"Harvester options",collapsible:true,items:items}
},getPrivilegesFields:function(){return
},getCategoriesFields:function(){return
},createEditor:function(){var Harvester=Ext.data.Record.create([{name:"id",mapping:"node/@id"},{name:"occupation"}])
},createGrid:function(){var sm=new Ext.grid.CheckboxSelectionModel({singleSelect:true,header:"",listeners:{selectionchange:function(){Ext.getCmp("harvestEditBt").setDisabled(this.getSelections().length<1);
Ext.getCmp("harvestRemoveBt").setDisabled(this.getSelections().length<1);
Ext.getCmp("harvestActivateBt").setDisabled(this.getSelections().length<1);
Ext.getCmp("harvestDesactivateBt").setDisabled(this.getSelections().length<1);
Ext.getCmp("harvestRunBt").setDisabled(this.getSelections().length<1)
}}});
this.harvesterGrid=new Ext.grid.GridPanel({store:this.harvesterStore,split:true,id:"harvesterGrid",region:"center",sm:sm,columns:[sm,{id:"id",header:"id",width:60,sortable:true,dataIndex:"id",hidden:true},{header:"Name",width:125,sortable:true,dataIndex:"site_name"},{header:"Type",width:75,sortable:true,dataIndex:"type"},{header:"Status",width:80,sortable:true,dataIndex:"site_status"},{header:"Running",width:80,sortable:true,dataIndex:"info_running"},{header:"Every",width:80,sortable:true,dataIndex:"options_every"},{header:"Last run",width:160,sortable:true,dataIndex:"info_lastrun"}],stripeRows:true,maxHeight:250,height:250,stateful:true,stateId:"grid",listeners:{rowclick:function(grid,rowIndex,e){var h=this.harvesterGrid.getStore().getAt(rowIndex);
this.currentHarvester=h;
var form=Ext.getCmp("harvesterEditorForm").getForm();
form.loadRecord(h)
},scope:this},buttons:[{text:"Add",listeners:{click:function(){}}},{text:"Activate",id:"harvestActivateBt",disabled:true,listeners:{click:function(){var sel=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();
var params={id:sel.data.id};
this.doAction(this.catalogue.services.harvestingStart,params,this.refreshHarvester,null,null,"Failed to activate the harvester")
},scope:this}},{text:"Desactivate",id:"harvestDesactivateBt",disabled:true,listeners:{click:function(){var sel=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();
var params={id:sel.data.id};
this.doAction(this.catalogue.services.harvestingStop,params,this.refreshHarvester,null,null,"Failed to desactivate the harvester")
},scope:this}},{id:"harvestEditBt",text:"Edit",disabled:true,listeners:{click:function(){},scope:this}},{text:"Run",id:"harvestRunBt",disabled:true,listeners:{click:function(){var sel=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();
var params={id:sel.data.id};
this.doAction(this.catalogue.services.harvestingRun,params,this.refreshHarvester,null,null,"Failed to start the harvester")
},scope:this}},{id:"harvestRemoveBt",text:"Remove",icon:"../images/default/cross.png",disabled:true,listeners:{click:function(){var sel=Ext.getCmp("harvesterGrid").getSelectionModel().getSelected();
Ext.Msg.confirm("Delete ?","Are you sure to delete selected harvester and all its records?",this.removeHarvester,sel.data.id)
},scope:this}},{text:"Refresh",id:"harvestRefreshBt",listeners:{click:function(){this.harvesterGrid.getStore().reload()
},scope:this}}]});
this.add(this.harvesterGrid)
},addHarvester:function(url,xml){var opts={url:url,data:xml};
OpenLayers.Util.applyDefaults(opts,{success:function(response){Ext.Msg.alert("ok",response.responseText)
},failure:function(response){Ext.Msg.alert("Failed",response.responseText)
}});
OpenLayers.Request.POST(opts)
},doAction:function(url,params,onSuccess,onFailure,msgSuccess,msgFailure){OpenLayers.Request.GET({url:url,params:params,success:function(result){if(msgSuccess){Ext.Msg.alert(msgSuccess,result.responseText)
}if(onSuccess){onSuccess(result)
}},failure:function(response){if(msgFailure){Ext.Msg.alert(msgFailure,response.responseText)
}if(onSuccess){onSuccess(response)
}}})
},removeHarvester:function(btn){if(btn=="yes"){var params={id:this};
this.doAction(this.catalogue.services.harvestingRemove,params,this.refreshHarvester,null,null,"Failed to delete the harvester")
}},refreshHarvester:function(){Ext.getCmp("harvestRefreshBt").fireEvent("click")
}});
Ext.reg("gn_admin_harvesterpanel",GeoNetwork.admin.HarvesterPanel);
Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.MetadataInsertPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoScroll:true,autoWidth:true,layout:"border"},store:undefined,view:undefined,uploadForm:undefined,serviceUrl:undefined,ref:undefined,setRef:function(ref){this.ref=ref
},getForm:function(){var groupStore=GeoNetwork.data.GroupStore(catalogue.services.getGroups);
groupStore.load();
this.uploadForm=new Ext.form.FormPanel({region:"center",split:true,errorReader:new Ext.data.XmlReader({record:"response"},["id"]),items:[{xtype:"textfield",hidden:true,name:"insert_mode",value:"0"},{xtype:"textfield",hidden:true,name:"template",value:"s"},{xtype:"textarea",name:"data",fieldLabel:OpenLayers.i18n("xmlData"),allowBlank:false,width:300,height:200},new Ext.form.ComboBox({name:"group",hiddenName:"group",mode:"local",emptyText:OpenLayers.i18n("chooseGroup"),triggerAction:"all",fieldLabel:OpenLayers.i18n("group"),store:groupStore,allowBlank:false,valueField:"id",displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label.'+GeoNetwork.Util.getCatalogueLang(OpenLayers.Lang.getCode())+"]}</div></tpl>"})],buttons:[{text:OpenLayers.i18n("add"),scope:this,iconCls:"thumbnailGoIcon",handler:function(){if(this.uploadForm.getForm().isValid()){this.uploadForm.getForm().submit({url:catalogue.services.mdXMLInsert,scope:this,success:function(fp,action){if(this.ownerCt){this.ownerCt.close()
}},failure:function(response){Ext.Msg.alert(OpenLayers.i18n("failure"),response.responseText)
}})
}}}]});
return this.uploadForm
},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.items=[this.getForm()];
GeoNetwork.admin.MetadataInsertPanel.superclass.initComponent.call(this)
}});
Ext.reg("gn_admin_metadatainsertpanel",GeoNetwork.admin.MetadataInsertPanel);
Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.SubTemplateManagerPanel=Ext.extend(Ext.Panel,{border:false,frame:false,record:undefined,layout:"border",catalogue:undefined,toolbar:undefined,searchPanel:undefined,searchForm:undefined,searchField:undefined,newMetadataWindow:undefined,searchResultGrid:undefined,subTemplateEditor:undefined,subTemplateToolbar:undefined,subTemplateType:undefined,subTemplateTypeStore:undefined,defaultConfig:{defaultViewMode:"simple",height:800,autoWidth:true,layout:"border",iconCls:"subtemplateIcon"},getSubTemplateTypeField:function(){return{xtype:"combo",name:"E__root",mode:"local",title:OpenLayers.i18n("selDirectoryTT"),triggerAction:"all",store:this.subTemplateTypeStore,valueField:"type",tpl:'<tpl for="."><div class="x-combo-list-item" title="{description}">{label} ({type})</div></tpl>',displayField:"label"}
},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
this.subTemplateTypeStore=new GeoNetwork.data.SubTemplateTypeStore(this.catalogue.services.subTemplateType);
this.catalogue.metadataStore=new GeoNetwork.data.MetadataResultsStore();
this.catalogue.editMode=2;
this.catalogue.metadataEditFn=function(metadataId,create,group,child){this.editorPanel.init(metadataId,create,group,child,"s")
}.bind(this);
GeoNetwork.admin.SubTemplateManagerPanel.superclass.initComponent.call(this);
this.initSearch();
this.initEditor();
var searchView={region:"west",split:true,collapsible:true,collapsed:false,hideCollapseTool:true,collapseMode:"mini",autoScroll:true,minWidth:240,width:280,items:[this.searchForm,this.searchResultGrid]};
var editorView={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.editorPanel]};
this.add(searchView);
this.add(editorView);
this.searchField.focus(true)
},search:function(){this.editorPanel.cancel();
this.catalogue.search("searchForm",null,null)
},initSearch:function(){var panel=this;
this.searchField=new GeoNetwork.form.SearchField({name:"E_any",store:this.catalogue.metadataStore,triggerAction:function(scope){scope.record=undefined;
scope.disableToolbar(true);
scope.search()
},scope:panel});
this.searchForm=new Ext.FormPanel({id:"searchForm",border:false,defaults:{width:240,hideLabel:true},items:[this.getSubTemplateTypeField(),{xtype:"textfield",name:"E__isTemplate",hidden:true,value:"s"},this.searchField]});
var events=["afterDelete"];
Ext.each(events,function(e){this.catalogue.on(e,function(){this.search()
},this)
},this);
this.searchResultGrid=new Ext.grid.GridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.catalogue.metadataStore,columns:[{id:"title",header:OpenLayers.i18n("title"),dataIndex:"title"},{id:"uuid",header:"Uuid",dataIndex:"uuid",hidden:true}],autoExpandColumn:"title",listeners:{rowclick:function(grid,rowIndex,e){this.record=grid.getStore().getAt(rowIndex).data;
this.editorPanel.init(this.record.id,false);
this.disableToolbar(false)
},scope:panel},bbar:{items:[{xtype:"button",text:OpenLayers.i18n("add"),tooltip:OpenLayers.i18n("addTplElTT"),iconCls:"addIcon",handler:function(){var metadataType="s";
GeoNetwork.admin.AdminTools.showImportMetadataWindow(metadataType,OpenLayers.i18n("subTemplateImport"))
},scope:this},{text:OpenLayers.i18n("duplicate"),tooltip:OpenLayers.i18n("copyTplElTT"),iconCls:"md-mn-copy",disabled:true,handler:function(){var id=this.record.id;
GeoNetwork.editor.EditorTools.showNewMetadataWindow(this,id,OpenLayers.i18n("duplicate"),false)
},scope:this},{text:OpenLayers.i18n("delete"),tooltip:OpenLayers.i18n("delTplElTT"),iconCls:"md-mn-del",disabled:true,handler:function(){var id=this.record.uuid;
this.catalogue.metadataDelete(id)
},scope:this},{text:OpenLayers.i18n("privileges"),tooltip:OpenLayers.i18n("privTplElTT"),iconCls:"privIcon",disabled:true,handler:function(){var id=this.record.id;
this.catalogue.metadataAdmin(id)
},scope:this}]}})
},disableToolbar:function(disabled){var bbar=this.searchResultGrid.getBottomToolbar();
Ext.each(bbar.items,function(item,idx){if(idx!==0){bbar.get(idx).setDisabled(disabled)
}},bbar)
},initEditor:function(){var disableConfig={collapsed:true,hidden:true};
this.editorPanel=new GeoNetwork.editor.EditorPanel({defaultViewMode:this.defaultViewMode,tbarConfig:{hideTypeMenu:true},utilityPanelConfig:{thumbnailPanel:disableConfig,relationPanel:disableConfig,validationPanel:{collapsed:true},suggestionPanel:disableConfig,helpPanel:{collapsed:false}},catalogue:this.catalogue,utilityPanelCollapsed:true})
},refresh:function(){this.subTemplateTypeStore.load()
}});
Ext.reg("gn_admin_subtemplatemanagerpanel",GeoNetwork.admin.SubTemplateManagerPanel);
Ext.namespace("GeoNetwork.admin");
GeoNetwork.admin.ThesaurusManagerPanel=Ext.extend(Ext.Panel,{defaultConfig:{autoWidth:true,layout:"border",maxResults:50,defaultThesaurusType:"theme"},border:false,frame:false,selectedThesaurus:undefined,layout:"border",catalogue:undefined,toolbar:undefined,thesaurusGrid:undefined,thesaurusStore:undefined,keywordGrid:undefined,createEmptyThesaurusWindow:undefined,createThesaurusFromLocalFileWindow:undefined,createThesaurusFromRemoteFileWindow:undefined,createEmptyThesaurusForm:undefined,createThesaurusFromLocalFileForm:undefined,createThesaurusFromRemoteFileForm:undefined,initComponent:function(){Ext.applyIf(this,this.defaultConfig);
this.thesaurusStore=new GeoNetwork.data.ThesaurusStore({url:this.catalogue.services.getThesaurus});
var Keyword=Ext.data.Record.create([{name:"id"},{name:"value"},{name:"thesaurus"},{name:"definition"},{name:"uri"},{name:"east"},{name:"west"},{name:"south"},{name:"north"}]);
this.keywordStore=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.catalogue.services.searchKeyword,method:"GET"}),baseParams:{pNewSearch:true,pTypeSearch:1,pThesauri:"",pMode:"searchBox",maxResults:this.maxResults},reader:new Ext.data.XmlReader({record:"keyword",id:"id"},Keyword),fields:["id","value","definition","thesaurus","uri","east","west","south","north"],sortInfo:{field:"value"}});
GeoNetwork.admin.ThesaurusManagerPanel.superclass.initComponent.call(this);
this.initThesaurusView();
this.initKeywordView();
var thesaurusView={region:"west",split:true,autoScroll:true,minWidth:280,width:400,items:[this.thesaurusGrid]};
var keywordView={region:"center",split:true,autoScroll:true,minHeigth:400,items:[this.keywordGrid]};
this.add(thesaurusView);
this.add(keywordView)
},initThesaurusView:function(){var panel=this;
var ynValues=[["y"],["n"]];
var thColumnModel=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"title",header:OpenLayers.i18n("ThesaurusName"),dataIndex:"title",editable:false},{id:"filename",header:OpenLayers.i18n("id"),dataIndex:"filename",editable:false},{id:"theme",header:OpenLayers.i18n("Theme"),dataIndex:"theme",editable:false},{id:"type",header:OpenLayers.i18n("Type"),dataIndex:"type",editable:false},{id:"activated",header:OpenLayers.i18n("Activated"),dataIndex:"activated",width:50,editor:new Ext.form.ComboBox({mode:"local",editable:false,typeAhead:true,triggerAction:"all",lazyRender:true,allowBlank:false,listClass:"x-combo-list-small",store:new Ext.data.ArrayStore({id:0,fields:["id"],data:ynValues}),valueField:"id",displayField:"id"})}]});
this.thesaurusGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,border:false,store:this.thesaurusStore,cm:thColumnModel,autoExpandColumn:"title",clicksToEdit:1,listeners:{scope:this,afteredit:function(e){Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusActivate+"?ref="+e.record.data.id+"&activated="+e.record.data.activated,failure:function(){Ext.Msg.alert("Fail")
}})
},dblclick:function(e){this.keywordStore.setBaseParam("pKeyword","*");
this.keywordStore.reload()
}},sm:new Ext.grid.RowSelectionModel({singleSelect:true,listeners:{scope:this,selectionchange:function(smObj){this.updateKeywordGridAndToolbar();
this.updateThesaurusToolbar();
this.updateKeywordToolbar()
}}}),tbar:{disabled:false,enableOverflow:true,items:[{text:OpenLayers.i18n("add"),iconCls:"addIcon",menu:{xtype:"menu",plain:true,items:[{text:OpenLayers.i18n("emptyThesaurus"),scope:this,handler:function(){if(!this.createEmptyThesaurusWindow){this.createEmptyThesaurusWindow=this.getCreateEmptyThesaurusWindow()
}this.createEmptyThesaurusWindow.show(this)
}},{text:OpenLayers.i18n("thesaurusFromFile"),scope:this,handler:function(){if(!this.createThesaurusFromLocalFileWindow){this.createThesaurusFromLocalFileWindow=this.getCreateThesaurusFromLocalFileWindow()
}this.createThesaurusFromLocalFileWindow.show(this)
}},{text:OpenLayers.i18n("thesaurusFromURL"),scope:this,handler:function(){if(!this.createThesaurusFromRemoteFileWindow){this.createThesaurusFromRemoteFileWindow=this.getCreateThesaurusFromRemoteFileWindow()
}this.createThesaurusFromRemoteFileWindow.show(this)
}}]}},{id:"delete_thesaurus_button",disabled:true,text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){OpenLayers.Request.GET({scope:this,url:this.catalogue.services.thesaurusDelete+"?ref="+this.keywordStore.baseParams.pThesauri,success:function(response){this.thesaurusStore.removeAll();
this.thesaurusStore.reload()
},failure:function(response){}})
},scope:this},{id:"download_thesaurus_button",disabled:true,text:OpenLayers.i18n("download"),iconCls:"xmlIcon",handler:function(){location.replace(this.catalogue.services.thesaurusDownload+"?ref="+this.keywordStore.baseParams.pThesauri)
},scope:this}]}})
},initKeywordView:function(){var kwColumnModel=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{id:"id",header:OpenLayers.i18n("id"),dataIndex:"uri",editor:new Ext.form.TextField({allowBlank:false})},{id:"hidden_id",header:OpenLayers.i18n("uri"),dataIndex:"id",hidden:true,editor:new Ext.form.TextField({allowBlank:false})},{id:"value",header:OpenLayers.i18n("label"),dataIndex:"value",editor:new Ext.form.TextField({allowBlank:false})},{id:"definition",header:OpenLayers.i18n("definition"),dataIndex:"definition",editor:new Ext.form.TextField({allowBlank:false})},{id:"west",header:OpenLayers.i18n("xmin"),dataIndex:"west",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"east",header:OpenLayers.i18n("xmax"),dataIndex:"east",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"south",header:OpenLayers.i18n("ymin"),dataIndex:"south",hidden:true,editor:new Ext.form.TextField({allowBlank:true})},{id:"north",header:OpenLayers.i18n("ymax"),dataIndex:"north",hidden:true,editor:new Ext.form.TextField({allowBlank:true})}]});
this.keywordGrid=new Ext.grid.EditorGridPanel({layout:"fit",autoHeight:true,height:500,border:false,store:this.keywordStore,cm:kwColumnModel,autoExpandColumn:"value",sm:new Ext.grid.CellSelectionModel({listeners:{scope:this,selectionchange:function(smObj){this.updateKeywordToolbar()
}}}),listeners:{scope:this,afteredit:function(e){var ref=this.keywordStore.baseParams.pThesauri;
var refType=ref.split(".")[1];
var tokens=e.record.data.uri.split("#");
var namespace=tokens[0];
var newId=tokens[1];
var oldId=newId;
var lang=this.catalogue.lang;
var prefLab=e.record.data.value;
var definition=e.record.data.definition;
var requestPayLoad;
if(e.field==="uri"){oldId=e.originalValue.split("#")[1]
}if(refType==="place"){var south=e.record.data.south;
var north=e.record.data.north;
var west=e.record.data.west;
var east=e.record.data.east;
requestPayLoad="<request><oldid>"+oldId+"</oldid><newid>"+newId+"</newid><lang>"+lang+"</lang><ref>"+ref+"</ref><definition>"+definition+"</definition><namespace>"+namespace+"#</namespace><north>"+north+"</north><south>"+south+"</south><east>"+east+"</east><prefLab>"+prefLab+"</prefLab><west>"+west+"</west><refType>"+refType+"</refType></request>";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail")
},xmlData:requestPayLoad})
}else{requestPayLoad="<request><newid>"+newId+"</newid><refType>"+refType+"</refType><definition>"+definition+"</definition><namespace>"+namespace+"#</namespace><ref>"+ref+"</ref><oldid>"+oldId+"</oldid><lang>"+lang+"</lang><prefLab>"+prefLab+"</prefLab></request>";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptUpdate,failure:function(){Ext.Msg.alert("Fail")
},xmlData:requestPayLoad})
}e.record.commit()
}},tbar:{disabled:true,enableOverflow:true,items:[{id:"add_keyword_button",text:OpenLayers.i18n("add"),iconCls:"addIcon",handler:function(){var RecType=this.keywordGrid.store.recordType;
var newUri="#"+new Date().getTime();
var ref=this.keywordStore.baseParams.pThesauri;
var refType=ref.split(".")[1];
var newId=newUri.split("#")[1];
var lang=this.catalogue.lang;
var prefLab=OpenLayers.i18n("newLabel");
var definition=OpenLayers.i18n("newDefinition");
var requestPayLoad;
if(refType==="place"){var south=-90;
var north=90;
var west=-180;
var east=180;
requestPayLoad="<request><oldid/><newid>"+newId+"</newid><lang>"+lang+"</lang><ref>"+ref+"</ref><definition>"+definition+"</definition><namespace>#</namespace><north>"+north+"</north><south>"+south+"</south><east>"+east+"</east><prefLab>"+prefLab+"</prefLab><west>"+west+"</west><refType>"+refType+"</refType></request>";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail")
},xmlData:requestPayLoad})
}else{requestPayLoad="<request><newid>"+newId+"</newid><refType>"+refType+"</refType><definition>"+definition+"</definition><namespace>#</namespace><ref>"+ref+"</ref><oldid/><lang>"+lang+"</lang><prefLab>"+prefLab+"</prefLab></request>";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptAdd,failure:function(){Ext.Msg.alert("Fail")
},xmlData:requestPayLoad})
}var newRec=new RecType({uri:newUri,value:prefLab,definition:definition,west:-180,east:180,south:-90,north:90});
this.keywordGrid.stopEditing();
this.keywordGrid.store.insert(0,newRec);
this.keywordGrid.startEditing(0,0)
},scope:this},{id:"delete_keyword_button",text:OpenLayers.i18n("delete"),iconCls:"md-mn-del",handler:function(){var selectedCells=this.keywordGrid.getSelectionModel().getSelectedCell();
var rec=this.keywordGrid.store.getAt(selectedCells[0]);
var thesaurus=this.keywordStore.baseParams.pThesauri;
var tokens=rec.data.uri.split("#");
var namespace=tokens[0];
var id=tokens[1];
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusConceptDelete+"?pThesaurus="+thesaurus+"&namespace="+namespace+"%23&id="+id,failure:function(){Ext.Msg.alert("Fail")
}});
this.keywordGrid.store.removeAt(selectedCells[0])
},scope:this},"->",this.getKeyword(),OpenLayers.i18n("maxResults")+" "+OpenLayers.i18n("perThesaurus"),this.getLimitInput()]}})
},updateThesaurusToolbar:function(){var record=this.thesaurusGrid.getSelectionModel().getSelected();
Ext.getCmp("delete_thesaurus_button").setDisabled(!record);
Ext.getCmp("download_thesaurus_button").setDisabled(!record)
},updateKeywordToolbar:function(){var record=this.thesaurusGrid.getSelectionModel().getSelected();
if(record){var thesaurusType=record.data.type;
var isLocal=thesaurusType==="local";
if(isLocal){var selectedCells=this.keywordGrid.getSelectionModel().getSelectedCell();
Ext.getCmp("delete_keyword_button").setDisabled(!selectedCells)
}}},updateKeywordGridAndToolbar:function(){var record=this.thesaurusGrid.getSelectionModel().getSelected();
if(record){this.keywordGrid.getTopToolbar().enable();
var thesaurusTheme=record.data.theme;
var thesaurusType=record.data.type;
var isLocal=thesaurusType==="local";
var thesaurusId=record.data.id;
this.keywordStore.removeAll();
this.keywordStore.baseParams.pThesauri=thesaurusId;
var hidden=(thesaurusTheme!=="place");
this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("east"),hidden);
this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("west"),hidden);
this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("south"),hidden);
this.keywordGrid.getColumnModel().setHidden(this.keywordGrid.getColumnModel().getIndexById("north"),hidden);
for(var i=0;
i<this.keywordGrid.getColumnModel().getColumnCount();
i++){this.keywordGrid.getColumnModel().setEditable(i,isLocal)
}Ext.getCmp("delete_keyword_button").setDisabled(!isLocal);
Ext.getCmp("add_keyword_button").setDisabled(!isLocal)
}else{this.keywordGrid.getTopToolbar().disable()
}},getCreateEmptyThesaurusWindow:function(){var win=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateEmptyThesaurusForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createEmptyThesaurusForm.getForm().isValid()){this.createEmptyThesaurusForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";
this.createEmptyThesaurusForm.bodyCfg.enctype="application/x-www-form-urlencoded";
Ext.Ajax.request({scope:this,url:this.catalogue.services.thesaurusAdd,success:function(){this.thesaurusStore.removeAll();
this.thesaurusStore.reload()
},failure:function(){Ext.Msg.alert("Fail")
},xmlData:"<request><fname>"+Ext.getCmp("empty_thesaurusName").getValue()+"</fname><dname>"+Ext.getCmp("empty_themeCmb").getValue()+"</dname><type>"+Ext.getCmp("empty_thesaurusType").getValue()+"</type></request>"});
win.hide()
}}}]});
return win
},getCreateThesaurusFromLocalFileWindow:function(){var win=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromLocalFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createThesaurusFromLocalFileForm.getForm().isValid()){this.createThesaurusFromLocalFileForm.getForm().getEl().dom.enctype="multipart/form-data";
this.createThesaurusFromLocalFileForm.bodyCfg.enctype="multipart/form-data";
this.createThesaurusFromLocalFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(fp,action){this.thesaurusStore.removeAll();
this.thesaurusStore.reload()
},failure:function(response){Ext.Msg.alert(OpenLayers.i18n("failure"),response.responseText)
}});
win.hide()
}}}]});
return win
},getCreateThesaurusFromRemoteFileWindow:function(){var win=new Ext.Window({width:600,height:200,resizable:false,title:OpenLayers.i18n("thesaurusCreation"),closeAction:"hide",plain:true,bodyStyle:"padding:5px;",modal:true,items:[this.getCreateThesaurusFromRemoteFileForm()],constrain:true,buttons:[{text:OpenLayers.i18n("add"),scope:this,handler:function(){if(this.createThesaurusFromRemoteFileForm.getForm().isValid()){this.createThesaurusFromRemoteFileForm.getForm().getEl().dom.enctype="application/x-www-form-urlencoded";
this.createThesaurusFromRemoteFileForm.bodyCfg.enctype="application/x-www-form-urlencoded";
this.createThesaurusFromRemoteFileForm.getForm().submit({url:this.catalogue.services.thesaurusUpload,scope:this,success:function(response){this.thesaurusStore.removeAll();
this.thesaurusStore.reload()
},failure:function(response){Ext.Msg.alert(OpenLayers.i18n("failure"),response.responseText)
}});
win.hide()
}}}]});
return win
},getCreateEmptyThesaurusForm:function(){this.createEmptyThesaurusForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,items:[{xtype:"textfield",fieldLabel:OpenLayers.i18n("ThesaurusName"),id:"empty_thesaurusName",name:"fname",anchor:"-15"},this.createTypeCombo("empty_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"empty_thesaurusType",name:"type",value:"local",hidden:true,anchor:"-15"}]});
return this.createEmptyThesaurusForm
},getCreateThesaurusFromLocalFileForm:function(){this.createThesaurusFromLocalFileForm=new Ext.form.FormPanel({fileUpload:true,region:"center",autoHeight:true,baseCls:"x-plain",errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),labelWidth:170,split:true,items:[{xtype:"fileuploadfield",allowBlank:true,fieldLabel:OpenLayers.i18n("thesaurusFilePath"),id:"local_fname",name:"fname",buttonCfg:{text:OpenLayers.i18n("selectFile")}},this.createTypeCombo("local_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"local_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"},{xtype:"textfield",hidden:true,name:"mode",value:"file"}]});
return this.createThesaurusFromLocalFileForm
},getCreateThesaurusFromRemoteFileForm:function(){this.createThesaurusFromRemoteFileForm=new Ext.form.FormPanel({fileUpload:false,region:"center",autoHeight:true,baseCls:"x-plain",labelWidth:170,split:true,errorReader:new Ext.data.XmlReader({record:"record"},["Thesaurus"]),listeners:{scope:this,afterrender:function(cmp){Ext.getCmp("remote_thesaurusURL").setVisible(true);
Ext.getCmp("remote_thesaurusCmb").setVisible(false);
Ext.getCmp("remote_themeCmb").setVisible(true)
}},items:[{xtype:"radiogroup",id:"creationModeRadioGroup",columns:1,submitValue:false,fieldLabel:OpenLayers.i18n("creationMode"),items:[{boxLabel:OpenLayers.i18n("createThesaurusFromURL"),name:"rb-auto",inputValue:1,checked:true},{boxLabel:OpenLayers.i18n("createThesaurusFromRepository"),name:"rb-auto",inputValue:2}],listeners:{scope:this,change:function(rg,radio){Ext.getCmp("remote_thesaurusURL").setVisible(radio.inputValue===1);
Ext.getCmp("remote_thesaurusCmb").setVisible(radio.inputValue===2);
Ext.getCmp("remote_themeCmb").setVisible(radio.inputValue!==2)
}}},{xtype:"textfield",fieldLabel:OpenLayers.i18n("externalThesaurusURL"),id:"remote_thesaurusURL",name:"url",anchor:"-15"},{fieldLabel:OpenLayers.i18n("thesaurusFromRepository"),id:"remote_thesaurusCmb",anchor:"-15",xtype:"combo",mode:"local",triggerAction:"all",forceSelection:true,editable:false,displayField:"title",valueField:"link",submitValue:false,store:new GeoNetwork.data.ThesaurusFeedStore(),listeners:{scope:this,select:function(cmb,record,index){Ext.getCmp("remote_thesaurusURL").setValue(record.data.link);
Ext.getCmp("remote_themeCmb").setValue(record.data.category)
}}},this.createTypeCombo("remote_themeCmb"),{xtype:"textfield",fieldLabel:OpenLayers.i18n("thesaurusType"),id:"remote_thesaurusType",name:"type",value:"external",hidden:true,anchor:"-15"}]});
return this.createThesaurusFromRemoteFileForm
},createTypeCombo:function(id){return new Ext.form.ComboBox({fieldLabel:OpenLayers.i18n("Theme"),id:id,name:"themeCmb",anchor:"-15",mode:"local",value:this.defaultThesaurusType,triggerAction:"all",forceSelection:true,editable:false,displayField:"name",valueField:"value",hiddenName:"dir",store:new Ext.data.JsonStore({fields:["name","value"],data:[{name:"Discipline",value:"discipline"},{name:"Place",value:"place"},{name:"Stratum",value:"stratum"},{name:"Temporal",value:"temporal"},{name:"Theme",value:"theme"}]})})
},getKeyword:function(){return new GeoNetwork.form.SearchField({id:"keywordSearchField",width:240,store:this.keywordStore,paramName:"pKeyword"})
},getLimitInput:function(){return{xtype:"textfield",name:"maxResults",id:"maxResults",value:this.maxResults,width:40,listeners:{scope:this,change:function(field,newValue,oldValue){this.keywordStore.baseParams.maxResults=newValue
}}}
}});
Ext.reg("gn_admin_thesaurusmanagerpanel",GeoNetwork.admin.ThesaurusManagerPanel);
Ext.namespace("GeoNetwork");
GeoNetwork.OGCServiceQuickRegister=Ext.extend(Ext.menu.Menu,{catalogue:undefined,harvesterStore:undefined,textInfo:undefined,textExample:"eg. http://services.sandre.eaufrance.fr/geo/ouvrage?SERVICE=WMS&VERSION=1.1.1&REQUEST=GetCapabilities",textValidButton:"Check & Add",urlFieldWidth:250,urlField:undefined,initComponent:function(){this.textInfo=OpenLayers.i18n("enterGetCapURL");
var cmp=[];
cmp.push({text:this.textInfo,canActivate:false});
this.urlField={xtype:"textfield",width:this.urlFieldWidth,margins:"0 0 0 30",id:"OGCServiceQuickRegisterUrl",value:"",iconCls:"no-icon"};
cmp.push(this.urlField);
cmp.push({text:this.textExample,canActivate:false});
cmp.push({xtype:"buttongroup",autoWidth:true,border:false,frame:false,columns:2,iconCls:"no-icon",defaults:{xtype:"button",iconAlign:"right"},items:[{text:this.textValidButton,iconCls:"md-mn md-mn-badd",handler:this.getCapabilities}]});
Ext.apply(this,{defaultType:"menuitem",items:cmp});
GeoNetwork.OGCServiceQuickRegister.superclass.initComponent.call(this)
},getCapabilities:function(){var url=Ext.getCmp("OGCServiceQuickRegisterUrl").getValue();
var menu=this.ownerCt.ownerCt;
OpenLayers.Request.GET({url:url,success:function(response){if(response.responseText.indexOf("Some unexpected")!==-1){Ext.Msg.alert("Failed to check service url.",response.responseText);
return
}var xml=response.responseXML;
if(!xml){Ext.Msg.alert("GetCapabilities failed","Null response returned - check proxy or service configuration.");
return
}var format=new OpenLayers.Format.WMSCapabilities();
var obj=format.read(xml);
menu.addHarvester(obj.service.title,url,obj.version)
},failure:function(response){Ext.Msg.alert("Failed to check service url.",response.responseText)
}})
},addHarvester:function(title,url,version){var data=new Ext.data.Record({id:"",type:"ogcwxs",site_name:title,site_url:url.replace(/&/g,"&amp;"),site_ogctype:"WMS"+version,site_icon:"default.gif",site_account_use:"false",options_every:"90",options_topic:"",options_onerunonly:"true",options_lang:"en",options_createthumbnails:"true",options_uselayer:"true",options_uselayermd:"false"});
var xmlTpl=new GeoNetwork.Templates().getHarvesterTemplate();
var xml=xmlTpl.apply(data.data);
this.saveHarvester(xml)
},saveHarvester:function(xml){var menu=this;
var opts={url:this.catalogue.services.harvestingAdd,data:xml};
OpenLayers.Util.applyDefaults(opts,{success:function(response){var xml=response.responseXML;
var id=xml.firstChild.getAttribute("id");
menu.runHarvester(this.catalogue.services.harvestingRun,id)
},failure:function(response){Ext.Msg.alert("Failed",response.responseText)
}});
OpenLayers.Request.POST(opts)
},runHarvester:function(url,id){var menu=this;
OpenLayers.Request.GET({url:url+"?id="+id,success:function(response){if(response.responseText.indexOf("nexpected")!==-1){Ext.Msg.alert("Activation or start failed.",response.responseText);
return
}Ext.Msg.alert("Successfull registration","Wait a few minutes before having all layers and services registered in the catalogue.");
if(menu.harvesterStore){menu.harvesterStore.reload()
}},failure:function(response){Ext.Msg.alert("Registration failed",response.responseText)
}})
}});
Ext.reg("gn_ogcservicequickregister",GeoNetwork.OGCServiceQuickRegister);
Ext.namespace("GeoNetwork.map");
GeoNetwork.map.ExtentMap=function(){var maps=[];
var vectorLayers=[];
var vectorLayerStyle=OpenLayers.Feature.Vector.style["default"];
var targetPolygon=null;
var watchedBbox=null;
var mode=null;
var edit=null;
var eltRef=null;
var digits=5;
var MultiPolygonReference=OpenLayers.Class(OpenLayers.Geometry,{id:null,initialize:function(id){this.id=id
},CLASS_NAME:"GeoNetwork.map.ExtentMap.MultiPolygonReference"});
var mainProjCode=GeoNetwork.map.PROJECTION||"EPSG:4326";
var wgsProjCode="EPSG:4326";
var wgsProj=new OpenLayers.Projection(wgsProjCode);
var mainProj=null;
var units="m";
var alternateProj=null;
function convertToGml(feature,proj){var mainProj=new OpenLayers.Projection(proj);
var writer=(mainProj===wgsProj?new OpenLayers.Format.GML.v3():new OpenLayers.Format.GML.v3({externalProjection:wgsProj,internalProjection:mainProj}));
var child=writer.writeNode("feature:_geometry",feature.geometry);
return OpenLayers.Format.XML.prototype.write.call(writer,child.firstChild)
}function createMap(){var i,options={units:units,projection:mainProjCode,resolutions:GeoNetwork.map.RESOLUTIONS,maxExtent:GeoNetwork.map.EXTENT,theme:null},map=new OpenLayers.Map(GeoNetwork.map.MAP_OPTIONS);
if(edit){map.addControl(new OpenLayers.Control.Navigation());
map.addControl(new OpenLayers.Control.PanZoom())
}map.addControl(new OpenLayers.Control.MousePosition());
for(i=0;
i<GeoNetwork.map.BACKGROUND_LAYERS.length;
i++){map.addLayer(GeoNetwork.map.BACKGROUND_LAYERS[i].clone())
}var vectorLayer=new OpenLayers.Layer.Vector("VectorLayer",{});
map.addLayer(vectorLayer);
vectorLayer.events.on({sketchstarted:function(){this.destroyFeatures()
},scope:vectorLayer});
vectorLayer.events.on({sketchcomplete:function(){Ext.query("button[class*=drawRectangle]")[0].click()
},scope:vectorLayer});
maps[eltRef]=map;
vectorLayers[eltRef]=vectorLayer;
return map
}function watchBbox(vectorLayer,watchedBbox,eltRef,map){var wsen=watchedBbox.split(","),i;
for(i=0;
i<wsen.length;
++i){Ext.get(wsen[i]).on("change",function(){updateBbox(map,watchedBbox,eltRef,false)
});
Ext.get("_"+wsen[i]).on("change",function(){updateBbox(map,watchedBbox,eltRef,true)
})
}}function updateBbox(map,targetBbox,eltRef,mainProj){var vectorLayer=map.getLayersByName("VectorLayer")[0];
var bounds,values,boundsForMap;
var wsen=targetBbox.split(",");
values=[];
if(mainProj){values[0]=Ext.get("_"+wsen[0]).getValue();
values[1]=Ext.get("_"+wsen[1]).getValue();
values[2]=Ext.get("_"+wsen[2]).getValue();
values[3]=Ext.get("_"+wsen[3]).getValue();
bounds=OpenLayers.Bounds.fromArray(values);
boundsForMap=bounds.clone();
if(mainProjCode!==wgsProj){boundsForMap.transform(new OpenLayers.Projection(wgsProjCode),new OpenLayers.Projection(mainProjCode))
}}else{values[0]=Ext.get(wsen[0]).getValue();
values[1]=Ext.get(wsen[1]).getValue();
values[2]=Ext.get(wsen[2]).getValue();
values[3]=Ext.get(wsen[3]).getValue();
bounds=OpenLayers.Bounds.fromArray(values);
boundsForMap=bounds.clone();
var toProj=null;
var radio=document.getElementsByName("proj_"+eltRef);
for(i=0;
i<radio.length;
i++){if(radio[i].checked===true){toProj=radio[i].value
}}if(toProj!==mainProjCode){boundsForMap.transform(new OpenLayers.Projection(toProj),new OpenLayers.Projection(mainProjCode))
}if(toProj!==wgsProjCode){bounds.transform(new OpenLayers.Projection(toProj),new OpenLayers.Projection(wgsProjCode))
}Ext.get("_"+wsen[0]).dom.value=bounds.left;
Ext.get("_"+wsen[1]).dom.value=bounds.bottom;
Ext.get("_"+wsen[2]).dom.value=bounds.right;
Ext.get("_"+wsen[3]).dom.value=bounds.top
}Ext.get(wsen[0]).dom.onkeyup();
Ext.get(wsen[1]).dom.onkeyup();
Ext.get(wsen[2]).dom.onkeyup();
Ext.get(wsen[3]).dom.onkeyup();
var feature=new OpenLayers.Feature.Vector(boundsForMap.toGeometry());
vectorLayer.destroyFeatures();
vectorLayer.addFeatures(feature);
zoomToFeatures(maps[eltRef],vectorLayers[eltRef]);
watchRadios(targetBbox,eltRef)
}function watchRadios(watchedBbox,eltRef){function updateInputTextFields(watchedBbox,toProj,digits){var wsen=watchedBbox.split(",");
var w=Ext.get("_"+wsen[0]).getValue();
var s=Ext.get("_"+wsen[1]).getValue();
var e=Ext.get("_"+wsen[2]).getValue();
var n=Ext.get("_"+wsen[3]).getValue();
var l=w!==""?w:"0";
var b=s!==""?s:"0";
var r=e!==""?e:"0";
var t=n!==""?n:"0";
var bounds=OpenLayers.Bounds.fromString(l+","+b+","+r+","+t);
if(!toProj.equals(wgsProj)){bounds.transform(wgsProj,toProj)
}if(w!==""){w=bounds.left.toFixed(digits)+""
}Ext.get(wsen[0]).dom.value=w;
if(s!==""){s=bounds.bottom.toFixed(digits)+""
}Ext.get(wsen[1]).dom.value=s;
if(e!==""){e=bounds.right.toFixed(digits)+""
}Ext.get(wsen[2]).dom.value=e;
if(n!==""){n=bounds.top.toFixed(digits)+""
}Ext.get(wsen[3]).dom.value=n
}var inputs=Ext.DomQuery.select("input.proj"),idx;
for(idx=0;
idx<inputs.length;
++idx){var input=inputs[idx];
if(input.id.indexOf(eltRef)!==-1){if(input.checked){updateInputTextFields(watchedBbox,new OpenLayers.Projection(input.value),digits)
}var e=Ext.get(input.id);
e.on("click",function(){updateInputTextFields(watchedBbox,new OpenLayers.Projection(this.value),digits)
},e.dom)
}}}function writeFeature(options){var format="WKT";
var from,to;
if(options!==null){format=options.format||"WKT";
from=options.from;
to=options.to
}var writer=new OpenLayers.Format[format]();
if(from!==null&&to!==null){writer.internalProjection=from;
writer.externalProjection=to
}if(!this.vectorLayer.features.length){return null
}var feature=this.vectorLayer.features[this.vectorLayer.features.length-1];
return writer.write(feature)
}function readFeature(string,options,vectorLayer,map){if(string===""){return false
}var format="WKT";
var from,to;
if(options!==null){format=options.format||"WKT";
from=options.from;
to=options.to
}var reader=new OpenLayers.Format[format]();
if(from!==null&&to!==null){reader.externalProjection=from;
reader.internalProjection=to
}string=string.replace(/\n/g,"");
var feature=reader.read(string);
if(!feature){return false
}if(feature.length){feature=feature[0]
}vectorLayer.addFeatures(feature);
if(options.zoomToFeatures){zoomToFeatures(map,vectorLayer)
}return true
}function updateBboxForRegion(map,targetBbox,eltRef){var vectorLayer=map.getLayersByName("VectorLayer")[0];
var bounds;
var wsen=targetBbox.split(",");
var values=[];
values[0]=Ext.get("_"+wsen[0]).getValue();
values[1]=Ext.get("_"+wsen[1]).getValue();
values[2]=Ext.get("_"+wsen[2]).getValue();
values[3]=Ext.get("_"+wsen[3]).getValue();
bounds=OpenLayers.Bounds.fromArray(values);
bounds.transform(wgsProj,mainProj);
Ext.get(wsen[0]).dom.onkeyup();
Ext.get(wsen[1]).dom.onkeyup();
Ext.get(wsen[2]).dom.onkeyup();
Ext.get(wsen[3]).dom.onkeyup();
var feature=new OpenLayers.Feature.Vector(bounds.toGeometry());
vectorLayer.destroyFeatures();
vectorLayer.addFeatures(feature);
zoomToFeatures(map,vectorLayer);
watchRadios(targetBbox,eltRef)
}function createRegionMenu(cb){var store=GeoNetwork.data.RegionStore(catalogue.services.getRegions);
var combo=new Ext.form.ComboBox({store:store,tpl:'<tpl for="."><div class="x-combo-list-item">{[values.label[\''+GeoNetwork.Util.getCatalogueLang(OpenLayers.Lang.getCode())+"']]}</div></tpl>",typeAhead:true,mode:"local",triggerAction:"all",emptyText:OpenLayers.i18n("selectRegion"),selectOnFocus:true,width:135,listeners:{focus:{fn:function(el){el.getStore().load()
}},select:{fn:cb}},iconCls:"no-icon"});
return combo
}function zoomToFeatures(map,vectorLayer){var extent=vectorLayer.getDataExtent();
if(extent&&!isNaN(extent.left)){var width=extent.getWidth()/2;
var height=extent.getHeight()/2;
extent.left-=width;
extent.right+=width;
extent.bottom-=height;
extent.top+=height;
map.zoomToExtent(extent)
}else{map.zoomToMaxExtent()
}}return{init:function(){},initMapDiv:function(){var viewers,idFunc,idx,descRef,i;
mainProj=new OpenLayers.Projection(mainProjCode);
alternateProj=mainProj;
viewers=Ext.DomQuery.select(".extentViewer");
idFunc=Ext.id;
for(idx=0;
idx<viewers.length;
++idx){var viewer=viewers[idx];
targetPolygon=viewer.getAttribute("target_polygon");
watchedBbox=viewer.getAttribute("watched_bbox");
edit=viewer.getAttribute("edit")==="true";
eltRef=viewer.getAttribute("elt_ref");
descRef=viewer.getAttribute("desc_ref");
mode=viewer.getAttribute("mode");
var children=viewer.childNodes;
var tmp=[];
for(i=0;
i<children.length;
i++){if(children[i].nodeType===1){tmp.push(children[i])
}}children=tmp;
if(children.length>1){continue
}var id;
id=Ext.id(viewer);
var map=createMap();
if(edit){var tbarItems=[];
if(mode==="bbox"){var control=new OpenLayers.Control.DrawFeature(vectorLayers[eltRef],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:4},featureAdded:function(feature){var bounds=feature.geometry.getBounds(),boundsReproj;
if(mainProj!==wgsProj){boundsReproj=bounds.clone().transform(mainProj,wgsProj)
}else{boundsReproj=bounds
}var wsen=this.watchedBbox.split(",");
Ext.get("_"+wsen[0]).dom.value=boundsReproj.left;
Ext.get("_"+wsen[1]).dom.value=boundsReproj.bottom;
Ext.get("_"+wsen[2]).dom.value=boundsReproj.right;
Ext.get("_"+wsen[3]).dom.value=boundsReproj.top;
watchRadios(this.watchedBbox,this.eltRef)
}.bind({watchedBbox:watchedBbox,eltRef:eltRef})});
tbarItems.push(new GeoExt.Action({map:maps[eltRef],control:control,text:OpenLayers.i18n("drawRectangle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawRectangle"}));
tbarItems.push(createRegionMenu(function(c,r,idx){var wsen=this.watchedBbox.split(",");
Ext.get("_"+wsen[0]).dom.value=r.data.west;
Ext.get("_"+wsen[1]).dom.value=r.data.south;
Ext.get("_"+wsen[2]).dom.value=r.data.east;
Ext.get("_"+wsen[3]).dom.value=r.data.north;
updateBboxForRegion(maps[eltRef],watchedBbox,eltRef,true);
if(Ext.get("_"+this.descRef)!==null){Ext.get("_"+this.descRef).dom.value=r.data.label[GeoNetwork.Util.getCatalogueLang(OpenLayers.Lang.getCode())]
}}.bind({extentMap:this,map:maps[eltRef],watchedBbox:watchedBbox,eltRef:eltRef,descRef:descRef})))
}else{if(mode==="polygon"){var polyControl=new OpenLayers.Control.DrawFeature(vectorLayers[eltRef],OpenLayers.Handler.Polygon,{featureAdded:function(feature){document.getElementById("_X"+this).value=convertToGml(feature,mainProjCode);
polyControl.deactivate()
}.bind(targetPolygon)});
tbarItems.push(new GeoExt.Action({map:maps[eltRef],control:polyControl,text:OpenLayers.i18n("drawPolygon"),tooltip:OpenLayers.i18n("drawPolygonTT"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawPolygon"}));
control=new OpenLayers.Control.DrawFeature(vectorLayers[eltRef],OpenLayers.Handler.RegularPolygon,{handlerOptions:{irregular:true,sides:60},featureAdded:function(feature){document.getElementById("_X"+this).value=convertToGml(feature,mainProjCode);
control.deactivate()
}.bind(targetPolygon)});
tbarItems.push(new GeoExt.Action({map:maps[eltRef],control:control,text:OpenLayers.i18n("drawCircle"),pressed:false,allowDepress:true,toggleGroup:"tool",iconCls:"drawCircle"}))
}}tbarItems.push({text:OpenLayers.i18n("clear"),iconCls:"clearPolygon",handler:function(){this.vectorLayer.destroyFeatures();
var targetPolygonInput=document.getElementById("_X"+this.targetPolygon);
if(targetPolygonInput!==null){targetPolygonInput.value=""
}if(this.targetBbox!==""){var wsen=this.targetBbox.split(",");
Ext.get(wsen[0]).dom.value="";
Ext.get(wsen[1]).dom.value="";
Ext.get(wsen[2]).dom.value="";
Ext.get(wsen[3]).dom.value="";
Ext.get("_"+wsen[0]).dom.value="";
Ext.get("_"+wsen[1]).dom.value="";
Ext.get("_"+wsen[2]).dom.value="";
Ext.get("_"+wsen[3]).dom.value="";
$(wsen[0]).onkeyup();
$(wsen[1]).onkeyup();
$(wsen[2]).onkeyup();
$(wsen[3]).onkeyup()
}},scope:{vectorLayer:vectorLayers[eltRef],targetPolygon:targetPolygon,targetBbox:watchedBbox,eltRef:eltRef}})
}var mapPanel=new GeoExt.MapPanel({renderTo:id,height:300,width:400,map:maps[eltRef],tbar:(edit?tbarItems:null)});
if(children.length>0){readFeature(children[0].innerHTML,{format:"WKT",zoomToFeatures:true,from:wgsProj,to:mainProj},vectorLayers[eltRef],maps[eltRef])
}if(watchedBbox!==""){watchRadios(watchedBbox,eltRef);
watchBbox(vectorLayers[eltRef],watchedBbox,eltRef,maps[eltRef])
}}}}
};
GeoNetwork.map.ExtentMap.prev_geometry=OpenLayers.Format.GML.Base.prototype.writers.feature._geometry;
OpenLayers.Format.GML.Base.prototype.writers.feature._geometry=function(geometry){if(geometry.CLASS_NAME==="GeoNetwork.map.ExtentMap.MultiPolygonReference"){var gml=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");
var gmlNode=this.createElementNS(this.namespaces.gml,"gml:MultiPolygon");
gmlNode.setAttribute("gml:id",geometry.id);
gml.appendChild(gmlNode);
return gml
}else{return GeoNetwork.map.ExtentMap.prev_geometry.apply(this,arguments)
}};
if(!window.GeoNetwork){window.GeoNetwork={}
}if(!GeoNetwork.Control){GeoNetwork.Control={}
}GeoNetwork.Control.ZoomWheel=OpenLayers.Class(OpenLayers.Control,{wheelChange:OpenLayers.Control.Navigation.prototype.wheelChange,draw:function(){this.handler=new OpenLayers.Handler.MouseWheel(this,{up:OpenLayers.Control.Navigation.prototype.wheelUp,down:OpenLayers.Control.Navigation.prototype.wheelDown});
this.activate()
},CLASS_NAME:"GeoNetwork.Control.ZoomWheel"});
if(!window.GeoNetwork){window.GeoNetwork={}
}if(!GeoNetwork.Control){GeoNetwork.Control={}
}GeoNetwork.Control.ExtentBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,wktelement:null,minxelement:null,minyelement:null,maxxelement:null,maxyelement:null,EVENT_TYPES:["finishBox"],initialize:function(options){this.EVENT_TYPES=GeoNetwork.Control.ExtentBox.prototype.EVENT_TYPES.concat(OpenLayers.Control.prototype.EVENT_TYPES);
OpenLayers.Control.prototype.initialize.apply(this,arguments);
this.handler=new OpenLayers.Handler.RegularPolygon(this,{create:this.startBox,done:this.endBox},{irregular:true})
},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments)
},startBox:function(){this.getOrCreateLayer();
this.vectorLayer.destroyFeatures()
},endBox:function(){var bounds=this.handler.feature.geometry.getBounds();
this.updateFields(bounds);
this.events.triggerEvent("finishBox",null)
},updateFieldsWKT:function(wkt){this.updateFields(OpenLayers.Geometry.fromWKT(wkt).getBounds())
},updateFields:function(bounds){var polFeature=new OpenLayers.Feature.Vector(bounds.toGeometry(),null,this.vectorLayerStyle);
this.vectorLayer.addFeatures([polFeature]);
this.vectorLayer.refresh();
var mapProj=this.map.getProjectionObject();
var wgs84=new OpenLayers.Projection("WGS84");
var minxy=new OpenLayers.LonLat(bounds.left,bounds.bottom).transform(mapProj,wgs84);
var maxxy=new OpenLayers.LonLat(bounds.right,bounds.top).transform(mapProj,wgs84);
var minx=minxy.lon.toFixed(4),miny=minxy.lat.toFixed(4),maxx=maxxy.lon.toFixed(4),maxy=maxxy.lat.toFixed(4);
if(this.wktelement){this.wktelement.setValue("POLYGON(("+minx+" "+miny+","+minx+" "+maxy+","+maxx+" "+maxy+","+maxx+" "+miny+","+minx+" "+miny+"))")
}else{if(this.minxelement){this.minxelement.dom.value=minx
}if(this.maxxelement){this.maxxelement.dom.value=maxx
}if(this.minyelement){this.minyelement.dom.value=miny
}if(this.maxyelement){this.maxyelement.dom.value=maxy
}}},updateMap:function(){if((!this.minxelement)||(!this.maxxelement)||(!this.minyelement)||(!this.maxyelement)){return
}this.getOrCreateLayer();
var mapProj=this.map.getProjectionObject();
var wgs84=new OpenLayers.Projection("WGS84");
var minMapxy=new OpenLayers.LonLat(this.map.getExtent().left,this.map.getExtent().bottom).transform(mapProj,wgs84);
var maxMapxy=new OpenLayers.LonLat(this.map.getExtent().right,this.map.getExtent().top).transform(mapProj,wgs84);
var aux=parseFloat(this.minxelement.dom.value);
if(isNaN(aux)){this.minxelement.dom.value=minMapxy.lon
}aux=parseFloat(this.maxxelement.dom.value);
if(isNaN(aux)){this.maxxelement.dom.value=maxMapxy.lon
}aux=parseFloat(this.minyelement.dom.value);
if(isNaN(aux)){this.minyelement.dom.value=minMapxy.lat
}aux=parseFloat(this.maxyelement.dom.value);
if(isNaN(aux)){this.maxyelement.dom.value=maxMapxy.lat
}this.minxelement.dom.value=parseFloat(this.minxelement.dom.value).toFixed(4);
this.maxxelement.dom.value=parseFloat(this.maxxelement.dom.value).toFixed(4);
this.minyelement.dom.value=parseFloat(this.minyelement.dom.value).toFixed(4);
this.maxyelement.dom.value=parseFloat(this.maxyelement.dom.value).toFixed(4);
this.vectorLayer.destroyFeatures();
var minxy=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(wgs84,mapProj);
var maxxy=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(wgs84,mapProj);
var bounds=new OpenLayers.Bounds();
bounds.extend(minxy);
bounds.extend(maxxy);
var polFeature=new OpenLayers.Feature.Vector(bounds.toGeometry(),null,this.vectorLayerStyle);
this.vectorLayer.addFeatures([polFeature]);
this.vectorLayer.refresh()
},getOrCreateLayer:function(){if(!this.vectorLayer){this.vectorLayer=this.vectorLayer||new OpenLayers.Layer.Vector("ExtentBox",{style:this.vectorLayerStyle});
this.map.addLayer(this.vectorLayer)
}this.map.setLayerIndex(this.vectorLayer,this.map.getNumLayers());
return this.vectorLayer
},clear:function(){if(this.vectorLayer){this.vectorLayer.destroyFeatures()
}},zoomTo:function(){var mapProj=this.map.getProjectionObject();
var wgs84=new OpenLayers.Projection("WGS84");
var minxy=new OpenLayers.LonLat(this.minxelement.dom.value,this.minyelement.dom.value).transform(wgs84,mapProj);
var maxxy=new OpenLayers.LonLat(this.maxxelement.dom.value,this.maxyelement.dom.value).transform(wgs84,mapProj);
var bounds=new OpenLayers.Bounds();
bounds.extend(minxy);
bounds.extend(maxxy);
this.map.zoomToExtent(bounds)
},CLASS_NAME:"GeoNetwork.Control.ExtentBox"});
Ext.namespace("GeoNetwork","GeoNetwork.OGCUtil");
GeoNetwork.OGCUtil.getProtocolVersion=function(){return"1.3.0"
};
GeoNetwork.OGCUtil.getLanguage=function(){return catalogue.lang
};
GeoNetwork.OGCUtil.ensureProperUrlEnd=function(url){if(url.indexOf("?")==-1){url+="?"
}else{var lastChar=url.substring(url.length-1);
if(lastChar!="&"&&lastChar!="?"){url+="&"
}}return url
};
GeoNetwork.OGCUtil.reprojectMap=function(map,newProjection,noZoom){if(map.projection!=newProjection.projCode){map.baseLayer.options.scales=map.scales;
var oldProjection=map.getProjectionObject();
map.projection=newProjection.projCode;
if(newProjection.getUnits()===null){map.units="degrees"
}else{map.units=newProjection.getUnits()
}var cursorPos=null;
if(map.getControlsByClass("GeoNetwork.Control.CursorPos").length>0){cursorPos=map.getControlsByClass("GeoNetwork.Control.CursorPos")[0]
}if(map.units=="m"&&cursorPos!==null){cursorPos.numdigits=0
}else{if(map.units=="degrees"&&cursorPos!==null){cursorPos.numdigits=4
}}map.maxExtent=map.maxExtent.transform(oldProjection,newProjection);
map.baseLayer.extent=map.maxExtent;
var bounds=map.getExtent().transform(oldProjection,newProjection);
for(var i=0;
i<map.layers.length;
i++){var layer=map.layers[i];
layer.units=map.units;
layer.projection=newProjection;
layer.maxExtent=map.maxExtent;
if(layer.isBaseLayer){layer.initResolutions()
}else{layer.resolutions=map.baseLayer.resolutions;
layer.minResolution=map.baseLayer.minResolution;
layer.maxResolution=map.baseLayer.maxResolution
}if(layer instanceof OpenLayers.Layer.Vector){for(var j=0;
j<layer.features.length;
j++){var feature=layer.features[j];
if(!feature.geometry.projection){feature.geometry.projection=oldProjection.projCode
}if(feature.geometry.projection!=map.projection){feature.geometry.transform(new OpenLayers.Projection(feature.geometry.projection),map.getProjectionObject());
feature.geometry.projection=map.projection
}}}}if(!noZoom){map.zoomToExtent(bounds)
}}};
GeoNetwork.OGCUtil.layerExistsInMap=function(layer,map){var layerExists=false;
for(var i=0,len=map.layers.length;
i<len;
i++){if(map.layers){var lr=map.layers[i];
if(lr.params){try{var layers=lr.params.LAYERS.split(",");
if((layers.indexOf(layer.params.LAYERS)!=-1)&&lr.params.SERVICE==layer.params.SERVICE&&lr.url==layer.url){layerExists=lr;
break
}}catch(e){}}}}return layerExists
};
Ext.namespace("GeoNetwork","GeoNetwork.CatalogueInterface");
GeoNetwork.CatalogueInterface=function(){var map;
var layerLoadingMask;
var layers;
var setMap=function(mapC){map=mapC
};
var getLayer=function(caps,caplayers,layer){var findedLayer=null;
for(var i=0,len=caplayers.length;
i<len;
++i){var lr=caplayers[i];
try{var layerName=lr.name.split(",");
if(layerName.indexOf(layer.params.LAYERS)!=-1){findedLayer=lr;
break
}}catch(e){}if(typeof(lr.nestedLayers)!="undefined"){findedLayer=getLayer(caps,lr.nestedLayers,layer);
if(findedLayer!==null){break
}}}return findedLayer
};
var processLayersSuccess=function(response){layerLoadingMask.hide();
var parser=new OpenLayers.Format.WMSCapabilities();
var caps=parser.read(response.responseXML||response.responseText);
if(caps.capability){var accessContraints=caps.service.accessContraints;
if((accessContraints)&&(accessContraints.toLowerCase()!="none")&&(accessContraints!="-")){var disclaimerWindow=new GeoNetwork.DisclaimerWindow({disclaimer:accessContraints});
disclaimerWindow.show();
disclaimerWindow=null
}if(map){for(var i=0,len=layers.length;
i<len;
i++){var name=layers[i][0];
var url=layers[i][1];
var layer=layers[i][2];
var metadata_id=layers[i][3];
var ol_layer=new OpenLayers.Layer.WMS(name,url,{layers:layer,format:"image/png",transparent:"TRUE",version:caps.version,language:GeoNetwork.OGCUtil.getLanguage()},{queryable:true,singleTile:true,ratio:1,buffer:0,transitionEffect:"resize",metadata_id:metadata_id});
if(!GeoNetwork.OGCUtil.layerExistsInMap(ol_layer,map)){ol_layer.events.on({loadstart:function(){this.isLoading=true
}});
ol_layer.events.on({loadend:function(){this.isLoading=false
}});
var layerCap=getLayer(caps,caps.capability.layers,ol_layer);
if(layerCap){ol_layer.queryable=layerCap.queryable;
ol_layer.name=layerCap.title||ol_layer.name;
ol_layer.llbbox=layerCap.llbbox;
ol_layer.styles=layerCap.styles;
ol_layer.dimensions=layerCap.dimensions
}map.addLayer(ol_layer)
}}}}};
var processLayersFailure=function(response){layerLoadingMask.hide();
Ext.MessageBox.alert(OpenLayers.i18n("loadLayer.error.title"),OpenLayers.i18n("loadLayer.error.message"))
};
return{init:function(map){setMap(map)
},addLayers:function(layerList){if(layerList.length===0){return
}var onlineResource=layerList[0][1];
if(layerList[0][2]===""){GeoNetwork.WindowManager.showWindow("addwms");
var panel=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwms").browserPanel.id);
panel.setURL(onlineResource);
return
}layerLoadingMask=new Ext.LoadMask(map.div,{msg:OpenLayers.Lang.translate("loadLayer.loadingMessage")});
layerLoadingMask.show();
layers=layerList;
var params={service:"WMS",request:"GetCapabilities",version:GeoNetwork.OGCUtil.getProtocolVersion(),language:GeoNetwork.OGCUtil.getLanguage()};
var paramString=OpenLayers.Util.getParameterString(params);
var separator=(onlineResource.indexOf("?")>-1)?"&":"?";
onlineResource+=separator+paramString;
var req=Ext.Ajax.request({url:onlineResource,method:"GET",success:processLayersSuccess,failure:processLayersFailure,timeout:10000})
}}
};
GeoNetwork.CatalogueInterface=new GeoNetwork.CatalogueInterface();
Ext.namespace("GeoNetwork","GeoNetwork.WMC");
GeoNetwork.WMC=function(){return{loadWmc:function(map,xml){try{var layers=map.layers;
for(var i=layers.length-1;
i>0;
i--){if(!layers[i].isBaseLayer){map.removeLayer(layers[i])
}}Ext.getCmp("toctree").getSelectionModel().clearSelections();
var format=new OpenLayers.Format.WMC({layerOptions:{buffer:0}});
map=format.read(xml,{map:map})
}catch(err){Ext.MessageBox.alert(OpenLayers.i18n("selectWMCFile.errorLoadingWMC"))
}},mergeWmc:function(map,xml){try{var format=new OpenLayers.Format.WMC({layerOptions:{buffer:0}});
map=format.read(xml,{map:map})
}catch(err){Ext.MessageBox.alert(OpenLayers.i18n("selectWMCFile.errorLoadingWMC"))
}},saveContext:function(map){var wmc=new OpenLayers.Format.WMC();
OpenLayers.Request.POST({url:window.location.href.match(/(http.*\/.*)\/srv\.*/,"")[1]+"/wmc/create.wmc",data:wmc.write(map),success:this.onSaveContextSuccess,failure:this.onSaveContextFailure})
},onSaveContextSuccess:function(response){var json=response.responseText;
var o=Ext.decode(json);
if(o.success){window.location=o.url
}else{this.onSaveContextFailure()
}},onSaveContextFailure:function(form,action){Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:OpenLayers.i18n("saveWMCFile.windowTitle"),msg:OpenLayers.i18n("saveWMCFile.errorSaveWMC"),buttons:Ext.MessageBox.OK})
}}
};
GeoNetwork.WMCManager=new GeoNetwork.WMC();
Ext.namespace("GeoNetwork","GeoNetwork.tree");
GeoNetwork.tree.WMSListGenerator=function(config){Ext.apply(this,config);
if(this.node&&this.wmsStore){this.createWMSList()
}};
GeoNetwork.tree.WMSListGenerator.prototype={node:null,wmsStore:null,click:null,scope:null,createWMSList:function(){this.wmsStore.each(this.appendRecord,this)
},appendRecord:function(record){var wmsNode=new Ext.tree.TreeNode({url:record.get("url"),text:record.get("title"),cls:"folder",leaf:false});
wmsNode.appendChild(new Ext.tree.TreeNode({text:"",dummy:true}));
wmsNode.addListener("beforeexpand",this.addNodesFromWMS,this);
this.node.appendChild(wmsNode)
},replaceNode:function(node){this.currentNode.parentNode.replaceChild(node,this.currentNode);
node.ui.afterLoad();
node.expand()
},addNodesFromWMS:function(node){if(node.firstChild&&node.firstChild.attributes.dummy){node.removeChild(node.firstChild);
node.ui.beforeLoad();
this.scope.currentNode=node;
var treeGenerator=new GeoNetwork.tree.WMSTreeGenerator({click:this.click,callback:this.replaceNode,scope:this.scope});
treeGenerator.loadWMS(node.attributes.url)
}}};
Ext.namespace("GeoNetwork","GeoNetwork.tree");
GeoNetwork.tree.WMSTreeGenerator=function(config){Ext.apply(this,config)
};
GeoNetwork.tree.WMSTreeGenerator.prototype={layerParams:{format:"image/png"},layerOptions:{isBaseLayer:false},click:null,callback:null,scope:null,loadWMS:function(onlineResource){var containsVersion=(onlineResource.indexOf("version=")>-1);
var onlineResourceCheck=onlineResource.toLowerCase();
var containsVersion=(onlineResourceCheck.indexOf("version=")>-1);
var containsService=(onlineResourceCheck.indexOf("service=wms")>-1);
var containsRequest=(onlineResourceCheck.indexOf("request=getcapabilities")>-1);
var containsLanguage=(onlineResourceCheck.indexOf("language=")>-1);
var params={};
if(!containsVersion){params.version=GeoNetwork.OGCUtil.getProtocolVersion()
}if(!containsService){params.service="WMS"
}if(!containsRequest){params.request="GetCapabilities"
}if(!containsLanguage){params.language=GeoNetwork.OGCUtil.getLanguage()
}var paramString=OpenLayers.Util.getParameterString(params);
var separator=(onlineResource.indexOf("?")>-1)?"&":"?";
onlineResource+=separator+paramString;
var req=Ext.Ajax.request({url:onlineResource,method:"GET",failure:this.processFailure,success:this.processSuccess,disableCaching:false,scope:this})
},processSuccess:function(response){if(!this.parser){this.parser=new OpenLayers.Format.WMSCapabilities()
}var caps=this.parser.read(response.responseXML||response.responseText);
this.layerParams.VERSION=caps.version;
if(caps.capability.request.getmap.formats[0]){this.layerParams.format=caps.capability.request.getmap.formats[0]
}if(this.layerParams.format.indexOf("png")>0||this.layerParams.format.indexOf("PNG")>0){this.layerParams.transparent=true
}else{delete this.layerParams.transparent
}var node;
if(caps.capability){for(var i=0,len=caps.capability.nestedLayers.length;
i<len;
++i){var layer=caps.capability.nestedLayers[i];
node=this.addLayer(layer,caps.capability.request.getmap.href,null);
this.processLayer(layer,caps.capability.request.getmap.href,node)
}}Ext.callback(this.callback,this.scope,[node,caps])
},processFailure:function(response){Ext.callback(this.callback,this.scope,null)
},createWMSLayer:function(layer,url){layer.maxScale=parseFloat(layer.maxScale);
layer.minScale=parseFloat(layer.minScale);
if(layer.maxScale&&layer.minScale&&layer.maxScale>layer.minScale){delete layer.maxScale;
delete layer.minScale
}return new OpenLayers.Layer.WMS(layer.title,url,OpenLayers.Util.extend({layers:layer.name,language:GeoNetwork.OGCUtil.getLanguage()},this.layerParams),OpenLayers.Util.extend({minScale:layer.minScale,queryable:layer.queryable,maxScale:layer.maxScale,metadataURL:layer.metadataURL,styles:layer.styles,llbbox:layer.llbbox,projection:GeoNetwork.map.PROJECTION},this.layerOptions))
},addLayer:function(layer,url,parentNode){var wmsLayer=null;
if(layer.name){wmsLayer=this.createWMSLayer(layer,url);
if(layer.styles&&layer.styles.length>0){var style=layer.styles[0];
if(style.legend&&style.legend.href){wmsLayer.legendURL=style.legend.href
}}}var node=new Ext.tree.TreeNode({wmsLayer:wmsLayer,text:layer.title||layer.name});
node.addListener("click",this.click,this.scope);
if(parentNode){parentNode.appendChild(node)
}return node
},processLayer:function(layer,url,node){Ext.each(layer.nestedLayers,function(el){var node2=this.addLayer(el,url,node);
if(el.nestedLayers){this.processLayer(el,url,node2)
}},this)
}};
Ext.namespace("GeoNetwork","GeoNetwork.tree");
GeoNetwork.tree.WMTSTreeGenerator=function(config){Ext.apply(this,config)
};
GeoNetwork.tree.WMTSTreeGenerator.prototype={layerParams:{format:"image/png",transparent:"TRUE"},layerOptions:{ratio:1,singleTile:true,isBaseLayer:false},click:null,callback:null,scope:null,loadWMS:function(onlineResource){var containsVersion=(onlineResource.indexOf("version=")>-1);
var onlineResourceCheck=onlineResource.toLowerCase();
var containsVersion=(onlineResourceCheck.indexOf("version=")>-1);
var containsService=(onlineResourceCheck.indexOf("service=wmts")>-1);
var containsRequest=(onlineResourceCheck.indexOf("request=getcapabilities")>-1);
var containsLanguage=(onlineResourceCheck.indexOf("language=")>-1);
var params={};
if(!containsVersion){params.version=GeoNetwork.OGCUtil.getProtocolVersion()
}if(!containsService){params.service="WMTS"
}if(!containsRequest){params.request="GetCapabilities"
}if(!containsLanguage){params.language=GeoNetwork.OGCUtil.getLanguage()
}var paramString=OpenLayers.Util.getParameterString(params);
var separator=(onlineResource.indexOf("?")>-1)?"&":"?";
onlineResource+=separator+paramString;
var req=Ext.Ajax.request({url:onlineResource,method:"GET",failure:this.processFailure,success:this.processSuccess,disableCaching:false,scope:this})
},processSuccess:function(response,request){if(!this.parser){this.parser=new OpenLayers.Format.WMTSCapabilities()
}var caps=this.parser.read(response.responseXML||response.responseText);
if(!caps.service){caps.service={}
}if(!caps.service.accessConstraints){caps.service.accessContraints=""
}this.layerParams.VERSION=caps.version;
var parentNode=new Ext.tree.TreeNode({text:caps.serviceIdentification.title});
if(!caps.operationsMetadata){GeoNetwork.Message().msg({title:OpenLayers.i18n("warning"),msg:OpenLayers.i18n("WMTS.error.message"),status:"error",target:document.body,pause:30})
}else{if(caps.contents){for(var i=0,len=caps.contents.layers.length;
i<len;
++i){var layer=caps.contents.layers[i];
var c={};
Ext.apply(c,caps);
var node=this.addLayer(layer,caps.serviceMetadataUrl,parentNode,c);
this.processLayer(layer,caps.serviceMetadataUrl,node,c)
}}}Ext.callback(this.callback,this.scope,[parentNode,caps])
},processFailure:function(response){Ext.callback(this.callback,this.scope,null)
},createWMSLayer:function(layer,url,capabilities){var layermatrixSet=app.mapApp.getMap().projection;
var projection=app.mapApp.getMap().projection;
var tileMS=capabilities.contents.tileMatrixSets;
for(key in tileMS){if(key.toUpperCase().indexOf(projection)>=0||tileMS[key].supportedCRS.toUpperCase().indexOf(projection)>=0||tileMS[key].identifier.toUpperCase().indexOf(projection)>=0){layermatrixSet=key
}}return this.parser.createLayer(capabilities,{name:layer.title,layer:layer.identifier,matrixSet:layermatrixSet,isBaseLayer:false,format:layer.formats[0]})
},addLayer:function(layer,url,parentNode,caps){var wmsLayer=null;
if(layer.identifier){wmsLayer=this.createWMSLayer(layer,caps,caps);
if(layer.styles&&layer.styles.length>0){var style=layer.styles[0];
if(style.legend&&style.legend.href){wmsLayer.legendURL=style.legend.href
}}}var node=new Ext.tree.TreeNode({wmsLayer:wmsLayer,text:layer.title});
node.addListener("click",this.click,this.scope);
if(parentNode){parentNode.appendChild(node)
}return node
},processLayer:function(layer,url,node,caps){Ext.each(layer.layers,function(el){var node2=this.addLayer(el,url,node,caps);
if(el.nestedLayers){this.processLayer(el,url,node2,caps)
}},this)
}};
Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.BrowserPanel=function(config){Ext.apply(this,config);
GeoNetwork.wms.BrowserPanel.superclass.constructor.call(this)
};
GeoNetwork.wms.BrowserPanel.ADDWMS=0;
GeoNetwork.wms.BrowserPanel.WMSLIST=1;
GeoNetwork.wms.BrowserPanel.ADDWMTS=2;
Ext.extend(GeoNetwork.wms.BrowserPanel,Ext.Panel,{previewPanel:null,treePanel:null,map:null,previewCenterPoint:null,mode:GeoNetwork.wms.BrowserPanel.WMSLIST,wmsStore:null,urlField:null,searchResultsGrid:null,searchField:null,parseBt:null,typeRadio:null,defaultConfig:{border:false,frame:false,layout:"border"},initComponent:function(config){Ext.apply(this,config);
Ext.applyIf(this,this.defaultConfig);
GeoNetwork.wms.BrowserPanel.superclass.initComponent.call(this);
this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,previewCenterPoint:this.previewCenterPoint});
var root;
this.treePanel=new Ext.tree.TreePanel({rootVisible:false,autoScroll:true,autoHeight:true});
root=new Ext.tree.TreeNode({text:"",draggable:false,cls:"folder"});
this.treePanel.setRootNode(root);
var centerItems=[];
if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS||this.mode==GeoNetwork.wms.BrowserPanel.ADDWMTS){this.createForm();
centerItems.push(this.form)
}centerItems.push(this.treePanel);
var center={autoScroll:true,region:"center",items:centerItems,split:true,width:300,minWidth:300,border:false};
var east={region:"east",border:false,items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};
this.add(center);
this.add(east);
if(this.mode==GeoNetwork.wms.BrowserPanel.WMSLIST){this.treeGen=new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore})
}else{if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMS){new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmsStore:this.wmsStore});
this.treeGen=new GeoNetwork.tree.WMSTreeGenerator({click:this.nodeClick,callback:this.showTree,scope:this})
}else{if(this.mode==GeoNetwork.wms.BrowserPanel.ADDWMTS){new GeoNetwork.tree.WMSListGenerator({click:this.nodeClick,scope:this,node:this.treePanel.getRootNode(),wmtsStore:this.wmsStore});
this.treeGen=new GeoNetwork.tree.WMTSTreeGenerator({click:this.nodeClick,callback:this.showTree,scope:this})
}}}this.addButton({text:OpenLayers.i18n("WMSBrowserAddButton"),iconCls:"addLayerButton",width:150},this.addLayerToMap,this);
this.doLayout()
},createForm:function(){this.form=new Ext.form.FormPanel({labelWidth:15,id:"serviceSearchForm"});
this.typeRadio=new Ext.form.RadioGroup({items:[{name:"addWmsType",fieldLabel:"Search WMS",labelSeparator:"",inputValue:0,checked:true},{name:"addWmsType",labelSeparator:"",fieldLabel:" or add by URL",inputValue:1}],listeners:{change:function(rg,checked){var search=(checked.getGroupValue()=="0");
this.urlField.setVisible(!search);
this.searchField.setVisible(search);
this.searchResultsGrid.setVisible(search)
},scope:this}});
this.form.add(this.typeRadio);
this.urlField=new Ext.form.TextField({name:"wmsurl",hideLabel:true,hidden:true,emptyText:"WMS server URL ...",width:250,autoHeight:true});
this.form.add(this.urlField);
var mdStore=new GeoNetwork.data.MetadataResultsStore();
var sStore=GeoNetwork.data.MetadataSummaryStore();
this.searchField=new GeoNetwork.form.SearchField({name:"E_any",hideLabel:true,width:250,minWidth:250,store:mdStore,triggerAction:function(scope){scope.search("serviceSearchForm",null,null,1,true,mdStore,sStore)
},scope:catalogue});
var checkboxSM=new Ext.grid.CheckboxSelectionModel({singleSelect:this.singleSelect,header:""});
this.searchResultsGrid=new Ext.grid.GridPanel({layout:"fit",height:80,border:false,store:mdStore,columns:[checkboxSM,{id:"title",header:"Title",dataIndex:"title"}],sm:checkboxSM,autoExpandColumn:"title",listeners:{rowclick:function(grid,rowIndex,e){var data=grid.getStore().getAt(rowIndex).data;
this.setValue(data.links[0].href)
},scope:this.urlField}});
var wmsServiceField=new Ext.form.TextField({inputType:"hidden",name:"E_serviceType",value:"OGC:WMS"});
this.form.add(this.searchField,wmsServiceField,this.searchResultsGrid);
this.parseBt=new Ext.Button({id:"parse",text:OpenLayers.i18n("WMSBrowserConnectButton"),iconCls:"connectIcon",width:150});
this.form.addButton(this.parseBt,this.getWMSCaps,this)
},showTree:function(node,capability){if(!node){Ext.MessageBox.alert(OpenLayers.i18n("errorTitle"),OpenLayers.i18n("WMSBrowserConnectError"));
this.body.dom.style.cursor="default"
}var accessContraints=capability.service.accessContraints;
if((accessContraints)&&(accessContraints.toLowerCase()!="none")&&(accessContraints!="-")){var disclaimerWindow=new GeoNetwork.DisclaimerWindow({disclaimer:accessContraints});
disclaimerWindow.show();
disclaimerWindow=null
}var root=this.treePanel.getRootNode();
if(node){this.treePanel.getRootNode().appendChild(node)
}this.treePanel.show();
this.body.dom.style.cursor="default"
},getWMSCaps:function(btn){var url=this.urlField.getValue();
url=url.replace(/^\s+|\s+$/g,"");
if(url!=""){this.body.dom.style.cursor="wait";
this.treeGen.loadWMS(url)
}},setURL:function(url){var url=this.urlField.setValue(url);
this.typeRadio.setValue(1);
this.getWMSCaps(this.parseBt)
},nodeClick:function(node){this.previewPanel.showPreview(node.attributes.wmsLayer)
},addLayerToMap:function(){if(this.previewPanel.currentLayer){var layerExists=GeoNetwork.OGCUtil.layerExistsInMap(this.previewPanel.currentLayer,this.map);
if(!layerExists){this.previewPanel.currentLayer.events.on({loadstart:function(){this.isLoading=true
}});
this.previewPanel.currentLayer.events.on({loadend:function(){this.isLoading=false
}});
this.map.addLayers([this.previewPanel.currentLayer])
}else{Ext.MessageBox.alert(OpenLayers.i18n("infoTitle"),OpenLayers.i18n("WMSBrowserDuplicateMsg"))
}}}});
Ext.reg("gn_wmsbrowserpanel",GeoNetwork.wms.BrowserPanel);
Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.LayerInfoPanel=function(config){Ext.apply(this,config);
GeoNetwork.wms.LayerInfoPanel.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.wms.LayerInfoPanel,Ext.Panel,{previewPanel:null,map:null,previewCenterPoint:null,onlineresource:null,layer:null,metadataId:null,tpl:null,initComponent:function(){GeoNetwork.wms.LayerInfoPanel.superclass.initComponent.call(this);
this.tpl=new Ext.XTemplate('<div class="info-wms">',"<h1>{name}</h1><p>{description}</p><ul>","<li><span>"+OpenLayers.i18n("layerInfoPanel.queryableField")+"</span>{queryable}</li>","<li><span>"+OpenLayers.i18n("url")+'</span><a href="{url}">{url}</a></li>','<tpl if="values.keywords.length != 0">',"<li><span>"+OpenLayers.i18n("keyword")+"</span><ul>",'<tpl for="keywords">',"<li>{value}</li>","</tpl>","</ul></li>","</tpl>",'<tpl if="values.metadataURLs.length != 0 || values.metadataId">',"<li><span>"+OpenLayers.i18n("webLink")+"</span><ul>",'<tpl for="metadataURLs">','<li><a href="{href}">{href} ({type})</a></li>',"</tpl>","<tpl if=\"values.metadataId != ''\">",'<li><a href="javascript:void(0);" onclick="javascript:catalogue.metadataShow(\'{metadataId}\');return false;">'+OpenLayers.i18n("md")+"</a></li>","</tpl>","</ul></li>","</tpl>","</ul>","</div>");
this.layout="border";
this.border=false;
this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,previewCenterPoint:this.previewCenterPoint});
this.infoPanel=new Ext.Panel();
this.layerInfo=new GeoNetwork.wms.WMSLayerInfo({callback:this._showLayerInfo,scope:this});
var center={region:"center",layout:"fit",items:[this.infoPanel],split:true,width:300,minWidth:300};
var east={region:"east",items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};
this.add(center);
this.add(east);
this.doLayout()
},showLayerInfo:function(){this.previewPanel.showPreview(this.layer);
this.layerInfo.loadWMS(this.onlineresource,this.layer)
},_showLayerInfo:function(layer){if(!layer){GeoNetwork.Message().msg({title:OpenLayers.i18n("error"),msg:OpenLayers.i18n("WMSBrowserConnectError"),status:"error",target:this.getId()})
}else{layer.metadataId=this.metadataId||"";
this.infoPanel.update(this.tpl.apply(layer))
}this.body.dom.style.cursor="default"
}});
Ext.reg("gn_infolayerpanel",GeoNetwork.wms.LayerInfoPanel);
Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.LayerStylesPanel=function(config){Ext.apply(this,config);
GeoNetwork.wms.LayerStylesPanel.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.wms.LayerStylesPanel,Ext.Panel,{previewPanel:null,map:null,layer:null,selectedStyle:null,initComponent:function(){GeoNetwork.wms.LayerStylesPanel.superclass.initComponent.call(this);
this.layout="border";
this.border=false;
this.previewPanel=new GeoNetwork.wms.PreviewPanel({map:this.map,title:OpenLayers.i18n("layerStylesPreviewTitle")});
this.store=new Ext.data.SimpleStore({reader:new Ext.data.ArrayReader({},[{name:"name",type:"string"},{name:"title",type:"string"},{name:"legendUrl",type:"string"}]),fields:["name","title","legendUrl"]});
this.gridPanel=new Ext.grid.GridPanel({title:"",border:false,autoScroll:true,store:this.store,hideHeaders:false,columns:[{header:"Style",width:120,dataIndex:"name",sortable:false},{id:"description",header:"Description",width:180,dataIndex:"title",sortable:false}],autoExpandColumn:"description"});
this.gridPanel.on("rowclick",this._selectStyle,this);
var center={region:"center",layout:"fit",items:[this.gridPanel],split:true,width:300,minWidth:300};
var east={region:"east",items:[this.previewPanel],split:true,plain:true,cls:"popup-variant1",width:250,maxSize:250,minSize:250};
this.add(center);
this.add(east);
this.doLayout()
},showLayerStyles:function(layer){var info=[];
for(var i=0;
i<layer.styles.length;
i++){var legendUrl="";
if(layer.styles[i].legend){legendUrl=layer.styles[i].legend.href
}var style=[layer.styles[i].name,layer.styles[i].title,legendUrl];
info.push(style)
}this.gridPanel.getStore().loadData(info)
},_selectStyle:function(grid,rowIndex,e){var rec=grid.store.getAt(rowIndex);
this.selectedStyle=rec.get("name");
grid.getView().focusEl.focus();
var legendUrl=rec.get("legendUrl");
if(legendUrl==""){return
}legendUrl=unescape(legendUrl);
this.selectedStyleLegendUrl=legendUrl;
var legendUrlStyle=rec.get("legendUrl")+"&style="+this.selectedStyle;
this.previewPanel.showPreviewLegend(unescape(legendUrlStyle))
}});
Ext.reg("gn_layerstylespanel",GeoNetwork.wms.LayerStylesPanel);
Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.PreviewPanel=function(config){Ext.apply(this,config);
GeoNetwork.wms.PreviewPanel.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.wms.PreviewPanel,Ext.Panel,{title:OpenLayers.i18n("WMSBrowserPreviewTitle"),baseCls:"x-plain",cls:"x-panel-title-variant1",imgCls:"preview-image",width:250,height:250,currentLayer:null,initComponent:function(){GeoNetwork.wms.PreviewPanel.superclass.initComponent.call(this);
this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:Ext.BLANK_IMAGE_URL,width:this.width,height:this.height}});
this.add(this.image)
},hideMask:function(){if(this.mask){this.mask.hide()
}},showMask:function(){if(!this.mask){this.mask=new Ext.LoadMask(this.getEl(),{msg:OpenLayers.i18n("WMSBrowserPreviewWaitMsg")});
Ext.EventManager.addListener(this.image.getEl(),"load",this.hideMask,this);
Ext.EventManager.addListener(this.image.getEl(),"error",this.hideMask,this)
}this.mask.show()
},calculateBBOX:function(layer){var bbox;
var reverseAxisOrder=false;
if(layer.llbbox){if(this.map.getProjection()!=="EPSG:4326"){var llbounds=OpenLayers.Bounds.fromArray(layer.llbbox);
llbounds=llbounds.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());
bbox=llbounds.toArray(reverseAxisOrder)
}else{var llbounds=OpenLayers.Bounds.fromArray(layer.llbbox);
bbox=llbounds.toArray(reverseAxisOrder)
}}else{bbox=this.map.maxExtent.toArray(reverseAxisOrder)
}var center=OpenLayers.Bounds.fromArray(bbox).getCenterLonLat();
if(layer.minScale>0){var midScale;
if(layer.maxScale>0){midScale=(parseFloat(layer.maxScale)+parseFloat(layer.minScale))/2
}else{midScale=0.9*parseFloat(layer.minScale)
}var res=OpenLayers.Util.getResolutionFromScale(midScale,this.map.units);
var dX=Math.round(res*this.width);
var dY=Math.round(res*this.height);
var cX=center.lon;
var cY=center.lat;
if(dX!==0&&dY!==0){if(reverseAxisOrder){bbox=[cY-0.5*dY,cX-0.5*dX,cY+0.5*dY,cX+0.5*dX]
}else{bbox=[cX-0.5*dX,cY-0.5*dY,cX+0.5*dX,cY+0.5*dY]
}}}return bbox.join(",")
},showPreview:function(layer){if(!layer){return
}this.showMask();
var previousMap=layer.map;
if(previousMap===null){layer.map=this.map
}var url=layer.getFullRequestString({BBOX:this.calculateBBOX(layer),WIDTH:this.width,HEIGHT:this.height});
if(previousMap===null){layer.map=previousMap
}this.currentLayer=layer;
this.image.getEl().dom.src=url
},showPreviewLegend:function(urlLegend){this.remove(this.image);
this.image=null;
this.image=new Ext.BoxComponent({autoEl:{tag:"img","class":this.imgCls,src:urlLegend}});
this.add(this.image);
this.doLayout()
}});
Ext.reg("gn_wmspreview",GeoNetwork.wms.PreviewPanel);
Ext.namespace("GeoNetwork","GeoNetwork.wms");
GeoNetwork.wms.WMSLayerInfo=function(config){Ext.apply(this,config)
};
GeoNetwork.wms.WMSLayerInfo.prototype={layerParams:{format:"image/png",transparent:"TRUE"},layerOptions:{ratio:1,singleTile:true,isBaseLayer:false},callback:null,scope:null,layer:null,loadWMS:function(onlineResource,layer){this.layer=layer;
var onlineResourceCheck=onlineResource.toLowerCase();
var containsVersion=(onlineResourceCheck.indexOf("version=")>-1);
var containsService=(onlineResourceCheck.indexOf("service=wms")>-1);
var containsRequest=(onlineResourceCheck.indexOf("request=getcapabilities")>-1);
var containsLanguage=(onlineResourceCheck.indexOf("language=")>-1);
var params={};
if(!containsVersion){params.version=GeoNetwork.OGCUtil.getProtocolVersion()
}if(!containsService){params.service="WMS"
}if(!containsRequest){params.request="GetCapabilities"
}if(!containsLanguage){params.language=GeoNetwork.OGCUtil.getLanguage()
}var paramString=OpenLayers.Util.getParameterString(params);
var separator=(onlineResource.indexOf("?")>-1)?"&":"?";
onlineResource+=separator+paramString;
var req=Ext.Ajax.request({url:onlineResource,method:"GET",failure:this.processFailure,success:this.processSuccess,timeout:10000,scope:this})
},processSuccess:function(response){if(!this.parser){this.parser=new OpenLayers.Format.WMSCapabilities()
}var caps=this.parser.read(response.responseXML||response.responseText);
var node;
if(caps.capability){node=this.processLayers(caps,caps.capability.nestedLayers)
}Ext.callback(this.callback,this.scope,[node,this.layer])
},processFailure:function(response){Ext.callback(this.callback,this.scope,[null,this.layer])
},createWMSLayer:function(layer,url){return new OpenLayers.Layer.WMS(layer.title,url,OpenLayers.Util.extend({layers:layer.name},this.layerParams),OpenLayers.Util.extend({minScale:layer.minScale,queryable:layer.queryable,maxScale:layer.maxScale,description:layer["abstract"],keywords:layer.keywords,metadataURLs:layer.metadataURLs,metadataURL:layer.metadataURL,llbbox:layer.llbbox},this.layerOptions))
},processLayers:function(caps,layers){var findedLayer=null;
for(var i=0,len=layers.length;
i<len;
++i){var lr=layers[i];
try{var layerName=lr.name.split(",");
if(layerName.indexOf(this.layer.params.LAYERS)!=-1){findedLayer=this.createWMSLayer(lr,caps.service.href);
break
}}catch(e){}if(typeof(lr.nestedLayers)!="undefined"){findedLayer=this.processLayers(caps,lr.nestedLayers);
if(findedLayer!=null){break
}}}return findedLayer
}};
Ext.namespace("GeoNetwork");
GeoNetwork.FeatureInfoPanel=function(config){Ext.apply(this,config);
GeoNetwork.FeatureInfoPanel.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.FeatureInfoPanel,Ext.Panel,{features:null,treePanel:null,infoPanel:null,initComponent:function(){GeoNetwork.FeatureInfoPanel.superclass.initComponent.call(this);
this.layout="border";
this.treePanel=new Ext.tree.TreePanel({rootVisible:true,autoScroll:true});
var root=new Ext.tree.TreeNode({text:OpenLayers.i18n("featureInfoTitle"),draggable:false,expanded:true,cls:"folder"});
this.treePanel.setRootNode(root);
var center={region:"center",items:[this.treePanel],split:true,minWidth:100};
this.infoPanel=new Ext.Panel();
this.infoPanel.on("render",function(){if(this.features){this.showFeatures(this.features)
}},this);
var east={region:"east",items:[this.infoPanel],split:true,plain:true,cls:"popup-variant1",width:400,autoScroll:true};
this.add(center);
this.add(east);
this.doLayout()
},setMap:function(map){this.map=map
},featureToHTML:function(feature){var tplstring='<table class="olFeatureInfoTable" cellspacing="1" cellpadding="1"><tbody>';
for(var attr in feature.attributes){if(attr){tplstring+='<tr class="olFeatureInfoRow"><td width="50%" class="olFeatureInfoColumn">'+attr+'</td><td width="50%" class="olFeatureInfoValue">'+feature.attributes[attr]+"</td></tr>"
}}tplstring+="</tbody></table>";
var tpl=new Ext.XTemplate(tplstring);
tpl.overwrite(this.infoPanel.body,feature)
},click:function(node){if(node.attributes.features.length===0){var html='<table class="olFeatureInfoTable" cellpadding="1" cellspacing="1"><tbody>';
html+='<tr class="olFeatureInfoRow"><td colspan="2" class="olFeatureInfoValue">'+OpenLayers.i18n("FeatureInfoNoInfo")+"</td></tr>";
html+="</tbody></table>";
Ext.DomHelper.overwrite(this.infoPanel.body,html)
}for(var i=0,len=node.attributes.features.length;
i<len;
i++){var feature=node.attributes.features[i];
this.featureToHTML(feature)
}},clearInfoPanel:function(){if(this.infoPanel.body){Ext.DomHelper.overwrite(this.infoPanel.body,"")
}},getLayerTitle:function(featureType){if(featureType==null){return"&nbsp"
}var layers=this.map.getLayersByClass("OpenLayers.Layer.WMS");
for(var i=0,len=layers.length;
i<len;
i++){if(layers[i].params.LAYERS instanceof Array){if(OpenLayers.Util.indexOf(layers[i].params.LAYERS,featureType)!==-1){return layers[i].name
}}else{if(layers[i].params.LAYERS.indexOf(featureType)!==-1){return layers[i].name
}}}},showFeatures:function(features){this.clearInfoPanel();
var root=this.treePanel.getRootNode();
while(root.firstChild){root.removeChild(root.firstChild)
}var i,len,featureList=[];
for(i=0,len=features.length;
i<len;
i++){var found=false;
var featureType="";
if(features[i].type){featureType=features[i].type
}else{if(features[i].gml&&features[i].gml.featureType){featureType=features[i].gml.featureType
}}for(var j=0;
j<featureList.length;
j++){if(featureList[j].title===featureType){featureList[j].features.push(features[i]);
found=true
}}if(found===false){featureList.push({title:this.getLayerTitle(featureType),features:[features[i]]})
}}for(i=0,len=featureList.length;
i<len;
i++){var node=new Ext.tree.TreeNode({text:featureList[i].title,features:featureList[i].features});
node.addListener("click",this.click,this);
root.appendChild(node);
if(i===0){root.expand();
this.click(node);
this.treePanel.getSelectionModel().select(node)
}}root.expand()
}});
Ext.reg("gn_featureinfo",GeoNetwork.FeatureInfoPanel);
Ext.namespace("GeoNetwork");
GeoNetwork.LegendPanel=Ext.extend(GeoExt.LegendPanel,{initComponent:function(){GeoNetwork.LegendPanel.superclass.initComponent.call(this)
},onStoreAdd:function(store,records,index){GeoNetwork.LegendPanel.superclass.onStoreAdd.apply(this,arguments);
for(var i=0,len=records.length;
i<len;
i++){var record=records[i];
if(record.get("layer").legendURL!==undefined){record.set("legendURL",record.get("layer").legendURL)
}}}});
Ext.reg("gn_legendpanel",GeoNetwork.LegendPanel);
Ext.namespace("GeoNetwork");
GeoNetwork.ProjectionSelector=function(config){Ext.apply(this,config);
GeoNetwork.ProjectionSelector.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.ProjectionSelector,Ext.form.ComboBox,{projections:null,boxMinWidth:50,width:50,initComponent:function(){GeoNetwork.ProjectionSelector.superclass.initComponent.call(this);
this.on("select",this.reproject,this);
this.valueField="value";
this.autoWidth=false;
this.autoHeight=true;
this.displayField="text";
this.triggerAction="all";
this.mode="local";
this.store=new Ext.data.Store({reader:new Ext.data.ArrayReader({},[{name:"value"},{name:"text"}]),data:this.projections});
this.value=this.map.getProjection();
this.on("expand",function(e){e.innerList.parent().setWidth(e.getWidth());
e.innerList.setWidth(e.getWidth())
})
},reproject:function(combo,record){GeoNetwork.OGCUtil.reprojectMap(this.map,new OpenLayers.Projection(record.get("value")),false)
}});
Ext.reg("gn_projectionselector",GeoNetwork.ProjectionSelector);
Ext.namespace("GeoNetwork");
GeoNetwork.TimeSelector=function(config){Ext.apply(this,config);
GeoNetwork.TimeSelector.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.TimeSelector,Ext.form.FormPanel,{layer:null,numberOfSteps:12,border:false,originalFormat:null,initComponent:function(){this.buttons=[new Ext.Button({text:OpenLayers.i18n("wmsTimeUpdateButtonText"),handler:this.updateValue,scope:this})];
GeoNetwork.TimeSelector.superclass.initComponent.call(this)
},beforeDestroy:function(){this.updateValue();
GeoNetwork.TimeSelector.superclass.beforeDestroy.call(this)
},setLayer:function(layer){this.layer=layer;
this.originalFormat=this.layer.params.FORMAT||this.layer.params.format;
if(this.layer.dimensions&&this.layer.dimensions.time){this.add(new Ext.form.Label({text:OpenLayers.i18n("WMSTimePositionTitle")}));
this.add(new Ext.BoxComponent({height:10}));
this.add(this.createDateTimeField());
if(this.layer.dimensions.time.multipleVal){this.add(new Ext.BoxComponent({height:25}));
this.add(new Ext.form.Label({text:OpenLayers.i18n("WMSTimeMovieTitle")}));
this.add(new Ext.BoxComponent({height:10}));
this.add({xtype:"checkbox",listeners:{check:{fn:this.playMovie,scope:this}},hideLabel:true,boxLabel:OpenLayers.i18n("WMSTimeAnimationCheckbox",{steps:this.numberOfSteps})})
}this.doLayout()
}},getInterval:function(interval){return parseInt(interval.substring(interval.indexOf("PT")+2,interval.indexOf("M")))
},playMovie:function(a,checked){if(checked){var max,interval,timeRange;
if(this.layer.dimensions.time.values&&this.layer.dimensions.time.values.length>0){var values=this.layer.dimensions.time.values[0].split("/");
max=values[1];
interval=this.getInterval(values[2]);
var start=Date.parseDate(max,"c");
start=start-(1000*60*interval*this.numberOfSteps);
start=new Date(start);
timeRange=this.formatTimeAsUTC(start)+"/"+max
}this.layer.mergeNewParams({TIME:timeRange,FORMAT:"image/gif"})
}else{this.updateValue()
}},formatTimeAsUTC:function(dateObj){var dt=dateObj.dateFormat("c");
var utcHours=""+dateObj.getUTCHours();
if(utcHours.length<2){utcHours="0"+utcHours
}dt=dt.replace(dt.substring(dt.indexOf("T"),dt.indexOf("T")+3),"T"+utcHours);
dt=dt.replace(dt.substring(dt.indexOf("+"),dt.indexOf("+")+6),"Z");
return dt
},updateValue:function(){this.layer.mergeNewParams({TIME:this.formatTimeAsUTC(this.getForm().findField("current").getValue()),FORMAT:this.originalFormat})
},createDateTimeField:function(){var min,max,interval;
if(this.layer.dimensions.time.values&&this.layer.dimensions.time.values.length>0){var values=this.layer.dimensions.time.values[0].split("/");
min=values[0];
max=values[1];
interval=this.getInterval(values[2])
}return new Ext.ux.form.DateTime({hiddenFormat:"c",dateFormat:null,hideLabel:true,name:"current",dateConfig:{minValue:Date.parseDate(min,"c"),maxValue:Date.parseDate(max,"c")},timeConfig:{increment:interval},value:(this.layer.params.TIME)?this.layer.params.TIME:this.layer.dimensions.time["default"],width:340})
}});
Ext.reg("gn_timeselector",GeoNetwork.TimeSelector);
Ext.namespace("GeoNetwork");
GeoNetwork.WxSExtractor=Ext.extend(Ext.form.FormPanel,{supportedTypes:["WFS","WCS"],defaultConfig:{border:false,layout:"form",west:-180,south:-90,east:180,north:90,hideCoordinates:false,projection:"EPSG:28992",projectionList:[["EPSG:4326","WGS84"],["EPSG:28992","EPSG:28992"]],version:"1.1.0",versionList:[["1.0.0"],["1.1.0"]],outputFormat:"GML2",preferredOutputFormat:["SHAPE-ZIP","GML2"],downloadCb:function(url,panel){window.open(url)
},updateExtentCb:null,map:null,mapExtentMode:false,type:"WFS"},url:null,layer:null,outputFormatStore:null,projectionStore:null,featureTypeStore:null,versionStore:null,getCapabilitiesUrl:null,layerSelector:null,projectionSelector:null,outputFormatSelector:null,coordinateCtrl:{},boxLayer:null,getCapabilities:function(url,layer,type,version){var panel=this;
this.outputFormatStore.removeAll();
this.featureTypeStore.removeAll();
this.layer=layer||this.layer;
this.type=type||"WFS";
this.version=version||this.version;
this.url=url||this.url;
this.getCapabilitiesUrl=this.url.indexOf("GetCapabilities")!==-1?this.url:this.url+"?REQUEST=GetCapabilities&SERVICE="+this.type+"&VERSION="+this.version;
if(this.type.toUpperCase()=="WFS"){OpenLayers.Request.GET({url:this.getCapabilitiesUrl,success:function(result){var wfsCapabilitiesFormat=null;
var capabilities=null;
try{wfsCapabilitiesFormat=new OpenLayers.Format.WFSCapabilities();
capabilities=wfsCapabilitiesFormat.read(result.responseText)
}catch(err){}if(wfsCapabilitiesFormat){var outputFormats=[];
if(capabilities.operationsMetadata){for(var format in capabilities.operationsMetadata.GetFeature.parameters.outputFormat){if(capabilities.operationsMetadata.GetFeature.parameters.outputFormat.hasOwnProperty(format)){outputFormats.push([encodeURIComponent(format),OpenLayers.i18n(format)])
}}}else{Ext.each(capabilities.capability.request.getfeature.formats,function(format){outputFormats.push([encodeURIComponent(format),OpenLayers.i18n(format)])
})
}}var projections=[];
if(capabilities&&capabilities.featureTypeList&&capabilities.featureTypeList.featureTypes){var tmp=[];
Ext.each(capabilities.featureTypeList.featureTypes,function(projection){var srs=projection.srs;
if(srs.indexOf("EPSG")>0){srs=srs.substring(srs.indexOf("EPSG"))
}if(srs.indexOf("CRS")>0){srs=srs.substring(srs.indexOf("CRS"))
}if(srs.split(":").length>2){var tmp2=srs.split(":");
srs=tmp2[0]+":"+tmp2[tmp2.length-1]
}var p=new OpenLayers.Projection(srs);
if(!tmp.contains(p.getCode())){tmp.push(p.getCode())
}});
Ext.each(tmp,function(p){projections.push([p,p])
})
}else{projections=[["EPSG:4326","WGS84"],["EPSG:28992","EPSG:28992"]]
}panel.outputFormatStore.loadData(outputFormats);
panel.outputFormatSelector.setValue(panel.outputFormatStore.getAt(0).get("id"));
panel.outputFormat=panel.outputFormatSelector.getValue();
panel.projectionStore.loadData(projections);
Ext.getCmp("wxsExtractor").updateExtent();
Ext.getCmp("wxsExtractor").updateMapExtent();
Ext.each(capabilities.featureTypeList.featureTypes,function(feat){var to=new OpenLayers.Projection(projections[0][0]);
var from=new OpenLayers.Projection("EPSG:4326");
feat.bounds.transform(from,to)
});
panel.featureTypeStore.loadData(capabilities.featureTypeList.featureTypes)
},failure:function(response){GeoNetwork.Message().msg({title:OpenLayers.i18n("error"),msg:OpenLayers.i18n("wxs-extract-service-not-found"),tokens:{misc:response.status,url:panel.url},status:"warning",target:panel.getId()})
}})
}else{if(this.type.toUpperCase()=="WCS"){OpenLayers.Request.GET({url:this.getCapabilitiesUrl,success:function(result){var capabilitiesFormat=new OpenLayers.Format.WCSCapabilities();
var capabilities=capabilitiesFormat.read(result.responseText);
var outputFormats=[];
var projections=[];
var coverages=[];
if(capabilities.contentmetadata){var tmp=[];
var no_repeat_layers=[];
Ext.each(capabilities.contentmetadata.coverageofferingbrief,function(coverage){var bound=null;
Ext.each(coverage.envelope.points,function(point){if(bound){bound.extend(point)
}else{bound=new OpenLayers.Bounds(point.x,point.y,point.x,point.y)
}});
var describecoverageurl=panel.getCapabilitiesUrl;
describecoverageurl=describecoverageurl.replace("GetCapabilities","DescribeCoverage");
describecoverageurl=describecoverageurl+"&identifiers="+coverage.identifier;
Ext.Ajax.request({url:describecoverageurl,success:function(dc){var descriptionFormat=new OpenLayers.Format.WCSDescribeCoverage();
var descriptionc=descriptionFormat.read(dc.responseText,{version:"1.1.1"});
if(descriptionc.coverages&&descriptionc.coverages.length>0){var cov=descriptionc.coverages[0];
Ext.each(cov.format,function(f){outputFormats.push([f,OpenLayers.i18n(f)])
});
panel.outputFormatStore.loadData(outputFormats);
panel.outputFormatSelector.setValue(panel.outputFormatStore.getAt(0).get("id"));
panel.outputFormat=panel.outputFormatSelector.getValue();
coverage.identifier=cov.identifier;
Ext.each(cov.spatialDomain,function(domain){Ext.each(domain.envelopes,function(envelope){bound=null;
Ext.each(envelope.points,function(point){if(bound){bound.extend(point)
}else{bound=new OpenLayers.Bounds(point.x,point.y,point.x,point.y)
}srs=envelope.srs;
if(!tmp.contains(srs)){tmp.push(srs)
}if(!no_repeat_layers.contains(coverage.identifier)){no_repeat_layers.push(coverage.identifier);
coverages.push({name:coverage.identifier,title:coverage.title,"abstract":coverage.description,keywords:"",bounds:bound,srs:srs})
}})
})
})
}else{if(!no_repeat_layers.contains(coverage.identifier)){no_repeat_layers.push(coverage.identifier);
coverages.push({name:coverage.identifier,title:coverage.title,"abstract":coverage.description,keywords:"",bounds:bound,srs:srs})
}}var projections=[];
Ext.each(tmp,function(p){projections.push([p,p])
});
if(projections.length>0){panel.projectionStore.loadData(projections)
}panel.featureTypeStore.loadData(coverages)
}})
});
Ext.each(tmp,function(p){projections.push([p,p])
})
}else{projections=[["EPSG:4326","WGS84"],["EPSG:28992","EPSG:28992"]]
}panel.outputFormatStore.loadData(outputFormats);
if(projections.length>0){panel.projectionStore.loadData(projections)
}Ext.getCmp("wxsExtractor").updateExtent();
Ext.getCmp("wxsExtractor").updateMapExtent()
},failure:function(response){GeoNetwork.Message().msg({title:OpenLayers.i18n("error"),msg:OpenLayers.i18n("wxs-extract-service-not-found"),tokens:{misc:response.status,url:panel.url},status:"warning",target:panel.getId()})
}})
}else{GeoNetwork.Message().msg({title:OpenLayers.i18n("error"),msg:OpenLayers.i18n("wxs-extract-service-not-found"),tokens:{misc:"Service '"+this.type+"' unknown",url:panel.url},status:"warning",target:panel.getId()})
}}},getItems:function(){var items=[];
this.layerSelector=new Ext.form.ComboBox({mode:"local",allowBlank:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("chooseALayer"),store:this.featureTypeStore,valueField:"name",displayField:"title",listeners:{change:function(f,newValue,oldValue){this.layer=newValue;
this.updateFeatureTypeInfo(this.layer)
},scope:this}});
items.push(this.layerSelector);
this.projectionSelector=new Ext.form.ComboBox({mode:"local",allowBlank:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("projectionTitle"),store:this.projectionStore,valueField:"id",displayField:"name",listeners:{change:function(f,newValue,oldValue){if(newValue.indexOf("EPSG")>0){newValue=newValue.substring(newValue.indexOf("EPSG"))
}if(newValue.indexOf("CRS")>0){newValue=newValue.substring(newValue.indexOf("CRS"));
if(newValue=="CRS84"){newValue="EPSG:4326"
}}if(newValue.split(":").length>2){var tmp2=newValue.split(":");
newValue=tmp2[0]+":"+tmp2[tmp2.length-1]
}this.projection=newValue;
this.updateExtent()
},scope:this}});
items.push(this.projectionSelector);
items.push(new Ext.form.ComboBox({mode:"local",allowBlank:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("wfsVersion"),store:this.versionStore,valueField:"id",displayField:"id",value:this.version,listeners:{change:function(f,newValue,oldValue){this.version=newValue;
this.getCapabilities()
},scope:this}}));
this.outputFormatSelector=new Ext.form.ComboBox({mode:"local",allowBlank:false,triggerAction:"all",fieldLabel:OpenLayers.i18n("outputFormat"),store:this.outputFormatStore,valueField:"id",displayField:"name",value:this.outputFormat,listeners:{change:function(f,newValue,oldValue){if(newValue.id){this.outputFormat=newValue.id
}else{this.outputFormat=newValue
}},select:function(f,newValue,oldValue){if(newValue.id){this.outputFormat=newValue.id
}else{this.outputFormat=newValue
}},scope:this}});
items.push(this.outputFormatSelector);
var coords=["west","south","east","north"];
Ext.each(coords,function(item){this.coordinateCtrl[item]=new Ext.form.TextField({fieldLabel:OpenLayers.i18n(item),hidden:this.hideCoordinates,listeners:{change:function(f,newValue,oldValue){this.updateMapExtent(item,newValue)
},scope:this}});
items.push(this.coordinateCtrl[item])
},this);
return items
},download:function(extent){var url=this.url+(this.url.indexOf("?")===-1?"?":"");
if(this.type=="WFS"){if(url.indexOf("GetCapabilities")!==-1){url=url.replace(new RegExp("GetCapabilities","g"),"GetFeature")
}else{url+="&REQUEST=GetFeature"
}var downloadUrl=url+"&SERVICE="+this.type+"&VERSION="+this.version+"&TYPENAME="+this.layer+"&BBOX="+this.coordinateCtrl.west.getValue()+","+this.coordinateCtrl.south.getValue()+","+this.coordinateCtrl.east.getValue()+","+this.coordinateCtrl.north.getValue()+"&SRSNAME="+this.projection+"&OUTPUTFORMAT="+this.outputFormat;
this.downloadCb(downloadUrl,this)
}else{if(this.type=="WCS"){if(url.indexOf("?")!==-1){url=url.substring(0,url.indexOf("?"))
}var request={service:this.type,version:this.version,request:"GetCoverage",identifier:this.layerSelector.getValue(),gridCRS:this.projectionSelector.getValue(),boundingBox:this.coordinateCtrl.west.getValue()+","+this.coordinateCtrl.south.getValue()+","+this.coordinateCtrl.east.getValue()+","+this.coordinateCtrl.north.getValue()+","+this.projectionSelector.getValue(),format:this.outputFormatSelector.getValue()};
this.downloadCb(url+"?"+Ext.urlEncode(request),this)
}}},updateExtent:function(newBounds){var bounds=newBounds||this.map.getExtent();
bounds.transform(this.map.getProjection(),new OpenLayers.Projection(this.projection));
var boundsArr=bounds.toArray();
this.updateExtentCoordinates(boundsArr[0],boundsArr[1],boundsArr[2],boundsArr[3])
},updateExtentCoordinates:function(west,south,east,north){this.coordinateCtrl.west.setValue(west);
this.coordinateCtrl.south.setValue(south);
this.coordinateCtrl.east.setValue(east);
this.coordinateCtrl.north.setValue(north)
},updateMapExtent:function(coord,value){if(this.map){var bounds=new OpenLayers.Bounds(this.coordinateCtrl.west.getValue(),this.coordinateCtrl.south.getValue(),this.coordinateCtrl.east.getValue(),this.coordinateCtrl.north.getValue());
bounds.transform(new OpenLayers.Projection(this.projection),this.map.getProjection());
if(this.mapExtentMode){this.map.zoomToExtent(bounds)
}else{var feature=new OpenLayers.Feature.Vector(bounds.toGeometry());
this.boxLayer.destroyFeatures();
this.boxLayer.addFeatures(feature)
}}},updateFeatureTypeInfo:function(featureTypeName){var record=this.featureTypeStore.query("name",featureTypeName,true,false);
var layer=record.items[0];
this.projectionSelector.setValue(this.projectionSelector.getStore().getAt(0).id);
if((record.length===1)||(record.length===2)){this.layerSelector.setValue(layer.get("name"));
var srs=layer.get("srs");
if(srs.indexOf("EPSG")>0){srs=srs.substring(srs.indexOf("EPSG"))
}if(srs.indexOf("CRS")>0){srs=srs.substring(srs.indexOf("CRS"))
}if(srs.split(":").length>2){var tmp2=srs.split(":");
srs=tmp2[0]+":"+tmp2[tmp2.length-1]
}var bounds=layer.get("bounds");
if(bounds){bounds.transform(srs,this.projection);
this.updateExtentCoordinates(bounds.left,bounds.bottom,bounds.right,bounds.top);
this.updateMapExtent()
}}else{GeoNetwork.Message().msg({title:OpenLayers.i18n("warning"),msg:OpenLayers.i18n("wxs-extract-layer-not-found"),tokens:{layer:this.layer,url:this.url},status:"warning",target:this.getId()})
}},initComponent:function(){Ext.applyIf(this,this.defaultConfig);
if(this.type=="WCS"){this.versionList=[["1.0.0"],["1.1.1"]]
}this.outputFormatStore=new Ext.data.ArrayStore({id:0,fields:["id","name"],listeners:{load:function(store,formats){for(var i=0;
i<this.preferredOutputFormat.length;
i++){var preferredFormat=this.preferredOutputFormat[i];
var theFormat=store.query("id",preferredFormat);
if(theFormat.length===1){this.outputFormatSelector.setValue(preferredFormat);
this.outputFormatSelector.fireEvent("change",null,preferredFormat);
break
}}},scope:this}});
this.featureTypeStore=new Ext.data.JsonStore({id:0,fields:["name","title","abstract","keywords","bounds","srs"],listeners:{load:function(store,records){if(this.layer&&this.type!="WCS"){this.updateFeatureTypeInfo(this.layer.split(":").pop())
}else{if(this.type=="WCS"){if(this.layerSelector){this.layerSelector.setValue(store.getAt(0).get("name"))
}}}},scope:this}});
this.projectionStore=new Ext.data.ArrayStore({id:0,fields:["id","name"],data:this.projectionList,listeners:{load:function(store,records){if(this.projectionSelector){this.projectionSelector.setValue(store.getAt(0).get("id"));
this.projection=this.projectionSelector.getValue();
if(this.projection.indexOf("EPSG")>0){this.projection=this.projection.substring(this.projection.indexOf("EPSG"))
}if(this.projection.indexOf("CRS")>0){this.projection=this.projection.substring(this.projection.indexOf("CRS"));
if(this.projection=="CRS84"){this.projection="EPSG:4326"
}}if(this.projection.split(":").length>2){var tmp2=this.projection.split(":");
this.projection=tmp2[0]+":"+tmp2[tmp2.length-1]
}this.updateExtent()
}},scope:this}});
this.versionStore=new Ext.data.ArrayStore({id:0,fields:["id"],data:this.versionList});
this.items=this.getItems();
GeoNetwork.WxSExtractor.superclass.initComponent.call(this);
this.addButton(new Ext.Button({text:OpenLayers.i18n("dataDownload"),iconCls:"WFSDownloadIcon",listeners:{click:this.download,scope:this}}));
if(this.north){this.updateExtentCoordinates(this.west,this.south,this.east,this.north)
}if(this.url){this.getCapabilities(this.url,this.layer,this.type,this.version)
}if(this.map){this.map.addControl(new OpenLayers.Control.Zoom({getOrCreateLinks:function(el){var zoomIn=document.getElementById(this.zoomInId),zoomOut=document.getElementById(this.zoomOutId);
if(!zoomIn){zoomIn=document.createElement("a");
if(Ext.isGecko){zoomIn=document.createElement("button");
zoomIn.type="button"
}zoomIn.appendChild(document.createTextNode(this.zoomInText));
zoomIn.className="olControlZoomIn";
el.appendChild(zoomIn)
}OpenLayers.Element.addClass(zoomIn,"olButton");
if(!zoomOut){zoomOut=document.createElement("a");
if(Ext.isGecko){zoomOut=document.createElement("button");
zoomOut.type="button"
}zoomOut.appendChild(document.createTextNode(this.zoomOutText));
zoomOut.className="olControlZoomOut";
el.appendChild(zoomOut)
}OpenLayers.Element.addClass(zoomOut,"olButton");
return{zoomIn:zoomIn,zoomOut:zoomOut}
}}));
this.map.addControl(new OpenLayers.Control.Navigation());
if(this.mapExtentMode){this.map.events.register("moveend",this,this.updateExtent)
}else{var panel=this;
this.boxLayer=new OpenLayers.Layer.Vector("Data extraction area");
this.boxLayer.events.register("beforefeatureadded",this,function(){this.boxLayer.removeAllFeatures()
});
this.map.addLayer(this.boxLayer);
var control=new OpenLayers.Control.DrawFeature(this.boxLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,citeCompliant:true,irregular:true},featureAdded:function(feature){panel.updateExtent(feature.geometry.getBounds())
}});
this.map.addControl(control);
this.add(new Ext.Button({text:OpenLayers.i18n("defineExtractionArea"),pressed:false,allowDepress:true,toggleGroup:"drawCtr",listeners:{toggle:function(bt,pressed){if(pressed){this.boxLayer.removeAllFeatures();
control.activate()
}else{control.deactivate()
}},scope:this}}));
this.on("beforedestroy",function(){this.map.removeControl(control);
this.map.removeLayer(this.boxLayer)
})
}}}});
Ext.reg("gn_wxsextractor",GeoNetwork.WxSExtractor);
Ext.namespace("GeoNetwork");
GeoNetwork.BaseWindow=function(config){Ext.apply(this,config);
GeoNetwork.BaseWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.BaseWindow,Ext.Window,{map:null,initComponent:function(){GeoNetwork.BaseWindow.superclass.initComponent.call(this);
this.constrainHeader=true;
this.collapsible=true;
this.layout="fit";
this.plain=true;
this.stateful=false
}});
Ext.namespace("GeoNetwork");
GeoNetwork.SingletonWindowManager=function(){var windowsList=new Object();
var hiddenWindows=new Array();
return{registerWindow:function(id,classz,configz){var window1=new classz(configz);
windowsList[id]={windowz:window1,classz:classz,configz:configz}
},getWindow:function(id){if(windowsList[id]){return windowsList[id].windowz
}else{return null
}},showWindow:function(id){if(windowsList[id]){if(Ext.isEmpty(Ext.getCmp(id))){var w=windowsList[id];
var ww=new w.classz(w.configz);
windowsList[id]={windowz:ww,classz:w.classz,configz:w.configz}
}windowsList[id].windowz.show();
return true
}else{return false
}},hideAllWindows:function(){for(key in windowsList){if(windowsList[key].windowz.isVisible()){windowsList[key].windowz.setVisible(false);
hiddenWindows[hiddenWindows.length]=key
}}},restoreHiddenWindows:function(){for(var index=0,len=hiddenWindows.length;
index<len;
++index){windowsList[hiddenWindows[index]].windowz.setVisible(true)
}hiddenWindows=new Array()
}}
};
GeoNetwork.WindowManager=new GeoNetwork.SingletonWindowManager();
Ext.namespace("GeoNetwork");
GeoNetwork.AddWmsLayerWindow=function(config){Ext.apply(this,config);
GeoNetwork.AddWmsLayerWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.AddWmsLayerWindow,GeoNetwork.BaseWindow,{iconCls:"addLayerWindow",browserPanel:null,initComponent:function(){GeoNetwork.AddWmsLayerWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("addWMSWindowTitle");
this.width=600;
this.height=500;
var ds=new Ext.data.Store({data:GeoNetwork.WMSList,reader:new Ext.data.ArrayReader({},[{name:"title"},{name:"url"}])});
this.browserPanel={id:this.id+"wmsbrowserpanel",xtype:"gn_wmsbrowserpanel",mode:GeoNetwork.wms.BrowserPanel.ADDWMS,wmsStore:ds,map:this.map};
var tabs=new Ext.Panel({border:false,deferredRender:false,layout:"fit",items:[this.browserPanel]});
this.add(tabs);
this.doLayout()
}});
Ext.namespace("GeoNetwork");
GeoNetwork.AddWmtsLayerWindow=function(config){Ext.apply(this,config);
GeoNetwork.AddWmtsLayerWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.AddWmtsLayerWindow,GeoNetwork.BaseWindow,{iconCls:"addLayerWindow",browserPanel:null,initComponent:function(){GeoNetwork.AddWmsLayerWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("addWMSWindowTitle");
this.width=600;
this.height=500;
var ds=new Ext.data.Store({data:GeoNetwork.WMSList,reader:new Ext.data.ArrayReader({},[{name:"title"},{name:"url"}])});
this.browserPanel={id:this.id+"wmtsbrowserpanel",xtype:"gn_wmsbrowserpanel",mode:GeoNetwork.wms.BrowserPanel.ADDWMTS,wmsStore:ds,map:this.map};
var tabs=new Ext.Panel({border:false,deferredRender:false,layout:"fit",items:[this.browserPanel]});
this.add(tabs);
this.doLayout()
}});
Ext.namespace("GeoNetwork");
GeoNetwork.FeatureInfoWindow=function(config){Ext.apply(this,config);
GeoNetwork.FeatureInfoWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.FeatureInfoWindow,GeoNetwork.BaseWindow,{control:null,initComponent:function(){GeoNetwork.FeatureInfoWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("featureInfoWindow.windowTitle");
this.width=600;
this.height=250;
this.cls="popup-variant1";
var fp=new GeoNetwork.FeatureInfoPanel();
this.add(fp);
this.doLayout()
},setFeatures:function(featureList){this.items.items[0].showFeatures(featureList)
},setMap:function(map){this.items.items[0].setMap(map)
}});
Ext.namespace("GeoNetwork");
GeoNetwork.LoadWmcWindow=function(config){Ext.apply(this,config);
GeoNetwork.LoadWmcWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.LoadWmcWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.LoadWmcWindow.superclass.initComponent.call(this);
this.width=480;
this.title=this.title||OpenLayers.i18n("selectWMCFile.windowTitle");
this.resizable=false;
this.charset="UTF-8";
var fp=new Ext.FormPanel({fileUpload:true,height:100,bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:0,plain:true,frame:true,border:false,defaults:{anchor:"90%",msgTarget:"side",allowBlank:false},items:[{xtype:"fileuploadfield",id:"form-file",width:120,emptyText:OpenLayers.i18n("selectWMCFile"),hideLabel:true,buttonText:"",name:"Fileconten",buttonCfg:{text:"",iconCls:"selectfile"}}],buttons:[{text:OpenLayers.i18n("selectWMCFile.loadButtonText"),scope:this,handler:function(){if(fp.getForm().isValid()){fp.getForm().submit({url:"../../wmc/load.wmc",success:this.onSuccessLoad,failure:this.onFailure,scope:this})
}}},{text:OpenLayers.i18n("selectWMCFile.mergeButtonText"),scope:this,handler:function(){if(fp.getForm().isValid()){fp.getForm().submit({url:"../../wmc/load.wmc",success:this.onSuccessMerge,failure:this.onFailure,scope:this})
}}}]});
this.add(fp);
this.doLayout()
},onSuccessLoad:function(form,action){var json=action.response.responseText;
var o=Ext.decode(json);
if(o.success){OpenLayers.Request.GET({url:o.url,scope:this,callback:this.parseWMCLoad})
}else{this.onAjaxFailure()
}},onSuccessMerge:function(form,action){var json=action.response.responseText;
var o=Ext.decode(json);
if(o.success){OpenLayers.Request.GET({url:o.url,scope:this,callback:this.parseWMCMerge})
}else{this.onAjaxFailure()
}},onFailure:function(form,action){Ext.MessageBox.show({icon:Ext.MessageBox.ERROR,title:OpenLayers.i18n("errorTitle"),msg:OpenLayers.i18n("InvalidWMC"),buttons:Ext.MessageBox.OK})
},parseWMCLoad:function(response){GeoNetwork.WMCManager.loadWmc(this.map,response.responseText);
Ext.WindowMgr.getActive().close()
},parseWMCMerge:function(response){GeoNetwork.WMCManager.mergeWmc(this.map,response.responseText);
Ext.WindowMgr.getActive().close()
}});
Ext.namespace("GeoNetwork");
GeoNetwork.DisclaimerWindow=function(config){Ext.apply(this,config);
GeoNetwork.DisclaimerWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.DisclaimerWindow,Ext.Window,{disclaimer:null,initComponent:function(){GeoNetwork.BaseWindow.superclass.initComponent.call(this);
this.id="disclaimerwindow";
this.constrainHeader=true;
this.layout="fit";
this.plain=true;
this.stateful=false;
this.title=OpenLayers.i18n("disclaimer.windowTitle");
this.minWidth=440;
this.minHeight=280;
this.width=440;
this.height=280;
this.autoScroll=true;
this.modal=true;
this.addButton(OpenLayers.i18n("disclaimer.buttonClose"),function(){this.close()
},this);
if(OpenLayers.String.startsWith(this.disclaimer,"http://")){this.on("show",this.showDisclaimerUrl)
}else{var textArea=new Ext.form.TextArea({hideLabel:true,name:"msg",value:this.disclaimer,anchor:"100% -53",enableKeyEvents:true,listeners:{keydown:function(field,event){if(!(event.getKey()==67&&event.ctrlKey)){event.stopEvent()
}}}});
this.add(textArea)
}this.doLayout()
},showDisclaimerUrl:function(){this.load({url:OpenLayers.ProxyHost+this.disclaimer,text:OpenLayers.i18n("disclaimer.loading"),timeout:30,scripts:false})
}});
Ext.namespace("GeoNetwork");
GeoNetwork.LayerStylesWindow=function(config){Ext.apply(this,config);
GeoNetwork.LayerStylesWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.LayerStylesWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.LayerStylesWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("layerStylesWindowTitle");
this.width=575;
this.height=300;
this.layerStylesPanel=new GeoNetwork.wms.LayerStylesPanel({map:this.map});
this.add(this.layerStylesPanel);
this.addButton(OpenLayers.i18n("selectStyleButton"),this._selectStyle,this);
this.doLayout()
},showLayerStyles:function(layer){this.layer=layer;
this.layerStylesPanel.showLayerStyles(layer)
},_selectStyle:function(){this.layer.mergeNewParams({styles:this.layerStylesPanel.selectedStyle});
this.layer.legendURL=this.layerStylesPanel.selectedStyleLegendUrl
}});
Ext.namespace("GeoNetwork");
GeoNetwork.WmsLayerMetadataWindow=function(config){Ext.apply(this,config);
GeoNetwork.WmsLayerMetadataWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.WmsLayerMetadataWindow,GeoNetwork.BaseWindow,{layer:null,initComponent:function(){GeoNetwork.WmsLayerMetadataWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("layerInfoPanel.windowTitle");
this.width=575;
this.height=300;
this.infoLayerPanel=new GeoNetwork.wms.LayerInfoPanel({map:this.map});
this.add(this.infoLayerPanel);
this.doLayout()
},showLayerInfo:function(layer){this.infoLayerPanel.layer=layer;
this.infoLayerPanel.metadataId=layer.options.metadata_id;
this.infoLayerPanel.onlineresource=layer.url;
this.infoLayerPanel.showLayerInfo()
}});
Ext.namespace("GeoNetwork");
GeoNetwork.WMSTimeWindow=function(config){Ext.apply(this,config);
GeoNetwork.WMSTimeWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.WMSTimeWindow,GeoNetwork.BaseWindow,{initComponent:function(){GeoNetwork.WMSTimeWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("WMSTimeWindowTitle");
this.width=450;
this.height=300;
this.timeSelector=new GeoNetwork.TimeSelector({bodyStyle:"padding: 10px 10px 0 10px;"});
this.add(this.timeSelector);
this.doLayout()
},setLayer:function(layer){this.timeSelector.setLayer(layer)
}});
if(!window.GeoNetwork){window.GeoNetwork={}
}if(!GeoNetwork.Format){GeoNetwork.Format={}
}GeoNetwork.Format.XLSLUS=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:"1.1.0",version:null,parser:null,initialize:function(options){OpenLayers.Format.XML.prototype.initialize.apply(this,[options])
},writeGeocodeRequest:function(address,options){var version=(options&&options.version)||this.version||this.defaultVersion;
if(!this.parser||this.parser.VERSION!=version){var format=GeoNetwork.Format.XLSLUS["v"+version.replace(/\./g,"_")];
if(!format){throw"Can't find a XLSLUS parser for version "+version
}this.parser=new format(options)
}var root=this.parser.writeGeocodeRequest(address);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},writeReverseGeocodeRequest:function(position,options){var version=(options&&options.version)||this.version||this.defaultVersion;
if(!this.parser||this.parser.VERSION!=version){var format=GeoNetwork.Format.XLSLUS["v"+version.replace(/\./g,"_")];
if(!format){throw"Can't find a XLSLUS parser for version "+version
}this.parser=new format(options)
}var root=this.parser.writeReverseGeocodeRequest(position);
return OpenLayers.Format.XML.prototype.write.apply(this,[root])
},read:function(data,options){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var root=data.documentElement;
var version=this.version;
if(!version){version=root.getAttribute("version");
if(!version){version=this.defaultVersion
}}if(!this.parser||this.parser.VERSION!=version){var format=GeoNetwork.Format.XLSLUS["v"+version.replace(/\./g,"_")];
if(!format){throw"Can't find a XLSLUS parser for version "+version
}this.parser=new format(options)
}var xlslus=this.parser.read(data);
return xlslus
},CLASS_NAME:"GeoNetwork.Format.XLSLUS"});
GeoNetwork.Format.XLSLUS.v1=OpenLayers.Class(OpenLayers.Format.GML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"xls",schemaLocation:null,addressClass:GeoNetwork.Format.XLSAddress,srsName:"EPSG:4326",initialize:function(options){OpenLayers.Format.GML.prototype.initialize.apply(this,[options])
},read:function(data){var xlslus=[];
this.readChildNodes(data,xlslus);
return xlslus
},readers:{xls:{GeocodeResponse:function(node,xlslus){this.readChildNodes(node,xlslus)
},GeocodeResponseList:function(node,xlslus){var responseList={};
responseList.features=[];
responseList.numberOfGeocodedAddresses=node.getAttribute("numberOfGeocodedAddresses");
this.readChildNodes(node,responseList);
xlslus.push(responseList)
},GeocodedAddress:function(node,responseList){var feature=new OpenLayers.Feature.Vector();
this.readChildNodes(node,feature);
responseList.features.push(feature)
},GeocodeMatchCode:function(node,feature){var matchCode={};
matchCode.accuracy=node.getAttribute("accuracy");
matchCode.matchType=node.getAttribute("matchType");
feature.attributes.geocodeMatchCode=matchCode
},ReverseGeocodeResponse:function(node,xlslus){this.readChildNodes(node,xlslus)
},ReverseGeocodedLocation:function(node,xlslus){var feature=new OpenLayers.Feature.Vector();
this.readChildNodes(node,feature);
xlslus.push(feature)
},SearchCentreDistance:function(node,feature){var distance={};
distance.value=node.getAttribute("value");
distance.accuracy=node.getAttribute("accuracy");
distance.uom=node.getAttribute("uom");
if(!distance.uom){distance.uom="M"
}feature.attributes.searchCentreDistance=distance
},Address:function(node,feature){var countryCode=node.getAttribute("countryCode");
var address=new GeoNetwork.Format.XLSAddress(countryCode);
address.addressee=node.getAttribute("addressee");
this.readChildNodes(node,address);
feature.attributes.address=address
},freeFormAddress:function(node,address){address.freeFormAddress=this.getChildValue(node)
},StreetAddress:function(node,address){this.readChildNodes(node,address)
},Building:function(node,address){var building={};
building.number=node.getAttribute("number");
building.subdivision=node.getAttribute("subdivision");
building.buildingName=node.getAttribute("buildingName");
address.building=building
},Street:function(node,address){var street={};
street.name=this.getChildValue(node);
street.directionalPrefix=node.getAttribute("directionalPrefix");
street.typePrefix=node.getAttribute("typePrefix");
street.officialName=node.getAttribute("officialName");
street.typeSuffix=node.getAttribute("typeSuffix");
street.directionalSuffix=node.getAttribute("directionalSuffix");
street.muniOctant=node.getAttribute("muniOctant");
if(!street.directionalPrefix&&!street.typePrefix&&!street.officialName&&!street.typeSuffix&&!street.directionalSuffix&&!street.muniOctant){street=street.name
}address.street.push(street)
},Place:function(node,address){var type=node.getAttribute("type");
address.place[type]=this.getChildValue(node)
},PostalCode:function(node,address){address.postalCode=this.getChildValue(node)
}},gml:{Point:function(node,feature){var parser=this.parseGeometry.point;
var geometry=parser.apply(this,[node]);
if(this.internalProjection&&this.externalProjection){geometry.transform(this.externalProjection,this.internalProjection)
}feature.geometry=geometry
}}},writeGeocodeRequest:function(address){return this.writers.xls.GeocodeRequest.apply(this,[address])
},writeReverseGeocodeRequest:function(position){return this.writers.xls.ReverseGeocodeRequest.apply(this,[position])
},writers:{xls:{GeocodeRequest:function(address){var root=this.createElementNSPlus("GeocodeRequest",{attributes:{"xsi:schemaLocation":this.schemaLocation}});
if(!(address instanceof Array)){address=[address]
}for(var i=0;
i<address.length;
i++){this.writeNode(root,"Address",address[i])
}return root
},ReverseGeocodeRequest:function(position){var root=this.createElementNSPlus("ReverseGeocodeRequest",{attributes:{"xsi:schemaLocation":this.schemaLocation}});
this.writeNode(root,"Position",position);
return root
},Address:function(address){var node=this.createElementNSPlus("Address",{attributes:{countryCode:address.countryCode,addressee:address.addressee}});
if(address.freeFormAddress){this.writeNode(node,"freeFormAddess",address.freeFormAddress)
}else{this.writeNode(node,"StreetAddress",address);
if(address.place){var classification=GeoNetwork.Format.XLSLUS.v1.NamedPlaceClassification;
for(var i=0;
i<classification.length;
i++){if(address.place[classification[i]]){var placeNode=this.writeNode(node,"Place",address.place[classification[i]]);
this.setAttributes(placeNode,{type:classification[i]})
}}}if(address.postalCode){this.writeNode(node,"PostalCode",address.postalCode)
}}return node
},freeFormAddress:function(freeFormAddress){return this.createElementNSPlus("freeFormAddress",{value:freeFormAddress})
},StreetAddress:function(address){var node=this.createElementNSPlus("StreetAddress",{});
if(address.building){this.writeNode(node,"Building",address.building)
}var street=address.street;
if(!(street instanceof Array)){street=[street]
}for(var i=0;
i<street.length;
i++){this.writeNode(node,"Street",street[i])
}return node
},Building:function(building){return this.createElementNSPlus("Building",{attributes:{number:building.number,subdivision:building.subdivision,buildingName:building.buildingName}})
},Street:function(street){if(typeof street=="string"){return this.createElementNSPlus("Street",{value:street})
}else{if(street&&street.name){return this.createElementNSPlus("Street",{value:street.name})
}else{return this.createElementNSPlus("Street",{attributes:{directionalPrefix:street.directionalPrefix,typePrefix:street.typePrefix,officialName:street.officialName,typeSuffix:street.typeSuffix,directionalSuffix:street.directionalSuffix,muniOctant:street.muniOctant}})
}}},Place:function(place){return this.createElementNSPlus("Place",{value:place})
},PostalCode:function(postalCode){return this.createElementNSPlus("PostalCode",{value:postalCode})
},Position:function(position){var node=this.createElementNSPlus("Position",{attributes:{levelOfConf:position.levelOfConf}});
if(position.CLASS_NAME&&position.CLASS_NAME=="OpenLayers.Geometry.Point"){position={point:position}
}this.writeNode(node,"gml:Point",position.point);
if(position.shape){if(position.shape.CLASS_NAME&&position.shape.CLASS_NAME=="OpenLayers.Geometry.Polygon"){this.writeNode(node,"gml:Polygon",position.shape)
}else{if(position.shape.CLASS_NAME&&position.shape.CLASS_NAME=="OpenLayers.Geometry.MultiPolygon"){this.writeNode(node,"gml:MultiPolygon",position.shape)
}}}if(position.qop){}if(position.time){}if(position.speed){}if(position.direction){}return node
}},gml:{Point:function(point){var node=this.createElementNSPlus("gml:Point",{attributes:{srsName:this.srsName}});
this.writeNode(node,"gml:pos",point);
return node
},pos:function(point){return this.createElementNSPlus("gml:pos",{value:point.x+" "+point.y})
},CircleByCenterPoint:function(geometry){},Polygon:function(geometry){return this.buildGeometryNode(geometry)
},MultiPolygon:function(geometry){return this.buildGeometryNode(geometry)
}}},getNamespacePrefix:function(uri){var prefix=null;
if(uri===null){prefix=this.namespaces[this.defaultPrefix]
}else{var gotPrefix=false;
for(prefix in this.namespaces){if(this.namespaces[prefix]==uri){gotPrefix=true;
break
}}if(!gotPrefix){prefix=null
}}return prefix
},readChildNodes:function(node,obj){var children=node.childNodes;
var child,group,reader,prefix,local;
for(var i=0;
i<children.length;
++i){child=children[i];
if(child.nodeType==1){prefix=this.getNamespacePrefix(child.namespaceURI);
local=child.nodeName.split(":").pop();
group=this.readers[prefix];
if(group){reader=group[local];
if(reader){reader.apply(this,[child,obj])
}}}}},writeNode:function(parent,name,obj){var prefix,local;
var split=name.indexOf(":");
if(split>0){prefix=name.substring(0,split);
local=name.substring(split+1)
}else{prefix=this.getNamespacePrefix(parent.namespaceURI);
local=name
}var child=this.writers[prefix][local].apply(this,[obj]);
parent.appendChild(child);
return child
},createElementNSPlus:function(name,options){options=options||{};
var loc=name.indexOf(":");
var uri=options.uri||this.namespaces[options.prefix];
if(!uri){loc=name.indexOf(":");
uri=this.namespaces[name.substring(0,loc)]
}if(!uri){uri=this.namespaces[this.defaultPrefix]
}var node=this.createElementNS(uri,name);
if(options.attributes){this.setAttributes(node,options.attributes)
}if(options.value){node.appendChild(this.createTextNode(options.value))
}return node
},setAttributes:function(node,obj){var value,uri;
for(var name in obj){if(obj[name]){value=obj[name].toString();
uri=this.namespaces[name.substring(0,name.indexOf(":"))]||null;
this.setAttributeNS(node,uri,name,value)
}}},CLASS_NAME:"GeoNetwork.Format.XLSLUS.v1"});
GeoNetwork.Format.XLSLUS.v1.NamedPlaceClassification=["CountrySubDivision","CountrySecondarySubdivision","Municipality","MunicipalitySubdivision"];
GeoNetwork.Format.XLSLUS.v1_1_0=OpenLayers.Class(GeoNetwork.Format.XLSLUS.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",initialize:function(options){GeoNetwork.Format.XLSLUS.v1.prototype.initialize.apply(this,[options])
},CLASS_NAME:"GeoNetwork.Format.XLSLUS.v1_1_0"});
Ext.namespace("GeoNetwork","GeoNetwork.data");
GeoNetwork.data.XLSReader=function(meta,recordType){meta=meta||{};
GeoNetwork.data.XLSReader.superclass.constructor.call(this,meta,recordType||meta.fields)
};
Ext.extend(GeoNetwork.data.XLSReader,Ext.data.DataReader,{read:function(response){var responseText=response.responseText;
if(responseText&&(responseText.indexOf("FAILED")!=-1||responseText.indexOf("Exception")!=-1||responseText.indexOf("No more credits")!=-1)){throw {message:"Server exception received instead of XLS LUS response."}
}var features;
var xlslusFormat=new GeoNetwork.Format.XLSLUS();
var xlslus=xlslusFormat.read(response.responseXML||response.responseText);
features=xlslus;
if(xlslus.length>0&&xlslus[0].features){features=xlslus[0].features
}var records=[];
var distinct=this.meta.distinct;
for(var i=0;
i<features.length;
i++){var feature=features[i];
var text="";
if(feature.attributes.address){text=feature.attributes.address.format()
}var bounds=null;
if(feature.geometry){bounds=feature.geometry.getBounds()
}var id=feature.fid||feature.id;
var values={};
values.value=id;
values.text=text;
values.bbox=bounds;
var record;
if(distinct){if(!this.recordExists(records,text)){record=new Ext.data.Record(values,id);
records.push(record)
}}else{record=new Ext.data.Record(values,id);
records.push(record)
}feature.destroy()
}return this.readRecords(records)
},recordExists:function(array,text){var exists=false;
for(var i=0;
i<array.length;
i++){if(array[i].get("text")==text){exists=true
}}return exists
},readRecords:function(o){return{success:true,records:o}
}});
if(!window.GeoNetwork){window.GeoNetwork={}
}if(!GeoNetwork.Format){GeoNetwork.Format={}
}GeoNetwork.Format.XLSAddress=OpenLayers.Class({addressee:null,countryCode:null,freeFormAddress:null,street:null,building:null,place:null,postalCode:null,initialize:function(countryCode,options){this.street=[];
this.place={CountrySubdivision:null,CountrySecondarySubdivision:null,Municipality:null,MunicipalitySubdivision:null};
OpenLayers.Util.extend(this,options);
this.countryCode=countryCode
},format:function(){if(this.freeFormAddress){return this.freeFormAddress
}else{return this.getStreetText()+" "+this.getBuildingText()+" "+this.getPostalCodeText()+" "+this.getPlaceText()
}},getStreetText:function(address){if(!address){address=this
}var text="";
for(var si=0;
si<address.street.length;
si++){if(text!==""){text+=" "
}text+=address.formatObject(address.street[si],GeoNetwork.Format.XLSAddress.formattedStreetProperties)
}return text
},getBuildingText:function(address){if(!address){address=this
}return address.formatObject(address.building,GeoNetwork.Format.XLSAddress.formattedBuildingProperties)
},getPostalCodeText:function(address){if(!address){address=this
}return !address.postalCode?"":address.postalCode
},getPlaceText:function(address){if(!address){address=this
}return address.formatObject(address.place,GeoNetwork.Format.XLSAddress.formattedPlaceProperties)
},formatObject:function(obj,props){if(!obj){return""
}var text="";
if(typeof obj=="string"){text=obj
}else{if(props instanceof Array){for(var pi=0;
pi<props.length;
pi++){if(obj[props[pi]]){if(text!==""){text+=" "
}text+=obj[props[pi]]
}}}}return text
},CLASS_NAME:"GeoNetwork.Format.XLSAddress"});
GeoNetwork.Format.XLSAddress.formattedPlaceProperties=["Municipality","MunicipalitySubdivision","CountrySecondarySubdivision","CountrySubdivision"];
GeoNetwork.Format.XLSAddress.formattedStreetProperties=["directionalPrefix","typePrefix","officialName","typeSuffix","directionalSuffix","muniOctant"];
GeoNetwork.Format.XLSAddress.formattedBuildingProperties=["number","subdivision","buildingName"];
Ext.namespace("GeoNetwork","GeoNetwork.form");
GeoNetwork.form.SearchOption=function(config){Ext.apply(this,config);
GeoNetwork.form.SearchOption.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.form.SearchOption,Ext.FormPanel,{outputFormat:{type:"XLS",mimetype:"XLS"},requestMethod:"POST",projection:"EPSG:28992",url:"",typename:"",searchfields:[],proxy:null,initComponent:function(){GeoNetwork.form.SearchOption.superclass.initComponent.call(this);
Ext.each(this.searchfields,function(searchfield){if(searchfield.type=="PROPERTYISLIKE"){var field=new Ext.form.TextField({fieldLabel:searchfield.label,name:searchfield.propertyname,autoHeight:true,autoWidth:true});
field.on("specialkey",function(f,e){if(e.getKey()==e.ENTER){this.submitXLSForm()
}},this);
this.add(field)
}},this);
this.addButton({text:OpenLayers.i18n("searchOptionButton"),scope:this,handler:this.submitXLSForm});
this.proxy=new Ext.data.HttpProxy({method:this.requestMethod,xmlData:null,url:this.url});
var fields=["value","text","bbox"];
this.resultStore=new Ext.data.Store({autoLoad:false,id:"value",fields:fields,proxy:this.proxy,reader:new GeoNetwork.data.XLSReader({},fields)});
this.resultStore.on("loadexception",this.loadException,this);
this.resultStore.on("load",function(){if(this.resultStore.getCount()===0){Ext.MessageBox.show({icon:Ext.MessageBox.INFO,title:OpenLayers.i18n("infoTitle"),msg:OpenLayers.i18n("SearchOptionNoResults"),buttons:Ext.MessageBox.OK})
}},this);
this.resultsGrid=new Ext.grid.GridPanel({autoScroll:true,loadMask:true,hideHeaders:true,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),name:"results",store:this.resultStore,clCls:"grid-variant1",title:OpenLayers.i18n("searchResults"),plain:true,columns:[{id:"text",header:"",sortable:true,dataIndex:"text"}],stripeRows:true,autoExpandColumn:"text",height:300,width:325});
this.resultsGrid.getSelectionModel().on("selectionchange",function(selModel){this.zoomToResults()
},this);
this.add(this.resultsGrid)
},submitXLSForm:function(){var params={};
Ext.applyIf(params,this.baseParams);
var form=document.getElementById(this.form.id);
for(var i=0;
i<form.elements.length;
i++){el=form.elements[i];
if(el.name=="results"||el.id=="addPointForGazResult"||el.id=="zoomToGazResult"){continue
}if(el.name==="postalCode"&&el.value.length>0&&el.value.length<6){params[el.name]=el.value+"*"
}else{params[el.name]=el.value
}}var reqBody=undefined;
if(this.requestMethod!="POST"){url=this.url+Ext.urlEncode(params);
this.proxy.setUrl(url)
}else{var xlslusFormat;
if(params.x&&params.y){var position=new OpenLayers.Geometry.Point(params.x,params.y);
xlslusFormat=new GeoNetwork.Format.XLSLUS();
reqBody=xlslusFormat.writeReverseGeocodeRequest(position,{srsName:params.srsName})
}else{var addressParams=this.makeObjectTreeMap(params);
var address=new GeoNetwork.Format.XLSAddress(params.countryCode,addressParams);
xlslusFormat=new GeoNetwork.Format.XLSLUS();
reqBody=xlslusFormat.writeGeocodeRequest(address)
}this.proxy.xmlData=reqBody
}this.resultStore.load();
this.showResult()
},makeObjectTreeMap:function(params){var treeParams={};
for(var attr in params){if(attr){var value=params[attr];
if(value&&value!==""){var attrSplit=attr.split(".");
treeParams[attrSplit[0]]=this.makeObjectTree(treeParams[attrSplit[0]],attrSplit,1,value)
}}}return treeParams
},makeObjectTree:function(obj,attrSplit,index,value){if(index>=attrSplit.length){return value
}var attrName=attrSplit[index];
if(attrName==parseInt(attrName,10)){if(!obj){obj=[]
}attrName=parseInt(attrName,10)
}else{if(!obj){obj={}
}}obj[attrName]=this.makeObjectTree(obj[attrName],attrSplit,index+1,value);
return obj
},loadException:function(proxy,o,response,excp){var responseText=response.responseText;
if(responseText&&(responseText.indexOf("FAILED")!=-1||responseText.indexOf("Exception")!=-1||responseText.indexOf("No more credits")!=-1)){Ext.MessageBox.show({icon:Ext.MessageBox.WARNING,title:OpenLayers.i18n("errorTitle"),msg:OpenLayers.i18n("SearchOptionLoadFailureMsg"),buttons:Ext.MessageBox.OK})
}},showResult:function(){this.resultsGrid.getSelectionModel().clearSelections()
},onDestroy:function(){this.remove(this.resultsGrid);
if(this.vectorLayer&&this.map){this.map.removeLayer(this.vectorLayer)
}if(this.resultStore){this.resultStore.each(function(record){if(record&&record.get("feature")){record.get("feature").destroy()
}},this)
}},zoomToResults:function(){var selRecords=this.resultsGrid.getSelectionModel().getSelections();
if(selRecords.length>0){if(!this.vectorLayer){this.vectorLayer=new OpenLayers.Layer.Vector("gazetteer",{displayInLayerSwitcher:false,style:{pointRadius:5,graphicName:"square",fillColor:"red",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"}});
this.map.addLayer(this.vectorLayer)
}if(this.vectorFeatures){this.vectorLayer.removeFeatures(this.vectorFeatures)
}var point=new OpenLayers.Geometry.Point(selRecords[0].get("bbox").getCenterLonLat().lon,selRecords[0].get("bbox").getCenterLonLat().lat);
var feature=new OpenLayers.Feature.Vector(point,null);
this.vectorFeatures=feature;
this.vectorLayer.addFeatures(this.vectorFeatures);
var bbox=selRecords[0].get("bbox");
for(i=0;
i<selRecords.length;
i++){var newBbox=selRecords[i].get("bbox");
bbox.left=Math.min(bbox.left,newBbox.left);
bbox.bottom=Math.min(bbox.bottom,newBbox.bottom);
bbox.right=Math.max(bbox.right,newBbox.right);
bbox.top=Math.max(bbox.top,newBbox.top)
}var buffer=5;
bbox.left=bbox.left-buffer;
bbox.bottom=bbox.bottom-buffer;
bbox.right=bbox.right+buffer;
bbox.top=bbox.top+buffer;
if(this.projection!=this.map.getProjection()){bbox=bbox.transform(new OpenLayers.Projection(this.projection),this.map.getProjectionObject())
}this.map.zoomToExtent(bbox)
}}});
Ext.reg("gn_searchoption",GeoNetwork.form.SearchOption);
Ext.namespace("GeoNetwork");
GeoNetwork.GazetteerWindow=function(config){Ext.apply(this,config);
GeoNetwork.GazetteerWindow.superclass.constructor.call(this)
};
Ext.extend(GeoNetwork.GazetteerWindow,GeoNetwork.BaseWindow,{initComponent:function(){this.iconCls="searchIcon";
GeoNetwork.GazetteerWindow.superclass.initComponent.call(this);
this.title=this.title||OpenLayers.i18n("GazetteerWindowTitle");
this.width=350;
this.height=500;
this.add({xtype:"gn_searchoption",map:this.map,url:GeoNetwork.GEOCODER_URL,typename:"adressen",requestMethod:"GET",baseParams:{countryCode:"NL"},searchfields:[{type:"PROPERTYISLIKE",propertyname:"zoekterm",label:OpenLayers.i18n("address")}]});
this.doLayout()
}});
OpenLayers.Format.WCSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WCSCapabilities"});
OpenLayers.Format.WCSDescribeCoverage=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WCSDescribeCoverage"});
OpenLayers.Format.WCSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{WCS:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",gml:"http://www.opengis.net/gml"},defaultPrefix:"WCS",regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),featureMember:(/^(.*:)?featureMembers?$/)},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var raw=data;
if(data&&data.nodeType==9){data=data.documentElement
}var capabilities={};
this.readNode(data,capabilities);
if(capabilities.service===undefined){var parser=new OpenLayers.Format.OGCExceptionReport();
capabilities.error=parser.read(raw)
}return capabilities
},readers:{gml:new (OpenLayers.Class(OpenLayers.Format.GML.v3,{pos:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var point;
if(this.xy){point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{point=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}if(!obj.points){obj.points=[]
}obj.points.push(point)
},timePosition:function(node,obj){if(!obj.time){obj.time=[]
}obj.time.push(this.getChildValue(node))
}}))(),WCS:{WCS_Capabilities:function(node,obj){this.readChildNodes(node,obj)
},Service:function(node,obj){obj.service={};
this.readChildNodes(node,obj.service)
},fees:function(node,obj){obj.fees=this.getChildValue(node)
},accessConstraints:function(node,obj){obj.accessconstraints=this.getChildValue(node)
},Capability:function(node,obj){obj.capability={};
this.readChildNodes(node,obj.capability)
},Request:function(node,obj){obj.request={};
this.readChildNodes(node,obj.request)
},Exception:function(node,obj){obj.exception={};
this.readChildNodes(node,obj.exception)
},Format:function(node,obj){if(OpenLayers.Util.isArray(obj.formats)){obj.formats.push(this.getChildValue(node))
}else{obj.format=this.getChildValue(node)
}},GetCapabilities:function(node,obj){obj.getcapabilities={};
this.readChildNodes(node,obj.getcapabilities)
},DCPType:function(node,obj){this.readChildNodes(node,obj)
},HTTP:function(node,obj){this.readChildNodes(node,obj)
},Get:function(node,obj){obj.get={};
this.readChildNodes(node,obj.get);
if(!obj.href){obj.href=obj.get.href
}},Post:function(node,obj){obj.post={};
this.readChildNodes(node,obj.post);
if(!obj.href){obj.href=obj.get.href
}},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")
},DescribeCoverage:function(node,obj){obj.describecoverage={};
this.readChildNodes(node,obj.describecoverage)
},GetCoverage:function(node,obj){obj.getcoverage={};
this.readChildNodes(node,obj.getcoverage)
},ContentMetadata:function(node,obj){obj.contentmetadata={};
this.readChildNodes(node,obj.contentmetadata)
},CoverageOfferingBrief:function(node,obj){var coverage={};
this.readChildNodes(node,coverage);
if(!obj.coverageofferingbrief){obj.coverageofferingbrief=[]
}obj.coverageofferingbrief.push(coverage)
},description:function(node,obj){obj.description=this.getChildValue(node)
},label:function(node,obj){obj.label=this.getChildValue(node)
},lonLatEnvelope:function(node,obj){obj.envelope={};
obj.envelope.srs=this.getAttributeNS(node,"","srsName");
this.readChildNodes(node,obj.envelope)
},Name:function(node,obj){obj.name=this.getChildValue(node)
},name:function(node,obj){obj.name=this.getChildValue(node)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,obj){obj["abstract"]=this.getChildValue(node)
},BoundingBox:function(node,obj){var bbox={};
bbox.bbox=[parseFloat(node.getAttribute("minx")),parseFloat(node.getAttribute("miny")),parseFloat(node.getAttribute("maxx")),parseFloat(node.getAttribute("maxy"))];
var res={x:parseFloat(node.getAttribute("resx")),y:parseFloat(node.getAttribute("resy"))};
if(!(isNaN(res.x)&&isNaN(res.y))){bbox.res=res
}return bbox
},ContactInformation:function(node,obj){obj.contactInformation={};
this.readChildNodes(node,obj.contactInformation)
},ContactPersonPrimary:function(node,obj){obj.personPrimary={};
this.readChildNodes(node,obj.personPrimary)
},ContactPerson:function(node,obj){obj.person=this.getChildValue(node)
},ContactOrganization:function(node,obj){obj.organization=this.getChildValue(node)
},ContactPosition:function(node,obj){obj.position=this.getChildValue(node)
},ContactAddress:function(node,obj){obj.contactAddress={};
this.readChildNodes(node,obj.contactAddress)
},AddressType:function(node,obj){obj.type=this.getChildValue(node)
},Address:function(node,obj){obj.address=this.getChildValue(node)
},City:function(node,obj){obj.city=this.getChildValue(node)
},StateOrProvince:function(node,obj){obj.stateOrProvince=this.getChildValue(node)
},PostCode:function(node,obj){obj.postcode=this.getChildValue(node)
},Country:function(node,obj){obj.country=this.getChildValue(node)
},ContactVoiceTelephone:function(node,obj){obj.phone=this.getChildValue(node)
},ContactFacsimileTelephone:function(node,obj){obj.fax=this.getChildValue(node)
},ContactElectronicMailAddress:function(node,obj){obj.email=this.getChildValue(node)
},Fees:function(node,obj){var fees=this.getChildValue(node);
if(fees&&fees.toLowerCase()!="none"){obj.fees=fees
}},AccessConstraints:function(node,obj){var constraints=this.getChildValue(node);
if(constraints&&constraints.toLowerCase()!="none"){obj.accessConstraints=constraints
}},Attribution:function(node,obj){obj.attribution={};
this.readChildNodes(node,obj.attribution)
},LogoURL:function(node,obj){obj.logo={width:node.getAttribute("width"),height:node.getAttribute("height")};
this.readChildNodes(node,obj.logo)
},Style:function(node,obj){var style={};
obj.styles.push(style);
this.readChildNodes(node,style)
},LegendURL:function(node,obj){var legend={width:node.getAttribute("width"),height:node.getAttribute("height")};
obj.legend=legend;
this.readChildNodes(node,legend)
},MetadataURL:function(node,obj){var metadataURL={type:node.getAttribute("type")};
obj.metadataURLs.push(metadataURL);
this.readChildNodes(node,metadataURL)
},DataURL:function(node,obj){obj.dataURL={};
this.readChildNodes(node,obj.dataURL)
},FeatureListURL:function(node,obj){obj.featureListURL={};
this.readChildNodes(node,obj.featureListURL)
},AuthorityURL:function(node,obj){var name=node.getAttribute("name");
var authority={};
this.readChildNodes(node,authority);
obj.authorityURLs[name]=authority.href
},Identifier:function(node,obj){var authority=node.getAttribute("authority");
obj.identifiers[authority]=this.getChildValue(node)
},KeywordList:function(node,obj){this.readChildNodes(node,obj)
},SRS:function(node,obj){obj.srs[this.getChildValue(node)]=true
}}},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_0_0"});
OpenLayers.Format.WCSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1_0_0,{CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_1_1",namespaces:{WCS:"http://www.opengis.net/wcs/1.1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",gml:"http://www.opengis.net/gml",ows:"http://www.opengis.net/ows/1.1",ogc:"http://www.opengis.net/ogc"},readers:{ows:{WGS84BoundingBox:function(node,obj){obj.envelope={};
obj.envelope.srs="EPSG:4326";
this.readChildNodes(node,obj.envelope)
},LowerCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var point;
if(this.xy){point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{point=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}if(!obj.points){obj.points=[]
}obj.points.push(point)
},UpperCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var point;
if(this.xy){point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{point=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}if(!obj.points){obj.points=[]
}obj.points.push(point)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,obj){obj["abstract"]=this.getChildValue(node)
},DCP:function(node,obj){this.readChildNodes(node,obj)
},HTTP:function(node,obj){this.readChildNodes(node,obj)
},Get:function(node,obj){if(!obj.get){obj.get=[]
}obj.get.href=this.getAttributeNS(node,"","xlink:href")
},Post:function(node,obj){if(!obj.post){obj.post=[]
}obj.post.href=this.getAttributeNS(node,"","xlink:href")
},Operation:function(node,obj){var operation={};
this.readChildNodes(node,operation);
if(!obj.operations){obj.operations=[]
}obj.operations.push(operation)
},OperationsMetadata:function(node,obj){this.readChildNodes(node,obj)
},ServiceIdentification:function(node,obj){if(!obj.service){obj.service={}
}this.readChildNodes(node,obj.service)
},Fees:function(node,obj){obj.fees=this.getChildValue(node)
},AccessConstraints:function(node,obj){obj.accessconstraints=this.getChildValue(node)
}},gml:new (OpenLayers.Class(OpenLayers.Format.GML.v3,{pos:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var point;
if(this.xy){point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{point=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}if(!obj.points){obj.points=[]
}obj.points.push(point)
},timePosition:function(node,obj){if(!obj.time){obj.time=[]
}obj.time.push(this.getChildValue(node))
}}))(),WCS:{WCS_Capabilities:function(node,obj){this.readChildNodes(node,obj)
},Capabilities:function(node,obj){this.readChildNodes(node,obj)
},Service:function(node,obj){if(!obj.service){obj.service={}
}this.readChildNodes(node,obj.service)
},Capability:function(node,obj){obj.capability={};
this.readChildNodes(node,obj.capability)
},Request:function(node,obj){obj.request={};
this.readChildNodes(node,obj.request)
},Exception:function(node,obj){obj.exception={};
this.readChildNodes(node,obj.exception)
},Format:function(node,obj){if(OpenLayers.Util.isArray(obj.formats)){obj.formats.push(this.getChildValue(node))
}else{obj.format=this.getChildValue(node)
}},GetCapabilities:function(node,obj){obj.getcapabilities={};
this.readChildNodes(node,obj.getcapabilities)
},DCPType:function(node,obj){this.readChildNodes(node,obj)
},HTTP:function(node,obj){this.readChildNodes(node,obj)
},Get:function(node,obj){obj.get={};
this.readChildNodes(node,obj.get);
if(!obj.href){obj.href=obj.get.href
}},Post:function(node,obj){obj.post={};
this.readChildNodes(node,obj.post);
if(!obj.href){obj.href=obj.get.href
}},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")
},DescribeCoverage:function(node,obj){obj.describecoverage={};
this.readChildNodes(node,obj.describecoverage)
},GetCoverage:function(node,obj){obj.getcoverage={};
this.readChildNodes(node,obj.getcoverage)
},Contents:function(node,obj){obj.contentmetadata={};
this.readChildNodes(node,obj.contentmetadata)
},CoverageSummary:function(node,obj){var coverage={};
this.readChildNodes(node,coverage);
if(!obj.coverageofferingbrief){obj.coverageofferingbrief=[]
}obj.coverageofferingbrief.push(coverage)
},description:function(node,obj){obj.description=this.getChildValue(node)
},label:function(node,obj){obj.label=this.getChildValue(node)
},lonLatEnvelope:function(node,obj){obj.envelope={};
obj.envelope.srs=this.getAttributeNS(node,"","srsName");
this.readChildNodes(node,obj.envelope)
},Name:function(node,obj){obj.name=this.getChildValue(node)
},name:function(node,obj){obj.name=this.getChildValue(node)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,obj){obj["abstract"]=this.getChildValue(node)
},ContactInformation:function(node,obj){obj.contactInformation={};
this.readChildNodes(node,obj.contactInformation)
},ContactPersonPrimary:function(node,obj){obj.personPrimary={};
this.readChildNodes(node,obj.personPrimary)
},ContactPerson:function(node,obj){obj.person=this.getChildValue(node)
},ContactOrganization:function(node,obj){obj.organization=this.getChildValue(node)
},ContactPosition:function(node,obj){obj.position=this.getChildValue(node)
},ContactAddress:function(node,obj){obj.contactAddress={};
this.readChildNodes(node,obj.contactAddress)
},AddressType:function(node,obj){obj.type=this.getChildValue(node)
},Address:function(node,obj){obj.address=this.getChildValue(node)
},City:function(node,obj){obj.city=this.getChildValue(node)
},StateOrProvince:function(node,obj){obj.stateOrProvince=this.getChildValue(node)
},PostCode:function(node,obj){obj.postcode=this.getChildValue(node)
},Country:function(node,obj){obj.country=this.getChildValue(node)
},ContactVoiceTelephone:function(node,obj){obj.phone=this.getChildValue(node)
},ContactFacsimileTelephone:function(node,obj){obj.fax=this.getChildValue(node)
},ContactElectronicMailAddress:function(node,obj){obj.email=this.getChildValue(node)
},Fees:function(node,obj){var fees=this.getChildValue(node);
if(fees&&fees.toLowerCase()!="none"){obj.fees=fees
}},AccessConstraints:function(node,obj){var constraints=this.getChildValue(node);
if(constraints&&constraints.toLowerCase()!="none"){obj.accessConstraints=constraints
}},Attribution:function(node,obj){obj.attribution={};
this.readChildNodes(node,obj.attribution)
},LogoURL:function(node,obj){obj.logo={width:node.getAttribute("width"),height:node.getAttribute("height")};
this.readChildNodes(node,obj.logo)
},Style:function(node,obj){var style={};
obj.styles.push(style);
this.readChildNodes(node,style)
},LegendURL:function(node,obj){var legend={width:node.getAttribute("width"),height:node.getAttribute("height")};
obj.legend=legend;
this.readChildNodes(node,legend)
},MetadataURL:function(node,obj){var metadataURL={type:node.getAttribute("type")};
obj.metadataURLs.push(metadataURL);
this.readChildNodes(node,metadataURL)
},DataURL:function(node,obj){obj.dataURL={};
this.readChildNodes(node,obj.dataURL)
},FeatureListURL:function(node,obj){obj.featureListURL={};
this.readChildNodes(node,obj.featureListURL)
},AuthorityURL:function(node,obj){var name=node.getAttribute("name");
var authority={};
this.readChildNodes(node,authority);
obj.authorityURLs[name]=authority.href
},Identifier:function(node,obj){obj.identifier=this.getChildValue(node)
},KeywordList:function(node,obj){this.readChildNodes(node,obj)
},SRS:function(node,obj){obj.srs[this.getChildValue(node)]=true
}}}});
OpenLayers.Format.WCSDescribeCoverage.v1_1_1=OpenLayers.Class(OpenLayers.Format.XML,{CLASS_NAME:"OpenLayers.Format.WCSDescribeCoverage.v1_1_1",namespaces:{WCS:"http://www.opengis.net/wcs/1.1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",gml:"http://www.opengis.net/gml",ows:"http://www.opengis.net/ows/1.1",ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:(/^\s*|\s*$/g),removeSpace:(/\s*/g),splitSpace:(/\s+/),trimComma:(/\s*,\s*/g),featureMember:(/^(.*:)?featureMembers?$/)},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data])
}var raw=data;
if(data&&data.nodeType==9){data=data.documentElement
}var capabilities={};
this.readNode(data,capabilities);
if(capabilities.service===undefined){var parser=new OpenLayers.Format.OGCExceptionReport();
capabilities.error=parser.read(raw)
}return capabilities
},readers:{ows:{BoundingBox:function(node,obj){var envelope={};
envelope.srs=this.getAttributeNS(node,"","crs");
this.readChildNodes(node,envelope);
if(!obj.envelopes){obj.envelopes=[]
}obj.envelopes.push(envelope)
},LowerCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var point;
if(this.xy){point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{point=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}if(!obj.points){obj.points=[]
}obj.points.push(point)
},UpperCorner:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var point;
if(this.xy){point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{point=new OpenLayers.Geometry.Point(coords[1],coords[0],coords[2])
}if(!obj.points){obj.points=[]
}obj.points.push(point)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,obj){obj["abstract"]=this.getChildValue(node)
},DCP:function(node,obj){this.readChildNodes(node,obj)
},HTTP:function(node,obj){this.readChildNodes(node,obj)
},Get:function(node,obj){if(!obj.get){obj.get=[]
}obj.get.href=this.getAttributeNS(node,"","xlink:href")
},Post:function(node,obj){if(!obj.post){obj.post=[]
}obj.post.href=this.getAttributeNS(node,"","xlink:href")
},Operation:function(node,obj){var operation={};
this.readChildNodes(node,operation);
if(!obj.operations){obj.operations=[]
}obj.operations.push(operation)
},OperationsMetadata:function(node,obj){this.readChildNodes(node,obj)
},ServiceIdentification:function(node,obj){if(!obj.service){obj.service={}
}this.readChildNodes(node,obj.service)
},Fees:function(node,obj){obj.fees=this.getChildValue(node)
},AccessConstraints:function(node,obj){obj.accessconstraints=this.getChildValue(node)
}},gml:new (OpenLayers.Class(OpenLayers.Format.GML.v3,{pos:function(node,obj){var str=this.getChildValue(node).replace(this.regExes.trimSpace,"");
var coords=str.split(this.regExes.splitSpace);
var point;
if(this.xy){point=new OpenLayers.Geometry.Point(coords[0],coords[1],coords[2])
}else{point=new OpenLayers.Geometry.Point(coords[1],coospatrds[0],coords[2])
}if(!obj.points){obj.points=[]
}obj.points.push(point)
},timePosition:function(node,obj){if(!obj.time){obj.time=[]
}obj.time.push(this.getChildValue(node))
}}))(),WCS:{CoverageDescriptions:function(node,obj){this.readChildNodes(node,obj)
},CoverageDescription:function(node,obj){var coverage={};
this.readChildNodes(node,coverage);
if(!obj.coverages){obj.coverages=[]
}obj.coverages.push(coverage)
},Domain:function(node,obj){this.readChildNodes(node,obj)
},SpatialDomain:function(node,obj){if(!obj.spatialDomain){obj.spatialDomain=[]
}var domain={};
this.readChildNodes(node,domain);
obj.spatialDomain.push(domain)
},TimeDomain:function(node,obj){if(!obj.timeDomain){obj.timeDomain=[]
}var domain={};
this.readChildNodes(node,domain);
obj.timeDomain.push(domain)
},Service:function(node,obj){if(!obj.service){obj.service={}
}this.readChildNodes(node,obj.service)
},Capability:function(node,obj){obj.capability={};
this.readChildNodes(node,obj.capability)
},Request:function(node,obj){obj.request={};
this.readChildNodes(node,obj.request)
},Exception:function(node,obj){obj.exception={};
this.readChildNodes(node,obj.exception)
},Format:function(node,obj){if(OpenLayers.Util.isArray(obj.formats)){obj.formats.push(this.getChildValue(node))
}else{obj.format=this.getChildValue(node)
}},GetDescribeCoverage:function(node,obj){obj.getDescribeCoverage={};
this.readChildNodes(node,obj.getDescribeCoverage)
},DCPType:function(node,obj){this.readChildNodes(node,obj)
},HTTP:function(node,obj){this.readChildNodes(node,obj)
},Get:function(node,obj){obj.get={};
this.readChildNodes(node,obj.get);
if(!obj.href){obj.href=obj.get.href
}},Post:function(node,obj){obj.post={};
this.readChildNodes(node,obj.post);
if(!obj.href){obj.href=obj.get.href
}},OnlineResource:function(node,obj){obj.href=this.getAttributeNS(node,this.namespaces.xlink,"href")
},DescribeCoverage:function(node,obj){obj.describecoverage={};
this.readChildNodes(node,obj.describecoverage)
},GetCoverage:function(node,obj){obj.getcoverage={};
this.readChildNodes(node,obj.getcoverage)
},Contents:function(node,obj){obj.contentmetadata={};
this.readChildNodes(node,obj.contentmetadata)
},CoverageSummary:function(node,obj){var coverage={};
this.readChildNodes(node,coverage);
if(!obj.coverageofferingbrief){obj.coverageofferingbrief=[]
}obj.coverageofferingbrief.push(coverage)
},description:function(node,obj){obj.description=this.getChildValue(node)
},label:function(node,obj){obj.label=this.getChildValue(node)
},lonLatEnvelope:function(node,obj){obj.envelope={};
obj.envelope.srs=this.getAttributeNS(node,"","srsName");
this.readChildNodes(node,obj.envelope)
},Name:function(node,obj){obj.name=this.getChildValue(node)
},name:function(node,obj){obj.name=this.getChildValue(node)
},Title:function(node,obj){obj.title=this.getChildValue(node)
},Abstract:function(node,obj){obj["abstract"]=this.getChildValue(node)
},ContactInformation:function(node,obj){obj.contactInformation={};
this.readChildNodes(node,obj.contactInformation)
},ContactPersonPrimary:function(node,obj){obj.personPrimary={};
this.readChildNodes(node,obj.personPrimary)
},ContactPerson:function(node,obj){obj.person=this.getChildValue(node)
},ContactOrganization:function(node,obj){obj.organization=this.getChildValue(node)
},ContactPosition:function(node,obj){obj.position=this.getChildValue(node)
},ContactAddress:function(node,obj){obj.contactAddress={};
this.readChildNodes(node,obj.contactAddress)
},AddressType:function(node,obj){obj.type=this.getChildValue(node)
},Address:function(node,obj){obj.address=this.getChildValue(node)
},City:function(node,obj){obj.city=this.getChildValue(node)
},StateOrProvince:function(node,obj){obj.stateOrProvince=this.getChildValue(node)
},PostCode:function(node,obj){obj.postcode=this.getChildValue(node)
},Country:function(node,obj){obj.country=this.getChildValue(node)
},ContactVoiceTelephone:function(node,obj){obj.phone=this.getChildValue(node)
},ContactFacsimileTelephone:function(node,obj){obj.fax=this.getChildValue(node)
},ContactElectronicMailAddress:function(node,obj){obj.email=this.getChildValue(node)
},Fees:function(node,obj){var fees=this.getChildValue(node);
if(fees&&fees.toLowerCase()!="none"){obj.fees=fees
}},AccessConstraints:function(node,obj){var constraints=this.getChildValue(node);
if(constraints&&constraints.toLowerCase()!="none"){obj.accessConstraints=constraints
}},Attribution:function(node,obj){obj.attribution={};
this.readChildNodes(node,obj.attribution)
},LogoURL:function(node,obj){obj.logo={width:node.getAttribute("width"),height:node.getAttribute("height")};
this.readChildNodes(node,obj.logo)
},Style:function(node,obj){var style={};
obj.styles.push(style);
this.readChildNodes(node,style)
},LegendURL:function(node,obj){var legend={width:node.getAttribute("width"),height:node.getAttribute("height")};
obj.legend=legend;
this.readChildNodes(node,legend)
},MetadataURL:function(node,obj){var metadataURL={type:node.getAttribute("type")};
obj.metadataURLs.push(metadataURL);
this.readChildNodes(node,metadataURL)
},DataURL:function(node,obj){obj.dataURL={};
this.readChildNodes(node,obj.dataURL)
},FeatureListURL:function(node,obj){obj.featureListURL={};
this.readChildNodes(node,obj.featureListURL)
},AuthorityURL:function(node,obj){var name=node.getAttribute("name");
var authority={};
this.readChildNodes(node,authority);
obj.authorityURLs[name]=authority.href
},Identifier:function(node,obj){obj.identifier=this.getChildValue(node)
},KeywordList:function(node,obj){this.readChildNodes(node,obj)
},SRS:function(node,obj){obj.srs[this.getChildValue(node)]=true
},SupportedCRS:function(node,obj){if(!obj.crs){obj.crs=[]
}obj.crs[this.getChildValue(node)]=true
},SupportedFormat:function(node,obj){if(!obj.format){obj.format=[]
}obj.format.push(this.getChildValue(node))
}}}});
function hide(id){if(Ext.get(id)){Ext.get(id).setVisibilityMode(Ext.Element.DISPLAY);
Ext.get(id).hide()
}}function show(id){if(Ext.get(id)){Ext.get(id).setVisibilityMode(Ext.Element.DISPLAY);
Ext.get(id).show()
}}function toggleLogin(){toggle("login-form");
Ext.get("username").focus()
}function toggle(id){if(Ext.get(id)){if(Ext.get(id).isDisplayed()){hide(id)
}else{show(id)
}}}function showBrowse(){catalogue.kvpSearch("fast=index&from=1&to=5&sortBy=changeDate",null,null,null,true);
show("main");
show("search-form");
hide("pdok-loads");
hide("foot-loads");
hideSearch();
hideBigMap();
hideMetadata();
show("browser");
show("latest-metadata");
show("popular-metadata");
app.breadcrumb.setPrevious([]);
app.breadcrumb.setCurrent(app.breadcrumb.defaultSteps[0]);
Ext.get("pdok-loads").update("");
Ext.get("foot-loads").update("");
Ext.each(Ext.query("a",Ext.get("main-navigation").dom),function(a){Ext.get(a).removeClass("selected")
});
Ext.get("browse-tab").addClass("selected");
hideAdvancedSearch()
}function hideBrowse(){hide("browser");
hide("latest-metadata");
hide("popular-metadata")
}function showBigMap(){hideBrowse();
hideSearch();
hideAdvancedSearch();
hideMetadata();
show("search-form");
hide("advanced-search-options");
show("show-advanced");
show("big-map-container");
resizeMap();
app.breadcrumb.setCurrent({text:OpenLayers.i18n("Map"),func:"showBigMap()"});
app.mapApp.initPrint();
setTimeout(function(){Ext.getCmp("toctree").expand()
},50);
if(app.mapApp.maps[0].getCenter().lon<100){app.mapApp.maps[0].moveTo(GeoNetwork.map.MAP_OPTIONS.center,2)
}}function hideBigMap(){hide("big-map-container")
}function showSearch(){hideBrowse();
hideMetadata();
hideBigMap();
show("search-form");
show("mini-map");
show("bread-crumb-div");
show("secondary-aside");
Ext.getCmp("resultsPanel").show();
Ext.get("resultsPanel").show();
show("main-aside");
app.breadcrumb.setDefaultPrevious(1);
app.breadcrumb.setCurrent(app.breadcrumb.defaultSteps[1]);
if(!app.searchApp.firstSearch){app.searchApp.firstSearch=true;
Ext.getCmp("advanced-search-options-content-form").fireEvent("search")
}if(Ext.getCmp("advanced-search-options-content-form")){Ext.getCmp("advanced-search-options-content-form").doLayout(false,true)
}resizeResultsPanel()
}function hideSearch(){hide("mini-map");
hide("secondary-aside");
hide("resultsPanel");
hide("main-aside");
hide("bread-crumb-div")
}function showMetadata(){show("search-form");
hideBrowse();
hideSearch();
hideBigMap();
hideAdvancedSearch();
show("metadata-info");
app.breadcrumb.setDefaultPrevious(2)
}function hideMetadata(){hide("metadata-info");
hide("share-capabilities");
Ext.getCmp("metadata-panel")&&Ext.getCmp("metadata-panel").destroy();
Ext.getCmp("editorPanel")&&Ext.getCmp("editorPanel").destroy()
}function resizeResultsPanel(){var resultsPanel=Ext.get("resultsPanel");
if(!resultsPanel){return
}var mainAsideWidth=0;
if(Ext.get("main-aside")){mainAsideWidth=Ext.get("main-aside").getWidth()
}resultsPanel.setWidth(Ext.getBody().getWidth()-mainAsideWidth-320);
resultsPanel.setWidth(resultsPanel.getWidth());
Ext.each(resultsPanel.dom.children,function(div){div=Ext.get(div);
Ext.each(div.dom.children,function(child){child=Ext.get(child);
child.setWidth("100%");
Ext.each(child.dom.children,function(gchild){Ext.get(gchild).setWidth("100%")
})
})
})
}function resizeAdvancedSearchResults(){var advSO=Ext.get("advanced-search-options");
if(Ext.isIE8||Ext.isIE7){var width=advSO.parent().getWidth();
width=width-200;
if(width>100){advSO.setWidth(width)
}}var adv=Ext.get("advSearchTabs");
if(adv){adv.setWidth();
Ext.each(Ext.query(".x-box-layout-ct",adv.dom),function(el){Ext.get(el).setWidth()
});
Ext.each(Ext.query(".x-box-inner",adv.dom),function(el){Ext.get(el).setWidth()
});
Ext.each(Ext.query(".x-panel-btns",advSO.dom),function(el){Ext.get(el).setWidth()
})
}}function resizeMap(){if(Ext.getCmp("big-map")){Ext.getCmp("big-map").doLayout(false,true);
var div=Ext.get("big-map");
var setChildrens=function(children){Ext.each(children,function(child){child=Ext.get(child);
var classN=child.dom.className;
if(classN&&classN.indexOf&&(classN.indexOf("tbar")<0&&classN.indexOf("x-panel-header")<0)){child.setHeight("100%");
if(child.id&&(child.id.indexOf("ViewPort")<0&&child.id.indexOf("layerManager")<0)){setChildrens(child.dom.children)
}}})
};
var height=Ext.getBody().getHeight()-Ext.get("footer").getHeight()-Ext.get("header").getHeight()-Ext.get("search-form").getHeight()-20;
setChildrens(div);
div.setHeight(height)
}if(Ext.getCmp("layerManager")){Ext.getCmp("layerManager").collapse(false);
Ext.getCmp("layerManager").expand(false)
}if(app&&app.mapApp){app.mapApp.getMap().updateSize();
if(app.mapApp.getMap().getZoom()<4){app.mapApp.getMap().zoomTo(4)
}}}function showAdvancedSearch(norepeat){hide("show-advanced");
show("legend-search");
show("hide-advanced");
show("advanced-search-options");
if(Ext.getCmp("advanced-search-options-content-form")&&!norepeat){Ext.getCmp("advanced-search-options-content-form").doLayout(false,true)
}if(!norepeat){if(cookie&&cookie.get("user")){cookie.get("user").searchTemplate="FULL"
}else{if(cookie){cookie.set("user",{});
cookie.get("user").searchTemplate="FULL"
}}if(catalogue&&catalogue.resultsView){catalogue.resultsView.autoSelectTemplate()
}}}function hideAdvancedSearch(updateSearch){hide("advanced-search-options");
hide("legend-search");
hide("hide-advanced");
show("show-advanced");
if(updateSearch){if(cookie&&cookie.get("user")){cookie.get("user").searchTemplate="THUMBNAIL"
}else{if(cookie){cookie.set("user",{});
cookie.get("user").searchTemplate="THUMBNAIL"
}}if(catalogue&&catalogue.resultsView){catalogue.resultsView.autoSelectTemplate()
}if(Ext.getCmp("advanced-search-options-content-form")){GeoNetwork.state.History.suspendEvents();
Ext.getCmp("advanced-search-options-content-form").getForm().reset();
var value=Ext.getCmp("fullTextField").getValue();
if(value.length>0){Ext.getCmp("E_trueany").setValue(value+"*")
}else{Ext.getCmp("E_trueany").setValue(value)
}Ext.getCmp("E_dynamic").suspendEvents(false);
Ext.getCmp("E_dynamic").checked=(Ext.getCmp("o_dynamic").getValue());
Ext.getCmp("E_dynamic").resumeEvents();
Ext.getCmp("E_download").suspendEvents(false);
Ext.getCmp("E_download").checked=(Ext.getCmp("o_download").getValue());
Ext.getCmp("E_download").resumeEvents();
Ext.getCmp("E_nodynamicdownload").suspendEvents(false);
Ext.getCmp("E_nodynamicdownload").checked=(Ext.getCmp("o_nodynamicdownload").getValue());
Ext.getCmp("E_nodynamicdownload").resumeEvents();
GeoNetwork.state.History.resumeEvents()
}if(Ext.getCmp("facets-panel")){Ext.getCmp("facets-panel").reset()
}}}function copyToClipboard(text){var textfield=Ext.getCmp("copy-clipboard-ie_");
if(!textfield){textfield=new Ext.form.TextField({id:"copy-clipboard-ie_",renderTo:"copy-clipboard-ie"})
}show(textfield);
textfield.setValue(text);
textfield.focus();
textfield.selectText();
if(window.clipboardData&&clipboardData.setData){window.clipboardData.setData("Text",textfield.getValue())
}else{CopiedTxt=document.selection.createRange();
CopiedTxt.execCommand("Copy")
}hide(textfield)
}function metadataViewURL(uuid){return window.location.href.match(/(http.*\/.*)\/srv\.*/,"")[1]+"?uuid="+uuid
}function bookmarkMetadata(title,uuid){var url=document.location.href;
if(url.indexOf("#")>0){url=url.substring(0,url.indexOf("#"))
}if(url.indexOf("?")>0){url=url.substring(0,url.indexOf("?"))
}url=url+"|#"+uuid;
if(window.sidebar){window.sidebar.addPanel(title,url,"")
}else{if(window.opera&&window.print){var elem=document.createElement("a");
elem.setAttribute("href",url);
elem.setAttribute("title",title);
elem.setAttribute("rel","sidebar");
elem.click()
}else{if(Ext.isIE||window.external.addFavorite){window.external.AddFavorite(url,title)
}else{}}}}function validateWMSWFS(capsURL,el,type){el=Ext.get(el);
if(el){el=el.parent().parent().parent().parent().parent()
}if(!el){el=Ext.getBody()
}if(el){var mask=new Ext.LoadMask(el,{msg:OpenLayers.i18n("disclaimer.loading")});
mask.show()
}capsURL=capsURL.replace(/REQUEST=GetCapabilities/i,"");
capsURL=capsURL.replace(/VERSION=1.1.1/i,"");
capsURL=capsURL.replace(/&&/gi,"&");
capsURL=capsURL.replace(/\?&/gi,"?");
var params={type:type,wmsurl:capsURL};
var totalUrl="validators.wms";
Ext.Ajax.request({method:"GET",url:totalUrl,params:params,success:function(response){mask.hide();
Ext.MessageBox.show({title:OpenLayers.i18n("validityInfo"),msg:response.responseText,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,minWidth:600,maxWidth:800})
},failure:function(response){mask.hide();
Ext.MessageBox.show({title:OpenLayers.i18n("validityInfo"),msg:OpenLayers.i18n("wxs-extract-service-not-found",{url:"validation",misc:response.responseText}),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR,minWidth:600,maxWidth:800})
}})
}function loadPDOKPage(url,el){if(!GeoNetwork.pdokPages){GeoNetwork.pdokPages={};
Ext.Ajax.request({url:"https://www.pdok.nl/nl/ngr.xml",success:function(r){Ext.each(r.responseXML.getElementsByTagName("item"),function(item){var link=item.getElementsByTagName("link")[0];
link=link.textContent||link.innerText||link.innerHTML||link.text;
var desc=item.getElementsByTagName("description")[0];
desc=desc.textContent||desc.innerText||desc.innerHTML||desc.text;
GeoNetwork.pdokPages[link]=desc
});
if(GeoNetwork.pdokPages[url]){Ext.get("pdok-loads").update(GeoNetwork.pdokPages[url])
}}});
Ext.Ajax.request({url:"https://www.pdok.nl/en/ngr.xml",success:function(r){Ext.each(r.responseXML.getElementsByTagName("item"),function(item){var link=item.getElementsByTagName("link")[0];
link=link.textContent||link.innerText||link.innerHTML;
var desc=item.getElementsByTagName("description")[0];
desc=desc.textContent||desc.innerText||desc.innerHTML;
GeoNetwork.pdokPages[link]=desc
});
if(GeoNetwork.pdokPages[url]){Ext.get("pdok-loads").update(GeoNetwork.pdokPages[url])
}}})
}else{if(GeoNetwork.pdokPages[url]){Ext.get("pdok-loads").update(GeoNetwork.pdokPages[url])
}else{Ext.get("pdok-loads").update("")
}}if(Ext.get(el)){Ext.each(Ext.query("a",Ext.get("main-navigation").dom),function(a){Ext.get(a).removeClass("selected")
});
Ext.get(el).addClass("selected")
}hide("main");
hide("foot-loads");
show("pdok-loads")
}GeoNetwork.Settings={};
OpenLayers.ProxyHost=window.location.href.substring(0,window.location.href.indexOf("/srv/"))+"/proxy?url=";
GeoNetwork.Util.defaultLocale="eng";
GeoNetwork.searchDefault={activeMapControlExtent:false};
GeoNetwork.advancedFormButton=true;
GeoNetwork.Settings.editor={defaultViewMode:"simple",editHarvested:false};
GeoNetwork.printDefaultForTabs=false;
GeoNetwork.hideLoginLabels=true;
GeoNetwork.Settings.mdStore=GeoNetwork.data.MetadataResultsFastStore;
GeoNetwork.Settings.facetListConfig=[{name:"orgNames"},{name:"keywords"},{name:"licenses"},{name:"types"},{name:"categories"},{name:"serviceTypes"},{name:"facetprotocols"},{name:"createDateYears"}];
GeoNetwork.Settings.facetMaxItems=7;
GeoNetwork.MapModule=true;
GeoNetwork.ProjectionList=[["EPSG:4326","WGS84 (lat/lon)"],["EPSG:28992","EPSG:28992"]];
GeoNetwork.WMSList=[];
GeoNetwork.defaultViewMode="view-simple";
Ext.BLANK_IMAGE_URL="../../apps/js/ext/resources/images/default/s.gif";
GeoNetwork.Settings.results={featurecolor:"orange",colormap:undefined,featurecolorCSS:undefined};
Ext.namespace("GeoNetwork");
GeoNetwork.Ngr={};
GeoNetwork.Ngr.Templates=Ext.extend(Ext.XTemplate,{compiled:false,disableFormats:false,catalogue:null,sortOrder:0,abstractMaxSize:50,xmlTplMarkup:['<?xml version="1.0" encoding="UTF-8"?>','<node id="{id}" type="{type}">',"<site>","<name>{site_name}</name>",'<tpl if="values.site_ogctype">',"<ogctype>{site_ogctype}</ogctype>","</tpl>",'<tpl if="values.site_url">',"<url>{site_url}</url>","</tpl>",'<tpl if="values.site_icon">',"<icon>{site_icon}</icon>","</tpl>",'<tpl if="values.site_account_use">',"<account>","<use>{site_account_use}</use>","<username>{site_account_username}</username>","<password>{site_account_password}</password>","</account>","</tpl>","</site>","<options>",'<tpl if="values.options_every">',"<every>{options_every}</every>","</tpl>",'<tpl if="values.options_onerunonly">',"<oneRunOnly>{options_onerunonly}</oneRunOnly>","</tpl>",'<tpl if="values.options_lang">',"<lang>{options_lang}</lang>","</tpl>",'<tpl if="values.options_topic">',"<topic>{options_topic}</topic>","</tpl>",'<tpl if="values.options_createthumbnails">',"<createThumbnails>{options_createthumbnails}</createThumbnails>","</tpl>",'<tpl if="values.options_uselayer">',"<useLayer>{options_uselayer}</useLayer>","</tpl>",'<tpl if="values.options_uselayermd">',"<useLayerMd>{options_uselayermd}</useLayerMd>","</tpl>",'<tpl if="values.options_datasetcategory">',"<datasetcategory>{options_datasetcategory}</datasetcategory>","</tpl>","</options>","<content>","</content>","<privileges>","</privileges>",'<group id="1">','<operation name="view" />','<operation name="dynamic" />',"</group>","<categories>","</categories>",'<tpl if="values.info_result_total">',"</tpl>","</node>"],initComponent:function(){GeoNetwork.Ngr.Templates.superclass.initComponent.call(this)
},getHarvesterTemplate:function(){return new Ext.XTemplate(this.xmlTplMarkup)
}});
GeoNetwork.Ngr.Templates.DETAILED_METADATA='<li class="{type}">',"<button onclick=\"javascript:void(catalogue.metadataShow('{uuid}'));\">{title}</button>","</li>";
GeoNetwork.Ngr.Templates.RATING='<div class="rating-wd" id="rating-{id}" title="{[OpenLayers.i18n("RatingText")]}">','<input type="radio" name="rating{values.uuid}" <tpl if="rating==\'1\'">checked="true"</tpl> value="1"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'2\'">checked="true"</tpl> value="2"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'3\'">checked="true"</tpl> value="3"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'4\'">checked="true"</tpl> value="4"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'5\'">checked="true"</tpl> value="5"/></div>';
GeoNetwork.Ngr.Templates.SHORT_TITLE='<h1 style="height:60px" >    <a href="javascript:void(catalogue.metadataShow(\'{uuid}\'));"  title="{title}. {[Ext.util.Format.ellipsis(values.abstract, 200, true)]}" >    {[Ext.util.Format.ellipsis(values.title, 25, true)]}</a>    </h1>';
GeoNetwork.Ngr.Templates.TITLE='<h1>       <a href="javascript:void(catalogue.metadataShow(\'{uuid}\'));" title="{abstract}">{title}</a>    </h1>';
GeoNetwork.Ngr.Templates.RATING_TPL='<div class="rating"><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'1\'">checked="true"</tpl> value="1"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'2\'">checked="true"</tpl> value="2"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'3\'">checked="true"</tpl> value="3"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'4\'">checked="true"</tpl> value="4"/><input type="radio" name="rating{values.uuid}" <tpl if="rating==\'5\'">checked="true"</tpl> value="5"/></div>';
GeoNetwork.Ngr.Templates.LOGO='<div class="md-logo"><tpl if="groupName != \'\'"><img src="{[catalogue.URL]}/images/harvesting/{groupName}.png"/></tpl><tpl if="groupName == \'\'"><img src="{[catalogue.URL]}/images/harvesting/{source}.icon"/></tpl></div>';
GeoNetwork.Ngr.Templates.SHOW_ON_MAP='<tpl for="links">        <tpl if="values.type == \'application/vnd.ogc.wms_xml\'">            <button class="addLayer" title="{[OpenLayers.i19n("addLayer")]}" alt="{title}" onclick="app.getIMap().addWMSLayer([[\'{title}\', \'{href}\', \'{name}\', \'{uuid}\']]);">                <img src="../../apps/images/default/map/add_layer.png"/>            </button>        </tpl>    </tpl>';
GeoNetwork.Ngr.Templates.LINKCONTAINER='<div class="md-links" id="md-links-{id}">    </div>';
GeoNetwork.Ngr.Templates.DOWNLOAD='<div>  <button class="bookmark-icon" title="{[OpenLayers.i18n("saveXml") ]}"   onclick="catalogue.metadataXMLShow(\'{uuid}\', \'{schema}\');">          <img src="{[catalogue.URL]}/apps/ngr2/images/default/page_code.png"/>      </button>      <button class="bookmark-icon" title="{[OpenLayers.i18n("printSel")]}"     onclick="catalogue.metadataPrint(\'{uuid}\');">          <img src="{[catalogue.URL]}/apps/ngr2/images/default/page_white_acrobat.png"/>      </button>      <button class="bookmark-icon" title="{[OpenLayers.i18n(""getMEF")]}"     onclick="catalogue.metadataMEF(\'{uuid}\');">                <img src="{[catalogue.URL]}/apps/ngr2/images/default/page_white_zip.png"/>            </button>            <div class="md-links" id="md-links-{id}"/>        </div>';
GeoNetwork.Ngr.Templates.VALID='<tpl if="valid != \'-1\'">    <div class="validStatus">    <tpl if="valid == \'1\'"><img src="../../apps/ngr2/img/valid_metadata.png"</tpl>    <tpl if="valid == \'0\'"><img src="../../apps/ngr2/img/invalid_metadata.png"</tpl>    " title="{[OpenLayers.i18n("validityInfo")]}    <tpl for="valid_details">   {values.type}:      <tpl if="values.valid == \'1\'">{[OpenLayers.i18n("valid")]}</tpl>                <tpl if="values.valid == \'0\'">{[OpenLayers.i18n("notValid")]}</tpl>                <tpl if="values.valid == \'-1\'">{[OpenLayers.i18n("notDetermined")]}</tpl>                <tpl if="values.ratio != \'\'"> ({values.ratio}) </tpl> -             </tpl>        "></img></div>    </tpl>';
GeoNetwork.Ngr.Templates.WMS_VALID="";
GeoNetwork.Ngr.Templates.WFS_VALID="";
GeoNetwork.Ngr.Templates.OTHER_LICENSES='<tpl if="license != \'\' && license != \'otherConstraints\'">        <div class="otherLicenses">		  <tpl if="licenseLink == \'http://creativecommons.org/publicdomain/zero/1.0/deed.nl\'				|| licenseLink == \'http://creativecommons.org/publicdomain/zero/1.0/\'"><a target="_blank" href="{[values.licenseLink]}">            <img title="{[OpenLayers.i18n("Creative Commons Zero")]}" src="../../apps/ngr2/img/icon_creative_commons.png" />		  </a></tpl>		  <tpl if="licenseLink.substr(0,38) == \'http://creativecommons.org/licenses/by\'		  "><a target="_blank" href="{[values.licenseLink]}">            <img title="{[OpenLayers.i18n("Creative Commons Attribution")]}" src="../../apps/ngr2/img/icon_creative_commons_by.png" />		  </a></tpl>		  <tpl if="licenseLink != \'\'		  && licenseLink != \'http://creativecommons.org/publicdomain/zero/1.0/deed.nl\'		  && licenseLink != \'http://creativecommons.org/publicdomain/zero/1.0/\'		  && licenseLink.substr(0,38) != \'http://creativecommons.org/licenses/by\'		  "><a target="_blank" href="{[values.licenseLink]}"></tpl>		      <tpl if="license == \'Public Domain\'"><img title="{[OpenLayers.i18n("Public Domain")]}" src="../../apps/ngr2/img/icon_public_domein.png" /></tpl>		      <tpl if="license == \'OtherConstraints\'"><img title="{[OpenLayers.i18n("Other Restrictions")]}" src="../../apps/ngr2/img/icon_access-restrictions.png" /></tpl>		      <tpl if="license == \'Geo Gedeeld licentie\'"><img src="../../apps/ngr2/img/icon_gebruiksvoorwaarden.png" /></tpl>			  <tpl if="license == \'Geo Gedeeld licentie\'"><img src="../../apps/ngr2/img/icon_gebruiksvoorwaarden.png" /></tpl>		  <tpl if="licenseLink != \'\'		  && licenseLink != \'http://creativecommons.org/publicdomain/zero/1.0/deed.nl\'		  && licenseLink != \'http://creativecommons.org/publicdomain/zero/1.0/\'		  && licenseLink.substr(0,38) != \'http://creativecommons.org/licenses/by\'		  "></a></tpl>        </div>    </tpl>';
GeoNetwork.Ngr.Templates.BOOKMARK='<button class="bookmark-icon" value="{title}"     onclick="javascript:catalogue.metadataAddToBookmarks(\'{title}\', \'{uuid}\');">        <img title="{[OpenLayers.i18n("Add Bookmark")]}" src="../../apps/ngr2/img/bookmark-add-icon.png"/>    </button>';
GeoNetwork.Ngr.Templates.COPYTOCLIPBOARD='<tpl if="Ext.isIE">      <button class="bookmark-icon" value="{title}" title="{[OpenLayers.i18n("Copy to Clipboard")]}"         onclick="copyToClipboard(metadataViewURL(\'{uuid}\'));">        <img src="../../apps/ngr2/img/clipboard.png"/>    </button>     </tpl>';
GeoNetwork.Ngr.Templates.THUMB='<div style="height:150px" class="thumbnail">        <tpl if="thumbnail">            <a  title="{abstract}" href="javascript:void(catalogue.metadataShow(\'{uuid}\'));">                <img src="{thumbnail}" alt="Thumbnail"/>            </a>        </tpl>    </div>';
GeoNetwork.Ngr.Templates.CHANGE_DATE="<tpl if=\"edit=='false' || isharvested=='y'\">        <div> {[OpenLayers.i18n(\"lastUpdate\")]} {[values.changedate.split('T')[0]]}</div>    </tpl>";
GeoNetwork.Ngr.Templates.CHANGE_DATE="<tpl if=\"edit=='false' || isharvested=='y'\">        <div> {[OpenLayers.i18n(\"lastUpdate\")]} {[values.changedate.split('T')[0]]}</div>    </tpl>";
GeoNetwork.Ngr.Templates.CONTACT_INFO='<div class="md-contact"><tpl for="contact"> <tpl if="applies==\'resource\'">     <div title="{role} - {applies}">         <tpl if="values.logo !== undefined && values.logo !== \'\'">             <img src="{logo}" class="orgLogo"/>         </tpl>{name}     </div> </tpl></tpl><tpl if="edit==\'true\' && isharvested!=\'y\'"> <div class="md-mn md-mn-user" title="{[OpenLayers.i18n("ownerName")]}">{ownername} -  {[OpenLayers.i18n("lastUpdate")]}{[values.changedate.split(\'T\')[0]]}</div>        </tpl>'+GeoNetwork.Ngr.Templates.CHANGE_DATE+"</div>";
GeoNetwork.Ngr.Templates.CONTACT_INFO_SHORT='<div class="md-contact"><tpl for="contact"> <tpl if="applies==\'resource\'">     <div title="{role} - {applies}">         <tpl if="values.logo !== undefined && values.logo !== \'\'">             <img src="{logo}" class="orgLogo"/>         </tpl>{name}     </div> </tpl></tpl>';
GeoNetwork.Ngr.Templates.CONTACT_INFO_TOOLTIP='<tpl for="contact"><tpl if="applies==\'resource\'"> - {name} ({role}) \n</tpl></tpl>';
GeoNetwork.Ngr.Templates.SUBJECT='<tpl if="subject">        <span class="subject">        <tpl for="subject">            {value}{[xindex==xcount?"":", "]}        </tpl>        </span>    </tpl>';
GeoNetwork.Ngr.Templates.CATEGORIES='<td class="icon" title="{[OpenLayers.i18n("metadataCategories")]}">','<tpl for="category">','<div class="md-mn cat-{value}" title="{value}">&nbsp;</div>',"</tpl>","</td>";
GeoNetwork.Ngr.Templates.RELATED_DATASETS='<div class="relation" title="{[OpenLayers.i18n("relateddatasets")]}">    <span></span>    <ul id="md-relation-{id}"></ul></div>';
GeoNetwork.Ngr.Templates.SIMPLE=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-simple" style="{featurecolorCSS}">',"<table><tr>",'<td style="width:40px;">',GeoNetwork.Ngr.Templates.LOGO,"</td>",'<td id="{uuid}">',GeoNetwork.Ngr.Templates.TITLE,"</td>        </tr>    </table>","<table><tr>    <td>",GeoNetwork.Ngr.Templates.SUBJECT,"</td>    <td>",GeoNetwork.Ngr.Templates.CONTACT_INFO,"</td>        </tr>    </table>","</li>","</tpl>","</ul>");
GeoNetwork.Ngr.Templates.THUMBNAIL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-thumbnail" style="{featurecolorCSS}">','<div class="md-wrap" id="{uuid}"\n',GeoNetwork.Ngr.Templates.CONTACT_INFO_TOOLTIP,'">',GeoNetwork.Ngr.Templates.SHORT_TITLE,GeoNetwork.Ngr.Templates.THUMB,GeoNetwork.Ngr.Templates.LINKCONTAINER,'<div class="md-contact">',GeoNetwork.Ngr.Templates.CONTACT_INFO_SHORT,"</div>","</div>","</li>","</tpl>","</ul>");
GeoNetwork.Ngr.Templates.FULL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-full" style="{featurecolorCSS}">',"<table>        <tr>",'<td class="left">',GeoNetwork.Ngr.Templates.LOGO,"</td>",'<td id="{uuid}" style="width:80%;">',GeoNetwork.Ngr.Templates.TITLE,'<p class="abstract">                <tpl if="values.abstract.length &gt;350">                {[values.abstract.substring(0, 350)]}...                </tpl>                <tpl if="values.abstract.length &lt;= 350">                {values.abstract}                </tpl>                </p>',GeoNetwork.Ngr.Templates.SUBJECT,GeoNetwork.Ngr.Templates.LICENSE,'</td>            <td class="thumb">',GeoNetwork.Ngr.Templates.RATING_TPL,GeoNetwork.Ngr.Templates.THUMB,GeoNetwork.Ngr.Templates.CONTACT_INFO,"</td>",GeoNetwork.Ngr.Templates.CATEGORIES,"</tr>","</table>","<table><tr>","<td>",GeoNetwork.Ngr.Templates.COPYTOCLIPBOARD,"</td>",'<td class="icon" colspan="2">',GeoNetwork.Ngr.Templates.OTHER_LICENSES,GeoNetwork.Ngr.Templates.WMS_VALID,GeoNetwork.Ngr.Templates.WFS_VALID,GeoNetwork.Ngr.Templates.LINKCONTAINER,GeoNetwork.Ngr.Templates.VALID,GeoNetwork.Ngr.Templates.RATING,"</td>","</tr>","<tr>","<td>",GeoNetwork.Ngr.Templates.RELATED_DATASETS,GeoNetwork.Ngr.Templates.DETAILED_METADATA,"</td>","</tr>    </table>","</li>","</tpl>","</ul>",{hasDownloadLinks:function(values){var i;
for(i=0;
i<values.length;
i++){if(values[i].type==="application/x-compressed"){return true
}}return false
},hasWMSLinks:function(values){var i;
for(i=0;
i<values.length;
i++){console.log(values[i]);
if(values[i].type==="application/vnd.ogc.wms_xml"){return true
}}return false
},hasWFSLinks:function(values){var i;
for(i=0;
i<values.length;
i++){if(values[i].type==="application/vnd.ogc.wfs_xml"||values[i].type==="OGC:WFS"){return true
}}return false
}});
GeoNetwork.Ngr.Templates.Relation={SHORT:['<li class="relatedResource {type}">','<a href="javascript:void(catalogue.metadataShow(\'{uuid}\'));" title="{abstract}">{title}</a>',"</li>"]};
function initShortcut(){var searchConfig=[{key:"f",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("focusOnAny"),fn:function(){var e=Ext.get("E_any");
e.highlight();
e.dom.focus(true)
}},{key:"s",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("runSearch"),fn:function(){var e=Ext.getCmp("advanced-search-options-content-form");
e.getEl().fadeIn();
e.fireEvent("search")
}},{key:Ext.EventObject.LEFT,keyLabel:"LEFT",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("previousPage"),fn:function(){Ext.getCmp("previousBt").handler()
}},{key:Ext.EventObject.RIGHT,keyLabel:"RIGHT",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("nextPage"),fn:function(){Ext.getCmp("nextBt").handler()
}},{key:Ext.EventObject.UP,keyLabel:"UP",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("upInPage"),fn:function(){catalogue.resultsView.getEl().scroll("t",170,true)
}},{key:Ext.EventObject.DOWN,keyLabel:"DOWN",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("downInPage"),fn:function(){catalogue.resultsView.getEl().scroll("b",170,true)
}},{key:"d",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("hideadvanced-search-options-content-form"),fn:function(){var r=Ext.getCmp("west");
r.toggleCollapse()
}},{key:"r",ctrl:true,shift:true,label:OpenLayers.i18n("resetadvanced-search-options-content-form"),fn:function(){var e=Ext.getCmp("advanced-search-options-content-form");
e.getEl().fadeIn();
e.fireEvent("reset")
}},{key:"v",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("switchMode"),fn:function(){if(app.switchMode){app.switchMode(null,true)
}}},{key:"m",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("toggleLayerManager"),fn:function(){var r=Ext.getCmp("layerManager");
r.toggleCollapse()
}},{key:"l",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("focusOnLogin"),fn:function(){if(catalogue.identifiedUser===undefined){toggleLogin()
}else{catalogue.logout()
}}},{key:"a",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("openAdmin"),fn:function(){if(catalogue.isIdentified()){catalogue.admin()
}}},{key:"c",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("newMetadata"),fn:function(){if(catalogue.isIdentified()){var actionCtn=Ext.getCmp("resultsPanel").getTopToolbar();
actionCtn.createMetadataAction.handler.apply(actionCtn)
}}},{key:"h",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("displayHelpPanel"),fn:function(){var ss=Ext.getDom("shortcut").style;
if(ss.display==="block"){Ext.getDom("shortcut").style.display="none"
}else{Ext.getDom("shortcut").style.display="block"
}}}];
var map=new Ext.KeyMap(document,searchConfig);
map.enable();
var helpEl=Ext.getDom("shortcutHelp");
if(helpEl){var help="";
for(var i=0;
i<searchConfig.length;
i++){var c=searchConfig[i];
help+="<tr><td>"+(c.ctrl===true?'<span class="label">&lt;Ctrl&gt;</span> + ':"")+(c.shift===true?'<span class="label">&lt;Shift&gt;</span> + ':"")+'<span class="label">'+(c.keyLabel?c.keyLabel:c.key)+"</span>:</td><td>"+c.label+"</td></tr>"
}var html="<table><tbody><tr><td>"+help+"</td></tr></tbody></table>";
Ext.DomHelper.insertHtml("afterEnd",helpEl,html)
}var formMap=new Ext.KeyMap("advanced-search-options-content-form",[{key:[10,13],fn:function(){Ext.getCmp("advanced-search-options-content-form").fireEvent("search")
}}]);
formMap.enable()
}OpenLayers.DOTS_PER_INCH=90.71;
OpenLayers.ImgPath="../../apps/js/OpenLayers/img/";
OpenLayers.IMAGE_RELOAD_ATTEMPTS=3;
OpenLayers.Util.onImageLoadErrorColor="transparent";
OpenLayers.Lang.setCode(GeoNetwork.defaultLocale);
OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;
if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){this.src=this.src
}else{this.style.backgroundColor=OpenLayers.Util.onImageLoadErrorColor;
this.style.display="none"
}};
OpenLayers._getScriptLocation=function(){return"/geonetwork/apps/js/OpenLayers/"
};
Proj4js.defs["EPSG:28992"]="+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs";
Proj4js.defs["EPSG:2154"]="+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs";
Proj4js.defs["EPSG:25831"]="+proj=utm +zone=31 +ellps=GRS80 +units=m +no_defs";
GeoNetwork.map.printCapabilities="../../pdf";
GeoNetwork.map.PROJECTION="EPSG:28992";
GeoNetwork.map.EXTENT=new OpenLayers.Bounds(-121595.2,280646.08,432347.84,645353.92);
GeoNetwork.map.MAXEXTENT=new OpenLayers.Bounds(-285401.92,22598.08,595401.92,903401.92);
GeoNetwork.map.RESOLUTIONS=[3440.64,1720.32,860.16,430.08,215.04,107.52,53.76,26.88,13.44,6.72,3.36,1.68,0.84];
var matrixIds=[];
var matrixIds2=[];
for(var i=0;
i<=13;
++i){if(i<10){matrixIds[i]="0"+i;
matrixIds2[i]="EPSG:28992:"+i
}else{matrixIds[i]=""+i;
matrixIds2[i]="EPSG:28992:"+i
}}GeoNetwork.map.BACKGROUND_LAYERS=[new OpenLayers.Layer.WMTS({name:"BRT Achtergrondkaart",url:"http://geodata.nationaalgeoregister.nl/wmts?",isBaseLayer:true,matrixSet:"EPSG:28992",matrixIds:matrixIds2,layer:"brtachtergrondkaart",format:"image/png",style:"default",buffer:1}),new OpenLayers.Layer.WMTS({name:"PDOK-achtergrond luchtfoto",url:"http://geodata1.nationaalgeoregister.nl/luchtfoto/wmts",layer:"luchtfoto",matrixSet:"nltilingschema",matrixIds:matrixIds,format:"image/jpeg",style:"default",isBaseLayer:true}),new OpenLayers.Layer.WMS("NLR Nederland Aster mosaic","http://gdsc.nlr.nl/wms/aster_all?",{layers:"aster_all",format:"image/jpeg"},{isBaseLayer:true,buffer:1}),new OpenLayers.Layer("Geen Ondergrond",{isBaseLayer:true,maxExtent:GeoNetwork.map.MAXEXTENT,resolutions:GeoNetwork.map.RESOLUTIONS})];
GeoNetwork.map.MAP_OPTIONS={projection:GeoNetwork.map.PROJECTION,maxExtent:GeoNetwork.map.MAXEXTENT,restrictedExtent:GeoNetwork.map.EXTENT,resolutions:GeoNetwork.map.RESOLUTIONS,extent:GeoNetwork.map.EXTENT,center:new OpenLayers.LonLat(167968.51227,472246.725),controls:[]};
GeoNetwork.map.MAIN_MAP_OPTIONS={projection:GeoNetwork.map.PROJECTION,maxExtent:GeoNetwork.map.MAXEXTENT,restrictedExtent:GeoNetwork.map.EXTENT,resolutions:GeoNetwork.map.RESOLUTIONS,center:new OpenLayers.LonLat(167968.51227,472246.725),controls:[]};
GeoNetwork.GEOCODER_URL="http://geodata.nationaalgeoregister.nl/geocoder/Geocoder?";
Ext.namespace("GeoNetwork");
GeoNetwork.mapApp=function(){var toolbar,toctoolbar;
var viewport=null;
var tree,legendPanel,printPanel,printProvider,printPage,pageLayer;
var featureinfo;
var activeNode;
var featureinfolayer;
var layerLoadingMask;
var layers;
var generateMaps=function(){var map=new OpenLayers.Map({maxExtent:GeoNetwork.map.MAP_OPTIONS.maxExtent.clone(),projection:GeoNetwork.map.MAP_OPTIONS.projection,resolutions:GeoNetwork.map.MAP_OPTIONS.resolutions,restrictedExtent:GeoNetwork.map.MAP_OPTIONS.restrictedExtent.clone(),center:GeoNetwork.map.MAP_OPTIONS.center.clone(),controls:[]});
Ext.each(GeoNetwork.map.BACKGROUND_LAYERS,function(layer){map.addLayer(layer.clone())
});
map.events.register("click",map,function(e){app.showBigMap()
});
var showBigMapButton=new OpenLayers.Control.Button({trigger:showBigMap,title:"Open kaart en verberg zoekresultaten"});
OpenLayers.Util.extend(showBigMapButton,{displayClass:"showBigMap"});
var panel=new OpenLayers.Control.Panel();
OpenLayers.Util.extend(panel,{displayClass:"showBigMapPanel"});
panel.addControls([showBigMapButton]);
map.addControl(panel);
new GeoExt.MapPanel({id:"minimap",renderTo:"mini-map",height:200,width:200,map:map,title:OpenLayers.i18n("Preview"),stateId:"minimap",prettyStateKeys:true});
Ext.get("mini-map").setVisibilityMode(Ext.Element.DISPLAY);
var map2=new OpenLayers.Map({maxExtent:GeoNetwork.map.MAP_OPTIONS.maxExtent.clone(),projection:GeoNetwork.map.MAP_OPTIONS.projection,resolutions:GeoNetwork.map.MAP_OPTIONS.resolutions,restrictedExtent:GeoNetwork.map.MAP_OPTIONS.restrictedExtent.clone(),center:GeoNetwork.map.MAP_OPTIONS.center.clone(),controls:[]});
Ext.each(GeoNetwork.map.MAP_OPTIONS.controls,function(control){map2.addControl(control.clone())
});
Ext.each(GeoNetwork.map.BACKGROUND_LAYERS,function(layer){map2.addLayer(layer.clone())
});
var scaleLinePanel=new Ext.Panel({cls:"olControlScaleLine overlay-element overlay-scaleline",border:false});
var zoomStore;
var fixedScales=GeoNetwork.map.MAP_OPTIONS.resolutions;
if(fixedScales&&fixedScales.length>0){var zooms=[];
var scales=fixedScales;
var units=map2.baseLayer.units;
for(var i=scales.length-1;
i>=0;
i--){var scale=scales[i];
zooms.push({level:i,resolution:OpenLayers.Util.getResolutionFromScale(scale,units),scale:scale})
}zoomStore=new GeoExt.data.ScaleStore({});
zoomStore.loadData(zooms)
}else{zoomStore=new GeoExt.data.ScaleStore({map:map2})
}var zoomSelector=new Ext.form.ComboBox({emptyText:"Zoom level",tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale)]}</div></tpl>',editable:false,triggerAction:"all",mode:"local",store:zoomStore,width:110});
zoomSelector.on("click",function(evt){evt.stopEvent()
});
zoomSelector.on("mousedown",function(evt){evt.stopEvent()
});
zoomSelector.on("select",function(combo,record,index){map.zoomTo(record.data.level)
},this);
var zoomSelectorWrapper=new Ext.Panel({items:[zoomSelector],cls:"overlay-element overlay-scalechooser",border:false});
map2.events.register("zoomend",this,function(){var scale=zoomStore.queryBy(function(record){return map.getZoom()===record.data.level
});
if(scale.length>0){scale=scale.items[0];
zoomSelector.setValue("1 : "+parseInt(scale.data.scale,10))
}else{if(!zoomSelector.rendered){return
}zoomSelector.clearValue()
}});
var mapOverlay=new Ext.Panel({cls:"map-overlay",items:[scaleLinePanel,zoomSelectorWrapper]});
var panel2=new GeoExt.MapPanel({height:500,map:map2,id:"really-big-map",stateId:"bigmap",prettyStateKeys:true});
panel2.map=map2;
panel2.on("render",function(){var scaleLine=new OpenLayers.Control.ScaleLine();
map2.addControl(scaleLine);
scaleLine.activate()
},this);
app.mapApp.maps.push(map2);
app.mapApp.maps.push(map);
addMapControls();
map.events.register("changebaselayer",map,function(e){var name=e.object.baseLayer.name;
var url=e.object.baseLayer.url;
Ext.each(app.mapApp.maps,function(m){if(m.id!==e.object.id){Ext.each(m.layers,function(l){if(l.name===name&&l.url===url){m.setBaseLayer(l)
}})
}})
});
map.events.register("moveend",map,function(e){var name=e.object.baseLayer.name;
var url=e.object.baseLayer.url;
Ext.each(app.mapApp.maps,function(m){if(m.id!==e.object.id){Ext.each(m.layers,function(l){if(l.name===name&&l.url===url){m.setBaseLayer(l)
}})
}})
});
map.events.register("addlayer",map,function(e){var name=e.object.baseLayer.name;
if(name!=="Feature info"){var m=app.mapApp.getMap();
var layer=undefined;
Ext.each(m.layers,function(l){if(l.name==="Feature info"){m.raiseLayer(l,10);
Ext.get(l.id).setStyle("z-index",3000)
}})
}});
map.events.register("preaddlayer",map,function(e){var name=e.layer.name;
var url=e.layer.url;
Ext.each(map.layers,function(l){if(l.name===name&&l.url===url){return false
}});
Ext.each(app.mapApp.maps,function(m){var alreadyHas=false;
if(m.id!==e.object.id){Ext.each(map.layers,function(l){if(l.name===name&&l.url===url){alreadyHas=true
}});
if(!alreadyHas){m.addLayer(e.layer.clone())
}}})
});
map.events.register("changelayer",map,function(e){var layer=e.layer;
var property=e.property;
Ext.each(app.mapApp.maps,function(m){if(m.id!==e.object.id){Ext.each(m.layers,function(l){if(l.name===layer.name&&l.url===layer.url){if(property==="opacity"){l.setOpacity(layer.opacity)
}else{if(property==="visibility"){l.setVisibility(layer.getVisibility())
}else{if(property==="params"){l.mergeNewParams({styles:Ext.getCmp("layerstyles").layerStylesPanel.selectedStyle})
}}}}})
}})
});
createViewport(panel2);
registerWindows(map2,map)
};
var addMapControls=function(){Ext.each(app.mapApp.maps,function(map){map.addControl(new GeoNetwork.Control.ZoomWheel());
map.addControl(new OpenLayers.Control.LoadingPanel())
})
};
var removeLayerHandler=function(node){Ext.each(app.mapApp.maps,function(map){try{if(node){var lyr;
lyr=node.attributes.layer;
if(lyr){if(!lyr.isBaseLayer){if((typeof(lyr.isLoading)==="undefined")||(lyr.isLoading===false)){Ext.each(map.layers,function(l){if(l&&(lyr.id===l.id||(lyr.name===l.name&&lyr.url===l.url))){map.removeLayer(l)
}});
if(activeNode&&activeNode===node){activeNode=null
}refreshTocToolbar(activeNode);
Ext.getCmp("toctree").getSelectionModel().clearSelections()
}}}}}catch(ex){if(!Ext.isIE&&console&&console.log){console.log(ex)
}}})
};
var removeLayerHandlerContextMenu=function(){var node=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();
removeLayerHandler(node)
};
var wmsTimeHandler=function(node){if(node){var layer;
layer=node.attributes.layer;
if(layer&&layer.dimensions&&layer.dimensions.time){GeoNetwork.WindowManager.showWindow("wmstime");
GeoNetwork.WindowManager.getWindow("wmstime").setLayer(layer)
}}};
var wmsTimeHandlerContextMenu=function(){var node=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();
wmsTimeHandler(node)
};
var stylesLayerHandler=function(node){if(node){var layer;
layer=node.attributes.layer;
if((layer)&&(layer.styles)&&(layer.styles.length>1)){GeoNetwork.WindowManager.showWindow("layerstyles");
GeoNetwork.WindowManager.getWindow("layerstyles").showLayerStyles(layer)
}}};
var stylesLayerHandlerContextMenu=function(){var node=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();
stylesLayerHandler(node)
};
var metadataLayerHandler=function(node){if(node){var layer;
layer=node.attributes.layer;
GeoNetwork.WindowManager.showWindow("wmsinfo");
GeoNetwork.WindowManager.getWindow("wmsinfo").showLayerInfo(layer)
}};
var metadataLayerHandlerContextMenu=function(){var node=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();
metadataLayerHandler(node)
};
var refreshTocToolbar=function(node){activeNode=node;
if((node)&&(node.attributes.layer)){if(node.parentNode.attributes.nodeType==="gx_baselayercontainer"){Ext.getCmp("tbRemoveButton").disable()
}else{Ext.getCmp("tbRemoveButton").enable()
}var layer=node.attributes.layer;
if(layer&&layer.dimensions&&layer.dimensions.time){Ext.getCmp("tbWmsTimeButton").enable()
}else{Ext.getCmp("tbWmsTimeButton").disable()
}if((layer)&&((!layer.styles)||(layer.styles.length<2))){Ext.getCmp("tbStylesButton").disable()
}else{Ext.getCmp("tbStylesButton").enable()
}if(node.layer&&node.layer.dimensions&&node.layer.dimensions.time){Ext.getCmp("tbWmsTimeButton").enable()
}else{Ext.getCmp("tbWmsTimeButton").disable()
}if((node.layer)&&((!node.layer.styles)||(node.layer.styles.length<2))){Ext.getCmp("tbStylesButton").disable()
}else{Ext.getCmp("tbStylesButton").enable()
}Ext.getCmp("tbMetadataButton").setDisabled(!(node.layer instanceof OpenLayers.Layer.WMS));
if(Ext.getCmp("btnZoomToExtent")){Ext.getCmp("btnZoomToExtent").enable()
}}else{if(Ext.getCmp("tbRemoveButton")){Ext.getCmp("tbRemoveButton").disable()
}if(Ext.getCmp("tbWmsTimeButton")){Ext.getCmp("tbWmsTimeButton").disable()
}if(Ext.getCmp("tbStylesButton")){Ext.getCmp("tbStylesButton").disable()
}if(Ext.getCmp("tbMetadataButton")){Ext.getCmp("tbMetadataButton").disable()
}if(Ext.getCmp("btnZoomToExtent")){Ext.getCmp("btnZoomToExtent").disable()
}}};
var createPrintPanel=function(map){if(printProvider!==undefined){return
}printProvider=new GeoExt.data.PrintProvider({method:"POST",url:GeoNetwork.map.printCapabilities,autoLoad:true,listeners:{loadcapabilities:function(){printPage=new GeoExt.data.PrintPage({printProvider:printProvider});
pageLayer=new OpenLayers.Layer.Vector(OpenLayers.i18n("printLayer"),{visibility:false});
printPage.fit(map);
pageLayer.addFeatures(printPage.feature);
map.addLayer(pageLayer);
map.events.register("moveend",map,function(){if(printPage.center){printPage.fit(this,{mode:"screen"})
}});
printPanel=new Ext.form.FormPanel({id:"printPanel",title:OpenLayers.i18n("mf.print.print"),labelAlign:"top",padding:3,autoScroll:true,collapsed:true,items:[{xtype:"textarea",name:"comment",value:"",fieldLabel:OpenLayers.i18n("mf.print.comment"),plugins:new GeoExt.plugins.PrintPageField({printPage:printPage})},{xtype:"combo",store:printProvider.layouts,displayField:"name",fieldLabel:OpenLayers.i18n("layout"),typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintProviderField({printProvider:printProvider})},{xtype:"combo",store:printProvider.dpis,displayField:"name",fieldLabel:OpenLayers.i18n("mf.print.dpi"),tpl:'<tpl for="."><div class="x-combo-list-item">{name} dpi</div></tpl>',typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintProviderField({printProvider:printProvider}),setValue:function(v){v=parseInt(v,10)+" dpi";
Ext.form.ComboBox.prototype.setValue.apply(this,arguments)
}},{xtype:"combo",store:printProvider.scales,displayField:"name",fieldLabel:OpenLayers.i18n("mf.print.scale"),typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintPageField({printPage:printPage})},{xtype:"textfield",name:"rotation",fieldLabel:OpenLayers.i18n("mf.print.rotation"),plugins:new GeoExt.plugins.PrintPageField({printPage:printPage})}],buttons:[{text:OpenLayers.i18n("mf.print.generatingPDF"),handler:function(){printProvider.print(Ext.getCmp("really-big-map"),printPage)
}}],listeners:{beforeexpand:function(){this.setVisibility(true)
},beforecollapse:function(){this.setVisibility(false)
},scope:pageLayer}});
Ext.getCmp("layerManager-accordion").add(printPanel);
Ext.getCmp("layerManager-accordion").doLayout()
}}})
};
var createToolbars=function(){toctoolbar=[];
var action=new GeoExt.Action({handler:function(){GeoNetwork.WindowManager.showWindow("addwms")
},iconCls:"addLayer",tooltip:OpenLayers.i18n("addWMSButtonText")});
toctoolbar.push(action);
action=new GeoExt.Action({id:"tbRemoveButton",handler:function(){removeLayerHandler(activeNode)
},iconCls:"deleteLayer",tooltip:OpenLayers.i18n("removeButtonText")});
toctoolbar.push(action);
toctoolbar.push("-");
action=new GeoExt.Action({id:"tbStylesButton",handler:function(){stylesLayerHandler(activeNode)
},iconCls:"layerStyles",tooltip:OpenLayers.i18n("chooseLayerStyle")});
toctoolbar.push(action);
toctoolbar.push("-");
action=new GeoExt.Action({id:"tbMetadataButton",handler:function(){metadataLayerHandler(activeNode)
},iconCls:"wmsInfo",tooltip:OpenLayers.i18n("metadataButtonText")});
toctoolbar.push(action);
toctoolbar.push("-");
action=new GeoExt.Action({id:"tbWmsTimeButton",handler:function(){wmsTimeHandler(activeNode)
},iconCls:"wmsTime",tooltip:OpenLayers.i18n("wmsTime")});
toctoolbar.push(action);
toolbar=[];
var map=app.mapApp.getMap();
var hideBigMapButton=new OpenLayers.Control.Button({trigger:showSearch,title:OpenLayers.i18n("hideBigMap")});
action=new GeoExt.Action({control:hideBigMapButton,map:map,iconCls:"hideBigMapPanel",tooltip:{title:OpenLayers.i18n("hideBigMap")}});
toolbar.push(action);
action=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:map,iconCls:"zoomfull",tooltip:{title:OpenLayers.i18n("zoomToMaxExtentTooltipTitle"),text:OpenLayers.i18n("zoomToMaxExtentTooltipText")}});
toolbar.push(action);
toolbar.push("-");
action=new GeoExt.Action({iconCls:"zoomlayer",id:"btnZoomToExtent",handler:function(){var node=activeNode;
var layer;
if(node){layer=node.attributes.layer;
if(layer){if(layer.llbbox){var mapProj=map.getProjectionObject();
var wgs84=new OpenLayers.Projection("WGS84");
var minMapxy=new OpenLayers.LonLat(layer.llbbox[0],layer.llbbox[1]).transform(wgs84,mapProj);
var maxMapxy=new OpenLayers.LonLat(layer.llbbox[2],layer.llbbox[3]).transform(wgs84,mapProj);
var extent=new OpenLayers.Bounds();
extent.left=minMapxy.lon;
extent.right=maxMapxy.lon;
extent.top=maxMapxy.lat;
extent.bottom=minMapxy.lat;
map.zoomToExtent(extent)
}else{map.zoomToMaxExtent()
}}else{Ext.MessageBox.alert(OpenLayers.i18n("zoomlayer.selectLayerTitle"),OpenLayers.i18n("zoomlayer.selectLayerText"))
}}else{Ext.MessageBox.alert(OpenLayers.i18n("zoomlayer.selectLayerTitle"),OpenLayers.i18n("zoomlayer.selectLayerText"))
}}});
toolbar.push(action);
toolbar.push("-");
action=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:map,toggleGroup:"move",allowDepress:false,iconCls:"zoomin"});
toolbar.push(action);
action=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),toggleGroup:"move",allowDepress:false,map:map,iconCls:"zoomout"});
toolbar.push(action);
action=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:"move",allowDepress:false,pressed:true,map:map,iconCls:"pan"});
toolbar.push(action);
var buttonGazetteer=new Ext.Toolbar.Button({iconCls:"searchIcon",text:OpenLayers.i18n("GazetteerWindowTitle"),tooltip:{title:OpenLayers.i18n("gazetteerTooltipTitle"),text:OpenLayers.i18n("gazetteerTooltipText")},handler:function(){GeoNetwork.WindowManager.showWindow("gazetteer")
}});
toolbar.push(buttonGazetteer);
toolbar.push("-");
featureinfo=new OpenLayers.Control.WMSGetFeatureInfo({drillDown:true,infoFormat:"application/vnd.ogc.gml"});
var moveLayerToTop=function(layertomove){map.resetLayersZIndex();
Ext.each(app.mapApp.maps,function(map){map.raiseLayer(layertomove,map.layers.length)
});
map.resetLayersZIndex()
};
featureinfolayer=new OpenLayers.Layer.Vector("Feature info",{displayInLayerSwitcher:false,styleMap:new OpenLayers.StyleMap({externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",pointRadius:12})});
map.addLayer(featureinfolayer);
featureinfo.events.on({getfeatureinfo:function(evt){var lonlat=map.getLonLatFromViewPortPx(evt.xy);
var point=new OpenLayers.Geometry.Point(lonlat.lon,lonlat.lat);
featureinfolayer.destroyFeatures();
featureinfolayer.addFeatures(new OpenLayers.Feature.Vector(point));
moveLayerToTop(featureinfolayer);
GeoNetwork.WindowManager.showWindow("featureinfo");
GeoNetwork.WindowManager.getWindow("featureinfo").setMap(app.mapApp.getMap());
GeoNetwork.WindowManager.getWindow("featureinfo").setFeatures(evt.features)
},deactivate:function(){featureinfolayer.destroyFeatures()
}});
action=new GeoExt.Action({control:featureinfo,toggleGroup:"move",allowDepress:false,pressed:false,map:map,iconCls:"query",tooltip:{title:OpenLayers.i18n("featureInfoTooltipTitle"),text:OpenLayers.i18n("featureInfoTooltipText")}});
toolbar.push(action);
toolbar.push("-");
ctrl=new OpenLayers.Control.NavigationHistory();
map.addControl(ctrl);
action=new GeoExt.Action({control:ctrl.previous,disabled:true,map:map,iconCls:"back",tooltip:{title:OpenLayers.i18n("previousTooltipTitle"),text:OpenLayers.i18n("previosTooltipText")}});
toolbar.push(action);
action=new GeoExt.Action({control:ctrl.next,disabled:true,map:map,iconCls:"next",tooltip:{title:OpenLayers.i18n("nextTooltipTitle"),text:OpenLayers.i18n("nextTooltipText")}});
toolbar.push(action);
toolbar.push("-");
action=new GeoExt.Action({iconCls:"savewmc",tooltip:{title:OpenLayers.i18n("savewmcTooltipTitle"),text:OpenLayers.i18n("savewmcTooltipText")},handler:function(){GeoNetwork.WMCManager.saveContext(map)
}});
toolbar.push(action);
action=new GeoExt.Action({iconCls:"loadwmc",tooltip:{title:OpenLayers.i18n("loadwmcTooltipTitle"),text:OpenLayers.i18n("loadwmcTooltipText")},handler:function(){GeoNetwork.WindowManager.showWindow("loadwmc")
}});
toolbar.push(action)
};
var createMapOverlay=function(){var scaleLinePanel=new Ext.Panel({cls:"olControlScaleLine overlay-element overlay-scaleline",border:false});
scaleLinePanel.on("render",function(){var scaleLine=new OpenLayers.Control.ScaleLine({div:scaleLinePanel.body.dom});
map.addControl(scaleLine);
scaleLine.activate()
},this);
var zoomStore=new GeoExt.data.ScaleStore({map:map});
var zoomSelector=new Ext.form.ComboBox({emptyText:"Zoom level",tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale)]}</div></tpl>',editable:false,triggerAction:"all",mode:"local",store:zoomStore,width:110});
zoomSelector.on("click",function(evt){evt.stopEvent()
});
zoomSelector.on("mousedown",function(evt){evt.stopEvent()
});
zoomSelector.on("select",function(combo,record,index){map.zoomTo(record.data.level)
},this);
var zoomSelectorWrapper=new Ext.Panel({items:[zoomSelector],cls:"overlay-element overlay-scalechooser",border:false});
map.events.register("zoomend",this,function(){var scale=zoomStore.queryBy(function(record){return map.getZoom()===record.data.level
});
if(scale.length>0){scale=scale.items[0];
zoomSelector.setValue("1 : "+parseInt(scale.data.scale,10))
}else{if(!zoomSelector.rendered){return
}zoomSelector.clearValue()
}});
var mapOverlay=new Ext.Panel({cls:"map-overlay",items:[scaleLinePanel,zoomSelectorWrapper]});
mapOverlay.on("afterlayout",function(){scaleLinePanel.body.dom.style.position="relative";
scaleLinePanel.body.dom.style.display="inline";
mapOverlay.getEl().on("click",function(x){x.stopEvent()
});
mapOverlay.getEl().on("mousedown",function(x){x.stopEvent()
})
},this);
return mapOverlay
};
var createMeasureControl=function(handlerType,title){var styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:0.3}}})]})});
var cleanup=function(){if(measureToolTip){measureToolTip.destroy()
}};
var makeString=function(metricData){var metric=metricData.measure;
var metricUnit=metricData.units;
measureControl.displaySystem="english";
var englishData=metricData.geometry.CLASS_NAME.indexOf("LineString")>-1?measureControl.getBestLength(metricData.geometry):measureControl.getBestArea(metricData.geometry);
var english=englishData[0];
var englishUnit=englishData[1];
measureControl.displaySystem="metric";
var dim=metricData.order===2?"<sup>2</sup>":"";
return metric.toFixed(2)+" "+metricUnit+dim+"<br>"+english.toFixed(2)+" "+englishUnit+dim
};
var measureToolTip;
var measureControl=new OpenLayers.Control.Measure(handlerType,{persist:true,handlerOptions:{layerOptions:{styleMap:styleMap}},eventListeners:{measurepartial:function(event){cleanup();
measureToolTip=new Ext.ToolTip({html:makeString(event),title:title,autoHide:false,closable:true,draggable:false,mouseOffset:[0,0],showDelay:1,listeners:{hide:cleanup}});
if(event.measure>0){var px=measureControl.handler.lastUp;
var p0=Ext.getCmp("mappanel").getPosition();
measureToolTip.targetXY=[p0[0]+px.x,p0[1]+px.y];
measureToolTip.show()
}},measure:function(event){cleanup();
measureToolTip=new Ext.ToolTip({target:Ext.getBody(),html:makeString(event),title:title,autoHide:false,closable:true,draggable:false,mouseOffset:[0,0],showDelay:1,listeners:{hide:function(){measureControl.cancel();
cleanup()
}}})
},deactivate:cleanup,scope:this}});
return measureControl
};
var createTree=function(){var treeConfig=new OpenLayers.Format.JSON().write([{nodeType:"gx_baselayercontainer",text:OpenLayers.i18n("baseLayerList")},{nodeType:"gx_overlaylayercontainer",text:OpenLayers.i18n("overlaysList"),expanded:true,loader:{baseAttrs:{radioGroup:"foo",slider:"layeropacityslider",uiProvider:"layernodeui"}}}],true);
var LayerNodeUI=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin());
tree=new Ext.tree.TreePanel({title:OpenLayers.i18n("layerTree"),id:"toctree",forceLayout:true,enableDD:true,collapsed:true,loader:new Ext.tree.TreeLoader({applyLoader:false,uiProviders:{layernodeui:LayerNodeUI}}),plugins:[new GeoExt.plugins.TreeNodeRadioButton({listeners:{radiochange:function(node){activeNode=node
}}}),new GeoExt.tree.LayerOpacitySliderPlugin({listeners:{opacityslide:function(node,value){}}})],root:{nodeType:"async",children:Ext.decode(treeConfig)},listeners:{contextmenu:function(node,e){if((node.attributes.nodeType!=="gx_overlaylayercontainer")&&(node.attributes.nodeType!=="gx_baselayercontainer")){node.select();
var c=node.getOwnerTree().contextMenu;
if(node.parentNode.attributes.nodeType==="gx_baselayercontainer"){c.items.get("removeMenu").disable()
}else{c.items.get("removeMenu").enable()
}c.items.get("addMenu").hide();
var layer=node.layer;
c.items.get("metadataMenu").setDisabled(!(layer instanceof OpenLayers.Layer.WMS));
if(layer&&layer.dimensions&&layer.dimensions.time){c.items.get("wmsTimeMenu").enable()
}else{c.items.get("wmsTimeMenu").disable()
}if((layer)&&((!layer.styles)||(layer.styles.length<2))){c.items.get("stylesMenu").disable()
}else{c.items.get("stylesMenu").enable()
}c.contextNode=node;
c.showAt(e.getXY())
}else{if(node.attributes.nodeType==="gx_overlaylayercontainer"){node.select();
var c=node.getOwnerTree().contextMenu;
c.items.get("addMenu").show();
c.items.get("removeMenu").hide();
c.items.get("wmsTimeMenu").hide();
c.items.get("stylesMenu").hide();
c.items.get("metadataMenu").hide();
c.contextNode=node;
c.showAt(e.getXY())
}}},scope:this},contextMenu:new Ext.menu.Menu({items:[{text:OpenLayers.i18n("addWMSButtonText"),id:"addMenu",handler:function(){GeoNetwork.WindowManager.showWindow("addwms")
}},{text:OpenLayers.i18n("removeButtonText"),id:"removeMenu",handler:removeLayerHandlerContextMenu},{text:OpenLayers.i18n("metadataButtonText"),id:"metadataMenu",handler:metadataLayerHandlerContextMenu},{text:"Styles",id:"stylesMenu",handler:stylesLayerHandlerContextMenu},{text:OpenLayers.i18n("WMSTimeWindowTitle"),id:"wmsTimeMenu",disabled:true,handler:wmsTimeHandlerContextMenu}]}),tbar:toctoolbar,rootVisible:false,lines:false,border:false,region:"center"})
};
var createLegendPanel=function(){legendPanel=new GeoExt.LegendPanel({defaults:{style:"padding:5px"},title:OpenLayers.i18n("legendTabTitle"),height:200,autoScroll:true,split:true,collapsible:true,collapsed:true,border:false,region:"south"})
};
var createViewport=function(mapOverlay){createToolbars();
createTree();
createLegendPanel();
var accordion=new Ext.Panel({region:"center",id:"layerManager-accordion",border:false,layout:"accordion",deferredRender:false,items:[tree,legendPanel]});
viewport=new Ext.Panel({layout:"border",id:"big-map",renderTo:"big-map-container",border:false,items:[{id:"layerManager",region:"east",xtype:"panel",collapsible:true,collapsed:false,collapseMode:"mini",split:true,border:false,width:205,minSize:205,maxSize:400,layout:"border",items:[accordion]},{region:"center",layout:"fit",xtype:"gx_mappanel",tbar:toolbar,frame:false,border:false,margins:"2px 2px 2px 2px",items:[mapOverlay]}],listeners:{afterlayout:function(){}}});
Ext.getCmp("toctree").on({click:function(node){if(node.ui.radio){node.ui.radio.checked=true;
node.ui.fireEvent("radiochange",node)
}refreshTocToolbar(node)
},scope:this});
Ext.getCmp("toctree").on("nodedragover",function(evt){if((evt.dropNode.parentNode.attributes.nodeType==="gx_baselayercontainer")||(evt.target.attributes.nodeType==="gx_baselayercontainer")||(evt.target.parentNode.attributes.nodeType==="gx_baselayercontainer")||(evt.target.parentNode===evt.tree.root)){evt.cancel=true
}});
refreshTocToolbar(activeNode)
};
var processLayersSuccess=function(response){layerLoadingMask.hide();
var parser=new OpenLayers.Format.WMSCapabilities();
var caps=parser.read(response.responseXML||response.responseText);
if(caps.capability){var accessContraints=caps.service.accessContraints;
if((accessContraints)&&(accessContraints.toLowerCase()!=="none")&&(accessContraints!=="-")){var disclaimerWindow=new GeoNetwork.DisclaimerWindow({disclaimer:accessContraints});
disclaimerWindow.show();
disclaimerWindow=null
}var map=app.mapApp.maps[1];
for(var i=0,len=layers.length;
i<len;
i++){var name=layers[i][0];
var url=layers[i][1];
var layer=layers[i][2];
var metadata_id=layers[i][3];
var ol_layer=new OpenLayers.Layer.WMS(name,url,{layers:layer,format:"image/png",transparent:"TRUE",version:caps.version,language:GeoNetwork.OGCUtil.getLanguage()},{queryable:true,singleTile:true,ratio:1,buffer:0,transitionEffect:"resize",metadata_id:metadata_id});
if(!GeoNetwork.OGCUtil.layerExistsInMap(ol_layer,map)){ol_layer.events.on({loadstart:function(){this.isLoading=true
}});
ol_layer.events.on({loadend:function(){this.isLoading=false
}});
var layerCap=getLayer(caps,caps.capability.layers,ol_layer);
if(layerCap){ol_layer.queryable=layerCap.queryable;
ol_layer.name=layerCap.title||ol_layer.name;
ol_layer.llbbox=layerCap.llbbox;
ol_layer.styles=layerCap.styles;
ol_layer.dimensions=layerCap.dimensions;
ol_layer.metadataURLs=layerCap.metadataURLs;
ol_layer.abstractInfo=layerCap["abstract"];
map.addLayer(ol_layer)
}else{GeoNetwork.WindowManager.showWindow("addwms");
var panel=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwms").browserPanel.id);
panel.setURL(caps.capability.request.getcapabilities.href)
}}}}};
var processLayersFailure=function(response){if(layerLoadingMask){layerLoadingMask.hide()
}Ext.MessageBox.alert(OpenLayers.i18n("loadLayer.error.title"),OpenLayers.i18n("loadLayer.error.message"))
};
var getLayer=function(caps,caplayers,layer){var findedLayer=null;
for(var i=0,len=caplayers.length;
i<len;
++i){var lr=caplayers[i];
try{var layerName=lr.name.split(",");
if(layerName.indexOf(layer.params.LAYERS)!==-1){findedLayer=lr;
break
}}catch(e){}if(typeof(lr.childLayers)!=="undefined"){findedLayer=getLayer(caps,lr.childLayers,layer);
if(findedLayer!==null){break
}}}return findedLayer
};
var registerWindows=function(map,map2){GeoNetwork.WindowManager.registerWindow("addwms",GeoNetwork.AddWmsLayerWindow,{map:map2,id:"addwms"});
GeoNetwork.WindowManager.registerWindow("addwmts",GeoNetwork.AddWmtsLayerWindow,{map:map2,id:"addwmts"});
GeoNetwork.WindowManager.registerWindow("wmsinfo",GeoNetwork.WmsLayerMetadataWindow,{map:map,id:"wmsinfo"});
GeoNetwork.WindowManager.registerWindow("loadwmc",GeoNetwork.LoadWmcWindow,{map:map,id:"loadwmc"});
GeoNetwork.WindowManager.registerWindow("gazetteer",GeoNetwork.GazetteerWindow,{map:map,id:"gazetteer"});
GeoNetwork.WindowManager.registerWindow("featureinfo",GeoNetwork.FeatureInfoWindow,{map:map,id:"featureinfo",control:featureinfo});
GeoNetwork.WindowManager.registerWindow("layerstyles",GeoNetwork.LayerStylesWindow,{map:map,id:"layerstyles"});
GeoNetwork.WindowManager.registerWindow("wmstime",GeoNetwork.WMSTimeWindow,{map:map,id:"wmstime"})
};
return{initialize:false,addWMSLayer:function(layerList){if(layerList.length===0){return
}showBigMap();
layerLoadingMask=new Ext.LoadMask(this.getMap().div,{msg:OpenLayers.Lang.translate("loadLayer.loadingMessage")});
layerLoadingMask.show();
var map=this.maps[0];
var onlineResource=layerList[0][1];
if(layerList[0][2]===""){GeoNetwork.WindowManager.showWindow("addwms");
var panel=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwms").browserPanel.id);
panel.setURL(onlineResource);
return
}layers=layerList;
var params={service:"WMS",request:"GetCapabilities",version:"1.1.1"};
var paramString=OpenLayers.Util.getParameterString(params);
var separator=(onlineResource.indexOf("?")>-1)?"&":"?";
onlineResource+=separator+paramString;
OpenLayers.Request.GET({url:onlineResource,success:processLayersSuccess,failure:processLayersFailure,timeout:10000})
},addWMTSLayer:function(layerList){if(layerList.length===0){return
}showBigMap();
var format=new OpenLayers.Format.WMTSCapabilities({});
Ext.each(layerList,function(layerParam){OpenLayers.Request.GET({url:layerParam[1],params:{SERVICE:"WMTS",VERSION:"1.0.0",REQUEST:"GetCapabilities"},success:function(request){var doc=request.responseXML;
if(!doc||!doc.documentElement){doc=request.responseText
}var capabilities=format.read(doc);
var projection=app.mapApp.getMap().projection.toUpperCase();
var layermatrixSet=app.mapApp.getMap().projection;
var tileMS=capabilities.contents.tileMatrixSets;
for(key in tileMS){if(key.toUpperCase().indexOf(projection)>=0||tileMS[key].supportedCRS.toUpperCase().indexOf(projection)>=0||tileMS[key].identifier.toUpperCase().indexOf(projection)>=0){layermatrixSet=key
}}var layername=layerParam[2];
if(layername===""){GeoNetwork.WindowManager.showWindow("addwmts");
var panel=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwmts").browserPanel.id);
hide("serviceSearchForm");
panel.previewPanel.showPreview=function(layer){if(!layer){return
}this.showMask();
var previousMap=layer.map;
if(previousMap===null){layer.map=this.map
}var url=layer.getFullRequestString({SERVICE:"WMTS",REQUEST:"GetTile",LAYER:layer.name,STYLE:layer.style,TILEMATRIXSET:layer.matrixSet,TILEMATRIX:layer.matrixIds[0].identifier,TILEROW:0,TILECOL:0,FORMAT:layer.format});
if(previousMap===null){layer.map=previousMap
}this.currentLayer=layer;
this.image.getEl().dom.src=url
};
panel.setURL(layerParam[1])
}else{Ext.each(app.mapApp.maps,function(map){var f_="";
Ext.each(capabilities.contents.layers,function(l){if(l.identifier===layername){f_=l.formats[0]
}});
var layer=format.createLayer(capabilities,{name:layerParam[0],layer:layername,matrixSet:layermatrixSet,isBaseLayer:false,format:f_});
map.addLayer(layer)
})
}},failure:function(){GeoNetwork.Message().msg({msg:"loadLayer.error.message",status:"error",target:document.body,pause:30})
}})
})
},getViewport:function(){if(viewport===null){app.mapApp.init()
}return viewport
},createWmsLayer:function(name,url,params,options){Ext.each(app.mapApp.maps,function(map){map.adLayer(new OpenLayers.Layer.WMS(name,url,params,options))
})
},createLayer:function(olLayer){Ext.each(app.mapApp.maps,function(map){map.addLayer(olLayer.clone())
})
},getMap:function(){return app.mapApp.maps[0]
},maps:[],init:function(){generateMaps()
},initPrint:function(){createPrintPanel(app.mapApp.getMap())
},generateAuxiliaryMap:function(id){var map=new OpenLayers.Map({maxExtent:GeoNetwork.map.MAP_OPTIONS.maxExtent.clone(),projection:GeoNetwork.map.MAP_OPTIONS.projection,resolutions:GeoNetwork.map.MAP_OPTIONS.resolutions,restrictedExtent:GeoNetwork.map.MAP_OPTIONS.restrictedExtent.clone()});
Ext.each(GeoNetwork.map.MAP_OPTIONS.controls,function(control){if(control.clone){map.addControl(control.clone())
}});
Ext.each(GeoNetwork.map.BACKGROUND_LAYERS,function(layer){map.addLayer(layer.clone())
});
var scaleLinePanel=new Ext.Panel({cls:"olControlScaleLine overlay-element overlay-scaleline",border:false});
scaleLinePanel.on("render",function(){var scaleLine=new OpenLayers.Control.ScaleLine({div:scaleLinePanel.body.dom});
map.addControl(scaleLine);
scaleLine.activate()
},this);
var zoomStore;
var fixedScales=GeoNetwork.map.MAP_OPTIONS.resolutions;
if(fixedScales&&fixedScales.length>0){var zooms=[];
var scales=fixedScales;
var units=map.baseLayer.units;
for(var i=scales.length-1;
i>=0;
i--){var scale=scales[i];
zooms.push({level:i,resolution:OpenLayers.Util.getResolutionFromScale(scale,units),scale:scale})
}zoomStore=new GeoExt.data.ScaleStore({});
zoomStore.loadData(zooms)
}else{zoomStore=new GeoExt.data.ScaleStore({map:map})
}var zoomSelector=new Ext.form.ComboBox({emptyText:"Zoom level",tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale)]}</div></tpl>',editable:false,triggerAction:"all",mode:"local",store:zoomStore,width:110});
zoomSelector.on("click",function(evt){evt.stopEvent()
});
zoomSelector.on("mousedown",function(evt){evt.stopEvent()
});
zoomSelector.on("select",function(combo,record,index){map.zoomTo(record.data.level)
},this);
var zoomSelectorWrapper=new Ext.Panel({items:[zoomSelector],cls:"overlay-element overlay-scalechooser",border:false});
var mapOverlay=new Ext.Panel({cls:"map-overlay",items:[scaleLinePanel,zoomSelectorWrapper]});
mapOverlay.on("afterlayout",function(){scaleLinePanel.body.dom.style.position="relative";
scaleLinePanel.body.dom.style.display="inline";
mapOverlay.getEl().on("click",function(x){x.stopEvent()
});
mapOverlay.getEl().on("mousedown",function(x){x.stopEvent()
})
},this);
var panel=new GeoExt.MapPanel({height:400,map:map,renderTo:id});
return map
},getCapabilitiesWMS:function(url){var layers=[];
if(!(/\?$/.test(url))){if(/\?$/.test(url)){url=url+"&"
}else{url=url+"?"
}}OpenLayers.Request.GET({async:false,url:url+"request=GetCapabilities&service=WMS",success:function(response){var format=new OpenLayers.Format.XML();
var xml=format.read(response.responseText);
var text=format.write(xml);
var CAPformat=new OpenLayers.Format.WMSCapabilities();
var cap=CAPformat.read(xml);
if(cap.capability){Ext.each(cap.capability.layers,function(layer){if(layer.queryable){layers.push(layer.name)
}})
}}});
return layers
},getCapabilitiesWFS:function(url){var layers=[];
if(!(/\?$/.test(url))){if(/\?$/.test(url)){url=url+"&"
}else{url=url+"?"
}}var url2="version=1.1.0&request=DescribeFeatureType&service=WFS";
var describeFormat=new OpenLayers.Format.WFSDescribeFeatureType();
OpenLayers.Request.GET({async:false,url:url+url2,success:function(response){var format=new OpenLayers.Format.XML();
var xml=format.read(response.responseText);
var text=format.write(xml);
var describe=describeFormat.read(xml);
Ext.each(describe.featureTypes,function(ftype){Ext.each(ftype.properties,function(feat){var layer=new OpenLayers.Protocol.WFS({url:url,featurePrefix:describe.targetPrefix,featureType:feat.type,featureNS:describe.targetNamespace,geometryName:feat.name});
layers.push(layer)
})
})
}});
return layers
}}
};
Ext.namespace("GeoNetwork");
GeoNetwork.searchApp=function(){return{advSearchForm:null,permalinkProvider:null,init:function(){this.permalinkProvider=Ext.state.Manager.getProvider();
this.generateSimpleSearchForm();
this.advSearchForm=this.generateAdvancedSearchForm();
this.createResultsPanel(this.permalinkProvider);
resizeResultsPanel()
},addMetadata:function(uuid,clean,edit){if(uuid&&uuid!==""&&uuid!=="#?"){catalogue.metadataShow(uuid,true);
if(edit){app.edit(edit,false)
}}},setAdminFieldsCallback:function(adminFields){Ext.each(adminFields,function(item){item.setVisible(catalogue.identifiedUser&&catalogue.identifiedUser.role==="Administrator")
});
catalogue.on("afterLogin",function(){Ext.each(adminFields,function(item){item.setVisible(catalogue.identifiedUser&&catalogue.identifiedUser.role==="Administrator")
});
GeoNetwork.util.SearchFormTools.refreshGroupFieldValues()
});
catalogue.on("afterLogout",function(){Ext.each(adminFields,function(item){item.setVisible(!(catalogue.identifiedUser===undefined))
});
GeoNetwork.util.SearchFormTools.refreshGroupFieldValues()
})
},generateSimpleSearchForm:function(){var field=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:true,id:"fullTextField",renderTo:"fullTextField",width:285,minChars:2,loadingText:"...",hideTrigger:true,url:catalogue.services.opensearchSuggest,listeners:{change:function(){if(this.getValue().length>0){Ext.getCmp("E_trueany").setValue(this.getValue()+"*")
}else{Ext.getCmp("E_trueany").setValue(this.getValue())
}},select:function(e,a){if(this.getValue().length>0){Ext.getCmp("E_trueany").setValue(this.getValue()+"*")
}else{Ext.getCmp("E_trueany").setValue(this.getValue())
}Ext.getCmp("advanced-search-options-content-form").fireEvent("search")
},keyup:function(e,a){if(this.getValue().length>0){Ext.getCmp("E_trueany").setValue(this.getValue()+"*")
}else{Ext.getCmp("E_trueany").setValue(this.getValue())
}if(a.ENTER==a.keyCode){e.list.hide();
Ext.getCmp("advanced-search-options-content-form").fireEvent("search")
}}}})
},generateAdvancedSearchForm:function(){var advancedCriteria=[];
var any=new Ext.form.TextField({name:"E_any_OR_geokeyword_OR_title_OR_keyword",id:"E_trueany",hidden:true});
var onlineData=new Ext.form.Checkbox({name:"O_dynamic",id:"E_dynamic",hidden:true});
var onlineData_=new Ext.form.Checkbox({name:"O_dynamic",id:"o_dynamic",boxLabel:OpenLayers.i18n("Online data"),renderTo:"ck1"});
onlineData_.on("check",function(el){Ext.getCmp("E_dynamic").setValue(this.getValue());
Ext.getCmp("advanced-search-options-content-form").fireEvent("search")
});
var dataForDownload=new Ext.form.Checkbox({name:"O_download",id:"E_download",hidden:true});
var dataForDownload_=new Ext.form.Checkbox({name:"O_download_",id:"o_download",boxLabel:OpenLayers.i18n("Data for download"),renderTo:"ck2"});
dataForDownload_.on("check",function(el){Ext.getCmp("E_download").setValue(this.getValue());
Ext.getCmp("advanced-search-options-content-form").fireEvent("search")
});
var noDirectDownload=new Ext.form.Checkbox({name:"O_nodynamicdownload",id:"E_nodynamicdownload",hidden:true});
var noDirectDownload_=new Ext.form.Checkbox({name:"O_nodynamicdownload_",id:"o_nodynamicdownload",boxLabel:OpenLayers.i18n("No direct download"),renderTo:"ck3"});
noDirectDownload_.on("check",function(el){Ext.getCmp("E_nodynamicdownload").setValue(this.getValue());
Ext.getCmp("advanced-search-options-content-form").fireEvent("search")
});
var themekeyStore=new GeoNetwork.data.OpenSearchSuggestionStore({url:catalogue.services.opensearchSuggest,rootId:1,baseParams:{field:"keyword"}});
var themekeyField=new Ext.ux.form.SuperBoxSelect({hideLabel:false,minChars:0,queryParam:"q",hideTrigger:false,id:"E_themekey",name:"E_themekey",store:themekeyStore,valueField:"value",displayField:"value",valueDelimiter:" or ",fieldLabel:OpenLayers.i18n("keyword")});
var orgNameStore=new GeoNetwork.data.OpenSearchSuggestionStore({url:catalogue.services.opensearchSuggest,rootId:1,baseParams:{field:"orgName"}});
var orgNameField=new Ext.ux.form.SuperBoxSelect({hideLabel:false,minChars:0,queryParam:"q",hideTrigger:false,id:"E_orgName",name:"E_orgName",store:orgNameStore,valueField:"value",displayField:"value",valueDelimiter:" or ",fieldLabel:OpenLayers.i18n("org")});
var metadataTypeField=GeoNetwork.util.SearchFormTools.getMetadataTypeField(true);
var ownerField=new Ext.form.TextField({name:"E__owner",id:"_owner",hidden:true});
if(urlParameters.s_E__owner!==undefined){ownerField.value=urlParameters.s_E__owner
}var isHarvestedField=new Ext.form.TextField({name:"E__isHarvested",id:"_isHarvested",hidden:true});
if(urlParameters.s_E__isHarvested!==undefined){isHarvestedField.value=urlParameters.s_E__isHarvested
}var siteId=new Ext.form.TextField({name:"E_siteId",hidden:true});
var isPublishedToAll=new Ext.form.TextField({name:"E_isPublishedToAll",id:"isPublishedToAll",hidden:true});
if(urlParameters.s_E_isPublishedToAll!==undefined){isPublishedToAll.value=urlParameters.s_E_isPublishedToAll
}var serviceTypeField=GeoNetwork.util.INSPIRESearchFormTools.getServiceTypeField(true);
advancedCriteria.push(themekeyField,orgNameField,metadataTypeField,ownerField,isHarvestedField,siteId,isPublishedToAll);
var sortByCombo=new Ext.form.TextField({name:"E_sortBy",id:"E_sortBy",inputType:"hidden"});
var orderBy=new Ext.form.TextField({name:"E_sortOrder",id:"E_orderBy",inputType:"hidden"});
var mapLayers=[];
for(var i=0;
i<GeoNetwork.map.BACKGROUND_LAYERS.length;
i++){mapLayers.push(GeoNetwork.map.BACKGROUND_LAYERS[i].clone())
}var geomWithMapField={xtype:"gn_geometrymapfield",id:"geometryMap",layers:mapLayers,width:"100%",height:"212",mapOptions:GeoNetwork.map.MAP_OPTIONS,activated:false};
var what={title:OpenLayers.i18n("What"),id:"what_adv_search",bodyStyle:"padding:4px",layout:"form",defaults:{anchor:"100%"},items:[any,onlineData,dataForDownload,noDirectDownload,sortByCombo,orderBy,advancedCriteria]};
var where={title:OpenLayers.i18n("Where"),id:"where_adv_search",bodyStyle:"padding:4px",layout:"form",defaults:{anchor:"100%"},items:[geomWithMapField,getAreaFilterField()]};
var when={title:OpenLayers.i18n("When"),id:"when_adv_search",bodyStyle:"padding:4px",defaultType:"datefield",layout:"form",defaults:{anchor:"100%"},items:GeoNetwork.util.SearchFormTools.getWhen()};
var inspireFields=GeoNetwork.util.INSPIRESearchFormTools.getINSPIREFields(catalogue.services,true,{withAnnex:true,withTheme:true,withCategory:false,withServiceType:true});
var inspire={title:"INSPIRE",id:"inspire_adv_search",bodyStyle:"padding:4px",defaultType:"datefield",layout:"form",defaults:{anchor:"100%"},items:inspireFields};
var formItems=[];
formItems.push(new Ext.Panel({id:"advSearchTabs",layout:{type:"hbox",defaultMargins:"0 5 0 5"},anchor:"100%",monitorResize:true,border:false,items:[{id:"what-inspire",layout:"form",anchor:"32%",defaults:{anchor:"100%"},border:false,items:[what,inspire]},where,when]}));
this.setAdminFieldsCallback([metadataTypeField]);
return new GeoNetwork.SearchFormPanel({id:"advanced-search-options-content-form",renderTo:"advanced-search-options-content",stateId:"s",forceLayout:true,autoHeight:true,border:false,searchCb:function(){var any=Ext.get("E_any");
if(any){if(any.getValue()===OpenLayers.i18n("fullTextSearch")){any.setValue("")
}}catalogue.startRecord=1;
searching=true;
catalogue.search("advanced-search-options-content-form",app.searchApp.loadResults,null,catalogue.startRecord,true);
app.searchApp.firstSearch=true;
showSearch()
},listeners:{onreset:function(){if(Ext.getCmp("facets-panel")){Ext.getCmp("facets-panel").reset();
Ext.getCmp("_owner").setValue("");
Ext.getCmp("_isHarvested").setValue("");
Ext.getCmp("isPublishedToAll").setValue("")
}this.fireEvent("search");
GeoNetwork.Util.updateHeadInfo({title:catalogue.getInfo().name})
},afterlayout:function(){resizeAdvancedSearchResults();
var extent=GeoNetwork.map.EXTENT||new OpenLayers.Bounds(-180,-90,180,90);
var gm=Ext.getCmp("geometryMap").map;
if(gm.baseLayer){var zoom=function(){if(gm.getZoomForExtent(extent,true)<1){setTimeout(zoom,100)
}else{gm.zoomToExtent(extent,true)
}};
zoom()
}}},items:formItems})
},generateFacetedSearchPanel:function(){var breadcrumb=new Ext.Panel({id:"bread-crumb",renderTo:"bread-crumb-div",layout:"table",cls:"breadcrumb",defaultType:"button",border:false,split:false,layoutConfig:{columns:150}});
var facetsPanel=new GeoNetwork.FacetsPanel({id:"facets-panel",renderTo:"facets-panel-div",searchForm:Ext.getCmp("advanced-search-options-content-form"),breadcrumb:breadcrumb,switchFacetsMenu:false,maxDisplayedItems:GeoNetwork.Settings.facetMaxItems||7,facetListConfig:GeoNetwork.Settings.facetListConfig||[]})
},createBBar:function(){var previousAction=new Ext.Action({id:"previousBt",text:"&lt;&lt;",handler:function(){var from=catalogue.startRecord-50;
if(from>0){catalogue.startRecord=from;
catalogue.search("advanced-search-options-content-form",app.searchApp.loadResults,null,catalogue.startRecord,true)
}},scope:this});
var nextAction=new Ext.Action({id:"nextBt",text:"&gt;&gt;",handler:function(){catalogue.startRecord+=50;
catalogue.search("advanced-search-options-content-form",app.searchApp.loadResults,null,catalogue.startRecord,true)
},scope:this});
return new Ext.Toolbar({items:[previousAction,{xtype:"tbtext",text:"",id:"info"},nextAction]})
},createResultsPanel:function(permalinkProvider){var metadataResultsView=new GeoNetwork.MetadataResultsView({catalogue:catalogue,displaySerieMembers:true,autoScroll:true,autoWidth:false,tpl:GeoNetwork.Ngr.Templates.FULL,templates:{SIMPLE:GeoNetwork.Ngr.Templates.SIMPLE,THUMBNAIL:GeoNetwork.Ngr.Templates.THUMBNAIL,FULL:GeoNetwork.Ngr.Templates.FULL},featurecolor:GeoNetwork.Settings.results.featurecolor,colormap:GeoNetwork.Settings.results.colormap,featurecolorCSS:GeoNetwork.Settings.results.featurecolorCSS});
catalogue.resultsView=metadataResultsView;
Ext.each(app.mapApp.maps,function(map){catalogue.resultsView.addMap(map,true)
});
var tBar=new GeoNetwork.MetadataResultsToolbar({catalogue:catalogue,searchFormCmp:Ext.getCmp("advanced-search-options-content-form"),sortByCmp:Ext.getCmp("E_sortBy"),metadataResultsView:metadataResultsView});
var bBar=this.createBBar();
var resultPanel=new Ext.Panel({id:"resultsPanel",border:false,hidden:true,bodyCssClass:"md-view",autoWidth:true,layout:"fit",tbar:tBar,items:metadataResultsView,renderTo:"result-panel",bbar:bBar});
return resultPanel
},loadResults:function(response,query){Ext.state.Manager.getProvider().updateLastSearch(query);
var facetPanel=Ext.getCmp("facets-panel");
if(!facetPanel){app.searchApp.generateFacetedSearchPanel()
}Ext.getCmp("facets-panel").refresh(response);
Ext.getCmp("previousBt").setDisabled(catalogue.startRecord===1);
Ext.getCmp("previousBt_up").setDisabled(catalogue.startRecord===1);
Ext.getCmp("nextBt").setDisabled(catalogue.startRecord+50>catalogue.metadataStore.totalLength);
Ext.getCmp("nextBt_up").setDisabled(catalogue.startRecord+50>catalogue.metadataStore.totalLength);
Ext.getCmp("info_up").update(Ext.getCmp("info").el.dom.textContent||Ext.getCmp("info").el.dom.innerText);
Ext.getCmp("sortByToolBar").syncSize();
Ext.getCmp("sortByToolBar").setWidth(130);
var formParams=GeoNetwork.util.SearchTools.getFormValues(app.searchApp.advSearchForm);
var criteria="",excludedSearchParam={E_hitsperpage:null,E_relation:null,timeType:null,sortOrder:null,sortBy:null};
var facetpanel=Ext.getCmp("facets-panel");
var toRemove=[];
Ext.each(facetpanel.breadcrumb.items.items,function(c){if(c&&c.id&&c.id.indexOf("fake_")>0){if(Ext.get(c.id)){toRemove.push(c)
}}});
Ext.each(toRemove,function(c){facetpanel.breadcrumb.remove(c)
});
for(var item in formParams){var value=formParams[item];
if(formParams.hasOwnProperty(item)&&excludedSearchParam[item]===undefined){if(value!==""){fieldName=item.split("_");
criteria+=OpenLayers.i18n(fieldName[1]||item)+": "+value+" - "
}}if((typeof(value)==="string"||value instanceof String)&&value!==""){Ext.each(value.split(" or "),function(val){if(excludedSearchParam[item]===undefined){facetpanel.addFakeFacet(item,item,val)
}})
}else{if(value instanceof Array){Ext.each(value,function(val){if(item.indexOf("E_geometry")==0){val=val.substring(7)
}if(Ext.query("input[id^=field_facet][value="+val+"][name="+item+"]").length==0){if(excludedSearchParam[item]===undefined){facetpanel.addFakeFacet(item,item,val)
}}})
}}}var title=(catalogue.metadataStore.totalLength||0)+OpenLayers.i18n("recordsFound")+(criteria!==""?" | "+criteria:"");
GeoNetwork.Util.updateHeadInfo({title:catalogue.getInfo().name+" | "+title});
if(!cookie||!cookie.get("user")||!cookie.get("user").username){Ext.each(Ext.DomQuery.select(".md-action-menu"),function(el){hide(el)
})
}Ext.state.Manager.getProvider().restoring=false
}}
};
function getAreaFilterField(){var regionalTypes=[["within",OpenLayers.i18n("areafilter_only_regional")],["regional_and_national",OpenLayers.i18n("areafilter_regional_and_national")],["national",OpenLayers.i18n("areafilter_national")]];
myCombo=new Ext.form.ComboBox({id:"relation",name:"E_relation",mode:"local",value:"within",triggerAction:"all",fieldLabel:OpenLayers.i18n("areafilter_label"),store:new Ext.data.ArrayStore({id:0,fields:["id","name"],data:regionalTypes}),valueField:"id",width:180,displayField:"name",});
return myCombo
}Ext.namespace("GeoNetwork");
GeoNetwork.loginApp=function(){return{init:function(){Ext.get("login_button").on("click",function(e){user=catalogue.login(Ext.get("username").getValue(),Ext.get("password").getValue())
});
catalogue.on("afterBadLogin",this.loginAlert,this);
catalogue.on("afterLogin",function(e){cookie.set("user",catalogue.identifiedUser);
hide("login-form");
show("other-actions-mdrv");
show("md-selection-info");
var user=catalogue.identifiedUser;
Ext.get("username").dom.value=("");
Ext.get("password").dom.value=("");
if(Ext.isIE){Ext.get("user-button").dom.innerText=OpenLayers.i18n("logout");
Ext.get("username_label").dom.innerText=user.username;
Ext.get("name_label").dom.innerText=" "+user.surname+" ";
Ext.get("profile_label").dom.innerText="("+user.role+")"
}else{Ext.get("user-button").update(OpenLayers.i18n("logout"));
Ext.get("username_label").update(user.username);
Ext.get("name_label").update(" "+user.surname+" ");
Ext.get("profile_label").update("("+user.role+")")
}Ext.get("user-button").dom.href="javascript:catalogue.logout();";
show("administration_button");
if(user.type&&user.type==="advanced"){user.searchTemplate="FULL"
}else{user.searchTemplate="SIMPLE"
}});
catalogue.on("afterLogout",function(){cookie.set("user",undefined);
hide("other-actions-mdrv");
hide("md-selection-info");
hide("administration_button");
if(Ext.isIE){Ext.get("user-button").dom.innerText=OpenLayers.i18n("login");
Ext.get("username_label").dom.innerText=("");
Ext.get("name_label").dom.innerText=("");
Ext.get("profile_label").dom.innerText=("")
}else{Ext.get("user-button").update(OpenLayers.i18n("login"));
Ext.get("username_label").update("");
Ext.get("name_label").update("");
Ext.get("profile_label").update("")
}Ext.get("username").dom.value=("");
Ext.get("password").dom.value=("");
Ext.get("user-button").dom.href="javascript:toggleLogin();";
catalogue.metadataStore.removeAll();
catalogue.resultsView.store.removeAll();
showBrowse()
});
var user=cookie.get("user");
if(user){catalogue.identifiedUser=user
}},loginAlert:function(cat,user){GeoNetwork.Message().msg({title:OpenLayers.i18n("warning"),msg:OpenLayers.i18n("Login.error.message"),status:"warning",target:document.body})
}}
};
Ext.namespace("GeoNetwork");
if(!GeoNetwork.state){GeoNetwork.state={}
}GeoNetwork.state.PermalinkProvider=function(config){GeoExt.state.PermalinkProvider.superclass.constructor.apply(this,arguments);
config=config||{};
var url=config.url;
delete config.url;
if(!Ext.isIE){GeoNetwork.state.History.on("change",function(){Ext.state.Manager.getProvider().restore();
return false
})
}Ext.apply(this,config)
};
Ext.extend(GeoNetwork.state.PermalinkProvider,GeoExt.state.PermalinkProvider,{restoring:false,lastSearch:"",metadata_separator:"|",updateLastSearch:function(s){if(s==null){s=""
}this.lastSearch=s;
if(!this.restoring){GeoNetwork.state.History.add(s)
}},restore:function(url){if(GeoNetwork.state.History.eventsSuspended){return
}this.restoring=true;
var window_location_href=decodeURIComponent(window.location.href);
var i=window_location_href.indexOf("#");
if(i<0){i=window_location_href.length
}this.restoreFields(window_location_href.substring(0,i));
var location_hash=decodeURIComponent(location.hash);
var end=location_hash.indexOf("?");
if(end<=0){end=location_hash.length
}var from=location_hash.indexOf("|");
if(from<0){from=end
}var restoreSearch=true;
if(from>1){var search_string=location_hash.substring(1,from);
var url_md="xml.metadata.get?id=";
var open_file="<gmd:fileIdentifier>";
var close_file="</gmd:fileIdentifier>";
var open_char="<gco:CharacterString>";
var close_char="</gco:CharacterString>";
if(search_string.indexOf("id=")==0){var id=search_string.substring(3);
Ext.Ajax.request({url:url_md+id,success:function(response,opts){var res=response.responseText;
var uuid=res.substring(res.indexOf(open_file)+21,res.indexOf(close_file));
uuid=uuid.substring(uuid.indexOf(open_char)+21,uuid.indexOf(close_char));
app.searchApp.addMetadata(uuid,true)
}});
restoreSearch=false
}else{if(search_string.indexOf("edit=")==0){var id=search_string.substring(5);
Ext.Ajax.request({url:url_md+id,success:function(response,opts){var res=response.responseText;
var uuid=res.substring(res.indexOf(open_file)+21,res.indexOf(close_file));
uuid=uuid.substring(uuid.indexOf(open_char)+21,uuid.indexOf(close_char));
app.searchApp.addMetadata(uuid,true,id)
}});
restoreSearch=false
}else{if(search_string.indexOf("create")==0){Ext.getCmp("resultsPanel").getTopToolbar().createMetadataAction.fireEvent("click")
}else{if(!Ext.isEmpty(search_string)){GeoNetwork.util.SearchTools.doQuery(search_string,catalogue,catalogue.startRecord,app.searchApp.loadResults,null,true,catalogue.metadataStore,catalogue.summaryStore,true);
app.searchApp.firstSearch=true;
showSearch();
restoreSearch=false
}}}}}from=location_hash.indexOf("|");
if(from<0){from=0
}else{restoreSearch=false
}Ext.each(location_hash.substring(from,end).split("|"),function(uuid){if(app&&app.searchApp&&uuid.indexOf("#")<0&&!Ext.isEmpty(uuid)){app.searchApp.addMetadata(uuid,true);
restoreSearch=false
}});
if(OpenLayers.Util.getParameters(url).hasOwnProperty("s_search")&&restoreSearch){Ext.getCmp("advanced-search-options-content-form").fireEvent("search");
Ext.getCmp("advanced-search-options-content-form").getForm().reset()
}else{this.restoreFields(window_location_href);
Ext.state.Manager.getProvider().restoring=false
}},restoreFields:function(url){this.readURL(url);
var all={};
Ext.each(Ext.ComponentMgr.all.items,function(el){if(el.stateId){all[el.stateId]=el
}});
for(prop in this.state){var obj=this.state[prop];
var el=all[prop];
if(!el){el=Ext.getCmp(prop)
}if(!el){Ext.get(prop)
}if(el){if(el.map){this.restoreMap(obj,el.map)
}else{if(obj.zoom&&obj.x&&obj.y){Ext.each(el.initialConfig.items,function(item){Ext.each(item.items,function(it){if(it.map){map=it.map
}})
});
this.restoreMap(obj,map)
}else{if(obj.collapsed&&el.collapse){el.collapse()
}else{for(key in obj){var el_=Ext.DomQuery.select("*[name='"+key+"']");
if(el_&&el_.length&&el_.length>0){el_=el_[0]
}if(el_){el_=Ext.get(el_);
if(el_.setValue){el_.setValue(obj[key])
}else{if(el_.dom){el_.dom.value=obj[key]
}}}}}}}}}},readURL:function(url){this.state={};
var params=OpenLayers.Util.getParameters(url.substring(url.indexOf("?")));
var k,split,stateId;
for(k in params){if(params.hasOwnProperty(k)){split=k.split("_");
if(split.length>1){stateId=split[0];
this.state[stateId]=this.state[stateId]||{};
this.state[stateId][split.slice(1).join("_")]=this.encodeType?this.decodeValue(params[k]):params[k]
}}}return this.state
},getPrettyLink:function(base){var link=this.getLink(base);
if(link.indexOf("?")>=0){link=link.substring(0,link.indexOf("?"))
}link=link.substring(link.indexOf("|")+1);
return decodeURIComponent(window.location.href).match(/(http.*\/.*)\/srv\.*/,"")[1]+"/srv/search/?uuid="+link
},getLink:function(base){base=base||document.location.href;
var tabs=GeoNetwork.state.History.getToken();
if(!tabs||tabs=="null"){tabs=""
}var qMark=tabs.indexOf("?");
if(qMark>0){tabs=tabs.substring(0,qMark)
}qMark=tabs.indexOf("#");
if(qMark>0){tabs=tabs.substring(qMark)
}base=tabs;
var params={};
var id,k,state=this.state;
for(id in state){if(state.hasOwnProperty(id)){for(k in state[id]){params[id+"_"+k]=this.encodeType?unescape(this.encodeValue(state[id][k])):state[id][k]
}}}OpenLayers.Util.applyDefaults(params,OpenLayers.Util.getParameters(base));
var paramsStr=OpenLayers.Util.getParameterString(params);
return Ext.urlAppend(base,paramsStr)
},restoreMap:function(state,map){map.setCenter(new OpenLayers.LonLat(state.x,state.y),state.zoom,false,false);
var i,l,layer,layerId,visibility,opacity;
Ext.each(map.layers,function(layer){layerId=layer.name;
visibility=state["visibility_"+layerId];
if(visibility!==undefined){visibility=(/^true$/i).test(visibility);
if(layer.isBaseLayer){if(visibility){map.setBaseLayer(layer)
}}else{layer.setVisibility(visibility)
}}opacity=state["opacity_"+layerId];
if(opacity!==undefined){layer.setOpacity(opacity)
}})
}});
Ext.namespace("GeoNetwork");
if(!GeoNetwork.state){GeoNetwork.state={}
}GeoNetwork.state.History=(function(){var iframe,hiddenField;
var ready=false;
var currentToken;
var hash=undefined;
function timeout_function(){var newHash=getHash();
if(newHash!==hash){hash=newHash;
handleStateChange(hash);
doSave()
}}function getHash(){var href=top.location.href,i=href.indexOf("#");
href=decodeURIComponent(href);
return i>=0?href.substr(i+1):null
}function doSave(){hiddenField.value=currentToken
}function handleStateChange(token){currentToken=token;
GeoNetwork.state.History.fireEvent("change",token)
}function updateIFrame(token){var html=['<html><body><div id="state">',token,"</div></body></html>"].join("");
try{var doc=iframe.contentWindow.document;
doc.open();
doc.write(html);
doc.close();
return true
}catch(e){return false
}}function checkIFrame(){if(!iframe.contentWindow||!iframe.contentWindow.document){setTimeout(checkIFrame,10);
return
}var doc=iframe.contentWindow.document;
var elem=doc.getElementById("state");
var token=elem?elem.innerText:null;
hash=getHash();
setInterval(function(){doc=iframe.contentWindow.document;
elem=doc.getElementById("state");
var newtoken=elem?elem.innerText:null;
var newHash=getHash();
if(newtoken!==token){token=newtoken;
handleStateChange(token);
top.location.hash=token;
hash=token;
doSave()
}else{if(newHash!==hash){hash=newHash;
updateIFrame(newHash)
}}},50);
ready=true;
GeoNetwork.state.History.fireEvent("ready",GeoNetwork.state.History)
}return{fieldId:"x-history-field",iframeId:"x-history-frame",events:{},startUp:function(){currentToken=hiddenField.value?hiddenField.value:getHash();
if(Ext.isIE){checkIFrame()
}else{this.startEvents();
if(!ready){ready=true;
GeoNetwork.state.History.fireEvent("ready",GeoNetwork.state.History)
}}},startEvents:function(){GeoNetwork.state.History.suspendEvents();
hash=getHash();
setInterval(timeout_function,50)
},init:function(onReady,scope){if(ready){Ext.callback(onReady,scope,[this]);
return
}if(!Ext.isReady){Ext.onReady(function(){GeoNetwork.state.History.init(onReady,scope)
});
return
}hiddenField=Ext.getDom(GeoNetwork.state.History.fieldId);
if(Ext.isIE){iframe=Ext.getDom(GeoNetwork.state.History.iframeId)
}this.addEvents("ready","change");
if(onReady){this.on("ready",onReady,scope,{single:true})
}this.startUp()
},add:function(token,preventDup){token=decodeURIComponent(token);
if(preventDup!==false){if(this.getToken()==token){return true
}}this.suspendEvents();
var res=false;
if(Ext.isIE){res=updateIFrame(token)
}else{top.location.hash=token;
res=true
}currentToken=token;
this.resumeEvents();
return res
},back:function(){history.go(-1)
},forward:function(){history.go(1)
},getToken:function(){return ready?currentToken:getHash()
}}
})();
Ext.apply(GeoNetwork.state.History,new Ext.util.Observable());
Ext.apply(GeoNetwork.state.History,{suspendEvents:function(queueSuspended){this.eventsSuspended=true;
if(queueSuspended&&!this.eventQueue){this.eventQueue=[]
}if(!Ext.isIE){window.clearInterval(this.timeout_function)
}},resumeEvents:function(){var me=this,queued=me.eventQueue||[];
me.eventsSuspended=false;
delete me.eventQueue;
Ext.each(queued,function(e){me.fireEvent.apply(me,e)
});
if(!Ext.isIE){this.startEvents()
}}});
Ext.namespace("GeoNetwork");
GeoNetwork.BreadCrumb=function(){return{previous:[],current:"",separator:"  >>  ",div:"bread-crumb-app",defaultSteps:[{text:OpenLayers.i18n("BROWSE"),func:"showBrowse()"},{text:OpenLayers.i18n("SEARCH RESULTS"),func:"showSearch()"}],setCurrent:function(crumb){if(this.current){this.previous.push(this.current)
}this.current=crumb;
this.update()
},setPrevious:function(prev){this.previous=prev;
this.current=null
},setDefaultPrevious:function(index){var i=0;
var prev=[];
while(i<index&&i<this.defaultSteps.length){prev.push(this.defaultSteps[i]);
i++
}this.previous=prev;
this.current=null
},update:function(){var breadcrumb=null;
var separator=this.separator;
if(this.previous.length==0){Ext.get(this.div).update("");
return
}Ext.each(this.previous,function(elem){if(breadcrumb){breadcrumb=breadcrumb+separator
}else{breadcrumb=""
}breadcrumb=breadcrumb+'<a href="javascript:'+elem.func+'">'+elem.text+"</a>"
});
if(breadcrumb){breadcrumb=breadcrumb+this.separator
}else{breadcrumb=""
}breadcrumb=breadcrumb+'<span class="current">'+this.current.text+"</span>";
if(this.div){Ext.get(this.div).update(breadcrumb)
}}}
};
Ext.namespace("GeoNetwork");
var catalogue;
var app;
var cookie;
var urlParameters;
GeoNetwork.app=function(){var createLatestUpdate=function(){var latestView=new GeoNetwork.MetadataResultsView({catalogue:catalogue,autoScroll:true,tpl:GeoNetwork.Templates.THUMBNAIL});
var latestStore=new GeoNetwork.Settings.mdStore();
latestView.setStore(latestStore);
var p=new Ext.Panel({border:false,bodyCssClass:"md-view",items:latestView,renderTo:"latest-metadata"});
latestView.tpl=GeoNetwork.Templates.THUMBNAIL;
catalogue.kvpSearch("fast=index&from=1&to=4&sortBy=changeDate&hasimage=true",function(e){Ext.each(Ext.DomQuery.select(".md-action-menu"),function(el){hide(el)
})
},null,null,true,latestView.getStore())
};
function createMainTagCloud(){var tagCloudView=new GeoNetwork.TagCloudView({catalogue:catalogue,query:"fast=true&summaryOnly=true&from=1&to=4",renderTo:"cloud-tag"});
return tagCloudView
}var createPopularUpdate=function(){var latestView=new GeoNetwork.MetadataResultsView({catalogue:catalogue,autoScroll:true,tpl:GeoNetwork.Templates.THUMBNAIL});
var latestStore=new GeoNetwork.Settings.mdStore();
latestView.setStore(latestStore);
var p=new Ext.Panel({border:false,bodyCssClass:"md-view",items:latestView,renderTo:"popular-metadata"});
latestView.tpl=GeoNetwork.Templates.THUMBNAIL;
catalogue.kvpSearch("fast=index&from=1&to=4&sortBy=popularity&hasimage=true",function(e){Ext.each(Ext.DomQuery.select(".md-action-menu"),function(el){hide(el)
})
},null,null,true,latestView.getStore())
};
var createTopMetadata=function(){var top4View=new GeoNetwork.MetadataResultsView({catalogue:catalogue,autoScroll:true,tpl:GeoNetwork.Templates.THUMBNAIL});
var p=new Ext.Panel({border:false,bodyCssClass:"md-view",items:[{xtype:"component",width:760,height:295,layout:"fit",autoEl:{tag:"iframe",cls:"md-iframe",src:"http://www.yahoo.com"}}],renderTo:"top4-metadata"})
};
var loadMetadataMap=function(metadata){var checkboxes=[];
var layers=[];
Ext.each(metadata.record.get("links"),function(link){if(link.protocol==="application/vnd.ogc.wms_xml"||link.protocol.toUpperCase().indexOf("OGC:WMS")>=0){var layers=app.mapApp.getCapabilitiesWMS(link.href);
Ext.each(layers,function(layer){var wms=new OpenLayers.Layer.WMS(link.name,link.href,{layers:layer,transparent:true});
wms.setVisibility(true);
checkboxes.push(new Ext.form.Checkbox({boxLabel:layer,layer:wms}));
layers.push(wms)
})
}else{if(link.protocol==="application/vnd.ogc.wfs_xml"||link.protocol.toUpperCase().indexOf("OGC:WFS")>=0){var layers=[];
try{layers=app.mapApp.getCapabilitiesWFS(link.href)
}catch(ex){layers=[]
}var styleMap=new OpenLayers.StyleMap({strokeWidth:3,strokeColor:"#333333"});
var strategies=[new OpenLayers.Strategy.BBOX()];
Ext.each(layers,function(layer){var wfs=new OpenLayers.Layer.Vector(link.name,{strategies:strategies,protocol:layer,styleMap:styleMap});
wfs.setVisibility(true);
checkboxes.push(new Ext.form.Checkbox({boxLabel:layer.featurePrefix+":"+layer.geometryName,layer:wfs}));
layers.push(wfs)
})
}}});
var wfs_href=metadata.record.get("href");
var map=app.mapApp.generateAuxiliaryMap("map_"+metadata.title);
Ext.each(layers,function(layer){map.addLayer(layer)
})
};
var createLanguageSwitcher=function(lang){return new Ext.form.FormPanel({renderTo:"lang-form",width:400,border:false,layout:"anchor",hidden:GeoNetwork.Util.locales.length===1?true:false,items:[new Ext.form.ComboBox({mode:"local",triggerAction:"all",height:"100%",store:new Ext.data.ArrayStore({idIndex:2,fields:["id","name","id2"],data:GeoNetwork.Util.locales}),valueField:"id2",displayField:"name",value:lang,listeners:{select:function(cb,record,idx){var lang=/srv\/([a-z]{3})\/search/.exec(window.location.href);
if(Ext.isArray(lang)){lang=lang[1]
}if(lang===null){window.location.pathname=window.location.pathname.replace("/srv/search","/srv/"+cb.getValue()+"/search")
}else{window.location.pathname=window.location.pathname.replace(lang,cb.getValue())
}}}})]})
};
function edit(metadataId,create,group,child){Ext.getCmp("metadata-panel")&&Ext.getCmp("metadata-panel").destroy();
var editorPanel=new GeoNetwork.editor.EditorPanel({defaultViewMode:GeoNetwork.Settings.editor.defaultViewMode,catalogue:catalogue,renderTo:"metadata-info",layout:"border",xlinkOptions:{CONTACT:true},listeners:{editorClosed:function(){showSearch();
Ext.get("search-form").show()
}}});
editorPanel.init(metadataId,create,group,child);
editorPanel.doLayout(false);
showMetadata();
hide("search-form");
app.breadcrumb.setCurrent({text:OpenLayers.i18n("mdEditor"),func:"app.edit('"+metadataId+"', "+create+", "+group+","+child+")"})
}function show(uuid,record,url,maximized,width,height,clean){Ext.Ajax.request({url:catalogue.services.mdView+"../metadata.checkPermission?uuid="+uuid+"&op=view",success:function(response,opts){Ext.get("metadata-info").update("");
var aResTab=new GeoNetwork.view.ViewPanel({serviceUrl:catalogue.services.mdView+"?uuid="+uuid,lang:catalogue.lang,id:"metadata-panel",renderTo:"metadata-info",autoScroll:true,resultsView:catalogue.resultsView,layout:"fit",padding:"5px 25px",currTab:GeoNetwork.defaultViewMode||"simple",printDefaultForTabs:GeoNetwork.printDefaultForTabs||false,printUrl:"../../apps/ngr2/print.html",catalogue:catalogue,metadataUuid:uuid,record:record});
showMetadata();
app.breadcrumb.setDefaultPrevious(2);
var title="";
if(record&&record.get("title")){title=record.get("title")
}app.breadcrumb.setCurrent({text:title,func:"app.searchApp.addMetadata('"+uuid+"', true)"});
var contacts=[];
if(record){Ext.each(record.get("contact"),function(item){contacts.push(item.name)
});
var subjects=[];
Ext.each(record.get("subject"),function(item){subjects.push(item.value)
});
GeoNetwork.Util.updateHeadInfo({title:catalogue.getInfo().name+" | "+record.get("title")+(record.get("type")?" ("+record.get("type")+")":""),meta:{subject:record.get("abstract"),keywords:subjects,author:contacts}})
}token="|"+uuid;
if(!GeoNetwork.state.History.getToken()||GeoNetwork.state.History.getToken().indexOf("edit=")!=0){if(!Ext.state.Manager.getProvider().restoring){GeoNetwork.state.History.eventsSuspended=true;
GeoNetwork.state.History.suspendEvents();
GeoNetwork.state.History.add(token);
GeoNetwork.state.History.resumeEvents();
GeoNetwork.state.History.eventsSuspended=false
}}Ext.state.Manager.getProvider().restoring=false;
hide("share-capabilities");
hide("permalink-div");
Ext.getCmp("metadata-panel").getTopToolbar().addButton({id:"share-button",width:20,height:16,handler:function(){toggle("share-capabilities")
},text:"",tooltip:"Share this",type:"submit",tooltip:OpenLayers.i18n("Social Share"),enableToggle:true});
GeoNetwork.Util.removeMetaTags({"og:title":true,"og:url":true});
if(record&&record.get("title")){GeoNetwork.Util.addMetaTag("og:title",record.get("title"))
}GeoNetwork.Util.addMetaTag("og:url",Ext.state.Manager.getProvider().getPrettyLink());
Ext.get("custom-tweet-button").dom.href="https://twitter.com/share?text="+title+" "+Ext.state.Manager.getProvider().getPrettyLink();
Ext.get("custom-tweet-button").dom.title="Tweet this";
var fb_url="https://www.facebook.com/dialog/feed?app_id=307560442683468&redirect_uri="+Ext.state.Manager.getProvider().getPrettyLink()+"&link="+Ext.state.Manager.getProvider().getPrettyLink();
Ext.get("fb-button").update('<a href="'+fb_url+'">'+OpenLayers.i18n("Like!")+"</a>");
Ext.get("fb-button").dom.title="Like this";
var feedbackWindow;
var newFeedbackWindow=function(){feedbackWindow=new GeoNetwork.FeedbackForm(null,record);
feedbackWindow.show()
};
Ext.getCmp("metadata-panel").getTopToolbar().addButton({id:"feedback-button",width:20,height:14,tooltip:"Feedback",handler:newFeedbackWindow,text:"",tooltip:OpenLayers.i18n("Feedback"),type:"submit"});
Ext.getCmp("metadata-panel").getTopToolbar().addButton({id:"permalink-button",width:20,height:19,handler:function(){var url=Ext.state.Manager.getProvider().getPrettyLink();
Ext.get("permalink-div").update(url);
toggle("permalink-div")
},text:"",tooltip:OpenLayers.i18n("Permalink"),enableToggle:true,type:"submit"});
Ext.getCmp("metadata-panel").doLayout();
addToRecentViewed(record)
},failure:function(response,opts){if(history.length>2){GeoNetwork.state.History.back()
}else{showBrowse()
}new GeoNetwork.Message().msg({msg:OpenLayers.i18n("metadata.notFound"),pause:10})
}})
}function addToRecentViewed(record){return;
var div=Ext.getCmp("recent-viewed");
if(!div){var store=new Ext.data.ArrayStore({autoDestroy:true,autoSave:true,storeId:"recent-viewed-store",idIndex:0,fields:["thumbnail","description","uuid","title"]});
var tpl=new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap" id="recent-viewed_{uuid}">','<a href="javascript:app.searchApp.addMetadata(\'{uuid}\', true);"><div class="thumb">',"<h1>{title}</h1>",'<img src="{thumbnail}" title="{title}" alt="{title}">',"<span>{description}</span>","</div></a>","</div>","</tpl>");
div=new Ext.DataView({store:store,tpl:tpl,autoHeight:true,overClass:"x-view-over",renderTo:"recent-viewed-div",id:"recent-viewed"})
}var description=record.get("abstract");
if(description.length>140){description=description.substring(0,140)+"..."
}var alreadyThere=false;
Ext.each(div.store.data.items,function(e){if(e.data.uuid===record.get("uuid")){alreadyThere=true
}});
if(!alreadyThere){div.store.insert(0,new div.store.recordType({title:record.get("title"),uuid:record.get("uuid"),thumbnail:record.get("thumbnail"),description:description}))
}while(div.store.data.length>4){div.store.remove(div.store.data.items[div.store.data.length-1])
}}return{mapApp:null,searchApp:null,loginApp:null,breadcrumb:null,switchMode:function(i,j){},getIMap:function(){return this.mapApp
},showBigMap:function(){showBigMap()
},hideBigMap:function(){hideBigMap()
},initializeEnvironment:function(){var geonetworkUrl=window.location.href.match(/(http.*\/.*)\/srv\.*/,"")[1];
urlParameters=GeoNetwork.Util.getParameters(location.href);
var lang=/srv\/([a-z]{3})\/search/.exec(location.href);
if(lang===null){lang=GeoNetwork.Util.defaultLocale
}else{if(Ext.isArray(lang)){lang=lang[1]
}}if(urlParameters.extent){urlParameters.bounds=new OpenLayers.Bounds(urlParameters.extent[0],urlParameters.extent[1],urlParameters.extent[2],urlParameters.extent[3])
}createLanguageSwitcher(lang);
cookie=new Ext.state.CookieProvider({expires:new Date(new Date().getTime()+(1000*60*60*24*365))});
catalogue=new GeoNetwork.Catalogue({lang:lang,statusBarId:"info",hostUrl:geonetworkUrl,mdOverlayedCmpId:"resultsPanel",adminAppUrl:geonetworkUrl+"/srv/"+lang+"/admin",metadataStore:GeoNetwork.Settings.mdStore?new GeoNetwork.Settings.mdStore():new GeoNetwork.data.MetadataResultsStore(),metadataCSWStore:GeoNetwork.data.MetadataCSWResultsStore(),summaryStore:GeoNetwork.data.MetadataSummaryStore(),editMode:2,metadataEditFn:edit,metadataShowFn:show});
catalogue.identifiedUser=cookie.get("user");
Ext.Ajax.request({url:geonetworkUrl+"/srv/"+lang+"/admin",failure:function(r){if(cookie.get("user")){cookie.clear();
cookie.set("user",null);
location.reload()
}}});
Ext.state.Manager.setProvider(new GeoNetwork.state.PermalinkProvider({encodeType:false}));
createLatestUpdate();
createPopularUpdate();
createMainTagCloud();
this.breadcrumb=GeoNetwork.BreadCrumb();
this.breadcrumb.setCurrent(this.breadcrumb.defaultSteps[0])
},init:function(){this.initializeEnvironment();
this.loginApp=new GeoNetwork.loginApp();
this.loginApp.init();
this.mapApp=new GeoNetwork.mapApp();
this.mapApp.init();
this.searchApp=new GeoNetwork.searchApp();
this.searchApp.init();
if(urlParameters.create!==undefined&&catalogue.isIdentified()){var actionCtn=Ext.getCmp("resultsPanel").getTopToolbar();
actionCtn.createMetadataAction.handler.apply(actionCtn)
}},edit:function(uuid){edit(uuid)
},switchMode:function(){}}
};
Ext.onReady(function(){var lang=/srv\/([a-z]{3})\/search/.exec(location.href);
if(lang===null){lang=GeoNetwork.Util.defaultLocale
}else{if(Ext.isArray(lang)){lang=lang[1]
}}var lang_js="nl";
if(lang=="eng"){lang_js="en"
}Ext.Ajax.request({url:"https://www.pdok.nl/"+lang_js+"/ngr.xml",success:function(r){GeoNetwork.pdokPages={};
if(r.responseXML){Ext.each(r.responseXML.getElementsByTagName("item"),function(item){var link=item.getElementsByTagName("link")[0];
link=link.textContent||link.innerText||link.innerHTML||link.text;
var desc=item.getElementsByTagName("description")[0];
desc=desc.textContent||desc.innerText||desc.innerHTML||desc.text;
GeoNetwork.pdokPages[link]=desc
})
}if(GeoNetwork.pdokPages["https://www.pdok.nl/"+lang_js+"/ngr/ngr-catalogus"]){Ext.get("welcome-text").update(GeoNetwork.pdokPages["https://www.pdok.nl/"+lang_js+"/ngr/ngr-catalogus"])
}}});
hideAdvancedSearch();
var url=/(.*)\/srv/.exec(location.href)[1];
GeoNetwork.Util.setLang(lang,url+"/apps");
var spiders=Ext.get("only_for_spiders");
if(spiders){spiders.setVisibilityMode(Ext.Element.DISPLAY);
spiders.hide()
}if(Ext.isIE6){Ext.get(Ext.query("html")[0]).addClass("lt-ie9 lt-ie8 lt-ie7")
}else{if(Ext.isIE7){Ext.get(Ext.query("html")[0]).addClass("lt-ie9 lt-ie8")
}else{if(Ext.isIE8){Ext.get(Ext.query("html")[0]).addClass("lt-ie9")
}}}Ext.QuickTips.init();
app=new GeoNetwork.app();
app.init();
GeoNetwork.Util.updateHeadInfo({title:catalogue.getInfo().name});
initShortcut();
if(Ext.getDom("E_any")){Ext.getDom("E_any").focus(true)
}Ext.state.Manager.getProvider().restore(location.href);
GeoNetwork.state.History.init();
var events=["afterLogin","afterRating"];
Ext.each(events,function(e){catalogue.on(e,function(){if(Ext.get(resultsPanel).isVisible()){var e=Ext.getCmp("advanced-search-options-content-form");
e.getEl().fadeIn();
e.fireEvent("search")
}})
});
catalogue.on("afterDelete",function(){if(Ext.get(resultsPanel)){var e=Ext.getCmp("advanced-search-options-content-form");
e.getEl().fadeIn();
e.fireEvent("search")
}});
if(!cookie.get("alreadyShowMessage")){GeoNetwork.Message().msg({title:OpenLayers.i18n("cookies"),msg:OpenLayers.i18n("cookies.warning")+"<p><input type='button' value='"+OpenLayers.i18n("disclaimer.buttonClose")+"' onclick=\"Ext.get('cookie-warning').remove();\"/></p>",status:"information",target:document.body,id:"cookie-warning",pause:30});
cookie.set("alreadyShowMessage",true)
}Ext.getCmp("fullTextField").keyNav.enter=function(e){Ext.getCmp("advanced-search-options-content-form").fireEvent("search")
}
});
Ext.fly(window).on("resize",function(e,w){resizeMap();
resizeResultsPanel();
resizeAdvancedSearchResults()
});